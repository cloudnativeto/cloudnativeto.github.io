<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Kubernetes | äº‘åŸç”Ÿç¤¾åŒºï¼ˆä¸­å›½ï¼‰</title>
    <link>https://cloudnativecn.com/category/kubernetes/</link>
      <atom:link href="https://cloudnativecn.com/category/kubernetes/index.xml" rel="self" type="application/rss+xml" />
    <description>Kubernetes</description>
    <generator>Wowchemy (https://wowchemy.com)</generator><language>zh</language><lastBuildDate>Mon, 21 Apr 2025 15:04:55 +0800</lastBuildDate>
    <image>
      <url>https://cloudnativecn.com/media/sharing.png</url>
      <title>Kubernetes</title>
      <link>https://cloudnativecn.com/category/kubernetes/</link>
    </image>
    
    <item>
      <title>Kro é¡¹ç›®ï¼šä¸€æ¬¡ä¸‰å¤§äº‘å‚å•†è”åˆèµ‹èƒ½ Kubernetes ç”¨æˆ·çš„èŒƒä¾‹</title>
      <link>https://cloudnativecn.com/blog/kubernetes-resource-orchestration-kro/</link>
      <pubDate>Mon, 21 Apr 2025 15:04:55 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/kubernetes-resource-orchestration-kro/</guid>
      <description>&lt;p&gt;åœ¨ Kubernetes ç”Ÿæ€ä¸­ï¼Œ&lt;strong&gt;èµ„æºç¼–æ’&lt;/strong&gt;ä¸€ç›´æ˜¯å¹³å°å·¥ç¨‹é¢†åŸŸé¢ä¸´çš„æ ¸å¿ƒæŒ‘æˆ˜ã€‚2024 å¹´åº•ï¼Œä¸€ä¸ªåä¸º &lt;a href=&#34;https://github.com/kro-run/kro&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kro&lt;/a&gt;ï¼ˆKubernetes Resource Orchestratorï¼‰ çš„é¡¹ç›®æ¨ªç©ºå‡ºä¸–ï¼Œç”± AWSã€Google Cloud å’Œ Microsoft ä¸‰å¤§äº‘å‚å•†ç½•è§åœ°è”æ‰‹æ¨å‡ºï¼Œå¹¶ä»¥ Apache 2.0 åè®®å¼€æºï¼Œç«‹è¶³äºè§£å†³ Kubernetes ç”¨æˆ·å¯¹ç®€åŒ– CRD ç¼–æ’çš„é•¿æœŸè¯‰æ±‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸æ˜¯ä¼ä¸šæˆ˜ç•¥æ˜¯ç”¨æˆ·éœ€æ±‚çš„æ±‡èš&#34;&gt;ä¸æ˜¯ä¼ä¸šæˆ˜ç•¥ï¼Œæ˜¯ç”¨æˆ·éœ€æ±‚çš„æ±‡èš&lt;/h2&gt;
&lt;p&gt;Kro é¡¹ç›®çš„è¯ç”Ÿå¹¶éæŸä¸ªå…¬å¸çš„ä¸Šå±‚æ¨åŠ¨ï¼Œè€Œæ˜¯ç”±å„å¤§äº‘å‚å•†ç”¨æˆ·çš„â€œå…±åŒå£°éŸ³â€å‚¬ç”Ÿã€‚æ¥è‡ª AWS çš„å·¥ç¨‹å¸ˆè¡¨ç¤ºï¼ŒKro èƒŒåæ˜¯â€œcustomer pullï¼ˆå®¢æˆ·æ‹‰åŠ›ï¼‰â€é©±åŠ¨ï¼Œè€Œéâ€œvendor pushï¼ˆå‚å•†æ¨åŠ¨ï¼‰â€ã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes çš„é«˜åº¦å¯æ‰©å±•æ€§ä¸ºæ„å»ºè½¯ä»¶æä¾›äº†æ— é™å¯èƒ½ï¼Œä½†åŒæ—¶ä¹Ÿå¸¦æ¥äº†è¿ç»´å’Œèµ„æºç®¡ç†çš„å¤æ‚æ€§ï¼Œå°¤å…¶æ˜¯å›´ç»• CRDï¼ˆè‡ªå®šä¹‰èµ„æºï¼‰å’Œæ§åˆ¶å™¨çš„å¼€å‘ã€‚Kro çš„ç›®æ ‡æ˜¯ï¼š&lt;strong&gt;åœ¨ä¸ç»‘å®šå…·ä½“äº‘å¹³å°çš„å‰æä¸‹ï¼Œæä¾›ä¸€å¥— Kubernetes åŸç”Ÿçš„èµ„æºç¼–æ’èƒ½åŠ›ï¼Œå¸®åŠ©å¹³å°å›¢é˜Ÿé™ä½å¤æ‚åº¦ï¼Œè®©å¼€å‘è€…æ›´ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ­£å¦‚ Google çš„å·¥ç¨‹å¸ˆæ‰€è¯´ï¼šâ€œKubernetes å°±åƒç°ä»£ç‰ˆçš„ POSIXï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†ã€‚å®¢æˆ·æ™®éå¸Œæœ›æˆ‘ä»¬ä¸è¦æ„å»ºä¸“æœ‰çš„å°é—­æ–¹æ¡ˆã€‚â€&lt;/p&gt;
&lt;h2 id=&#34;äº‘å‚å•†è”åˆå¼€å‘æ‰“ç ´å£å’çš„å¼€æºåˆä½œ&#34;&gt;äº‘å‚å•†è”åˆå¼€å‘ï¼šæ‰“ç ´å£å’çš„å¼€æºåˆä½œ&lt;/h2&gt;
&lt;p&gt;æ›´ä»¤äººæŒ¯å¥‹çš„æ˜¯ Kro çš„åˆä½œæ–¹å¼â€”â€”ä¸æ˜¯ç«å“å¯¹æŠ—ï¼Œè€Œæ˜¯&lt;strong&gt;å¼€æºåä½œ&lt;/strong&gt;ã€‚Googleã€AWS å’Œ Azure çš„å·¥ç¨‹å¸ˆåŸæœ¬å„è‡ªç‹¬ç«‹æ„å»ºç±»ä¼¼å·¥å…·ï¼Œæœ€ç»ˆå†³å®šæ”¾å¼ƒé‡å¤å»ºè®¾ï¼ŒåˆåŠ›æ‰“é€ ä¸€ä¸ªçœŸæ­£é€šç”¨çš„ Kubernetes å·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§åˆä½œç²¾ç¥åœ¨ CNCF ç¤¾åŒºå¹¶ä¸ç½•è§ï¼Œå¤§å®¶ç§‰æŒçš„æ˜¯ â€œ&lt;strong&gt;Same Team, Different Company&lt;/strong&gt;â€ çš„ç†å¿µâ€”â€”ä¸è®ºå…¬å¸èƒŒæ™¯ï¼Œç›®æ ‡ä¸€è‡´ï¼Œå°±æ˜¯&lt;strong&gt;æœåŠ¡å¥½ Kubernetes ç”¨æˆ·&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¹³å°å·¥ç¨‹çš„ç»Ÿä¸€ç¼–æ’æ¥å£&#34;&gt;å¹³å°å·¥ç¨‹çš„ç»Ÿä¸€ç¼–æ’æ¥å£&lt;/h2&gt;
&lt;p&gt;Kro ä¸ºå¹³å°å›¢é˜Ÿæä¾›äº†ç»Ÿä¸€çš„èµ„æºæŠ½è±¡å±‚ã€‚é€šè¿‡ Kroï¼Œå¼€å‘è€…ä¸éœ€è¦äº†è§£å„ç±»äº‘èµ„æºèƒŒåçš„ API å’Œé…ç½®ç»†èŠ‚ï¼Œåªéœ€å®šä¹‰â€œæˆ‘éœ€è¦ä¸€ä¸ªæ•°æ®åº“â€å’Œâ€œè¿è¡Œåœ¨å“ªä¸ªåŒºåŸŸâ€ç­‰å…³é”®å‚æ•°ï¼Œå…¶å®ƒç¹æ‚çš„è®¾ç½®äº¤ç”± Kro èƒŒåçš„å¹³å°å·¥ç¨‹è‡ªåŠ¨å®Œæˆã€‚&lt;/p&gt;
&lt;p&gt;æ­£å¦‚é¡¹ç›®å‘èµ·äººä¹‹ä¸€æ‰€è¯´ï¼šâ€œå¼€å‘è€…åªéœ€è¦å¡«å†™ä¸€ä¸ªåç§°å’ŒåŒºåŸŸï¼Œè€Œä¸å¿…äº†è§£æœåŠ¡è´¦å·ã€å¯†é’¥æˆ–åº•å±‚èµ„æºçš„åˆ›å»ºè¿‡ç¨‹ã€‚â€&lt;/p&gt;
&lt;h2 id=&#34;é¡¹ç›®è¿›å±•ä¸æœªæ¥æ–¹å‘&#34;&gt;é¡¹ç›®è¿›å±•ä¸æœªæ¥æ–¹å‘&lt;/h2&gt;
&lt;p&gt;æˆªè‡³ç›®å‰ï¼ŒKro é¡¹ç›®ä»…è¯ç”Ÿ 7 ä¸ªæœˆï¼Œå·²ç»å¸å¼•äº†è¿‘ 60 ä½æ´»è·ƒè´¡çŒ®è€…ï¼Œå®Œå…¨ä¾èµ–ç¤¾åŒºè‡ªå‘ä¼ æ’­ã€‚å½“å‰ç‰ˆæœ¬ä¸º Alphaï¼Œä¸å»ºè®®ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚ä½†é¡¹ç›®å·²è§„åˆ’ä¸‹ä¸€é˜¶æ®µçš„å…³é”®ç‰¹æ€§ï¼Œå¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Collections&lt;/strong&gt;ï¼šæ”¯æŒå¼•ç”¨å·²æœ‰èµ„æºè€Œéé‡å¤åˆ›å»ºï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‘æ— å…³æ€§ä¼˜åŒ–&lt;/strong&gt;ï¼šè¿›ä¸€æ­¥æå‡åœ¨ä»»æ„ Kubernetes é›†ç¾¤ï¼ˆæ— è®ºæ˜¯ EKSã€GKEã€AKS è¿˜æ˜¯è‡ªå»ºé›†ç¾¤ï¼‰ä¸­çš„å¯ç§»æ¤æ€§ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Scope æ§åˆ¶&lt;/strong&gt;ï¼šä¿æŒé¡¹ç›®è¾¹ç•Œæ¸…æ™°ï¼Œé¿å…å˜æˆä¸‹ä¸€ä¸ªâ€œå¤æ‚å¹³å°â€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ€»ç»“ä»å…±è¯†åˆ°è¡ŒåŠ¨æ‰“é€ çœŸæ­£äº‘åŸç”Ÿçš„èµ„æºç¼–æ’å·¥å…·&#34;&gt;æ€»ç»“ï¼šä»å…±è¯†åˆ°è¡ŒåŠ¨ï¼Œæ‰“é€ çœŸæ­£äº‘åŸç”Ÿçš„èµ„æºç¼–æ’å·¥å…·&lt;/h2&gt;
&lt;p&gt;åœ¨å¤šäº‘å’Œå¹³å°å·¥ç¨‹æˆä¸ºè¶‹åŠ¿çš„ä»Šå¤©ï¼ŒKro é¡¹ç›®çš„å‘å¸ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªå·¥å…·çš„é—®ä¸–ï¼Œæ›´æ˜¯ä¸€ç§ä¿¡å·â€”â€”&lt;strong&gt;ä¸»æµäº‘å‚å•†ä¹Ÿåœ¨å‘â€œäº‘åŸç”Ÿä¸­ç«‹â€é æ‹¢ï¼Œå¼€å§‹çœŸæ­£å€¾å¬ç”¨æˆ·å¯¹å¼€æºæ ‡å‡†åŒ–çš„å‘¼å£°&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Kro ä»å¤„äºæ—©æœŸé˜¶æ®µï¼Œæ¬¢è¿æ¥è‡ªäº‘åŸç”Ÿç¤¾åŒºçš„è´¡çŒ®è€…åŠ å…¥ï¼Œä¸€èµ·æ‰“ç£¨è¿™ä¸ªè·¨äº‘èµ„æºç¼–æ’çš„æœªæ¥ä¹‹è·¯ã€‚é¡¹ç›®ä»“åº“ï¼šhttps://github.com/kro-run/kro&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>kube-scheduler-simulatorï¼šè®©è°ƒåº¦å™¨å¯è§‚å¯Ÿã€å¯è°ƒè¯•ã€å¯æ‰©å±•</title>
      <link>https://cloudnativecn.com/blog/introducing-kube-scheduler-simulator/</link>
      <pubDate>Tue, 08 Apr 2025 14:35:56 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/introducing-kube-scheduler-simulator/</guid>
      <description>&lt;p&gt;Kubernetes Scheduler æ˜¯æ§åˆ¶é¢ä¸­çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œè´Ÿè´£å†³å®šæ¯ä¸ª Pod è¿è¡Œåœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šã€‚æ¢å¥è¯è¯´ï¼Œæ‰€æœ‰ä½¿ç”¨ Kubernetes çš„ç”¨æˆ·ï¼Œå…¶ Pod çš„å‘½è¿éƒ½æŒæ¡åœ¨è°ƒåº¦å™¨æ‰‹ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/kubernetes-sigs/kube-scheduler-simulator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kube-scheduler-simulator&lt;/a&gt; æ˜¯ä¸€ä¸ª Kubernetes è°ƒåº¦å™¨çš„â€œæ¨¡æ‹Ÿå™¨â€ï¼Œæœ€åˆæ˜¯æˆ‘ï¼ˆKensei Nakadaï¼‰åœ¨ &lt;a href=&#34;https://summerofcode.withgoogle.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google Summer of Code 2021&lt;/a&gt; ä¸­å¯åŠ¨çš„é¡¹ç›®ï¼Œåç»­å¾—åˆ°äº†ä¼—å¤šè´¡çŒ®è€…çš„æ”¯æŒã€‚è¿™ä¸ªå·¥å…·çš„ç›®æ ‡æ˜¯å¸®åŠ©ç”¨æˆ·æ·±å…¥è§‚å¯Ÿè°ƒåº¦å™¨çš„è¡Œä¸ºå’Œå†³ç­–é€»è¾‘ã€‚&lt;/p&gt;
&lt;p&gt;æ— è®ºä½ æ˜¯ä½¿ç”¨è¯¸å¦‚ &lt;a href=&#34;https://kubernetes.io/zh-cn/docs/concepts/scheduling-eviction/assign-pod-node/#affinity-and-anti-affinity&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pod äº²å’Œæ€§&lt;/a&gt; ç­‰è°ƒåº¦çº¦æŸçš„æ™®é€šç”¨æˆ·ï¼Œè¿˜æ˜¯å¼€å‘è‡ªå®šä¹‰è°ƒåº¦æ’ä»¶çš„è°ƒåº¦å™¨ä¸“å®¶ï¼Œè¿™æ¬¾æ¨¡æ‹Ÿå™¨éƒ½å°†æˆä¸ºä½ ç†è§£å’Œæµ‹è¯•è°ƒåº¦ç­–ç•¥çš„é‡è¦åŠ©æ‰‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè°ƒåº¦å™¨æ¨¡æ‹Ÿå™¨&#34;&gt;ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè°ƒåº¦å™¨æ¨¡æ‹Ÿå™¨ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;Kubernetes Scheduler æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ’ä»¶é©±åŠ¨çš„â€œé»‘ç›’â€ï¼Œæ¯ä¸ªæ’ä»¶ä»ä¸åŒçš„è§’åº¦å‚ä¸è°ƒåº¦å†³ç­–ï¼Œç†è§£å®ƒçš„è¡Œä¸ºå¹¶ä¸å®¹æ˜“ã€‚&lt;/p&gt;
&lt;p&gt;å³ä½¿ä½ åœ¨æµ‹è¯•é›†ç¾¤ä¸­çœ‹åˆ° Pod æ­£å¸¸è°ƒåº¦ï¼Œä¹Ÿä¸èƒ½ä¿è¯å®ƒæ˜¯æŒ‰ä½ é¢„æœŸçš„é€»è¾‘è°ƒåº¦çš„ã€‚è¿™ç§â€œè¡¨é¢æ­£å¸¸ï¼Œå®åˆ™åå·®â€çš„é—®é¢˜ï¼Œå¾€å¾€ä¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¸¦æ¥æ„æƒ³ä¸åˆ°çš„è°ƒåº¦åæœã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œè°ƒåº¦å™¨çš„æµ‹è¯•ä¹Ÿéå¸¸å…·æœ‰æŒ‘æˆ˜æ€§ã€‚çœŸå®é›†ç¾¤ä¸­çš„è°ƒåº¦åœºæ™¯å¤æ‚å¤šæ ·ï¼Œæ— æ³•é€šè¿‡æœ‰é™çš„æµ‹è¯•ç”¨ä¾‹å…¨é¢è¦†ç›–ã€‚å³ä½¿æ˜¯ Kubernetes å®˜æ–¹çš„ upstream è°ƒåº¦å™¨ï¼Œä¹Ÿç»å¸¸æ˜¯åœ¨å‘å¸ƒåæ‰è¢«ç”¨æˆ·å‘ç°é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶å¼€å‘ç¯å¢ƒæˆ–æ²™ç®±é›†ç¾¤æ˜¯å¸¸ç”¨çš„æµ‹è¯•æ‰‹æ®µï¼Œä½†è¿™ç±»ç¯å¢ƒé€šå¸¸è§„æ¨¡è¾ƒå°ã€å·¥ä½œè´Ÿè½½æœ‰é™ï¼Œä¸å®é™…ç”Ÿäº§é›†ç¾¤çš„è¡Œä¸ºå­˜åœ¨å·¨å¤§å·®å¼‚ã€‚å› æ­¤ï¼Œä»…é ä¼ ç»Ÿæ–¹æ³•ï¼Œå¾ˆéš¾é¢„çŸ¥è°ƒåº¦å™¨åœ¨çœŸå®ç¯å¢ƒä¸­çš„è¡¨ç°ã€‚&lt;/p&gt;
&lt;p&gt;kube-scheduler-simulator è¯ç”Ÿæ­£æ˜¯ä¸ºäº†å¡«è¡¥è¿™ä¸€ç©ºç™½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æˆ·å¯ä»¥éªŒè¯è°ƒåº¦çº¦æŸã€è°ƒåº¦å™¨é…ç½®ã€è‡ªå®šä¹‰æ’ä»¶çš„è¡Œä¸ºï¼›&lt;/li&gt;
&lt;li&gt;å¯ä»¥åœ¨æ¨¡æ‹Ÿç¯å¢ƒä¸­æµ‹è¯•è°ƒåº¦æ•ˆæœï¼Œè€Œä¸å½±å“å®é™…çš„å·¥ä½œè´Ÿè½½ï¼›&lt;/li&gt;
&lt;li&gt;è¿˜èƒ½è§‚å¯Ÿè°ƒåº¦è¿‡ç¨‹ä¸­çš„æ¯ä¸€ä¸ªå†³ç­–ç»†èŠ‚ï¼ŒçœŸæ­£â€œæŠŠè°ƒåº¦å™¨å˜æˆç™½ç›’â€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ¨¡æ‹Ÿå™¨å…·æœ‰ä»€ä¹ˆèƒ½åŠ›&#34;&gt;æ¨¡æ‹Ÿå™¨å…·æœ‰ä»€ä¹ˆèƒ½åŠ›ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;kube-scheduler-simulator çš„æ ¸å¿ƒèƒ½åŠ›æ˜¯ï¼š&lt;strong&gt;æ­ç¤ºè°ƒåº¦å™¨å†…éƒ¨çš„å†³ç­–è¿‡ç¨‹&lt;/strong&gt;ã€‚Kubernetes Scheduler æ˜¯åŸºäº &lt;a href=&#34;https://kubernetes.io/zh-cn/docs/concepts/scheduling-eviction/scheduling-framework/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è°ƒåº¦æ¡†æ¶ï¼ˆScheduling Frameworkï¼‰&lt;/a&gt; å®ç°çš„ï¼Œæ•´ä¸ªè°ƒåº¦æµç¨‹åˆ†ä¸ºå¤šä¸ªæ‰©å±•ç‚¹ï¼Œå¦‚ Filterã€Scoreã€Bind ç­‰ï¼Œæ¯ä¸ªé˜¶æ®µä¼šè°ƒç”¨å¯¹åº”æ’ä»¶è¿›è¡Œåˆ¤æ–­å’Œæ‰“åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;æ¨¡æ‹Ÿå™¨æä¾›äº†å›¾å½¢åŒ–ç•Œé¢ï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­åˆ›å»º Podã€Nodeã€Deployment ç­‰ Kubernetes èµ„æºï¼Œå¹¶æ¸…æ™°åœ°çœ‹åˆ°è°ƒåº¦å™¨æ¯ä¸ªæ’ä»¶çš„æ‰§è¡Œç»“æœå’Œå¾—åˆ†æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-è°ƒåº¦å™¨æ¨¡æ‹Ÿå™¨-web-ui&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;è°ƒåº¦å™¨æ¨¡æ‹Ÿå™¨ Web UI&#34; srcset=&#34;
               /blog/introducing-kube-scheduler-simulator/simulator_hu5233630147159151970.webp 400w,
               /blog/introducing-kube-scheduler-simulator/simulator_hu5375461454994946459.webp 760w,
               /blog/introducing-kube-scheduler-simulator/simulator_hu7113445019924134691.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/introducing-kube-scheduler-simulator/simulator_hu5233630147159151970.webp&#34;
               width=&#34;760&#34;
               height=&#34;505&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      è°ƒåº¦å™¨æ¨¡æ‹Ÿå™¨ Web UI
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸ªæ¨¡æ‹Ÿå™¨ä¸­ï¼Œæˆ‘ä»¬è¿è¡Œçš„æ˜¯ä¸€ä¸ª &lt;strong&gt;å¯è°ƒè¯•ç‰ˆæœ¬çš„è°ƒåº¦å™¨&lt;/strong&gt;ï¼Œå®ƒä¼šå°†å„æ’ä»¶åœ¨ä¸åŒé˜¶æ®µçš„æ‰§è¡Œç»“æœå†™å…¥ Pod çš„æ³¨è§£ä¸­ï¼Œå‰ç«¯ç•Œé¢å†å°†è¿™äº›ä¿¡æ¯è¿›è¡Œå¯è§†åŒ–å±•ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œä½ å¯ä»¥æŸ¥çœ‹è°ƒåº¦å™¨åœ¨ Filter é˜¶æ®µå¦‚ä½•åˆ¤æ–­æŸä¸ªèŠ‚ç‚¹æ˜¯å¦å¯ç”¨ï¼Œåœ¨ Score é˜¶æ®µå„æ’ä»¶æ‰“äº†å¤šå°‘åˆ†ï¼Œæœ€ç»ˆé€‰æ‹©äº†å“ªä¸ªèŠ‚ç‚¹ä½œä¸ºç›®æ ‡èŠ‚ç‚¹ã€‚è¿™äº›ä¿¡æ¯éƒ½èƒ½åœ¨ Pod çš„æ³¨è§£ä¸­æŸ¥é˜…ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# The JSONs within these annotations are manually formatted for clarity in the blog post. &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kube-scheduler-simulator.sigs.k8s.io/bind-result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;DefaultBinder&amp;#34;:&amp;#34;success&amp;#34;}&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kube-scheduler-simulator.sigs.k8s.io/filter-result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;-&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        &amp;#34;node-jjfg5&amp;#34;:{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;NodeName&amp;#34;:&amp;#34;passed&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;NodeResourcesFit&amp;#34;:&amp;#34;passed&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;NodeUnschedulable&amp;#34;:&amp;#34;passed&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;TaintToleration&amp;#34;:&amp;#34;passed&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        },
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        &amp;#34;node-mtb5x&amp;#34;:{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;NodeName&amp;#34;:&amp;#34;passed&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;NodeResourcesFit&amp;#34;:&amp;#34;passed&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;NodeUnschedulable&amp;#34;:&amp;#34;passed&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;TaintToleration&amp;#34;:&amp;#34;passed&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      }      &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kube-scheduler-simulator.sigs.k8s.io/finalscore-result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;-&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        &amp;#34;node-jjfg5&amp;#34;:{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;ImageLocality&amp;#34;:&amp;#34;0&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;NodeAffinity&amp;#34;:&amp;#34;0&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;NodeResourcesBalancedAllocation&amp;#34;:&amp;#34;52&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;NodeResourcesFit&amp;#34;:&amp;#34;47&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;TaintToleration&amp;#34;:&amp;#34;300&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;VolumeBinding&amp;#34;:&amp;#34;0&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        },
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        &amp;#34;node-mtb5x&amp;#34;:{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;ImageLocality&amp;#34;:&amp;#34;0&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;NodeAffinity&amp;#34;:&amp;#34;0&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;NodeResourcesBalancedAllocation&amp;#34;:&amp;#34;76&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;NodeResourcesFit&amp;#34;:&amp;#34;73&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;TaintToleration&amp;#34;:&amp;#34;300&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;VolumeBinding&amp;#34;:&amp;#34;0&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      }       &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kube-scheduler-simulator.sigs.k8s.io/permit-result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{}&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kube-scheduler-simulator.sigs.k8s.io/permit-result-timeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{}&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kube-scheduler-simulator.sigs.k8s.io/postfilter-result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{}&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kube-scheduler-simulator.sigs.k8s.io/prebind-result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;VolumeBinding&amp;#34;:&amp;#34;success&amp;#34;}&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kube-scheduler-simulator.sigs.k8s.io/prefilter-result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{}&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kube-scheduler-simulator.sigs.k8s.io/prefilter-result-status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;-&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        &amp;#34;AzureDiskLimits&amp;#34;:&amp;#34;&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        &amp;#34;EBSLimits&amp;#34;:&amp;#34;&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        &amp;#34;GCEPDLimits&amp;#34;:&amp;#34;&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        &amp;#34;InterPodAffinity&amp;#34;:&amp;#34;&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        &amp;#34;NodeAffinity&amp;#34;:&amp;#34;&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        &amp;#34;NodePorts&amp;#34;:&amp;#34;&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        &amp;#34;NodeResourcesFit&amp;#34;:&amp;#34;success&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        &amp;#34;NodeVolumeLimits&amp;#34;:&amp;#34;&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        &amp;#34;PodTopologySpread&amp;#34;:&amp;#34;&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        &amp;#34;VolumeBinding&amp;#34;:&amp;#34;&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        &amp;#34;VolumeRestrictions&amp;#34;:&amp;#34;&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        &amp;#34;VolumeZone&amp;#34;:&amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      }      &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kube-scheduler-simulator.sigs.k8s.io/prescore-result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;-&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        &amp;#34;InterPodAffinity&amp;#34;:&amp;#34;&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        &amp;#34;NodeAffinity&amp;#34;:&amp;#34;success&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        &amp;#34;NodeResourcesBalancedAllocation&amp;#34;:&amp;#34;success&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        &amp;#34;NodeResourcesFit&amp;#34;:&amp;#34;success&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        &amp;#34;PodTopologySpread&amp;#34;:&amp;#34;&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        &amp;#34;TaintToleration&amp;#34;:&amp;#34;success&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      }      &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kube-scheduler-simulator.sigs.k8s.io/reserve-result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;VolumeBinding&amp;#34;:&amp;#34;success&amp;#34;}&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kube-scheduler-simulator.sigs.k8s.io/result-history&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;-&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      [
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;kube-scheduler-simulator.sigs.k8s.io/bind-result&amp;#34;:&amp;#34;{\&amp;#34;DefaultBinder\&amp;#34;:\&amp;#34;success\&amp;#34;}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;kube-scheduler-simulator.sigs.k8s.io/filter-result&amp;#34;:&amp;#34;{\&amp;#34;node-jjfg5\&amp;#34;:{\&amp;#34;NodeName\&amp;#34;:\&amp;#34;passed\&amp;#34;,\&amp;#34;NodeResourcesFit\&amp;#34;:\&amp;#34;passed\&amp;#34;,\&amp;#34;NodeUnschedulable\&amp;#34;:\&amp;#34;passed\&amp;#34;,\&amp;#34;TaintToleration\&amp;#34;:\&amp;#34;passed\&amp;#34;},\&amp;#34;node-mtb5x\&amp;#34;:{\&amp;#34;NodeName\&amp;#34;:\&amp;#34;passed\&amp;#34;,\&amp;#34;NodeResourcesFit\&amp;#34;:\&amp;#34;passed\&amp;#34;,\&amp;#34;NodeUnschedulable\&amp;#34;:\&amp;#34;passed\&amp;#34;,\&amp;#34;TaintToleration\&amp;#34;:\&amp;#34;passed\&amp;#34;}}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;kube-scheduler-simulator.sigs.k8s.io/finalscore-result&amp;#34;:&amp;#34;{\&amp;#34;node-jjfg5\&amp;#34;:{\&amp;#34;ImageLocality\&amp;#34;:\&amp;#34;0\&amp;#34;,\&amp;#34;NodeAffinity\&amp;#34;:\&amp;#34;0\&amp;#34;,\&amp;#34;NodeResourcesBalancedAllocation\&amp;#34;:\&amp;#34;52\&amp;#34;,\&amp;#34;NodeResourcesFit\&amp;#34;:\&amp;#34;47\&amp;#34;,\&amp;#34;TaintToleration\&amp;#34;:\&amp;#34;300\&amp;#34;,\&amp;#34;VolumeBinding\&amp;#34;:\&amp;#34;0\&amp;#34;},\&amp;#34;node-mtb5x\&amp;#34;:{\&amp;#34;ImageLocality\&amp;#34;:\&amp;#34;0\&amp;#34;,\&amp;#34;NodeAffinity\&amp;#34;:\&amp;#34;0\&amp;#34;,\&amp;#34;NodeResourcesBalancedAllocation\&amp;#34;:\&amp;#34;76\&amp;#34;,\&amp;#34;NodeResourcesFit\&amp;#34;:\&amp;#34;73\&amp;#34;,\&amp;#34;TaintToleration\&amp;#34;:\&amp;#34;300\&amp;#34;,\&amp;#34;VolumeBinding\&amp;#34;:\&amp;#34;0\&amp;#34;}}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;kube-scheduler-simulator.sigs.k8s.io/permit-result&amp;#34;:&amp;#34;{}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;kube-scheduler-simulator.sigs.k8s.io/permit-result-timeout&amp;#34;:&amp;#34;{}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;kube-scheduler-simulator.sigs.k8s.io/postfilter-result&amp;#34;:&amp;#34;{}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;kube-scheduler-simulator.sigs.k8s.io/prebind-result&amp;#34;:&amp;#34;{\&amp;#34;VolumeBinding\&amp;#34;:\&amp;#34;success\&amp;#34;}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;kube-scheduler-simulator.sigs.k8s.io/prefilter-result&amp;#34;:&amp;#34;{}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;kube-scheduler-simulator.sigs.k8s.io/prefilter-result-status&amp;#34;:&amp;#34;{\&amp;#34;AzureDiskLimits\&amp;#34;:\&amp;#34;\&amp;#34;,\&amp;#34;EBSLimits\&amp;#34;:\&amp;#34;\&amp;#34;,\&amp;#34;GCEPDLimits\&amp;#34;:\&amp;#34;\&amp;#34;,\&amp;#34;InterPodAffinity\&amp;#34;:\&amp;#34;\&amp;#34;,\&amp;#34;NodeAffinity\&amp;#34;:\&amp;#34;\&amp;#34;,\&amp;#34;NodePorts\&amp;#34;:\&amp;#34;\&amp;#34;,\&amp;#34;NodeResourcesFit\&amp;#34;:\&amp;#34;success\&amp;#34;,\&amp;#34;NodeVolumeLimits\&amp;#34;:\&amp;#34;\&amp;#34;,\&amp;#34;PodTopologySpread\&amp;#34;:\&amp;#34;\&amp;#34;,\&amp;#34;VolumeBinding\&amp;#34;:\&amp;#34;\&amp;#34;,\&amp;#34;VolumeRestrictions\&amp;#34;:\&amp;#34;\&amp;#34;,\&amp;#34;VolumeZone\&amp;#34;:\&amp;#34;\&amp;#34;}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;kube-scheduler-simulator.sigs.k8s.io/prescore-result&amp;#34;:&amp;#34;{\&amp;#34;InterPodAffinity\&amp;#34;:\&amp;#34;\&amp;#34;,\&amp;#34;NodeAffinity\&amp;#34;:\&amp;#34;success\&amp;#34;,\&amp;#34;NodeResourcesBalancedAllocation\&amp;#34;:\&amp;#34;success\&amp;#34;,\&amp;#34;NodeResourcesFit\&amp;#34;:\&amp;#34;success\&amp;#34;,\&amp;#34;PodTopologySpread\&amp;#34;:\&amp;#34;\&amp;#34;,\&amp;#34;TaintToleration\&amp;#34;:\&amp;#34;success\&amp;#34;}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;kube-scheduler-simulator.sigs.k8s.io/reserve-result&amp;#34;:&amp;#34;{\&amp;#34;VolumeBinding\&amp;#34;:\&amp;#34;success\&amp;#34;}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;kube-scheduler-simulator.sigs.k8s.io/score-result&amp;#34;:&amp;#34;{\&amp;#34;node-jjfg5\&amp;#34;:{\&amp;#34;ImageLocality\&amp;#34;:\&amp;#34;0\&amp;#34;,\&amp;#34;NodeAffinity\&amp;#34;:\&amp;#34;0\&amp;#34;,\&amp;#34;NodeResourcesBalancedAllocation\&amp;#34;:\&amp;#34;52\&amp;#34;,\&amp;#34;NodeResourcesFit\&amp;#34;:\&amp;#34;47\&amp;#34;,\&amp;#34;TaintToleration\&amp;#34;:\&amp;#34;0\&amp;#34;,\&amp;#34;VolumeBinding\&amp;#34;:\&amp;#34;0\&amp;#34;},\&amp;#34;node-mtb5x\&amp;#34;:{\&amp;#34;ImageLocality\&amp;#34;:\&amp;#34;0\&amp;#34;,\&amp;#34;NodeAffinity\&amp;#34;:\&amp;#34;0\&amp;#34;,\&amp;#34;NodeResourcesBalancedAllocation\&amp;#34;:\&amp;#34;76\&amp;#34;,\&amp;#34;NodeResourcesFit\&amp;#34;:\&amp;#34;73\&amp;#34;,\&amp;#34;TaintToleration\&amp;#34;:\&amp;#34;0\&amp;#34;,\&amp;#34;VolumeBinding\&amp;#34;:\&amp;#34;0\&amp;#34;}}&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;kube-scheduler-simulator.sigs.k8s.io/selected-node&amp;#34;:&amp;#34;node-mtb5x&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      ]      &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kube-scheduler-simulator.sigs.k8s.io/score-result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;-&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        &amp;#34;node-jjfg5&amp;#34;:{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;ImageLocality&amp;#34;:&amp;#34;0&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;NodeAffinity&amp;#34;:&amp;#34;0&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;NodeResourcesBalancedAllocation&amp;#34;:&amp;#34;52&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;NodeResourcesFit&amp;#34;:&amp;#34;47&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;TaintToleration&amp;#34;:&amp;#34;0&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;VolumeBinding&amp;#34;:&amp;#34;0&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        },
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        &amp;#34;node-mtb5x&amp;#34;:{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;ImageLocality&amp;#34;:&amp;#34;0&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;NodeAffinity&amp;#34;:&amp;#34;0&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;NodeResourcesBalancedAllocation&amp;#34;:&amp;#34;76&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;NodeResourcesFit&amp;#34;:&amp;#34;73&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;TaintToleration&amp;#34;:&amp;#34;0&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            &amp;#34;VolumeBinding&amp;#34;:&amp;#34;0&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      }      &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kube-scheduler-simulator.sigs.k8s.io/selected-node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;node-mtb5x&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸ä»…å¦‚æ­¤ï¼Œç”¨æˆ·è¿˜å¯ä»¥é›†æˆè‡ªå·±å¼€å‘çš„ &lt;a href=&#34;https://kubernetes.io/zh-cn/docs/concepts/scheduling-eviction/scheduling-framework/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è°ƒåº¦æ’ä»¶&lt;/a&gt; æˆ– &lt;a href=&#34;https://github.com/kubernetes/design-proposals-archive/blob/main/scheduling/scheduler_extender.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è°ƒåº¦æ‰©å±•å™¨ï¼ˆExtenderï¼‰&lt;/a&gt;ï¼Œå¹¶åœ¨æ¨¡æ‹Ÿå™¨ä¸­è§‚å¯Ÿå…¶è¡Œä¸ºï¼Œè°ƒè¯•æ•ˆæœæ˜¾è‘—æå‡ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥å¯è°ƒè¯•è°ƒåº¦å™¨è¿˜å¯ä»¥è„±ç¦»æ¨¡æ‹Ÿå™¨ç‹¬ç«‹è¿è¡Œï¼Œç”¨äºé›†æˆæµ‹è¯•ã€è‡ªå®šä¹‰è°ƒåº¦å™¨çš„å¼€å‘æˆ–çœŸå®é›†ç¾¤ä¸­çš„è°ƒè¯•åˆ†æã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¨¡æ‹Ÿå™¨--æ›´å¥½çš„å¼€å‘ç¯å¢ƒ&#34;&gt;æ¨¡æ‹Ÿå™¨ = æ›´å¥½çš„å¼€å‘ç¯å¢ƒï¼Ÿ&lt;/h2&gt;
&lt;p&gt;å¦‚å‰æ‰€è¿°ï¼ŒçœŸå®è°ƒåº¦åœºæ™¯å¤æ‚å¤šæ ·ï¼Œå•é å¼€å‘é›†ç¾¤æ— æ³•è¦†ç›–å…¨éƒ¨å¯èƒ½æ€§ã€‚æ¨¡æ‹Ÿå™¨æä¾›äº†ä¸€ä¸ªæ›´å¼ºå¤§çš„æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;p&gt;é€šè¿‡ä½¿ç”¨ &lt;a href=&#34;https://github.com/kubernetes-sigs/kube-scheduler-simulator/blob/master/simulator/docs/import-cluster-resources.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é›†ç¾¤èµ„æºå¯¼å…¥åŠŸèƒ½&lt;/a&gt;ï¼Œç”¨æˆ·å¯ä»¥å°†ç”Ÿäº§é›†ç¾¤çš„èµ„æºåŒæ­¥åˆ°æ¨¡æ‹Ÿå™¨ä¸­ï¼Œ&lt;strong&gt;åœ¨ä¸å½±å“å®é™…ä¸šåŠ¡çš„å‰æä¸‹æµ‹è¯•æ–°ç‰ˆæœ¬è°ƒåº¦å™¨&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥åœ¨æ¨¡æ‹Ÿå™¨ä¸­éªŒè¯ Pod çš„è°ƒåº¦è¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œå†å°†è°ƒåº¦å™¨éƒ¨ç½²åˆ°ç”Ÿäº§é›†ç¾¤ï¼Œæå¤§é™ä½äº†è°ƒåº¦ç›¸å…³çš„å˜æ›´é£é™©ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨åœºæ™¯æ€»ç»“&#34;&gt;ä½¿ç”¨åœºæ™¯æ€»ç»“&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é›†ç¾¤ç”¨æˆ·&lt;/strong&gt;ï¼šéªŒè¯è°ƒåº¦çº¦æŸï¼ˆå¦‚ PodAffinityã€TopologySpreadï¼‰æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é›†ç¾¤ç®¡ç†å‘˜&lt;/strong&gt;ï¼šè¯„ä¼°è°ƒåº¦å™¨é…ç½®å˜æ›´å¯¹è°ƒåº¦ç»“æœçš„å½±å“ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è°ƒåº¦å™¨æ’ä»¶å¼€å‘è€…&lt;/strong&gt;ï¼šåœ¨æ¨¡æ‹Ÿå™¨ä¸­æµ‹è¯•è‡ªå®šä¹‰æ’ä»¶ã€ä½¿ç”¨åŒæ­¥åŠŸèƒ½è¿›è¡Œæ›´çœŸå®çš„éªŒè¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å¦‚ä½•ä¸Šæ‰‹&#34;&gt;å¦‚ä½•ä¸Šæ‰‹ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªé¡¹ç›®æ— éœ€ Kubernetes é›†ç¾¤ï¼Œåªéœ€è¦æœ¬åœ°å®‰è£… Docker å³å¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone git@github.com:kubernetes-sigs/kube-scheduler-simulator.git
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; kube-scheduler-simulator
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;make docker_up
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼ŒWeb ç•Œé¢å°†è¿è¡Œåœ¨ &lt;code&gt;http://localhost:3000&lt;/code&gt;ï¼Œå³å¯å¼€å§‹ä½ çš„è°ƒåº¦å®éªŒï¼&lt;/p&gt;
&lt;p&gt;ğŸ‘‰ é¡¹ç›®åœ°å€ï¼šhttps://github.com/kubernetes-sigs/kube-scheduler-simulator&lt;/p&gt;
&lt;h2 id=&#34;å¦‚ä½•å‚ä¸è´¡çŒ®&#34;&gt;å¦‚ä½•å‚ä¸è´¡çŒ®ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;è¯¥é¡¹ç›®ç”± &lt;a href=&#34;https://github.com/kubernetes/community/blob/master/sig-scheduling/README.md#kube-scheduler-simulator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes SIG Scheduling&lt;/a&gt; ç»´æŠ¤ã€‚æ¬¢è¿ä½ æå‡º Issuesã€æäº¤ PRï¼Œä¹Ÿæ¬¢è¿åŠ å…¥ç¤¾åŒºå‚ä¸è®¨è®ºã€‚&lt;/p&gt;
&lt;p&gt;Slack é¢‘é“ï¼š&lt;a href=&#34;https://kubernetes.slack.com/messages/sig-scheduling&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#sig-scheduling&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;é¸£è°¢&#34;&gt;é¸£è°¢&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªæ¨¡æ‹Ÿå™¨çš„å‘å±•ç¦»ä¸å¼€ä¼—å¤šå¿—æ„¿è€…å·¥ç¨‹å¸ˆçš„åšæŒå’Œè´¡çŒ®ï¼Œæ„Ÿè°¢æ‰€æœ‰ä¸ºä¹‹ä»˜å‡ºå¿ƒåŠ›çš„ &lt;a href=&#34;https://github.com/kubernetes-sigs/kube-scheduler-simulator/graphs/contributors&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è´¡çŒ®è€…ä»¬&lt;/a&gt;ï¼&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>KEDA vs. åŸç”Ÿ Kubernetesï¼šè°æ˜¯äº‘åŸç”Ÿåº”ç”¨çš„è‡ªåŠ¨ä¼¸ç¼©ç‹è€…ï¼Ÿ</title>
      <link>https://cloudnativecn.com/blog/battle-of-the-pods-kubernetes-autoscaling-showdown-keda-vs-vanilla-kubernetes/</link>
      <pubDate>Fri, 12 Jan 2024 08:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/battle-of-the-pods-kubernetes-autoscaling-showdown-keda-vs-vanilla-kubernetes/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ªï¼š&lt;a href=&#34;https://www.kedify.io/blog-posts/battle-of-the-pods-kubernetes-autoscaling-showdown-keda-vs-vanilla-kubernetes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Battle of the Pods: Kubernetes Autoscaling Showdown - KEDA vs. vanilla Kubernetes&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ‘˜è¦ï¼šæœ¬æ–‡æ¯”è¾ƒäº† Kubernetes çš„å†…ç½®è‡ªåŠ¨ä¼¸ç¼©å™¨ï¼ˆHPA å’Œ VPAï¼‰å’Œ KEDA é¡¹ç›®çš„ä¼˜ç¼ºç‚¹ï¼Œåˆ†æäº†å®ƒä»¬åœ¨ä¸åŒåœºæ™¯ä¸‹çš„é€‚ç”¨æ€§å’Œæ•ˆæœï¼Œå±•ç¤ºäº† KEDA å¦‚ä½•è§£å†³ HPA å’Œ VPA æ— æ³•è¦†ç›–çš„å¤æ‚éœ€æ±‚ã€‚&lt;/p&gt;
&lt;h3 id=&#34;1-å¼•è¨€è‡ªåŠ¨ä¼¸ç¼©çš„é‡è¦æ€§&#34;&gt;1. å¼•è¨€ï¼šè‡ªåŠ¨ä¼¸ç¼©çš„é‡è¦æ€§&lt;/h3&gt;
&lt;p&gt;åœ¨ä»Šå¤©çš„äº‘åŸç”Ÿç”Ÿæ€ç³»ç»Ÿä¸­ï¼Œæ³¢åŠ¨çš„å·¥ä½œè´Ÿè½½å’ŒåŠ¨æ€çš„æµé‡æ¨¡å¼æ˜¯å¸¸æ€ã€‚é€‚åº”è¿™ç§ä¸å¯é¢„æµ‹çš„è¡Œä¸ºéœ€è¦èƒ½å¤Ÿå®æ—¶è°ƒæ•´çš„ç³»ç»Ÿã€‚è‡ªåŠ¨ä¼¸ç¼©æ˜¯å¿…éœ€çš„ï¼Œå¯ä»¥ç¡®ä¿èµ„æºçš„æœ€ä½³åˆ†é…ï¼Œéåˆ¶è¿‡åº¦æˆæœ¬ï¼Œå¹¶ä¿ƒè¿›èµ„æºçš„é«˜æ•ˆä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;è‡ªåŠ¨ä¼¸ç¼©ä¸ä»…å…³ä¹æˆæœ¬ã€‚å®ƒåœ¨ç»´æŠ¤åº”ç”¨æ€§èƒ½å’Œååé‡æ–¹é¢å‘æŒ¥ç€å…³é”®ä½œç”¨ã€‚é€šè¿‡é¿å…æ¬ é…ç½®ï¼ˆå¯¼è‡´ç”¨æˆ·ä½“éªŒä¸ä½³ï¼‰å’Œè¿‡åº¦é…ç½®ï¼ˆå¯¼è‡´ä¸å¿…è¦çš„æˆæœ¬ï¼‰ï¼Œè‡ªåŠ¨ä¼¸ç¼©å¯ä»¥å®ç°åˆç†çš„å¹³è¡¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;2-ç«äº‰è€…äº†è§£åŸºç¡€çŸ¥è¯†&#34;&gt;2. ç«äº‰è€…ï¼šäº†è§£åŸºç¡€çŸ¥è¯†&lt;/h3&gt;
&lt;h3 id=&#34;æ°´å¹³-pod-è‡ªåŠ¨ä¼¸ç¼©å™¨hpa&#34;&gt;æ°´å¹³ Pod è‡ªåŠ¨ä¼¸ç¼©å™¨ï¼ˆHPAï¼‰&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HPA&lt;/a&gt;ï¼Œä½œä¸º Kubernetes çš„æœ¬åœ°è§£å†³æ–¹æ¡ˆï¼Œæ ¹æ®è§‚å¯Ÿåˆ°çš„æŒ‡æ ‡ï¼ˆä¸»è¦æ˜¯ CPU å’Œå†…å­˜ï¼‰æ¥æ‰©å±• Pod çš„æ•°é‡ã€‚è™½ç„¶å¯¹äºç»Ÿä¸€çš„å·¥ä½œè´Ÿè½½æ¥è¯´éå¸¸ç›´æ¥å’Œæœ‰ç›Šï¼Œä½†å½“è€ƒè™‘åˆ°å…¶æ— æ³•æ‰©å±•åˆ°é›¶å¹¶ä¸”å®Œå…¨ä¾èµ– CPU å’Œå†…å­˜æŒ‡æ ‡æ—¶ï¼Œå®ƒçš„å±€é™æ€§å°±å˜å¾—æ˜æ˜¾äº†ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-hpa-æ”¹å˜-pod-çš„æ•°é‡&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;HPA æ”¹å˜ Pod çš„æ•°é‡&#34; srcset=&#34;
               /blog/battle-of-the-pods-kubernetes-autoscaling-showdown-keda-vs-vanilla-kubernetes/1_hu11995226469964566354.webp 400w,
               /blog/battle-of-the-pods-kubernetes-autoscaling-showdown-keda-vs-vanilla-kubernetes/1_hu16851504726864327277.webp 760w,
               /blog/battle-of-the-pods-kubernetes-autoscaling-showdown-keda-vs-vanilla-kubernetes/1_hu5754082744711571263.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/battle-of-the-pods-kubernetes-autoscaling-showdown-keda-vs-vanilla-kubernetes/1_hu11995226469964566354.webp&#34;
               width=&#34;760&#34;
               height=&#34;293&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      HPA æ”¹å˜ Pod çš„æ•°é‡
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;å‚ç›´-pod-è‡ªåŠ¨ä¼¸ç¼©å™¨vpa&#34;&gt;å‚ç›´ Pod è‡ªåŠ¨ä¼¸ç¼©å™¨ï¼ˆVPAï¼‰&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler#intro&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VPA&lt;/a&gt;æ›´å¤šåœ°æ¶‰åŠèµ„æºçš„è°ƒæ•´è€Œä¸æ˜¯æ‰©å±•å®ƒä»¬ã€‚å®ƒè¯„ä¼°éœ€æ±‚å¹¶åŠ¨æ€è°ƒæ•´èµ„æºï¼Œç¡®ä¿å·¥ä½œè´Ÿè½½çš„åˆé€‚é€‚é…ã€‚ä½†è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¢å¼ºå‹çš„ Pod å¹¶ä¸ä¸€å®šæ›´å¥½ã€‚æœ‰æ—¶ï¼Œæ‹¥æœ‰æ›´å¤šçš„å·¥ä½œè¿›ç¨‹æ¥å¤„ç†æ•°æ®æ¯”æ‹¥æœ‰ä¸€ä¸ªå¤§è€Œå¼ºå¤§çš„å·¥ä½œè¿›ç¨‹æ›´é«˜æ•ˆã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-vpa-è°ƒæ•´-pod-çš„å¤§å°&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;VPA è°ƒæ•´ Pod çš„å¤§å°&#34; srcset=&#34;
               /blog/battle-of-the-pods-kubernetes-autoscaling-showdown-keda-vs-vanilla-kubernetes/2_hu12018477851291741342.webp 400w,
               /blog/battle-of-the-pods-kubernetes-autoscaling-showdown-keda-vs-vanilla-kubernetes/2_hu16048068236269557703.webp 760w,
               /blog/battle-of-the-pods-kubernetes-autoscaling-showdown-keda-vs-vanilla-kubernetes/2_hu6194738254757635060.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/battle-of-the-pods-kubernetes-autoscaling-showdown-keda-vs-vanilla-kubernetes/2_hu12018477851291741342.webp&#34;
               width=&#34;760&#34;
               height=&#34;339&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      VPA è°ƒæ•´ Pod çš„å¤§å°
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;3-é™åˆ¶å½“åŸç”Ÿ-kubernetes-è‡ªåŠ¨ä¼¸ç¼©å™¨ä¸è¶³ä»¥åº”å¯¹æ—¶&#34;&gt;3. é™åˆ¶ï¼šå½“åŸç”Ÿ Kubernetes è‡ªåŠ¨ä¼¸ç¼©å™¨ä¸è¶³ä»¥åº”å¯¹æ—¶&lt;/h2&gt;
&lt;p&gt;å°½ç®¡å†…ç½®çš„ Kubernetes è‡ªåŠ¨ä¼¸ç¼©å™¨å¦‚ HPA å’Œ VPA æä¾›äº†åŸºæœ¬çš„æ‰©å±•èƒ½åŠ›ï¼Œä½†å®ƒä»¬åœ¨èŒƒå›´ä¸Šå¤©ç„¶æœ‰é™ã€‚å®ƒä»¬ä¸»è¦å…³æ³¨ CPU å’Œå†…å­˜æŒ‡æ ‡å¯èƒ½å¯¹äºç°ä»£åº”ç”¨æ¥è¯´æ˜¯ä¸€ä¸ªé‡å¤§é™åˆ¶ï¼Œå› ä¸ºè¿™äº›åº”ç”¨å¯èƒ½éœ€è¦å¯¹å„ç§æŒ‡æ ‡åšå‡ºååº”ï¼Œå…¶ä¸­ä¸€äº›ç”šè‡³å¯èƒ½ä¸æ˜¯æ¥è‡ªåº”ç”¨ç¨‹åºæœ¬èº«çš„æŒ‡æ ‡ã€‚&lt;/p&gt;
&lt;p&gt;ç°ä»£åº”ç”¨é¢ä¸´çš„å¼•äººæ³¨ç›®çš„æŒ‘æˆ˜ä¹‹ä¸€æ˜¯æ ¹æ®å¤–éƒ¨ç³»ç»Ÿçš„äº‹ä»¶æ¥è¿›è¡Œæ‰©å±•ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ¶ˆæ¯é˜Ÿåˆ—ï¼š&lt;/strong&gt; åº”ç”¨ç¨‹åºå¯èƒ½éœ€è¦æ ¹æ®é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æ•°é‡ï¼ˆå¦‚ RabbitMQ æˆ– Kafkaï¼‰æ¥è¿›è¡Œæ‰©å±•ã€‚å¦‚æœæœ‰å¤§é‡æœªå¤„ç†çš„æ¶ˆæ¯æ¶Œå…¥ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªæ‰©å±•çš„æŒ‡æ ‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®åº“è§¦å‘å™¨ï¼š&lt;/strong&gt; æ•°æ®åº“ä¸­çš„æ›´æ”¹æˆ–æ›´æ–°ï¼ˆå¦‚æŸä¸ªè¡¨çš„è¡Œçªç„¶å¢åŠ ï¼‰å¯èƒ½éœ€è¦å°†åº”ç”¨ç¨‹åºè¿›è¡Œæ‰©&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å±•ä»¥å¤„ç†æˆ–åˆ†ææ•°æ®çš„æ¶Œå…¥ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¤–éƒ¨ Webhookï¼š&lt;/strong&gt; æ¥è‡ªç¬¬ä¸‰æ–¹æœåŠ¡çš„ä¼ å…¥ Webhookï¼ˆä¾‹å¦‚ GitHub æ¨é€æˆ–ç”µå­å•†åŠ¡äº¤æ˜“äº‹ä»¶ï¼‰å¯èƒ½éœ€è¦æ›´å¤šçš„èµ„æºæ¥å¤„ç†é¢å¤–çš„è´Ÿè½½ã€‚&lt;/li&gt;
&lt;li&gt;â€&lt;strong&gt;IoT ä¿¡å·ï¼š&lt;/strong&gt; å¯¹äºè¿æ¥åˆ°ç‰©è”ç½‘è®¾å¤‡çš„åº”ç”¨ç¨‹åºï¼Œæ¥è‡ªè¿™äº›è®¾å¤‡çš„ä¿¡å·å¯èƒ½æ˜¯éœ€è¦æ‰©å±•çš„æŒ‡æ ‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ­¤å¤–ï¼Œè¿˜å­˜åœ¨å°†æ‰©å±•åˆ°é›¶çš„å¿…è¦æ¥æœ‰æ•ˆç®¡ç†èµ„æºçš„æƒ…å†µï¼Œæˆ–è€…å­˜åœ¨ä¸åŒæŒ‡æ ‡çš„ç»„åˆå†³å®šæ‰©å±•é€»è¾‘çš„æƒ…å†µï¼Œä¾‹å¦‚ CPU åˆ©ç”¨ç‡ä¸æ•°æ®åº“è¯»/å†™é€Ÿç‡ã€‚è¿™äº›å¾®å¦™çš„éœ€æ±‚çªæ˜¾äº†å†…ç½® Kubernetes è‡ªåŠ¨ä¼¸ç¼©å™¨çš„ä¸è¶³ä¹‹å¤„ã€‚â€&lt;/p&gt;
&lt;h3 id=&#34;hpa-çš„è‡ªå®šä¹‰æŒ‡æ ‡æ‰©å±•&#34;&gt;HPA çš„è‡ªå®šä¹‰æŒ‡æ ‡æ‰©å±•&lt;/h3&gt;
&lt;p&gt;Kubernetes å¼•å…¥äº†ä¸€ä¸ª&lt;a href=&#34;https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/#scaling-on-custom-metrics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è‡ªå®šä¹‰æŒ‡æ ‡&lt;/a&gt;çš„æ¥å£ï¼Œæ—¨åœ¨ä¸ºæ°´å¹³ Pod è‡ªåŠ¨ä¼¸ç¼©å™¨ï¼ˆHPAï¼‰æä¾›æ›´å¤šè¶…è¶Š CPU å’Œå†…å­˜æŒ‡æ ‡çš„é€‚åº”æ€§ã€‚ç„¶è€Œï¼Œå®é™…å®ç°ä¸­å‡ºç°äº†æŒ‘æˆ˜ã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡å¼ºå¤§ï¼Œä½†è‡ªå®šä¹‰æŒ‡æ ‡ API å¹¶ä¸ç›´è§‚æ˜“ç”¨ã€‚å®ƒè¦æ±‚å¯¹ Kubernetes å†…éƒ¨æœ‰è¯¦ç»†çš„äº†è§£ï¼Œä½¿è®¾ç½®å’Œè°ƒæ•´å˜å¾—ç¹çã€‚â€&lt;/p&gt;
&lt;h3 id=&#34;æ’æ›²prometheus-é€‚é…å™¨&#34;&gt;æ’æ›²ï¼šPrometheus é€‚é…å™¨&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/kubernetes-sigs/prometheus-adapter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus é€‚é…å™¨&lt;/a&gt;è¯•å›¾é€šè¿‡åˆ©ç”¨è‡ªå®šä¹‰æŒ‡æ ‡ API æ¥å¼¥åˆè¿™ä¸€å·®è·ï¼Œå¼•å…¥äº† Prometheus çš„å¹¿æ³›æŒ‡æ ‡ã€‚ä½†å®ƒä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼šå¤æ‚ã€ä¸ç›´è§‚çš„é…ç½®ä»¥åŠä»…ä¸ Prometheus æŒ‡æ ‡ç›¸å…³è”ã€‚å®æ–½å’Œç»´æŠ¤é…ç½®éœ€è¦ä¸æ–­çš„è­¦è§‰æ€§ã€‚åŸºç¡€æ¶æ„æˆ–åº”ç”¨ç¨‹åºçš„æ›´æ”¹å¯èƒ½ä¼šè§¦å‘é‡æ–°é…ç½®çš„éœ€æ±‚ã€‚&lt;/p&gt;
&lt;h3 id=&#34;4-ç™»åœº-kedaå¯¹å†³ä¸­çš„è‹±é›„&#34;&gt;4. ç™»åœº KEDAï¼šå¯¹å†³ä¸­çš„è‹±é›„&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://keda.sh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes äº‹ä»¶é©±åŠ¨è‡ªåŠ¨ä¼¸ç¼©ï¼ˆKEDAï¼‰&lt;/a&gt;ä¸ä»…ä¸ Kubernetes çš„è‡ªå®šä¹‰æŒ‡æ ‡ API é›†æˆï¼Œè¿˜ä½¿å…¶å˜å¾—æ›´åŠ å¯è®¿é—®ã€‚è¿™æ˜¯ç”¨æˆ·å‹å¥½ç•Œé¢å¦‚ä½•æ”¹å˜ä½“éªŒçš„è¯æ˜ï¼Œä½¿è‡ªåŠ¨ä¼¸ç¼©çœŸæ­£å…·æœ‰å¯å®šåˆ¶æ€§å’Œå¤šåŠŸèƒ½æ€§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;keda-çš„å¥½å¤„&#34;&gt;KEDA çš„å¥½å¤„&lt;/h3&gt;
&lt;p&gt;KEDA æä¾›äº†å¤šä¸ªæŠ€æœ¯ä¼˜åŠ¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;äº‹ä»¶é©±åŠ¨è‡ªåŠ¨ä¼¸ç¼©ï¼š&lt;/strong&gt; KEDA èƒ½å¤Ÿå“åº”ç‰¹å®šäº‹ä»¶ï¼Œç”šè‡³æ‰©å±•åˆ°é›¶ï¼Œç¡®ä¿èµ„æºå¾—åˆ°æ˜æ™ºåœ°ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ˜“äºä½¿ç”¨ï¼š&lt;/strong&gt; å…¶ç›´è§‚çš„é…ç½®ä½¿å®æ–½å˜å¾—è½»æ¾ï¼Œå…è®¸å¼€å‘äººå‘˜ä¸“æ³¨äºåº”ç”¨é€»è¾‘è€Œä¸æ˜¯é…ç½®è¯­æ³•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¹¿æ³›åº”ç”¨ï¼š&lt;/strong&gt; é™¤äº†ä»…æ‰©å±• Pod å¤–ï¼ŒKEDA è¿˜å¯ä»¥åŸºäºäº‹ä»¶å®‰æ’ Kubernetes ä½œä¸šï¼Œé€‚ç”¨äºä¸éœ€è¦æŒç»­è¿è¡Œä½†å¯èƒ½éœ€è¦å®šæœŸå¤§é‡èµ„æºçš„ä»»åŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šåŠŸèƒ½é›†æˆï¼š&lt;/strong&gt; æ”¯æŒå¤šç§èº«ä»½éªŒè¯æä¾›ç¨‹åºï¼Œé›†æˆ KEDA æ—¢ç®€å•åˆå®‰å…¨ã€‚â€&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;keda-åœ¨å®è·µä¸­çš„åº”ç”¨&#34;&gt;KEDA åœ¨å®è·µä¸­çš„åº”ç”¨&lt;/h3&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-keda-æ‰©å±•-kafka-consumer-åº”ç”¨ç¨‹åº&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;KEDA æ‰©å±• Kafka Consumer åº”ç”¨ç¨‹åº&#34; srcset=&#34;
               /blog/battle-of-the-pods-kubernetes-autoscaling-showdown-keda-vs-vanilla-kubernetes/3_hu18326824243340343863.webp 400w,
               /blog/battle-of-the-pods-kubernetes-autoscaling-showdown-keda-vs-vanilla-kubernetes/3_hu1655171237193676145.webp 760w,
               /blog/battle-of-the-pods-kubernetes-autoscaling-showdown-keda-vs-vanilla-kubernetes/3_hu14781047135494662203.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/battle-of-the-pods-kubernetes-autoscaling-showdown-keda-vs-vanilla-kubernetes/3_hu18326824243340343863.webp&#34;
               width=&#34;760&#34;
               height=&#34;498&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      KEDA æ‰©å±• Kafka Consumer åº”ç”¨ç¨‹åº
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è™½ç„¶ä¼ ç»Ÿçš„æŒ‡æ ‡å¦‚ CPU å’Œå†…å­˜æä¾›äº†ä¸€äº›è§è§£ï¼Œä½†ç°å®ä¸–ç•Œçš„åº”ç”¨ç¨‹åºé€šå¸¸éœ€è¦æ›´ç²¾ç»†å’Œå¤šæ ·åŒ–çš„æŒ‡æ ‡æ¥è¿›è¡Œæœ‰æ•ˆçš„è‡ªåŠ¨ä¼¸ç¼©ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›è¦è€ƒè™‘çš„æƒ…æ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;äº‹ä»¶é©±åŠ¨åº”ç”¨ç¨‹åºï¼š&lt;/strong&gt; è€ƒè™‘ä¸€ä¸ªåŸºäº Kafka çš„è®¾ç½®ã€‚è™½ç„¶ CPU ä½¿ç”¨ç‡å¯èƒ½ä¿æŒç¨³å®šï¼Œä½†ä¼ å…¥ Kafka äº‹ä»¶çš„æ¿€å¢æ˜¯ç¡®å®šè´Ÿè½½çš„çœŸæ­£æŒ‡æ ‡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè‡ªåŠ¨ä¼¸ç¼©åº”è¯¥ç†æƒ³åœ°å¯¹å…¥ç«™äº‹ä»¶çš„é€Ÿç‡æˆ–æ¶ˆæ¯ç§¯å‹åšå‡ºå“åº”ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”µå­å•†åŠ¡äº¤æ˜“ï¼š&lt;/strong&gt; åœ¨ç”µå­å•†åŠ¡æ¡†æ¶ä¸­ï¼Œç‰¹æ®Šé”€å”®æ´»åŠ¨å¯èƒ½ä¼šå¯¼è‡´è®¢å•ç»“å¸æ¿€å¢ã€‚CPU å¯èƒ½ä¸å—å½±å“ï¼Œä½†çœŸæ­£çš„è´Ÿè½½å¯èƒ½æ˜¯æ•°æ®åº“é˜Ÿåˆ—ä¸­ç§¯ç´¯çš„æœªå¤„ç†è®¢å•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æµæ•°æ®ç®¡é“ï¼š&lt;/strong&gt; ä»å¹³å°ï¼ˆå¦‚ Apache Kafka æˆ– AWS Kinesisï¼‰å¤„ç†æ•°æ®æµçš„åº”ç”¨ç¨‹åºä¼šç»å†å¯å˜çš„æ•°æ®æµå…¥ç‡ã€‚åœ¨è¿™é‡Œï¼Œç›¸å…³çš„æŒ‡æ ‡å¯èƒ½æ˜¯å¤„ç†çš„ç§¯å‹æˆ–æ»åï¼Œè€Œä¸æ˜¯ CPU æˆ–å†…å­˜æ¶ˆè€—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Selenium æµ‹è¯•å·¥ä½œè€…ï¼š&lt;/strong&gt; åœ¨æŒç»­é›†æˆï¼ˆCIï¼‰æµæ°´çº¿ä¸­ï¼Œå½“æäº¤æ–°ä»£ç æ—¶ï¼Œå¯èƒ½ä¼šè§¦å‘ä¸€ç³»åˆ— Selenium æµ‹è¯•ã€‚è¿™é‡ŒçœŸæ­£çš„åº¦é‡æ ‡å‡†å¯èƒ½æ˜¯ç­‰å¾…æµ‹è¯•çš„é˜Ÿåˆ—ã€‚å¦‚æœæœ‰å¤§é‡ç­‰å¾…æµ‹è¯•çš„æµ‹è¯•å­˜åœ¨ç“¶é¢ˆï¼ŒåŸºäºè¿™ä¸ªé˜Ÿåˆ—æ¥è‡ªåŠ¨ä¼¸ç¼© Selenium å·¥ä½œè€…æ¯”ä»…ä»…è§‚å¯Ÿ CPU æˆ–å†…å­˜æŒ‡æ ‡æ›´æœ‰æ•ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;API é€Ÿç‡é™åˆ¶ï¼š&lt;/strong&gt; å¯¹äºå¤§é‡ä¾èµ–ç¬¬ä¸‰æ–¹ API ä¸”å…·æœ‰é€Ÿç‡é™åˆ¶çš„åº”ç”¨ç¨‹åºï¼Œæ¥è¿‘é€Ÿç‡é™åˆ¶å¯èƒ½æ˜¯éœ€è¦è¿›è¡Œä¼¸ç¼©çš„ä¿¡å·ã€‚ä¸å¯¹é€Ÿç‡é™åˆ¶é”™è¯¯çš„è¢«åŠ¨ååº”ä¸åŒï¼ŒåŸºäº API è°ƒç”¨é¢‘ç‡è¿›è¡Œä¸»åŠ¨ä¼¸ç¼©å¯ä»¥ç¡®ä¿æ“ä½œé¡ºåˆ©è¿›è¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™æ ·å¤šæ ·åŒ–çš„ç°å®åœºæ™¯å¼ºè°ƒäº†éœ€è¦ä¸€ç§å¤šåŠŸèƒ½çš„è‡ªåŠ¨ä¼¸ç¼©è§£å†³æ–¹æ¡ˆï¼Œèƒ½å¤Ÿç†è§£å¹¶å“åº”å¤šç§åº¦é‡æ ‡å‡†ã€‚KEDA å‡­å€Ÿå…¶çµæ´»æ€§å’Œé€‚åº”æ€§æœ‰æ•ˆåœ°åº”å¯¹äº†è¿™äº›æŒ‘æˆ˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;5-ç»“è®ºkeda-è‡ªåŠ¨ä¼¸ç¼©çš„æœªæ¥&#34;&gt;5. ç»“è®ºï¼šKEDA è‡ªåŠ¨ä¼¸ç¼©çš„æœªæ¥&lt;/h3&gt;
&lt;p&gt;å°½ç®¡ Kubernetes æ‹¥æœ‰åŸç”Ÿçš„è‡ªåŠ¨ä¼¸ç¼©å·¥å…·å¦‚ HPA å’Œ VPAï¼Œä»¥åŠåƒ Prometheus é€‚é…å™¨è¿™æ ·çš„æ‰©å±•ï¼Œä½†å®ƒä»¬é€šå¸¸ä¼´éšç€å¤æ‚æ€§ã€‚è€Œ KEDA æä¾›äº†ä¸€ä¸ªç®€å•çš„å¹³å°ï¼Œé€‚ç”¨äºå„ç§å„æ ·çš„è‡ªåŠ¨ä¼¸ç¼©éœ€æ±‚ã€‚å®ƒå¤„ç†äº‹ä»¶é©±åŠ¨çš„æ‰©å±•ï¼ŒåŒ…æ‹¬ç¼©å‡åˆ°é›¶ï¼Œè¿™æ˜¯ä¸€ä¸ªé‡å¤§ä¼˜åŠ¿ã€‚æ­¤å¤–ï¼Œè®¾ç½® KEDA æ›´åŠ ç®€å•ï¼Œå‡å°‘äº†ç”¨æˆ·åœ¨å¤„ç† Kubernetes è‡ªå®šä¹‰æŒ‡æ ‡æ—¶é€šå¸¸ä¼šé‡åˆ°çš„å…¸å‹éšœç¢ã€‚&lt;/p&gt;
&lt;p&gt;KEDA çš„æ´»è·ƒç¤¾åŒºè¯æ˜äº†å®ƒçš„å®ç”¨æ€§ã€‚å¯¹è¯¥é¡¹ç›®çš„å®šæœŸè´¡çŒ®ã€åƒ Kedify æˆ– Microsoft è¿™æ ·çš„ä¾›åº”å•†ä»¥åŠä¸æ–­å¢åŠ çš„&lt;a href=&#34;https://keda.sh/community/#end-users&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¼ä¸šé‡‡ç”¨&lt;/a&gt;æ˜¾ç¤ºå‡ºå®ƒåœ¨ Kubernetes ç”Ÿæ€ç³»ç»Ÿä¸­æ—¥ç›Šé‡è¦ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å¦‚ä½•ä½¿ç”¨ Calico æ„å»ºå’Œç®¡ç† Kubernetes Cluster Mesh</title>
      <link>https://cloudnativecn.com/blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/</link>
      <pubDate>Tue, 09 Jan 2024 08:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/</guid>
      <description>&lt;p&gt;Kubernetes æ˜¯æ„å»ºçµæ´»å¯æ‰©å±•åŸºç¡€è®¾æ–½ä»¥è¿è¡ŒåŠ¨æ€å·¥ä½œè´Ÿè½½çš„ä¼˜ç§€è§£å†³æ–¹æ¡ˆã€‚ç„¶è€Œï¼Œéšç€æˆ‘ä»¬çš„é›†ç¾¤æ‰©å±•ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé¢ä¸´åŒæ—¶æ‰©å±•å’Œç®¡ç†å¤šä¸ªé›†ç¾¤çš„ä¸å¯é¿å…æƒ…å†µã€‚è¿™ä¸ªæ¦‚å¿µå¯èƒ½ä¼šç»™æˆ‘ä»¬çš„æ—¥å¸¸å·¥ä½œè´Ÿè½½ç»´æŠ¤å¸¦æ¥å¾ˆå¤šå¤æ‚æ€§ï¼Œå¹¶å¢åŠ åœ¨æ‰€æœ‰ç¯å¢ƒä¸­ä¿æŒæ‰€æœ‰ç­–ç•¥å’ŒæœåŠ¡çš„æœ€æ–°æ€§çš„éš¾åº¦ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ&lt;a href=&#34;https://www.tigera.io/blog/using-calico-to-create-a-kubernetes-cluster-mesh-for-multi-cluster-environments/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é›†ç¾¤ç½‘æ ¼&lt;/a&gt; å¯ä»¥åœ¨è¿™äº›é›†ç¾¤ä¹‹é—´å»ºç«‹æ— ç¼çš„è¿æ¥ï¼Œå¹¶å°†å·¥ä½œè´Ÿè½½é›†æˆåˆ°ç»Ÿä¸€çš„ç½‘ç»œç¯å¢ƒä¸­ã€‚&lt;/p&gt;
&lt;p&gt;é›†ç¾¤ç½‘æ ¼æ˜¯è¿æ¥ç‹¬ç«‹ Kubernetes é›†ç¾¤å¹¶åœ¨ä¸åŒé›†ç¾¤ä¸­çš„èµ„æºä¹‹é—´æä¾›è¿æ¥æ€§çš„ç»ä½³æ–¹å¼ï¼Œä»¥æä¾›è¶…å‡ºå•ä¸ªé›†ç¾¤æƒ…å†µä¸‹å¯èƒ½çš„å®¹é”™æ€§å’Œé«˜å¯ç”¨æ€§ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†å¼•å¯¼ä½ å®Œæˆæ„å»ºå¤šé›†ç¾¤ç¯å¢ƒå¹¶å»ºç«‹é›†ç¾¤ç½‘æ ¼æ‰€éœ€çš„æ­¥éª¤ï¼Œåˆ©ç”¨ Calico Open Source çš„å¤šåŠŸèƒ½èƒ½åŠ›ã€‚æˆ‘ä»¬å°†æ¢è®¨ä¸åŒçš„æ–¹æ³•ï¼Œå¦‚é¡¶çº§æœºæ¶ (TOR) å’Œ overlayï¼Œä»¥å»ºç«‹é›†ç¾¤ç½‘æ ¼ï¼Œè§£å†³ä¸åŒç¯å¢ƒæå‡ºçš„ç‹¬ç‰¹ç½‘ç»œæŒ‘æˆ˜ã€‚è¿™æ˜¯å¯èƒ½çš„ï¼Œå› ä¸º Calico æä¾›äº†å»ºç«‹å¤šé›†ç¾¤ç¯å¢ƒçš„å¤šç§æ–¹æ³•ï¼Œçµæ´»é€‚åº”ä½ çš„ç½‘ç»œåŸºç¡€è®¾æ–½å’Œç‰¹å®šè¦æ±‚ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å°†ä»‹ç»å¦‚ä½•åŠ å…¥ DNS è¿é€šæ€§ä»¥å¢å¼ºé›†ç¾¤é—´é€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;éšç€ä½ çš„é›†ç¾¤ç½‘æ ¼ç¯å¢ƒæ‰©å±•ï¼Œæˆ‘ä»¬å°†è®¨è®ºæ¶‰åŠ&lt;a href=&#34;https://www.tigera.io/learn/guides/kubernetes-security/kubernetes-federation/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è”é‚¦&lt;/a&gt;å’Œä½¿ç”¨ Calico Enterprise è¿›è¡Œå¤šé›†ç¾¤ç®¡ç†çš„ä¸‹ä¸€æ­¥ï¼Œä»¥åŠæ¶‰åŠè”é‚¦é›†ç¾¤ã€‚æˆ‘ä»¬å°†å±•ç¤º Calico å¦‚ä½•æä¾›å¤šé›†ç¾¤ç®¡ç†å¹³é¢ï¼Œå…è®¸åœ¨é›†ç¾¤é—´æ— ç¼å®æ–½å®‰å…¨æ€§å’Œå¯è§‚æµ‹æ€§ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œæˆ‘ä»¬å°†æ¶‰åŠåˆ° Calico Enterprise è”é‚¦èº«ä»½å¦‚ä½•åœ¨&lt;a href=&#34;https://www.tigera.io/learn/guides/kubernetes-networking/kubernetes-multi-cluster/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¤šé›†ç¾¤&lt;/a&gt;ç¯å¢ƒä¸­å¼¥åˆå·®è·ï¼Œæä¾›ä¸€ç§ç»Ÿä¸€çš„æ–¹å¼æ¥å®šåˆ¶ç½‘ç»œç­–ç•¥ï¼Œå¯ä»¥å¼•ç”¨æ¥è‡ªä¸åŒé›†ç¾¤çš„èµ„æºå¹¶æ„å»ºè·¨é›†ç¾¤è¾¹ç•Œè´Ÿè½½å¹³è¡¡è¯·æ±‚çš„æœåŠ¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯é›†ç¾¤ç½‘æ ¼&#34;&gt;ä»€ä¹ˆæ˜¯é›†ç¾¤ç½‘æ ¼ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;é›†ç¾¤ç½‘æ ¼è¿æ¥äº†ä¸¤ä¸ªæˆ–å¤šä¸ªç‹¬ç«‹é›†ç¾¤å†…éƒ¨èµ„æºã€‚é€šå¸¸ï¼Œæ¯ä¸ª Kubernetes é›†ç¾¤å°†ä¸ºå†…éƒ¨èµ„æºåˆ†é…ç§æœ‰ IP åœ°å€ï¼Œé™¤éå°†&lt;strong&gt;èŠ‚ç‚¹ç«¯å£&lt;/strong&gt;æˆ–&lt;strong&gt;è´Ÿè½½å‡è¡¡å™¨&lt;/strong&gt;æœåŠ¡ä¸å®ƒä»¬å…³è”ï¼Œå¦åˆ™è¿™äº›èµ„æºå¯¹ä»»ä½•å¤–éƒ¨å®ä½“éƒ½ä¸å¯è§ã€‚ç„¶è€Œï¼Œå°†èµ„æºæš´éœ²ç»™æ‰€æœ‰äººå¯èƒ½ä¼šå¸¦æ¥å®‰å…¨é£é™©ï¼Œå¹¶ç ´åä½ åº”è¯¥ä¿æŒçš„&lt;a href=&#34;https://www.tigera.io/learn/guides/zero-trust/zero-trust-security/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é›¶ä¿¡ä»»å®‰å…¨&lt;/a&gt;å§¿æ€ï¼Œä»¥ä¿æŠ¤ä½ çš„ç¯å¢ƒã€‚æ­¤å¤–ï¼Œå®ƒå¯ä»¥é€šè¿‡å…è®¸æ¶æ„ç”¨æˆ·åˆ©ç”¨æ¼æ´å¹¶åœ¨å…³é”®æœåŠ¡ä¸­å æ®ç«‹è¶³ç‚¹æ¥å±åŠæ•´ä¸ªç¯å¢ƒã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å¤šé›†ç¾¤ç¯å¢ƒä¸­å»ºç«‹é›†ç¾¤ç½‘æ ¼æä¾›äº†ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œç”¨äºä¿ƒè¿›é›†ç¾¤ä¹‹é—´çš„ç›´æ¥é€šä¿¡ã€‚è¿™ç§é€šä¿¡å¯ä»¥é€šè¿‡æŒ‡å®šçš„é›†ç¾¤æœåŠ¡æˆ–ç§æœ‰ IP åœ°å€è¿›è¡Œï¼Œç¡®ä¿å¼ºå¤§è€Œå—æ§åˆ¶çš„äº¤äº’ï¼ŒåŒæ—¶å‡è½»äº†å°†å†…éƒ¨èµ„æºæš´éœ²ç»™æ›´å¹¿æ³›ç½‘ç»œçš„é£é™©ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¦‚ä½•æ„å»ºå¤šé›†ç¾¤ç¯å¢ƒå¹¶å»ºç«‹é›†ç¾¤ç½‘æ ¼&#34;&gt;å¦‚ä½•æ„å»ºå¤šé›†ç¾¤ç¯å¢ƒå¹¶å»ºç«‹é›†ç¾¤ç½‘æ ¼&lt;/h3&gt;
&lt;p&gt;ä»¥ä¸‹å›¾ç‰‡è¯´æ˜äº† Calico å¦‚ä½•åœ¨ä½ çš„é›†ç¾¤ä¹‹é—´å»ºç«‹é›†ç¾¤ç½‘æ ¼è¿æ¥ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/1_hu1714775106322988165.webp 400w,
               /blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/1_hu14397733527843732603.webp 760w,
               /blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/1_hu3158767459423501648.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/1_hu1714775106322988165.webp&#34;
               width=&#34;760&#34;
               height=&#34;466&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Calico æä¾›äº†ä¸åŒçš„æ–¹å¼ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™äº›æ–¹å¼æ¥æ„å»ºå¤šé›†ç¾¤ç¯å¢ƒï¼Œä»è€Œæä¾›äº†ä¸ä½ çš„ç½‘ç»œåŸºç¡€è®¾æ–½å’Œéœ€æ±‚ç›¸åŒ¹é…çš„çµæ´»æ€§ã€‚Calico æœ€å¥½çš„éƒ¨åˆ†æ˜¯ï¼Œåœ¨å°†ä¸¤ä¸ªé›†ç¾¤è¿æ¥åœ¨ä¸€èµ·åï¼Œå®ƒå°†è‡ªåŠ¨æä¾›é›†ç¾¤ç½‘æ ¼ï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨å®ƒä»¬çš„å†…éƒ¨é›†ç¾¤æœåŠ¡å’Œ IP åœ°å€å¼€å§‹åœ¨ä¸åŒçš„é›†ç¾¤ä¸­ä½¿ç”¨èµ„æºã€‚&lt;/p&gt;
&lt;h3 id=&#34;åœ¨æ‰å¹³ç½‘ç»œç¯å¢ƒä¸­çš„é›†ç¾¤ç½‘æ ¼&#34;&gt;åœ¨æ‰å¹³ç½‘ç»œç¯å¢ƒä¸­çš„é›†ç¾¤ç½‘æ ¼&lt;/h3&gt;
&lt;p&gt;é›†ç¾¤ç½‘æ ¼çš„é…ç½®å¯ä»¥æ ¹æ®åº•å±‚åŸºç¡€è®¾æ–½çš„ä¸åŒè€Œå˜åŒ–ï¼Œä½†å…¶åŸºæœ¬ç›®çš„ä¿æŒä¸å˜ï¼Œå®è´¨ä¸Šæ˜¯ç”¨äºå»ºç«‹ç‹¬ç«‹é›†ç¾¤ä¹‹é—´çš„è¿æ¥ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œåœ¨æˆ‘ä»¬çš„é›†ç¾¤çš„å‚ä¸èŠ‚ç‚¹é€šè¿‡å¹¿æ’­åŸŸç›´æ¥è¿æ¥çš„ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ æ’­å†…éƒ¨è·¯ç”±åˆ°å¤–éƒ¨å®ä½“çš„è·¯ç”±åè®®æ¥å¿«é€Ÿå»ºç«‹ä¸€ä¸ªç½‘æ ¼ã€‚è¿™å°†å…è®¸æˆ‘ä»¬å¹¿å‘Šå†…éƒ¨è·¯ç”±ï¼Œè€Œæ— éœ€é€šè¿‡&lt;strong&gt;èŠ‚ç‚¹ç«¯å£&lt;/strong&gt;æœåŠ¡å°†å®ƒä»¬æš´éœ²ç»™æˆ‘ä»¬çš„ç›®æ ‡æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹å›¾ç‰‡è¯´æ˜äº†æ‰å¹³ç½‘ç»œçš„å¸¸è§è®¾è®¡ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/2_hu967632242553420625.webp 400w,
               /blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/2_hu17811270883764521857.webp 760w,
               /blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/2_hu1814670850135416981.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/2_hu967632242553420625.webp&#34;
               width=&#34;358&#34;
               height=&#34;364&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è€ƒè™‘è§‚çœ‹æˆ‘ä»¬çš„è§†é¢‘ï¼Œ&lt;a href=&#34;https://www.youtube.com/watch?v=PefluN8YM9o&amp;amp;ab_channel=ProjectCalico&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ Calico å¼€æºè¿›è¡Œ Kubernetes çš„ BGP&lt;/a&gt;ï¼Œä»¥äº†è§£ä½¿ç”¨å…¨ç½‘æ ¼æ–¹æ³•éƒ¨ç½²é›†ç¾¤ç½‘æ ¼çš„å…¨é¢æ•™ç¨‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åœ¨ä¼ä¸šæˆ–äº‘ç½‘ç»œç¯å¢ƒä¸­çš„é›†ç¾¤ç½‘æ ¼&#34;&gt;åœ¨ä¼ä¸šæˆ–äº‘ç½‘ç»œç¯å¢ƒä¸­çš„é›†ç¾¤ç½‘æ ¼&lt;/h3&gt;
&lt;p&gt;åœ¨å¤æ‚çš„ç½‘ç»œç¯å¢ƒä¸­ï¼Œä¾‹å¦‚äº‘æˆ–ä¼ä¸šç½‘ç»œï¼Œå½¢æˆé›†ç¾¤çš„åŸºç¡€è®¾æ–½èµ„æºé€šå¸¸åˆ†ä¸ºå•ç‹¬çš„å¹¿æ’­åŸŸã€‚è¿™æ˜¯å› ä¸ºè¿™äº›åŸŸä¸­çš„æ¯ä¸ªå®ä½“éƒ½è¢«è¦æ±‚é€šè¿‡ç½‘å…³æ¥åˆ°è¾¾å…¶ç›®çš„åœ°ã€‚ä½†æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªé¢å¤–çš„è·³è·ƒï¼ˆç½‘å…³ï¼‰éœ€è¦äº†è§£æˆ‘ä»¬åœ¨ Kubernetes é›†ç¾¤ä¸­åˆ›å»ºçš„å†…éƒ¨é›†ç¾¤èµ„æºã€‚å› æ­¤ï¼Œç½‘å…³ä¼šä¸¢å¼ƒå‰å¾€è¿™äº›å†…éƒ¨èµ„æºçš„æ•°æ®åŒ…ï¼Œä½¿ç®€å•çš„è·¯ç”±æ–¹æ³•æ— æ³•æ»¡è¶³è¦æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹å›¾ç‰‡è¯´æ˜äº†å¤æ‚ç½‘ç»œç¯å¢ƒçš„å¸¸è§è®¾è®¡ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/3_hu14527019382589229471.webp 400w,
               /blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/3_hu1917702437854214796.webp 760w,
               /blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/3_hu3149951656747117663.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/3_hu14527019382589229471.webp&#34;
               width=&#34;579&#34;
               height=&#34;357&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ—¢ç„¶æˆ‘ä»¬çŸ¥é“äº†é—®é¢˜ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åˆ©ç”¨ Calico æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†åœ¨è¿™æ ·çš„ç¯å¢ƒä¸­å»ºç«‹é›†ç¾¤ç½‘æ ¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¡¶å±‚æœºæ¶ï¼ˆTORï¼‰&lt;/li&gt;
&lt;li&gt;overlay&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;tor-æ–¹æ³•æ¨è&#34;&gt;TOR æ–¹æ³•ï¼ˆæ¨èï¼‰&lt;/h4&gt;
&lt;p&gt;åœ¨ä¼ä¸šæˆ–äº‘ç¯å¢ƒä¸­ï¼Œèµ„æºé€šå¸¸é€šè¿‡ä¸­é—´ç½‘å…³äº’è¿ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬å»ºè®®æˆ‘ä»¬çš„å®¢æˆ·ä½¿ç”¨ TORï¼Œå› ä¸ºé€šè¿‡ä¸äº‘æä¾›å•†è‡ªåŠ¨å»ºç«‹è·¯ç”±ä¼ æ’­æœºåˆ¶æ¥ä½¿ä½ çš„é›†ç¾¤äº†è§£ä½ ç›‘ç®¡ä¸‹çš„æ‰€æœ‰äº‘èµ„æºï¼Œä»è€Œä½¿ä½ çš„é›†ç¾¤å…·å¤‡é«˜å¯ç”¨æ€§ã€‚è¿™ä¹Ÿåœ¨äº‘æä¾›å•†çš„åº•å±‚ç½‘ç»œåŸºç¡€è®¾æ–½ä¸Šå‘æŒ¥äº†ä½œç”¨ï¼Œä»è€Œä½¿ä½ çš„é›†ç¾¤åœ¨ç½‘ç»œåŸºç¡€è®¾æ–½çš„æ”¯æŒä¸‹å…·å¤‡é«˜å¯ç”¨æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾ä½ å¯ä»¥é…ç½®äº‘ç½‘å…³å¹¶å°†å…¶ä¸åƒ Calico è¿™æ ·çš„å¼ºå¤§çš„&lt;a href=&#34;https://www.tigera.io/learn/guides/kubernetes-networking/kubernetes-cni/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®¹å™¨ç½‘ç»œæ¥å£ï¼ˆCNIï¼‰&lt;/a&gt;é…å¯¹ï¼Œé‚£ä¹ˆä½ å¯ä»¥åˆ©ç”¨ BGP è·¯ç”±æ¥å»ºç«‹é›†ç¾¤ç½‘æ ¼ã€‚Calico BGP é›†æˆæä¾›äº†åŠ¨æ€è·¯ç”±ï¼Œå…è®¸ä½ å°†å†…éƒ¨ Pod å’Œé›†ç¾¤ IP è·¯ç”±ä¼ æ’­åˆ°ç½‘ç»œåŸºç¡€è®¾æ–½ä¸­çš„å…¶ä»–èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹å›¾ç‰‡è¯´æ˜äº†æ”¯æŒ BGP çš„äº‘ç¯å¢ƒçš„å¸¸è§è®¾è®¡ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/4_hu15022200272298689073.webp 400w,
               /blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/4_hu12518138062779718872.webp 760w,
               /blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/4_hu8335078202697362550.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/4_hu15022200272298689073.webp&#34;
               width=&#34;310&#34;
               height=&#34;452&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼ŒTORï¼ˆé¡¶å±‚æœºæ¶ï¼‰æé«˜äº†é«˜å¯ç”¨æ€§å’Œå®¹é”™æ€§ã€‚è¿™ç§æ–¹æ³•ä¼˜åŒ–äº†ç½‘ç»œæµé‡åˆ†å¸ƒï¼Œå‡è½»äº†å•ç‚¹æ•…éšœï¼Œå¹¶è¿›ä¸€æ­¥å¢å¼ºäº†ä½ çš„åŸºç¡€è®¾æ–½çš„å¯é æ€§å’Œå¼¹æ€§ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šè¦äº†è§£ä½¿ç”¨ TOR æ–¹æ³•éƒ¨ç½²é›†ç¾¤ç½‘æ ¼çš„è¯¦ç»†æŒ‡å—ï¼Œè¯·æŸ¥çœ‹&lt;a href=&#34;https://docs.tigera.io/calico/latest/networking/configuring/bgp#top-of-rack-tor&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ­¤å¤„&lt;/a&gt;çš„æ•™ç¨‹ã€‚&lt;/p&gt;
&lt;h4 id=&#34;ipip-overlay&#34;&gt;IPIP overlay&lt;/h4&gt;
&lt;p&gt;åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½æ— æ³•è®¿é—®ç½‘å…³ä»¥ä¿®æ”¹å…¶è®¾ç½®ï¼Œæˆ–è€…å®ƒå¯èƒ½ä¸æ”¯æŒ BGP å¯¹ç­‰è¿æ¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ IPIP overlay æ¥å°è£…æµå‘ç›®æ ‡é›†ç¾¤çš„æµé‡ã€‚overlay ç½‘ç»œå…è®¸ç½‘ç»œè®¾å¤‡åœ¨åº•å±‚ç½‘ç»œï¼ˆç§°ä¸ºåº•å±‚ï¼‰ä¸Šç›¸äº’é€šä¿¡ï¼Œè€Œåº•å±‚ç½‘ç»œä¸éœ€è¦äº†è§£è¿æ¥åˆ° overlay ç½‘ç»œçš„è®¾å¤‡ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šå¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äº overlay ç½‘ç»œçš„ä¿¡æ¯ï¼Œè¯·å•å‡»&lt;a href=&#34;https://docs.tigera.io/calico/latest/about/kubernetes-training/about-networking#overlay-networks&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ­¤å¤„&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&#34;vxlan-overlay-calico-enterprise&#34;&gt;VXLAN overlay (Calico Enterprise)&lt;/h4&gt;
&lt;p&gt;å³å°†å‘å¸ƒçš„ Calico Enterpriseï¼ˆ3.18+ï¼‰ç‰ˆæœ¬å°†åœ¨å¤šé›†ç¾¤ç¯å¢ƒä¸‹å¯ç”¨ VXLAN ç½‘ç»œã€‚è¿™ç§æ–¹æ³•çš„ä¸€ä¸ªæ˜¾è‘—ä¼˜åŠ¿ä¹‹ä¸€æ˜¯èƒ½å¤Ÿä½¿ç”¨èº«ä»½æ„ŸçŸ¥ç­–ç•¥æ¥ä¿æŠ¤è·¨é›†ç¾¤çš„æµé‡ï¼ˆä½ å°†åœ¨æ¥ä¸‹æ¥çš„è”é‚¦éƒ¨åˆ†äº†è§£æœ‰å…³æ­¤åŠŸèƒ½çš„ä¿¡æ¯ï¼‰ã€‚é€šè¿‡å…¶å¤šé›†ç¾¤ç½‘ç»œåŠŸèƒ½ï¼ŒCalico Enterprise è‡ªåŠ¨æ‰©å±• overlay ç½‘ç»œï¼Œä»¥åœ¨é›†ç¾¤ä¹‹é—´å»ºç«‹ Pod IP è·¯ç”±ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä½¿ç”¨ VXLAN çš„ Calico Enterprise é›†ç¾¤ç½‘æ ¼è®¾ç½®ä¸­ï¼Œæ¯ä¸ªé›†ç¾¤éƒ½å……å½“æœ¬åœ°é›†ç¾¤å’Œè¿œç¨‹é›†ç¾¤ï¼Œæœ¬åœ°é›†ç¾¤é…ç½®ä¸ºä»è¿œç¨‹é›†ç¾¤çš„åŠ å¯†é€šé“ä¸­æ£€ç´¢ç«¯ç‚¹å’Œè·¯ç”±æ•°æ®ã€‚VXLAN é›†ç¾¤ç½‘æ ¼æä¾›äº†ä¸€ç§å®‰å…¨ã€å¯æ‰©å±•å’Œé«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆï¼Œç”¨äºç®¡ç†å¤šé›†ç¾¤ç½‘ç»œï¼Œå®ç°äº†è·¨é›†ç¾¤çš„æ— ç¼é€šä¿¡å’Œèº«ä»½æ„ŸçŸ¥ç­–ç•¥å¼ºåˆ¶æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šå¦‚æœä½ æƒ³äº†è§£æœ‰å…³ VXLAN overlay çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å•å‡»&lt;a href=&#34;https://www.tigera.io/news/tigera-introduces-powerful-enhancements-to-calico-open-source-and-calico-cloud-to-elevate-security-scalability-and-performance/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ­¤å¤„&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹å›¾ç‰‡è¯´æ˜äº†æ²¡æœ‰ BGP èƒ½åŠ›çš„äº‘ç¯å¢ƒçš„å¸¸è§è®¾è®¡ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/5_hu9781146334230845649.webp 400w,
               /blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/5_hu656800191488018043.webp 760w,
               /blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/5_hu12539663424339541766.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/5_hu9781146334230845649.webp&#34;
               width=&#34;353&#34;
               height=&#34;445&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šè¦äº†è§£ä½¿ç”¨ TOR æ–¹æ³•éƒ¨ç½²é›†ç¾¤ç½‘æ ¼çš„å…¨é¢æŒ‡å—ï¼Œè¯·æŸ¥çœ‹&lt;a href=&#34;https://youtu.be/rv-DnExi6SM?t=2287&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ­¤æ•™ç¨‹&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;dns-è¿æ¥&#34;&gt;DNS è¿æ¥&lt;/h3&gt;
&lt;p&gt;åœ¨å»ºç«‹å¤šé›†ç¾¤ä¹‹åï¼Œå„ä¸ªé›†ç¾¤å¯ä»¥åœ¨ IP çº§åˆ«è¿›è¡Œé€šä¿¡ã€‚ç„¶è€Œï¼Œæ ¹æ®ä½ çš„ç½‘ç»œè§„æ¨¡ä»¥åŠ Kubernetes IP åœ°å€çš„æ€§è´¨ï¼Œè¿™äº›åœ°å€å¯ä»¥éšæ—¶åŠ¨æ€æ›´æ”¹ï¼Œå› æ­¤ä½ éœ€è¦å®ç°ä¸€ç§æ›´å®¹æ˜“å»ºç«‹è¿™äº›é›†ç¾¤ä¹‹é—´è¿æ¥çš„æ–¹å¼ã€‚åŸŸåè§£æå¯ä»¥æˆä¸ºä½ çš„é›†ç¾¤ç½‘æ ¼çš„é‡è¦è¡¥å……ï¼Œå…è®¸æ›´å®¹æ˜“è¿›è¡Œé›†ç¾¤é—´é€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å¤§å¤šæ•° Kubernetes éƒ¨ç½²ä¸­ï¼ŒCoreDNS ä½œä¸ºè´Ÿè´£è§£æé›†ç¾¤åŸŸåçš„ä¸»è¦å·¥ä½œè´Ÿè½½ã€‚è¦å°† DNS ä¸é›†ç¾¤ç½‘æ ¼æ— ç¼é›†æˆï¼Œåªéœ€å¯¹ CoreDNS é…ç½®æ˜ å°„è¿›è¡Œç®€å•çš„ä¿®æ”¹å³å¯ã€‚å…·ä½“æ¥è¯´ï¼Œä½ éœ€è¦å°†å…¶ä»–é›†ç¾¤çš„ CoreDNS å†…éƒ¨æœåŠ¡ IP æ·»åŠ ä¸ºè½¬å‘å™¨åˆ°ä½ çš„é…ç½®ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªç®€å•çš„è°ƒæ•´ä½¿ä½ çš„é›†ç¾¤èƒ½å¤Ÿé€šè¿‡å‘å…¶ä»–é›†ç¾¤å‘é€æŸ¥è¯¢æ¥è§£æåç§°ï¼Œå¹¶æ£€ç´¢æ‰€éœ€èµ„æºçš„ç›¸åº” IP åœ°å€ã€‚è¿™ç§é›†æˆå¤§å¤§ç®€åŒ–äº†é›†ç¾¤ç½‘æ ¼å†…çš„é€šä¿¡ï¼Œå¢å¼ºäº†æ•´ä½“è¿é€šæ€§ï¼Œå¹¶æé«˜äº†ç®¡ç†æ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šè€ƒè™‘è§‚çœ‹&lt;a href=&#34;https://youtu.be/rv-DnExi6SM?t=2574&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ­¤è§†é¢‘&lt;/a&gt;ä»¥äº†è§£æœ‰å…³ DNS è¿æ¥çš„å…¨é¢æ•™ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è”é‚¦å’Œå¤šé›†ç¾¤ç®¡ç†ä¸‹ä¸€æ­¥&#34;&gt;è”é‚¦å’Œå¤šé›†ç¾¤ç®¡ç†ï¼ˆä¸‹ä¸€æ­¥ï¼‰&lt;/h2&gt;
&lt;p&gt;éšç€ä½ çš„ç¯å¢ƒæ‰©å±•ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°å¤šä¸ªå›¢é˜Ÿå¿…é¡»åŒæ—¶åœ¨æ‰€æœ‰é›†ç¾¤ä¸Šå·¥ä½œçš„æƒ…å†µã€‚å¤šé›†ç¾¤ç®¡ç†ï¼ˆMCMï¼‰é€šå¸¸è§£å†³çš„ä¸€ä¸ªå¸¸è§é—®é¢˜æ˜¯ä»¥é›†ä¸­çš„æ–¹å¼å¤„ç†æ¥è‡ªä¸åŒé›†ç¾¤çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬ç½‘ç»œç­–ç•¥ã€Podã€&lt;a href=&#34;https://www.tigera.io/learn/guides/kubernetes-security/kubernetes-compliance/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åˆè§„æ€§&lt;/a&gt;æŠ¥å‘Šã€å¯è§‚æµ‹æ€§å’Œå®‰å…¨æ—¥å¿—ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶ä»æŠ€æœ¯ä¸Šè®²ï¼Œå¯ä»¥é€šè¿‡ kubectl ä¸ºæ¯ä¸ªé›†ç¾¤æ‰‹åŠ¨åˆ›å»ºç­–ç•¥ã€ç½‘ç»œé›†å’Œå…¶ä»–èµ„æºï¼Œä½†è¿™ç§æ–¹æ³•ä¼šåœ¨ä½ çš„æ—¥å¸¸ç»´æŠ¤ä»»åŠ¡ä¸­å¼•å…¥ç›¸å½“å¤æ‚æ€§ï¼Œå¹¶å¯èƒ½ä¸ºæ„å¤–çš„å‡­æ®æ³„æ¼å¼€è¾Ÿä¸€æ¡é€”å¾„ã€‚æ­¤å¤–ï¼Œä¸æˆ‘ä»¬åœ¨å‰ä¸€èŠ‚ä¸­æ¢è®¨çš„ç±»ä¼¼ï¼Œå®ƒåæ˜ äº†æ²¡æœ‰è‰¯å¥½ç»“æ„çš„å¤šé›†ç¾¤ç¯å¢ƒæ‰€é¢ä¸´çš„æŒ‘æˆ˜ï¼Œç‰¹åˆ«æ˜¯åœ¨é›†ç¾¤ç®¡ç†ã€ç½‘ç»œã€æ•…éšœæ’é™¤å’Œå¯è§‚æµ‹æ€§æ–¹é¢ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨-calico-enterprise-è¿›è¡Œå¤šé›†ç¾¤ç®¡ç†&#34;&gt;ä½¿ç”¨ Calico Enterprise è¿›è¡Œå¤šé›†ç¾¤ç®¡ç†&lt;/h3&gt;
&lt;p&gt;Calico Enterprise æä¾›äº†ä¸€ä¸ª MCM å¹³é¢ï¼Œé€šè¿‡åœ¨è¿™äº›é›†ç¾¤ä¹‹é—´å»ºç«‹å®‰å…¨è¿æ¥ï¼Œå®ç°äº†å¤šé›†ç¾¤çš„å®‰å…¨å’Œå¯è§‚æµ‹æ€§ã€‚è¯¥æ¶æ„è¿˜æ”¯æŒè·¨é›†ç¾¤è”é‚¦&lt;a href=&#34;https://www.tigera.io/learn/guides/kubernetes-security/kubernetes-network-policy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç½‘ç»œç­–ç•¥&lt;/a&gt;èµ„æºï¼Œå¹¶ä¸ºçœŸæ­£çš„é›†ä¸­å¼ç®¡ç†ã€å¯è§‚æµ‹æ€§å’Œé›†ç¾¤ç»´æŠ¤å¥ å®šäº†åŸºç¡€ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹å›¾åƒæ˜¯åˆ—å‡ºæ‰€æœ‰å·²è¿æ¥é›†ç¾¤çš„ MCM é¡µé¢çš„ç¤ºä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/6_hu89478033148328707.webp 400w,
               /blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/6_hu7397803450086093900.webp 760w,
               /blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/6_hu11151254813731525729.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/6_hu89478033148328707.webp&#34;
               width=&#34;760&#34;
               height=&#34;237&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;MCM çš„å®‰å…¨åŠŸèƒ½ä¸ä»…é™äºé›†ç¾¤çš„ç½‘ç»œæ–¹é¢ã€‚ç”±äº MCM å®Œå…¨é›†æˆäº† Kubernetes åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰ï¼Œä½ å¯ä»¥åˆ¶å®šæˆæƒï¼Œå…è®¸ç”¨æˆ·ä»…æŸ¥çœ‹ä»–ä»¬éœ€è¦æŸ¥çœ‹çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šä½¿ç”¨&lt;a href=&#34;https://www.tigera.io/tutorials/?_sft_tutorial_product=calico-enterprise&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™ä¸ª&lt;/a&gt;å®é™…æ“ä½œçš„å·¥ä½œåŠæ¥äº†è§£æ›´å¤šå…³äºå¤šé›†ç¾¤ç®¡ç†çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åˆ©ç”¨-calico-enterprise-çš„è”é‚¦èº«ä»½å’Œç»Ÿä¸€ç­–ç•¥æ‰§è¡Œ&#34;&gt;åˆ©ç”¨ Calico Enterprise çš„è”é‚¦èº«ä»½å’Œç»Ÿä¸€ç­–ç•¥æ‰§è¡Œ&lt;/h3&gt;
&lt;p&gt;Calico Enterprise è”é‚¦å°†å·¥ä½œè´Ÿè½½å’ŒæœåŠ¡ç«¯ç‚¹ä¸åœ¨é›†ç¾¤ä¹‹é—´å…±äº«çš„å”¯ä¸€èº«ä»½å…³è”èµ·æ¥ã€‚&lt;/p&gt;
&lt;p&gt;è”é‚¦èº«ä»½å¯ä»¥ä¸ç½‘ç»œå®‰å…¨ç­–ç•¥å…³è”ï¼Œä»¥åˆ›å»ºå¼•ç”¨ä½äºä¸åŒé›†ç¾¤ä¸­çš„ç«¯ç‚¹çš„å”¯ä¸€èµ„æºï¼Œä»è€Œå®ç°å¯¹é›†ç¾¤é—´å®‰å…¨çš„æ— ç¼æ§åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œé€šè¿‡è”é‚¦æœåŠ¡ï¼Œä½ å¯ä»¥å‘ç°å¹¶ä¸ä½äºä¸åŒé›†ç¾¤ä¸­çš„è¿œç¨‹ Pod äº’åŠ¨ã€‚è¿™ä¸¤ä¸ªå…³é”®åŠŸèƒ½ä½¿å¾—å¯ä»¥åˆ›å»ºç²¾ç¡®ã€ç»†ç²’åº¦çš„å®‰å…¨æ§åˆ¶ï¼ŒåŠ å¼ºäº†è·¨å¤šä¸ªé›†ç¾¤çš„æ•´ä½“å®‰å…¨å§¿æ€ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/7_hu14119038410928012322.webp 400w,
               /blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/7_hu17653289768340331763.webp 760w,
               /blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/7_hu16145022243233993411.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/what-is-a-kubernetes-cluster-mesh-and-what-are-the-benefits/7_hu14119038410928012322.webp&#34;
               width=&#34;760&#34;
               height=&#34;325&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é€šè¿‡å®æ–½è”é‚¦å±‚å’Œç­–ç•¥ï¼Œä½ å¯ä»¥çµæ´»åœ°å®šä¹‰ç½‘ç»œå®‰å…¨ç­–ç•¥ï¼Œè¿™äº›ç­–ç•¥å¯ä»¥æ™®éé€‚ç”¨äºæ‰€æœ‰é›†ç¾¤ï¼Œä¹Ÿå¯ä»¥ä¸“é—¨é’ˆå¯¹ä¸€ç»„å®šä¹‰çš„é›†ç¾¤ã€‚è¿™ç§æ–¹æ³•æä¾›äº†ä¸€ç§æœ‰æ•ˆçš„æ‰‹æ®µï¼Œä»¥åœ¨æ‰©å±•éƒ¨ç½²ä»¥åŒ…æ‹¬å¤šä¸ªé›†ç¾¤çš„åŒæ—¶æ‰©å±•å®‰å…¨æªæ–½ã€‚é€šè¿‡å°†è¿™äº›å®‰å…¨æ§åˆ¶æ‰©å±•åˆ°ç°æœ‰å’Œæ–°çš„é›†ç¾¤ï¼Œä½ æœ‰æ•ˆåœ°å‡å°‘äº†ç­–ç•¥çš„é‡å¤å’Œç®€åŒ–äº†ä»åˆ›å»ºåˆ°ç»´æŠ¤çš„æ•´ä¸ªè¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h2&gt;
&lt;p&gt;æ€»ç»“ä¸€ä¸‹ï¼Œé›†ç¾¤ç½‘æ ¼è¿æ¥ä¸åŒ Kubernetes é›†ç¾¤ä¸­çš„å†…éƒ¨èµ„æºã€‚Calico çš„çµæ´»é›†ç¾¤ç½‘æ ¼è®¾ç½®ä¸ºåœ¨ä»»ä½•ç¯å¢ƒä¸­è¿æ¥åˆ°å¤šä¸ªé›†ç¾¤æä¾›äº†æ„å»ºå—ã€‚&lt;/p&gt;
&lt;p&gt;Calico Enterprise MCMã€è”é‚¦å’Œè”é‚¦ç­–ç•¥å¼ºåˆ¶æ‰§è¡Œæˆä¸ºå¤šé›†ç¾¤æ¶æ„çš„ç¼ºå¤±ç¯èŠ‚ï¼Œå…è®¸æ— ç¼é€šä¿¡ï¼ŒåŒæ—¶ä¼˜å…ˆè€ƒè™‘å®‰å…¨æ€§ã€‚Calico åœ¨è¿™ä¸ªé¢†åŸŸçš„èƒ½åŠ›ä½¿ä½ èƒ½å¤Ÿæ— ç¼æä¾›å¤šé›†ç¾¤ç®¡ç†ã€å¯è§‚æµ‹æ€§ã€è”é‚¦æœåŠ¡å’Œèº«ä»½ï¼Œä»è€Œä½¿ä½ çš„ç»„ç»‡èƒ½å¤Ÿè‡ªä¿¡è€Œé«˜æ•ˆåœ°åº”å¯¹ç°ä»£ç½‘ç»œçš„å¤æ‚æ€§ã€‚éšç€ç»„ç»‡çš„ç»§ç»­æ‰©å±•å’Œæ‰©å¤§è§„æ¨¡ï¼Œæ•´åˆè¿™äº›ç­–ç•¥å°†åœ¨å¡‘é€ å¤šé›†ç¾¤ç¯å¢ƒçš„æœªæ¥ä¸­å‘æŒ¥å…³é”®ä½œç”¨ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes åœ¨è£¸æœºä¸Šæ¯”è™šæ‹Ÿæœºè¡¨ç°æ›´å¥½å—ï¼šKubernetes æ€§èƒ½å¯¹æ¯”å®éªŒ</title>
      <link>https://cloudnativecn.com/blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/</link>
      <pubDate>Mon, 18 Dec 2023 14:30:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ªï¼š&lt;a href=&#34;https://thenewstack.io/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://thenewstack.io/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ‘˜è¦ï¼šæœ¬æ–‡å¯¹æ¯”äº†è™šæ‹Ÿæœºå’Œè£¸æœºä¸Š Kubernetes é›†ç¾¤çš„ CPUã€RAMã€å­˜å‚¨å’Œç½‘ç»œæ€§èƒ½çš„è¯¦ç»†æ¯”è¾ƒã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;è®¸å¤šäººè®¤ä¸ºéƒ¨ç½²åœ¨è£¸æœºä¸Šçš„ Kubernetes é›†ç¾¤æ¯”éƒ¨ç½²åœ¨è™šæ‹Ÿæœºä¸Šçš„æ€§èƒ½æ›´å¥½ï¼Œä½†ç›´åˆ°ç°åœ¨éƒ½æ²¡æœ‰å…³äºè¿™ä¸€å‡è®¾çš„è¯æ®ã€‚åœ¨ Gcoreï¼Œæˆ‘ä»¬åªæä¾›åŸºäºå……åˆ†è¯æ®çš„ä¿¡æ¯ç»™å®¢æˆ·ï¼Œå› æ­¤æˆ‘ä»¬å†³å®šè‡ªè¡Œæµ‹è¯• Kubernetes æ˜¯å¦åœ¨&lt;a href=&#34;https://thenewstack.io/bare-metal-in-a-cloud-native-world/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è£¸æœºä¸Š&lt;/a&gt;æ¯”åœ¨è™šæ‹Ÿæœºä¸Šè¡¨ç°æ›´å¥½ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œå·®è·æœ‰å¤šå¤§ã€‚æˆ‘å°†åˆ†äº«æˆ‘ä»¬å†…éƒ¨æµ‹è¯•çš„ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘æ•…æ„ä¸è®¨è®ºè™šæ‹ŸèŠ‚ç‚¹ä¸è£¸æœºèŠ‚ç‚¹ç«äº‰çš„å…¶ä»–æ–¹é¢ï¼Œå¦‚&lt;a href=&#34;https://gcore.com/blog/kubernetes-on-bare-metal/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆæœ¬æ•ˆç›Šæˆ–åŸºç¡€è®¾æ–½æ§åˆ¶çº§åˆ«&lt;/a&gt;ã€‚è¿™è¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ï¼Œæœ¬æ–‡åªå…³æ³¨æ€§èƒ½æ¯”è¾ƒã€‚&lt;/p&gt;
&lt;h2 id=&#34;vm-å’Œè£¸æœº-kubernetes-ä¹‹é—´çš„åŒºåˆ«&#34;&gt;VM å’Œè£¸æœº Kubernetes ä¹‹é—´çš„åŒºåˆ«&lt;/h2&gt;
&lt;p&gt;å½“æ‚¨åœ¨è™šæ‹Ÿæœºä¸Šéƒ¨ç½² Kubernetes é›†ç¾¤æ—¶ï¼Œä¸è£¸æœºï¼ˆBMï¼‰ç›¸æ¯”ï¼Œæ‚¨ä¼šå¾—åˆ°é¢å¤–çš„åŸºç¡€è®¾æ–½å±‚ï¼Œå³è™šæ‹Ÿæœºç›‘è§†å™¨å’Œå®¢æˆ·æ“ä½œç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æ˜¾ç¤ºè£¸æœºå’Œè™šæ‹Ÿæœºæ¶æ„å·®å¼‚çš„å›¾è¡¨&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æ˜¾ç¤ºè£¸æœºå’Œè™šæ‹Ÿæœºæ¶æ„å·®å¼‚çš„å›¾è¡¨&#34; srcset=&#34;
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/39ff19bc-image1a-e1700581613781_hu15883057500611356443.webp 400w,
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/39ff19bc-image1a-e1700581613781_hu4426442748305589303.webp 760w,
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/39ff19bc-image1a-e1700581613781_hu9013060151492115554.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/39ff19bc-image1a-e1700581613781_hu15883057500611356443.webp&#34;
               width=&#34;760&#34;
               height=&#34;331&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æ˜¾ç¤ºè£¸æœºå’Œè™šæ‹Ÿæœºæ¶æ„å·®å¼‚çš„å›¾è¡¨
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›¾ 1ï¼šè£¸æœºå’Œè™šæ‹Ÿæœºæ¶æ„çš„å·®å¼‚ã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›å±‚å ç”¨ç‰©ç† CPU å’Œ RAM æ¥è¿è¡Œï¼Œä»å·¥ä½œè´Ÿè½½ä¸­æ‹¿èµ°ä¸€äº›è®¡ç®—èƒ½åŠ›ã€‚è™šæ‹ŸåŒ–è¿˜ä¼šå½±å“ç½‘ç»œå’Œå­˜å‚¨æ€§èƒ½ï¼šè™šæ‹Ÿç½‘ç»œå’Œå­˜å‚¨æ¯”ç‰©ç†ç½‘ç»œå’Œå­˜å‚¨æ…¢ã€‚&lt;/p&gt;
&lt;p&gt;ç›¸æ¯”ä¹‹ä¸‹ï¼Œå½“æ‚¨åœ¨&lt;a href=&#34;https://thenewstack.io/provision-bare-metal-kubernetes-with-the-cluster-api/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è£¸æœºæœåŠ¡å™¨ä¸Šéƒ¨ç½² Kubernetes é›†ç¾¤&lt;/a&gt;æ—¶ï¼Œæ‚¨æ²¡æœ‰ä»»ä½•é¢å¤–çš„åŸºç¡€è®¾æ–½å±‚å’Œè™šæ‹ŸåŒ–ã€‚æœåŠ¡å™¨çš„ç‰©ç†èµ„æºå®Œå…¨ä¸“ç”¨äºæ‚¨çš„å·¥ä½œè´Ÿè½½ï¼Œå®¹å™¨åŒ–åº”ç”¨ç¨‹åºå¯ä»¥ç›´æ¥è®¿é—®è¿™äº›èµ„æºã€‚&lt;/p&gt;
&lt;h2 id=&#34;æˆ‘ä»¬å¦‚ä½•æ¯”è¾ƒè™šæ‹Ÿæœºå’Œè£¸æœº-k8s-æ€§èƒ½&#34;&gt;æˆ‘ä»¬å¦‚ä½•æ¯”è¾ƒè™šæ‹Ÿæœºå’Œè£¸æœº K8s æ€§èƒ½&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†å…¨é¢äº†è§£è™šæ‹Ÿæœºå’Œè£¸æœºé›†ç¾¤æ€§èƒ½çš„æ¯”è¾ƒï¼Œæˆ‘ä»¬æµ‹é‡äº†ä»¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;CPUï¼š&lt;/strong&gt; é€Ÿåº¦å’Œåˆ©ç”¨ç‡&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;RAMï¼š&lt;/strong&gt; å»¶è¿Ÿ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­˜å‚¨ï¼š&lt;/strong&gt; æ¯ç§’äº‹åŠ¡ï¼ˆTPSï¼‰å’Œå»¶è¿Ÿ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç½‘ç»œï¼š&lt;/strong&gt; å¸¦å®½å’Œå»¶è¿Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ºäº†ä¿æŒå·¥ä½œè´Ÿè½½çš„ä¸€è‡´æ€§ï¼Œæ‰€æœ‰æµ‹è¯•åº”ç”¨ç¨‹åºéƒ½ä»¥å®¹å™¨åŒ–æ–¹å¼éƒ¨ç½²åœ¨æ¯”è¾ƒçš„å·¥ä½œèŠ‚ç‚¹ä¸Šã€‚&lt;/p&gt;
&lt;h3 id=&#34;æˆ‘ä»¬çš„æµ‹è¯•æ¡ä»¶&#34;&gt;æˆ‘ä»¬çš„æµ‹è¯•æ¡ä»¶&lt;/h3&gt;
&lt;p&gt;åœ¨æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†è¿è¡Œåœ¨&lt;a href=&#34;https://gcore.com/cloud/managed-kubernetes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gcore æ‰˜ç®¡çš„ Kubernetes&lt;/a&gt;ä¸Šçš„ K8s é›†ç¾¤ã€‚ç„¶è€Œï¼Œç”±äºæ‰˜ç®¡çš„ Kubernetes ä¸ä¼šå¢åŠ å·¥ä½œèŠ‚ç‚¹æ€§èƒ½çš„ä»»ä½•å¼€é”€ï¼Œå› æ­¤è¿™äº›ç»“æœä¹Ÿä¸æ ‡å‡† Kubernetes ç›¸å…³ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ä¿æŒå·¥ä½œè´Ÿè½½çš„ç›¸åŒæ¡ä»¶ï¼Œæˆ‘ä»¬é€‰æ‹©äº†ç›¸ä¼¼çš„è™šæ‹Ÿæœºå’Œè£¸æœºå·¥ä½œèŠ‚ç‚¹çš„é…ç½®ã€‚ä»¥ä¸‹æ˜¯è¿™ç§æ¯”è¾ƒé…ç½®çš„ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è£¸æœºå·¥ä½œèŠ‚ç‚¹ï¼š&lt;/strong&gt; 1x Intel Xeon E-2388 8C/16T 3.2 GHz / 64 GB / Ubuntu 22.04&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è™šæ‹Ÿæœºå·¥ä½œèŠ‚ç‚¹ï¼š&lt;/strong&gt; 16 vCPU / 64 GiB å†…å­˜ / Ubuntu 22.04&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æµ‹è¯•ç»“æœæ‘˜è¦&#34;&gt;æµ‹è¯•ç»“æœæ‘˜è¦&lt;/h2&gt;
&lt;p&gt;åœ¨æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬æ¯”è¾ƒäº†ä¸¤ä¸ª Kubernetes é›†ç¾¤ï¼Œä¸€ä¸ªéƒ¨ç½²åœ¨è™šæ‹Ÿæœºï¼ˆVMsï¼‰ä¸Šï¼Œå¦ä¸€ä¸ªéƒ¨ç½²åœ¨è£¸æœºä¸Šã€‚å®ƒä»¬çš„é…ç½®ç›¸ä¼¼ã€‚ä½œä¸ºæµ‹è¯•å·¥ä½œè´Ÿè½½ï¼Œæˆ‘ä»¬è¿è¡Œäº†ä»¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨äº CPU æµ‹è¯•çš„ CPU åŸºå‡†æµ‹è¯•&lt;/li&gt;
&lt;li&gt;ç”¨äº RAM æµ‹è¯•çš„ Sysbench&lt;/li&gt;
&lt;li&gt;ç”¨äºå­˜å‚¨æµ‹è¯•çš„ Pgbench&lt;/li&gt;
&lt;li&gt;ç”¨äºç½‘ç»œæµ‹è¯•çš„ Netperf&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢æ˜¯æ€»ç»“æœ€é‡è¦çš„æµ‹è¯•ç»“æœçš„è¡¨æ ¼ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æµ‹è¯•ç»“æœè¡¨æ ¼&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æµ‹è¯•ç»“æœè¡¨æ ¼&#34; srcset=&#34;
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/417a03ef-summary1_hu7118314951676424900.webp 400w,
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/417a03ef-summary1_hu6673537408299442938.webp 760w,
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/417a03ef-summary1_hu7158908024045810663.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/417a03ef-summary1_hu7118314951676424900.webp&#34;
               width=&#34;760&#34;
               height=&#34;295&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æµ‹è¯•ç»“æœè¡¨æ ¼
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ˜¾ç„¶ï¼Œè£¸æœºé›†ç¾¤åœ¨æ‰€æœ‰æƒ…å†µä¸‹æ•ˆç‡æ›´é«˜ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬è¯¦ç»†æŸ¥çœ‹ç»“æœï¼Œå¹¶ç¡®å®šè£¸æœºæ€§èƒ½å¯¹æ‚¨çš„å·¥ä½œè´Ÿè½½æ„å‘³ç€ä»€ä¹ˆã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¯¦ç»†æµ‹è¯•ç»“æœ&#34;&gt;è¯¦ç»†æµ‹è¯•ç»“æœ&lt;/h2&gt;
&lt;p&gt;ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¯¦ç»†æŸ¥çœ‹æ¯ä¸ªè¯„ä¼°æ ‡å‡†ä¸‹è£¸æœºå’Œ VM é›†ç¾¤çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;cpu-é€Ÿåº¦å’Œåˆ©ç”¨ç‡&#34;&gt;CPU é€Ÿåº¦å’Œåˆ©ç”¨ç‡&lt;/h2&gt;
&lt;p&gt;å¯¹äº CPU é€Ÿåº¦æ¯”è¾ƒï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Alex Dedyura çš„ &lt;a href=&#34;https://github.com/alexdedyura/cpu-benchmark&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CPU åŸºå‡†æµ‹è¯•&lt;/a&gt;ã€‚è¿™æ˜¯ä¸€ä¸ªè®¡ç®—åˆ° 10,000 ä½å°æ•°çš„ pi çš„è„šæœ¬ã€‚ä»¥ç§’ä¸ºå•ä½çš„è®¡ç®—æ—¶é—´ï¼Œå¹³å‡å€¼åœ¨ 10 æ¬¡æµ‹è¯•ä¸­è¢«è§†ä¸ºæµ‹è¯•ç»“æœã€‚è®¡ç®— pi æ˜¯ä¸€ä¸ª CPU å¯†é›†å‹ä»»åŠ¡ï¼Œå› æ­¤è¯¥åŸºå‡†æµ‹è¯•æ¸…æ™°åœ°æ˜¾ç¤ºäº†è¢«æµ‹è¯• CPU çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯ CPU é€Ÿåº¦æ¯”è¾ƒçš„ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾è¡¨æ˜¾ç¤ºè£¸æœºé›†ç¾¤çš„-cpu-é€Ÿåº¦æ¯”è™šæ‹Ÿæœºé›†ç¾¤çš„-cpu-å¿«äº†ä¸¤å€å¤š&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾è¡¨æ˜¾ç¤ºï¼Œè£¸æœºé›†ç¾¤çš„ CPU é€Ÿåº¦æ¯”è™šæ‹Ÿæœºé›†ç¾¤çš„ CPU å¿«äº†ä¸¤å€å¤š&#34; srcset=&#34;
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/f35507b7-image3a_hu7590700065589710454.webp 400w,
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/f35507b7-image3a_hu9194157310494957751.webp 760w,
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/f35507b7-image3a_hu1951929181626291109.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/f35507b7-image3a_hu7590700065589710454.webp&#34;
               width=&#34;760&#34;
               height=&#34;334&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾è¡¨æ˜¾ç¤ºï¼Œè£¸æœºé›†ç¾¤çš„ CPU é€Ÿåº¦æ¯”è™šæ‹Ÿæœºé›†ç¾¤çš„ CPU å¿«äº†ä¸¤å€å¤š
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›¾ 3ï¼šè£¸æœºé›†ç¾¤çš„ CPU é€Ÿåº¦æ¯”è™šæ‹Ÿæœºé›†ç¾¤çš„ CPU å¿«äº†ä¸¤å€å¤šã€‚&lt;/p&gt;
&lt;p&gt;è™šæ‹Ÿæœºé›†ç¾¤çš„ 10 æ¬¡é‡è¯•çš„å¹³å‡æ—¶é—´ä¸º 47.07 ç§’ï¼›è€Œè£¸æœºé›†ç¾¤ä¸º 21.46 ç§’ã€‚å› æ­¤ï¼Œè£¸æœºé›†ç¾¤å¿«äº†ä¸¤å€å¤šã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯è™šæ‹Ÿæœºé›†ç¾¤çš„ CPU åˆ©ç”¨ç‡æµ‹è¯•ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å¹³å‡åˆ©ç”¨ç‡ä¸º-8681&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å¹³å‡åˆ©ç”¨ç‡ä¸º 86.81%&#34; srcset=&#34;
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/12670f56-image4a_hu13940636004228181467.webp 400w,
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/12670f56-image4a_hu10574852521258537534.webp 760w,
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/12670f56-image4a_hu5399063720231841400.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/12670f56-image4a_hu13940636004228181467.webp&#34;
               width=&#34;760&#34;
               height=&#34;162&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å¹³å‡åˆ©ç”¨ç‡ä¸º 86.81%
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›¾ 4ï¼šè™šæ‹Ÿæœºé›†ç¾¤çš„ CPU å¹³å‡åˆ©ç”¨ç‡ä¸º 86.81%ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-5è™šæ‹Ÿæœºé›†ç¾¤-cpu-çš„æ¯ä¸ªæ ¸å¿ƒä½¿ç”¨ä¿¡æ¯&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 5ï¼šè™šæ‹Ÿæœºé›†ç¾¤ CPU çš„æ¯ä¸ªæ ¸å¿ƒä½¿ç”¨ä¿¡æ¯&#34; srcset=&#34;
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/ef618156-image5a_hu8416017473154672443.webp 400w,
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/ef618156-image5a_hu15142550987573904795.webp 760w,
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/ef618156-image5a_hu8477653307649727971.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/ef618156-image5a_hu8416017473154672443.webp&#34;
               width=&#34;760&#34;
               height=&#34;83&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 5ï¼šè™šæ‹Ÿæœºé›†ç¾¤ CPU çš„æ¯ä¸ªæ ¸å¿ƒä½¿ç”¨ä¿¡æ¯
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›¾ 5ï¼šè™šæ‹Ÿæœºé›†ç¾¤ CPU çš„æ¯ä¸ªæ ¸å¿ƒä½¿ç”¨ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¸Šå›¾ 4 ä¸­ï¼Œçº¢è‰²ç‚¹è¡¨ç¤ºæœ€å¤§çš„ CPU æ ¸å¿ƒè´Ÿè½½*ï¼Œç»¿è‰²è¡¨ç¤ºæ‰€æœ‰æ ¸å¿ƒçš„æ€» CPU è´Ÿè½½ã€‚åœ¨æ‰§è¡Œè„šæœ¬æœŸé—´ï¼Œå¤§éƒ¨åˆ†æ—¶é—´å†…æ ¸å¿ƒéƒ½ä»¥ 100% çš„åˆ©ç”¨ç‡è¿è¡Œï¼›å¹³å‡å€¼ä¸º 86.81%ã€‚è¿˜æœ‰ä¸€ä¸ªå°çš„çªƒå–æ—¶é—´å³°å€¼ï¼Œå¤§çº¦åœ¨ 15:16ï¼ˆå‚è§å›¾ 4ï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªå¸¸è§æƒ…å†µï¼Œå½“ä¸€ä¸ªè™šæ‹Ÿæœºç”±äºç­‰å¾…ç‰©ç† CPU å…±äº«è®¡ç®—èµ„æºè€Œæ²¡æœ‰è¿è¡Œæ—¶ä¼šå‘ç”Ÿã€‚&lt;/p&gt;
&lt;p&gt;*&lt;strong&gt;æœ€å¤§ CPU æ ¸å¿ƒè´Ÿè½½ï¼š&lt;/strong&gt; è¿™ä¸ªæŒ‡æ ‡é€šå¸¸æ˜¯æŒ‡åœ¨è™šæ‹Ÿæœºå†…æˆ–ä¸»æœºä¸Šæ‰€æœ‰è™šæ‹Ÿæœºä¸­è§‚å¯Ÿåˆ°çš„å•ä¸ª CPU æ ¸å¿ƒçš„æœ€é«˜åˆ©ç”¨ç‡ç™¾åˆ†æ¯”ã€‚å®ƒè¡¨ç¤ºåœ¨ç»™å®šæ—¶åˆ»ä¸€ä¸ªç‰¹å®šçš„ CPU æ ¸å¿ƒæœ‰å¤šé‡åœ°è¢«åˆ©ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ€» CPU æ ¸å¿ƒè´Ÿè½½ï¼š&lt;/strong&gt; æ­¤æŒ‡æ ‡è¡¨ç¤ºä¸»æœºæœºå™¨ä¸Šæ‰€æœ‰å¯ç”¨ CPU æ ¸å¿ƒçš„æ•´ä½“ CPU åˆ©ç”¨ç‡ã€‚å®ƒè€ƒè™‘äº†æ‰€æœ‰ CPU æ ¸å¿ƒçš„ç»¼åˆä½¿ç”¨æƒ…å†µï¼Œæä¾›äº†è¿è¡Œåœ¨ä¸»æœºä¸Šçš„æ‰€æœ‰è™šæ‹Ÿæœºä½¿ç”¨äº†å¤šå°‘ CPU å®¹é‡çš„ç»¼åˆè§†å›¾ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯è£¸æœºé›†ç¾¤çš„ CPU åˆ©ç”¨ç‡æµ‹è¯•ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾è¡¨æ˜¾ç¤ºè£¸æœºé›†ç¾¤çš„-cpu-å¹³å‡åˆ©ç”¨ç‡ä¸º-4375&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾è¡¨æ˜¾ç¤ºï¼Œè£¸æœºé›†ç¾¤çš„ CPU å¹³å‡åˆ©ç”¨ç‡ä¸º 43.75%&#34; srcset=&#34;
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/d79f8453-image6a_hu12673580296188909068.webp 400w,
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/d79f8453-image6a_hu8368303906492050588.webp 760w,
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/d79f8453-image6a_hu6304644511949318152.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/d79f8453-image6a_hu12673580296188909068.webp&#34;
               width=&#34;760&#34;
               height=&#34;160&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾è¡¨æ˜¾ç¤ºï¼Œè£¸æœºé›†ç¾¤çš„ CPU å¹³å‡åˆ©ç”¨ç‡ä¸º 43.75%
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›¾ 6ï¼šè£¸æœºé›†ç¾¤çš„ CPU å¹³å‡åˆ©ç”¨ç‡ä¸º 43.75%ã€‚&lt;/p&gt;
&lt;p&gt;å¹³å‡ CPU è´Ÿè½½çº¦ä¸º 43.75%ï¼Œæœ€å¤§è´Ÿè½½ä¸º 62.57%ï¼Œæ²¡æœ‰çªƒå–æ—¶é—´ã€‚å› æ­¤ï¼Œå°± CPU æ€§èƒ½è€Œè¨€ï¼Œæµ‹è¯•æ˜¾ç¤ºè£¸æœºé›†ç¾¤çº¦ä¸ºè™šæ‹Ÿæœºé›†ç¾¤çš„ä¸¤å€æœ‰æ•ˆã€‚&lt;/p&gt;
&lt;h2 id=&#34;ram-å»¶è¿Ÿ&#34;&gt;RAM å»¶è¿Ÿ&lt;/h2&gt;
&lt;p&gt;å¯¹äº RAM æµ‹è¯•ï¼Œ&lt;a href=&#34;https://github.com/akopytov/sysbench&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æˆ‘ä»¬ä½¿ç”¨äº† sysbench&lt;/a&gt; å¹¶é€šè¿‡ RAM ä¼ è¾“äº† 6400 GB çš„æ•°æ®ã€‚ä»¥ä¸‹æ˜¯æ‰§è¡Œçš„å†™å…¥å’Œè¯»å–æ“ä½œçš„å…³é”®ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-7è£¸æœºé›†ç¾¤çš„-ram-å¤§çº¦æ¯”è™šæ‹Ÿæœºé›†ç¾¤çš„-ram-å¿«ä¸‰å€&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 7ï¼šè£¸æœºé›†ç¾¤çš„ RAM å¤§çº¦æ¯”è™šæ‹Ÿæœºé›†ç¾¤çš„ RAM å¿«ä¸‰å€&#34; srcset=&#34;
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/684e605e-7a_hu6234669188063511086.webp 400w,
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/684e605e-7a_hu14670826045507087730.webp 760w,
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/684e605e-7a_hu4791314928989275549.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/684e605e-7a_hu6234669188063511086.webp&#34;
               width=&#34;760&#34;
               height=&#34;355&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 7ï¼šè£¸æœºé›†ç¾¤çš„ RAM å¤§çº¦æ¯”è™šæ‹Ÿæœºé›†ç¾¤çš„ RAM å¿«ä¸‰å€
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›¾ 7ï¼šè£¸æœºé›†ç¾¤çš„ RAM å¤§çº¦æ¯”è™šæ‹Ÿæœºé›†ç¾¤çš„ RAM å¿«ä¸‰å€ã€‚&lt;/p&gt;
&lt;p&gt;è™šæ‹Ÿæœºé›†ç¾¤æ‰§è¡Œå†™å…¥æ“ä½œçš„å¹³å‡æ—¶é—´ä¸º 174.53 æ¯«ç§’ï¼Œè€Œè£¸æœºé›†ç¾¤ç›¸åŒæ“ä½œä»…éœ€ 62.02 æ¯«ç§’ã€‚è¯»å–æ“ä½œåˆ†åˆ«åœ¨ 173.75 å’Œ 47.33 æ¯«ç§’å†…å®Œæˆã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ„å‘³ç€è£¸æœºé›†ç¾¤çš„ RAM å¤§çº¦æ¯”è™šæ‹Ÿæœºé›†ç¾¤çš„ RAM å¿«ä¸‰å€ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å­˜å‚¨-tps-å’Œå»¶è¿Ÿ&#34;&gt;å­˜å‚¨ TPS å’Œå»¶è¿Ÿ&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†æµ‹è¯•å­˜å‚¨æ€§èƒ½ï¼Œæˆ‘ä»¬è¿è¡Œäº†ä¸€ä¸ª PostgreSQL é›†ç¾¤ï¼Œå¹¶ä½¿ç”¨äº† &lt;a href=&#34;https://www.postgresql.org/docs/current/pgbench.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;pgbench åŸºå‡†æµ‹è¯•&lt;/a&gt;ã€‚æˆ‘ä»¬æµ‹é‡äº† TPSï¼ˆæ¯ç§’äº‹åŠ¡æ•°ï¼‰å’Œå»¶è¿Ÿã€‚æˆ‘ä»¬è¿˜å˜åŒ–äº†å·¥ä½œè´Ÿè½½ï¼Œæµ‹è¯•äº†ç›¸åŒé›†ç¾¤é…ç½®ä¸‹çš„ 8 GB å’Œ 75 GB æ•°æ®åº“ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯è¿™äº›å®ä¾‹çš„é…ç½®ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-8å­˜å‚¨æµ‹è¯•çš„è£¸æœºå’Œè™šæ‹Ÿæœºé›†ç¾¤é…ç½®&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 8ï¼šå­˜å‚¨æµ‹è¯•çš„è£¸æœºå’Œè™šæ‹Ÿæœºé›†ç¾¤é…ç½®&#34; srcset=&#34;
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/87869729-image8a_hu9149180351891864535.webp 400w,
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/87869729-image8a_hu14613515769141181283.webp 760w,
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/87869729-image8a_hu17653871652178316450.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/87869729-image8a_hu9149180351891864535.webp&#34;
               width=&#34;760&#34;
               height=&#34;210&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 8ï¼šå­˜å‚¨æµ‹è¯•çš„è£¸æœºå’Œè™šæ‹Ÿæœºé›†ç¾¤é…ç½®
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›¾ 8ï¼šå­˜å‚¨æµ‹è¯•çš„è£¸æœºå’Œè™šæ‹Ÿæœºé›†ç¾¤é…ç½®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å­˜å‚¨-tps-ç»“æœ&#34;&gt;å­˜å‚¨ TPS ç»“æœ&lt;/h3&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯ TPS æ¯”è¾ƒçš„å¹³å‡ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-9è£¸æœºé›†ç¾¤çš„å­˜å‚¨-tps-å€¼å¤§çº¦æ˜¯è™šæ‹Ÿæœºé›†ç¾¤çš„ä¸¤å€&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 9ï¼šè£¸æœºé›†ç¾¤çš„å­˜å‚¨ TPS å€¼å¤§çº¦æ˜¯è™šæ‹Ÿæœºé›†ç¾¤çš„ä¸¤å€&#34; srcset=&#34;
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/7bda97df-image9a_hu4655470512185340449.webp 400w,
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/7bda97df-image9a_hu13346581987451801685.webp 760w,
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/7bda97df-image9a_hu1318709091714920028.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/7bda97df-image9a_hu4655470512185340449.webp&#34;
               width=&#34;760&#34;
               height=&#34;355&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 9ï¼šè£¸æœºé›†ç¾¤çš„å­˜å‚¨ TPS å€¼å¤§çº¦æ˜¯è™šæ‹Ÿæœºé›†ç¾¤çš„ä¸¤å€
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›¾ 9ï¼šè£¸æœºé›†ç¾¤çš„å­˜å‚¨ TPS å€¼å¤§çº¦æ˜¯è™šæ‹Ÿæœºé›†ç¾¤çš„ä¸¤å€ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿è¡Œ 8 GB æ•°æ®åº“æ—¶ï¼Œè™šæ‹Ÿæœºé›†ç¾¤æ˜¾ç¤ºäº† 7,359 TPSï¼Œè€Œè£¸æœºé›†ç¾¤ä¸º 14,087 TPSã€‚75 GB æ•°æ®åº“çš„æ€§èƒ½ç»“æœåˆ†åˆ«ä¸º 4,636 å’Œ 12,029 TPSã€‚&lt;/p&gt;
&lt;h3 id=&#34;å­˜å‚¨å»¶è¿Ÿç»“æœ&#34;&gt;å­˜å‚¨å»¶è¿Ÿç»“æœ&lt;/h3&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯å»¶è¿Ÿæµ‹è¯•çš„å¹³å‡ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾è¡¨æ˜¾ç¤º8-gb-æµ‹è¯•ä¸­è£¸æœºé›†ç¾¤çš„å­˜å‚¨å»¶è¿Ÿçº¦ä¸ºè™šæ‹Ÿæœºé›†ç¾¤çš„ä¸€åŠåœ¨-75-gb-æµ‹è¯•ä¸­å‡ ä¹æ˜¯å…¶ä¸‰å€&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾è¡¨æ˜¾ç¤ºï¼Œ8 GB æµ‹è¯•ä¸­è£¸æœºé›†ç¾¤çš„å­˜å‚¨å»¶è¿Ÿçº¦ä¸ºè™šæ‹Ÿæœºé›†ç¾¤çš„ä¸€åŠï¼Œåœ¨ 75 GB æµ‹è¯•ä¸­å‡ ä¹æ˜¯å…¶ä¸‰å€&#34; srcset=&#34;
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/311dd007-image10_hu17444463236007598524.webp 400w,
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/311dd007-image10_hu15242248684357858536.webp 760w,
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/311dd007-image10_hu1005150464826649085.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/311dd007-image10_hu17444463236007598524.webp&#34;
               width=&#34;760&#34;
               height=&#34;355&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾è¡¨æ˜¾ç¤ºï¼Œ8 GB æµ‹è¯•ä¸­è£¸æœºé›†ç¾¤çš„å­˜å‚¨å»¶è¿Ÿçº¦ä¸ºè™šæ‹Ÿæœºé›†ç¾¤çš„ä¸€åŠï¼Œåœ¨ 75 GB æµ‹è¯•ä¸­å‡ ä¹æ˜¯å…¶ä¸‰å€
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›¾ 10ï¼šè£¸æœºåœ¨å­˜å‚¨å»¶è¿Ÿæ–¹é¢ä¼˜äºè™šæ‹Ÿæœºã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿è¡Œ 8 GB æ•°æ®åº“æ—¶ï¼Œè™šæ‹Ÿæœºé›†ç¾¤çš„å»¶è¿Ÿä¸º 34.78 æ¯«ç§’ï¼Œè€Œè£¸æœºé›†ç¾¤çš„å»¶è¿Ÿä¸º 18.17 æ¯«ç§’ã€‚å¯¹äº 75 GB æ•°æ®åº“ï¼Œå»¶è¿Ÿåˆ†åˆ«ä¸º 55.21 æ¯«ç§’å’Œ 21.28 æ¯«ç§’ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äº 8 GB æ•°æ®åº“ï¼Œè£¸æœºé›†ç¾¤çš„å­˜å‚¨æ€§èƒ½çº¦ä¸ºè™šæ‹Ÿæœºé›†ç¾¤çš„ä¸¤å€ã€‚å¯¹äº 75 GB æ•°æ®åº“ï¼Œè£¸æœºé›†ç¾¤ç›¸å¯¹äºè™šæ‹Ÿæœºé›†ç¾¤çš„ä¼˜åŠ¿æ›´åŠ æ˜æ˜¾ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç½‘ç»œå¸¦å®½å’Œå»¶è¿Ÿ&#34;&gt;ç½‘ç»œå¸¦å®½å’Œå»¶è¿Ÿ&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†æµ‹è¯•ç½‘ç»œæ€§èƒ½ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† &lt;a href=&#34;https://github.com/kubernetes/perf-tests/tree/master/network/benchmarks/netperf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;netperf åŸºå‡†æµ‹è¯•&lt;/a&gt;ï¼Œå…¶ä¸­ MSSï¼ˆæœ€å¤§æ®µå¤§å°ï¼‰ä» 1 åˆ° 65,536 ä¸ç­‰ã€‚MSS ä¸­çš„â€œæ®µâ€å…ƒç´ æ˜¯åœ¨ç½‘ç»œä¸Šä¼ è¾“çš„ä¸€ç§ IP æ•°æ®åŒ…æ†ç»‘ã€‚å› æ­¤ï¼ŒMSS è¶Šå¤§ï¼Œä¼ è¾“çš„æµé‡å°±è¶Šå¤šã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨ä¸¤ä¸ªç‰©ç†èŠ‚ç‚¹ä¸Šéƒ¨ç½²äº†ä¸‰ä¸ªå·¥ä½œèŠ‚ç‚¹ï¼šWorker 1 å’Œ Worker 2 ä½äºç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œè€Œ Worker 3 ä½äºç¬¬äºŒä¸ªèŠ‚ç‚¹ä¸Šã€‚ç„¶åï¼Œæˆ‘ä»¬æµ‹è¯•äº†æ‰€æœ‰ä¸‰ä¸ªå·¥ä½œèŠ‚ç‚¹ä¹‹é—´çš„ç½‘ç»œæ€§èƒ½ã€‚åœ¨æ‰€æœ‰æƒ…å†µä¸‹ï¼Œç»“æœè¶‹åŠ¿éƒ½ç›¸ä¼¼ â€” è£¸æœºä¼˜äºè™šæ‹Ÿæœºã€‚&lt;/p&gt;
&lt;p&gt;æœ€æœ‰è¶£çš„æµ‹è¯•æ˜¯ç‰©ç†è·ç¦»æœ€è¿œçš„æµ‹è¯•ä¹‹ä¸€ï¼Œå³ Worker 1/Worker 2ï¼ˆä½äºç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼‰ä¸ Worker 3ï¼ˆä½äºç¬¬äºŒä¸ªèŠ‚ç‚¹ä¸Šï¼‰ä¹‹é—´çš„è·ç¦»ï¼Œå½“æµé‡åœ¨ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªç‰©ç†èŠ‚ç‚¹ä¹‹é—´ä¼ è¾“æ—¶ã€‚æˆ‘ä»¬å¯ä»¥å°†è¿™çœ‹ä½œæ˜¯æ‰€æœ‰æµ‹è¯•ä¸­æœ€å…·æŒ‘æˆ˜æ€§çš„æ¡ä»¶ã€‚å›¾ 10 å’Œå›¾ 11 æ˜¾ç¤ºäº†æ­¤æµ‹è¯•çš„ç»“æœã€‚å›¾ 10 æ˜¾ç¤ºäº† MSS å€¼ä¸º 1ã€2ã€4 å’Œ 8 æ—¶çš„ç½‘ç»œå¸¦å®½æ¯”è¾ƒï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-11è£¸æœºé›†ç¾¤çš„ç½‘ç»œå¸¦å®½æ¯”è™šæ‹Ÿæœºé›†ç¾¤çš„ç½‘ç»œå¸¦å®½å¤§äº”å€&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 11ï¼šè£¸æœºé›†ç¾¤çš„ç½‘ç»œå¸¦å®½æ¯”è™šæ‹Ÿæœºé›†ç¾¤çš„ç½‘ç»œå¸¦å®½å¤§äº”å€&#34; srcset=&#34;
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/4d53bfd2-image11_hu4326784236451675919.webp 400w,
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/4d53bfd2-image11_hu16763944113206073775.webp 760w,
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/4d53bfd2-image11_hu15909013285789106783.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/4d53bfd2-image11_hu4326784236451675919.webp&#34;
               width=&#34;760&#34;
               height=&#34;346&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 11ï¼šè£¸æœºé›†ç¾¤çš„ç½‘ç»œå¸¦å®½æ¯”è™šæ‹Ÿæœºé›†ç¾¤çš„ç½‘ç»œå¸¦å®½å¤§äº”å€
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›¾ 11ï¼šè£¸æœºé›†ç¾¤çš„ç½‘ç»œå¸¦å®½æ¯”è™šæ‹Ÿæœºé›†ç¾¤çš„ç½‘ç»œå¸¦å®½å¤§äº”å€ã€‚&lt;/p&gt;
&lt;p&gt;è™šæ‹Ÿæœºé›†ç¾¤çš„å¸¦å®½èŒƒå›´ä» MSS=1 æ—¶çš„ 862 KB/ç§’åˆ° MSS=8 æ—¶çš„ 6.52 MB/ç§’ï¼Œè€Œè£¸æœºé›†ç¾¤çš„å¸¦å®½åœ¨ç›¸åŒçš„ MSS å€¼èŒƒå›´å†…ä» 4.17 MB/ç§’åˆ° 31 MB/ç§’ä¸ç­‰ã€‚å¹³å‡è€Œè¨€ï¼Œè£¸æœºé›†ç¾¤çš„å¸¦å®½æ¯”è™šæ‹Ÿæœºé›†ç¾¤çš„å¸¦å®½å¤§äº”å€ã€‚&lt;/p&gt;
&lt;p&gt;å›¾ 12 æ˜¾ç¤ºäº†ä½¿ç”¨ç›¸åŒ MSS å€¼çš„ç½‘ç»œå»¶è¿Ÿæ¯”è¾ƒï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-12è£¸æœºé›†ç¾¤çš„ç½‘ç»œå»¶è¿Ÿæ¯”è™šæ‹Ÿæœºé›†ç¾¤çš„ç½‘ç»œå»¶è¿Ÿä½äº†å¤šè¾¾å…­å€&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 12ï¼šè£¸æœºé›†ç¾¤çš„ç½‘ç»œå»¶è¿Ÿæ¯”è™šæ‹Ÿæœºé›†ç¾¤çš„ç½‘ç»œå»¶è¿Ÿä½äº†å¤šè¾¾å…­å€&#34; srcset=&#34;
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/5f29719e-image12_hu3925527354444535559.webp 400w,
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/5f29719e-image12_hu10723088195961781842.webp 760w,
               /blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/5f29719e-image12_hu848740201447840396.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/does-kubernetes-really-perform-better-on-bare-metal-vs-vms/5f29719e-image12_hu3925527354444535559.webp&#34;
               width=&#34;760&#34;
               height=&#34;346&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 12ï¼šè£¸æœºé›†ç¾¤çš„ç½‘ç»œå»¶è¿Ÿæ¯”è™šæ‹Ÿæœºé›†ç¾¤çš„ç½‘ç»œå»¶è¿Ÿä½äº†å¤šè¾¾å…­å€
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›¾ 12ï¼šè£¸æœºé›†ç¾¤çš„ç½‘ç»œå»¶è¿Ÿæ¯”è™šæ‹Ÿæœºé›†ç¾¤çš„ç½‘ç»œå»¶è¿Ÿä½äº†å¤šè¾¾å…­å€ã€‚&lt;/p&gt;
&lt;p&gt;æ­£å¦‚æˆ‘ä»¬æ‰€è§ï¼Œå½“ä½¿ç”¨ MSS=8 æ—¶ï¼Œè™šæ‹Ÿæœºé›†ç¾¤çš„å»¶è¿Ÿçº¦ä¸º 145 å¾®ç§’ï¼ˆusï¼‰ï¼Œè€Œè£¸æœºçš„å»¶è¿Ÿä¸º 24.5 å¾®ç§’ã€‚æ­¤å¤–ï¼Œåœ¨è£¸æœºé›†ç¾¤çš„æƒ…å†µä¸‹ï¼Œéšç€ MSS çš„å¢åŠ ï¼Œå»¶è¿Ÿå¢é•¿è¾ƒæ…¢ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºæ‰€æœ‰æµ‹è¯•ï¼Œè¯·æ³¨æ„æˆ‘ä»¬æŠ¥å‘Šçš„æ˜¯&lt;em&gt;å†…éƒ¨&lt;/em&gt;é›†ç¾¤ç½‘ç»œçš„ç½‘ç»œæ€§èƒ½æ¯”è¾ƒã€‚æˆ‘ä»¬åœ¨ä¸€ä¸ªç½‘ç»œä¸­çš„èŠ‚ç‚¹ä¹‹é—´æµ‹é‡äº†å¸¦å®½å’Œå»¶è¿Ÿï¼Œä½äºä¸€ä¸ªä½ç½®ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸åŒä½ç½®çš„èŠ‚ç‚¹ï¼Œè¿™å°†å¢åŠ äº’è”ç½‘å»¶è¿Ÿï¼Œè¿™æ˜¯ä¸ç¨³å®šçš„ï¼Œå¹¶ä¸”å¯èƒ½å› æä¾›å•†è€Œå¼‚ã€‚æˆ‘ä»¬ä¿æŒäº†åˆæˆçº¯å‡€çš„æ¡ä»¶ï¼›è¿™å¯èƒ½æ— æ³•åœ¨å®é™…ç¯å¢ƒä¸­å¤åˆ¶ã€‚ä½†æ˜¯ï¼Œä¸€èˆ¬è¶‹åŠ¿å¯ä»¥é¢„æœŸä¼šè¢«é‡ç°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è£¸æœºæ€§èƒ½ä¼˜åŠ¿æ„å‘³ç€ä»€ä¹ˆ&#34;&gt;è£¸æœºæ€§èƒ½ä¼˜åŠ¿æ„å‘³ç€ä»€ä¹ˆ&lt;/h2&gt;
&lt;p&gt;æ›´å¥½çš„è£¸æœºæ€§èƒ½ç›¸å¯¹äºè™šæ‹Ÿæœºæä¾›äº†ä¸¤ä¸ªç®€å•ä½†å…³é”®çš„ä¼˜åŠ¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://thenewstack.io/how-do-applications-run-on-kubernetes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éƒ¨ç½²åœ¨è£¸æœºå·¥ä½œèŠ‚ç‚¹ä¸Šçš„åº”ç”¨ç¨‹åº&lt;/a&gt;è¿è¡Œå’Œå“åº”é€Ÿåº¦æ¯”éƒ¨ç½²åœ¨è™šæ‹Ÿæœºä¸Šçš„åº”ç”¨ç¨‹åºæ›´å¿«ã€‚&lt;/li&gt;
&lt;li&gt;å› æ­¤ï¼Œå½“é€‰æ‹©è£¸æœºæ—¶ï¼Œå®¢æˆ·åœ¨ä½¿ç”¨æ‚¨çš„äº§å“æ—¶å°†æœ‰æ›´å¥½çš„ä½“éªŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘ä»¬çš„æµ‹è¯•ç»“æœè¯å®äº†ä¸€ä¸ªæ™®éçš„æœŸæœ›ï¼Œå³è£¸æœºå¯¹äºéœ€è¦é«˜æ€§èƒ½å’Œä½å»¶è¿Ÿçš„è®¡ç®—å¯†é›†å‹å·¥ä½œè´Ÿè½½ï¼ˆä¾‹å¦‚æ•°æ®åº“ã€AI/ML æ¨¡å‹å’Œå…¶ä»–ç±»å‹çš„å®æ—¶åº”ç”¨ç¨‹åºï¼‰æ›´ä¸ºé€‚ç”¨ã€‚è™šæ‹Ÿæœºåˆ™æ›´é€‚åˆä¸éœ€è¦é«˜è®¡ç®—å’Œä½å»¶è¿Ÿæ•æ„Ÿæ€§çš„å·¥ä½œè´Ÿè½½ï¼Œå¦‚ Web æœåŠ¡å™¨ã€ç½‘ç«™å’Œå¼€å‘ç¯å¢ƒã€‚å¦‚æœé«˜æ€§èƒ½å’Œä½å»¶è¿Ÿå¯¹äºæ‚¨çš„ç”¨æˆ·è‡³å…³é‡è¦ï¼Œå¹¶ç›´æ¥å½±å“æ‚¨çš„ä¸šåŠ¡ï¼Œæ‚¨åº”è¯¥è€ƒè™‘åœ¨ Kubernetes é›†ç¾¤ä¸­ä½¿ç”¨è£¸æœºã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬çš„æµ‹è¯•è¯å®äº†è£¸æœºå·¥ä½œèŠ‚ç‚¹ä¼˜äºè™šæ‹Ÿæœºå·¥ä½œèŠ‚ç‚¹çš„å‡è®¾ã€‚å³è£¸æœºæ¯”èµ·è™šæ‹Ÿæœºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ CPU é€Ÿåº¦å’Œåˆ©ç”¨ç‡æ–¹é¢é«˜ä¸‰å€&lt;/li&gt;
&lt;li&gt;RAM å»¶è¿Ÿæ˜¯è™šæ‹Ÿæœºçš„1/3&lt;/li&gt;
&lt;li&gt;å­˜å‚¨æ€§èƒ½é«˜ä¸¤å€å¤š&lt;/li&gt;
&lt;li&gt;ç½‘ç»œå»¶è¿Ÿæ˜¯è™šæ‹Ÿæœºçš„1/5&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>è§£å¯† Kubernetes Pod ä¸­å®¹å™¨çš„æœ‰åºéƒ¨ç½²ï¼šKubexit å·¥å…·çš„å¦™ç”¨</title>
      <link>https://cloudnativecn.com/blog/ordering-containers-within-pod/</link>
      <pubDate>Mon, 13 Nov 2023 17:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/ordering-containers-within-pod/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ªï¼š&lt;a href=&#34;https://medium.com/@aditya.barik32/ordering-of-container-within-pod-a423d2e5ba52&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://medium.com/@aditya.barik32/ordering-of-container-within-pod-a423d2e5ba52&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ‘˜è¦ï¼šè®¨è®ºäº†åœ¨ Kubernetes Pod ä¸­æ’åºå®¹å™¨çš„éœ€æ±‚ï¼Œä»‹ç»äº†å¼€æºå·¥å…· Kubexit å®ç°å®¹å™¨çš„æœ‰åºå¯åŠ¨å’Œç»ˆæ­¢ï¼Œæé«˜å·¥ä½œæµçµæ´»æ€§ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆè¦åœ¨-pod-ä¸­å¯¹å®¹å™¨è¿›è¡Œæ’åº&#34;&gt;ä¸ºä»€ä¹ˆè¦åœ¨ Pod ä¸­å¯¹å®¹å™¨è¿›è¡Œæ’åºï¼Ÿ&lt;/h2&gt;
&lt;p&gt;åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒPod çš„æ’åºå¯èƒ½æ˜¯ä¸€ä¸ªä½¿ç”¨æ¡ˆä¾‹ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿æŸäº›å®¹å™¨åœ¨å¯åŠ¨åº”ç”¨ç¨‹åºä»£ç ä¹‹å‰å·²ç»æ­£å¸¸è¿è¡Œã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª Java åº”ç”¨ç¨‹åºï¼Œéœ€è¦ä¸€ä¸ªæ•°æ®åº“ï¼ˆMysqlï¼‰ã€ç¼“å­˜ï¼ˆAerospike/Redisï¼‰å’Œ Kafka æ¥æä¾›æµé‡ã€‚ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è¿™äº›ä¾èµ–å…³ç³»æ˜¯ç‰¹å®šäºå®ä¾‹æˆ–ä¸åº”ç”¨ç¨‹åºå †æ ˆæœ¬åœ°å…³è”çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨ v1.28 ç‰ˆæœ¬ä¹‹å‰ï¼ŒKubernetes æ²¡æœ‰æä¾›ä¸€ä¸ªå¼€ç®±å³ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚å¯¹äºç‰ˆæœ¬å°äº 1.28 çš„é›†ç¾¤ï¼Œæ²¡æœ‰æ­£å¼çš„è§£å†³æ–¹æ³•ã€‚ä¸ºäº†ç¼“è§£è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æœ‰å¦ä¸€ç§ä¸å¤ªçŸ¥åçš„å¼€æºè§£å†³æ–¹æ³•ï¼Œå«åš Kubexitã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯-kubexit&#34;&gt;ä»€ä¹ˆæ˜¯ Kubexitï¼Ÿ&lt;/h2&gt;
&lt;p&gt;Kubexit æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ—¨åœ¨æä¾›ä¸€ç§åè°ƒçš„æ–¹å¼æ¥å¯åŠ¨å’Œç»ˆæ­¢ Pod å†…çš„å®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;æ— æ³•åœ¨è¿™é‡Œä½¿ç”¨&lt;em&gt;InitContainer&lt;/em&gt;ï¼Œå› ä¸ºåœ¨ initContainers ä¸­å£°æ˜çš„å®¹å™¨éœ€è¦åœ¨é€šå¸¸å®¹å™¨ï¼ˆåœ¨&lt;em&gt;Container&lt;/em&gt;éƒ¨åˆ†å£°æ˜çš„å®¹å™¨ï¼‰å¼€å§‹ä¹‹å‰å®Œæˆï¼ˆå®¹å™¨çŠ¶æ€åº”ä¸ºå®Œæˆï¼‰ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåœ¨&lt;em&gt;initContainer&lt;/em&gt;éƒ¨åˆ†å£°æ˜ä¸€ä¸ª MySQL å®¹å™¨ï¼Œé‚£ä¹ˆ Pod å°†å¡åœ¨ Pod åˆå§‹åŒ–çŠ¶æ€ï¼Œå› ä¸ºåœ¨&lt;em&gt;Container&lt;/em&gt;éƒ¨åˆ†å£°æ˜çš„å…¶ä»–å®¹å™¨å°†æ°¸è¿œç­‰å¾… initContainers å®Œæˆã€‚&lt;/p&gt;
&lt;p&gt;Kubexit æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨&lt;em&gt;deployment.yaml&lt;/em&gt;çš„&lt;em&gt;initContainer&lt;/em&gt;éƒ¨åˆ†å£°æ˜å®ƒï¼Œä»¥ç”¨äºå†…éƒ¨å®¹å™¨æ’åºã€‚ä¸ºäº†ä½¿ Kubexit æŒ‰é¢„æœŸå·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦äº†è§£å®ƒæ˜¯å¦‚ä½•åšåˆ°çš„ã€‚&lt;/p&gt;
&lt;p&gt;Kubexit å…è®¸æ‚¨å£°æ˜ä¸¤ç§ç±»å‹çš„ä¾èµ–å…³ç³»ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;em&gt;Birth Dependency&lt;/em&gt;ï¼šè¿™ç§ä¾èµ–å…³ç³»å…è®¸æ‚¨å£°æ˜å®¹å™¨çš„å‡ºç”Ÿé¡ºåºã€‚&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Death Dependency&lt;/em&gt;ï¼šè¿™ç§ä¾èµ–å…³ç³»å…è®¸æ‚¨å£°æ˜å®¹å™¨çš„æ­»äº¡é¡ºåºã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å¦‚ä½•å°†-kubexit-ä¸-deployment-é›†æˆ&#34;&gt;å¦‚ä½•å°† Kubexit ä¸ Deployment é›†æˆï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†åœ¨ Pod å†…ä½¿ç”¨ Kubexitï¼Œæˆ‘ä»¬éœ€è¦é…ç½®ä¸€äº›ä¸œè¥¿ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨&lt;em&gt;initContainer&lt;/em&gt;ä¸­å£°æ˜ kubexitï¼Œä»¥ä¾¿å®ƒå°†äºŒè¿›åˆ¶æ–‡ä»¶ä¸‹è½½åˆ° Pod ä¸­ã€‚ &lt;em&gt;/kubexit&lt;/em&gt;ç›®å½•æ˜¯æˆ‘ä»¬åœ¨ Pod å†…ä¸‹è½½å’Œå­˜å‚¨äºŒè¿›åˆ¶æ–‡ä»¶çš„åœ°æ–¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/ordering-containers-within-pod/1_hu7244890742155874298.webp 400w,
               /blog/ordering-containers-within-pod/1_hu7764078826516797921.webp 760w,
               /blog/ordering-containers-within-pod/1_hu3945154843003830382.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/ordering-containers-within-pod/1_hu7244890742155874298.webp&#34;
               width=&#34;760&#34;
               height=&#34;278&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æˆ‘ä»¬è¿˜éœ€è¦è¦†ç›–æ‰€æœ‰éœ€è¦æ’åºçš„å®¹å™¨çš„é•œåƒ Pod çš„ entrypoint å’Œ/æˆ– argsã€‚åœ¨ entrypoint æˆ– args ä¹‹å‰é™„åŠ å…³é”®å­— kubexitã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/ordering-containers-within-pod/2_hu18141420082886715391.webp 400w,
               /blog/ordering-containers-within-pod/2_hu3907257590399105555.webp 760w,
               /blog/ordering-containers-within-pod/2_hu11709409010721639992.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/ordering-containers-within-pod/2_hu18141420082886715391.webp&#34;
               width=&#34;760&#34;
               height=&#34;195&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/ordering-containers-within-pod/3_hu18260942945885914276.webp 400w,
               /blog/ordering-containers-within-pod/3_hu8474141810768570501.webp 760w,
               /blog/ordering-containers-within-pod/3_hu3167034427516617649.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/ordering-containers-within-pod/3_hu18260942945885914276.webp&#34;
               width=&#34;760&#34;
               height=&#34;317&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æˆ‘ä»¬éœ€è¦åœ¨æ‰€æœ‰éœ€è¦æ’åºçš„å®¹å™¨ä¸Šåˆ›å»ºå¹¶æŒ‚è½½ä¸€ä¸ªå…±äº«å·ã€‚ &lt;em&gt;/graveyard&lt;/em&gt;æ˜¯éœ€è¦åœ¨å‚ä¸æ’åºçš„æ‰€æœ‰å®¹å™¨ä¹‹é—´å…±äº«çš„ç›®å½•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/ordering-containers-within-pod/4_hu13649550480180370748.webp 400w,
               /blog/ordering-containers-within-pod/4_hu16089876218053534529.webp 760w,
               /blog/ordering-containers-within-pod/4_hu2318816128320478732.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/ordering-containers-within-pod/4_hu13649550480180370748.webp&#34;
               width=&#34;760&#34;
               height=&#34;289&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¿˜è¦å®šä¹‰å…¶ä»–é…ç½®ï¼Œä¾‹å¦‚ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;KUBEXIT_NAME&lt;/em&gt;ï¼šKubexit çš„å®¹å™¨åç§°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;em&gt;KUBEXIT_BIRTH_DEPS&lt;/em&gt;ï¼šåœ¨å½“å‰å®¹å™¨å¯åŠ¨ä¹‹å‰éœ€è¦æ­£å¸¸è¿è¡Œçš„å®¹å™¨çš„åç§°ï¼ˆè¿™å¯ä»¥æ˜¯é€—å·åˆ†éš”çš„åˆ—è¡¨ï¼‰ã€‚åœ¨æ­¤å£°æ˜çš„åç§°æ˜¯åœ¨å®¹å™¨çš„&lt;em&gt;KUBEXIT_NAME&lt;/em&gt;ä¸­å£°æ˜çš„åç§°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/ordering-containers-within-pod/5_hu6890107492748372540.webp 400w,
               /blog/ordering-containers-within-pod/5_hu11263741215236786395.webp 760w,
               /blog/ordering-containers-within-pod/5_hu16529906220957175547.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/ordering-containers-within-pod/5_hu6890107492748372540.webp&#34;
               width=&#34;760&#34;
               height=&#34;346&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;kubexit-çš„å·¥ä½œåŸç†&#34;&gt;Kubexit çš„å·¥ä½œåŸç†&lt;/h2&gt;
&lt;p&gt;Kubexit éœ€è¦ä¸€ä¸ª ServiceAccount å’Œ Role æ¥ç›‘è§† Pod å®¹å™¨å’Œå…±äº«å·ã€‚å®ƒç›‘è§† Pod å†…çš„å…±äº«å·ï¼Œä½¿å…¶èƒ½å¤Ÿç¡®å®šå®¹å™¨çš„çŠ¶æ€å¹¶é€šçŸ¥å…¶ä»–å®¹å™¨æ˜¯å¦å­˜åœ¨ä¾èµ–å…³ç³»ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œå¿…é¡»åœ¨æ‰€æœ‰éœ€è¦å½¼æ­¤åè°ƒçš„å®¹å™¨ä¸­æŒ‚è½½å…±äº«å·ã€‚æ­¤é…ç½®å…è®¸ Kubexit ä½¿ç”¨å°±ç»ªæ¢é’ˆç›‘è§†å®¹å™¨çŠ¶æ€ã€‚å®ƒé€šè¿‡å°†*/kubexit/kubexitï¼ˆ*äºŒè¿›åˆ¶æ–‡ä»¶çš„è·¯å¾„ï¼‰é™„åŠ åˆ°å®¹å™¨çš„ entrypoint/args ä¸­æ¥å®Œæˆè¿™ä¸€ç‚¹ã€‚å½“åœ¨å¯åŠ¨æ—¶æ‰§è¡Œ entrypoint æ—¶ï¼ŒKubexit å¼€å§‹é€šè¿‡å°±ç»ªæ¢é’ˆç›‘è§†å®¹å™¨ã€‚ä¸€æ—¦å°±ç»ªæ¢é’ˆç¡®è®¤å®¹å™¨å·²å¯åŠ¨ï¼ŒKubexit é€šè¿‡åœ¨å…±äº«å·ä¸­æ”¾ç½®ä¸€ä¸ªå¢“ç¢‘ï¼ˆä¾‹å¦‚ï¼Œåœ¨ç»™å®šç¤ºä¾‹ä¸­çš„/graveyard ä¸­ï¼‰æ¥æ ‡è®°ç›¸å…³å®¹å™¨çš„è¯ç”Ÿã€‚åŒæ ·ï¼Œå½“ä¸€ä¸ªå®¹å™¨ä¸å­˜åœ¨æ—¶ï¼ŒKubexit æ·»åŠ ä¸€ä¸ªå¢“ç¢‘ä»¥æŒ‡ç¤ºå®¹å™¨çš„æ¶ˆäº¡ã€‚å…¶ä»–å®¹å™¨ç„¶åå¯ä»¥ç›‘è§†å…±äº«å·ï¼Œæ£€æŸ¥å®ƒä»¬çš„ä¾èµ–å…³ç³»æ˜¯å¦å·²å¯åŠ¨ï¼Œä»è€Œå¯åŠ¨å®ƒä»¬çš„å¯åŠ¨è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šKubernetes å·²ç»ä¸ºè¿™æ ·çš„ç”¨ä¾‹æä¾›äº†æ”¯æŒï¼Œåœ¨ v1.28 ä¸­æˆ‘ä»¬å¯ä»¥å°†&lt;em&gt;initContainer&lt;/em&gt;ä¿æŒä¸º&lt;em&gt;SideCarContainers&lt;/em&gt;(&lt;a href=&#34;https://kubernetes.io/blog/2023/08/25/native-sidecar-containers/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é“¾æ¥&lt;/a&gt;)ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/karlkfi/kubexit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubexit GitHub ä»“åº“&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/blog/2023/08/25/native-sidecar-containers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes å®˜æ–¹åšå®¢æ–‡ç« &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes å®‰å…¨å¼€å‘æœ€ä½³å®è·µçš„å®é™…åº”ç”¨</title>
      <link>https://cloudnativecn.com/blog/kubernetes-secure-development-best-practices-in-action/</link>
      <pubDate>Wed, 08 Nov 2023 15:33:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/kubernetes-secure-development-best-practices-in-action/</guid>
      <description>&lt;p&gt;è¯‘è€…æ³¨ï¼š
æœ¬æ–‡è¯‘è‡ªï¼š&lt;a href=&#34;https://www.cncf.io/blog/2023/10/11/kubernetes-secure-development-best-practices-in-action/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.cncf.io/blog/2023/10/11/kubernetes-secure-development-best-practices-in-action/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä½œè€…åŸºäº &lt;a href=&#34;https://github.com/nginxinc/nginx-gateway-fabric&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NGINX Gateway Fabric&lt;/a&gt; é¡¹ç›®ï¼ˆä¸€ä¸ªåŸºäº Kubernetes Gateway API çš„å®ç°ï¼‰çš„å¼€å‘å®ä¾‹æ¥å±•ç° Kubernetes ä¸‹çš„æœ€ä½³å®‰å…¨å¼€å‘å®è·µã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;æœ¬æ–‡ä½œè€…æ¥è‡ªï¼šF5 NGINX é«˜çº§è½¯ä»¶å·¥ç¨‹å¸ˆ Saylor Berman å’Œ F5 NGINX é«˜çº§è½¯ä»¶å·¥ç¨‹å¸ˆ Ciara Stackeã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨æœ€å° Docker å®¹å™¨æ˜¯å®¹å™¨åŒ–é¢†åŸŸçš„ä¸€ç§æµè¡Œç­–ç•¥ï¼Œå› ä¸ºå®ƒå…·æœ‰å®‰å…¨æ€§å’Œèµ„æºæ•ˆç‡çš„ä¼˜åŠ¿ã€‚è¿™äº›å®¹å™¨æ˜¯ä¼ ç»Ÿå®¹å™¨çš„ç²¾ç®€ç‰ˆæœ¬ï¼Œæ—¨åœ¨ä»…åŒ…å«è¿è¡Œåº”ç”¨ç¨‹åºæ‰€éœ€çš„åŸºæœ¬ç»„ä»¶ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œbase å®¹å™¨å¯èƒ½æ ¹æœ¬ä¸åŒ…å«ä»»ä½•å†…å®¹ï¼ˆè¿™å°†æ˜¯â€œscratchâ€å®¹å™¨ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;è®¸å¤šäººå°½å¯èƒ½ç®€å•åœ°åˆ›å»º Docker æ˜ åƒæ¥è®©ä»–ä»¬çš„åº”ç”¨ç¨‹åºæ­£å¸¸å·¥ä½œã€‚è¿™æ¶‰åŠé€‰æ‹©ä¸€ä¸ªåŸºç¡€æ˜ åƒï¼Œä¾‹å¦‚â€œubuntuâ€æˆ–â€œpythonâ€ï¼Œå…¶ä¸­åŒ…å«å¯åŠ¨å’Œè¿è¡Œæ‰€éœ€çš„æ‰€æœ‰åº“å’Œå·¥å…·ã€‚è™½ç„¶ç®€å•ï¼Œä½†ç”±äºå†…éƒ¨æ‰€æœ‰é¢å¤–çš„â€œä¸œè¥¿â€ï¼Œå¯¼è‡´è¿™äº›é•œåƒçš„æ”»å‡»é¢å’Œå†…å­˜å ç”¨é‡å¢åŠ äº†ã€‚&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä»¬å¼€å‘ &lt;a href=&#34;https://github.com/nginxinc/nginx-gateway-fabric&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NGINX Gateway Fabric&lt;/a&gt;ï¼ˆæˆ‘ä»¬å®ç°æ–°çš„ Kubernetes Gateway APIï¼‰æ—¶ï¼Œæˆ‘ä»¬åˆ©ç”¨äº†å¤šç§å·¥å…·å’Œç­–ç•¥æ¥ç¡®ä¿å®‰å…¨æ€§å’Œä¼˜åŒ–ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»æˆ‘ä»¬çš„è®¾è®¡å†³ç­–ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡å°‘æ”»å‡»é¢&lt;/li&gt;
&lt;li&gt;é•œåƒå®‰å…¨æ‰«æ&lt;/li&gt;
&lt;li&gt;ä»£ç è´¨é‡å’Œå®‰å…¨æ€§&lt;/li&gt;
&lt;li&gt;éƒ¨ç½²å®‰å…¨æœ€ä½³å®è·µ&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å‡å°‘æ”»å‡»é¢&#34;&gt;å‡å°‘æ”»å‡»é¢&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬é€‰æ‹©ä»å°½å¯èƒ½å°çš„å®¹å™¨å¼€å§‹ã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬ä¸èƒ½å†å°äº†ã€‚åŸºäº &amp;lsquo;scratch&amp;rsquo;ï¼Œæˆ‘ä»¬çš„ &amp;rsquo;nginx- gateway-fabric&amp;rsquo; é•œåƒåªåŒ…å« Golang äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ²¡æœ‰å…¶ä»–å†…å®¹ã€‚åœ¨ç”Ÿæˆæœ€ç»ˆç‰ˆæœ¬ä¹‹å‰ï¼Œæˆ‘ä»¬é‡‡å–äº†å‡ ä¸ªæ­¥éª¤ï¼Œä½†æˆ‘ä»¬ç¡®ä¿æœ€ç»ˆç‰ˆæœ¬ä»…åŒ…å«å¿…è¦çš„å†…å®¹ï¼Œå³äºŒè¿›åˆ¶æ–‡ä»¶ã€‚Dockerfile å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-Dockerfile&#34; data-lang=&#34;Dockerfile&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; alpine:3.18 &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RUN&lt;/span&gt; apk add --no-cache libcap &lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;COPY&lt;/span&gt; ./build/out/gateway /usr/bin/ &lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RUN&lt;/span&gt; setcap &lt;span class=&#34;s1&#34;&gt;&amp;#39;cap_kill=+ep&amp;#39;&lt;/span&gt; /usr/bin/gateway &lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; scratch &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;USER&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; 102:1001 &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ENTRYPOINT&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/usr/bin/gateway&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸ªå¤šæ­¥éª¤çš„ Dockerfile å…è®¸æˆ‘ä»¬å°†â€œalpineâ€ä¸æœ€æ–°ç‰ˆæœ¬çš„ libcap ä¸€èµ·ä½¿ç”¨ï¼Œå°†æˆ‘ä»¬é¢„å…ˆæ„å»ºçš„äºŒè¿›åˆ¶æ–‡ä»¶å¤åˆ¶åˆ°æ­£ç¡®çš„ä½ç½®ï¼Œå¹¶ä¸ºæˆ‘ä»¬ç®¡ç† nginx è®¾ç½®å¿…è¦çš„æƒé™ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨â€œscratchâ€ä½œä¸ºç”Ÿäº§æ˜ åƒçš„åŸºç¡€ï¼Œå¹¶è®¾ç½®ç”¨æˆ·å’Œç»„ IDï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥æ§åˆ¶å’Œé™åˆ¶å®¹å™¨æœ‰æƒè®¿é—®çš„æƒé™ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œâ€œnginx-gateway-fabricâ€æ˜ åƒçš„å¤§å°å¤§è‡´ä¸äºŒè¿›åˆ¶æ–‡ä»¶æœ¬èº«çš„å¤§å°ç›¸åŒï¼Œæ²¡æœ‰ä»»ä½•é¢å¤–çš„è†¨èƒ€ã€‚äºŒè¿›åˆ¶æ–‡ä»¶ä¸éœ€è¦ä»»ä½•é¢å¤–çš„ä¾èµ–é¡¹å³å¯è¿è¡Œï¼Œå¹¶ä¸”æˆ‘ä»¬ä¿æŒäº†å°½å¯èƒ½å°çš„å¤§å°å’Œæ”»å‡»é¢ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é•œåƒå®‰å…¨æ‰«æ&#34;&gt;é•œåƒå®‰å…¨æ‰«æ&lt;/h2&gt;
&lt;p&gt;ç¡®ä¿äº§å“å®‰å…¨çš„æœ€æœ‰æ•ˆæ–¹æ³•ä¹‹ä¸€æ˜¯å®šæœŸè¿›è¡Œå®‰å…¨æ‰«æã€‚åœ¨ &lt;a href=&#34;https://trivy.dev/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Trivy&lt;/a&gt; çš„å¸®åŠ©ä¸‹ï¼Œæˆ‘ä»¬å®šæœŸè¿è¡Œé•œåƒå®‰å…¨æ‰«æï¼Œä½œä¸º Github CI/CD ç®¡é“çš„ä¸€éƒ¨åˆ†ã€‚Trivy æ‰«æå®¹å™¨é•œåƒæŸ¥æ‰¾åº“æˆ–äºŒè¿›åˆ¶æ–‡ä»¶ä¸­å­˜åœ¨çš„ä»»ä½•å·²çŸ¥æ¼æ´ï¼ˆCVEï¼‰ã€‚ä½¿ç”¨â€œscratchâ€é•œåƒå¯ä»¥ä¿æŠ¤æˆ‘ä»¬å…å—åŸºç¡€æ˜ åƒä¸­çš„ä»»ä½•æ¼æ´çš„å½±å“ï¼Œä½† Trivy ä»ç„¶å¯ä»¥æ•è·åœ¨æˆ‘ä»¬çš„ Golang äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ç¼–è¯‘çš„åº“ä¸­çš„ä»»ä½•æ¼æ´ã€‚æ‰«æç»“æœå°†ä¸Šä¼ åˆ°å­˜å‚¨åº“çš„ Github å®‰å…¨é€‰é¡¹å¡ï¼Œä½¿æˆ‘ä»¬çš„å›¢é˜Ÿå¯ä»¥è½»æ¾æŸ¥çœ‹å‘ç°çš„ä»»ä½•é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»£ç è´¨é‡å’Œå®‰å…¨æ€§&#34;&gt;ä»£ç è´¨é‡å’Œå®‰å…¨æ€§&lt;/h2&gt;
&lt;p&gt;é™¤äº†æœ€å°åŒ–å®¹å™¨é•œåƒå¤–ï¼Œæˆ‘ä»¬è¿˜ä¼˜å…ˆè€ƒè™‘åº”ç”¨ç¨‹åºä¸­çš„ä»£ç è´¨é‡å’Œå®‰å…¨æ€§ï¼Œé‡‡ç”¨å®‰å…¨ç¬¬ä¸€çš„æ€ç»´æ–¹å¼ã€‚æˆ‘ä»¬ä»ä¸€å¼€å§‹å°±å°†å®‰å…¨æ€§æ”¾åœ¨é¦–ä½ï¼Œä»¥å®‰å…¨æ€§ä¸ºé‡ç‚¹ï¼Œå…¨é¢è¯„ä¼°æ¯ä¸ªè®¾è®¡å’ŒåŠŸèƒ½ã€‚æˆ‘ä»¬åœ¨æµç¨‹çš„æ—©æœŸé˜¶æ®µä¸»åŠ¨è¯†åˆ«å’Œä¿æŠ¤èµ„äº§ï¼Œç¡®ä¿åœ¨æ•´ä¸ªå¼€å‘ç”Ÿå‘½å‘¨æœŸä¸­å¯¹å…¶è¿›è¡Œä¿æŠ¤ï¼Œå¹¶éµå®ˆå®‰å…¨è®¾è®¡çš„æœ€ä½³å®è·µï¼ŒåŒ…æ‹¬é€‚å½“çš„èº«ä»½éªŒè¯ã€æˆæƒå’ŒåŠ å¯†æœºåˆ¶ã€‚ç»´æŠ¤è¿™äº›æ ‡å‡†çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†æ˜¯æˆ‘ä»¬ä½¿ç”¨å¼ºå¤§çš„ä»£ç å®¡æŸ¥æµç¨‹ã€‚é¡¹ç›®çš„æ¯ä¸ªè´¡çŒ®è€…ä¸ºä»»ä½•å˜åŒ–éƒ½éœ€è¦åˆ›å»ºä¸€ä¸ª PRï¼Œå¹¶ä¸”æ¯ä¸ª PR å¿…é¡»å¾—åˆ°è‡³å°‘ä¸¤ä¸ªé¡¹ç›®ç»´æŠ¤è€…çš„æ‰¹å‡†ã€‚é™¤äº†è¿™ä¸ªè¿‡ç¨‹ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜ç»“åˆäº† linter å’Œå·¥å…·çš„ä½¿ç”¨ï¼Œä»¥ä¿æŒæˆ‘ä»¬å¯¹ä»£ç å®‰å…¨æ€§å’Œè´¨é‡çš„é«˜æ ‡å‡†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é™æ€ä»£ç åˆ†æ&#34;&gt;é™æ€ä»£ç åˆ†æ&lt;/h3&gt;
&lt;p&gt;æé«˜ä»£ç è´¨é‡çš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨é™æ€ä»£ç åˆ†æå·¥å…·ï¼ˆé€šå¸¸ç¼©å†™ä¸º SASTï¼‰ã€‚ä½¿ç”¨ SAST çš„ä¸»è¦ä¼˜åŠ¿ä¹‹ä¸€æ˜¯èƒ½å¤Ÿåœ¨å¼€å‘è¿‡ç¨‹çš„æ—©æœŸæ£€æµ‹æ¼æ´ã€‚æˆ‘ä»¬å°† &lt;a href=&#34;https://codeql.github.com/docs/codeql-overview/about-codeql/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CodeQL&lt;/a&gt;ï¼ˆGitHub å¼€å‘çš„é™æ€ä»£ç åˆ†æå·¥å…·ï¼‰é›†æˆåˆ°æˆ‘ä»¬çš„ CI/CD ç®¡é“ä¸­ï¼Œè¯¥ç®¡é“æ‰«æå¹¶è¯†åˆ«æ‹‰å–è¯·æ±‚ä»¥åŠä¸»åˆ†æ”¯ä¸­çš„ä»»ä½•æ½œåœ¨é—®é¢˜ã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨å°†æ›´æ”¹åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¹‹å‰ä¿®æ­£ä»»ä½•æ½œåœ¨çš„ä»£ç è´¨é‡æˆ–å®‰å…¨é—®é¢˜ã€‚ä¸ Trivy æ‰«æç±»ä¼¼ï¼Œä»»ä½•æ½œåœ¨é—®é¢˜éƒ½ä¼šä¸Šä¼ åˆ°æˆ‘ä»¬å­˜å‚¨åº“çš„ GitHub Security é€‰é¡¹å¡ï¼Œä»¥ä¾¿æˆ‘ä»¬çš„å›¢é˜Ÿè½»æ¾æŸ¥çœ‹å‘ç°çš„ä»»ä½•é—®é¢˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ä¾èµ–é¡¹ä¿æŒæœ€æ–°&#34;&gt;ä½¿ä¾èµ–é¡¹ä¿æŒæœ€æ–°&lt;/h3&gt;
&lt;p&gt;ä½¿é¡¹ç›®çš„ä¾èµ–é¡¹ä¿æŒæœ€æ–°å¯¹äºå®‰å…¨æ€§å’Œæ€§èƒ½è‡³å…³é‡è¦ã€‚åœ¨ NGINX Gateway Fabric é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨ &lt;a href=&#34;https://docs.github.com/en/code-security/dependabot&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Dependabot&lt;/a&gt; é€šè¿‡æŒç»­ç›‘æ§é¡¹ç›®çš„ä¾èµ–é¡¹ï¼Œå¹¶åœ¨æ›´æ–°å¯ç”¨æ—¶è‡ªåŠ¨åˆ›å»º PR æ¥è‡ªåŠ¨åŒ–æ­¤è¿‡ç¨‹ã€‚è¿™å¯ç¡®ä¿æˆ‘ä»¬å§‹ç»ˆä½¿ç”¨æœ€æ–°ã€æœ€å®‰å…¨çš„ä¾èµ–é¡¹ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;Dependabot è¿˜é€šè¿‡ç›‘æ§å¸¸è§æ¼æ´å’ŒæŠ«éœ²ï¼ˆCVEï¼‰æ•°æ®åº“æ¥æä¾›å®‰å…¨è­¦æŠ¥ã€‚å½“æˆ‘ä»¬é¡¹ç›®çš„æŸä¸ªä¾èµ–é¡¹ä¸­å‘ç°å®‰å…¨æ¼æ´æ—¶ï¼ŒDependabot ä¼šç«‹å³é€šçŸ¥æˆ‘ä»¬å¹¶è‡ªåŠ¨æ‰“å¼€åŒ…å«å¿…è¦æ›´æ–°çš„ PRã€‚è¿™ä¸æ‰«ææˆ‘ä»¬çš„ Docker é•œåƒä¸€èµ·ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿå¿«é€Ÿä¿®è¡¥æ¼æ´ã€‚&lt;/p&gt;
&lt;h2 id=&#34;éƒ¨ç½²å®‰å…¨æœ€ä½³å®è·µ&#34;&gt;éƒ¨ç½²å®‰å…¨æœ€ä½³å®è·µ&lt;/h2&gt;
&lt;p&gt;ä½œä¸º Kubernetes ç¯å¢ƒä¸­çš„å…³é”®ç»„ä»¶ï¼Œæˆ‘ä»¬åŠªåŠ›å°½å¯èƒ½éµå¾ª Kubernetes å®‰å…¨æœ€ä½³å®è·µã€‚è¿™åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœ€ä½æƒé™ â€”&lt;/strong&gt; æˆ‘ä»¬è®¾è®¡äº† RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰è§„èŒƒï¼Œä»¥ä¾¿å¯¹ NGINX Gateway Fabric éœ€è¦è®¿é—®çš„èµ„æºå…·æœ‰æ‰€éœ€çš„æœ€ä½æƒé™ã€‚ä»…å®šä¹‰æ­£å¸¸æ“ä½œæ˜ç¡®æ‰€éœ€çš„æƒé™ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å•ä¸€è´£ä»»åŸåˆ™ â€”&lt;/strong&gt; æ¯ä¸ªå®¹å™¨åŒ–åº”ç”¨ç¨‹åºéƒ½åº”å…·æœ‰å•ä¸€èŒè´£ï¼Œè¿™æ„å‘³ç€å®ƒåº”ä»…æ‰§è¡Œä¸€é¡¹ä»»åŠ¡æˆ–åŠŸèƒ½ã€‚éµå¾ªè¿™ä¸€åŸåˆ™ï¼Œæˆ‘ä»¬å°† NGINX Gateway Fabric è®¾è®¡ä¸ºå¤šå®¹å™¨åº”ç”¨ç¨‹åºï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶åœ¨ä¸ NGINX äºŒè¿›åˆ¶æ–‡ä»¶ä¸åŒçš„å®¹å™¨ä¸­è¿è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼ºåŒ–å®¹å™¨å®‰å…¨ä¸Šä¸‹æ–‡ â€”&lt;/strong&gt; æˆ‘ä»¬å·²åœ¨æ¯ä¸ªå®¹å™¨ä¸Šé…ç½®äº†å®‰å…¨ä¸Šä¸‹æ–‡ï¼Œä»¥åŒ…å«ä»¥ä¸‹å†…å®¹
&lt;ul&gt;
&lt;li&gt;æˆ‘ä»¬éµå¾ªâ€œæœ€å° Linux åŠŸèƒ½â€æ¨¡å‹ï¼Œä» NGINX Gateway Fabric Pod ä¸­è¿è¡Œçš„å®¹å™¨ä¸­åˆ é™¤æ‰€æœ‰åŠŸèƒ½ï¼Œå¹¶æ˜¾å¼ä»…æ·»åŠ é¡¹ç›®è¿è¡Œæ‰€éœ€çš„åŠŸèƒ½ã€‚è¿™æœ‰åŠ©äºé™ä½å®¹å™¨é­å—æ½œåœ¨æƒé™å‡çº§æ”»å‡»çš„é£é™©ã€‚&lt;/li&gt;
&lt;li&gt;æˆ‘ä»¬ç¡®ä¿åœ¨å®¹å™¨ä¸­è¿è¡Œçš„ä»»ä½•è¿›ç¨‹éƒ½ä¸èƒ½è·å¾—æ¯”å…¶çˆ¶è¿›ç¨‹æ›´å¤šçš„æƒé™ã€‚è¿™æ˜¯é€šè¿‡åœ¨å®¹å™¨çš„å®‰å…¨ä¸Šä¸‹æ–‡ä¸­å°†â€œAllowPrivilegeEscalationâ€æ ‡å¿—è®¾ç½®ä¸º false æ¥å®ç°çš„ã€‚&lt;/li&gt;
&lt;li&gt;æˆ‘ä»¬çš„å®¹å™¨é…ç½®äº†åªè¯»æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚åªè¯»æ ¹æ–‡ä»¶ç³»ç»Ÿæœ‰åŠ©äºå®æ–½ä¸å¯å˜çš„åŸºç¡€æ¶æ„ç­–ç•¥ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†å®¹å™¨é…ç½®ä¸ºå†™å…¥å·²è£…è½½çš„å·ï¼Œå¹¶åœ¨å®¹å™¨çš„å®‰å…¨ä¸Šä¸‹æ–‡ä¸­å°†â€œreadOnlyRootFilesystemâ€æ ‡å¿—è®¾ç½®ä¸º trueã€‚&lt;/li&gt;
&lt;li&gt;æˆ‘ä»¬å°†â€œrunAsUserâ€å’Œâ€œrunAsGroupâ€æ ‡å¿—è®¾ç½®ä¸ºéæ ¹å€¼ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬åœ¨ Pod å®‰å…¨ä¸Šä¸‹æ–‡ä¸­å°† &amp;lsquo;runAsNonRoot&amp;rsquo; æ ‡å¿—è®¾ç½®ä¸º trueï¼Œä»¥å¼ºåˆ¶å®¹å™¨å¿…é¡»ä»¥é root ç”¨æˆ·èº«ä»½è¿è¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆ&#34;&gt;ä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h2&gt;
&lt;p&gt;å¸Œæœ›è¿™äº›å®‰å…¨å¼€å‘å®è·µèƒ½ä¸ºä½ æä¾›ä¸€äº›æƒ³æ³•ï¼Œäº†è§£å¦‚ä½•åœ¨å¼€å‘å¼¹æ€§åº”ç”¨å’Œé€‰æ‹©å¹³å°å·¥å…·çš„åŒæ—¶ï¼Œæœ€å¤§é™åº¦åœ°é™ä½æš´éœ²é£é™©ã€‚æˆ‘ä»¬å¾ˆæƒ³å¬å¬ä½ æ˜¯å¦æœ‰å…´è¶£ä½¿ç”¨ &lt;a href=&#34;https://github.com/nginxinc/nginx-gateway-fabric&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NGINX Gateway Fabric&lt;/a&gt; æ¥æ”¹å–„ Kubernetes å¹³å°çš„å®‰å…¨çŠ¶å†µã€‚æˆ‘ä»¬é¼“åŠ±æ‚¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»¥è´¡çŒ®è€…èº«ä»½åŠ å…¥é¡¹ç›®&lt;/li&gt;
&lt;li&gt;åœ¨å®éªŒå®¤ä¸­å°è¯•å®ç°&lt;/li&gt;
&lt;li&gt;æµ‹è¯•å¹¶æä¾›åé¦ˆ&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>ä¸ºä»€ä¹ˆæˆ‘ä»¬å†³å®šä»æ–°å¼€å§‹æˆ‘ä»¬çš„ NGINX Gateway Fabric</title>
      <link>https://cloudnativecn.com/blog/why-we-decided-to-start-fresh-with-our-nginx-gateway-fabric/</link>
      <pubDate>Wed, 08 Nov 2023 15:33:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/why-we-decided-to-start-fresh-with-our-nginx-gateway-fabric/</guid>
      <description>&lt;p&gt;è¯‘è€…æ³¨ï¼š
æœ¬æ–‡è¯‘è‡ªï¼š&lt;a href=&#34;https://www.nginx.com/blog/why-we-decided-to-start-fresh-with-our-nginx-gateway-fabric/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.nginx.com/blog/why-we-decided-to-start-fresh-with-our-nginx-gateway-fabric/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Gateway API å·²ç»æ­£å¼ GAï¼Œæ‚¨å¯èƒ½å¥½å¥‡ä½œä¸ºç¤¾åŒºçš„ä¸€ä¸ªé‡è¦å®ç°ï¼ŒF5 NGINX æ˜¯å¦‚ä½•å†³ç­–å’Œå‘å±•è¯¥é¡¹ç›®çš„ã€‚F5 çš„äº§å“ç®¡ç†æ€»ç›‘ Brian Ehlert ä»¥åŠé¦–å¸­è½¯ä»¶å·¥ç¨‹å¸ˆ Matthew Yacobucci å°†åœ¨æœ¬æ–‡ä¸­ä¸ºæ‚¨é˜è¿°&lt;a href=&#34;https://github.com/nginxinc/nginx-gateway-fabric&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NGINX Gateway Fabric&lt;/a&gt;é¡¹ç›®çŠ¶æ€ï¼Œä»¥åŠæœªæ¥çš„ç›®æ ‡ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;åœ¨ Kubernetes Ingress æ§åˆ¶å™¨çš„ä¸–ç•Œé‡Œï¼ŒNGINX å·²ç»éå¸¸æˆåŠŸåœ°è¿è¡Œäº†ã€‚NGINX Ingress Controller è¢«å¹¿æ³›éƒ¨ç½²ç”¨äºå•†ä¸š Kubernetes ç”Ÿäº§ç”¨ä¾‹ï¼ŒåŒæ—¶ä¹Ÿä½œä¸ºå¼€æºç‰ˆæœ¬è¿›è¡Œå¼€å‘å’Œç»´æŠ¤ã€‚å› æ­¤ï¼Œä½ å¯èƒ½ä¼šè®¤ä¸ºï¼Œå½“ Kubernetes ç½‘ç»œï¼ˆGateway APIï¼‰å‡ºç°é‡å¤§æ”¹è¿›æ—¶ï¼Œæˆ‘ä»¬ä¼šç»§ç»­åšä¸€ä»¶å¥½äº‹ï¼Œå¹¶åœ¨æˆ‘ä»¬ç°æœ‰çš„ Ingress äº§å“ä¸­å®ç°å®ƒã€‚&lt;/p&gt;
&lt;p&gt;ç›¸åï¼Œæˆ‘ä»¬é€‰æ‹©äº†ä¸€æ¡ä¸åŒçš„é“è·¯ã€‚çœ‹åˆ°æ–°çš„ Gateway API çš„æƒŠäººå¯èƒ½æ€§ï¼Œä»¥åŠæˆ‘ä»¬å®Œå…¨é‡æ–°æ„æƒ³å¦‚ä½•åœ¨ Kubernetes ä¸­å¤„ç†è¿æ¥çš„æœºä¼šï¼Œæˆ‘ä»¬æ„è¯†åˆ°å°† Gateway API å®ç°ç¡¬å¡åˆ°æˆ‘ä»¬ç°æœ‰çš„ Ingress äº§å“ä¸­å°†é™åˆ¶è¿™ç§æ— é™çš„æœªæ¥ã€‚&lt;/p&gt;
&lt;p&gt;è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å†³å®šæ¨å‡ºæˆ‘ä»¬è‡ªå·±çš„ç½‘å…³ API é¡¹ç›®â€”â€”&lt;a href=&#34;https://github.com/nginxinc/nginx-gateway-fabric&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NGINX Gateway Fabric&lt;/a&gt;ã€‚è¯¥é¡¹ç›®æ˜¯å¼€æºçš„ï¼Œå°†é€æ˜å’Œåä½œåœ°è¿ä½œã€‚æˆ‘ä»¬å¾ˆé«˜å…´èƒ½ä¸å¤–éƒ¨è´¡çŒ®è€…åˆä½œï¼Œå¹¶ä¸ä»–äººåˆ†äº«è¿™æ®µæ—…ç¨‹ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›åˆ›é€ ä¸€äº›ç‰¹åˆ«è€Œç‹¬ç‰¹çš„ä¸œè¥¿ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æˆ‘ä»¬å¦‚ä½•åšå‡ºç½‘å…³-api-å†³ç­–&#34;&gt;æˆ‘ä»¬å¦‚ä½•åšå‡ºç½‘å…³ API å†³ç­–&lt;/h2&gt;
&lt;p&gt;è™½ç„¶å›´ç»• Gateway API åˆ›å»ºä¸€ä¸ªå…¨æ–°é¡¹ç›®çš„å†³å®šæ¥è‡ªä¹è§‚å’Œå…´å¥‹ï¼Œä½†æœ¬è´¨ä¸Šå®ƒæ˜¯åŸºäºå¥å…¨çš„ä¸šåŠ¡å’Œäº§å“æˆ˜ç•¥é€»è¾‘ã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes çš„é•¿æœŸè¿½éšè€…å¯èƒ½å·²ç»çŸ¥é“ NGINX Ingress Controller çš„å¼€æºå’Œå•†ä¸šç‰ˆæœ¬ã€‚ä¸¤è€…åˆ†åˆ«åœ¨æ•°æ®å¹³é¢éƒ¨ç½²äº† NGINX å¼€æºå’Œ NGINX  Plus å•†ä¸šåå‘ä»£ç†ï¼Œä»–ä»¬éƒ½æ˜¯ç»è¿‡å®æˆ˜è€ƒéªŒçš„ NGINX æ•°æ®å¹³é¢ã€‚åœ¨ Kubernetes ä¹‹å‰ï¼ŒNGINX çš„æ•°æ®å¹³é¢å·²ç»éå¸¸é€‚åˆè´Ÿè½½å‡è¡¡å’Œåå‘ä»£ç†ã€‚åœ¨ Kubernetes ä¸­ï¼Œæˆ‘ä»¬çš„ Ingress æ§åˆ¶å™¨å¯å®ç°ç›¸åŒç±»å‹çš„å…³é”®è¯·æ±‚è·¯ç”±å’Œåº”ç”¨ç¨‹åºäº¤ä»˜ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;NGINX ä»¥æ„å»ºè½»é‡çº§ã€é«˜æ€§èƒ½ã€ç»è¿‡è‰¯å¥½æµ‹è¯•å¹¶å‡†å¤‡å¥½åº”å¯¹è‹›åˆ»ç¯å¢ƒçš„å•†ä¸šäº§å“è€Œè‡ªè±ªã€‚å› æ­¤ï¼ŒKubernetes Ingress Controller çš„äº§å“ç­–ç•¥åæ˜ äº†æˆ‘ä»¬çš„åå‘ä»£ç†äº§å“ç­–ç•¥â€”â€”ä¸ºæ›´ç®€å•çš„ç”¨ä¾‹åˆ¶ä½œä¸€ä¸ªå¼ºå¤§çš„å¼€æºäº§å“ï¼Œå¹¶ä¸ºå…³é”®ä¸šåŠ¡åº”ç”¨ç¨‹åºç¯å¢ƒä¸­çš„ç”Ÿäº§ Ingress Controller åˆ¶ä½œä¸€ä¸ªå…·æœ‰é™„åŠ ç‰¹æ€§å’ŒåŠŸèƒ½çš„å•†ä¸šäº§å“ã€‚è¯¥ç­–ç•¥åœ¨ Ingress Controller é¢†åŸŸå¥æ•ˆï¼Œéƒ¨åˆ†åŸå› æ˜¯ Ingress Controller ç¼ºä¹æ ‡å‡†åŒ–ï¼Œå¹¶ä¸”éœ€è¦å¤§é‡çš„è‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼ˆCRDï¼‰æ¥æä¾›è´Ÿè½½å‡è¡¡å’Œåå‘ä»£ç†ç­‰é«˜çº§åŠŸèƒ½ï¼Œå¼€å‘äººå‘˜å’Œæ¶æ„å¸ˆåœ¨ Kubernetes ä¹‹å¤–çš„ç½‘ç»œäº§å“ä¸­äº«å—è¿™äº›åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çš„å®¢æˆ·ä¾èµ–å¹¶ä¿¡ä»» NGINX Ingress Controllerï¼Œå•†ä¸šç‰ˆæœ¬å·²ç»å…·æœ‰ Gateway API æ—¨åœ¨è§£å†³çš„è®¸å¤šå…³é”®é«˜çº§åŠŸèƒ½ã€‚æ­¤å¤–ï¼ŒNGINX å¾ˆæ—©å°±å‚ä¸äº† Gateway API é¡¹ç›®ï¼Œæˆ‘ä»¬è®¤è¯†åˆ° Gateway API ç”Ÿæ€ç³»ç»Ÿéœ€è¦å‡ å¹´æ—¶é—´æ‰èƒ½å®Œå…¨æˆç†Ÿã€‚ï¼ˆäº‹å®ä¸Šï¼ŒGateway API çš„è®¸å¤šè§„èŒƒéƒ½åœ¨ä¸æ–­å‘å±•ï¼Œä¾‹å¦‚ GAMMA è§„èŒƒï¼Œä»¥ä½¿å…¶èƒ½å¤Ÿæ›´å¥½åœ°ä¸æœåŠ¡ç½‘æ ¼é›†æˆ)ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æˆ‘ä»¬è®¤ä¸ºï¼Œå°† beta çº§ Gateway API è§„èŒƒç¡¬å¡ç»™ NGINX Ingress Controller ä¼šç»™æˆç†Ÿçš„ä¼ä¸šçº§ Ingress æ§åˆ¶å™¨å¸¦æ¥ä¸å¿…è¦çš„ä¸ç¡®å®šæ€§å’Œå¤æ‚æ€§ã€‚æˆ‘ä»¬åœ¨å•†ä¸šä¸Šé”€å”®çš„ä»»ä½•ä¸œè¥¿éƒ½å¿…é¡»ç¨³å®šã€å¯é ï¼Œå¹¶ä¸” 100% å‡†å¤‡å¥½ç”Ÿäº§ã€‚Gateway API è§£å†³æ–¹æ¡ˆä¹Ÿå°†å®ç°è¿™ä¸€ç›®æ ‡ï¼Œä½†è¿™ä¸ªè¿‡ç¨‹ä»ç„¶åªæ˜¯å¼€å§‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æˆ‘ä»¬å¯¹-nginx-gateway-fabric-çš„ç›®æ ‡&#34;&gt;æˆ‘ä»¬å¯¹ NGINX Gateway Fabric çš„ç›®æ ‡&lt;/h2&gt;
&lt;p&gt;å€ŸåŠ© NGINX Gateway Fabricï¼Œæˆ‘ä»¬çš„ä¸»è¦ç›®æ ‡æ˜¯åˆ›å»ºä¸€ä¸ªç»å¾—èµ·æ—¶é—´è€ƒéªŒçš„äº§å“ï¼Œå°±åƒ NGINX Plus å’Œ NGINX å¼€æºä¸€æ ·ã€‚ä¸ºäº†è¾¾åˆ°æˆ‘ä»¬æ„¿æ„å°† Gateway API é¡¹ç›®æ ‡è®°ä¸ºâ€œé¢å‘æœªæ¥â€çš„åœ°æ­¥ï¼Œæˆ‘ä»¬æ„è¯†åˆ°æˆ‘ä»¬éœ€è¦å°è¯•å…¶æ•°æ®å’Œæ§åˆ¶å¹³é¢çš„æ¶æ„é€‰æ‹©ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ç ”ç©¶ä¸åŒçš„æ–¹æ³•æ¥ç®¡ç†ç¬¬ 4 å±‚å’Œç¬¬ 7 å±‚è¿æ¥æˆ–æœ€å°åŒ–å¤–éƒ¨ä¾èµ–å…³ç³»ã€‚è¿™ç§å®éªŒæœ€å¥½åœ¨ä¸€å¼ ç™½çº¸ä¸Šè¿›è¡Œï¼Œæ²¡æœ‰å†å²å…ˆä¾‹å’Œè¦æ±‚ã€‚è™½ç„¶æˆ‘ä»¬ä½¿ç”¨ä¹…ç»è€ƒéªŒçš„ NGINX æ•°æ®å¹³é¢ä½œä¸º NGINX ç½‘å…³ç»“æ„çš„åŸºç¡€ç»„ä»¶ï¼Œä½†æˆ‘ä»¬å¯¹é™¤æ­¤ä¹‹å¤–çš„æ–°æƒ³æ³•æŒå¼€æ”¾æ€åº¦ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¿˜å¸Œæœ›ä¸º Gateway API èµ„æºæä¾›å…¨é¢çš„ã€ä¸ä¾›åº”å•†æ— å…³çš„é…ç½®äº’æ“ä½œæ€§ã€‚ä¸ç°æœ‰çš„ Kubernetes Ingress èŒƒå¼ç›¸æ¯”ï¼ŒGateway API æœ€å¤§çš„æ”¹è¿›ä¹‹ä¸€æ˜¯å®ƒæ ‡å‡†åŒ–äº†æœåŠ¡ç½‘ç»œçš„è®¸å¤šå…ƒç´ ã€‚ä»ç†è®ºä¸Šè®²ï¼Œè¿™ç§æ ‡å‡†åŒ–åº”è¯¥ä¼šå¸¦æ¥ä¸€ä¸ªæ›´ç¾å¥½çš„æœªæ¥ï¼Œè®¸å¤š Gateway API èµ„æºå¯ä»¥è½»æ¾äº¤äº’å’Œè¿æ¥ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œæ„å»ºè¿™ä¸€æœªæ¥çš„å…³é”®æ˜¯æŠ›å¼ƒç‰¹å®šäºä¾›åº”å•†çš„ CRDï¼ˆè¿™å¯èƒ½å¯¼è‡´ä¾›åº”å•†é”å®šï¼‰ã€‚åœ¨å¿…é¡»æ”¯æŒä¸“ä¸ºå…¥å£æ§åˆ¶é¢†åŸŸè®¾è®¡çš„ CRD çš„æ··åˆäº§å“ä¸­ï¼Œè¿™å¯èƒ½ä¼šå˜å¾—éå¸¸å…·æœ‰æŒ‘æˆ˜æ€§ã€‚åœ¨å°†äº’æ“ä½œæ€§ä½œä¸ºé¦–è¦å…³æ³¨ç‚¹çš„å¼€æºé¡¹ç›®ä¸­ï¼Œè¿™æ›´å®¹æ˜“ã€‚ä¸ºäº†æ‘’å¼ƒç´§å¯†é“¾æ¥çš„ CRDï¼Œæˆ‘ä»¬éœ€è¦æ„å»ºä¸€äº›åªå…³æ³¨ Gateway API åŠå…¶ç»„æˆ API çš„æ–°è¡¨é¢ä¸œè¥¿ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åŠ å…¥æˆ‘ä»¬çš„-gateway-api-ä¹‹æ—…&#34;&gt;åŠ å…¥æˆ‘ä»¬çš„ Gateway API ä¹‹æ—…&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬ä»å¤„äºéå¸¸æ—©æœŸçš„é˜¶æ®µã€‚åªæœ‰å°‘æ•°é¡¹ç›®å’Œäº§å“å®ç°äº† Gateway API è§„èŒƒï¼Œå¹¶ä¸”å¤§å¤šæ•°é¡¹ç›®å’Œäº§å“é€‰æ‹©å°†å…¶åµŒå…¥åˆ°ç°æœ‰é¡¹ç›®å’Œäº§å“ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ„å‘³ç€è¿™æ˜¯ä¸€ä¸ªå……æ»¡æœºé‡çš„æ—¶æœŸâ€”â€”å¼€å§‹ä¸€ä¸ªæ–°é¡¹ç›®çš„æœ€ä½³æ—¶æœºã€‚æˆ‘ä»¬å®Œå…¨ä»¥å¼€æ”¾æ–¹å¼è¿è¡Œ NGINX Gateway Fabric é¡¹ç›®ï¼Œå…·æœ‰é€æ˜çš„å†³ç­–å’Œé¡¹ç›®æ²»ç†ã€‚ç”±äºè¯¥é¡¹ç›®æ˜¯ç”¨ Go ç¼–å†™çš„ï¼Œå› æ­¤æˆ‘ä»¬é‚€è¯·åºå¤§çš„ Gopher ç¤¾åŒºæå‡ºå»ºè®®ã€å¼€å§‹æäº¤ PR å’Œ/æˆ–å‘æˆ‘ä»¬æå‡ºæƒ³æ³•ã€‚&lt;/p&gt;
&lt;p&gt;Gateway API å¯èƒ½ä¼šæ”¹å˜æ•´ä¸ª Kubernetes æ ¼å±€ã€‚å¯èƒ½ä¸å†éœ€è¦æ•´ç±»äº§å“ï¼Œä¸”æ–°äº§å“å¯èƒ½ä¹Ÿä¼šå‡ºç°ã€‚Gateway API æä¾›äº†å¦‚æ­¤ä¸°å¯Œçš„å¯èƒ½æ€§ï¼Œè€å®è¯´ï¼Œæˆ‘ä»¬ä¸çŸ¥é“æœ€ç»ˆä¼šèµ°å‘ä½•æ–¹â€”â€”ä½†æˆ‘ä»¬çœŸçš„å¾ˆæœŸå¾…å®ƒçš„æ—…ç¨‹ã€‚ä¸€èµ·æ¥æ—…è¡Œå§ï¼Œä¼šå¾ˆæœ‰è¶£ï¼&lt;/p&gt;
&lt;p&gt;æ‚¨å¯ä»¥ä»ä»¥ä¸‹æ–¹é¢å¼€å§‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»¥è´¡çŒ®è€…èº«ä»½åŠ å…¥é¡¹ç›®&lt;/li&gt;
&lt;li&gt;åœ¨å®éªŒå®¤ä¸­å°è¯•å®æ–½&lt;/li&gt;
&lt;li&gt;æµ‹è¯•å’Œæä¾›åé¦ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¦åŠ å…¥è¯¥é¡¹ç›®ï¼Œè¯·è®¿é—® GitHub ä¸Šçš„ &lt;a href=&#34;https://github.com/nginxinc/nginx-gateway-fabric&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NGINX Gateway Fabric&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‚¨æƒ³ä¸æˆ‘ä»¬çš„ä¸“å®¶å°±æ­¤é¡¹ç›®å’Œå…¶ä»– NGINX é¡¹ç›®è¿›è¡Œå®æ—¶èŠå¤©ï¼Œè¯·å‰å¾€ &lt;a href=&#34;https://events.linuxfoundation.org/kubecon-cloudnativecon-north-america/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;KubeCon North America 2023 &lt;/a&gt;çš„ NGINX å±•å°ï¼NGINX æ˜¯ F5 çš„ä¸€éƒ¨åˆ†ï¼Œå¾ˆè£å¹¸æˆä¸ºä»Šå¹´ KubeCon NA çš„ç™½é‡‘èµåŠ©å•†ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨é‚£é‡Œè§åˆ°ä½ ï¼&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes Gateway API æ­£å¼å‘å¸ƒå¹¶å¼•å…¥ ingress2gateway é¡¹ç›®ç”¨äºç®€åŒ– Gateway API å‡çº§</title>
      <link>https://cloudnativecn.com/blog/gateway-api-ingress2gateway/</link>
      <pubDate>Wed, 01 Nov 2023 08:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/gateway-api-ingress2gateway/</guid>
      <description>&lt;p&gt;è¿‘æ—¥ Kubernetes Gateway API &lt;a href=&#34;https://kubernetes.io/blog/2023/10/31/gateway-api-ga/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®£å¸ƒ GA&lt;/a&gt;ï¼Œæ­¤ç‰ˆæœ¬åŒ…æ‹¬å°† Gatewayã€GatewayClass å’Œ HTTPRoute å‡çº§åˆ° v1ï¼Œè¿™æ„å‘³ç€å®ƒä»¬ç°åœ¨å·²å…¨é¢å¯ç”¨ (GA)ã€‚æ­¤ API ç‰ˆæœ¬è¡¨ç¤ºå¯¹ API è¡¨é¢çš„é«˜åº¦ä¿¡ä»»ï¼Œå¹¶æä¾›å‘åå…¼å®¹æ€§çš„ä¿è¯ã€‚è¯·æ³¨æ„ï¼Œå°½ç®¡æ ‡å‡†é€šé“ä¸­åŒ…å«çš„è¿™äº› API çš„ç‰ˆæœ¬ç°åœ¨è¢«è®¤ä¸ºæ˜¯ç¨³å®šçš„ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€å®ƒä»¬æ˜¯å®Œæ•´çš„ã€‚å½“è¿™äº› API æ»¡è¶³æ¯•ä¸šæ ‡å‡†æ—¶ï¼Œå°†ç»§ç»­é€šè¿‡å®éªŒæ¸ é“æ¥æ”¶æ–°åŠŸèƒ½ã€‚æœ‰å…³æ‰€æœ‰è¿™äº›å·¥ä½œåŸç†çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…ç½‘å…³ API ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-kubernetes-gateway-api-logo&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Kubernetes Gateway API logo&#34; srcset=&#34;
               /blog/gateway-api-ingress2gateway/gateway-api-logo_hu11496939917740245163.webp 400w,
               /blog/gateway-api-ingress2gateway/gateway-api-logo_hu11498100786488952324.webp 760w,
               /blog/gateway-api-ingress2gateway/gateway-api-logo_hu3847394361086080631.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/gateway-api-ingress2gateway/gateway-api-logo_hu11496939917740245163.webp&#34;
               width=&#34;760&#34;
               height=&#34;211&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Kubernetes Gateway API logo
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸æ­¤åŒæ—¶ Gateway API é¡¹ç›®ç»„å‘å¸ƒäº† &lt;a href=&#34;https://github.com/kubernetes-sigs/ingress2gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ingress2gateway&lt;/a&gt; å·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ ä» &lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/ingress/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ingress&lt;/a&gt; è¿ç§»åˆ° &lt;a href=&#34;https://gateway-api.sigs.k8s.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gateway API&lt;/a&gt;ã€‚Gateway API è·ç¦» GAï¼ˆGeneral Availabilityï¼Œæ­£å¼ç‰ˆæœ¬ï¼‰å‘å¸ƒåªæœ‰å‡ å‘¨çš„æ—¶é—´ï¼Œå¦‚æœä½ è¿˜æ²¡æœ‰è¿›è¡Œå‡çº§ï¼Œç°åœ¨æ˜¯æ—¶å€™è€ƒè™‘ä¸€ä¸‹äº†ï¼&lt;/p&gt;
&lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;åœ¨ä¸æ–­å‘å±•çš„ Kubernetes ä¸–ç•Œä¸­ï¼Œç½‘ç»œåœ¨å…¶ä¸­èµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚éšç€è¶Šæ¥è¶Šå¤šçš„åº”ç”¨ç¨‹åºéƒ¨ç½²åœ¨ Kubernetes é›†ç¾¤ä¸­ï¼Œå°†è¿™äº›æœåŠ¡æœ‰æ•ˆåœ°æš´éœ²ç»™å®¢æˆ·ç«¯æˆä¸ºä¸€ä¸ªå…³é”®é—®é¢˜ã€‚å¦‚æœä½ ä¸€ç›´åœ¨ä½¿ç”¨ Kubernetesï¼Œä½ å¯èƒ½å¯¹ &lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/ingress/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ingress API&lt;/a&gt; éå¸¸ç†Ÿæ‚‰ï¼Œè¿™ä¸€ç›´æ˜¯ç®¡ç†å¯¹å¤–è®¿é—®æœåŠ¡çš„é¦–é€‰è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;Ingress API æä¾›äº†ä¸€ç§å°†å¤–éƒ¨æµé‡è·¯ç”±åˆ°é›†ç¾¤å†…éƒ¨åº”ç”¨ç¨‹åºçš„æ–¹å¼ï¼Œä½¿å…¶æˆä¸ºè®¸å¤š Kubernetes ç”¨æˆ·ä¸å¯æˆ–ç¼ºçš„å·¥å…·ã€‚ç„¶è€Œï¼ŒIngress ä¹Ÿæœ‰å…¶å±€é™æ€§ï¼Œéšç€åº”ç”¨ç¨‹åºå˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œå¯¹ Kubernetes é›†ç¾¤çš„éœ€æ±‚ä¹Ÿå¢åŠ ï¼Œè¿™äº›å±€é™æ€§å¯èƒ½æˆä¸ºç“¶é¢ˆã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ä¸€äº›å±€é™æ€§åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸è¶³çš„å…±åŒåŸºå‡†&lt;/strong&gt; - é€šè¿‡å°è¯•ä¸ºå„ç§ HTTP ä»£ç†å»ºç«‹ä¸€ä¸ªå…±åŒåŸºå‡†ï¼ŒIngress åªèƒ½å®¹çº³åŸºæœ¬çš„ HTTP è·¯ç”±ï¼Œå°†å½“ä»£ä»£ç†çš„æ›´å¤šåŠŸèƒ½ï¼ˆå¦‚æµé‡æ‹†åˆ†å’Œæ ‡å¤´åŒ¹é…ï¼‰å¼ºåˆ¶è½¬ç§»åˆ°ç‰¹å®šäºæä¾›å•†çš„ã€ä¸å¯ä¼ é€’çš„æ³¨é‡Šä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸è¶³çš„æƒé™æ¨¡å‹&lt;/strong&gt; - Ingress è§„èŒƒåœ¨ä¸€ä¸ªå¯¹è±¡ä¸­åŒæ—¶é…ç½®åŸºç¡€è®¾æ–½å’Œåº”ç”¨ç¨‹åºé…ç½®ã€‚åœ¨ Ingress ä¸­ï¼Œé›†ç¾¤æ“ä½œå‘˜å’Œåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜åœ¨åŒä¸€ä¸ª Ingress å¯¹è±¡ä¸Šè¿›è¡Œæ“ä½œï¼Œè€Œå½¼æ­¤çš„è§’è‰²å¹¶ä¸æ¸…æ¥šã€‚è¿™å¯¼è‡´äº†ä¸è¶³çš„åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œå¹¶ä¸”å¾ˆå®¹æ˜“å‡ºç°è®¾ç½®é”™è¯¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åè®®å¤šæ ·æ€§çš„ç¼ºä¹&lt;/strong&gt; - Ingress ä¸»è¦å…³æ³¨ HTTP(S) è·¯ç”±ï¼Œå¹¶æ²¡æœ‰åŸç”Ÿæ”¯æŒå…¶ä»–åè®®ï¼Œæ¯”å¦‚ TCPã€UDP å’Œ gRPCã€‚è¿™ä¸ªå±€é™æ€§ä½¿å¾—å®ƒåœ¨å¤„ç†é HTTP å·¥ä½œè´Ÿè½½æ–¹é¢ä¸å¤ªé€‚ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;gateway-api&#34;&gt;Gateway API&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†å…‹æœè¿™äº›é—®é¢˜ï¼ŒGateway API è®¾è®¡äº†ä¸€ç§æ›´çµæ´»ã€å¯æ‰©å±•å’Œå¼ºå¤§çš„æ–¹å¼æ¥ç®¡ç†æµé‡åˆ°ä½ çš„æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;Gateway API è·ç¦» GAï¼ˆæ­£å¼ç‰ˆæœ¬ï¼‰å‘å¸ƒåªæœ‰å‡ å‘¨çš„æ—¶é—´ã€‚å®ƒæä¾›äº†ä¸€ä¸ªæ ‡å‡†çš„ Kubernetes API æ¥æ§åˆ¶å…¥å£æµé‡ã€‚å®ƒæä¾›äº†æ‰©å±•çš„åŠŸèƒ½ã€æ”¹è¿›çš„è‡ªå®šä¹‰æ€§å’Œæ›´å¤§çš„çµæ´»æ€§ã€‚é€šè¿‡å…³æ³¨æ¨¡å—åŒ–å’Œè¡¨è¾¾èƒ½åŠ›å¼ºå¤§çš„ API èµ„æºï¼ŒGateway API å¯ä»¥æè¿°æ›´å¹¿æ³›çš„è·¯ç”±é…ç½®å’Œæ¨¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Kubernetes ä¸­ä» Ingress API è¿ç§»åˆ° Gateway API çš„è¿‡ç¨‹æ˜¯ç”± Gateway API æä¾›çš„ä¼˜åŠ¿å’Œé«˜çº§åŠŸèƒ½é©±åŠ¨çš„ï¼Œå®ƒçš„åŸºç¡€å»ºç«‹åœ¨å››ä¸ªæ ¸å¿ƒåŸåˆ™ä¸Šï¼šé¢å‘è§’è‰²çš„æ–¹æ³•ã€å¯ç§»æ¤æ€§ã€è¡¨è¾¾æ€§å’Œå¯æ‰©å±•æ€§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é¢å‘è§’è‰²çš„æ–¹æ³•&#34;&gt;é¢å‘è§’è‰²çš„æ–¹æ³•&lt;/h3&gt;
&lt;p&gt;Gateway API ä½¿ç”¨é¢å‘è§’è‰²çš„æ–¹æ³•ï¼Œä½¿å…¶ä¸å‚ä¸é…ç½® Kubernetes æœåŠ¡ç½‘ç»œçš„ç»„ç»‡ä¸­çš„ä¼ ç»Ÿè§’è‰²ä¿æŒä¸€è‡´ã€‚è¿™ç§æ–¹æ³•ä½¿å¾—åŸºç¡€è®¾æ–½å·¥ç¨‹å¸ˆã€é›†ç¾¤æ“ä½œå‘˜å’Œåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜å¯ä»¥å…±åŒè§£å†³ Gateway API çš„ä¸åŒæ–¹é¢ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼ŒåŸºç¡€è®¾æ–½å·¥ç¨‹å¸ˆåœ¨éƒ¨ç½² GatewayClasses æ—¶å‘æŒ¥ç€å…³é”®ä½œç”¨ï¼ŒGatewayClasses æ˜¯é›†ç¾¤èŒƒå›´çš„èµ„æºï¼Œå®ƒä»¬ä½œä¸ºæ¨¡æ¿æ˜ç¡®å®šä¹‰äº†ä»å®ƒä»¬æ´¾ç”Ÿçš„ Gateways çš„è¡Œä¸ºï¼Œä¸ºå¼ºå¤§çš„æœåŠ¡ç½‘ç»œå¥ å®šäº†åŸºç¡€ã€‚&lt;/p&gt;
&lt;p&gt;éšåï¼Œé›†ç¾¤æ“ä½œå‘˜ä½¿ç”¨è¿™äº› GatewayClasses æ¥éƒ¨ç½²ç½‘å…³ã€‚Kubernetes çš„ Gateway API ä¸­çš„ Gateway å®šä¹‰äº†å¦‚ä½•å°†å¤–éƒ¨æµé‡å¯¼å‘é›†ç¾¤å†…çš„æœåŠ¡ï¼Œä»æœ¬è´¨ä¸Šè®²ï¼Œå°†é Kubernetes æºä¸ Kubernetes æ„ŸçŸ¥ç›®æ ‡è¿æ¥èµ·æ¥ã€‚å®ƒä»£è¡¨äº†å¯¹ä¸ GatewayClass è§„èŒƒå¯¹é½çš„è´Ÿè½½å‡è¡¡å™¨é…ç½®çš„è¯·æ±‚ã€‚Gateway è§„èŒƒå¯èƒ½ä¸æ˜¯è¯¦å°½æ— é—çš„ï¼Œå› ä¸ºä¸€äº›ç»†èŠ‚å¯ä»¥ç”± GatewayClass æ§åˆ¶å™¨æä¾›ï¼Œä»¥ç¡®ä¿å¯ç§»æ¤æ€§ã€‚æ­¤å¤–ï¼Œä¸€ä¸ª Gateway å¯ä»¥ä¸å¤šä¸ª Route å¼•ç”¨å…³è”èµ·æ¥ï¼Œå°†ç‰¹å®šçš„æµé‡å­é›†é€šé“åˆ°æŒ‡å®šçš„æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜é…ç½®è·¯ç”±èµ„æºï¼ˆä¾‹å¦‚ HTTPRoutesï¼‰ï¼Œç”¨äºç®¡ç†é…ç½®ï¼ˆä¾‹å¦‚è¶…æ—¶ã€è¯·æ±‚åŒ¹é…/è¿‡æ»¤ï¼‰å’ŒæœåŠ¡ç»„åˆï¼ˆä¾‹å¦‚å°†è·¯å¾„è·¯ç”±åˆ°åç«¯ï¼‰ã€‚è·¯ç”±èµ„æºä¸ºä» Gateway åˆ° Kubernetes æœåŠ¡çš„è¯·æ±‚å®šä¹‰äº†åè®®ç‰¹å®šçš„è§„åˆ™ã€‚HTTPRoute ç”¨äºå¤ç”¨ HTTP æˆ–ç»ˆæ­¢çš„ HTTPS è¿æ¥ï¼Œå®ƒé€‚ç”¨äºä½ æƒ³è¦æ£€æŸ¥ HTTP æµå¹¶ä½¿ç”¨ HTTP è¯·æ±‚æ•°æ®è¿›è¡Œè·¯ç”±æˆ–ä¿®æ”¹çš„æƒ…å†µï¼Œä¾‹å¦‚ä½¿ç”¨ HTTP æ ‡å¤´è¿›è¡Œè·¯ç”±ï¼Œæˆ–åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-gateway-api-ç¤ºæ„å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Gateway API ç¤ºæ„å›¾&#34; srcset=&#34;
               /blog/gateway-api-ingress2gateway/api_hu3204875267413736596.webp 400w,
               /blog/gateway-api-ingress2gateway/api_hu1441749040838845284.webp 760w,
               /blog/gateway-api-ingress2gateway/api_hu5481256887444101388.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/gateway-api-ingress2gateway/api_hu3204875267413736596.webp&#34;
               width=&#34;760&#34;
               height=&#34;453&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Gateway API ç¤ºæ„å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;å¯ç§»æ¤æ€§&#34;&gt;å¯ç§»æ¤æ€§&lt;/h3&gt;
&lt;p&gt;é€šè¿‡è¶…è¿‡ 20 ä¸ª &lt;a href=&#34;https://gateway-api.sigs.k8s.io/implementations/#implementations&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;API å®ç°&lt;/a&gt;ï¼ŒGateway API æ—¨åœ¨åœ¨ä¸åŒçš„å®ç°ã€é›†ç¾¤å’Œç¯å¢ƒä¸­æ›´æ˜“äºç§»æ¤ã€‚å®ƒæœ‰åŠ©äºå‡å°‘ Ingress å¯¹éå¯ç§»æ¤ã€ç‰¹å®šäºæä¾›å•†çš„æ³¨é‡Šçš„ä¾èµ–ï¼Œä½¿ä½ çš„é…ç½®æ›´ä¸€è‡´ï¼Œæ›´å®¹æ˜“åœ¨å¤šä¸ªé›†ç¾¤ä¸­ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;Gateway API è‡´åŠ›äºæ”¯æŒæœ€æ–°çš„ 5 ä¸ª Kubernetes æ¬¡è¦ç‰ˆæœ¬ã€‚è¿™æ„å‘³ç€ Gateway API ç›®å‰æ”¯æŒ Kubernetes 1.24+ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¡¨è¾¾æ€§&#34;&gt;è¡¨è¾¾æ€§&lt;/h3&gt;
&lt;p&gt;Gateway API æä¾›äº†å¯¹è®¸å¤šåŠŸèƒ½çš„æ ‡å‡†åŒ–ã€åŸºäº Kubernetes çš„æ”¯æŒï¼Œä¾‹å¦‚åŸºäºæ ‡å¤´çš„åŒ¹é…ã€æµé‡æ‹†åˆ†ã€åŸºäºæƒé‡çš„è·¯ç”±ã€è¯·æ±‚é•œåƒç­‰ç­‰ã€‚è€Œåœ¨ Ingress ä¸­ï¼Œè¿™äº›åŠŸèƒ½éœ€è¦ä½¿ç”¨è‡ªå®šä¹‰çš„ç‰¹å®šäºæä¾›å•†çš„æ³¨é‡Šã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¯æ‰©å±•æ€§&#34;&gt;å¯æ‰©å±•æ€§&lt;/h3&gt;
&lt;p&gt;Gateway API çš„è®¾è®¡ä¸­å…·æœ‰å¯æ‰©å±•æ€§ä½œä¸ºæ ¸å¿ƒç‰¹æ€§ã€‚å®ƒä¸å¼ºåˆ¶ä½¿ç”¨ä¸€ç§å¤§å°é€‚åº”æ‰€æœ‰çš„æ¨¡å‹ï¼Œè€Œæ˜¯æä¾›äº†åœ¨ API æ¡†æ¶çš„å¤šä¸ªå±‚æ¬¡ä¸Šé“¾æ¥è‡ªå®šä¹‰èµ„æºçš„çµæ´»æ€§ã€‚è¿™ç§åˆ†å±‚çš„è‡ªå®šä¹‰æ–¹æ³•ç¡®ä¿ç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„ç‰¹å®šéœ€æ±‚è°ƒæ•´é…ç½®ï¼Œè€Œä¸ä¼šæ·¹æ²¡ä¸»è¦ç»“æ„ã€‚é€šè¿‡è¿™æ ·åšï¼ŒGateway API å®ç°äº†æ›´ç²¾ç»†å’Œä¸Šä¸‹æ–‡æ•æ„Ÿçš„è°ƒæ•´ï¼Œå…è®¸åœ¨æ ‡å‡†åŒ–å’Œé€‚åº”æ€§ä¹‹é—´å®ç°ç²¾ç¡®çš„å¹³è¡¡ã€‚åœ¨ç‰¹å®šçš„äº‘åŸç”Ÿç¯å¢ƒä¸­ï¼Œç‰¹å®šçš„ç”¨ä¾‹éœ€è¦ç»†å¾®çš„é…ç½®ï¼Œè¿™ä¸€ç‚¹å°¤ä¸ºé‡è¦ã€‚ä¸€ä¸ªå…³é”®çš„åŒºåˆ«æ˜¯ï¼ŒGateway API å…·æœ‰æ›´å¹¿æ³›çš„åŸºç¡€åŠŸèƒ½é›†å’Œä¸€ä¸ªæ ‡å‡†çš„æ‰©å±•æ¨¡å¼ï¼Œæ¯” Ingress ä¸Šçš„æ³¨é‡Šæ›´å…·è¡¨ç°åŠ›ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‡çº§åˆ°-gateway&#34;&gt;å‡çº§åˆ° Gateway&lt;/h2&gt;
&lt;p&gt;ä» Ingress è¿ç§»åˆ° Gateway API å¯èƒ½çœ‹èµ·æ¥ä»¤äººç”Ÿç•ï¼Œä½†å¹¸è¿çš„æ˜¯ï¼ŒKubernetes åˆšåˆšå‘å¸ƒäº†ä¸€ä¸ªç®€åŒ–è¯¥è¿‡ç¨‹çš„å·¥å…·ã€‚&lt;a href=&#34;https://github.com/kubernetes-sigs/ingress2gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ingress2gateway&lt;/a&gt; é€šè¿‡å°†ç°æœ‰çš„ Ingress èµ„æºè½¬æ¢ä¸º Gateway API èµ„æºæ¥å¸®åŠ©è¿›è¡Œè¿ç§»ã€‚ä»¥ä¸‹æ˜¯ä½ å¯ä»¥å¼€å§‹ä½¿ç”¨ Gateway API å’Œ ingress2gateway çš„æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://gateway-api.sigs.k8s.io/guides/#installing-a-gateway-controller&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰è£… Gateway æ§åˆ¶å™¨&lt;/a&gt; æˆ–è€…&lt;a href=&#34;https://gateway-api.sigs.k8s.io/guides/#installing-gateway-api&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ‰‹åŠ¨å®‰è£… Gateway API CRD&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®‰è£… &lt;a href=&#34;https://github.com/kubernetes-sigs/ingress2gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ingress2gateway&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ åœ¨æœ¬åœ°æœ‰ Go å¼€å‘ç¯å¢ƒï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£… &lt;code&gt;ingress2gateway&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;go install github.com/kubernetes-sigs/ingress2gateway@v0.1.0
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™å°† &lt;code&gt;ingress2gateway&lt;/code&gt; å®‰è£…åˆ° &lt;code&gt;$(go env GOPATH)/bin/ingress2gateway&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æˆ–è€…ï¼Œå¯ä»¥æŒ‰ç…§&lt;a href=&#34;https://github.com/kubernetes-sigs/ingress2gateway#installation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;çš„å®‰è£…æŒ‡å—è¿›è¡Œæ“ä½œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®‰è£…å·¥å…·åï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒå°†é›†ç¾¤ä¸­çš„ Ingress èµ„æºè½¬æ¢ä¸º Gateway API èµ„æºã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ingress2gateway print
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸Šè¿°å‘½ä»¤å°†æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åŠ è½½å½“å‰çš„ Kubernetes å®¢æˆ·ç«¯é…ç½®ï¼ŒåŒ…æ‹¬æ´»åŠ¨ä¸Šä¸‹æ–‡ã€å‘½åç©ºé—´å’Œèº«ä»½éªŒè¯è¯¦ç»†ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨è¯¥å‘½åç©ºé—´ä¸­æœç´¢ Ingress å’Œç‰¹å®šäºæä¾›å•†çš„èµ„æºã€‚&lt;/li&gt;
&lt;li&gt;å°†å®ƒä»¬è½¬æ¢ä¸º Gateway API èµ„æºï¼ˆç›®å‰ä»…æ”¯æŒ Gateways å’Œ HTTPRoutesï¼‰ã€‚æœ‰å…³å…¶ä»–é€‰é¡¹ï¼Œä½ å¯ä»¥è¿è¡Œå¸¦æœ‰ &lt;code&gt;h&lt;/code&gt; çš„å·¥å…·ï¼Œæˆ–å‚è€ƒ &lt;a href=&#34;https://github.com/kubernetes-sigs/ingress2gateway#options&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/kubernetes-sigs/ingress2gateway#options&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ£€æŸ¥è½¬æ¢åçš„ Gateway API èµ„æºï¼ŒéªŒè¯å®ƒä»¬ï¼Œç„¶åå°†å…¶åº”ç”¨åˆ°é›†ç¾¤ä¸­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å‘ä½ çš„ Gateway å‘é€æµ‹è¯•è¯·æ±‚ï¼Œä»¥æ£€æŸ¥å…¶æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚ä½ å¯ä»¥ä½¿ç”¨ &lt;code&gt;kubectl get gateway &amp;lt;gateway-name&amp;gt; -n &amp;lt;namespace&amp;gt; -o jsonpath=&#39;{.status.addresses}{&amp;quot;\n&amp;quot;}&#39;&lt;/code&gt; å‘½ä»¤è·å– Gateway çš„åœ°å€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ›´æ–°ä½ çš„ DNSï¼Œå°†å…¶æŒ‡å‘æ–°çš„ Gatewayã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¡®è®¤ä¸å†æœ‰æµé‡é€šè¿‡ä½ çš„ Ingress é…ç½®åï¼Œä½ å¯ä»¥å®‰å…¨åœ°åˆ é™¤å®ƒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;å®ç°å¯é ã€å¯æ‰©å±•å’Œå¯æ‰©å±•çš„ç½‘ç»œä¸€ç›´æ˜¯ä¸€ä¸ªå…·æœ‰æŒ‘æˆ˜æ€§çš„ç›®æ ‡ã€‚Gateway API æ—¨åœ¨æ”¹è¿›å½“å‰çš„ Kubernetes ç½‘ç»œæ ‡å‡†ï¼Œå¦‚ Ingressï¼Œå¹¶å‡å°‘å¯¹å®ç°ç‰¹å®šæ³¨é‡Šå’Œ CRD çš„ä¾èµ–ã€‚&lt;/p&gt;
&lt;p&gt;å®ƒæ˜¯ä¸€ä¸ª Kubernetes æ ‡å‡† APIï¼Œåœ¨ä¸åŒçš„å¹³å°å’Œå®ç°ä¸­ä¿æŒä¸€è‡´ï¼Œæœ€é‡è¦çš„æ˜¯å®ƒæ˜¯æœªæ¥çš„ã€‚Gateway API æ˜¯ Ingress API çš„ä¸‹ä¸€ä»£ï¼Œä½†å…¶èŒƒå›´æ›´å¹¿ï¼Œè¿˜æ‰©å±•åˆ°äº†ç½‘æ ¼å’Œç¬¬å››å±‚è·¯ç”±ã€‚Gateway API å’Œ ingress2gateway å¾—åˆ°äº† SIG Network ä¸‹çš„ä¸“é—¨å›¢é˜Ÿçš„æ”¯æŒï¼Œä»–ä»¬ç§¯æå‚ä¸å…¶ä¸­å¹¶ç®¡ç†ç”Ÿæ€ç³»ç»Ÿã€‚å®ƒè¿˜å¯èƒ½è·å¾—æ›´å¤šçš„æ›´æ–°å’Œç¤¾åŒºæ”¯æŒã€‚&lt;/p&gt;
&lt;h3 id=&#34;å±•æœ›æœªæ¥&#34;&gt;å±•æœ›æœªæ¥&lt;/h3&gt;
&lt;p&gt;ingress2gateway åˆšåˆšå¼€å§‹ã€‚æˆ‘ä»¬è®¡åˆ’æ¥å…¥æ›´å¤šæä¾›å•†ï¼Œå¼•å…¥å¯¹æ›´å¤šç±»å‹çš„ Gateway API è·¯ç”±çš„æ”¯æŒï¼Œå¹¶ç¡®ä¿ä¸€åˆ‡ä¸ Gateway API çš„æŒç»­å¼€å‘é¡ºåˆ©åŒæ­¥ã€‚&lt;/p&gt;
&lt;p&gt;ä»¤äººå…´å¥‹çš„æ˜¯ï¼ŒGateway API ä¹Ÿåœ¨å–å¾—é‡å¤§è¿›å±•ã€‚è™½ç„¶ v1.0 å³å°†å‘å¸ƒï¼Œä½†å‰æ–¹ä»æœ‰å¤§é‡å·¥ä½œç­‰å¾…ç€æˆ‘ä»¬ã€‚æ­¤ç‰ˆæœ¬åŒ…å«è®¸å¤šæ–°çš„å®éªŒæ€§åŠŸèƒ½ï¼Œé¢å¤–çš„åŠŸèƒ½ç›®å‰æ­£å¤„äºè§„åˆ’å’Œå¼€å‘çš„æ—©æœŸé˜¶æ®µã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æœ‰å…´è¶£å¸®åŠ©åšå‡ºè´¡çŒ®ï¼Œæˆ‘ä»¬éå¸¸æ¬¢è¿ä½ ï¼è¯·è®¿é—®&lt;a href=&#34;https://gateway-api.sigs.k8s.io/contributing/community/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¤¾åŒºé¡µé¢&lt;/a&gt;ï¼Œå…¶ä¸­åŒ…å« Slack é¢‘é“å’Œç¤¾åŒºä¼šè®®çš„é“¾æ¥ã€‚æˆ‘ä»¬æœŸå¾…ä¸ä½ è§é¢ï¼&lt;/p&gt;
&lt;h3 id=&#34;æœ‰ç”¨çš„é“¾æ¥&#34;&gt;æœ‰ç”¨çš„é“¾æ¥&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨&lt;a href=&#34;https://github.com/kubernetes-sigs/ingress2gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GitHub&lt;/a&gt;ä¸Šå‚ä¸ Ingress2Gateway é¡¹ç›®&lt;/li&gt;
&lt;li&gt;æå‡ºæ–°é—®é¢˜ - &lt;a href=&#34;https://github.com/kubernetes-sigs/ingress2gateway/issues/new/choose&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ingress2gateway&lt;/a&gt;ï¼Œ&lt;a href=&#34;https://github.com/kubernetes-sigs/gateway-api/issues/new/choose&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gateway API&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;åŠ å…¥æˆ‘ä»¬çš„&lt;a href=&#34;https://github.com/kubernetes-sigs/gateway-api/discussions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è®¨è®º&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://gateway-api.sigs.k8s.io/guides/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gateway API å…¥é—¨æŒ‡å—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://gateway-api.sigs.k8s.io/implementations/#gateways&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gateway API å®ç°&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>å¦‚ä½•åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œ GUI åº”ç”¨ç¨‹åº</title>
      <link>https://cloudnativecn.com/blog/run-gui-applications-as-containers-with-x11docker/</link>
      <pubDate>Tue, 19 Sep 2023 12:03:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/run-gui-applications-as-containers-with-x11docker/</guid>
      <description>&lt;p&gt;æ‘˜è¦ï¼šæœ¬æ–‡ä»‹ç»äº†å¦‚ä½•åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œ GUI åº”ç”¨ç¨‹åºã€‚é€šè¿‡ä½¿ç”¨ x11docker åº”ç”¨ç¨‹åºï¼Œå¯ä»¥è½»æ¾å¯åŠ¨å¸¦æœ‰æ¡Œé¢ç¯å¢ƒçš„ GUI å®¹å™¨ï¼Œå¹¶æä¾›äº†è®¸å¤šåŠŸèƒ½ï¼Œå¦‚ GPU ç¡¬ä»¶åŠ é€Ÿã€å£°éŸ³ã€å‰ªè´´æ¿å…±äº«ç­‰ã€‚æ–‡ç« è¿˜æä¾›äº†å®‰è£… Docker è¿è¡Œæ—¶å¼•æ“å’Œ x11docker çš„è¯¦ç»†æ­¥éª¤ï¼Œå¹¶æ¼”ç¤ºäº†ä½¿ç”¨ VLC åª’ä½“æ’­æ”¾å™¨åœ¨å®¹å™¨ä¸­è¿è¡Œ GUI åº”ç”¨ç¨‹åºçš„ç¤ºä¾‹ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;æœ¬æ–‡è¯‘è‡ªï¼š&lt;a href=&#34;https://thenewstack.io/run-gui-applications-as-containers-with-x11docker/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://thenewstack.io/run-gui-applications-as-containers-with-x11docker/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä½œä¸ºå¼€å‘äººå‘˜ï¼Œæ‚¨å¯èƒ½éœ€è¦ä½¿ç”¨ GUI å®¹å™¨è¿›è¡Œå·¥ä½œã€‚å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œæ‚¨ä¼šå¾ˆå¿«å‘ç°ï¼Œä¼ ç»Ÿçš„ Docker è¿è¡Œæ—¶å¼•æ“å¹¶ä¸æ”¯æŒè¿è¡Œ GUI åº”ç”¨ç¨‹åºï¼ˆé™¤éå®ƒä»¬æ˜¯åŸºäº Web çš„ç±»å‹ï¼‰ã€‚å½“æ‚¨æƒ³è¦å¼€å‘å®¹å™¨åŒ–çš„ GUI åº”ç”¨ç¨‹åºæ—¶ï¼Œæ‚¨è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å¹¸è¿çš„æ˜¯ï¼Œæœ‰è®¸å¤šç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºå¯ä»¥åœ¨æ¡Œé¢ä¸Šè½»æ¾å¯åŠ¨ GUI å®¹å™¨ã€‚æ­£å¦‚æ‚¨å¯èƒ½é¢„æœŸçš„é‚£æ ·ï¼Œè¿™éœ€è¦ä¸€ä¸ªæ¡Œé¢ç¯å¢ƒï¼ˆå¦åˆ™ï¼Œæ‚¨å°†åœ¨æ›´ä¼ ç»Ÿçš„åŸºäºæœåŠ¡å™¨çš„è®¾ç½®ä¸Šè¿›è¡Œå¼€å‘ï¼‰ã€‚å…¶ä¸­ä¸€ä¸ªåº”ç”¨ç¨‹åºå«åš &lt;a href=&#34;https://github.com/mviereck/x11docker&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;x11docker&lt;/a&gt;ã€‚é¡¾åæ€ä¹‰ï¼Œæ­¤åº”ç”¨ç¨‹åºä¸ Linux X æ˜¾ç¤ºæœåŠ¡å™¨é…åˆä½¿ç”¨ï¼ˆè¿™æ„å‘³ç€æ‚¨éœ€è¦ä¸€ä¸ª Linux å‘è¡Œç‰ˆæ‰èƒ½ä½¿å…¶æ­£å¸¸å·¥ä½œï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;x11docker åº”ç”¨ç¨‹åºåŒ…æ‹¬ä»¥ä¸‹åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GPU ç¡¬ä»¶åŠ é€Ÿ&lt;/li&gt;
&lt;li&gt;PulseAudio æˆ– ALSA å£°éŸ³&lt;/li&gt;
&lt;li&gt;å‰ªè´´æ¿å…±äº«&lt;/li&gt;
&lt;li&gt;æ‰“å°æœºå’Œæ‘„åƒå¤´è®¿é—®&lt;/li&gt;
&lt;li&gt;æŒä¹…çš„ä¸»ç›®å½•&lt;/li&gt;
&lt;li&gt;Wayland æ”¯æŒ&lt;/li&gt;
&lt;li&gt;è¯­è¨€åŒºåŸŸè®¾ç½®åˆ›å»º&lt;/li&gt;
&lt;li&gt;å®¹å™¨å†…çš„å¤šä¸ª init ç³»ç»Ÿå’Œ DBus&lt;/li&gt;
&lt;li&gt;æ”¯æŒå¤šä¸ªå®¹å™¨è¿è¡Œæ—¶å’Œåç«¯ï¼ˆåŒ…æ‹¬ Podmanï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‚¨å¯èƒ½ä¼šé—®ï¼šâ€œX11 ä¸å®‰å…¨å—ï¼Ÿâ€æ˜¯çš„ï¼Œç¡®å®ã€‚å¹¸è¿çš„æ˜¯ï¼Œx11docker é€šè¿‡ä½¿ç”¨å¤šä¸ª X æœåŠ¡å™¨æ¥é¿å… X æœåŠ¡å™¨æ³„æ¼ã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥æ”¾å¿ƒä½¿ç”¨è¯¥å·¥å…·ï¼Œè€Œä¸å¿…æ‹…å¿ƒä¼šæš´éœ²è‡ªå·±ã€ç³»ç»Ÿæˆ–å®¹å™¨ç»™å…¸å‹çš„ X11 æœåŠ¡å™¨å¼±ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;éœ€è¦è®°ä½çš„ä¸€ä»¶äº‹æ˜¯ï¼Œx11docker åˆ›å»ºäº†ä¸€ä¸ªéç‰¹æƒå®¹å™¨ç”¨æˆ·ã€‚è¯¥ç”¨æˆ·çš„å¯†ç ä¸º x11dockerï¼Œå¹¶é™åˆ¶äº†å®¹å™¨çš„åŠŸèƒ½ã€‚å› æ­¤ï¼ŒæŸäº›åº”ç”¨ç¨‹åºå¯èƒ½æ— æ³•æŒ‰é¢„æœŸæ–¹å¼è¿è¡Œã€‚ä¾‹å¦‚ï¼Œå½“å°è¯•ä»å®¹å™¨å†…è¿è¡Œ Tor æµè§ˆå™¨æ—¶ï¼Œå®ƒæ— æ³•è®¿é—® /dev/stdoutï¼Œè¿™æ„å‘³ç€å®¹å™¨å°†æ— æ³•è¿è¡Œã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰å®¹å™¨éƒ½æ˜¯å¦‚æ­¤ã€‚æˆ‘å°†ç”¨ VLC åª’ä½“æ’­æ”¾å™¨è¿›è¡Œæ¼”ç¤ºï¼Œè¯¥æ’­æ”¾å™¨å¯ä»¥æŒ‰é¢„æœŸè¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•åœ¨è¿è¡Œä¸­çš„åŸºäº Ubuntu çš„æ¡Œé¢æ“ä½œç³»ç»Ÿå®ä¾‹ä¸Šå®‰è£… x11dockerã€‚å½“ç„¶ï¼Œé¦–å…ˆæ‚¨å¿…é¡»å®‰è£… Docker è¿è¡Œæ—¶å¼•æ“ã€‚ä¸ºæ­¤ï¼Œæˆ‘å°†å‘æ‚¨å±•ç¤ºä¸¤ç§ä¸åŒçš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;å‡†å¤‡å¥½äº†å—ï¼Ÿæˆ‘ä»¬å¼€å§‹å§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ‰€éœ€çš„å·¥å…·&#34;&gt;æ‰€éœ€çš„å·¥å…·&lt;/h2&gt;
&lt;p&gt;æ­£å¦‚æˆ‘å·²ç»æåˆ°çš„ï¼Œæ‚¨éœ€è¦è¿è¡Œä¸­çš„åŸºäº Ubuntu çš„ Linux æ¡Œé¢å‘è¡Œç‰ˆå®ä¾‹ã€‚æ‚¨è¿˜éœ€è¦ä¸€ä¸ªå…·æœ‰ sudo æƒé™çš„ç”¨æˆ·ã€‚å°±è¿™äº›ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®‰è£…-docker&#34;&gt;å®‰è£… Docker&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¼ ç»Ÿçš„æ–¹æ³•å®‰è£… Docker è¿è¡Œæ—¶å¼•æ“ã€‚é¦–å…ˆè¦åšçš„æ˜¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†å®˜æ–¹ Docker GPG æ·»åŠ åˆ°ç³»ç»Ÿä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -fsSL &amp;lt;https://download.docker.com/linux/ubuntu/gpg&amp;gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¿…é¡»æ·»åŠ  Docker ä»“åº“ï¼Œä»¥ä¾¿å®‰è£…è½¯ä»¶ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®Œæˆæ­¤æ“ä½œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] &amp;lt;https://download.docker.com/linux/ubuntu&amp;gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;lsb_release -cs&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; stable&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; sudo tee /etc/apt/sources.list.d/docker.list &lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt;gt&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; /dev/null
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ·»åŠ ä»“åº“åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ä¸€äº›ä¾èµ–é¡¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get install apt-transport-https ca-certificates curl gnupg lsb-release -y
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ›´æ–° aptï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get update
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£… Dockerï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get install docker-ce docker-ce-cli containerd.io -y
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸ºäº†èƒ½å¤Ÿåœ¨ä¸ä½¿ç”¨ &lt;em&gt;sudo&lt;/em&gt; çš„æƒ…å†µä¸‹è¿è¡Œ Docker å‘½ä»¤ï¼ˆè¿™å¯èƒ½å­˜åœ¨å®‰å…¨é£é™©ï¼‰ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†æ‚¨çš„ç”¨æˆ·æ·»åŠ åˆ° docker ç”¨æˆ·ç»„ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo usermod -aG docker &lt;span class=&#34;nv&#34;&gt;$USER&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ³¨é”€å¹¶é‡æ–°ç™»å½•ä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‚¨å¸Œæœ›é‡‡ç”¨å¿«é€Ÿæ–¹å¼ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£… Dockerï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get install curl wget uidmap -y
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wget -qO- https://get.docker.com/ &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; sudo sh
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¦èƒ½å¤Ÿä»¥æ— ç‰¹æƒæ–¹å¼è¿è¡Œ Dockerï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;dockerd-rootless-setuptool.sh install
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å¦‚ä½•å®‰è£…-x11docker&#34;&gt;å¦‚ä½•å®‰è£… x11docker&lt;/h2&gt;
&lt;p&gt;åœ¨å®‰è£… x11docker ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å®‰è£…ä¸€äº›ä¾èµ–é¡¹ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®Œæˆæ­¤æ“ä½œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get install xpra xserver-xephyr xinit xauth xclip x11-xserver-utils x11-utils -y
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£… x11dockerï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -fsSL https://raw.githubusercontent.com/mviereck/x11docker/master/x11docker &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; sudo bash -s -- --update
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ›´æ–° x11dockerï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo x11docker --update
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å¦‚ä½•ä½¿ç”¨-x11docker&#34;&gt;å¦‚ä½•ä½¿ç”¨ x11docker&lt;/h2&gt;
&lt;p&gt;å®‰è£…äº† x11docker ä¹‹åï¼Œå°±å¯ä»¥å¼€å§‹æµ‹è¯•äº†ã€‚è®©æˆ‘ä»¬ä½¿ç”¨ VLC åº”ç”¨ç¨‹åºå®¹å™¨è¿›è¡Œæµ‹è¯•ã€‚é¦–å…ˆï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‹‰å–é•œåƒï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker pull jess/vlc
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‹‰å–é•œåƒåï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼ˆå€ŸåŠ© x11dockerï¼‰è¿è¡Œ VLCï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;x11docker --pulseaudio --share&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$HOME&lt;/span&gt;/Videos jess/vlc
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‚¨åº”è¯¥ä¼šçœ‹åˆ° VLC çª—å£æ‰“å¼€ï¼Œå‡†å¤‡å¥½ä¾›ä½¿ç”¨ï¼ˆå›¾ 1ï¼‰ã€‚å®ƒçš„é€Ÿåº¦æ¯”ç›´æ¥å®‰è£…åœ¨æ‚¨çš„æ¡Œé¢ä¸Šè¦æ…¢ä¸€äº›ï¼Œä½†é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒåº”è¯¥æŒ‰é¢„æœŸå·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/run-gui-applications-as-containers-with-x11docker/docker_hu5167449153449712213.webp 400w,
               /blog/run-gui-applications-as-containers-with-x11docker/docker_hu9169833344889354399.webp 760w,
               /blog/run-gui-applications-as-containers-with-x11docker/docker_hu4592457042509244309.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/run-gui-applications-as-containers-with-x11docker/docker_hu5167449153449712213.webp&#34;
               width=&#34;621&#34;
               height=&#34;486&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å½“ç„¶ï¼Œå¦‚æœæ‚¨æ˜¯å¼€å‘äººå‘˜ï¼Œè¿™å¯¹æ‚¨å¸®åŠ©ä¸å¤§ï¼Œå› ä¸ºæ‚¨æƒ³è¦å¼€å‘è‡ªå·±çš„å®¹å™¨ã€‚æ‚¨å¯ä»¥å§‹ç»ˆåˆ›å»ºè¦ä½¿ç”¨çš„æ˜ åƒï¼Œå¯¹å…¶è¿›è¡Œæ ‡è®°ï¼Œå°†å…¶æ¨é€åˆ°æ‚¨é€‰æ‹©çš„å­˜å‚¨åº“ï¼Œä½¿ç”¨ docker pull å‘½ä»¤å°†å…¶æ‹‰åˆ°å¼€å‘ç³»ç»Ÿä¸Šï¼Œç„¶åä½¿ç”¨ x11docker éƒ¨ç½²å®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;å°±æ˜¯è¿™æ ·ã€‚ç°åœ¨ï¼Œæ‚¨å¯ä»¥é€šè¿‡ x11docker åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œ GUI åº”ç”¨ç¨‹åºäº†ã€‚å€ŸåŠ©è‡ªå·±çš„å›¾åƒéƒ¨ç½²è‡ªå·±çš„å®šåˆ¶å®¹å™¨ï¼Œçœ‹çœ‹å®ƒçš„å·¥ä½œåŸç†ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>WebAssembly èƒ½å¤Ÿå–ä»£ Kubernetes å—ï¼Ÿæ¢ç´¢å…¶ä¼˜åŠ¿å’Œé™åˆ¶</title>
      <link>https://cloudnativecn.com/blog/wasm-vs-kubernetes/</link>
      <pubDate>Mon, 11 Sep 2023 19:03:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/wasm-vs-kubernetes/</guid>
      <description>&lt;p&gt;æœ¬æ–‡æºè‡ªï¼š&lt;a href=&#34;https://thenewstack.io/webassembly/yes-webassembly-can-replace-kubernetes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://thenewstack.io/webassembly/yes-webassembly-can-replace-kubernetes/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ‘˜è¦ï¼šWebAssembly å¯ä»¥ä½œä¸ºä¸€ç§éƒ¨ç½²åº”ç”¨ç¨‹åºçš„æ–¹å¼ï¼Œå¯ä»¥åœ¨æœåŠ¡å™¨æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œï¼Œä¸”åœ¨è®¸å¤šä¸åŒçš„ç¡¬ä»¶ç¯å¢ƒä¸­è¡¨ç°å‡ºè‰²ã€‚ä¸ Kubernetes ç›¸æ¯”ï¼ŒWebAssembly çš„ä¼˜ç‚¹åœ¨äºç®€æ˜“æ€§å’Œå®‰å…¨æ€§ã€‚ä½†æ˜¯ï¼ŒKubernetes å§‹ç»ˆæœ‰å…¶ç”¨é€”ï¼Œå®ƒå°†å§‹ç»ˆç”¨äºç¼–æ’å¾®æœåŠ¡å’Œå®¹å™¨ã€‚å› æ­¤ï¼Œå¯¹äºæŸäº›ç”¨ä¾‹æ¥è¯´ï¼ŒWebAssembly å¯ä»¥æ›¿ä»£ Docker å’Œå®¹å™¨ï¼Œä½†æ˜¯åœ¨é«˜åº¦åˆ†å¸ƒå¼çš„äº‘åŸç”Ÿç¯å¢ƒä¸­ï¼Œä½¿ç”¨ WebAssembly æ¥ç¼–æ’å®¹å™¨å’Œå¾®æœåŠ¡ç¨‹åº¦ä¸Šä¸ Kubernetes ç›¸åŒçš„ç¨‹åº¦æ˜¯ä¸å¯èƒ½çš„ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;æ˜¯çš„ï¼ŒWebAssembly å¯ä»¥è§£å†³ Kubernetes çš„ä¸€äº›é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;WebAssembly æˆ– Wasm è¢«è¯æ˜æ˜¯ä¸€ç§åœ¨ Web æµè§ˆå™¨ä¸Šè¿è¡Œä»£ç çš„éå¸¸å®ç”¨çš„æ–¹å¼ï¼Œå®ƒå¯ä»¥ä½œä¸ºç¼–è¯‘å™¨ã€‚å®ƒå·²ç»ä½œä¸ºä¸€ç§è¯­è¨€è¿è¡Œå¾—éå¸¸å¥½ï¼Œä»¥è‡³äºä¸–ç•Œä¸‡ç»´ç½‘è”ç›Ÿï¼ˆW3Cï¼‰åœ¨ 2019 å¹´å°†å…¶å‘½åä¸º Web æ ‡å‡†ï¼Œæˆä¸ºç¬¬å››ä¸ª Web æ ‡å‡†ï¼Œä¸ HTMLã€CSS å’Œ JavaScript ä¸€èµ·ã€‚&lt;/p&gt;
&lt;p&gt;ä¸»è¦çš„ Web æµè§ˆå™¨ï¼ŒåŒ…æ‹¬ Mozillaã€Chromeã€Internet Explorer ç­‰ï¼Œéƒ½å…¼å®¹ Wasmï¼Œç”¨äºç¼–å†™ä»£ç å’Œåˆ›å»º Web æµè§ˆå™¨åº”ç”¨ç¨‹åºçš„ä½¿ç”¨è¶Šæ¥è¶Šæ™®éã€‚é™¤äº† Web å·¥ä½œé©¬è½¦ JavaScript å¤–ï¼ŒWasm è¿˜å¯ä»¥å®¹çº³å…¶ä»–è¯­è¨€ï¼ŒåŒ…æ‹¬ Goã€.NETã€C++ã€Javaã€PHPã€Rust å’Œ Pythonã€‚&lt;/p&gt;
&lt;p&gt;Adobeä¾èµ–äºWasm/WASIå¹³å°åœ¨æµè§ˆå™¨ä¸Šç›´æ¥è¿è¡ŒC++ä»£ç ï¼Œè¿™æ˜¯å…¶ä¸­ä¸€ä¸ªæ›´æœ‰è¶£çš„ç”¨ä¾‹ã€‚è¿™ä½¿å¾—ç”¨æˆ·å¯ä»¥åœ¨æµè§ˆå™¨ä¸Šç›´æ¥è¿è¡ŒAdobeçš„Photoshopå’ŒAcrobatï¼Œä»è€Œæ— éœ€åœ¨ç”¨æˆ·çš„è®¡ç®—æœºä¸Šä¸‹è½½è¿™äº›è½¯ä»¶å·¥å…·è¿›è¡Œå·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;æœ€ç»ˆï¼Œå¼€å‘äººå‘˜æ„è¯†åˆ° Wasm ä¹Ÿå¯ä»¥åœ¨æœåŠ¡å™¨æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œï¼Œç°åœ¨å®ƒçš„ä½¿ç”¨èŒƒå›´æ‰©å±•åˆ°ç¡¬ä»¶å¹³å°ã€‚å®ƒåœ¨è®¸å¤šä¸åŒçš„ç¡¬ä»¶ç¯å¢ƒä¸­è¡¨ç°å‡ºè‰²ï¼Œä»æœåŠ¡å™¨ç«¯åˆ°è¾¹ç¼˜éƒ¨ç½²å’Œç‰©è”ç½‘è®¾å¤‡ï¼Œæˆ–è€…ä»»ä½•å¯ä»¥ç›´æ¥åœ¨ CPU ä¸Šè¿è¡Œä»£ç çš„åœ°æ–¹ã€‚ä»£ç æ‰“åŒ…åœ¨æ•´æ´çš„ Wasm å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œå¯ä»¥å°†å…¶ä¸å®¹å™¨æˆ–ç”šè‡³å¯ä»¥ä¸è¾ƒå°‘é…ç½®çš„ä»£ç å’Œç›®æ ‡è¿è¡Œçš„è¿·ä½ æ“ä½œç³»ç»Ÿè¿›è¡Œæ¯”è¾ƒã€‚æ— è®ºåœ¨å“ªé‡Œéƒ¨ç½²ä»£ç ï¼Œåº”ç”¨ç¨‹åºéƒ½æ¯”ä»…é™äº Web æµè§ˆå™¨ç¯å¢ƒæ›´åŠ å¹¿æ³›ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è®¸å¤šæ–¹é¢ï¼ŒWasm çš„åŠŸèƒ½å¯ä»¥ä¸ä¸€ä¸ªâ€œå¤§æ‚çƒ©â€å¤šè¯­è¨€ç¼–è¯‘å™¨ç›¸æ¯”ã€‚ç„¶è€Œï¼Œä¸ç¼–è¯‘å™¨ç›¸æ¯”ï¼ŒåŒä¸€äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶çš„ Wasm å¯ä»¥é’ˆå¯¹å¤šä¸ªå¹³å°è¿›è¡Œç›®æ ‡å’Œè¿è¡Œï¼Œè€Œæ— éœ€åœ¨ Wasm ä»£ç å’Œç›®æ ‡è®¾å¤‡ä¸Šè¿›è¡Œé…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œä¸ç¼–è¯‘å™¨ç›¸æ¯”ï¼ŒWasm åœ¨å®Œç¾é’ˆå¯¹å¤šä¸ªç›®æ ‡è¿è¡ŒäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶æ—¶æ˜¾ç„¶æ¯”è¾ƒä¼˜è¶Šã€‚è€Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå•ä¸ªäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶å¯ä»¥é’ˆå¯¹å¤šä¸ªç›®æ ‡è¿è¡Œï¼Œè€Œæ— éœ€é‡æ–°é…ç½®ï¼šè¿™å°±æ˜¯ Wasm çš„ä¼˜ç¾ä¹‹å¤„ã€‚&lt;/p&gt;
&lt;p&gt;â€œWasm ç»ˆäºè®©æˆ‘ä»¬åœ¨ä¸æ¶‰åŠå¼€å‘äººå‘˜çš„æƒ…å†µä¸‹åœ¨æœåŠ¡å™¨ã€äº‘å’Œè¾¹ç¼˜è®¾å¤‡ä¹‹é—´ç§»åŠ¨ä»£ç ã€‚è¿™å°†æœ€ç»ˆç»“æŸå¼€å‘äººå‘˜èŠ±è´¹å¤§é‡æ—¶é—´æ‹…å¿ƒè°ƒæ•´ä»–ä»¬çš„ä»£ç ä»¥åŠä¸ºä¸åŒçš„ç›®æ ‡å¹³å°æä¾›æ”¯æŒçš„æ—¶ä»£ï¼Œâ€Enterprise Management Associatesï¼ˆEMAï¼‰çš„åˆ†æå¸ˆ Torsten Volk å‘Šè¯‰ The New Stackã€‚â€œWasm çš„å·¥ä½œæ˜¯åœ¨æ‰€æœ‰è¿™äº›å¹³å°ä¸Šæä¾›ä¸€è‡´çš„è¿è¡Œæ—¶ã€‚â€&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼ŒWasm å¯ä»¥åœ¨æŸäº›æƒ…å†µä¸‹ä¸º Kubernetes æä¾›å¾ˆå¥½çš„æ›¿ä»£æ–¹æ¡ˆã€‚ä¸ Kubernetes ç›¸æ¯”çš„ä¸»è¦ä¼˜ç‚¹æ˜¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç®€æ˜“æ€§&lt;/strong&gt;ã€‚åœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºæ—¶ï¼Œå³ä½¿å°†åº”ç”¨ç¨‹åºåˆ†å‘åˆ°ä¸åŒçš„ç»ˆç«¯ï¼Œä¹Ÿä¼šæœ‰è®¸å¤šæ˜æ˜¾ç¼ºå°‘çš„æ­¥éª¤ã€‚Cosmonic çš„ PaaS ç‰ˆæœ¬å¯ä»¥ç”¨å‡ ä¸ªå‘½ä»¤è¡Œåœ¨å›¾å½¢ç•Œé¢ä¸­éƒ¨ç½²åº”ç”¨ç¨‹åºã€‚å½“ä½¿ç”¨ Fermyon å’Œ Fastly çš„ Compute@Edge æ—¶ï¼Œæƒ…å†µä¹Ÿæ˜¯å¦‚æ­¤ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®‰å…¨æ€§&lt;/strong&gt;ã€‚åœ¨ Kubernetes è¿™ç§é«˜åº¦åˆ†å¸ƒå¼çš„ç¯å¢ƒä¸­ï¼Œå®‰å…¨æ€§æ˜¯ä¸€ä¸ªçœŸæ­£çš„é—®é¢˜ï¼Œå¹¶ä¸”é—®é¢˜ç‚¹çš„è¯¦å°½åˆ—è¡¨å¤ªé•¿ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚å¾®æœåŠ¡ä¹‹é—´çš„äº’è¿æ€§æ„å‘³ç€ï¼Œåœ¨ä¸€ä¸ª Pod ä¸­æœ‰æ•°ç™¾ä¸ªå…¥å£ç‚¹ä¸­è·å¾—è®¿é—®æƒé™çš„æ”»å‡»è€…å¯èƒ½ä¼šå¯¹ç»„ç»‡çš„æ•´ä¸ªåŸºç¡€æ¶æ„é€ æˆä¸¥é‡ç ´åã€‚&lt;a href=&#34;https://thenewstack.io/kubernetes-secrets-management-3-approaches-9-best-practices/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç§˜å¯†ç®¡ç†&lt;/a&gt;æ˜¯å¦ä¸€ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”ä¸åç§°ä¸€æ ·ï¼Œåœ¨å®¹å™¨ä¸­æŒ‡å®šè°å¯ä»¥è®¿é—®å®ƒä»¬ä¹Ÿå­˜åœ¨å›°éš¾ã€‚&lt;/p&gt;
&lt;p&gt;Wasm çš„å¯ç§»æ¤æ€§å’Œä¸€è‡´æ€§å¯ä»¥ä½¿å®‰å…¨æ€§å’Œåˆè§„æ€§æ›´æ˜“äºç®¡ç†ï¼ˆå†æ¬¡å¼ºè°ƒï¼Œå®ƒåœ¨ CPU çº§åˆ«çš„äºŒè¿›åˆ¶æ ¼å¼ä¸­è¿è¡Œï¼‰ã€‚æ­¤å¤–ï¼ŒWasm ç»“æ„çš„ç®€å•æ€§æ„å‘³ç€ä»£ç åœ¨å‡ ä¹ç›´æ¥åˆ°è¾¾ç«¯ç‚¹çš„å°é—­æ²™ç®±ç¯å¢ƒä¸­å‘å¸ƒã€‚Wasm å¹¶éæ²¡æœ‰æ¼æ´å¯ä»¥åˆ©ç”¨ã€‚åªæ˜¯ç›¸å¯¹äº Kubernetesï¼Œå®ƒçš„æ¼æ´åˆ©ç”¨å¯èƒ½æ€§æ›´å°‘ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½†å®ƒä»¬å¹¶ä¸æ˜¯åŒä¸€ä»¶äº‹æƒ…&#34;&gt;ä½†å®ƒä»¬å¹¶ä¸æ˜¯åŒä¸€ä»¶äº‹æƒ…&lt;/h2&gt;
&lt;p&gt;Wasm æä¾›äº†å·¨å¤§çš„æœºä¼šï¼Œå¹¶ä¸”å¯èƒ½ä¼šä½œä¸ºä¸€ç§éƒ¨ç½²åº”ç”¨ç¨‹åºçš„æ–¹å¼ï¼Œåœ¨æœªæ¥å‡ ä¸ªæœˆå’Œå‡ å¹´ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ä¾›åº”å•†å˜å¾—æ›´åŠ æœ‰åˆ›é€ åŠ›ï¼Œä»¥ä¾¿ç”¨æˆ·å¯ä»¥åˆ©ç”¨å®ƒã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œé‚£äº›é¢„æµ‹ Wasm æœ€ç»ˆå°†åƒæ‰ Kubernetes çš„åˆé¤å¹¶å®Œå…¨å–ä»£å®ƒçš„äººï¼Œå¯ä»¥è¯´æ˜¯é”™è¿‡äº†é‡ç‚¹ã€‚ä¸å¯èƒ½è¯´ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œä»¥åŠå…¶ä»–ç”¨äºåœ¨äº‘ç¯å¢ƒä¸­éƒ¨ç½²å’Œç®¡ç†é«˜åº¦åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºçš„æŠ€æœ¯å¯èƒ½æœ€ç»ˆå–ä»£ Kubernetesã€‚ä½†æ˜¯ï¼Œå®ƒé«˜åº¦ä¸å¯èƒ½æ˜¯ Wasmã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯å› ä¸º Kubernetes å§‹ç»ˆæœ‰å…¶ç”¨é€”ã€‚å®ƒå°†å§‹ç»ˆç”¨äºç¼–æ’å¾®æœåŠ¡ï¼Œä»¥åŠå½“ç„¶è¿˜æœ‰å®¹å™¨ã€‚å®ƒä¹Ÿå¯ä»¥è¢«è®¤ä¸ºå®é™…ä¸Šå°±æ˜¯ Wasm å°†åœ¨å…¶ä¸­è¿è¡Œçš„ä¸œè¥¿ï¼Œå¹¶ä¸”å…¶æ”¯æŒè€…å·²ç»è¯´è¿‡ Wasm éå¸¸é€‚åˆåœ¨ Kubernetes ç¯å¢ƒä¸­è¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;â€œ&lt;a href=&#34;https://thenewstack.io/webassembly/serverless-webassembly-for-browser-developers/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Wasm æ˜¯ä¸ºå¼€å‘äººå‘˜æä¾›æ— éœ€ç¼–å†™å’Œç»´æŠ¤å¤§é‡åŸºç¡€è®¾æ–½ YAML çš„æ— æœåŠ¡å™¨è¿è¡Œæ—¶&lt;/a&gt;ã€‚Wasm ä¸ºåº”ç”¨ç¨‹åºä»£ç æä¾›äº†ä¸€ç»„æ ‡å‡† APIï¼Œä»¥ä¾¿è®¿é—®å…³é”®çš„è¿è¡Œæ—¶æœåŠ¡ï¼Œä¾‹å¦‚ SQL æˆ– NoSQLã€Kafka æ¶ˆæ¯ä¼ é€’æˆ–ä»£ç è°ƒè¯•ï¼Œâ€Volk è¯´ã€‚â€œä½†æ˜¯ï¼Œç„¶å Wasm ä¾èµ–äºèµ„æºç¼–æ’å±‚ï¼Œå¯ä»¥ç”± Kubernetes æˆ–ä»»ä½•å…¶ä»–è°ƒåº¦å™¨æä¾›ï¼Œä»¥æä¾›è¿™äº›æœåŠ¡æ‰€éœ€çš„åŸºç¡€è®¾æ–½èµ„æºã€‚è¿™äº›èµ„æºå¯ä»¥ä»¥å®¹å™¨ã€è™šæ‹Ÿæœºã€è£¸æœºæˆ–ä¸€äº›æœªæ›¾æƒ³åˆ°çš„èŠ±å“¨æœªæ¥æŠ€æœ¯çš„å½¢å¼äº¤ä»˜ã€‚â€&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œå¹¶éæ‰€æœ‰äººéƒ½è®¤ä¸º Kubernetes ä½œä¸ºå®¹å™¨ç¼–æ’çš„èƒ½åŠ›å°†æ— é™æœŸåœ°ä¿æŒå…¶é¦–é€‰ã€‚è®¸å¤š Wasm é¢†åŸŸçš„äººéƒ½å€¾å‘äº HashiCorp çš„ Nomad è°ƒåº¦å™¨ã€‚çš„ç¡®ï¼ŒFermyon å·²ç»æ”¾å¼ƒäº† Krustletï¼ˆWasm-on-Kubernetesï¼‰ï¼Œå¹¶å°†é‡ç‚¹è½¬å‘ HashiCorp Nomad ä½œä¸ºå…¶è°ƒåº¦å™¨ã€‚Butcher è¯´ï¼šâ€œNomad åœ¨è°ƒåº¦å®¹å™¨æ–¹é¢ä¸ Kubernetes ç›¸å½“ï¼Œä½†å…·æœ‰ä¸€ä¸ªè‡³å…³é‡è¦çš„é™„åŠ åŠŸèƒ½ï¼šå®ƒå¯ä»¥è°ƒåº¦éå®¹å™¨å·¥ä½œè´Ÿè½½ã€‚åœ¨ Fermyon ä¸­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿä½¿ Nomad è°ƒåº¦å’Œæ‰§è¡Œ WebAssembly åº”ç”¨ç¨‹åºï¼Œè€Œæ— éœ€ç¼–å†™ä»»ä½•è‡ªå®šä¹‰ä»£ç ã€‚â€&lt;/p&gt;
&lt;p&gt;ä¸æ­¤åŒæ—¶ï¼ŒKubernetes å¼€å‘äººå‘˜éœ€è¦åœ¨ä½çº§åˆ«ä¸Š&lt;a href=&#34;https://thenewstack.io/webassembly/what-is-webassembly-and-why-do-you-need-it/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ¥å— WebAssembly&lt;/a&gt;ï¼Œå¹¶æ›´æ”¹å†…ç½®çš„ã€å®¹å™¨ç‰¹å®šçš„å‡è®¾ï¼ŒButcher è¯´ã€‚å¾®è½¯æ˜¯ç¬¬ä¸€å®¶çœŸæ­£æ‹¥æŠ±è¿™ä¸ªæ¦‚å¿µçš„å…¬å¸ï¼Œå®ƒçš„&lt;a href=&#34;https://github.com/containerd/runwasi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;runwasi&lt;/a&gt;é¡¹ç›®æ˜¯ WebAssembly å¦‚ä½•åœ¨ Kubernetes å†…éƒ¨æ‰§è¡Œçš„ç¤ºä¾‹ï¼ŒButcher è¯´ã€‚&lt;/p&gt;
&lt;p&gt;â€œrunwasi é¡¹ç›®ä»…ä»…æ˜¯ Kubernetes éœ€è¦ç»å†çš„ä¸€ç³»åˆ—è½¬å‹ä¸­çš„ç¬¬ä¸€æ­¥ï¼Œå¦‚æœå®ƒä¸æƒ³è¢« Nomad å’Œ Wasm è¶…è¶Šï¼Œå®ƒçš„å¼€å‘äººå‘˜å’Œç»´æŠ¤äººå‘˜éœ€è¦å¿«é€Ÿé‡‡å–è¡ŒåŠ¨ã€‚â€Butcher è¯´ã€‚â€œKubernetes çš„æ¸¸æˆè¦è¾“ï¼Œä½†å¦‚æœå®ƒä¸æƒ³è¢« Nomad å’Œ Wasm å–ä»£ï¼Œå®ƒä»¬éœ€è¦è¿…é€Ÿé‡‡å–è¡ŒåŠ¨ã€‚â€&lt;/p&gt;
&lt;h2 id=&#34;å­˜åœ¨çš„å¨èƒ&#34;&gt;å­˜åœ¨çš„å¨èƒ&lt;/h2&gt;
&lt;p&gt;WebAssembly å¯¹äº Docker ä»¥åŠå®¹å™¨æ„æˆäº†ä¸€ç§å­˜åœ¨çš„å¨èƒï¼Œå°½ç®¡åœ¨è¶…è¶Š Kubernetes æ–¹é¢ï¼ŒWebAssembly çš„ç®€å•æ€§ã€å¯ç§»æ¤æ€§å’Œå®‰å…¨æ€§ç­‰ä¼˜åŠ¿ä½¿å…¶æˆä¸ºå¼¥è¡¥ Docker ç¼ºé™·çš„è‰¯å¥½é€‰æ‹©ï¼Œç‰¹åˆ«æ˜¯å¯¹äºè¾¹ç¼˜å’Œåˆ†å¸ƒå¼åº”ç”¨ã€‚ç„¶è€Œï¼ŒButcher æŒ‡å‡ºï¼ŒDocker åœ¨ä»¥ä¸‹ä¸¤ç§åº”ç”¨ç¨‹åºæä¾›ç¯å¢ƒæ—¶è¡¨ç°å‡ºè‰²ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é•¿æ—¶é—´è¿è¡Œçš„è¿‡ç¨‹ï¼Œå¦‚æ•°æ®åº“å’Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿™äº›è¿‡ç¨‹éœ€è¦å¼ºå¤§çš„ I/O å’Œå†…å­˜ç®¡ç†èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;é—ç•™ï¼ˆä¼ ç»Ÿï¼‰ä»£ç ï¼Œè¯¥ä»£ç åœ¨åº”ç”¨ç¨‹åºä¸­ä¿ç•™çŠ¶æ€å¹¶å¤§é‡ä½¿ç”¨çº¿ç¨‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â€œButcher è¯´ï¼šâ€œæˆ‘å¯¹ Docker çš„çœ‹æ³•æ˜¯ï¼Œå®ƒåœ¨å¸‚åœºä¸Šæœ‰ä¸€ä¸ªå¼ºå¤§ä¸”ä¸å¯æ’¼åŠ¨çš„åœ°ä½ï¼ŒWebAssembly ä¸å¤ªå¯èƒ½å–ä»£å®ƒã€‚ä½†æ˜¯ï¼Œå½“æ¶‰åŠåˆ°å¾®æœåŠ¡å’Œ Web åº”ç”¨ç¨‹åºåç«¯æ—¶ï¼Œæˆ‘è®¤ä¸º WebAssembly æœ‰æœ›å‰Šå‡ Docker çš„ä½¿ç”¨ã€‚â€&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œå¯¹äºæŸäº›ç”¨ä¾‹æ¥è¯´ï¼ŒWasm å¯ä»¥æ›¿ä»£ Docker å’Œå®¹å™¨ï¼Œä½†æ˜¯åœ¨é«˜åº¦åˆ†å¸ƒå¼çš„äº‘åŸç”Ÿç¯å¢ƒä¸­ï¼Œä½¿ç”¨ Wasm æ¥ç¼–æ’å®¹å™¨å’Œå¾®æœåŠ¡ç¨‹åº¦ä¸Šä¸ Kubernetes ç›¸åŒçš„ç¨‹åº¦æ˜¯ä¸å¯èƒ½çš„ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>åˆ›å»ºé«˜æ•ˆ Kubernetes ç­–ç•¥çš„ 7 ä¸ªæ­¥éª¤</title>
      <link>https://cloudnativecn.com/blog/7-steps-to-highly-effective-kubernetes-policies/</link>
      <pubDate>Mon, 11 Sep 2023 09:03:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/7-steps-to-highly-effective-kubernetes-policies/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ªï¼š&lt;a href=&#34;https://thenewstack.io/7-steps-to-highly-effective-kubernetes-policies/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://thenewstack.io/7-steps-to-highly-effective-kubernetes-policies/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ‘˜è¦ï¼šæœ¬æ–‡ä»‹ç»äº† Kubernetes ç­–ç•¥çš„ä¸ƒä¸ªæ­¥éª¤ï¼ŒåŒ…æ‹¬åŸºçº¿ã€ä¿®å¤æ ‡ç­¾å’Œæ³¨é‡Šã€è¿ç§»åˆ°å—é™åˆ¶çš„ Pod Security æ ‡å‡†ã€å‹åˆ¶è¯¯æŠ¥ã€åŠ å…¥å¸¸è§åŠ å›ºæŒ‡å—ã€æ’å…¥å¹¶æ’­æ”¾ã€æ·»åŠ è‡ªå®šä¹‰è§„åˆ™ä»¥åº”å¯¹æœªé¢„æ–™çš„ç‰¹æ®Šæƒ…å†µã€‚é€šè¿‡å®æ–½è¿™äº›æ­¥éª¤ï¼Œå¯ä»¥é€æ­¥å‡å°‘é…ç½®é”™è¯¯å’Œæ¼æ´çš„æ•°é‡ï¼Œå®ç°è®¤è¯ã€åˆè§„å’Œé•¿æœŸå®‰å…¨ç›®æ ‡ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ä½ åˆšåˆšå¼€å§‹äº†ä¸€ä»½æ–°å·¥ä½œï¼Œåœ¨è¿™ä¸ªå·¥ä½œä¸­ï¼Œä½ ç¬¬ä¸€æ¬¡æœ‰è´£ä»»æ“ä½œå’Œç®¡ç† Kubernetes åŸºç¡€è®¾æ–½ã€‚ä½ å¯¹æ›´æ·±å…¥åœ°äº†è§£äº‘åŸç”Ÿå……æ»¡äº†çƒ­æƒ…ï¼Œä½†åŒæ—¶ä¹Ÿéå¸¸æ‹…å¿ƒã€‚&lt;/p&gt;
&lt;p&gt;æ˜¯çš„ï¼Œä½ å…³æ³¨çš„æ˜¯ç¼–å†™ç¬¦åˆå‘½åå’Œèµ„æºä½¿ç”¨æ§åˆ¶æœ€ä½³å®è·µçš„å®‰å…¨åº”ç”¨ç¨‹åºçš„æœ€ä½³æ–¹æ³•ï¼Œä½†æ˜¯å…³äºå·²ç»éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­çš„æ‰€æœ‰å…¶ä»–å†…å®¹å‘¢ï¼Ÿä½ æ‰“å¼€ä¸€ä¸ªæ–°çš„å·¥å…·æ¥æŸ¥çœ‹æ­£åœ¨å‘ç”Ÿçš„æƒ…å†µï¼Œå‘ç°æœ‰ 100 ä¸ªé«˜æˆ–ä¸¥é‡çš„ CVE å’Œ YAML é…ç½®é—®é¢˜ã€‚ä½ å…³é—­æ ‡ç­¾é¡µå‘Šè¯‰è‡ªå·±ï¼Œä½ ä»¥åä¼šå¤„ç†æ‰€æœ‰è¿™äº›é—®é¢˜çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä½ ä¼šå—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä¹Ÿè®¸æœ€æœ‰é›„å¿ƒå£®å¿—å’Œæ— æ‰€ç•æƒ§çš„äººä¼šï¼Œä½†é—®é¢˜åœ¨äºäº‘åŸç”Ÿç¤¾åŒºå–œæ¬¢è°ˆè®ºå®‰å…¨ã€æ ‡å‡†åŒ–å’Œâ€œå·¦ç§»â€ï¼Œä½†è¿™äº›å¯¹è¯éƒ½æ— æ³•å‡è½»å› å®‰å…¨ã€èµ„æºã€è¯­æ³•å’Œå·¥å…·é—®é¢˜è€Œäº§ç”Ÿçš„ä¸å®‰å…¨æ„Ÿã€‚æ²¡æœ‰ä¸€ä¸ªå¼€å‘èŒƒå¼æˆ–å·¥å…·ä¼¼ä¹å‘ç°äº†åœ¨ä¸å‹å®äººçš„æƒ…å†µä¸‹è®©é”™è¯¯é…ç½®å¯è§çš„æ­£ç¡®æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;å°±åƒæˆ‘ä»¬å¯èƒ½é¢å¯¹çš„æ‰€æœ‰å¾…åŠäº‹é¡¹åˆ—è¡¨ä¸€æ ·ï¼Œæ— è®ºæ˜¯å·¥ä½œè¿˜æ˜¯å®¶åŠ¡ï¼Œæˆ‘ä»¬çš„å¤§è„‘åªèƒ½æœ‰æ•ˆåœ°å¤„ç†æœ‰é™æ•°é‡çš„é—®é¢˜ã€‚å¤ªå¤šé—®é¢˜äº†ï¼Œæˆ‘ä»¬å°±ä¼šè¿·å¤±åœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œä¼˜å…ˆå¤„ç†ä¸å®Œæ•´çš„ä¸´æ—¶è§£å†³æ–¹æ¡ˆä¹‹é—´ã€‚æˆ‘ä»¬éœ€è¦æ›´å¥½çš„æ–¹æ³•æ¥é™åˆ¶èŒƒå›´ï¼ˆå³åˆ†ç±»ï¼‰ï¼Œè®¾ç½®é‡Œç¨‹ç¢‘ï¼Œæœ€ç»ˆä½¿å®‰å…¨å·¥ä½œå¯ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;æ˜¯æ—¶å€™å¿½ç•¥é—®é¢˜çš„æ•°é‡ï¼Œä¸“æ³¨äºäº¤äº’åœ°å¡‘é€ ï¼Œç„¶åå¼ºåˆ¶æ‰§è¡Œä½ çš„ç»„ç»‡ä½¿ç”¨å·²å»ºç«‹ç­–ç•¥çš„æ–¹å¼ï¼Œä»¥äº§ç”Ÿå½±å“â€”â€”æ— éœ€äº§ç”Ÿä¸å®‰å…¨æ„Ÿã€‚&lt;/p&gt;
&lt;h2 id=&#34;äº‘åŸç”Ÿç­–ç•¥çš„å†å²&#34;&gt;äº‘åŸç”Ÿç­–ç•¥çš„å†å²&lt;/h2&gt;
&lt;p&gt;ä» Kubernetes çš„ç¬¬ä¸€å¤©å¼€å§‹ï¼ŒYAML é…ç½®å°±æ˜¯æ„å»ºå®Œæ•´é›†ç¾¤å’Œè¿è¡Œåº”ç”¨ç¨‹åºçš„åŸºçŸ³ã€‚ä½œä¸ºå¼€å‘äººå‘˜åº”ç”¨ç¨‹åºä»£ç å’Œè¿ç»´å·¥ç¨‹å¸ˆç»´æŠ¤é›†ç¾¤ä¹‹é—´çš„å¿…è¦æ¡¥æ¢ï¼Œå®ƒä»¬ä¸ä»…éš¾ä»¥æ­£ç¡®è·å–ï¼Œè€Œä¸”è¿˜æ˜¯ Kubernetes ä¸­å¤§å¤šæ•°éƒ¨ç½²/æœåŠ¡çº§åˆ«é—®é¢˜çš„æ ¹æºã€‚æ›´æœ‰ç”šè€…ï¼Œæ²¡æœ‰äººâ€”â€”æ—¢ä¸æ˜¯å¼€å‘äººå‘˜ï¼Œä¹Ÿä¸æ˜¯è¿ç»´å·¥ç¨‹å¸ˆâ€”â€”æƒ³ç‹¬è‡ªå¯¹æ­¤è´Ÿè´£ã€‚&lt;/p&gt;
&lt;p&gt;ç­–ç•¥ä½œä¸ºä¸€ç§è‡ªåŠ¨åŒ–çš„æ–¹å¼è¿›å…¥äº†äº‘åŸç”Ÿç©ºé—´ï¼Œç”¨äºç¼–å†™å’Œå®¡æ‰¹ä¸ºç”Ÿäº§ç¯å¢ƒç¼–å†™çš„ YAML é…ç½®ã€‚å¦‚æœæ²¡æœ‰ä¸€ä¸ªäººæˆ–å›¢é˜Ÿæƒ³è¦æ ¹æ®å†…éƒ¨æ ·å¼æŒ‡å—æ‰‹åŠ¨æ£€æŸ¥æ¯ä¸ªé…ç½®ï¼Œé‚£ä¹ˆç­–ç•¥å¯ä»¥æ…¢æ…¢å¡‘é€ å›¢é˜Ÿè§£å†³å®‰å…¨ã€èµ„æºä½¿ç”¨å’Œäº‘åŸç”Ÿæœ€ä½³å®è·µä¸­çš„å¸¸è§é…ç½®é”™è¯¯çš„æ–¹å¼ã€‚æ›´ä¸ç”¨è¯´ä»»ä½•å”¯ä¸€åº”ç”¨ç¨‹åºçš„è§„åˆ™æˆ–ä¹ è¯­äº†ã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes ä¸­ç­–ç•¥çš„æŒ‘æˆ˜åœ¨äºå®ƒå¯¹å¦‚ä½•ã€ä½•æ—¶å’Œä¸ºä»€ä¹ˆæ‰§è¡Œå®ƒä»¬æ˜¯ä¸å¯çŸ¥çš„ã€‚ä½ å¯ä»¥ç”¨å¤šç§æ–¹å¼ç¼–å†™è§„åˆ™ï¼Œåœ¨è½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸï¼ˆSDLCï¼‰çš„ä¸åŒç‚¹æ‰§è¡Œå®ƒä»¬ï¼Œå¹¶å‡ºäºä¸åŒçš„åŸå› ä½¿ç”¨å®ƒä»¬ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ­¤æ··ä¹±ä¸­ï¼Œæ²¡æœ‰æ¯” Pod å®‰å…¨ç­–ç•¥ï¼ˆPSPï¼‰æ›´å¥½çš„ä¾‹å­äº†ï¼Œå®ƒåœ¨ 2016 å¹´ v1.3 ä¸­è¿›å…¥ Kubernetes ç”Ÿæ€ç³»ç»Ÿã€‚PSP çš„è®¾è®¡ç›®çš„æ˜¯æ§åˆ¶ pod çš„æ“ä½œæ–¹å¼å¹¶æ‹’ç»ä»»ä½•ä¸ç¬¦åˆè¦æ±‚çš„é…ç½®ã€‚ä¾‹å¦‚ï¼Œå®ƒå…è®¸ K8s ç®¡ç†å‘˜é˜²æ­¢å¼€å‘äººå‘˜åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œç‰¹æƒ podï¼Œä»è€Œå®è´¨ä¸Šå°†ä½çº§åˆ«çš„ Linux å®‰å…¨å†³ç­–ä¸å¼€å‘ç”Ÿå‘½å‘¨æœŸåˆ†ç¦»å¼€æ¥ã€‚&lt;/p&gt;
&lt;p&gt;PSP ä»æœªç¦»å¼€ beta é˜¶æ®µï¼Œæœ‰å‡ ä¸ªå¾ˆå¥½çš„ç†ç”±ã€‚è¿™äº›æ”¿ç­–ä»…åœ¨äººæˆ–è¿›ç¨‹è¯·æ±‚åˆ›å»º pod æ—¶åº”ç”¨ï¼Œè¿™æ„å‘³ç€æ²¡æœ‰åŠæ³•å¯¹ PSP è¿›è¡Œæ”¹è¿›æˆ–é»˜è®¤å¯ç”¨ã€‚Kubernetes å›¢é˜Ÿæ‰¿è®¤ PSP ä½¿æ„å¤–æˆäºˆè¿‡äºå¹¿æ³›çš„æƒé™å˜å¾—å¤ªå®¹æ˜“äº†ï¼Œé™¤äº†&lt;a href=&#34;https://youtu.be/SFtHRmPuhEw?feature=shared&amp;amp;t=970&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…¶ä»–å›°éš¾&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes å®‰å…¨é¢†åŸŸçš„ PSP æ—¶ä»£å……æ»¡äº†é£é™©ï¼Œè¿™å¯å‘äº†ä¸€ä¸ªæ–°çš„å‘å¸ƒå‘¨æœŸç®¡ç†è§„åˆ™ï¼šä»»ä½• Kubernetes é¡¹ç›®ä¸èƒ½è¶…è¿‡ä¸¤ä¸ªå‘å¸ƒå‘¨æœŸå¤„äº beta çŠ¶æ€ï¼Œå¿…é¡»æˆä¸ºç¨³å®šçš„æˆ–è€…æ ‡è®°ä¸º[å¼ƒç”¨](&lt;a href=&#34;https://kubernetes.io/docs/tasks/configure-pod-container/migrate-from-psp/#disable-psp&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.io/docs/tasks/configure-pod-container/migrate-from-psp/#disable-psp&lt;/a&gt; &lt;a href=&#34;https://kubernetes.io/blog/2021/04/06/podsecuritypolicy-deprecation-past-present-and-future/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.io/blog/2021/04/06/podsecuritypolicy-deprecation-past-present-and-future/&lt;/a&gt;)å’Œåˆ é™¤ã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€æ–¹é¢ï¼ŒPSP ä½¿ Kubernetes å®‰å…¨é¢†åŸŸæœç€ç§¯æçš„æ–¹å‘å‘å±•ï¼šé€šè¿‡å°† Kubernetes å®‰å…¨ç­–ç•¥çš„åˆ›å»ºå’Œå®ä¾‹åŒ–åˆ†ç¦»ï¼ŒPSP å¼€è¾Ÿäº†ä¸€ä¸ªæ–°çš„å¤–éƒ¨æ¥å…¥æ§åˆ¶å™¨å’Œç­–ç•¥æ‰§è¡Œå·¥å…·ç”Ÿæ€ç³»ç»Ÿï¼Œä¾‹å¦‚&lt;a href=&#34;https://kyverno.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kyverno&lt;/a&gt;ã€&lt;a href=&#34;https://open-policy-agent.github.io/gatekeeper/website/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gatekeeper&lt;/a&gt;å’Œ&lt;a href=&#34;https://monokle.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Monokle&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ç”¨è¿™äº›å·¥å…·æ‘†è„±äº† PSP çš„æŸç¼šï¼Œå¹¶ç”¨ Pod Security Standardï¼ˆPSSï¼‰æ›¿æ¢äº†å®ƒã€‚ä¸€ä¼šæˆ‘ä»¬å†æ¥è°ˆè¿™ä¸ªå·¨å¤§çš„åŒºåˆ«ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åŸºäºé˜¶æ®µçš„-kubernetes-ç­–ç•¥æ–¹æ³•&#34;&gt;åŸºäºé˜¶æ®µçš„ Kubernetes ç­–ç•¥æ–¹æ³•&lt;/h2&gt;
&lt;p&gt;åœ¨ç¡®å®šäº†ç­–ç•¥åˆ›å»ºå’Œå®ä¾‹åŒ–ä¹‹é—´çš„è§£è€¦åï¼Œæ‚¨ç°åœ¨å¯ä»¥åœ¨ä¸ç®¡æ‚¨é€‰æ‹©å“ªäº›å·¥å…·çš„æƒ…å†µä¸‹ï¼Œåœ¨æ‚¨çš„é›†ç¾¤ã€ç¯å¢ƒå’Œå›¢é˜Ÿä¹‹é—´åº”ç”¨ä¸€è‡´çš„ç­–ç•¥è¯­è¨€ã€‚æ‚¨ä¹Ÿå¯ä»¥éšæ—¶æ›´æ”¹æ‚¨ç”¨äºåˆ›å»ºå’Œå®ä¾‹åŒ–çš„å·¥å…·ï¼Œå¹¶åœ¨æ‚¨çš„é›†ç¾¤ä¸­è·å¾—å¯é çš„ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;åˆ›å»ºé€šå¸¸å‘ç”Ÿåœ¨é›†æˆå¼€å‘ç¯å¢ƒï¼ˆIDEï¼‰ä¸­ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥ç»§ç»­ä½¿ç”¨æ‚¨å½“å‰æœ€å–œæ¬¢çš„è¯­è¨€æ¥ä½¿ç”¨è§„åˆ™ç‰¹å®šçš„è¯­è¨€ï¼Œå¦‚&lt;a href=&#34;https://monokle.io/learn/what-is-opa-for-the-kubernetes-connoisseur-its-as-essential-as-salt&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Open Policy Agent (OPA)&lt;/a&gt;ã€Kyverno çš„å£°æ˜æ€§è¯­æ³•æˆ– Go æˆ– TypeScript ç­‰ç¼–ç¨‹è¯­è¨€ã€‚&lt;/p&gt;
&lt;p&gt;å®ä¾‹åŒ–å’Œå¼ºåˆ¶æ‰§è¡Œå¯ä»¥åœ¨è½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸçš„ä¸åŒéƒ¨åˆ†è¿›è¡Œã€‚æ­£å¦‚æˆ‘ä»¬åœ¨æˆ‘ä»¬ä¹‹å‰çš„&lt;a href=&#34;https://medium.com/kubeshop-i/kubernetes-yaml-policies-101-649a23780371&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;101 çº§å¸–å­&lt;/a&gt;ä¸­çœ‹åˆ°çš„é‚£æ ·ï¼Œæ‚¨å¯ä»¥åœ¨é…ç½®ç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªæˆ–å¤šä¸ªç‚¹åº”ç”¨éªŒè¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é€šè¿‡å¼€å‘äººå‘˜çš„å‘½ä»¤è¡Œç•Œé¢ï¼ˆCLIï¼‰æˆ– IDE ç›´æ¥é¢„æäº¤&lt;/li&gt;
&lt;li&gt;é€šè¿‡æ‚¨çš„CI/CDæµæ°´çº¿è¿›è¡Œé¢„éƒ¨ç½²&lt;/li&gt;
&lt;li&gt;é€šè¿‡åƒ Kyverno æˆ– Gatekeeper è¿™æ ·çš„&lt;a href=&#34;https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ¥å…¥æ§åˆ¶å™¨&lt;/a&gt;è¿›è¡Œåéƒ¨ç½²ï¼Œæˆ–è€…&lt;/li&gt;
&lt;li&gt;åœ¨é›†ç¾¤ä¸­æ£€æŸ¥éƒ¨ç½²çŠ¶æ€æ˜¯å¦ä»ç¬¦åˆæ‚¨çš„ç­–ç•¥æ ‡å‡†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç­–ç•¥çš„å®ä¾‹åŒ–ã€éªŒè¯å’Œå¼ºåˆ¶æ‰§è¡Œè¶Šæ™šï¼Œå±é™©çš„é”™è¯¯é…ç½®å°±è¶Šå®¹æ˜“æ»‘å…¥ç”Ÿäº§ç¯å¢ƒï¼Œå‘ç°å’Œä¿®å¤ä»»ä½•å‘ç°çš„é”™è¯¯é…ç½®çš„åŸå§‹æ¥æºæ‰€éœ€çš„å·¥ä½œä¹Ÿè¶Šå¤šã€‚æ‚¨å¯ä»¥åœ¨å‡ ä¸ªé˜¶æ®µå®ä¾‹åŒ–å’Œå¼ºåˆ¶æ‰§è¡Œç­–ç•¥ï¼Œä½†è¶Šæ—©è¶Šå¥½â€”â€”è¿™æ­£æ˜¯ Monokle æ“…é•¿çš„ï¼Œå…·æœ‰å¼ºå¤§çš„é¢„æäº¤å’Œé¢„éƒ¨ç½²éªŒè¯æ”¯æŒã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äº†è¿™ä¸ªåœºæ™¯ï¼Œä»¥åŠå¯¹ Kubernetes ç­–ç•¥æ™¯è§‚çš„ç†è§£ï¼Œæ‚¨å¯ä»¥å¼€å§‹æ¶ˆé™¤æ‚¨é¢å‰çš„è¯¯é…ç½®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ­¥éª¤-1å®æ–½-pod-security-æ ‡å‡†&#34;&gt;æ­¥éª¤ 1ï¼šå®æ–½ Pod Security æ ‡å‡†&lt;/h3&gt;
&lt;p&gt;è®©æˆ‘ä»¬ä»å‰é¢æåˆ°çš„ PSS å¼€å§‹ã€‚Kubernetes ç°åœ¨æè¿°äº†&lt;a href=&#34;https://kubernetes.io/docs/concepts/security/pod-security-standards/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸‰ä¸ªåŒ…å®¹æ€§ç­–ç•¥&lt;/a&gt;ï¼Œæ‚¨å¯ä»¥å¿«é€Ÿåœ¨æ•´ä¸ªé›†ç¾¤ä¸­å®æ–½å’Œæ‰§è¡Œã€‚ â€œç‰¹æƒâ€ç­–ç•¥å®Œå…¨ä¸å—é™åˆ¶ï¼Œåº”è¯¥ä»…ä¿ç•™ç»™ç”±ç®¡ç†å‘˜ç®¡ç†çš„ç³»ç»Ÿå’ŒåŸºç¡€è®¾æ–½å·¥ä½œè´Ÿè½½ã€‚&lt;/p&gt;
&lt;p&gt;æ‚¨åº”è¯¥ä»å®ä¾‹åŒ–â€œåŸºçº¿â€ç­–ç•¥å¼€å§‹ï¼Œå®ƒå…è®¸æœ€å°è§„æ ¼çš„ Podï¼Œè¿™æ˜¯å¤§å¤šæ•°æ–°æ¥è§¦ Kubernetes çš„å¼€å‘äººå‘˜å¼€å§‹çš„åœ°æ–¹ï¼š&lt;/p&gt;
&lt;p&gt;ä»åŸºçº¿å¼€å§‹çš„å¥½å¤„æ˜¯ï¼Œæ‚¨æ— éœ€ä¿®æ”¹æ‰€æœ‰ç°æœ‰çš„ Dockerfile å’Œ Kubernetes é…ç½®å³å¯é˜²æ­¢å·²çŸ¥çš„æƒé™å‡çº§ã€‚ä¼šæœ‰ä¸€äº›ä¾‹å¤–æƒ…å†µï¼Œç¨åæˆ‘ä¼šè°ˆåˆ°ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å‘½åç©ºé—´çº§åˆ«ä¸Šåˆ›å»ºå’Œå®ä¾‹åŒ–è¿™ä¸ªç­–ç•¥çº§åˆ«æ˜¯ç›¸å¯¹ç®€å•çš„ï¼š&lt;/p&gt;
&lt;p&gt;æ‚¨è‚¯å®šä¼šæœ‰ä¸€äº›ç‰¹æ®Šçš„æœåŠ¡éœ€è¦æ¯”åŸºçº¿å…è®¸çš„è®¿é—®æƒé™æ›´å¤šï¼Œä¾‹å¦‚ç”¨äºæ”¶é›†æ—¥å¿—å’Œå¯è§‚å¯Ÿæ€§çš„&lt;a href=&#34;https://grafana.com/docs/loki/latest/clients/promtail/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Promtail ä»£ç†&lt;/a&gt;ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦åœ¨ç‰¹æƒç­–ç•¥ä¸‹è¿è¡Œé‚£äº›å‘½åç©ºé—´ã€‚æ‚¨éœ€è¦è·Ÿè¿›è¯¥ä¾›åº”å•†çš„å®‰å…¨æ”¹è¿›ï¼Œä»¥é™åˆ¶æ‚¨çš„é£é™©ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡å¼ºåˆ¶æ‰§è¡Œ Pod Security æ ‡å‡†çš„åŸºçº¿æ°´å¹³æ¥å¤„ç†å¤§å¤šæ•°é…ç½®ï¼Œå¹¶å…è®¸ä¸€äº›ç‰¹æƒé…ç½®ï¼Œç„¶åä¿®å¤è¿åè¿™äº›ç­–ç•¥çš„ä»»ä½•è¯¯é…ç½®ï¼Œæ‚¨å°±å®Œæˆäº†ä¸‹ä¸€ä¸ªç­–ç•¥é‡Œç¨‹ç¢‘ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ­¥éª¤-2ä¿®å¤æ ‡ç­¾å’Œæ³¨é‡Š&#34;&gt;æ­¥éª¤ 2ï¼šä¿®å¤æ ‡ç­¾å’Œæ³¨é‡Š&lt;/h3&gt;
&lt;p&gt;æ ‡ç­¾ç”¨äºæ ‡è¯†èµ„æºè¿›è¡Œåˆ†ç»„æˆ–è¿‡æ»¤ï¼Œè€Œæ³¨é‡Šåˆ™ç”¨äºé‡è¦ä½†ä¸ç”¨äºè¯†åˆ«çš„ä¸Šä¸‹æ–‡ã€‚å¦‚æœæ‚¨çš„å¤´è„‘ä»åœ¨æ—‹è½¬ï¼Œæ¥è‡ª Ambassador Labs çš„ Richard Li çš„&lt;a href=&#34;https://blog.getambassador.io/kubernetes-labels-vs-annotations-95fc47196b6d&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸€ä¸ªæ–¹ä¾¿çš„å®šä¹‰&lt;/a&gt;å¯èƒ½ä¼šå¸®åŠ©ï¼šâ€œæ ‡ç­¾æ˜¯ä¸º Kubernetes è€Œè®¾è®¡çš„ï¼Œè€Œæ³¨é‡Šæ˜¯ä¸ºäººç±»è€Œè®¾è®¡çš„ã€‚â€&lt;/p&gt;
&lt;p&gt;æ ‡ç­¾åº”ä»…ç”¨äºå…¶é¢„å®šç›®çš„ï¼Œå³ä½¿åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨åœ¨ä½•å¤„ä»¥åŠå¦‚ä½•åº”ç”¨å®ƒä»¬æ—¶ä¹Ÿè¦å°å¿ƒã€‚è¿‡å»ï¼Œ&lt;a href=&#34;https://sysdig.com/blog/exposed-prometheus-exploit-kubernetes-kubeconeu/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ”»å‡»è€…å·²ä½¿ç”¨æ ‡ç­¾&lt;/a&gt;æ·±å…¥æ¢ç´¢ Kubernetes é›†ç¾¤çš„æ¶æ„ï¼ŒåŒ…æ‹¬å“ªäº›èŠ‚ç‚¹è¿è¡Œå•ä¸ª Podï¼Œè€Œä¸ç•™ä¸‹è¿è¡Œçš„æŸ¥è¯¢çš„æ—¥å¿—ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ ·çš„æƒ³æ³•ä¹Ÿé€‚ç”¨äºæ³¨é‡Šï¼šè™½ç„¶å®ƒä»¬æ˜¯ä¸ºäººç±»è€Œè®¾è®¡çš„ï¼Œä½†å®ƒä»¬ç»å¸¸è¢«ç”¨äº&lt;a href=&#34;https://github.com/kubernetes/ingress-nginx/issues/8503&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è·å–å‡­è¯&lt;/a&gt;ï¼Œè¿›è€Œè·å¾—è®¿é—®æ›´å¤šç§˜å¯†çš„æƒé™ã€‚å¦‚æœæ‚¨ä½¿ç”¨æ³¨é‡Šæ¥æè¿°åº”åœ¨å‡ºç°é—®é¢˜çš„æƒ…å†µä¸‹è”ç³»çš„äººå‘˜ï¼Œè¯·çŸ¥é“æ‚¨æ­£åœ¨ä¸ºç¤¾äº¤å·¥ç¨‹æ”»å‡»åˆ›å»ºé¢å¤–çš„è½¯ç›®æ ‡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ­¥éª¤-3è¿ç§»åˆ°å—é™åˆ¶çš„-pss&#34;&gt;æ­¥éª¤ 3ï¼šè¿ç§»åˆ°å—é™åˆ¶çš„ PSS&lt;/h3&gt;
&lt;p&gt;è™½ç„¶åŸºçº¿æ˜¯å¯å…è®¸ä½†ç›¸å¯¹å®‰å…¨çš„ï¼Œä½†â€œå—é™åˆ¶â€Pod Security æ ‡å‡†é‡‡ç”¨äº†ç›®å‰åŠ å›º Pod çš„æœ€ä½³å®è·µã€‚æ­£å¦‚ Red Hat çš„ Mo Khan&lt;a href=&#34;https://youtu.be/SFtHRmPuhEw?t=1951&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ›¾ç»æè¿°&lt;/a&gt;çš„é‚£æ ·ï¼Œå—é™åˆ¶çš„æ ‡å‡†ç¡®ä¿â€œæ‚¨èƒ½åšçš„æœ€ç³Ÿç³•çš„äº‹æƒ…æ˜¯æ¯æ‰è‡ªå·±â€ï¼Œè€Œä¸æ˜¯æ‚¨çš„é›†ç¾¤ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨å—é™åˆ¶çš„æ ‡å‡†ï¼Œå¼€å‘äººå‘˜å¿…é¡»ç¼–å†™åœ¨åªè¯»æ¨¡å¼ä¸‹è¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œä»…å¯ç”¨ Pod è¿è¡Œæ‰€éœ€çš„ Linux åŠŸèƒ½ï¼Œä¸èƒ½åœ¨ä»»ä½•æ—¶å€™å‡çº§ç‰¹æƒç­‰ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å»ºè®®ä»åŸºçº¿å¼€å§‹å¹¶ç¨åè¿ç§»åˆ°å—é™åˆ¶ï¼Œä½œä¸ºå•ç‹¬çš„é‡Œç¨‹ç¢‘ï¼Œå› ä¸ºåè€…å‡ ä¹æ€»æ˜¯éœ€è¦å¯¹ç°æœ‰çš„ Dockerfile å’Œ Kubernetes é…ç½®è¿›è¡Œä¸»åŠ¨æ›´æ”¹ã€‚ä¸€æ—¦æ‚¨å®ä¾‹åŒ–å¹¶å¼ºåˆ¶æ‰§è¡Œäº†å—é™åˆ¶ç­–ç•¥ï¼Œæ‚¨çš„é…ç½®å°†éœ€è¦éµå®ˆè¿™äº›ç­–ç•¥ï¼Œå¦åˆ™å®ƒä»¬å°†è¢«æ‚¨çš„éªŒè¯å™¨æˆ–æ¥å…¥æ§åˆ¶å™¨æ‹’ç»ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ­¥éª¤-3aå‹åˆ¶è€Œä¸æ˜¯å¿½ç•¥ä¸å¯é¿å…çš„è¯¯æŠ¥&#34;&gt;æ­¥éª¤ 3aï¼šå‹åˆ¶è€Œä¸æ˜¯å¿½ç•¥ä¸å¯é¿å…çš„è¯¯æŠ¥&lt;/h3&gt;
&lt;p&gt;åœ¨å®ŒæˆåŸºçº¿å’Œå—é™åˆ¶çš„é‡Œç¨‹ç¢‘æ—¶ï¼Œæ‚¨æ­£åœ¨æ¥è¿‘ç­–ç•¥ç®¡ç†çš„æ›´æˆç†Ÿï¼ˆå’Œå¤æ‚ï¼‰æ°´å¹³ã€‚ä¸ºäº†ç¡®ä¿æ¯ä¸ªäººéƒ½åœ¨å½“å‰ç­–ç•¥é‡Œç¨‹ç¢‘æ–¹é¢ä¿æŒä¸€è‡´ï¼Œæ‚¨åº”è¯¥å¼€å§‹å¤„ç†è™šå‡é˜³æ€§æˆ–å¿…é¡»æ˜¾å¼å…è®¸çš„é…ç½®ï¼Œå°½ç®¡è¿åäº†å—é™åˆ¶çš„ PSSã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å¿½ç•¥è§„åˆ™æˆ–æŠ‘åˆ¶è§„åˆ™ä¹‹é—´è¿›è¡Œé€‰æ‹©æ—¶ï¼Œå§‹ç»ˆé€‰æ‹©æŠ‘åˆ¶è§„åˆ™ã€‚è¿™éœ€è¦ä¸€ä¸ªå¯å®¡è®¡çš„æ“ä½œï¼Œå…·æœ‰æ—¥å¿—æˆ–é…ç½®æ›´æ”¹ï¼Œä»¥å°†ä¾‹å¤–æƒ…å†µç¼–ç ä¸ºå·²å»ºç«‹çš„ç­–ç•¥æ¡†æ¶ã€‚æ‚¨å¯ä»¥åœ¨æºä¸­æ·»åŠ æŠ‘åˆ¶è§„åˆ™ï¼Œç›´æ¥æ·»åŠ åˆ°æ‚¨çš„ K8s é…ç½®ä¸­æˆ–åœ¨å¤–éƒ¨æ·»åŠ ï¼Œå…¶ä¸­å¼€å‘äººå‘˜è¯·æ±‚å…¶è¿ç»´åŒè¡Œé‡æ–°é…ç½®å…¶éªŒè¯å™¨æˆ–æ¥å…¥æ§åˆ¶å™¨ï¼Œä»¥å…è®¸â€œè¯¯é…ç½®â€é€šè¿‡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Monokle ä¸­ï¼Œæ‚¨å¯ä»¥å°†æŠ‘åˆ¶ç›´æ¥æ·»åŠ åˆ°æ‚¨çš„é…ç½®ä¸­ä½œä¸ºæ³¨é‡Šï¼Œä½¿ç”¨&lt;a href=&#34;https://docs.oasis-open.org/sarif/sarif/v2.1.0/sarif-v2.1.0.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é™æ€åˆ†æç»“æœäº¤æ¢æ ¼å¼ï¼ˆSARIFï¼‰è§„èŒƒ&lt;/a&gt;æ‰€ç§°çš„&lt;a href=&#34;https://docs.oasis-open.org/sarif/sarif/v2.1.0/os/sarif-v2.1.0-os.html#_Toc34317739&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç†ç”±&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;h3 id=&#34;ç¬¬-4-æ­¥åŠ å…¥å¸¸è§åŠ å›ºæŒ‡å—&#34;&gt;ç¬¬ 4 æ­¥ï¼šåŠ å…¥å¸¸è§åŠ å›ºæŒ‡å—&lt;/h3&gt;
&lt;p&gt;åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæ‚¨å·²ç»è¶…è¶Šäº†å·²æœ‰çš„ Kubernetes å®‰å…¨æ¡†æ¶ï¼Œè¿™æ„å‘³ç€æ‚¨éœ€è¦æ›´å¤šåœ°ç§¯ææ„å»ºå’ŒåŠªåŠ›å®ç°è‡ªå·±çš„é‡Œç¨‹ç¢‘ã€‚&lt;/p&gt;
&lt;p&gt;ç¾å›½å›½å®¶å®‰å…¨å±€ï¼ˆNSAï¼‰å’Œç½‘ç»œå®‰å…¨å’ŒåŸºç¡€è®¾æ–½å®‰å…¨å±€ï¼ˆCISAï¼‰æœ‰ä¸€ä»½å—æ¬¢è¿çš„&lt;a href=&#34;https://media.defense.gov/2022/Aug/29/2003066362/-1/-1/0/CTR_KUBERNETES_HARDENING_GUIDANCE_1.2_20220829.PDF&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes åŠ å›ºæŒ‡å—&lt;/a&gt;ï¼Œå…¶ä¸­è¯¦ç»†ä»‹ç»äº†ä¸ä»…æ˜¯ Pod çº§åˆ«çš„æ”¹è¿›æªæ–½ï¼Œå¦‚æœ‰æ•ˆåœ°ä½¿ç”¨ä¸å¯å˜å®¹å™¨æ–‡ä»¶ç³»ç»Ÿï¼Œè¿˜åŒ…æ‹¬ç½‘ç»œåˆ†ç¦»ã€å®¡è®¡æ—¥å¿—å’Œå¨èƒæ£€æµ‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¬¬-5-æ­¥æ’å…¥å¹¶æ’­æ”¾&#34;&gt;ç¬¬ 5 æ­¥ï¼šæ’å…¥å¹¶æ’­æ”¾&lt;/h3&gt;
&lt;p&gt;åœ¨å®æ–½äº†ä¸€äº›æˆ–æ‰€æœ‰å·²æœ‰çš„åŠ å›ºæŒ‡å—ä¹‹åï¼Œæ¯ä¸ªæ–°çš„ç­–ç•¥éƒ½æ¶‰åŠé€‰æ‹©ã€ä¿¡ä»»å’Œæƒè¡¡ã€‚èŠ±äº›æ—¶é—´åœ¨è°·æ­Œæˆ– StackOverflow ä¸Šï¼Œä½ å°±ä¼šå‘ç°å¾ˆå¤šæ¨èçš„æ’å…¥å’Œæ’­æ”¾ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥ä»ä¼—åŒ…ç­–ç•¥ä¸­å—ç›Šï¼Œå…¶ä¸­è®¸å¤šæ¥è‡ªäºé‚£äº›æœ‰ç€æ›´ç‹¬ç‰¹ç»éªŒçš„äººï¼Œä½†è¯·è®°ä½ï¼Œè™½ç„¶è§„åˆ™å¯èƒ½æ˜¯å‡ºäºè‰¯å¥½æ„å›¾çš„ï¼Œä½†ä½ å¹¶ä¸äº†è§£æ¨èè€…çš„ä¼˜å…ˆäº‹é¡¹æˆ–æ“ä½œä¸Šä¸‹æ–‡ã€‚ä»–ä»¬çŸ¥é“å¦‚ä½•å®ç°æŸäº›â€œé«˜æŒ‚æ°´æœâ€æ”¿ç­–ï¼Œå› ä¸ºä»–ä»¬ä¸å¾—ä¸è¿™æ ·åšï¼Œè€Œä¸æ˜¯å› ä¸ºè¿™äº›æ”¿ç­–æ™®éæœ‰ä»·å€¼ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰æ­£åœ¨è¿›è¡Œçš„è¾©è®ºæ˜¯æ˜¯å¦ä»¥åŠå¦‚ä½•ä¸¥æ ¼é™åˆ¶å®¹å™¨çš„èµ„æºéœ€æ±‚ã€‚å¯¹äºè¯·æ±‚é™åˆ¶ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¸é…ç½®é™åˆ¶å¯èƒ½ä¼šå¼•å…¥å®‰å…¨é£é™©ï¼Œä½†å¦‚æœä¸¥é‡é™åˆ¶ Podï¼Œå®ƒä»¬å¯èƒ½æ— æ³•æ­£å¸¸è¿è¡Œã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¬¬-6-æ­¥æ·»åŠ è‡ªå®šä¹‰è§„åˆ™ä»¥åº”å¯¹æœªé¢„æ–™çš„ç‰¹æ®Šæƒ…å†µ&#34;&gt;ç¬¬ 6 æ­¥ï¼šæ·»åŠ è‡ªå®šä¹‰è§„åˆ™ä»¥åº”å¯¹æœªé¢„æ–™çš„ç‰¹æ®Šæƒ…å†µ&lt;/h3&gt;
&lt;p&gt;ç°åœ¨ï¼Œä½ å·²ç»åˆ°äº† Kubernetes ç­–ç•¥çš„è¿œç«¯ï¼Œè¿œç¦»äº†å¯¼è‡´ç”Ÿäº§è´Ÿé¢å½±å“çš„ 20ï¼…çš„é”™è¯¯é…ç½®å’Œæ¼æ´ã€‚ä½†å³ä½¿ç°åœ¨ï¼Œå³ä½¿å·²ç»å®æ–½äº†æ‰€æœ‰çš„æœ€ä½³å®è·µå’Œé›†ä½“äº‘åŸç”ŸçŸ¥è¯†ï¼Œä½ ä»ç„¶æ— æ³•å…ç–«ä¸ä¼šæ„åœ°å¼•å‘äº‹æ•…æˆ–åœæœºçš„é”™è¯¯é…ç½® - å®‰å…¨å’Œç¨³å®šçš„å¥‡å¦™æœªçŸ¥æœªçŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªå¥½çš„ç»éªŒæ³•åˆ™æ˜¯ï¼Œå¦‚æœä¸€ä¸ªå¥‡ç‰¹çš„ï¼ˆé”™ï¼‰é…ç½®åœ¨ç”Ÿäº§ä¸­å¼•èµ·äº†ä¸¤æ¬¡é—®é¢˜ï¼Œé‚£ä¹ˆå°±è¯¥å°†å…¶ç¼–ç ä¸ºä¸€æ¡è‡ªå®šä¹‰è§„åˆ™ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­å¼ºåˆ¶æ‰§è¡Œï¼Œæˆ–ç”±å‡†å…¥æ§åˆ¶å™¨å¼ºåˆ¶æ‰§è¡Œã€‚å®ƒå¤ªé‡è¦äº†ï¼Œä¸èƒ½ä»…åœ¨å†…éƒ¨æ‚„æ‚„åœ°è®°å½•ä¸‹æ¥ï¼Œå¸Œæœ›å¼€å‘äººå‘˜é˜…è¯»å®ƒï¼Œåœ¨å½¼æ­¤çš„æ‹‰å–è¯·æ±‚å®¡æŸ¥ä¸­æ³¨æ„åˆ°å®ƒå¹¶æ•è·å®ƒã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦ç¼–ç åˆ°æ‚¨ç°æœ‰çš„ç­–ç•¥ä¸­ï¼Œè‡ªå®šä¹‰è§„åˆ™å°±æˆä¸ºäº†æ‚¨å°½å¯èƒ½æ¥è¿‘å¼€å‘äººå‘˜æ‰§è¡Œçš„é˜²æŠ¤æ æ†ã€‚å¦‚æœä½ å¯ä»¥åœ¨å¼€å‘äººå‘˜æäº¤å·¥ä½œä¹‹å‰å°±ç”¨éªŒè¯åˆ°è¾¾å¼€å‘äººå‘˜ï¼ŒMonokle Cloud å°±å¯ä»¥æ— ç¼åœ°æ‰§è¡Œè¿™ä¸€ç‚¹ï¼Œä½¿ç”¨è‡ªå®šä¹‰æ’ä»¶å’Œæ‚¨æœ¬åœ°è¿è¡Œçš„å¼€å‘æœåŠ¡å™¨ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥èŠ‚çœæ•´ä¸ªç»„ç»‡å¤§é‡çš„é‡å¤å·¥ä½œå’Œè°ƒæ•´ä»–ä»¬çš„æ‹‡æŒ‡ç­‰å¾… CI/CD ç®¡é“æ— å¯é¿å…åœ°å¤±è´¥æ—¶ä»–ä»¬å¯ä»¥æ„å»ºæ–°åŠŸèƒ½æˆ–ä¿®å¤é”™è¯¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;å¦‚æœæ‚¨å®æ–½äº†ä»¥ä¸Šæ‰€è¿°çš„æ‰€æœ‰æ¡†æ¶å’Œé‡Œç¨‹ç¢‘ï¼Œå¹¶å¯¹æ‚¨çš„ Dockerfile å’Œ Kubernetes é…ç½®è¿›è¡Œäº†æ‰€æœ‰å¿…è¦çš„æ›´æ”¹ä»¥æ»¡è¶³è¿™äº›æ–°ç­–ç•¥ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½ä¼šå‘ç°æ‚¨çš„ 90 ä¸ªä¸»è¦æ¼æ´æ¸…å•å·²ç»å‡å°‘åˆ°äº†ä¸€ä¸ªæ›´æ˜“ç®¡ç†çš„æ•°é‡ã€‚&lt;/p&gt;
&lt;p&gt;æ‚¨æ­£åœ¨çœ‹åˆ°æˆ‘ä»¬é€æ­¥å¡‘é€ å’Œæ‰§è¡Œ Kubernetes ç­–ç•¥çš„æ–¹æ³•çš„ä»·å€¼ã€‚æ‚¨ä¸æ–°ç­–ç•¥å’Œè§„åˆ™çš„å½±å“äº’åŠ¨å¾—è¶Šå¤šï¼Œå°±åƒ Monokle åœ¨æäº¤ä¹‹å‰å”¯ä¸€åšåˆ°çš„é‚£æ ·ï¼Œå°±è¶Šå®¹æ˜“åœ¨ä¸å‹å®è‡ªå·±æˆ–å…¶ä»–äººçš„æƒ…å†µä¸‹é€æ­¥è¿ˆå‡ºæ­¥ä¼ã€‚&lt;/p&gt;
&lt;p&gt;æ‚¨ç”šè‡³å¯èƒ½ä¼šè‡ªè±ªåœ°å®£ç§°ï¼Œæ‚¨çš„ Kubernetes ç¯å¢ƒå®Œå…¨æ²¡æœ‰é…ç½®é”™è¯¯ã€‚è¿™æ˜¯ä¸€ç§èƒœåˆ©ï¼Œæ¯«æ— ç–‘é—®ï¼Œä½†è¿™ä¸æ˜¯ä¿è¯ - æ€»ä¼šæœ‰æ–°çš„ Kubernetes ç‰ˆæœ¬ã€æ–°çš„åº”ç”¨ç¨‹åºå’Œæ–°çš„æœ€ä½³å®è·µèå…¥åˆ°æ‚¨å·²ç»å®Œæˆçš„å·¥ä½œä¸­ã€‚åˆ©ç”¨æ¡†æ¶å’ŒåŠ å›ºæŒ‡å—çš„ä¼˜åŠ¿åœ¨äºï¼Œæ‚¨æœ‰æ›´å¥½çš„å…±åŒåŸºç¡€æ¥è°ˆè®ºæ‚¨åœ¨è®¤è¯ã€åˆè§„å’Œé•¿æœŸå®‰å…¨ç›®æ ‡æ–¹é¢çš„å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºéä¸“å®¶æ¥è¯´ï¼Œå“ªç§å¬èµ·æ¥æ›´æœ‰è¯´æœåŠ›ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‚¨å°† CVE æ•°é‡ä» 90 ä¸ªé™è‡³ X ä¸ªï¼Œ&lt;/li&gt;
&lt;li&gt;è¿˜æ˜¯æ‚¨å®Œå…¨ç¬¦åˆç¾å›½å›½å®¶å®‰å…¨å±€çš„ Kubernetes åŠ å›ºæŒ‡å—ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘ä»¬è¶Šæ—©ä¸å†æ‹…å¿ƒæ•°å­—ï¼Œè€Œæ˜¯æ›´å¤šåœ°å…³æ³¨å…±åŒé‡Œç¨‹ç¢‘ï¼Œåœ¨åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸçš„æ—©æœŸï¼ˆç†æƒ³æƒ…å†µä¸‹æ˜¯ pre-commitï¼ï¼‰å°½æ—©æ‰§è¡Œï¼Œæˆ‘ä»¬å°±èƒ½æ‰¾åˆ°æ¯ä¸ªäº‘åŸç”Ÿç­–ç•¥çš„å¯æŒç»­ç”œèœœç‚¹ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes æ•…éšœæ’é™¤æ™ºæ…§çš„æ¼”å˜</title>
      <link>https://cloudnativecn.com/blog/can-chatgpt-save-collective-kubernetes-troubleshooting/</link>
      <pubDate>Sun, 10 Sep 2023 19:03:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/can-chatgpt-save-collective-kubernetes-troubleshooting/</guid>
      <description>&lt;p&gt;æ‘˜è¦ï¼šæœ¬æ–‡è®¨è®ºäº†åœ¨ Kubernetes æ•…éšœæ’é™¤ä¸­çš„ä¸¤ç§è·¯å¾„ï¼šä¸€ç§æ˜¯å¢å¼ºæ“ä½œå‘˜çš„åˆ†æå·¥ä½œï¼Œé€šè¿‡è‡ªåŠ¨åŒ–å’Œç®€åŒ–å¯¹æ•…éšœæ’é™¤çŸ¥è¯†çš„è®¿é—®æ¥æä¾›å¸®åŠ©ï¼›å¦ä¸€ç§æ˜¯å°†æ“ä½œå‘˜ä»æ•…éšœæ’é™¤ä¸­æ’é™¤ï¼Œé€šè¿‡ä½¿ç”¨ AI/ML æ¨¡å‹å’Œå¯è§‚å¯Ÿæ€§æ•°æ®æ¥è‡ªåŠ¨åŒ–æ•…éšœä¿®å¤ã€‚åŒæ—¶å¼ºè°ƒäº†æ•°æ®çš„é‡è¦æ€§ï¼Œä»¥åŠç»§ç»­å…±äº«æ•…éšœæ’é™¤ç»éªŒå’Œå»ºç«‹å¯¹å¯è§‚å¯Ÿæ€§çš„ä¸€è‡´è®¤è¯†çš„å¿…è¦æ€§ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;æœ¬æ–‡è¯‘è‡ªï¼šhttps://thenewstack.io/can-chatgpt-save-collective-kubernetes-troubleshooting/&lt;/p&gt;
&lt;p&gt;æ•°åå¹´å‰ï¼Œç³»ç»Ÿç®¡ç†å‘˜ä»¬å¼€å§‹åœ¨äº’è”ç½‘ä¸Šåˆ†äº«ä»–ä»¬æ¯å¤©é¢ä¸´çš„æŠ€æœ¯é—®é¢˜ã€‚ä»–ä»¬è¿›è¡Œäº†é•¿æ—¶é—´ã€å……æ»¡æ´»åŠ›ä¸”å¯Œæœ‰ä»·å€¼çš„è®¨è®ºï¼Œæ¢è®¨å¦‚ä½•è°ƒæŸ¥å’Œè§£å†³é—®é¢˜çš„æ ¹æœ¬åŸå› ï¼Œç„¶åè¯¦ç»†è¯´æ˜æœ€ç»ˆå¯¹ä»–ä»¬æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;è¿™è‚¡æ´ªæµä»æœªåœæ­‡ï¼Œåªæ˜¯æ”¹å˜äº†æµå‘ã€‚å¦‚ä»Šï¼Œè¿™äº›è®¨è®ºä»åœ¨ Stack Overflowã€Reddit ä»¥åŠä¼ä¸šå·¥ç¨‹åšå®¢ä¸Šè¿›è¡Œã€‚æ¯ä¸€æ¬¡è®¨è®ºéƒ½æ˜¯å¯¹å…¨çƒ IT ç³»ç»Ÿæ•…éšœæ’é™¤ç»éªŒçš„å®è´µè´¡çŒ®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://roadmap.sh/kubernetes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes&lt;/a&gt;ä¹Ÿä»æ ¹æœ¬ä¸Šæ”¹å˜äº†è¿™ç§æµå‘ã€‚ä¸å‡ åå¹´æ¥å›°æ‰°ç³»ç»Ÿç®¡ç†å‘˜å’Œ IT äººå‘˜çš„è™šæ‹Ÿæœºï¼ˆVMï¼‰å’Œå•ä½“åº”ç”¨ç¨‹åºç›¸æ¯”ï¼Œ&lt;a href=&#34;https://thenewstack.io/microservices/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¾®æœåŠ¡æ¶æ„&lt;/a&gt;è¦å¤æ‚å¾—å¤šã€‚ç”±äº Kubernetes ç¼ºä¹æ•°æ®æŒä¹…æ€§ï¼Œå¾€å¾€æ— æ³•å¯¹è§„æ¨¡åŒ–çš„ K8s é”™è¯¯è¿›è¡Œæœ¬åœ°é‡ç°ã€‚å³ä½¿èƒ½å¤Ÿæ•è·ï¼Œè§‚æµ‹æ•°æ®ä¹Ÿä¼šåœ¨å¤šä¸ªå¹³å°ä¸Šåˆ†æ•£ï¼Œè€Œèµ„æºå’Œä¾èµ–å…³ç³»çš„ç›¸äº’å…³è”å…³ç³»ä¹Ÿéš¾ä»¥æ•æ‰ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨ï¼Œå‡­ç›´è§‰å¹¶ä¸ä¸€å®šè¶³å¤Ÿã€‚æ‚¨éœ€è¦çŸ¥é“å¦‚ä½•è°ƒè¯•é›†ç¾¤ä»¥è·å¾—ä¸‹ä¸€æ­¥çš„çº¿ç´¢ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§å¤æ‚æ€§æ„å‘³ç€å…¬å¼€çš„æ•…éšœæ’é™¤è®¨è®ºæ¯”ä»¥å¾€ä»»ä½•æ—¶å€™éƒ½æ›´ä¸ºé‡è¦ï¼Œä½†ç°åœ¨æˆ‘ä»¬å¼€å§‹çœ‹åˆ°è¿™è‚¡å®è´µçš„æ´ªæµä¸æ˜¯è¢«é‡å®šå‘ï¼Œè€Œæ˜¯å®Œå…¨è¢«å µä½äº†ã€‚ä½ åœ¨è°·æ­Œä¸Šçœ‹åˆ°äº†è¿™ä¸€ç‚¹ã€‚ä»»ä½•ä¸ Kubernetes ç›¸å…³é—®é¢˜çš„æœç´¢éƒ½ä¼šå‡ºç°ä¸€åŠä»¥ä¸Šçš„ä»˜è´¹å¹¿å‘Šå’Œè‡³å°‘ä¸€é¡µ SEO é©±åŠ¨çš„æ–‡ç« ï¼Œè¿™äº›æ–‡ç« ç¼ºä¹æŠ€æœ¯æ·±åº¦ã€‚&lt;a href=&#34;https://thenewstack.io/stack-overflow-adds-ai-will-the-community-respond/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Stack Overflow&lt;/a&gt; æ­£åœ¨å¤±å»å…¶ä½œä¸ºæŠ€æœ¯äººå‘˜é¦–é€‰é—®ç­”èµ„æºçš„ä¸»å¯¼åœ°ä½ï¼ŒReddit åœ¨è¿‡å»å‡ å¹´ä¸­ä¹Ÿé™·å…¥äº†äº‰è®®ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨ï¼Œæ¯ä¸ª Kubernetes çš„ DevOps å¹³å°éƒ½åœ¨å»ºç«‹æœ€åä¸€ä¸ªå ¤åï¼šå°†æ‚¨çš„æ•…éšœæ’é™¤çŸ¥è¯†é›†ä¸­åœ¨å…¶å¹³å°ä¸Šï¼Œå¹¶ç”¨&lt;a href=&#34;https://thenewstack.io/70-percent-of-developers-using-or-will-use-ai-says-stack-overflow-survey/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äººå·¥æ™ºèƒ½ï¼ˆAIï¼‰å’Œæœºå™¨å­¦ä¹ ï¼ˆMLï¼‰&lt;/a&gt;å–è€Œä»£ä¹‹ï¼Œç›´åˆ°æ•´ä¸ªå †æ ˆå¯¹äºç”šè‡³æ˜¯æœ€æœ‰ç»éªŒçš„äº‘åŸç”Ÿå·¥ç¨‹å¸ˆæ¥è¯´éƒ½æˆä¸ºä¸€ä¸ªé»‘ç›’ã€‚å½“å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œæ‚¨å¤±å»äº†é€ä¸ªæ¢æµ‹ã€æ’é™¤æ•…éšœå’Œä¿®å¤ç³»ç»Ÿçš„èƒ½åŠ›ã€‚è¿™ç§è¶‹åŠ¿å°†æ›¾ç»æ˜¯ä¼—åŒ…æ•…éšœæ’é™¤æŠ€èƒ½æ´ªæµå˜æˆäº†è¿‡å»æ‰€èƒ½æä¾›çš„ä»…ä»…æ˜¯ä¸€æ»´æ°´ã€‚&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä»¬ä¾èµ–äºå¹³å°æ—¶ï¼Œæ•…éšœæ’é™¤æŠ€æœ¯çš„é›†ä½“æ™ºæ…§å°±ä¼šæ¶ˆå¤±ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ•…éšœæ’é™¤æ™ºæ…§çš„ä¼ æ‰¿&#34;&gt;æ•…éšœæ’é™¤æ™ºæ…§çš„ä¼ æ‰¿&lt;/h2&gt;
&lt;p&gt;èµ·åˆï¼Œç³»ç»Ÿç®¡ç†å‘˜ä¾é å®ä½“ä¹¦ç±è¿›è¡ŒæŠ€æœ¯æ–‡æ¡£å’Œæ•´ä½“æœ€ä½³å®è·µçš„å®æ–½ã€‚éšç€äº’è”ç½‘åœ¨ 80 å¹´ä»£å’Œ 90 å¹´ä»£çš„æ™®åŠï¼Œè¿™äº›äººé€šå¸¸é€šè¿‡&lt;a href=&#34;https://today.duke.edu/2010/05/usenet.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Usenet&lt;/a&gt;ä¸åŒè¡Œè¿›è¡Œäº¤æµï¼Œå¹¶åœ¨åƒ comp.lang.* è¿™æ ·çš„æ–°é—»ç»„ä¸­æå‡ºå·¥ä½œä¸­çš„æŠ€æœ¯é—®é¢˜ï¼Œè¿™ç±»æ–°é—»ç»„ç±»ä¼¼äºæˆ‘ä»¬ä»Šå¤©æ‰€çŸ¥çš„è®ºå›çš„ç®€åŒ–ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;éšç€äº’è”ç½‘çš„æ™®åŠè¿…é€Ÿï¼Œå¹¶å‡ ä¹å®Œå…¨æ”¹å˜äº†æ•…éšœæ’é™¤æ™ºæ…§çš„æ´ªæµã€‚å·¥ç¨‹å¸ˆå’Œç®¡ç†å‘˜ä»¬ä¸å†èšé›†åœ¨æ–°é—»ç»„ä¸­ï¼Œè€Œæ˜¯æ¶Œå‘åŒ…æ‹¬ Experts Exchange åœ¨å†…çš„æ•°åƒä¸ªè®ºå›ï¼Œè¯¥è®ºå›äº 1996 å¹´ä¸Šçº¿ã€‚åœ¨ç§¯ç´¯äº†å¤§é‡çš„é—®é¢˜å’Œç­”æ¡ˆä¹‹åï¼ŒExperts Exchange å›¢é˜Ÿå°†æ‰€æœ‰ç­”æ¡ˆéƒ½æ”¾åœ¨äº†æ¯å¹´ 250 ç¾å…ƒçš„ä»˜è´¹å¢™åé¢ï¼Œè¿™ä½¿å¾—æ— æ•°å®è´µçš„è®¨è®ºæ— æ³•å…¬å¼€è·å–ï¼Œæœ€ç»ˆå¯¼è‡´äº†è¯¥ç½‘ç«™çš„å½±å“åŠ›ä¸‹é™ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.joelonsoftware.com/2018/04/06/the-stack-overflow-age/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Stack Overflow éšåå‡ºç°&lt;/a&gt;ï¼Œå†æ¬¡å‘å…¬ä¼—å¼€æ”¾äº†è¿™äº›è®¨è®ºï¼Œå¹¶é€šè¿‡å£°æœ›ç‚¹æ•°å¯¹è®¨è®ºè¿›è¡Œæ¸¸æˆåŒ–ï¼Œè¿™äº›å£°æœ›ç‚¹æ•°å¯ä»¥é€šè¿‡æä¾›è§è§£å’Œè§£å†³æ–¹æ¡ˆæ¥è·å¾—ã€‚å…¶ä»–ç”¨æˆ·éšåå¯¹â€œæœ€ä½³â€è§£å†³æ–¹æ¡ˆè¿›è¡ŒæŠ•ç¥¨å’ŒéªŒè¯ï¼Œè¿™æœ‰åŠ©äºå…¶ä»–æœç´¢è€…å¿«é€Ÿæ‰¾åˆ°ç­”æ¡ˆã€‚Stack Overflow çš„æ¸¸æˆåŒ–ã€è‡ªæˆ‘ç®¡ç†å’Œç¤¾åŒºä½¿å…¶æˆä¸ºäº†æ´ªæµå¼æ•…éšœæ’é™¤çŸ¥è¯†çš„å”¯ä¸€æ¸ é“ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œå°±åƒå…¶ä»–æ—¶ä»£ä¸€æ ·ï¼Œæ²¡æœ‰ä»€ä¹ˆå¥½äº‹èƒ½æ°¸è¿œæŒç»­ä¸‹å»ã€‚è¿‘ 10 å¹´æ¥ï¼Œäººä»¬ä¸€ç›´åœ¨é¢„æµ‹&lt;a href=&#34;https://johnslegers.medium.com/the-decline-of-stack-overflow-7cb69faa575d&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;â€œStack Overflow çš„è¡°è½â€&lt;/a&gt;ï¼Œå¹¶æŒ‡å‡ºç”±äºå…¶å…·æœ‰æ”»å‡»æ€§çš„æ€§è´¨å’Œç”±æ‹¥æœ‰æœ€å¤šå£°æœ›ç‚¹æ•°çš„äººè¿›è¡Œç®¡ç†çš„ç»“æ„ï¼Œå®ƒâ€œè®¨åŒæ–°ç”¨æˆ·â€ã€‚è™½ç„¶ Stack Overflow çš„å½±å“åŠ›å’Œæµè¡Œåº¦ç¡®å®ä¸‹é™äº†ï¼Œä½† Reddit çš„å¼€å‘/å·¥ç¨‹ä¸“æ³¨çš„ subreddit å¡«è¡¥äº†è¿™ä¸ªç©ºç™½ï¼Œå®ƒä»ç„¶æ˜¯å…¬å¼€å¯è®¿é—®çš„æ•…éšœæ’é™¤çŸ¥è¯†çš„æœ€å¤§å­˜å‚¨åº“ã€‚&lt;/p&gt;
&lt;p&gt;ç‰¹åˆ«æ˜¯å¯¹äº Kubernetes å’Œäº‘åŸç”Ÿç¤¾åŒºæ¥è¯´ï¼Œè¿™ä»ç„¶æ˜¯ä¸€ä¸ªé‡è¦çš„èµ„æºï¼Œå› ä¸ºå®ƒä»¬ä»ç„¶åœ¨ç»å†é‡å¤§çš„å¢é•¿é˜µç—›ã€‚è€Œè¿™æ˜¯ä¸€ç§å®è´µçš„èµ„æºï¼Œå› ä¸ºå¦‚æœæ‚¨è®¤ä¸ºç°åœ¨çš„ Kubernetes å·²ç»å¾ˆå¤æ‚äº†&amp;hellip;&lt;/p&gt;
&lt;h2 id=&#34;kubernetes-çš„å¤æ‚æ€§é—®é¢˜&#34;&gt;Kubernetes çš„å¤æ‚æ€§é—®é¢˜&lt;/h2&gt;
&lt;p&gt;åœ¨ä¸€ç¯‡å…³äºâ€œç›´è§‚è°ƒè¯•â€å¤±è´¥çš„ç²¾å½©æ–‡ç« ä¸­ï¼Œè½¯ä»¶äº¤ä»˜é¡¾é—® Pete Hodgson è®¤ä¸ºï¼Œæ„å»ºå’Œäº¤ä»˜è½¯ä»¶çš„ç°ä»£æ¶æ„ï¼ˆå¦‚ Kubernetes å’Œå¾®æœåŠ¡ï¼‰æ¯”ä»¥å¾€ä»»ä½•æ—¶å€™éƒ½æ›´åŠ å¤æ‚ã€‚ä»–å†™é“ï¼šâ€œå¯¹äºæˆ‘ä»¬å¤§å¤šæ•°äººæ¥è¯´ï¼Œä¸ºæœåŠ¡å™¨å‘½åä¸ºå¸Œè…Šç¥è¯è§’è‰²ï¼Œå¹¶é€šè¿‡ ssh è¿›å…¥æœåŠ¡å™¨è¿è¡Œ&lt;code&gt;tail&lt;/code&gt;å’Œ&lt;code&gt;top&lt;/code&gt;çš„æ—¥å­å·²ç»ä¸€å»ä¸å¤è¿”äº†ã€‚â€ä½†æ˜¯ï¼Œâ€œè¿™ç§è½¬å˜æ˜¯æœ‰ä»£ä»·çš„â€¦â€¦ä¼ ç»Ÿçš„ç†è§£å’Œæ•…éšœæ’é™¤ç”Ÿäº§ç¯å¢ƒçš„æ–¹æ³•åœ¨è¿™ä¸ªæ–°ä¸–ç•Œä¸­å·²ç»è¡Œä¸é€šäº†ã€‚â€&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-cynefin-æ¨¡å‹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Cynefin æ¨¡å‹&#34; srcset=&#34;
               /blog/can-chatgpt-save-collective-kubernetes-troubleshooting/cynfin_hu7678611328878471593.webp 400w,
               /blog/can-chatgpt-save-collective-kubernetes-troubleshooting/cynfin_hu931055034156845125.webp 760w,
               /blog/can-chatgpt-save-collective-kubernetes-troubleshooting/cynfin_hu10537070282739028136.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/can-chatgpt-save-collective-kubernetes-troubleshooting/cynfin_hu7678611328878471593.webp&#34;
               width=&#34;760&#34;
               height=&#34;676&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Cynefin æ¨¡å‹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Cynefin æ¨¡å‹ã€‚æ¥æºï¼šç»´åŸºç™¾ç§‘&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Hodgson ä½¿ç”¨&lt;a href=&#34;https://en.wikipedia.org/wiki/Cynefin_framework&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cynefin æ¨¡å‹&lt;/a&gt;æ¥è¯´æ˜è½¯ä»¶æ¶æ„è¿‡å»æ˜¯å¤æ‚çš„ï¼Œå› ä¸ºæœ‰è¶³å¤Ÿçš„ç»éªŒï¼Œäººä»¬å¯ä»¥ç†è§£æ•…éšœæ’é™¤å’Œè§£å†³æ–¹æ¡ˆä¹‹é—´çš„å› æœå…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;ä»–è®¤ä¸ºï¼Œåˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„æ˜¯å¤æ‚çš„ï¼Œå³ä½¿ç»éªŒä¸°å¯Œçš„äººå¯¹æ ¹æœ¬åŸå› ä»¥åŠå¦‚ä½•è¿›è¡Œæ•…éšœæ’é™¤ä¹Ÿåªæœ‰â€œæœ‰é™çš„ç›´è§‰â€ã€‚ä»–ä»¬å¿…é¡»èŠ±æ›´å¤šæ—¶é—´é€šè¿‡å¯è§‚å¯Ÿæ€§æ•°æ®æå‡ºé—®é¢˜å’Œå›ç­”é—®é¢˜ï¼Œæœ€ç»ˆå‡è®¾å¯èƒ½å‡ºé”™çš„åŸå› ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬åŒæ„ Hodgson çš„å‰æ - Kubernetes æœ¬è´¨ä¸Šæ˜¯å¤æ‚çš„ï¼Œå¹¶ä¸”åœ¨å“åº”ä¹‹å‰éœ€è¦èŠ±è´¹æ›´å¤šçš„æ—¶é—´åˆ†æé—®é¢˜ï¼Œé‚£ä¹ˆä¸ Kubernetes ä¸€èµ·å·¥ä½œçš„å·¥ç¨‹å¸ˆå­¦ä¼šäº†å“ªäº›é—®é¢˜æœ€é‡è¦ï¼Œç„¶åç”¨å¯è§‚å¯Ÿæ€§æ•°æ®å›ç­”ï¼Œä»¥è¿›è¡Œæœ€ä½³çš„ä¸‹ä¸€æ­¥è¡ŒåŠ¨ï¼Œä¼¼ä¹æ˜¯è‡³å…³é‡è¦çš„ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ­£æ˜¯æ–°ä¸€ä»£ä»¥ AI é©±åŠ¨çš„æ•…éšœæ’é™¤å¹³å°æ‰€æä¾›çš„æ™ºæ…§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;kubernetes-æ•…éšœæ’é™¤çš„ä¸¤ç§è·¯å¾„&#34;&gt;Kubernetes æ•…éšœæ’é™¤çš„ä¸¤ç§è·¯å¾„&lt;/h2&gt;
&lt;p&gt;å¤šå¹´æ¥ï¼Œåƒ OpenAI è¿™æ ·çš„å…¬å¸ä¸€ç›´åœ¨æ ¹æ® Stack Overflowã€Reddit ç­‰å…¬å¼€æ•°æ®è¿›è¡ŒæŠ“å–å’Œè®­ç»ƒæ¨¡å‹ï¼Œè¿™æ„å‘³ç€è¿™äº› AI æ¨¡å‹å¯ä»¥è®¿é—®å¤§é‡çš„ç³»ç»Ÿå’Œåº”ç”¨çŸ¥è¯†ï¼ŒåŒ…æ‹¬ Kubernetesã€‚è¿˜æœ‰ä¸€äº›äººæ„è¯†åˆ°ç»„ç»‡çš„å¯è§‚å¯Ÿæ€§æ•°æ®æ˜¯è®­ç»ƒ AI/ML æ¨¡å‹åˆ†ææ–°åœºæ™¯çš„å®è´µèµ„æºã€‚&lt;/p&gt;
&lt;p&gt;ä»–ä»¬éƒ½åœ¨é—®åŒä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬å¦‚ä½•åˆ©ç”¨å…³äº Kubernetes çš„ç°æœ‰æ•°æ®æ¥ç®€åŒ–æœç´¢æœ€ä½³è§£å†³æ–¹æ¡ˆçš„è¿‡ç¨‹ï¼Ÿä»–ä»¬æ­£åœ¨æ„å»ºçš„äº§å“é‡‡å–éå¸¸ä¸åŒçš„è·¯å¾„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¬¬ä¸€ç§å¢å¼ºæ“ä½œå‘˜çš„åˆ†æå·¥ä½œ&#34;&gt;ç¬¬ä¸€ç§ï¼šå¢å¼ºæ“ä½œå‘˜çš„åˆ†æå·¥ä½œ&lt;/h3&gt;
&lt;p&gt;è¿™äº›å·¥å…·è‡ªåŠ¨åŒ–å’Œç®€åŒ–å¯¹å…¬å¼€åœ¨çº¿å‘å¸ƒçš„å¤§é‡æ•…éšœæ’é™¤çŸ¥è¯†çš„è®¿é—®ã€‚å®ƒä»¬ä¸ä¼šå–ä»£è¿›è¡Œé€‚å½“æ•…éšœæ’é™¤æˆ–&lt;a href=&#34;https://aws.amazon.com/opensearch-service/resources/root-cause-analysis/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ ¹æœ¬åŸå› åˆ†æ&lt;/a&gt;ï¼ˆRCAï¼‰æ‰€éœ€çš„äººç±»ç›´è§‰å’Œåˆ›é€ åŠ›ï¼Œè€Œæ˜¯æœ‰æ¡ä¸ç´Šåœ°è‡ªåŠ¨åŒ–æ“ä½œå‘˜æŸ¥æ‰¾ç›¸å…³ä¿¡æ¯çš„æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªåˆšæ¥è§¦ Kubernetes çš„å¼€å‘äººå‘˜åœ¨è¿è¡Œ&lt;code&gt;kubectl get pods&lt;/code&gt;æ—¶å‘ç°&lt;code&gt;CrashLoopBackOff&lt;/code&gt;çŠ¶æ€å¯¼è‡´ä»–ä»¬æ— æ³•éƒ¨ç½²åº”ç”¨ç¨‹åºï¼Œä»–ä»¬å¯ä»¥æŸ¥è¯¢ä¸€ä¸ª AI é©±åŠ¨çš„å·¥å…·ä»¥è·å¾—å»ºè®®ï¼Œæ¯”å¦‚è¿è¡Œ&lt;code&gt;kubectl describe $POD&lt;/code&gt;æˆ–&lt;code&gt;kubectl logs $POD&lt;/code&gt;ã€‚è¿™äº›æ­¥éª¤å¯èƒ½ä¼šè¿›ä¸€æ­¥å¼•å¯¼å¼€å‘äººå‘˜ä½¿ç”¨&lt;code&gt;kubectl describe $DEPLOYMENT&lt;/code&gt;æ¥è°ƒæŸ¥ç›¸å…³çš„éƒ¨ç½²æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;åœ¨&lt;a href=&#34;https://botkube.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Botkube&lt;/a&gt;ï¼Œæˆ‘ä»¬å¯¹ä½¿ç”¨ AI åœ¨å¤§é‡æ•…éšœæ’é™¤æ™ºæ…§çš„åŸºç¡€ä¸Šè‡ªåŠ¨åŒ–è¿™ä¸ªæ¥å›æŸ¥è¯¢çš„æ¦‚å¿µéå¸¸æ„Ÿå…´è¶£ã€‚ç”¨æˆ·åº”è¯¥èƒ½å¤Ÿç›´æ¥åœ¨ Slack ä¸­æé—®ï¼Œå¦‚â€œæˆ‘å¦‚ä½•æ’é™¤è¿™ä¸ªæ— æ³•æ­£å¸¸å·¥ä½œçš„æœåŠ¡ï¼Ÿâ€å¹¶æ”¶åˆ° ChatGPT æ’°å†™çš„å›ç­”ã€‚åœ¨ä¸€æ¬¡å…¬å¸èŒƒå›´çš„é»‘å®¢é©¬æ‹‰æ¾æ´»åŠ¨ä¸­ï¼Œæˆ‘ä»¬ç€æ‰‹å®æ–½è¿™ä¸€æ¦‚å¿µï¼Œä¸ºæˆ‘ä»¬çš„åä½œæ•…éšœæ’é™¤å¹³å°æ„å»ºäº†ä¸€ä¸ªæ–°çš„æ’ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡&lt;a href=&#34;https://botkube.io/blog/use-chatgpt-to-troubleshoot-kubernetes-errors-with-botkubes-doctor&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Doctor&lt;/a&gt;ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨å¤§é‡çš„æ•…éšœæ’é™¤çŸ¥è¯†ï¼Œé€šè¿‡ Botkube ä½œä¸ºæ‚¨çš„ Kubernetes é›†ç¾¤å’Œæ¶ˆæ¯/åä½œå¹³å°ä¹‹é—´çš„æ¡¥æ¢ï¼Œæ— éœ€åœ¨ Stack Overflow æˆ– Google æœç´¢å¹¿å‘Šä¸­æ¼«æ¸¸ï¼Œè¿™å¯¹äºæ–°æ‰‹ Kubernetes å¼€å‘äººå‘˜å’Œæ“ä½œå‘˜ç‰¹åˆ«æœ‰ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥æ’ä»¶è¿˜é€šè¿‡ç”Ÿæˆä¸€ä¸ªå¸¦æœ‰&lt;strong&gt;è·å–å¸®åŠ©&lt;/strong&gt;æŒ‰é’®çš„ Slack æ¶ˆæ¯è¿›ä¸€æ­¥è‡ªåŠ¨åŒ–ï¼Œç”¨äºä»»ä½•é”™è¯¯æˆ–å¼‚å¸¸ï¼Œç„¶åæŸ¥è¯¢ ChatGPT ä»¥è·å–å¯è¡Œçš„è§£å†³æ–¹æ¡ˆå’Œä¸‹ä¸€æ­¥æ“ä½œã€‚æ‚¨ç”šè‡³å¯ä»¥å°† Doctor æ’ä»¶çš„ç»“æœå¯¼å…¥å…¶ä»–æ“ä½œæˆ–é›†æˆï¼Œä»¥ç®€åŒ–æ‚¨ä¸»åŠ¨ä½¿ç”¨ç°æœ‰å¹¿æ³›çš„ Kubernetes æ•…éšœæ’é™¤çŸ¥è¯†æ¥æ›´ç›´è§‚åœ°è°ƒè¯•å’Œæ„ŸçŸ¥é—®é¢˜çš„æ–¹å¼ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¬¬äºŒç§å°†æ“ä½œå‘˜ä»æ•…éšœæ’é™¤ä¸­æ’é™¤&#34;&gt;ç¬¬äºŒç§ï¼šå°†æ“ä½œå‘˜ä»æ•…éšœæ’é™¤ä¸­æ’é™¤&lt;/h3&gt;
&lt;p&gt;è¿™äº›å·¥å…·ä¸å…³å¿ƒå…¬å¼€çŸ¥è¯†çš„æ³›æ»¥ã€‚å¦‚æœå®ƒä»¬å¯ä»¥åŸºäºå®é™…çš„å¯è§‚å¯Ÿæ€§æ•°æ®è®­ç»ƒé€šç”¨çš„ AI/ML æ¨¡å‹ï¼Œç„¶åæ ¹æ®æ‚¨çš„ç‰¹å®šæ¶æ„è¿›è¡Œå¾®è°ƒï¼Œå®ƒä»¬å¯ä»¥è¯•å›¾å®Œå…¨å‰”é™¤äººä¸ºæ“ä½œå‘˜åœ¨æ ¹æœ¬åŸå› åˆ†æå’Œæ•…éšœä¿®å¤ä¸­çš„ä½œç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.causely.io/platform/causely-for-kubernetes-applications/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Causely&lt;/a&gt;å°±æ˜¯è¿™æ ·ä¸€å®¶åˆåˆ›å…¬å¸ï¼Œä»–ä»¬å¹¶ä¸å›é¿ä½¿ç”¨ AI æ¥â€œæ¶ˆé™¤äººä¸ºæ•…éšœæ’é™¤â€çš„æ„¿æ™¯ã€‚è¯¥å¹³å°è¿æ¥åˆ°æ‚¨ç°æœ‰çš„å¯è§‚å¯Ÿæ€§æ•°æ®ï¼Œå¹¶å¤„ç†å®ƒä»¬ä»¥å¾®è°ƒå› æœå…³ç³»æ¨¡å‹ï¼Œç†è®ºä¸Šå¯ç›´æ¥è¿›è¡Œä¿®å¤æ­¥éª¤ - æ— éœ€æ¢æµ‹æˆ–ä½¿ç”¨&lt;code&gt;kubectl&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœè¯´æœ‰æ—¶å€™æœ‰ä¸€ä¸ª Kubernetes ç¥çµå¬èµ·æ¥å¾ˆè¯±äººï¼Œé‚£æˆ‘å¯èƒ½ä¼šæ’’è°ï¼Œä½†æˆ‘å¯¹åƒ Causely è¿™æ ·çš„å·¥å…·å¤ºèµ°è¿ç»´å·¥ä½œå¹¶ä¸æ‹…å¿ƒã€‚æˆ‘æ‹…å¿ƒçš„æ˜¯åœ¨ Causely å¼•é¢†çš„æœªæ¥ä¸­ï¼Œæˆ‘ä»¬å®è´µçš„æ•…éšœæ’é™¤çŸ¥è¯†ä¼šå‘ç”Ÿä»€ä¹ˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¿™ä¸¤ç§è·¯å¾„ä¹‹é—´çš„å·®è·æ•°æ®&#34;&gt;è¿™ä¸¤ç§è·¯å¾„ä¹‹é—´çš„å·®è·ï¼šæ•°æ®&lt;/h3&gt;
&lt;p&gt;æˆ‘ä¸æ˜¯åœ¨ä¸ºâ€œäººå·¥æ™ºèƒ½å°†å–ä»£æ‰€æœ‰ DevOps å·¥ä½œâ€å‘è¡¨è¨€è®ºã€‚æˆ‘ä»¬å·²ç»è¯»è¿‡å¤ªå¤šè¿™æ ·çš„æœ«æ—¥åœºæ™¯ï¼Œé€‚ç”¨äºæ¯ä¸ªå°ä¼—å’Œè¡Œä¸šã€‚æˆ‘æ›´å…³å¿ƒè¿™ä¸¤ç§è·¯å¾„ä¹‹é—´çš„å·®è·ï¼šç”¨äºè®­ç»ƒå’Œå›ç­”é—®é¢˜æˆ–å‘ˆç°ç»“æœçš„æ•°æ®æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€ç§è·¯å¾„é€šå¸¸ä½¿ç”¨ç°æœ‰çš„å…¬å¼€æ•°æ®ã€‚å°½ç®¡æœ‰å…³ AI å…¬å¸çˆ¬å–è¿™äº›ç«™ç‚¹è¿›è¡Œè®­ç»ƒæ•°æ®çš„æ‹…å¿§-Reddit å’Œ Twitterï¼Œä½†è¿™äº›æ•°æ®çš„å¼€æ”¾æ€§ä»ç„¶æä¾›äº†ä¸€ä¸ªæ¿€åŠ±å¾ªç¯ï¼Œä»¥ä¿æŒå¼€å‘äººå‘˜å’Œå·¥ç¨‹å¸ˆç»§ç»­åœ¨ Redditã€Stack Overflow å’Œå…¶ä»–å¹³å°ä¸Šå…±äº«çŸ¥è¯†çš„æŒç»­æ³›æ»¥ã€‚&lt;/p&gt;
&lt;p&gt;äº‘åŸç”Ÿç¤¾åŒºé€šå¸¸ä¹Ÿå€¾å‘äºå…±äº«æŠ€æœ¯çŸ¥è¯†ï¼Œè®¤åŒå…±äº«æŠ€æœ¯çŸ¥è¯†å’Œä¸€ä¸ªâ€œæ¶¨æ½®ï¼ˆKubernetes æ•…éšœæ’é™¤æŠ€å·§çš„æ¶¨æ½®ï¼‰æŠ¬é«˜æ‰€æœ‰èˆ¹ï¼ˆå‹åŠ›å·¨å¤§çš„ Kubernetes å·¥ç¨‹å¸ˆï¼‰â€çš„æƒ³æ³•ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒæ¡è·¯å¾„çœ‹èµ·æ¥æ›´ä¸ºæš—æ·¡ã€‚éšç€ä»¥ AI é©±åŠ¨çš„ DevOps å¹³å°çš„å…´èµ·ï¼Œè¶Šæ¥è¶Šå¤šçš„æ•…éšœæ’é™¤çŸ¥è¯†è¢«é”å®šåœ¨è¿™äº›ä»ªè¡¨æ¿å’Œé©±åŠ¨å¹³å°çš„ä¸“æœ‰ AI æ¨¡å‹ä¸­ã€‚æˆ‘ä»¬éƒ½åŒæ„ï¼ŒKubernetes åŸºç¡€æ¶æ„å°†ç»§ç»­å˜å¾—æ›´åŠ å¤æ‚ï¼Œè€Œä¸æ˜¯æ›´ç®€å•ï¼Œè¿™æ„å‘³ç€éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘ä»¬å¯¹èŠ‚ç‚¹ã€Pod å’Œå®¹å™¨ä¹‹é—´å‘ç”Ÿçš„æƒ…å†µçš„ç†è§£å°†å˜å¾—æ›´å°‘ã€‚&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä»¬åœæ­¢äº’ç›¸åˆ†æé—®é¢˜å’Œæ„ŸçŸ¥è§£å†³æ–¹æ¡ˆæ—¶ï¼Œæˆ‘ä»¬å˜å¾—ä¾èµ–äºå¹³å°ã€‚è¿™å¯¹æ¯ä¸ªäººæ¥è¯´éƒ½æ˜¯ä¸€æ¡å¤±è´¥çš„é“è·¯ï¼Œé™¤äº†å¹³å°ä¹‹å¤–ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æˆ‘ä»¬å¦‚ä½•ä¸å¤±å»æˆ–å¤±å»å¾—æ›´å°‘&#34;&gt;æˆ‘ä»¬å¦‚ä½•ä¸å¤±å»ï¼ˆæˆ–å¤±å»å¾—æ›´å°‘ï¼‰ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬èƒ½åšçš„æœ€å¥½çš„äº‹æƒ…æ˜¯ç»§ç»­åœ¨çº¿ä¸Šå‘å¸ƒå…³äºæˆ‘ä»¬åœ¨ Kubernetes å’Œå…¶ä»–é¢†åŸŸçš„æ•…éšœæ’é™¤ç»éªŒçš„æƒŠäººå†…å®¹ï¼Œæ¯”å¦‚â€œ&lt;a href=&#34;https://learnk8s.io/troubleshooting-deployments&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å…³äºæ•…éšœæ’é™¤ Kubernetes éƒ¨ç½²çš„è§†è§‰æŒ‡å—&lt;/a&gt;â€ï¼›é€šè¿‡æ¸¸æˆåŒ–åˆ›é€ æ•™è‚²æ€§åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚&lt;a href=&#34;https://sadservers.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SadServers&lt;/a&gt;ï¼›åœ¨æ•…éšœæ’é™¤ç³»ç»Ÿæ—¶é‡‡å–æˆ‘ä»¬æœ€å–œæ¬¢çš„ç¬¬ä¸€æ­¥ï¼Œæ¯”å¦‚â€œ&lt;a href=&#34;https://rachelbythebay.com/w/2018/03/26/w/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸ºä»€ä¹ˆåœ¨æ’é™¤æœªçŸ¥æœºå™¨é—®é¢˜æ—¶æˆ‘é€šå¸¸é¦–å…ˆè¿è¡Œâ€˜wâ€™&lt;/a&gt;â€ï¼›å¹¶è¿›è¡Œè¯¦ç»†çš„äº‹ååˆ†æï¼Œè¯¦ç»†æè¿°äº†æ¢æµ‹ã€æ„ŸçŸ¥å’Œåº”å¯¹æ½œåœ¨ç¾éš¾æ€§æƒ…å†µçš„å‹åŠ›æ•…äº‹ï¼Œæ¯”å¦‚&lt;a href=&#34;https://mail.tarsnap.com/tarsnap-announce/msg00050.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2023 å¹´ 7 æœˆçš„ Tarsnap æ•…éšœ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¿˜å¯ä»¥è¶…è¶ŠæŠ€æœ¯è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚è®¨è®ºæˆ‘ä»¬å¦‚ä½•åœ¨ç´§å¼ çš„æ•…éšœæ’é™¤åœºæ™¯ä¸­ç®¡ç†å’Œæ”¯æŒåŒäº‹ï¼Œæˆ–è€…åœ¨ç»„ç»‡èŒƒå›´å†…å»ºç«‹å¯¹å¯è§‚å¯Ÿæ€§çš„ä¸€è‡´è®¤è¯†ã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡å®ƒä»¬ç›®å‰é¢ä¸´å›°å¢ƒï¼Œä½† Stack Overflow å’Œ Reddit å°†ç»§ç»­æ˜¯è®¨è®ºæ•…éšœæ’é™¤å’Œå¯»æ±‚ç­”æ¡ˆçš„å¯é æ¸ é“ã€‚å¦‚æœå®ƒä»¬æœ€ç»ˆä¸ Usenet å’Œ Experts Exchange é½åï¼Œå®ƒä»¬å¯èƒ½ä¼šè¢«å…¶ä»–å¯å…¬å¼€è·å¾—çš„æ›¿ä»£å“æ‰€å–ä»£ã€‚&lt;/p&gt;
&lt;p&gt;æ— è®ºä½•æ—¶ä½•åœ°ä»¥ä½•ç§æ–¹å¼å‘ç”Ÿï¼Œæˆ‘å¸Œæœ›æ‚¨èƒ½åŠ å…¥æˆ‘ä»¬åœ¨ Botkube å’Œå…¨æ–°çš„ Doctor æ’ä»¶ä¸­ï¼Œä¸ºåœ¨ Kubernetes ä¸­åä½œè§£å†³å¤æ‚é—®é¢˜æ„å»ºæ–°çš„æ¸ é“ã€‚&lt;/p&gt;
&lt;p&gt;æ— è®º AI é©±åŠ¨çš„ DevOps å¹³å°æ˜¯å¦ç»§ç»­åŸºäºæŠ“å–çš„å…¬å…± Kubernetes æ•°æ®è®­ç»ƒæ–°æ¨¡å‹ï¼Œåªè¦æˆ‘ä»¬ä¸è‡ªæ„¿åœ°å°†å¥½å¥‡å¿ƒã€å†’é™©ç²¾ç¥å’Œè§£å†³é—®é¢˜çš„èƒ½åŠ›å…¨éƒ¨æ”¾å…¥è¿™äº›é»‘åŒ£å­ä¸­ï¼Œå°±ä¼šå§‹ç»ˆæœ‰ä¸€æ¡æ–°è·¯å¾„ï¼Œè®©å®è´µçš„æ•…éšœæ’é™¤çŸ¥è¯†æºæºä¸æ–­åœ°æµåŠ¨ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Gateway API v0.8.0: å¼•å…¥æœåŠ¡ç½‘æ ¼æ”¯æŒ</title>
      <link>https://cloudnativecn.com/blog/gateway-api-release/</link>
      <pubDate>Wed, 30 Aug 2023 12:03:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/gateway-api-release/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ªï¼š&lt;a href=&#34;https://kubernetes.io/blog/2023/08/29/gateway-api-v0-8/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.io/blog/2023/08/29/gateway-api-v0-8/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;ä½œè€…ï¼š&lt;/strong&gt;&lt;/em&gt; Flynnï¼ˆBuoyantï¼‰ã€John Howardï¼ˆGoogleï¼‰ã€Keith Mattixï¼ˆMicrosoftï¼‰ã€Michael Beaumontï¼ˆKongï¼‰ã€Mike Morrisï¼ˆç‹¬ç«‹ï¼‰ã€Rob Scottï¼ˆGoogleï¼‰&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬éå¸¸é«˜å…´åœ°å®£å¸ƒ Gateway API çš„ v0.8.0 ç‰ˆæœ¬å‘å¸ƒäº†ï¼é€šè¿‡æ­¤ç‰ˆæœ¬ï¼ŒGateway API å¯¹æœåŠ¡ç½‘æ ¼çš„æ”¯æŒå·²è¾¾åˆ°&lt;a href=&#34;https://gateway-api.sigs.k8s.io/geps/overview/#status&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®éªŒæ€§çŠ¶æ€&lt;/a&gt;ã€‚æˆ‘ä»¬æœŸå¾…æ‚¨çš„åé¦ˆï¼&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ç‰¹åˆ«é«˜å…´åœ°å®£å¸ƒï¼ŒKuma 2.3+ã€Linkerd 2.14+ å’Œ Istio 1.16+ éƒ½æ˜¯ Gateway API æœåŠ¡ç½‘æ ¼æ”¯æŒçš„å®Œå…¨ç¬¦åˆå®ç°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;gateway-api-ä¸­çš„æœåŠ¡ç½‘æ ¼æ”¯æŒ&#34;&gt;Gateway API ä¸­çš„æœåŠ¡ç½‘æ ¼æ”¯æŒ&lt;/h2&gt;
&lt;p&gt;è™½ç„¶ Gateway API æœ€åˆçš„é‡ç‚¹ä¸€ç›´æ˜¯å…¥å£ï¼ˆå—åŒ—ï¼‰æµé‡ï¼Œä½†å¾ˆå¿«å°±æ¸…æ¥šï¼Œç›¸åŒçš„åŸºæœ¬è·¯ç”±æ¦‚å¿µä¹Ÿåº”é€‚ç”¨äºæœåŠ¡ç½‘æ ¼ï¼ˆä¸œè¥¿ï¼‰æµé‡ã€‚2022 å¹´ï¼ŒGateway API å­é¡¹ç›®å¯åŠ¨äº†&lt;a href=&#34;https://gateway-api.sigs.k8s.io/concepts/gamma/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GAMMA è®¡åˆ’&lt;/a&gt;ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸“é—¨çš„ä¾›åº”å•†ä¸­ç«‹å·¥ä½œæµï¼Œæ—¨åœ¨ç‰¹åˆ«ç ”ç©¶å¦‚ä½•æœ€å¥½åœ°å°†æœåŠ¡ç½‘æ ¼æ”¯æŒçº³å…¥ Gateway API èµ„æºçš„æ¡†æ¶ä¸­ï¼Œè€Œä¸éœ€è¦ Gateway API çš„ç”¨æˆ·é‡æ–°å­¦ä¹ ä»–ä»¬äº†è§£çš„æœ‰å…³ API çš„ä¸€åˆ‡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿‡å»çš„ä¸€å¹´ä¸­ï¼ŒGAMMA æ·±å…¥ç ”ç©¶äº†ä½¿ç”¨ Gateway API ç”¨äºæœåŠ¡ç½‘æ ¼çš„æŒ‘æˆ˜å’Œå¯èƒ½çš„è§£å†³æ–¹æ¡ˆã€‚æœ€ç»ˆç»“æœæ˜¯å°‘é‡çš„&lt;a href=&#34;https://gateway-api.sigs.k8s.io/contributing/enhancement-requests/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¢å¼ºææ¡ˆ&lt;/a&gt;ï¼Œæ¶µç›–äº†è®¸å¤šå°æ—¶çš„æ€è€ƒå’Œè¾©è®ºï¼Œå¹¶æä¾›äº†ä¸€æ¡æœ€å°å¯è¡Œè·¯å¾„ï¼Œå…è®¸ä½¿ç”¨ Gateway API ç”¨äºæœåŠ¡ç½‘æ ¼ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å½“ä½¿ç”¨-gateway-api-æ—¶ç½‘æ ¼è·¯ç”±å°†å¦‚ä½•å·¥ä½œ&#34;&gt;å½“ä½¿ç”¨ Gateway API æ—¶ï¼Œç½‘æ ¼è·¯ç”±å°†å¦‚ä½•å·¥ä½œï¼Ÿ&lt;/h3&gt;
&lt;p&gt;æ‚¨å¯ä»¥åœ¨&lt;a href=&#34;https://gateway-api.sigs.k8s.io/concepts/gamma/#how-the-gateway-api-works-for-service-mesh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gateway API ç½‘æ ¼è·¯ç”±æ–‡æ¡£&lt;/a&gt;å’Œ&lt;a href=&#34;https://gateway-api.sigs.k8s.io/geps/gep-1426/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GEP-1426&lt;/a&gt;ä¸­æ‰¾åˆ°æ‰€æœ‰è¯¦ç»†ä¿¡æ¯ï¼Œä½†å¯¹äº Gateway API v0.8.0ï¼Œç®€çŸ­çš„ç‰ˆæœ¬æ˜¯ï¼Œç°åœ¨ HTTPRoute å¯ä»¥æœ‰ä¸€ä¸ªâ€œparentRefâ€ï¼Œå®ƒæ˜¯ä¸€ä¸ªæœåŠ¡ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªç½‘å…³ã€‚æˆ‘ä»¬é¢„è®¡åœ¨è¿™ä¸ªé¢†åŸŸä½¿ç”¨æ›´å¤š GEPï¼Œå› ä¸ºéšç€æˆ‘ä»¬å¯¹æœåŠ¡ç½‘æ ¼ç”¨ä¾‹çš„ç»éªŒä¸æ–­å¢åŠ ï¼Œç»‘å®šåˆ°æœåŠ¡ä½¿å¾—ä½¿ç”¨ Gateway API ä¸æœåŠ¡ç½‘æ ¼æˆä¸ºå¯èƒ½ï¼Œä½†ä»æœ‰å‡ ä¸ªæœ‰è¶£çš„ç”¨ä¾‹éš¾ä»¥æ¶µç›–ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ HTTPRoute åœ¨ç½‘æ ¼ä¸­è¿›è¡Œ A-B æµ‹è¯•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;ä»»ä½•å…·æœ‰æ ‡å¤´ &lt;code&gt;env: v1&lt;/code&gt; çš„ &lt;code&gt;demo-app&lt;/code&gt; æœåŠ¡çš„ç«¯å£ 5000 çš„è¯·æ±‚éƒ½å°†è·¯ç”±åˆ° &lt;code&gt;demo-app-v1&lt;/code&gt;ï¼Œè€Œæ²¡æœ‰è¯¥æ ‡å¤´çš„è¯·æ±‚éƒ½å°†è·¯ç”±åˆ° &lt;code&gt;demo-app-v2&lt;/code&gt; - å¹¶ä¸”ç”±äºè¿™æ˜¯ç”±æœåŠ¡ç½‘æ ¼å¤„ç†è€Œä¸æ˜¯å…¥å£æ§åˆ¶å™¨ï¼Œå› æ­¤ A/B æµ‹è¯•å¯ä»¥å‘ç”Ÿåœ¨åº”ç”¨ç¨‹åºçš„è°ƒç”¨å›¾ä¸­çš„ä»»ä½•ä½ç½®ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä½•çŸ¥é“è¿™å°†æ˜¯çœŸæ­£çš„å¯ç§»æ¤æ€§ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Gateway API åœ¨æ”¯æŒçš„æ‰€æœ‰åŠŸèƒ½ä¸Šéƒ½åœ¨æŒç»­æŠ•èµ„ä¸€è‡´æ€§æµ‹è¯•ï¼Œç½‘æ ¼ä¹Ÿä¸ä¾‹å¤–ã€‚GAMMA é¢ä¸´çš„å…¶ä¸­ä¸€ä¸ªæŒ‘æˆ˜æ˜¯ï¼Œè®¸å¤šè¿™äº›æµ‹è¯•éƒ½ä¸ä¸€ä¸ªç»™å®šå®ç°æä¾›å…¥å£æ§åˆ¶å™¨çš„æƒ³æ³•å¯†åˆ‡ç›¸å…³ã€‚è®¸å¤šæœåŠ¡ç½‘æ ¼ä¸æä¾›å…¥å£æ§åˆ¶å™¨ï¼Œè¦æ±‚ç¬¦åˆ GAMMA æ ‡å‡†çš„ç½‘æ ¼åŒæ—¶å®ç°å…¥å£æ§åˆ¶å™¨ä¼¼ä¹å¹¶ä¸åˆ‡å®é™…ã€‚è¿™å¯¼è‡´åœ¨ Gateway API &lt;em&gt;ä¸€è‡´æ€§é…ç½®æ–‡ä»¶&lt;/em&gt;ä¸Šé‡æ–°å¼€å§‹å·¥ä½œï¼Œå¦‚&lt;a href=&#34;https://gateway-api.sigs.k8s.io/geps/gep-1709/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GEP-1709&lt;/a&gt;æ‰€è®¨è®ºçš„é‚£æ ·ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€è‡´æ€§é…ç½®æ–‡ä»¶çš„åŸºæœ¬æ€æƒ³æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ Gateway API çš„å­é›†ï¼Œå¹¶å…è®¸å®ç°é€‰æ‹©ï¼ˆå¹¶è®°å½•ï¼‰ä»–ä»¬ç¬¦åˆå“ªäº›å­é›†ã€‚GAMMA æ­£åœ¨æ·»åŠ ä¸€ä¸ªåä¸ºâ€œMeshâ€çš„æ–°é…ç½®æ–‡ä»¶ï¼Œæè¿°åœ¨&lt;a href=&#34;https://gateway-api.sigs.k8s.io/geps/gep-1686/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GEP-1686&lt;/a&gt;ä¸­ï¼Œä»…æ£€æŸ¥ç”± GAMMA å®šä¹‰çš„ç½‘æ ¼åŠŸèƒ½ã€‚æ­¤æ—¶ï¼ŒKuma 2.3+ã€Linkerd 2.14+ å’Œ Istio 1.16+ éƒ½ç¬¦åˆâ€œMeshâ€é…ç½®æ–‡ä»¶çš„æ ‡å‡†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;gateway-api-v080-ä¸­è¿˜æœ‰ä»€ä¹ˆ&#34;&gt;Gateway API v0.8.0 ä¸­è¿˜æœ‰ä»€ä¹ˆï¼Ÿ&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªç‰ˆæœ¬çš„å‘å¸ƒæ˜¯å…³äºä¸ºå³å°†åˆ°æ¥çš„ v1.0 ç‰ˆæœ¬åšå‡†å¤‡ï¼Œå…¶ä¸­ HTTPRouteã€Gateway å’Œ GatewayClass å°†æ¯•ä¸šä¸º GAã€‚ä¸æ­¤ç›¸å…³çš„æœ‰ä¸¤ä¸ªä¸»è¦æ›´æ”¹ï¼šCEL éªŒè¯å’Œ API ç‰ˆæœ¬æ›´æ”¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;cel-éªŒè¯&#34;&gt;CEL éªŒè¯&lt;/h3&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªé‡å¤§å˜åŒ–æ˜¯ï¼ŒGateway API v0.8.0 æ˜¯ä» webhook éªŒè¯å‘ä½¿ç”¨å†…ç½®äº CRD ä¸­çš„ä¿¡æ¯çš„&lt;a href=&#34;https://kubernetes.io/docs/reference/using-api/cel/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CEL éªŒè¯&lt;/a&gt;çš„è½¬æ¢çš„å¼€ç«¯ã€‚è¿™å°†æ ¹æ®æ‚¨ä½¿ç”¨çš„ Kubernetes ç‰ˆæœ¬è€Œæœ‰æ‰€ä¸åŒï¼š&lt;/p&gt;
&lt;h3 id=&#34;kubernetes-125&#34;&gt;Kubernetes 1.25+&lt;/h3&gt;
&lt;p&gt;CEL éªŒè¯å¾—åˆ°äº†å®Œå…¨æ”¯æŒï¼Œå¹¶ä¸”å‡ ä¹æ‰€æœ‰éªŒè¯éƒ½æ˜¯åœ¨ CEL ä¸­å®ç°çš„ã€‚ï¼ˆå”¯ä¸€çš„ä¾‹å¤–æ˜¯ï¼Œæ ‡å¤´ä¿®é¥°ç¬¦è¿‡æ»¤å™¨ä¸­çš„æ ‡å¤´åç§°åªèƒ½è¿›è¡Œä¸åŒºåˆ†å¤§å°å†™çš„éªŒè¯ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§&lt;a href=&#34;https://github.com/kubernetes-sigs/gateway-api/issues/2277&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;issue 2277&lt;/a&gt;ã€‚ï¼‰&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å»ºè®®åœ¨è¿™äº› Kubernetes ç‰ˆæœ¬ä¸Š&lt;em&gt;ä¸&lt;/em&gt;ä½¿ç”¨éªŒè¯ Webhookã€‚&lt;/p&gt;
&lt;h3 id=&#34;kubernetes-123-å’Œ-124&#34;&gt;Kubernetes 1.23 å’Œ 1.24&lt;/h3&gt;
&lt;p&gt;CEL éªŒè¯ä¸å—æ”¯æŒï¼Œä½†æ˜¯ Gateway API v0.8.0 CRD ä»ç„¶å¯ä»¥å®‰è£…ã€‚å½“æ‚¨å‡çº§åˆ° Kubernetes 1.25+ æ—¶ï¼Œè¿™äº› CRD ä¸­åŒ…å«çš„éªŒè¯å°†è‡ªåŠ¨ç”Ÿæ•ˆã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å»ºè®®åœ¨è¿™äº› Kubernetes ç‰ˆæœ¬ä¸Šç»§ç»­ä½¿ç”¨éªŒè¯ Webhookã€‚&lt;/p&gt;
&lt;h3 id=&#34;kubernetes-122-å’Œæ›´æ—©ç‰ˆæœ¬&#34;&gt;Kubernetes 1.22 å’Œæ›´æ—©ç‰ˆæœ¬&lt;/h3&gt;
&lt;p&gt;Gateway API åªæ‰¿è¯ºæ”¯æŒ&lt;a href=&#34;https://gateway-api.sigs.k8s.io/concepts/versioning/#supported-versions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœ€æ–°çš„ 5 ä¸ª Kubernetes ç‰ˆæœ¬&lt;/a&gt;ã€‚å› æ­¤ï¼Œè¿™äº›ç‰ˆæœ¬ä¸å†å— Gateway API çš„æ”¯æŒï¼Œä¸å¹¸çš„æ˜¯ï¼ŒGateway API v0.8.0 ä¸èƒ½åœ¨å®ƒä»¬ä¸Šå®‰è£…ï¼Œå› ä¸ºåŒ…å« CEL éªŒè¯çš„ CRD å°†è¢«æ‹’ç»ã€‚&lt;/p&gt;
&lt;h3 id=&#34;api-ç‰ˆæœ¬æ›´æ”¹&#34;&gt;API ç‰ˆæœ¬æ›´æ”¹&lt;/h3&gt;
&lt;p&gt;éšç€æˆ‘ä»¬ä¸ºå°† Gatewayã€GatewayClass å’Œ HTTPRoute æ¯•ä¸šåˆ° &lt;code&gt;v1&lt;/code&gt; API ç‰ˆæœ¬ä» &lt;code&gt;v1beta1&lt;/code&gt; åšå‡†å¤‡çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»§ç»­å‡å°‘äº†å·²æ¯•ä¸šåˆ° &lt;code&gt;v1beta1&lt;/code&gt; çš„èµ„æºçš„ &lt;code&gt;v1alpha2&lt;/code&gt; çš„ä½¿ç”¨ã€‚æœ‰å…³æ­¤æ›´æ”¹ä»¥åŠæ­¤ç‰ˆæœ¬ä¸­åŒ…å«çš„æ‰€æœ‰å…¶ä»–å†…å®¹çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§&lt;a href=&#34;https://github.com/kubernetes-sigs/gateway-api/releases/tag/v0.8.0&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;v0.8.0 å‘å¸ƒè¯´æ˜&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¦‚ä½•å¼€å§‹ä½¿ç”¨-gateway-api&#34;&gt;å¦‚ä½•å¼€å§‹ä½¿ç”¨ Gateway APIï¼Ÿ&lt;/h2&gt;
&lt;p&gt;Gateway API ä»£è¡¨äº† Kubernetes ä¸­è´Ÿè½½å¹³è¡¡ã€è·¯ç”±å’ŒæœåŠ¡ç½‘æ ¼ API çš„æœªæ¥ã€‚å·²ç»æœ‰è¶…è¿‡ 20 ä¸ª&lt;a href=&#34;https://gateway-api.sigs.k8s.io/implementations/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®ç°&lt;/a&gt;å¯ç”¨ï¼ˆåŒ…æ‹¬å…¥å£æ§åˆ¶å™¨å’ŒæœåŠ¡ç½‘æ ¼ï¼‰ï¼Œåˆ—è¡¨è¿˜åœ¨ä¸æ–­å¢é•¿ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‚¨æœ‰å…´è¶£å¼€å§‹ä½¿ç”¨ Gateway APIï¼Œè¯·æŸ¥çœ‹&lt;a href=&#34;https://gateway-api.sigs.k8s.io/concepts/api-overview/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;API æ¦‚å¿µæ–‡æ¡£&lt;/a&gt;ï¼Œå¹¶æŸ¥çœ‹ä¸€äº›&lt;a href=&#34;https://gateway-api.sigs.k8s.io/guides/getting-started/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æŒ‡å—&lt;/a&gt;ä»¥å°è¯•ä½¿ç”¨å®ƒã€‚å› ä¸ºè¿™æ˜¯ä¸€ä¸ªåŸºäº CRD çš„ APIï¼Œæ‰€ä»¥æ‚¨å¯ä»¥åœ¨ä»»ä½• Kubernetes 1.23+ é›†ç¾¤ä¸Šå®‰è£…æœ€æ–°ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‚¨ç‰¹åˆ«æœ‰å…´è¶£å¸®åŠ© Gateway API åšå‡ºè´¡çŒ®ï¼Œæˆ‘ä»¬å°†éå¸¸ä¹æ„æ¥å—ï¼è¯·éšæ—¶åœ¨å­˜å‚¨åº“ä¸Š&lt;a href=&#34;https://github.com/kubernetes-sigs/gateway-api/issues/new/choose&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ‰“å¼€æ–°é—®é¢˜&lt;/a&gt;ï¼Œæˆ–åŠ å…¥&lt;a href=&#34;https://github.com/kubernetes-sigs/gateway-api/discussions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è®¨è®º&lt;/a&gt;ã€‚è¿˜è¯·æŸ¥çœ‹&lt;a href=&#34;https://gateway-api.sigs.k8s.io/contributing/community/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¤¾åŒºé¡µé¢&lt;/a&gt;ï¼Œå…¶ä¸­åŒ…æ‹¬ Slack é¢‘é“å’Œç¤¾åŒºä¼šè®®çš„é“¾æ¥ã€‚æˆ‘ä»¬æœŸå¾…æ‚¨çš„åˆ°æ¥ï¼&lt;/p&gt;
&lt;h2 id=&#34;æ›´å¤šé˜…è¯»&#34;&gt;æ›´å¤šé˜…è¯»ï¼š&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://gateway-api.sigs.k8s.io/geps/gep-1324/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GEP-1324&lt;/a&gt;æä¾›äº† GAMMA ç›®æ ‡å’Œä¸€äº›é‡è¦å®šä¹‰çš„æ¦‚è¿°ã€‚è¿™ä¸ª GEP å€¼å¾—ä¸€è¯»ï¼Œå› ä¸ºå®ƒè®¨è®ºäº†é—®é¢˜ç©ºé—´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://gateway-api.sigs.k8s.io/geps/gep-1426/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GEP-1426&lt;/a&gt;å®šä¹‰äº†å¦‚ä½•ä½¿ç”¨ Gateway API è·¯ç”±èµ„æºï¼ˆå¦‚ HTTPRouteï¼‰ç®¡ç†æœåŠ¡ç½‘æ ¼å†…çš„æµé‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://gateway-api.sigs.k8s.io/geps/gep-1686/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GEP-1686&lt;/a&gt;åœ¨&lt;a href=&#34;https://gateway-api.sigs.k8s.io/geps/gep-1709/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GEP-1709&lt;/a&gt;çš„å·¥ä½œåŸºç¡€ä¸Šï¼Œä¸ºå£°æ˜ç¬¦åˆ Gateway API çš„æœåŠ¡ç½‘æ ¼å®šä¹‰äº†ä¸€ä¸ª&lt;em&gt;ä¸€è‡´æ€§é…ç½®æ–‡ä»¶&lt;/em&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è™½ç„¶è¿™äº›éƒ½æ˜¯&lt;a href=&#34;https://gateway-api.sigs.k8s.io/geps/overview/#status&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®éªŒæ€§&lt;/a&gt;æ¨¡å¼ï¼Œä½†è¯·æ³¨æ„ï¼Œå®ƒä»¬å¯åœ¨ &lt;a href=&#34;https://gateway-api.sigs.k8s.io/concepts/versioning/#release-channels-eg-experimental-standard&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;standard&lt;/code&gt; å‘å¸ƒé¢‘é“&lt;/a&gt;ä½¿ç”¨ï¼Œå› ä¸º GAMMA è®¡åˆ’è¿„ä»Šä¸ºæ­¢ä¸éœ€è¦å¼•å…¥æ–°çš„èµ„æºæˆ–å­—æ®µã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes å°†æ¨å‡ºæ–° sidecar container ç‰¹æ€§</title>
      <link>https://cloudnativecn.com/blog/understanding-kubernetes-new-sidecar-container-feature/</link>
      <pubDate>Wed, 02 Aug 2023 11:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/understanding-kubernetes-new-sidecar-container-feature/</guid>
      <description>&lt;p&gt;ä¸Šå‘¨ï¼ŒKubernetes é¡¹ç›®&lt;a href=&#34;https://github.com/kubernetes/kubernetes/pull/116429&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åˆå¹¶&lt;/a&gt;äº†ä¸€ä¸ªæ–°çš„ alpha ç‰¹æ€§ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿåœ¨è§„èŒƒä¸­å®šä¹‰â€œsidecar containersâ€ã€‚è¿™ä¸ªæ–°åŠŸèƒ½æ—¨åœ¨å¸®åŠ©å®šä¹‰å¤šå®¹å™¨ pod ä¸­è¾…åŠ©å®¹å™¨çš„è¡Œä¸ºï¼Œè¿™äº›å®¹å™¨å¯èƒ½æœ‰åŠ©äºé…ç½®ã€ç½‘ç»œã€æ—¥å¿—å’Œåº¦é‡æ”¶é›†ç­‰æ–¹é¢ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯-sidecar-container&#34;&gt;ä»€ä¹ˆæ˜¯ sidecar containerï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ç†è®ºä¸Šï¼ŒKubernetes æœŸæœ›æ‚¨åœ¨æ¯ä¸ª pod ä¸­è¿è¡Œä¸€ä¸ªå®¹å™¨ã€‚å®é™…ä¸Šï¼Œ&lt;a href=&#34;https://www.mirantis.com/blog/kubernetes-pod-vs-container-multi-container-pods-and-container-communication/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è®¸å¤šç”¨ä¾‹éœ€è¦å¤šå®¹å™¨ pod&lt;/a&gt;â€”â€”ä¾‹å¦‚ï¼Œå½“æ‚¨ä½¿ç”¨æŸäº›æœåŠ¡ç½‘æ ¼æ—¶ï¼Œå‡ ä¹æ‰€æœ‰çš„ pod ä¸­éƒ½å¯èƒ½æœ‰ sidecarã€‚&lt;/p&gt;
&lt;p&gt;æœ‰æ—¶ï¼Œè¾…åŠ©å®¹å™¨ä»…ç”¨äºåˆå§‹åŒ–ï¼šä¾‹å¦‚ä¸ºä¸»å®¹å™¨é…ç½®å’Œç®¡ç† secretã€‚Kubernetes å·²ç»ä¸ºç”¨æˆ·æä¾›äº†å®šä¹‰ initContainer çš„æ–¹å¼ä¸€æ®µæ—¶é—´äº†ã€‚è¿™ä¸ªæ–°åŠŸèƒ½æœ€ç»ˆä¸º initContainer æä¾›äº†æ›´ç²¾ç»†çš„ç²’åº¦ï¼Œä»¥åæ˜  sidecar çš„ç‰¹å®šè¦æ±‚ï¼Œç®€åŒ–å¸¸è§ç”¨æ³•æ¨¡å¼å¹¶ä¸ºæœªæ¥å¼€è¾Ÿäº†ä¸€äº›æœ‰è¶£çš„è®¾è®¡ç©ºé—´ã€‚&lt;/p&gt;
&lt;h2 id=&#34;sidecar-container-ç‰¹æ€§å¦‚ä½•å·¥ä½œ&#34;&gt;sidecar container ç‰¹æ€§å¦‚ä½•å·¥ä½œï¼Ÿ&lt;/h2&gt;
&lt;p&gt;åœ¨è¿™ä¸ªæ–°çš„åŠŸèƒ½é—¨æ§ä¸­ï¼Œsidecar containers è¢«å®šä¹‰ä¸º&amp;hellip;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ pod ä¸­æ¯”å…¶ä»–å®¹å™¨æ›´æ—©åœ°å¯åŠ¨ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½éœ€è¦å…ˆåˆå§‹åŒ–ã€‚è¿™å¯¹äºåƒæœåŠ¡ç½‘æ ¼è¿™æ ·çš„äº‹æƒ…å¾ˆé‡è¦ï¼Œå…¶ä¸­æ‚¨å¸Œæœ› sidecar å‡†å¤‡å¥½ä¸ºä¸»å®¹å™¨è¿›ç¨‹å»ºç«‹ç½‘ç»œè¿æ¥ï¼Œä»¥åŠåœ¨æ—¥å¿—è®°å½•æ–¹é¢ï¼Œæ‚¨å¸Œæœ›æ”¶é›†å™¨ sidecar èƒ½å¤ŸæŠ“å–ä¸»å®¹å™¨çš„å¯åŠ¨æ—¥å¿—ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ pod çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…ä¿æŒè¿è¡Œï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½éœ€è¦é•¿æœŸè¿è¡Œã€‚ä¾‹å¦‚ï¼Œåœ¨ç½‘ç»œå’ŒæŒ‡æ ‡/æ—¥å¿—è®°å½•çš„æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦ sidecar è¿è¡Œçš„æ—¶é—´ä¸ä¸»è¿›ç¨‹ä¸€æ ·é•¿ã€‚&lt;/li&gt;
&lt;li&gt;æ°¸è¿œä¸ä¼šé˜»æ­¢ pod è¢«ç»ˆæ­¢ï¼Œå› ä¸ºå®ƒä»¬ä»…æ”¯æŒ pod çš„æ ¸å¿ƒåŠŸèƒ½â€”â€”å¦‚æœæ²¡æœ‰æ–°åŠŸèƒ½ï¼Œè¿è¡Œçš„ sidecar å®¹å™¨å¯ä»¥é˜»æ­¢ä½œä¸šå®Œæˆï¼Œå³ä½¿ pod çš„æ ¸å¿ƒä»»åŠ¡å·²å®Œæˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨è¾ƒä¸‘çš„ä¸€é¢ä¸Šï¼Œåœ¨è¿™ä¸ª alpha å®ç°ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨æ‚¨çš„ &lt;code&gt;initContainer&lt;/code&gt; è§„èŒƒä¸­æ·»åŠ å€¼ä¸º &lt;code&gt;Always&lt;/code&gt; çš„ &lt;code&gt;restartPolicy&lt;/code&gt; å­—æ®µæ¥å®šä¹‰ sidecar containerã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;myapp-pod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;initContainers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;init-myservice&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;busybox:1.28&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;init-mydb&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;busybox:1.28&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio-proxy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;istio/proxyv2:1.16.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;proxy&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;sidecar&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;restartPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Always&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;myapp-container&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;busybox:1.28&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ä¸Šé¢çš„è§„èŒƒä¸­ï¼Œ&lt;strong&gt;init-myservice&lt;/strong&gt; å’Œ &lt;strong&gt;init-mydb&lt;/strong&gt; æ˜¯æ ‡å‡† initContainersï¼Œè€Œè®¾ç½®ä¸º &lt;code&gt;Always&lt;/code&gt; çš„ &lt;code&gt;restartPolicy&lt;/code&gt; å­—æ®µä½¿ &lt;strong&gt;istio-proxy&lt;/strong&gt; æˆä¸º sidecar containerã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæ–°ç‰¹æ€§çš„ Kubernetes Enhancement Proposal (KEP) æ‰¿è®¤äº†è¿™ç§è¡¨é¢ä¸Šçš„ä¸ä¼˜é›…ï¼ŒæŒ‡å‡º initContainerâ€œä¸é€‚åˆä½œä¸º sidecar containersï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸åšçš„ä¸ä»…æ˜¯åˆå§‹åŒ–â€ï¼Œå¹¶å»ºè®®â€œåŸºç¡€è®¾æ–½å®¹å™¨â€æ˜¯ä¸€ä¸ªæ›´å¥½çš„åç§°ï¼Œæœªæ¥å¯èƒ½ä¼šé‡‡ç”¨ã€‚KEP è§£é‡Šäº†é€‰æ‹©çš„ç»“æ„èƒŒåçš„æ€è€ƒæ–¹å¼ï¼š&lt;/p&gt;
&lt;p&gt;&amp;hellip;&amp;hellip;å°† sidecar containers å®šä¹‰åœ¨å…¶ä»– init å®¹å™¨ä¹‹é—´æ˜¯å¾ˆé‡è¦çš„ï¼Œä»¥ä¾¿èƒ½å¤Ÿè¡¨è¾¾å®¹å™¨çš„åˆå§‹åŒ–é¡ºåºã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä½é«˜çº§è´¡çŒ®è€…åœ¨ Hacker News ä¸Šè¡¥å……äº†ä¸€äº›ç»†èŠ‚ï¼ŒæŒ‡å‡ºï¼š&lt;/p&gt;
&lt;p&gt;åˆ†ç¦»å±æ€§çš„æŒ‘æˆ˜åœ¨äºå®ƒä¸æˆ‘ä»¬å¯èƒ½æ·»åŠ åˆ° pod å‘¨å›´çš„æœ‰å…³æ’åºå’Œç”Ÿå‘½å‘¨æœŸçš„æ–°åŠŸèƒ½ä¸å…¼å®¹ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç®€å•çš„å¸ƒå°”å€¼ï¼Œæœ€ç»ˆæˆ‘ä»¬å°†ä¸å¾—ä¸è®©å®ƒä¸å…¶ä»–å­—æ®µäº¤äº’ï¼Œå¹¶å¤„ç†â€œsidecarâ€çš„å«ä¹‰å’Œæ›´çµæ´»æ€§ä¹‹é—´çš„å†²çªè¡Œä¸ºã€‚[&amp;hellip;]æˆ‘ä»¬ä¸º init containers å¯ä»¥å¤±è´¥ podã€å¹¶ä¸”å¯ä»¥å¹¶è¡ŒåŒ–ã€ä»¥åŠå¸¸è§„å®¹å™¨å…·æœ‰å”¯ä¸€çš„ restartPolicies ç•™å‡ºäº†ç©ºé—´ã€‚è¿™ä¸¤ä¸ªéƒ½å°†å…è®¸æ›´å¤šçš„å·¥ä½œæµ/ä½œä¸šå¼•æ“æ§åˆ¶ï¼Œä»¥åˆ†è§£å•ä½“å®¹å™¨å¹¶è·å¾—æ›´å¥½çš„éš”ç¦»ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨&lt;a href=&#34;https://news.ycombinator.com/item?id=36666359&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¦ä¸€ä¸ªè¯„è®º&lt;/a&gt;ä¸­ï¼Œä»–ä»¬è¡¥å……è¯´ï¼Œå›¢é˜Ÿæƒ³è¦&amp;hellip;&lt;/p&gt;
&lt;p&gt;&amp;hellip;&amp;hellip;ç•™ä¸‹æ›´å¤æ‚çš„ init containers å’Œ sidecars çš„æ’åºï¼ˆå¸¸è§„å®¹å™¨æ²¡æœ‰ restart é¡ºåºï¼‰ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½éœ€è¦ä¸€ä¸ªæœåŠ¡ç½‘æ ¼æ¥éœ€è¦ä¸€ä¸ª vault secretâ€”â€”è¿™ä¸¤ä¸ªå¯èƒ½éƒ½æ˜¯ sidecarsï¼Œå¹¶ä¸”å¦‚æœä¸¤è€…éƒ½å…³é—­ï¼Œæ‚¨å¯èƒ½éœ€è¦ç¡®ä¿ vault sidecar é¦–å…ˆå¯åŠ¨ã€‚æœ€ç»ˆï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›åœ¨å¯åŠ¨é¡ºåºä¸­æ·»åŠ å¹¶è¡Œæ€§ï¼Œè€Œå•ç‹¬çš„å­—æ®µå°†é˜»æ­¢ç®€å•çš„æ’åºç°åœ¨èµ·ä½œç”¨ã€‚&lt;/p&gt;
&lt;p&gt;KEP æä¾›äº†æœ‰å…³å¼•å‘è¯¥åŠŸèƒ½çš„é—®é¢˜æ¡ˆä¾‹ä»¥åŠä¸€äº›ç»„ç»‡æ­£åœ¨è¿è¡Œ Kubernetes åˆ†å‰ä»¥å®ç°ç±»ä¼¼åŠŸèƒ½çš„æœ‰è¶£æ›´å¹¿æ³›çš„èƒŒæ™¯çš„è¯¦ç»†è§è§£ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‚¨è¿«ä¸åŠå¾…åœ°æƒ³åœ¨æ–°çš„æµ‹è¯•é›†ç¾¤ä¸Šå°è¯•è¿™ä¸ªæ–°åŠŸèƒ½ï¼Œæ‚¨éœ€è¦ä¸º kubeletã€kube-apiserverã€kube-controller-manager å’Œ kube-scheduler å¯ç”¨ SidecarContainers feature gateã€‚KEP æä¾›äº†æœ‰å…³é»˜è®¤ç­–ç•¥å’Œå®ç°çš„æœ‰ç”¨ç»†èŠ‚ï¼Œæ‚¨å¯ä»¥æœŸå¾…åœ¨ 8 æœˆä»½å‘å¸ƒ Kubernetes 1.28 æ—¶çœ‹åˆ°æ›´å¤šå…³äºæ­¤åŠŸèƒ½çš„è®¨è®ºã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes ç½‘ç»œç­–ç•¥å…¥é—¨ï¼šæ¦‚å¿µã€ç¤ºä¾‹å’Œæœ€ä½³å®è·µ</title>
      <link>https://cloudnativecn.com/blog/understanding-kubernetes-network-policies/</link>
      <pubDate>Wed, 12 Jul 2023 10:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/understanding-kubernetes-network-policies/</guid>
      <description>&lt;p&gt;åœ¨ Kubernetes ä¸­ï¼ŒåŒä¸€å‘½åç©ºé—´ä¸­çš„ä»»ä½• Pod éƒ½å¯ä»¥ä½¿ç”¨å…¶ IP åœ°å€ç›¸äº’é€šä¿¡ï¼Œæ— è®ºå®ƒå±äºå“ªä¸ªéƒ¨ç½²æˆ–æœåŠ¡ã€‚è™½ç„¶è¿™ç§é»˜è®¤è¡Œä¸ºé€‚ç”¨äºå°è§„æ¨¡åº”ç”¨ï¼Œä½†åœ¨è§„æ¨¡æ‰©å¤§å’Œå¤æ‚åº¦å¢åŠ çš„æƒ…å†µä¸‹ï¼ŒPod ä¹‹é—´çš„æ— é™é€šä¿¡å¯èƒ½ä¼šå¢åŠ æ”»å‡»é¢å¹¶å¯¼è‡´å®‰å…¨æ¼æ´ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨é›†ç¾¤ä¸­å®æ–½ Kubernetes ç½‘ç»œç­–ç•¥å¯ä»¥æ”¹å–„ä»¥ä¸‹æ–¹é¢ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨æ€§ï¼š&lt;/strong&gt; ä½¿ç”¨ Kubernetes ç½‘ç»œç­–ç•¥ï¼Œä½ å¯ä»¥æŒ‡å®šå…è®¸å“ªäº› Pod æˆ–æœåŠ¡ç›¸äº’é€šä¿¡ï¼Œä»¥åŠåº”è¯¥é˜»æ­¢å“ªäº›æµé‡è®¿é—®ç‰¹å®šçš„èµ„æºã€‚è¿™æ ·å¯ä»¥æ›´å®¹æ˜“åœ°é˜²æ­¢æœªç»æˆæƒçš„è®¿é—®æ•æ„Ÿæ•°æ®æˆ–æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆè§„æ€§ï¼š&lt;/strong&gt; åœ¨åŒ»ç–—ä¿å¥æˆ–é‡‘èæœåŠ¡ç­‰è¡Œä¸šï¼Œåˆè§„æ€§è¦æ±‚ä¸å¯å¦¥åã€‚é€šè¿‡ç¡®ä¿æµé‡ä»…åœ¨ç‰¹å®šçš„å·¥ä½œè´Ÿè½½ä¹‹é—´æµåŠ¨ï¼Œä»¥æ»¡è¶³åˆè§„è¦æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•…éšœæ’é™¤ï¼š&lt;/strong&gt; é€šè¿‡æä¾›å…³äºåº”è¯¥ç›¸äº’é€šä¿¡çš„ Pod å’ŒæœåŠ¡çš„å¯è§æ€§ï¼Œå¯ä»¥æ›´è½»æ¾åœ°è§£å†³ç½‘ç»œé—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤§å‹é›†ç¾¤ä¸­ã€‚ç­–ç•¥è¿˜å¯ä»¥å¸®åŠ©ä½ ç¡®å®šç½‘ç»œé—®é¢˜çš„æºï¼Œä»è€ŒåŠ å¿«è§£å†³é€Ÿåº¦ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;kubernetes-ç½‘ç»œç­–ç•¥ç»„ä»¶&#34;&gt;Kubernetes ç½‘ç»œç­–ç•¥ç»„ä»¶&lt;/h2&gt;
&lt;p&gt;å¼ºå¤§çš„ç½‘ç»œç­–ç•¥åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç­–ç•¥ç±»å‹ï¼š&lt;/strong&gt; Kubernetes ç½‘ç»œç­–ç•¥æœ‰ä¸¤ç§ç±»å‹ï¼šå…¥å£å’Œå‡ºå£ã€‚å…¥å£ç­–ç•¥å…è®¸ä½ æ§åˆ¶æµå…¥ Pod çš„æµé‡ï¼Œè€Œå‡ºå£ç­–ç•¥å…è®¸ä½ æ§åˆ¶ä» Pod æµå‡ºçš„æµé‡ã€‚å®ƒä»¬åœ¨ &lt;code&gt;NetworkPolicy&lt;/code&gt; èµ„æºçš„ &lt;code&gt;policyTypes&lt;/code&gt; å­—æ®µä¸­æŒ‡å®šã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¥å£è§„åˆ™ï¼š&lt;/strong&gt; è¿™äº›å®šä¹‰äº† Pod çš„ä¼ å…¥æµé‡ç­–ç•¥ï¼ŒæŒ‡å®šåœ¨ &lt;code&gt;NetworkPolicy&lt;/code&gt; èµ„æºçš„ &lt;code&gt;ingress&lt;/code&gt; å­—æ®µä¸­ã€‚ä½ å¯ä»¥å®šä¹‰æµé‡çš„æ¥æºï¼Œå¯ä»¥æ˜¯ Podã€å‘½åç©ºé—´æˆ– IP å—ï¼Œä»¥åŠå…è®¸è®¿é—®æµé‡çš„ç›®æ ‡ç«¯å£æˆ–ç«¯å£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‡ºå£è§„åˆ™ï¼š&lt;/strong&gt; è¿™äº›å®šä¹‰äº† Pod çš„ä¼ å‡ºæµé‡ç­–ç•¥ã€‚åœ¨è¿™é‡Œï¼Œä½ å°†æŒ‡å®šæµé‡çš„ç›®æ ‡ï¼Œå¯ä»¥æ˜¯ Podã€å‘½åç©ºé—´æˆ– IP å—ï¼Œä»¥åŠå…è®¸è®¿é—®æµé‡çš„ç›®æ ‡ç«¯å£æˆ–ç«¯å£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Pod é€‰æ‹©å™¨ï¼š&lt;/strong&gt; è¿™äº›é€‰æ‹©è¦åº”ç”¨ç­–ç•¥çš„ Podã€‚ä¸ºé€‰æ‹©å™¨æŒ‡å®šæ ‡ç­¾ï¼Œä¸é€‰æ‹©å™¨åŒ¹é…çš„ Pod å°†å—åˆ°ç­–ç•¥ä¸­æŒ‡å®šçš„è§„åˆ™çš„çº¦æŸã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‘½åç©ºé—´é€‰æ‹©å™¨ï¼š&lt;/strong&gt; ç±»ä¼¼äº Pod é€‰æ‹©å™¨ï¼Œè¿™äº›å…è®¸ä½ é€‰æ‹©è¦åº”ç”¨ç­–ç•¥çš„å‘½åç©ºé—´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;IP åœ°å€å—é€‰æ‹©å™¨ï¼š&lt;/strong&gt; IP åœ°å€å—é€‰æ‹©å™¨æŒ‡å®šè¦å…è®¸æˆ–æ‹’ç»æµé‡çš„ IP åœ°å€èŒƒå›´ã€‚ä½ å¯ä»¥ä½¿ç”¨&lt;a href=&#34;https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CIDR è¡¨ç¤ºæ³•&lt;/a&gt;æ¥æŒ‡å®š IP åœ°å€èŒƒå›´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å®æ–½ç½‘ç»œç­–ç•¥&#34;&gt;å®æ–½ç½‘ç»œç­–ç•¥&lt;/h2&gt;
&lt;p&gt;ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¿›å…¥åˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤ Kubernetes ä¸­çš„ç½‘ç»œç­–ç•¥ã€‚æœ¬æ•™ç¨‹å°†é€šè¿‡åˆ›å»ºä¸‰ä¸ªæ¼”ç¤ºåº”ç”¨ç¨‹åºï¼ˆfrontendã€backend å’Œ databaseï¼‰ï¼Œæ¥æ¼”ç¤ºå¦‚ä½•åœ¨åº”ç”¨ç¨‹åºä¹‹é—´é™åˆ¶å’Œå…è®¸ç½‘ç»œæµé‡ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œä½ éœ€è¦è¿è¡Œä¸€ä¸ªé›†ç¾¤ã€‚ä¸ºäº†åœ¨ä½ çš„æœºå™¨ä¸Šåˆ›å»ºæœ¬åœ°é›†ç¾¤ï¼Œæˆ‘å»ºè®®ä½¿ç”¨&lt;a href=&#34;https://minikube.sigs.k8s.io/docs/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;minikube&lt;/a&gt;ã€‚ç”±äº minikube é»˜è®¤ä¸æ”¯æŒç½‘ç»œç­–ç•¥ï¼Œå› æ­¤è¯·ä½¿ç”¨ç±»ä¼¼&lt;a href=&#34;https://www.projectcalico.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Calico&lt;/a&gt;æˆ–&lt;a href=&#34;https://www.weave.works/oss/net&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Weave Net&lt;/a&gt;çš„ç½‘ç»œæ’ä»¶å¯åŠ¨ minikubeã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ minikubeï¼Œä»¥ä¾¿ä½ æ‹¥æœ‰å¸¦æœ‰ç½‘ç»œæ”¯æŒçš„ minikube é›†ç¾¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;minikube start --network-plugin&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;cni --cni&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;calico
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰äº†è¿è¡Œä¸­çš„é›†ç¾¤ï¼Œæœ¬æ•™ç¨‹ä½¿ç”¨ä¸“ç”¨å‘½åç©ºé—´æ¥ä¿æŒé›†ç¾¤çš„ç»„ç»‡æ€§ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create namespace network-policy-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨è¯¥å‘½åç©ºé—´ä¸­åˆ›å»ºä¸‰ä¸ªç¤ºä¾‹ Podï¼ˆBackendã€Database å’Œ Frontendï¼‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl run backend --image&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;nginx --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;network-policy-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl run database --image&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;nginx --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;network-policy-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl run frontend --image&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;nginx --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;network-policy-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éªŒè¯ Pod æ˜¯å¦æ­£åœ¨è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get pods --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;network-policy-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ åº”è¯¥ä¼šå¾—åˆ°ä»¥ä¸‹å“åº”ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME       READY   STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;backend    1/1     Running    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;         12s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;database   1/1     Running    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;         12s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;frontend   1/1     Running    &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;         22s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸º Pod åˆ›å»ºç›¸åº”çš„æœåŠ¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl expose pod backend --port &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt; --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;network-policy-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl expose pod database --port &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt; --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;network-policy-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl expose pod frontend --port &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt; --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;network-policy-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è·å–ç›¸åº”æœåŠ¡çš„ IPï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get service --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;network-policy-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ åº”è¯¥ä¼šå¾—åˆ°ç±»ä¼¼ä»¥ä¸‹çš„å“åº”ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME       TYPE        CLUSTER-IP               EXTERNAL-IP   PORT&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;S&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;backend    ClusterIP   &amp;lt;BACKEND-CLUSTER-IP&amp;gt;     &amp;lt;none&amp;gt;        80/TCP    24s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;database   ClusterIP   &amp;lt;DATABASE-CLUSTER-IP&amp;gt;    &amp;lt;none&amp;gt;        80/TCP    24s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;frontend   ClusterIP   &amp;lt;FRONTEND-CLUSTER-IP&amp;gt;    &amp;lt;none&amp;gt;        80/TCP    24s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ£€æŸ¥&lt;code&gt;frontend&lt;/code&gt;æ˜¯å¦å¯ä»¥ä¸&lt;code&gt;backend&lt;/code&gt;å’Œ&lt;code&gt;database&lt;/code&gt;é€šä¿¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it frontend --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;network-policy-tutorial -- curl &amp;lt;BACKEND-CLUSTER-IP&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it frontend --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;network-policy-tutorial -- curl &amp;lt;DATABASE-CLUSTER-IP&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°†&amp;lt;&lt;code&gt;BACKEND-CLUSTER-IP&lt;/code&gt;&amp;gt;å’Œ&amp;lt;&lt;code&gt;DATABASE-CLUSTER-IP&lt;/code&gt;&amp;gt;æ›¿æ¢ä¸ºå®ƒä»¬å„è‡ªçš„ IPã€‚é€šè¿‡è¿è¡Œ&lt;code&gt;kubectl get service --namespace=network-policy-tutorial&lt;/code&gt;æ‰¾åˆ°å®ƒä»¬ã€‚&lt;/p&gt;
&lt;p&gt;ä½ ä¼šå¾—åˆ°ä»¥ä¸‹å›åº”ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/understanding-kubernetes-network-policies/1_hu15777613567211199754.webp 400w,
               /blog/understanding-kubernetes-network-policies/1_hu5466822081211628664.webp 760w,
               /blog/understanding-kubernetes-network-policies/1_hu7580224575758289205.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/understanding-kubernetes-network-policies/1_hu15777613567211199754.webp&#34;
               width=&#34;760&#34;
               height=&#34;306&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;ç¤ºä¾‹-1åœ¨å‘½åç©ºé—´ä¸­é™åˆ¶æµé‡&#34;&gt;ç¤ºä¾‹ 1ï¼šåœ¨å‘½åç©ºé—´ä¸­é™åˆ¶æµé‡&lt;/h3&gt;
&lt;p&gt;æ­¤ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•åœ¨&lt;code&gt;network-policy-tutorial&lt;/code&gt;å‘½åç©ºé—´å†…é™åˆ¶æµé‡ã€‚ä½ å°†é˜»æ­¢&lt;code&gt;frontend&lt;/code&gt;åº”ç”¨ç¨‹åºä¸&lt;code&gt;backend&lt;/code&gt;å’Œ&lt;code&gt;database&lt;/code&gt;åº”ç”¨ç¨‹åºé€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªåä¸º&lt;code&gt;namespace-default-deny.yaml&lt;/code&gt;çš„ç­–ç•¥ï¼Œè¯¥ç­–ç•¥æ‹’ç»å‘½åç©ºé—´ä¸­çš„æ‰€æœ‰æµé‡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.k8s.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NetworkPolicy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;namespace-default-deny&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;network-policy-tutorial&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;podSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;policyTypes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;Ingress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;Egress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°†ç½‘ç»œç­–ç•¥é…ç½®åº”ç”¨äºé›†ç¾¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f namespace-default-deny.yaml --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;network-policy-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨ï¼Œå†æ¬¡å°è¯•ä» &lt;code&gt;frontend&lt;/code&gt; è®¿é—® &lt;code&gt;backend&lt;/code&gt; å’Œ &lt;code&gt;database&lt;/code&gt; ï¼Œä½ ä¼šå‘ç° &lt;code&gt;frontend&lt;/code&gt; å’Œ &lt;code&gt;backend&lt;/code&gt; ä»¥åŠ &lt;code&gt;database&lt;/code&gt; ä¹‹é—´å·²ç»æ— æ³•é€šä¿¡äº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it frontend --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;network-policy-tutorial -- curl &amp;lt;BACKEND-CLUSTER-IP&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it frontend --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;network-policy-tutorial -- curl &amp;lt;DATABASE-CLUSTER-IP&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ç¤ºä¾‹-2å…è®¸ç‰¹å®š-pod-çš„æµé‡&#34;&gt;ç¤ºä¾‹ 2ï¼šå…è®¸ç‰¹å®š Pod çš„æµé‡&lt;/h3&gt;
&lt;p&gt;ç°åœ¨ï¼Œæˆ‘ä»¬çœ‹çœ‹èƒ½å¦åœ¨é›†ç¾¤ä¸­å…è®¸ä»¥ä¸‹å¤–éƒ¨æµé‡ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;frontend -&amp;gt; backend -&amp;gt; database
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™æ ·ï¼Œ &lt;code&gt;frontend&lt;/code&gt; åªèƒ½å‘ &lt;code&gt;backend&lt;/code&gt; å‘é€å¤–éƒ¨æµé‡ï¼Œè€Œ &lt;code&gt;backend&lt;/code&gt; åªèƒ½ä» &lt;code&gt;frontend&lt;/code&gt; æ¥æ”¶å†…éƒ¨æµé‡ã€‚åŒæ ·ï¼Œ &lt;code&gt;backend&lt;/code&gt; åªèƒ½å‘ &lt;code&gt;database&lt;/code&gt; å‘é€å¤–éƒ¨æµé‡ï¼Œè€Œ &lt;code&gt;database&lt;/code&gt; åªèƒ½ä» &lt;code&gt;backend&lt;/code&gt; æ¥æ”¶å†…éƒ¨æµé‡ã€‚&lt;/p&gt;
&lt;p&gt;åˆ›å»ºä¸€ä¸ªåä¸º &lt;code&gt;frontend-default-policy.yaml&lt;/code&gt; çš„æ–°ç­–ç•¥ï¼Œå¹¶å°†ä»¥ä¸‹ä»£ç ç²˜è´´åˆ°å…¶ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.k8s.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NetworkPolicy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;frontend-default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;network-policy-tutorial&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;podSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;frontend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;policyTypes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;Egress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;egress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;podSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥åº”ç”¨è¯¥ç­–ç•¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f frontend-default-policy.yaml --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;network-policy-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯¹äº &lt;code&gt;backend&lt;/code&gt; ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º &lt;code&gt;backend-default-policy.yaml&lt;/code&gt; çš„æ–°ç­–ç•¥ï¼Œå¹¶å°†ä»¥ä¸‹ä»£ç ç²˜è´´åˆ°å…¶ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.k8s.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NetworkPolicy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;backend-default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;network-policy-tutorial&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;podSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;policyTypes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;Ingress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;Egress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ingress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;podSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;frontend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;egress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;podSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;database&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†æ¬¡è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥åº”ç”¨è¯¥ç­–ç•¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f backend-default-policy.yaml --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;network-policy-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åï¼ŒæŒ‰ç…§ç±»ä¼¼çš„æ–¹å¼ä¸º &lt;code&gt;database&lt;/code&gt; åˆ›å»ºä¸€ä¸ªæ–°ç­–ç•¥ &lt;code&gt;database-default-policy.yaml&lt;/code&gt;ï¼Œå¹¶å°†ä»¥ä¸‹ä»£ç ç²˜è´´åˆ°å…¶ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.k8s.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NetworkPolicy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;database-default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;network-policy-tutorial&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;podSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;database&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;policyTypes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;Ingress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ingress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;podSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥åº”ç”¨è¯¥ç­–ç•¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f database-default-policy.yaml --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;network-policy-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨ï¼Œå·²åº”ç”¨è¿™äº›ç½‘ç»œç­–ç•¥é…ç½®åï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œä»¥æ¥æ”¶å“åº”ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it frontend --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;network-policy-tutorial -- curl &amp;lt;BACKEND-CLUSTER-IP&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it backend --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;network-policy-tutorial -- curl &amp;lt;DATABASE-CLUSTER-IP&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½†æ˜¯ï¼Œå¦‚æœæ‰§è¡Œ&lt;em&gt;ä¸‹é¢çš„è¿™æ®µä»£ç &lt;/em&gt;ï¼Œä½ å°†ä¸ä¼šæ”¶åˆ°å“åº”ï¼Œå› ä¸ºåœ¨è¯¥å‘½åç©ºé—´ä¸­æœªæ‰“å¼€æµé‡æµï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it backend --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;network-policy-tutorial -- curl &amp;lt;FRONTEND-CLUSTER-IP&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it database --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;network-policy-tutorial -- curl &amp;lt;FRONTEND-CLUSTER-IP&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it database --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;network-policy-tutorial -- curl &amp;lt;BACKEND-CLUSTER-IP&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ç¤ºä¾‹-3åœ¨å•ä¸ªç­–ç•¥ä¸­ç»„åˆå…¥ç«™å’Œå‡ºç«™è§„åˆ™&#34;&gt;ç¤ºä¾‹ 3ï¼šåœ¨å•ä¸ªç­–ç•¥ä¸­ç»„åˆå…¥ç«™å’Œå‡ºç«™è§„åˆ™&lt;/h3&gt;
&lt;p&gt;å½“ä½ éœ€è¦æ§åˆ¶é›†ç¾¤ä¸­åº”ç”¨ç¨‹åºçš„å…¥ç«™å’Œå‡ºç«™æµé‡æ—¶ï¼Œä½ ä¸å¿…ä¸ºæ¯ä¸ªæµé‡æµåˆ›å»ºå•ç‹¬çš„ç½‘ç»œç­–ç•¥ã€‚ç›¸åï¼Œä½ å¯ä»¥å°†å…¥ç«™å’Œå‡ºç«™æµé‡ç»„åˆåˆ°ä¸€ä¸ªç½‘ç»œç­–ç•¥ä¸­ï¼Œå°±åƒåœ¨è¿™ä¸ª &lt;code&gt;backend-default-policy.yaml&lt;/code&gt; æ–‡ä»¶çš„å†…å®¹ä¸­æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.k8s.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NetworkPolicy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;backend-default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;network-policy-tutorial&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;podSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;policyTypes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;Ingress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;Egress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ingress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;podSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;frontend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;egress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;podSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;database&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ç¤ºä¾‹-4é˜»æ­¢å¯¹ç‰¹å®š-ip-èŒƒå›´çš„å‡ºç«™æµé‡&#34;&gt;ç¤ºä¾‹ 4ï¼šé˜»æ­¢å¯¹ç‰¹å®š IP èŒƒå›´çš„å‡ºç«™æµé‡&lt;/h3&gt;
&lt;p&gt;å®é™…ä¸Šï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚ä½ ä¹Ÿå¯ä»¥é…ç½®æŸäº›åº”ç”¨ç¨‹åºå‘ä½ çš„é›†ç¾¤ä¸­çš„ç‰¹å®š IP å‘é€æµé‡ã€‚&lt;/p&gt;
&lt;p&gt;è€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„&lt;code&gt;yaml&lt;/code&gt;é…ç½®æ–‡ä»¶ï¼Œè®©æˆ‘ä»¬æ›´æ–°ä½ ä¹‹å‰åˆ›å»ºçš„&lt;code&gt;backend-default-policy.yaml&lt;/code&gt;æ–‡ä»¶ã€‚ä½ å°†æ›¿æ¢&lt;code&gt;yaml&lt;/code&gt;é…ç½®çš„å‡ºç«™éƒ¨åˆ†ã€‚ä¸ä½¿ç”¨&lt;code&gt;podSelector&lt;/code&gt;æ¥é™åˆ¶ IP åˆ°æ•°æ®åº“ï¼Œè€Œæ˜¯ä½¿ç”¨&lt;code&gt;ipBlock&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ä»¥ä¸‹ä»£ç æ›´æ–°æ–‡ä»¶çš„å†…å®¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.k8s.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NetworkPolicy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;backend-default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;network-policy-tutorial&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;podSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;policyTypes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;Ingress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;Egress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ingress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;podSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;frontend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;egress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;ipBlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;             &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cidr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;&amp;lt;DATABASE-CLUSTER-IP&amp;gt;/24&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æ­¤æ›´æ–°çš„&lt;code&gt;backend-default-policy.yaml&lt;/code&gt;é…ç½®ä¸­ï¼Œä½ å°†é˜»æ­¢å‰ç«¯åº”ç”¨ç¨‹åºå‘è¿™ä¸ª IP èŒƒå›´ï¼ˆ&amp;lt;&lt;code&gt;DATABASE-CLUSTER-IP&lt;/code&gt;&amp;gt;&lt;code&gt;/24&lt;/code&gt;ï¼‰å‘é€å‡ºç«™æµé‡ï¼Œè¿™ä¸ª IP èŒƒå›´åŒ…å«ä½ çš„æ•°æ®åº“ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä½ çš„ &amp;lt;&lt;code&gt;DATABASE-CLUSTER-IP&lt;/code&gt;&amp;gt; æ˜¯&lt;code&gt;10.10.10.10&lt;/code&gt;ï¼Œé‚£ä¹ˆä»&lt;code&gt;10.10.10.0&lt;/code&gt;åˆ°&lt;code&gt;10.10.10.255&lt;/code&gt;çš„æ‰€æœ‰ IP è¯·æ±‚éƒ½è¢«é˜»æ­¢ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨åº”ç”¨é…ç½®ä¹‹å‰ï¼Œé¦–å…ˆæ£€æŸ¥ç½‘ç»œç­–ç•¥ã€‚ä½ åº”è¯¥çœ‹åˆ°ä»¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get networkpolicy --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;network-policy-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                    POD-SELECTOR   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;backend-default         &lt;span class=&#34;nv&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;backend    6m16s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;database-default        &lt;span class=&#34;nv&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;database   5m48s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;frontend-default        &lt;span class=&#34;nv&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;frontend   6m50s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;namespace-default-deny  &amp;lt;none&amp;gt;         8m22s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨ï¼Œåœ¨ä½ çš„é›†ç¾¤ä¸­åº”ç”¨&lt;code&gt;backend-default-policy.yaml&lt;/code&gt;çš„æ›´æ–°é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f backend-default-policy.yaml --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;network-policy-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯·æ³¨æ„ï¼Œæ²¡æœ‰æ·»åŠ æ–°çš„ç½‘ç»œç­–ç•¥ã€‚è¿™æ˜¯å› ä¸ºä½ æ²¡æœ‰æ›´æ”¹&lt;code&gt;metadata.name&lt;/code&gt;æ ‡ç­¾ï¼ŒKubernetes æ›´æ–°äº†ç½‘ç»œç­–ç•¥çš„é…ç½®ï¼Œè€Œä¸æ˜¯åˆ›å»ºæ–°çš„ç½‘ç»œç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨ï¼Œå¦‚æœä½ å°è¯•ä» &lt;code&gt;frontend&lt;/code&gt; è®¿é—® &lt;code&gt;database&lt;/code&gt; ï¼Œå°±ä¸å†å¯èƒ½äº†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it backend --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;network-policy-tutorial -- curl &amp;lt;DATABASE-CLUSTER-IP&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨ &lt;code&gt;kubectl delete&lt;/code&gt; å‘½ä»¤åˆ é™¤ç½‘ç»œç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥è¿™æ ·åˆ é™¤ &lt;code&gt;backend-default-policy&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete -f backend-default-policy.yaml --namespace&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;network-policy-tutorial
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é…ç½®ä½¿ &lt;code&gt;backend&lt;/code&gt; èƒ½å¤Ÿä» &lt;code&gt;frontend&lt;/code&gt; æ¥æ”¶æµé‡çš„ç½‘ç»œç­–ç•¥å·²è¢«åˆ é™¤ï¼› &lt;code&gt;frontend&lt;/code&gt; åº”ç”¨ç¨‹åºæ— æ³•å†è®¿é—® &lt;code&gt;backend&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;h2 id=&#34;kubernetes-ç½‘ç»œç­–ç•¥ä½¿ç”¨çš„æœ€ä½³å®è·µ&#34;&gt;Kubernetes ç½‘ç»œç­–ç•¥ä½¿ç”¨çš„æœ€ä½³å®è·µ&lt;/h2&gt;
&lt;p&gt;å½“ç„¶ï¼Œåœ¨åˆ›å»º Kubernetes ç½‘ç»œç­–ç•¥æ—¶ï¼Œæœ‰ä¸€äº›æœ€ä½³å®è·µéœ€è¦è®°ä½ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å…¶ä¸­å‡ ä¸ªæœ€é‡è¦çš„å®è·µã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¡®ä¿é€‚å½“çš„éš”ç¦»&#34;&gt;ç¡®ä¿é€‚å½“çš„éš”ç¦»&lt;/h3&gt;
&lt;p&gt;ç”±äº Kubernetes ç½‘ç»œç­–ç•¥å…è®¸ä½ æ§åˆ¶ pod ä¹‹é—´çš„ç½‘ç»œæµé‡ï¼Œå› æ­¤å®šä¹‰å®ƒä»¬ä»¥ç¡®ä¿é€‚å½“çš„éš”ç¦»è‡³å…³é‡è¦ã€‚&lt;/p&gt;
&lt;p&gt;ç¡®ä¿é€‚å½“éš”ç¦»çš„ç¬¬ä¸€æ­¥æ˜¯ç¡®å®šå“ªäº› pod åº”è¯¥å…è®¸å½¼æ­¤é€šä¿¡ï¼Œå“ªäº›åº”è¯¥ç›¸äº’éš”ç¦»ã€‚ç„¶åå®šä¹‰è§„åˆ™æ¥å¼ºåˆ¶æ‰§è¡Œè¿™äº›ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;ä½ è¿˜åº”è¯¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨å‘½åç©ºé—´å°†å·¥ä½œè´Ÿè½½å½¼æ­¤éš”ç¦»ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºæ¯ä¸ªå‘½åç©ºé—´å®šä¹‰ç½‘ç»œç­–ç•¥ï¼Œæ ¹æ®æœ€å°æƒé™åŸåˆ™é™åˆ¶æµé‡ã€‚&lt;/li&gt;
&lt;li&gt;å°† pod å’ŒæœåŠ¡ä¹‹é—´çš„ç½‘ç»œæµé‡é™åˆ¶ä¸ºä»…æ»¡è¶³å…¶æ“ä½œæ‰€éœ€çš„å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨æ ‡ç­¾å’Œé€‰æ‹©å™¨å°†ç½‘ç»œç­–ç•¥åº”ç”¨äºç‰¹å®šçš„ pod å’Œ/æˆ–æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç›‘æ§å’Œè®°å½•ç½‘ç»œç­–ç•¥æ´»åŠ¨&#34;&gt;ç›‘æ§å’Œè®°å½•ç½‘ç»œç­–ç•¥æ´»åŠ¨&lt;/h3&gt;
&lt;p&gt;ç›‘æ§å’Œè®°å½•ç½‘ç»œç­–ç•¥æ´»åŠ¨æ˜¯æ£€æµ‹å’Œè°ƒæŸ¥å®‰å…¨äº‹ä»¶ã€æ’é™¤ç½‘ç»œé—®é¢˜å¹¶è¯†åˆ«ä¼˜åŒ–æœºä¼šçš„å…³é”®ï¼Œç›‘æ§å¯ä»¥ç¡®ä¿ç½‘ç»œç­–ç•¥è¢«æ­£ç¡®æ‰§è¡Œï¼Œæ²¡æœ‰æ¼æ´æˆ–é…ç½®ä¸å½“ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ Kubernetes å·¥å…·å¦‚ &lt;code&gt;kubectl logs&lt;/code&gt; å’Œ &lt;code&gt;kubectl describe&lt;/code&gt;ï¼Œä½ å¯ä»¥æŸ¥çœ‹ç½‘ç»œç­–ç•¥çš„æ—¥å¿—å’ŒçŠ¶æ€ä¿¡æ¯ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹ç›‘æ§å’Œæ—¥å¿—è§£å†³æ–¹æ¡ˆæ¥è·å¾—æ›´å¤šçš„ç½‘ç»œæµé‡å’Œç­–ç•¥æ‰§è¡Œçš„å¯è§æ€§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åœ¨å¤§å‹é›†ç¾¤ä¸­æ‰©å±•ç½‘ç»œç­–ç•¥&#34;&gt;åœ¨å¤§å‹é›†ç¾¤ä¸­æ‰©å±•ç½‘ç»œç­–ç•¥&lt;/h3&gt;
&lt;p&gt;å½“ä½ çš„é›†ç¾¤å¼€å§‹å¢é•¿ï¼Œç‰¹åˆ«æ˜¯å½“ä½ åœ¨é›†ç¾¤ä¸­æ‹¥æœ‰å¤šä¸ªåº”ç”¨ç¨‹åºæ—¶ï¼Œé›†ç¾¤ä¸­çš„ Pod æ•°é‡å’Œç½‘ç»œç­–ç•¥æ•°é‡å°†æ˜¾ç€å¢åŠ ã€‚è®¾è®¡ä½ çš„ç½‘ç»œç­–ç•¥ï¼Œä½¿å®ƒä»¬å¯ä»¥éšç€é›†ç¾¤çš„å¢é•¿ã€å·¥ä½œè´Ÿè½½å’ŒèŠ‚ç‚¹æ•°é‡çš„å¢åŠ è€Œæ‰©å±•ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨é€‰æ‹©æ€§ Pod æ ‡ç­¾å’Œ Pod åŒ¹é…è§„åˆ™ã€é¿å…è¿‡åº¦é™åˆ¶ç­–ç•¥ä»¥åŠä½¿ç”¨é«˜æ•ˆçš„ç½‘ç»œç­–ç•¥å®ç°æ¥å®ç°å¯æ‰©å±•æ€§ã€‚ä¸è¦å¿˜è®°å®šæœŸå®¡æŸ¥å’Œä¼˜åŒ–ä½ çš„ç½‘ç»œç­–ç•¥ï¼Œä»¥ç¡®ä¿å®ƒä»¬ä»ç„¶æ˜¯å¿…è¦å’Œæœ‰æ•ˆçš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¯„ä¼°ç¬¬ä¸‰æ–¹ç½‘ç»œç­–ç•¥è§£å†³æ–¹æ¡ˆ&#34;&gt;è¯„ä¼°ç¬¬ä¸‰æ–¹ç½‘ç»œç­–ç•¥è§£å†³æ–¹æ¡ˆ&lt;/h3&gt;
&lt;p&gt;è™½ç„¶ Kubernetes åŒ…å«äº†å¯¹ç½‘ç»œç­–ç•¥çš„å†…ç½®æ”¯æŒï¼Œä½†ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æä¾›é¢å¤–åŠŸèƒ½çš„ç¬¬ä¸‰æ–¹è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;å¯¹å®ƒä»¬è¿›è¡Œè¯„ä¼°æ—¶ï¼Œåº”è€ƒè™‘ä»¥ä¸‹å› ç´ ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éƒ¨ç½²çš„æ˜“ç”¨æ€§&lt;/li&gt;
&lt;li&gt;ä¸ä½ ç°æœ‰çš„ç½‘ç»œåŸºç¡€è®¾æ–½çš„å…¼å®¹æ€§&lt;/li&gt;
&lt;li&gt;æ€§èƒ½å’Œå¯æ‰©å±•æ€§&lt;/li&gt;
&lt;li&gt;æ˜“ç”¨æ€§å’Œç»´æŠ¤æ€§&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“ç„¶ï¼Œç¡®ä¿ä½ ä½¿ç”¨çš„ä»»ä½•ç¬¬ä¸‰æ–¹è§£å†³æ–¹æ¡ˆéƒ½éµå®ˆ Kubernetes API æ ‡å‡†ï¼Œå¹¶ä¸”ä¸ä½ çš„ Kubernetes é›†ç¾¤ç‰ˆæœ¬å…¼å®¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h2&gt;
&lt;p&gt;æ˜¾ç„¶ï¼ŒKubernetes ç½‘ç»œç­–ç•¥æ˜¯ä¸€ç§å¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºåœ¨é›†ç¾¤ä¸­çš„å·¥ä½œè´Ÿè½½ä¹‹é—´å®‰å…¨åœ°æ§åˆ¶ç½‘ç»œæµé‡ã€‚å®ƒä»¬å…è®¸ä½ åœ¨ç»†ç²’åº¦çº§åˆ«ä¸Šå®šä¹‰å’Œæ‰§è¡Œç½‘ç»œå®‰å…¨ç­–ç•¥ï¼Œç¡®ä¿é€‚å½“çš„éš”ç¦»å¹¶é™ä½æœªç»æˆæƒçš„è®¿é—®æˆ–æ•°æ®æ³„éœ²çš„é£é™©ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨ä½ å·²ç»å­¦ä¼šäº† Kubernetes ç½‘ç»œç­–ç•¥çš„åŸºç¡€çŸ¥è¯†ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code&gt;kubectl&lt;/code&gt; å‘½ä»¤åˆ›å»ºå’Œæ‰§è¡Œç­–ç•¥ï¼Œé˜»æ­¢å¯¹ç‰¹å®š IP èŒƒå›´çš„å‡ºç«™æµé‡ä»¥åŠé™åˆ¶ä¸åŒåç§°ç©ºé—´ä¸­çš„ Pod ä¹‹é—´çš„æµé‡ã€‚ä½ è¿˜å­¦ä¼šäº†ä¸€äº›å®æ–½ç½‘ç»œç­–ç•¥çš„æœ€ä½³å®è·µï¼Œä¾‹å¦‚ç›‘è§†å’Œè®°å½•ç­–ç•¥æ´»åŠ¨ä»¥åŠè¯„ä¼°ç¬¬ä¸‰æ–¹ç½‘ç»œç­–ç•¥è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…¶ä»–èµ„æº&#34;&gt;å…¶ä»–èµ„æº&lt;/h2&gt;
&lt;p&gt;å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äº Kubernetes ç½‘ç»œå’Œç½‘ç»œç­–ç•¥çš„ä¿¡æ¯ï¼ŒKubernetes çš„å®˜æ–¹æ–‡æ¡£å½“ç„¶æ˜¯ä¸€ä¸ªä¸é”™çš„èµ·ç‚¹ã€‚å…¶ä»–æœ‰ç”¨çš„èµ„æºåŒ…æ‹¬ Kubernetes ç¤¾åŒºè®ºå›ã€åšå®¢å’Œåœ¨çº¿è¯¾ç¨‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/network-policies/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes ç½‘ç»œç­–ç•¥&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/cluster-administration/networking/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes ç½‘ç»œæ¦‚å¿µ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#networkpolicy-v1-networking-k8s-io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NetworkPolicy API å‚è€ƒ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯·è®°ä½ï¼Œå°½ç®¡ Kubernetes ç½‘ç»œç­–ç•¥æ˜¯ä¸€ç§å¼ºå¤§çš„å·¥å…·ï¼Œä½†å®ƒä»¬éœ€è¦ä»”ç»†è§„åˆ’æ‰èƒ½å‘æŒ¥ä½œç”¨ã€‚éµå¾ªæœ€ä½³å®è·µå¹¶åˆ©ç”¨æ­£ç¡®çš„èµ„æºï¼Œä½ å¯ä»¥ç¡®ä¿ä½ çš„ç½‘ç»œç­–ç•¥ä¸º Kubernetes é›†ç¾¤æä¾›å¼ºå¤§çš„å®‰å…¨æ€§å’Œæ§åˆ¶ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Argo Workflow ä»‹ç»ï¼šä¸€æ¬¾å¼ºå¤§çš„äº‘åŸç”ŸæŒç»­é›†æˆå·¥å…·</title>
      <link>https://cloudnativecn.com/blog/cloudnative-ci-argo-workflow/</link>
      <pubDate>Tue, 30 May 2023 00:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/cloudnative-ci-argo-workflow/</guid>
      <description>&lt;h2 id=&#34;argo-workflow-æ˜¯ä»€ä¹ˆ&#34;&gt;Argo workflow æ˜¯ä»€ä¹ˆ&lt;/h2&gt;
&lt;p&gt;è€ç‰Œçš„ CICD å·¥å…· Jenkins åº”è¯¥æ˜¯å¤§éƒ¨åˆ†éƒ½æ¥è§¦è¿‡çš„ï¼Œè€Œåœ¨äº‘åŸç”Ÿæ—¶ä»£ï¼Œè¯ç”Ÿäº†ä¸¤å¤§ CI/CD æ¡†æ¶ï¼Œä¹Ÿå°±æ˜¯ Argo Workflow å’Œ Tektonï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»ä¸€ä¸‹ Argo Workflowã€‚&lt;/p&gt;
&lt;p&gt;Argo Workflow æ˜¯ä¸€ä¸ªäº‘åŸç”Ÿçš„å·¥ä½œæµå¼•æ“ï¼ŒåŸºäº kubernetes æ¥åšç¼–æ’ä»»åŠ¡ï¼Œç›®å‰ Argo é¡¹ç›®æ˜¯ CNCF çš„æ¯•ä¸šé¡¹ç›®ã€‚&lt;/p&gt;
&lt;p&gt;åªæœ‰å½“éœ€è¦æ‰§è¡Œå¯¹åº”çš„ step æ—¶æ‰ä¼šåˆ›å»ºå‡ºå¯¹åº”çš„ podï¼Œå› æ­¤å’Œ Tekton ä¸€æ ·ï¼Œå¯¹èµ„æºçš„ç”³è¯·å’Œé‡Šæ”¾å…·æœ‰å¾ˆå¥½çš„åˆ©ç”¨æ€§ã€‚&lt;/p&gt;
&lt;p&gt;åŸºäº Argo Workflow å¯ä»¥å®Œæˆä¸€äº›æ¯”è¾ƒå¤æ‚çš„å·¥ä½œæµï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªæ¥è‡ªæŸä¸ª issue çš„å›¾ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-argo-workflow&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Argo Workflow&#34; srcset=&#34;
               /blog/cloudnative-ci-argo-workflow/complex_workflow_hu8241187474111883558.webp 400w,
               /blog/cloudnative-ci-argo-workflow/complex_workflow_hu8705867784683356982.webp 760w,
               /blog/cloudnative-ci-argo-workflow/complex_workflow_hu3889960068363891894.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/cloudnative-ci-argo-workflow/complex_workflow_hu8241187474111883558.webp&#34;
               width=&#34;760&#34;
               height=&#34;428&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Argo Workflow
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;æ¶æ„æ¦‚è§ˆ&#34;&gt;æ¶æ„æ¦‚è§ˆ&lt;/h3&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æ¶æ„å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æ¶æ„å›¾&#34; srcset=&#34;
               /blog/cloudnative-ci-argo-workflow/overview_hu11223233824470194622.webp 400w,
               /blog/cloudnative-ci-argo-workflow/overview_hu1160174711443186203.webp 760w,
               /blog/cloudnative-ci-argo-workflow/overview_hu9429431592532633004.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/cloudnative-ci-argo-workflow/overview_hu11223233824470194622.webp&#34;
               width=&#34;760&#34;
               height=&#34;581&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æ¶æ„å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ Argo Workflow ä¸­ï¼Œæ¯ä¸€ä¸ª step/dag task å°±æ˜¯ä¸€ä¸ª pod ä¸­çš„å®¹å™¨ï¼Œæœ€åŸºç¡€çš„ pod ä¼šæœ‰ 1 ä¸ª init å®¹å™¨å’Œä¸¤ä¸ªå·¥ä½œå®¹å™¨ï¼Œå…¶ä¸­ init å®¹å™¨å’Œä¸»å®¹å™¨éƒ½æ˜¯ argoproj/argoexec å®¹å™¨ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯ step ä¸­éœ€è¦ä½¿ç”¨çš„å®¹å™¨ï¼Œä¹Ÿå°±æ˜¯å®é™…æ‰§è¡Œå†…å®¹çš„å®¹å™¨ï¼Œåœ¨ pod  ä¸­å……å½“ sidecarã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;main å®¹å™¨ï¼Œä¹Ÿå°±æ˜¯ step/dag task ä¸­å®šä¹‰çš„å®¹å™¨ï¼Œç”¨äºæ‰§è¡Œå®é™…å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;init å®¹å™¨ï¼Œç”¨äºä¸º main å®¹å™¨å¤„ç† artifact ä»¥åŠå‚æ•°ç›¸å…³çš„é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;wait å®¹å™¨ï¼Œç­‰å¾… main å®¹å™¨æ‰§è¡Œå®Œæˆï¼Œä»¥åŠå¤„ç†ä¸€äº›æ¸…ç†ä»»åŠ¡ï¼Œä¾‹å¦‚ä¸Šä¼  artifact åˆ° S3ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;éœ€è¦ç†æ¸…çš„ä¸€ç‚¹æ˜¯è™½ç„¶ Argo Workflow å°†å·¥ä½œå®¹å™¨å®šä¹‰ä¸º&lt;code&gt;mainå®¹å™¨&lt;/code&gt;ï¼Œä½†å®é™…ä¸Š&lt;code&gt;waitå®¹å™¨&lt;/code&gt;æ˜¯ pod ä¸­çš„ä¸»å®¹å™¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸»è¦èµ„æº&#34;&gt;ä¸»è¦èµ„æº&lt;/h3&gt;
&lt;p&gt;åœ¨ Argo Workflow ä¸­ä¸»è¦çš„ CRD å¯¹è±¡æœ‰å‡ ä¸ªï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Workflow&lt;/li&gt;
&lt;li&gt;WorkflowTemplate&lt;/li&gt;
&lt;li&gt;CronWrokflow&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¥ä¸‹æ¥åˆ†åˆ«äº†è§£ä¸€ä¸‹ä¸‰ä¸ª CRD å¯¹è±¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;workflow&#34;&gt;Workflow&lt;/h3&gt;
&lt;p&gt;Workflow å®šä¹‰çš„å­—æ®µå’Œ workflowTemplate å®šä¹‰çš„å­—æ®µåŸºæœ¬ä¸Šæ˜¯ä¸€è‡´çš„ï¼Œå› æ­¤å°†å­—æ®µçš„è§£é‡Šæ”¾åœ¨ workflowTemplate éƒ¨åˆ†ï¼Œå¯¹ Workflow çš„ç†è§£åªéœ€è¦çŸ¥é“ Workflow æ˜¯ä¸€ä¸ªæµæ°´çº¿çš„&amp;quot;å®ä¾‹&amp;quot;ï¼Œä¹Ÿå°±æ˜¯åªæœ‰åˆ›å»ºäº† Workflow å¯¹è±¡æ˜¯æ‰ä¼šçœŸæ­£çš„è¿è¡Œæµæ°´çº¿ã€‚&lt;/p&gt;
&lt;h3 id=&#34;workflowtemplate&#34;&gt;WorkflowTemplate&lt;/h3&gt;
&lt;p&gt;WorkflowTemplate æ˜¯æœ€é‡è¦çš„å¯¹è±¡äº†ï¼ŒåŸºæœ¬ä¸Šç»å¤§éƒ¨åˆ†æ—¶é—´ä½ éƒ½æ˜¯å’Œå®ƒåœ¨æ‰“äº¤é“ï¼Œå…¶ä¸­è¿˜æœ‰ä¸€ä¸ª template çš„å®šä¹‰ï¼Œåœ¨åˆšè®¤è¯† Argo workflow æ—¶éœ€è¦æ³¨æ„åŒºåˆ†çš„ä¸€ç‚¹æ˜¯ workflowTemplate å’Œ templateï¼Œè¿™åœ¨æˆ‘åˆšå…¥é—¨æ—¶ä¹Ÿé€ æˆäº†ä¸€ç‚¹å›°æƒ‘ï¼Œæ¥ä¸‹æ¥è®²ä¸€ä¸‹è¿™ä¸¤ä¸ªçš„åŒºåˆ«ï¼š&lt;/p&gt;
&lt;p&gt;workflowTemplate æ˜¯ argo workflow ä¸­å®ç°çš„ CRD å¯¹è±¡ï¼Œè€Œ template åˆ™æ˜¯å¯¹è±¡å†…çš„ä¸€ä¸ªå­—æ®µï¼Œå®é™…æ‰§è¡Œå†…å®¹éƒ½æ˜¯åœ¨ template ä¸­å®šä¹‰çš„ï¼Œä¸€ä¸ª workflowTemplate è‡³å°‘è¦åŒ…å«ä¸€ä¸ª templateã€‚workflowTemplate éœ€è¦å°†ä¸€ä¸ª template é…ç½®ä¸º entrypointï¼Œä¹Ÿå°±æ˜¯æµæ°´çº¿çš„èµ·ç‚¹ï¼Œåœ¨è¿™ä¸ª template çš„ steps ä¸­åˆå¯ä»¥åº”ç”¨å¤šä¸ªç›¸åŒæˆ–ä¸åŒçš„ templateã€‚&lt;/p&gt;
&lt;p&gt;ç®€å•ä¸¾ä¸€ä¸ªä¾‹å­æ¥ç†è§£ workflowTemplate å¤šä¸ª templateï¼Œå‡è®¾è¦å°è£…ä¸€ä¸ª workflowTemplate æ¥å¤„ç† git ç›¸å…³çš„åœºæ™¯ï¼š&lt;/p&gt;
&lt;p&gt;åˆ†åˆ«ä¸ºä»¥ä¸‹ä¸‰ä¸ªæ“ä½œåˆ›å»ºä¸‰ä¸ª templateï¼Œå‡è®¾éœ€è¦åœ¨åŒä¸€ä»½ä»£ç ä¸­å¤šæ¬¡ merge &amp;amp;&amp;amp; commitï¼Œé‚£ä¹ˆæµæ°´çº¿å…¥å£æ˜¯ git cloneï¼Œç„¶å git mergeï¼Œgit add &amp;amp;&amp;amp; git commitï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ template2 å’Œ template3 æ˜¯ä½œä¸º template1 çš„ä¸€éƒ¨åˆ†å­˜åœ¨çš„ã€‚è€Œå½“æµæ°´çº¿å…¥å£ç›´æ¥å°±æ˜¯ git merge æˆ– git add &amp;amp;&amp;amp; git commit çš„æƒ…å†µæ—¶ï¼Œtemplate2 æˆ– template3 æ˜¯ä½œä¸ºå•ç‹¬çš„æµæ°´çº¿é€»è¾‘å­˜åœ¨ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;git clone&lt;/li&gt;
&lt;li&gt;git merge&lt;/li&gt;
&lt;li&gt;git add &amp;amp;&amp;amp; git commit&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å› æ­¤ template å¯ä»¥å•ç‹¬ä½œä¸ºæµæ°´çº¿å…¥å£æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥è¢«å…¶ä»–çš„ template å¼•ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆåˆ—å‡ºå‡ ä¸ªå…³é”®è¯åšä¸€ä¸ªç®€å•çš„æ¦‚è¿°æ¥æ›´å¥½çš„äº†è§£ Template:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;stepsï¼Œæµæ°´çº¿æ¯ä¸€æ­¥çš„æ‰§è¡Œå†…å®¹ï¼Œ&lt;code&gt;--&lt;/code&gt;è¡¨ç¤ºä¸åŒçº§åˆ«çš„ step å¹¶è¡Œæ‰§è¡Œï¼Œ&lt;code&gt;-&lt;/code&gt;è¡¨ç¤ºä¸åŒçº§åˆ«çš„ step é¡ºåºæ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;containerï¼ŒçœŸæ­£æ‰§è¡Œå†…å®¹çš„å®šä¹‰ï¼Œä¸ kubernetes container spec å®šä¹‰ä¸€è‡´ã€‚&lt;/li&gt;
&lt;li&gt;scriptï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäº container çš„ç±»å‹ï¼Œå¯ä»¥è®©ç”¨æˆ·ç›´æ¥åœ¨ CI ä¸­ç›´æ¥æ‰§è¡Œä¸€äº›è„šæœ¬å¹¶ä¸”å¾—åˆ°è¿”å›çš„ç»“æœï¼Œä¾‹å¦‚æ‰§è¡Œ python ä»£ç ï¼Œæ‰§è¡Œ node ä»£ç ä»¥åŠæ‰§è¡Œ shell ç­‰ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;resourceï¼Œè¿™ä¸ªç±»å‹å¯ä»¥æ”¯æŒåœ¨ CI ä¸­å¯¹ Kubernetes çš„å¯¹è±¡è¿›è¡Œæ“ä½œï¼Œä¾‹å¦‚åˆ›å»ºä¸€ä¸ª configMapï¼Œç„¶åæ ¹æ®è¿™ä¸ª Kubernetes èµ„æºå¯¹è±¡çš„çŠ¶æ€æ¥åˆ¤æ–­è¯¥æ­¥éª¤æ˜¯å¦æˆåŠŸã€‚ï¼ˆè¿™ä¸ªåŠŸèƒ½å¤ªé…·äº†ï¼ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸Šå‡ ä¸ªç‚¹æ˜¯ç†è§£ template æœ€ä¸»è¦çš„å†…å®¹ï¼Œä¸€ä¸ªç®€å•ç¤ºæ„çš„ yaml æ ¼å¼å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;entrypoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;hello-hello-hello&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#é…ç½® template å…¥å£&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;templates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;hello-hello-hello&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;steps&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- - &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;hello1            &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;whalesay&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;arguments&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;parameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;hello1&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- - &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;hello2a   &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;whalesay&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;arguments&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;parameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;hello2a&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#hello2a ä¸ hello1 æ˜¯é¡ºåºæ‰§è¡Œ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;hello2b         &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#hello2a ä¸ hello2b æ˜¯å¹¶è¡Œæ‰§è¡Œ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;whalesay&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;arguments&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;parameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;hello2b&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;whalesay &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# å®šä¹‰ä¸€ä¸ªç”¨äºçœŸæ­£æ‰§è¡Œå†…å®¹çš„ template&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;inputs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;parameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;container&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;docker/whalesay&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cowsay]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{{inputs.parameters.message}}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬åœ¨æ‰§è¡Œä»£ç æµ‹è¯•çš„è¿‡ç¨‹ä¸­ç»å¸¸ä¼šæœ‰ä¸€äº›ä¾èµ–æœåŠ¡è¦æ€ä¹ˆåœ¨ Argo Workflow ä¸­å®ç°å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Argo Workflow ä¸º step æä¾›äº† sidecars å‚æ•°ï¼Œå¯ä»¥é…ç½®ä½ éœ€è¦çš„ä¾èµ–å®¹å™¨ï¼Œä¾‹å¦‚ DIDï¼Œetcdï¼ŒRedis å’Œ Mysql ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ yaml ç¤ºä¾‹ï¼Œä¸º CI æ·»åŠ ä¸€ä¸ª redis ä¾èµ–æœåŠ¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;container&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;busybox:1.36.1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;shï¼Œ -c]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;echo hello&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;sidecars&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;redis&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;redis:7.0.11&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„æ˜¯ å¹¶è¡Œç‰ˆæœ¬/å‚æ•°æµ‹è¯•ï¼Œä¾‹å¦‚è·‘æµ‹è¯•æ—¶å¸Œæœ›è®©åŒä¸€ä»½ä»£ç åŸºäºå¤šä¸ªç‰ˆæœ¬çš„ Etcd æœåŠ¡åšæµ‹è¯•ï¼Œé‚£ä¹ˆ Argo workflow ä¹Ÿæä¾›äº† withItems çš„æ–¹å¼æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰ä¸€ä¸ªå¸¸è§çš„éœ€æ±‚æ˜¯ç¼–è¯‘ç¼“å­˜ï¼Œä¾‹å¦‚ java åº”ç”¨ç¼–è¯‘äº§ç‰©å¸Œæœ›åœ¨ä¸‹ä¸€ä¸ª CI ä¸­ç»§ç»­åº”ç”¨ï¼Œé¿å…æ¯æ¬¡éƒ½å»ä¸‹è½½ä¸€äº›é‡å¤çš„ jarï¼ŒArgo workflow é€šè¿‡ volume åŠŸèƒ½æ¥å®ç°è¿™éƒ¨åˆ†å†…å®¹ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ artifact åŠŸèƒ½å®ç°ï¼Œä¾‹å¦‚ä¸Šä¼ åˆ° S3ï¼Œéœ€è¦æ—¶å†è¿›è¡Œä¸‹è½½ã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ®æ–‡ä»¶å”¯ä¸€æ€§æ¥ç¡®è®¤ç¼–è¯‘ç¼“å­˜æ˜¯å¦æ›´æ”¹ï¼Œå¯¹äºå¹¶è¡Œæµ‹è¯•æ¥è¯´ç¼–è¯‘ç¼“å­˜å¯èƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¾‹å¦‚åªæ›´æ–°äº†ä»£ç è€Œæ²¡æœ‰æ›´æ–° pom.xml é‚£ä¹ˆç¼“å­˜ä¾èµ–æ˜¯ä¸€æ ·çš„ã€‚å¯¹äº pom.xml æ›´æ”¹äº†ï¼Œä¹Ÿå°±æ˜¯ç¼–è¯‘ç¼“å­˜å˜æ›´äº†ï¼Œé‚£ä¹ˆå¯ä»¥éœ€è¦å…ˆæ›´æ–°ç¼–è¯‘ç¼“å­˜ï¼Œç„¶åå†è·‘å¹¶è¡Œæµ‹è¯•ï¼Œå½“ç„¶è¿™æ˜¯å…·ä½“çš„ä¸šåŠ¡å†…å®¹äº†ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ä»å®˜æ–¹ä¸€ä¸ªé»˜è®¤çš„ workflowTemplate æ¥çœ‹ä¸€ä¸‹å®é™…çš„ yaml æ˜¯æ€ä¹ˆæ ·çš„ã€‚&lt;/p&gt;
&lt;h4 id=&#34;ä¸€ä¸ªé»˜è®¤çš„ç®€å•-workflowtemplate&#34;&gt;ä¸€ä¸ªé»˜è®¤çš„ç®€å• workflowTemplate&lt;/h4&gt;
&lt;p&gt;å½“åˆ›å»º workflowTemplate æ—¶ä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„ workflowTemplateï¼Œæ¥çœ‹ä¸€ä¸‹è¿™ä¸ª workflowTemplate åšäº†ä»€ä¹ˆäº‹æƒ…ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;lovely-dragon&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;true&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workflowMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;true&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;entrypoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;argosay&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;arguments&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;parameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;hello argo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;templates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;argosay&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;inputs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;parameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{{workflow.parameters.message}}&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;container&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;argoproj/argosay:v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;/argosay&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;echo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;s1&#34;&gt;&amp;#39;{{inputs.parameters.message}}&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ttlStrategy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secondsAfterCompletion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;300&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;podGC&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;strategy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;OnPodCompletion&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é»˜è®¤åˆ›å»ºçš„ workflowTemplate åªæœ‰ä¸€ä¸ª template å¹¶ä¸”å®ƒåšçš„å”¯ä¸€ä¸€ä»¶äº‹æƒ…å°±æ˜¯æ‰“å°ä¼ å‚ &lt;code&gt;message&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ é»˜è®¤çš„ workflow ä¸­è®¾ç½®äº† podGC å’Œ workflow çš„ TTLï¼Œä¸€æ—¦ pod æ‰§è¡Œå®Œæˆäº†å°±ä¼šåˆ é™¤ podï¼Œå¹¶ä¸”ç”±äºé»˜è®¤æ²¡æœ‰é…ç½®æ—¥å¿—æŒä¹…åŒ–ï¼Œè¿™æ—¶å€™å»æŸ¥çœ‹æ—¥å¿—çš„è¯åªä¼šçœ‹åˆ°ç©ºç™½ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æ–¹ä¾¿ç ”ç©¶æµ‹è¯•ï¼Œå¯ä»¥å…ˆå°†è¿™éƒ¨åˆ†å†…å®¹ç»™æ³¨é‡Šæ‰ï¼Œæˆ–ä¸º Argo Workflow è®¾ç½®æ—¥å¿—æŒä¹…åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šå®é™…ç”Ÿäº§åº”ç”¨æ—¶è¯·æ­£ç¡®è®¾ç½®æ—¥å¿—æŒä¹…åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢çš„é…ç½®è¡¨ç¤º workflow ä¼šåœ¨ workflow æ‰§è¡Œå®Œæˆåçš„ 300 ç§’åˆ é™¤ï¼Œè€Œ workflow è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ pod ä¼šåœ¨ pod æ‰§è¡Œå®Œæˆåç«‹åˆ»åˆ é™¤ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ttlStrategy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secondsAfterCompletion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;300&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;podGC&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;strategy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;OnPodCompletion&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;dag-æœ‰å‘æ— ç¯å›¾&#34;&gt;DAG æœ‰å‘æ— ç¯å›¾&lt;/h4&gt;
&lt;p&gt;åœ¨ Tekton ä¸­ï¼ŒDAG çš„è¡¨ç¤ºå¯ä»¥ç›´æ¥ç†è§£ä¸º Pipelineã€‚åœ¨æ•´ä¸ªæµæ°´çº¿çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä¸²è¡Œæˆ–å¹¶è¡Œåœ°æ‰§è¡Œ Tekton Task å¹¶ä¸”ä»»åŠ¡èµ·ç‚¹ä¸ç»ˆç‚¹ä¸ä¼šå½¢æˆä¸€ä¸ªé—­ç¯ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº† steps template ä¹‹å¤–ï¼ŒArgo WorkflowTemplate åŒæ ·æ”¯æŒ DAGï¼Œä»¥ dag template çš„æ–¹å¼å­˜åœ¨ï¼Œå¯ä»¥è®©ç”¨æˆ·æ›´å¥½çš„ç»´æŠ¤å¤æ‚çš„å·¥ä½œæµã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡ŒåŸºäºä¸€ä¸ªå®˜æ–¹æ–‡æ¡£çš„ç¤ºä¾‹æ¥ç®€å•äº†è§£ä¸€ä¸‹ Argo workflow dag templateï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;argoproj.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Workflow&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;generateName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dag-diamond-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;entrypoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;diamond&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;templates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;echo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;inputs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;parameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;container&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;alpine:3.7&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;echoï¼Œ &amp;#34;{{inputs.parameters.message}}&amp;#34;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;diamond&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;dag&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tasks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;echo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;arguments&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;parameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;{&lt;span class=&#34;nt&#34;&gt;name: messageï¼Œ value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;A}]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;dependencies&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;A]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;echo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;arguments&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;parameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;{&lt;span class=&#34;nt&#34;&gt;name: messageï¼Œ value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;B}]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;dependencies&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;A]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;echo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;arguments&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;parameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;{&lt;span class=&#34;nt&#34;&gt;name: messageï¼Œ value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;C}]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;D&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;dependencies&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Bï¼Œ C]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;echo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;arguments&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;parameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;{&lt;span class=&#34;nt&#34;&gt;name: messageï¼Œ value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;D}]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°å·¥ä½œæµçš„å…¥å£ template ä¸º diamondï¼Œç”±äºåªæœ‰ä»»åŠ¡ A æ²¡æœ‰é¡ºåºä¾èµ–ï¼Œå› æ­¤ä¸€å¼€å§‹åªä¼šæ‰§è¡Œä»»åŠ¡ Aï¼Œä»»åŠ¡ A æˆåŠŸæ‰§è¡Œåå¼€å§‹åŒæ—¶æ‰§è¡Œä»»åŠ¡ B å’Œä»»åŠ¡ Cï¼Œæœ€ç»ˆä»»åŠ¡ B å’Œä»»åŠ¡ C éƒ½é¡ºåˆ©æ‰§è¡Œå®Œåå¼€å§‹æ‰§è¡Œä»»åŠ¡ Dã€‚å¯ä»¥çœ‹åˆ° dependencies æ˜¯ä¸€ä¸ªæ•°ç»„ä¼ å‚ï¼Œå› æ­¤ä¹Ÿå¯ä»¥å°†ä¸Šè¿°ç¤ºä¾‹ä¿®æ”¹ä¸ºä»»åŠ¡ D åªéœ€è¦ç­‰å¾…ä»»åŠ¡ C é¡ºåˆ©æ‰§è¡Œåå°±å¼€å§‹æ‰§è¡Œã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ”¯æŒ-kubernetes-èµ„æºæ“ä½œ&#34;&gt;æ”¯æŒ Kubernetes èµ„æºæ“ä½œ&lt;/h4&gt;
&lt;p&gt;åœ¨å‰é¢å·²ç»çŸ¥é“æœ‰ä¸€ä¸ª resource ç±»å‹çš„ templateï¼Œè¿™åœ¨æˆ‘çœ‹æ¥æ˜¯å¾ˆé…·çš„åŠŸèƒ½ï¼æ¥ä¸‹æ¥çœ‹ä¸€ä¸ªå®˜æ–¹ä¾‹å­ï¼šç­‰å¾… workflow æ‰§è¡Œå®Œæˆã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;argoproj.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Workflow&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;generateName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Kubernetes-wait-wf-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;entrypoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Kubernetes-wait-wf&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;templates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Kubernetes-wait-wf&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;steps&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- - &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;create-wf&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;create-wf&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- - &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;wait-wf&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;wait-wf&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;arguments&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;parameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;wf-name&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{{steps.create-wf.outputs.parameters.wf-name}}&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;create-wf&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;create&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;manifest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        apiVersion: argoproj.io/v1alpha1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        kind: Workflow
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          generateName: sleep-
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          entrypoint: sleep
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          templates:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          - name: sleep
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;            container:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;              image: alpine:latest
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;              command: [sleepï¼Œ &amp;#34;20&amp;#34;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;outputs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;parameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;wf-name&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;valueFrom&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;jsonPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{.metadata.name}&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;wait-wf&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;inputs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;parameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;wf-name&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;successCondition&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;status.phase == Succeeded&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;failureCondition&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;status.phase in (Failed, Error)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;manifest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        apiVersion: argoproj.io/v1alpha1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        kind: Workflow
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;        metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;          name: {{inputs.parameters.wf-name}}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼ŒArgo Workflow åŸç”Ÿæ”¯æŒç›´æ¥åœ¨æµæ°´çº¿ä¸­åˆ›å»º Kubernetes å¯¹è±¡ï¼Œå¹¶ä¸”æ ¹æ®å¯¹è±¡çš„å­—æ®µæ¥æ§åˆ¶æµæ°´çº¿çš„æ‰§è¡Œã€‚ä¸Šè¿°çš„ç¤ºä¾‹æ•ˆæœæ˜¯åœ¨ step1 ä¸­åˆ›å»ºä¸€ä¸ª workflowï¼Œç„¶ååœ¨ step2 ä¸­ç­‰å¾…åˆ›å»ºçš„ workflow æ‰§è¡Œå®Œæˆï¼Œæˆ–è€…è¯´ç­‰å¾…è¿™ä¸ª workflow å¯¹è±¡å˜æ›´æˆé¢„æœŸçš„ success æˆ– failure å¯¹åº”çš„çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªåœ¨ resource æ“ä½œåœ¨æµæ°´çº¿éœ€è¦å¤„ç†ä¸€äº› Kubernetes èµ„æºæ—¶ä¼šæ˜¯ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h4 id=&#34;è¿˜æœ‰ä»€ä¹ˆ&#34;&gt;è¿˜æœ‰ä»€ä¹ˆ&lt;/h4&gt;
&lt;p&gt;ä¸€ä¸ªæ›´å®Œå–„çš„æµæ°´çº¿å¯èƒ½è¿˜ä¼šåŒ…å«å¾ˆå¤šå¤æ‚çš„å†…å®¹ï¼Œè¿™é‡Œç•™ä¸‹ä¸€äº›å‚è€ƒç‚¹ä¸ºç ”ç©¶ Argo workflow æ—¶æä¾›ä¸€äº›æ–¹å‘ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CI çŸ©é˜µ&lt;/li&gt;
&lt;li&gt;ä¸º CI é…ç½®ç¯å¢ƒå˜é‡&lt;/li&gt;
&lt;li&gt;ä¸º CI é…ç½®å¤šä¸ªä¾èµ–æœåŠ¡ï¼ˆsidecarï¼‰&lt;/li&gt;
&lt;li&gt;è®¾ç½®/ä½¿ç”¨ç‰¹åˆ« bucketName s3 artifact&lt;/li&gt;
&lt;li&gt;å·¥ä»¶å­˜å‚¨ artifact&lt;/li&gt;
&lt;li&gt;volume ä¼ é€’ç¼–è¯‘ç¼“å­˜&lt;/li&gt;
&lt;li&gt;æ¡ä»¶åˆ¤æ–­ stepï¼Œå½“æŸäº›æ¡ä»¶æˆç«‹æ—¶æ‰æ‰§è¡Œå¯¹åº”çš„ step&lt;/li&gt;
&lt;li&gt;workflow å’Œ step å¹¶è¡Œåº¦é™åˆ¶&lt;/li&gt;
&lt;li&gt;resource ç±»å‹ templateï¼Œç›´æ¥ç¼–å†™ python ä»£ç &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸Šéƒ½æ˜¯ Argo Workflow æœ¬èº«å°±æä¾›çš„åŠŸèƒ½ï¼Œä¸éœ€è¦è‡ªå·±å†åšä¸€äº›å°è£…ï¼Œå› æ­¤è¶³ä»¥çœ‹åˆ° Argo Workflow æä¾›çš„åŠŸèƒ½çš„å®ç”¨æ€§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;cronworkflow&#34;&gt;CronWorkflow&lt;/h3&gt;
&lt;p&gt;CronWorkflow æ˜¯ä¸€ä¸ªç”¨äºå®šæ—¶è§¦å‘ workflow çš„å®šä¹‰ï¼Œåœ¨ CI ä¸­ä¹Ÿæ˜¯å¾ˆå¸¸è§çš„ï¼Œä¾‹å¦‚æ¯æ™šæ„å»ºã€‚&lt;/p&gt;
&lt;p&gt;åŒæ ·åœ°ï¼Œé€šè¿‡ Argo çš„ UI ç•Œé¢åˆ›å»ºä¸€ä¸ªå®šæ—¶çš„ workflow æ—¶ä¹Ÿä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„ cronWorkflowï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªé»˜è®¤çš„ cronWorkflow æ¥äº†è§£ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sparkly-tiger&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;true&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workflowMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;true&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;schedule&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;* * * * *&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;workflowSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;entrypoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;argosay&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;arguments&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;parameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;hello argo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;templates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;argosay&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;inputs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;parameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{{workflow.parameters.message}}&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;container&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;argoproj/argosay:v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;/argosay&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;echo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;- &lt;span class=&#34;s1&#34;&gt;&amp;#39;{{inputs.parameters.message}}&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ttlStrategy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secondsAfterCompletion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;300&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;podGC&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;strategy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;OnPodCompletion&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»è¿‡å‰é¢ workflow å’Œ workflowTemplate çš„äº†è§£åï¼Œå¯ä»¥çœ‹åˆ° cronWorkflow çš„ yaml æ–‡ä»¶æ•´ä½“æ¥è¯´æ˜¯å·®ä¸å¤šçš„ï¼Œæ— éæ˜¯å¤šäº†ä¸€äº›å®šæ—¶ç›¸å…³çš„é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šè¿°ç¤ºä¾‹ä¸­ schedule é…ç½®ä¸º &lt;code&gt;* * * * *&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯æ¯åˆ†é’Ÿä¼šæ‰§è¡Œä¸€æ¬¡ workflowã€‚å…³äºå®šæ—¶çš„å†…å®¹éƒ½ä¼šæœ‰ä¸€ä¸ªæ³¨æ„ç‚¹æ˜¯å®šæ—¶ä»»åŠ¡çš„æ—¶åŒºï¼ŒcronWorkflow æ”¯æŒä¸ºå®šæ—¶ä»»åŠ¡è®¾ç½®æ—¶åŒºï¼Œå…·ä½“å¯ä»¥çœ‹çœ‹å®˜æ–¹çš„è¿™ä¸ª&lt;a href=&#34;https://github.com/argoproj/argo-workflows/blob/master/examples/cron-workflow.yaml&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cron workflow ç¤ºä¾‹&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸-tekton-çš„å¯¹æ¯”&#34;&gt;ä¸ Tekton çš„å¯¹æ¯”&lt;/h2&gt;
&lt;p&gt;ç»è¿‡ä¸€ç•ªæŠ˜è…¾åèƒ½å¤Ÿæ„Ÿå—åˆ°ä¸€äº›å¾ˆæ˜æ˜¾çš„åŒºåˆ«ï¼š&lt;/p&gt;
&lt;p&gt;ä»ç³»ç»Ÿæ¶æ„ä¸Šæ¥è¯´ï¼ŒTekton åšå¾—æ›´å¥½ï¼Œæ•´ä½“æ¶æ„æ¯”è¾ƒæ¸…æ™°ï¼Œä½†ä»ç”¨æˆ·åŠŸèƒ½çš„è§’åº¦ä¸Šæ¥è¯´ Argo Workflow æ›´å®¹æ˜“ä¸Šæ‰‹ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;Argo workflow çš„ UI èƒ½å¤Ÿå±•ç°å‡ºæ¯”è¾ƒç›´è§‚çš„ CI é¡ºåºæ•ˆæœï¼ŒåŒæ—¶ Argo WOrkflow ä¼šæœ‰å¾ˆå¤šå®ç”¨çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€ä¸ªæ˜¯ Argo workflow ä¸­æä¾›äº†ä¸€äº› Tekton é»˜è®¤æ‰€æ²¡æœ‰çš„åŠŸèƒ½ï¼Œåœ¨æˆ‘çœ‹æ¥è¿™äº›ä¹Ÿéƒ½æ˜¯æ¯”è¾ƒé…·å’Œå®ç”¨çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;resource ç±»å‹ templateï¼Œå¯ä»¥ç›´æ¥åˆ›å»º Kubernetes å¯¹è±¡ä»¥åŠ å¯¹ Kubernetes å¯¹è±¡ getï¼Œç­‰å¾… Kubernetes å¯¹è±¡æŸä¸ªå­—æ®µå˜æ›´ã€‚&lt;/li&gt;
&lt;li&gt;artifact åŠŸèƒ½ï¼Œä¾‹å¦‚å’Œ S3 æ‰“äº¤é“ï¼Œè¿™åœ¨æµæ°´çº¿ä¸­æ˜¯å¾ˆå¸¸è§çš„éœ€æ±‚ï¼Œä½† Tekton æœ¬èº«å¹¶æ²¡æœ‰æä¾›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Argo workflow çš„æ–‡æ¡£å»ºè®¾ä¹Ÿæ¯” Tekton æ›´å¥½ã€‚&lt;/p&gt;
&lt;p&gt;æ€»çš„æ¥è¯´ Tekton æä¾›çš„å†…å®¹å¤„äºæ›´åº•å±‚çš„ä½ç½®ï¼Œä¸ kubernetes ç±»ä¼¼ï¼Œæ˜¯ä¸€ä¸ª CI/CD åº•å±‚çš„å¼•æ“ï¼ŒçœŸæ­£ç”¨å¥½å®ƒéœ€è¦åŸºäºå®ƒåšä¸€äº›äº‹æƒ…ã€‚è€Œ Argo Workflow å¤„äºæ›´ä¸Šå±‚ä¸€ç‚¹çš„ä½ç½®ï¼Œæä¾›äº†å¾ˆå¤šå®ç”¨çš„åŠŸèƒ½ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„åº”ç”¨èµ·æ¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å†™åœ¨æœ€å&#34;&gt;å†™åœ¨æœ€å&lt;/h2&gt;
&lt;p&gt;åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬äº†è§£äº† Argo Workflow çš„å¼ºå¤§ç‰¹æ€§ä»¥åŠä¸ Tekton çš„ä¸€ä¸ªç®€å•å¯¹æ¯”ï¼Œå®é™…åœ¨ä¼ä¸šå†…åº”è¯¥é€‰æ‹© Argo Workflow è¿˜æ˜¯ Tekton è¿˜æ˜¯éœ€è¦æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹ä»¥åŠå®é™…éªŒè¯ä¸€äº›æµ‹è¯•åæ‰èƒ½å†³å®šã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šåªæ˜¯èŠåˆ°äº† Argo Workflow çš„ä¸€éƒ¨åˆ†åŠŸèƒ½ï¼Œå¦‚æœæƒ³äº†è§£æ›´å¤šçš„åŠŸèƒ½å¯ä»¥å…ˆä»å®˜æ–¹ç¤ºä¾‹å¼€å§‹ï¼Œå®˜æ–¹ä»£ç ä»“åº“ç»™äº†å¾ˆå¤šçš„&lt;a href=&#34;https://github.com/argoproj/argo-workflows/tree/master/examples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¤ºä¾‹ yaml&lt;/a&gt;ï¼Œå› æ­¤å¯ä»¥é€šè¿‡è¿™äº›ç¤ºä¾‹ yaml å¾ˆå¿«çš„äº†è§£åˆ°ç›¸å…³çš„åŠŸèƒ½ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes Gateway API æ·±å…¥è§£è¯»å’Œè½åœ°æŒ‡å—</title>
      <link>https://cloudnativecn.com/blog/kubernetes-gateway-api-explained/</link>
      <pubDate>Fri, 05 May 2023 15:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/kubernetes-gateway-api-explained/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä»‹ç»äº† Kubernetes ç½‘å…³ APIï¼Œè¯¥ API æ—¨åœ¨æä¾›ä¸€ç§åœ¨ Kubernetes ä¸­ç®¡ç†ç½‘å…³å’Œè´Ÿè½½å‡è¡¡å™¨çš„æ ‡å‡†æ–¹æ³•ã€‚æ–‡ç« è§£é‡Šäº† Kubernetes ç½‘å…³ API çš„æ ¸å¿ƒç»„ä»¶å’Œæ¦‚å¿µï¼Œå¹¶ä¸”è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ç½‘å…³ API æ¥é…ç½®å’Œç®¡ç†ç½‘å…³å’Œè´Ÿè½½å‡è¡¡å™¨ã€‚æ–‡ç« è¿˜ä»‹ç»äº†ä¸€äº›å¸¸è§çš„ç½‘å…³å®ç°ï¼Œä¾‹å¦‚ Istio å’Œ Contourï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬ä¸ Kubernetes ç½‘å…³ API è¿›è¡Œé›†æˆã€‚æœ€åï¼Œæ–‡ç« è¿˜è®¨è®ºäº† Kubernetes ç½‘å…³ API çš„æœªæ¥å‘å±•æ–¹å‘ã€‚&lt;/p&gt;
&lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;Kubernetes Gateway API æ˜¯ Kubernetes 1.18 ç‰ˆæœ¬å¼•å…¥çš„ä¸€ç§æ–°çš„ API è§„èŒƒï¼Œæ˜¯ Kubernetes å®˜æ–¹æ­£åœ¨å¼€å‘çš„æ–°çš„ APIï¼ŒIngress æ˜¯ Kubernetes å·²æœ‰çš„ APIã€‚Gateway API ä¼šæˆä¸º Ingress çš„ä¸‹ä¸€ä»£æ›¿ä»£æ–¹æ¡ˆã€‚Gateway API æä¾›æ›´ä¸°å¯Œçš„åŠŸèƒ½ï¼Œæ”¯æŒ TCPã€UDPã€TLS ç­‰ï¼Œä¸ä»…ä»…æ˜¯ HTTPã€‚Ingress ä¸»è¦é¢å‘ HTTP æµé‡ã€‚Gateway API å…·æœ‰æ›´å¼ºçš„æ‰©å±•æ€§ï¼Œé€šè¿‡ CRD å¯ä»¥è½»æ˜“æ–°å¢ç‰¹å®šçš„ Gateway ç±»å‹ï¼Œæ¯”å¦‚ AWS Gateway ç­‰ã€‚Ingress çš„æ‰©å±•ç›¸å¯¹è¾ƒéš¾ã€‚Gateway API æ”¯æŒæ›´ç»†ç²’åº¦çš„æµé‡è·¯ç”±è§„åˆ™ï¼Œå¯ä»¥ç²¾ç¡®åˆ°æœåŠ¡çº§åˆ«ã€‚Ingress çš„æœ€å°è·¯ç”±å•å…ƒæ˜¯è·¯å¾„ã€‚&lt;/p&gt;
&lt;p&gt;Gateway API çš„æ„ä¹‰å’Œä»·å€¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä½œä¸º Kubernetes å®˜æ–¹é¡¹ç›®ï¼ŒGateway API èƒ½å¤Ÿæ›´å¥½åœ°ä¸ Kubernetes æœ¬èº«é›†æˆï¼Œæœ‰æ›´å¼ºçš„å¯é æ€§å’Œç¨³å®šæ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ”¯æŒæ›´ä¸°å¯Œçš„æµé‡åè®®ï¼Œé€‚ç”¨äºæœåŠ¡ç½‘æ ¼ç­‰æ›´å¤æ‚çš„åœºæ™¯ï¼Œä¸ä»…é™äº HTTPã€‚å¯ä»¥ä½œä¸º Kubernetes çš„æµé‡å…¥å£ API è¿›è¡Œç»Ÿä¸€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…·æœ‰æ›´å¥½çš„æ‰©å±•æ€§ï¼Œé€šè¿‡ CRD å¯ä»¥è½»æ¾åœ°æ”¯æŒå„ç§ Gateway çš„è‡ªå®šä¹‰ç±»å‹ï¼Œæ›´çµæ´»ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯ä»¥å®ç°ç»†ç²’åº¦çš„æµé‡æ§åˆ¶ï¼Œç²¾ç¡®åˆ°æœåŠ¡çº§åˆ«çš„è·¯ç”±ï¼Œæä¾›æ›´å¼ºå¤§çš„æµé‡ç®¡ç†èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç»¼ä¸Šï¼ŒGateway API ä½œä¸ºæ–°ä¸€ä»£çš„ Kubernetes å…¥å£ APIï¼Œæœ‰æ›´å¹¿æ³›çš„åº”ç”¨åœºæ™¯ã€æ›´å¼ºå¤§çš„åŠŸèƒ½ã€ä»¥åŠæ›´å¥½çš„å¯é æ€§å’Œæ‰©å±•æ€§ã€‚å¯¹äºç”Ÿäº§çº§çš„ Kubernetes ç¯å¢ƒï¼ŒGateway API æ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ã€‚æœ¬ç¯‡æ–‡ç« å°†æ·±å…¥è§£è¯» Kubernetes Gateway API çš„æ¦‚å¿µã€ç‰¹æ€§å’Œç”¨æ³•ï¼Œå¸®åŠ©è¯»è€…æ·±å…¥ç†è§£å¹¶å®é™…åº”ç”¨ Kubernetes Gateway APIï¼Œå‘æŒ¥å…¶åœ¨ Kubernetes ç½‘ç»œæµé‡ç®¡ç†ä¸­çš„ä¼˜åŠ¿ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‘å±•ç°çŠ¶&#34;&gt;å‘å±•ç°çŠ¶&lt;/h2&gt;
&lt;h3 id=&#34;ç‰ˆæœ¬ç°çŠ¶&#34;&gt;ç‰ˆæœ¬ç°çŠ¶&lt;/h3&gt;
&lt;p&gt;Gateway API ç›®å‰è¿˜å¤„äºå¼€å‘é˜¶æ®µï¼Œå°šæœªå‘å¸ƒæ­£å¼ç‰ˆæœ¬ã€‚å…¶ç‰ˆæœ¬å‘å±•ç°çŠ¶å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;v1beta1: å½“å‰çš„ä¸»è¦è¿­ä»£ç‰ˆæœ¬ï¼ŒGateway API  è¿›å…¥äº† beta ç‰ˆæœ¬ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨ Gateway API èƒ½åŠ›äº†ï¼Œç›®å‰ beta ç‰ˆæœ¬ä»…æ”¯æŒ HTTP åè®®ï¼ŒTCP åè®®ã€UDP åè®®ã€gRPC åè®®ã€TLS åè®®å‡ä¸º alpha ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;v1.0: é¦–ä¸ªæ­£å¼ GA ç‰ˆæœ¬ï¼ŒAPI ç¨³å®šï¼Œå¯ä»¥ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚ä½†åŠŸèƒ½è¿˜ä¼šæŒç»­å®Œå–„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å¯ç”¨åœºæ™¯&#34;&gt;å¯ç”¨åœºæ™¯&lt;/h3&gt;
&lt;p&gt;ä¸‹é¢ç®€å•æ•´ç†äº†ä¸€ä¸‹ HTTPRoute çš„ä¸€äº›å¯ç”¨åœºæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¤šç‰ˆæœ¬éƒ¨ç½²ï¼šå¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºæœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ HTTPRoute æ¥å°†æµé‡è·¯ç”±åˆ°ä¸åŒçš„ç‰ˆæœ¬ï¼Œä»¥ä¾¿æµ‹è¯•å’Œé€æ­¥å‡çº§ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°†ä¸€éƒ¨åˆ†æµé‡è·¯ç”±åˆ°æ–°ç‰ˆæœ¬è¿›è¡Œæµ‹è¯•ï¼ŒåŒæ—¶ä¿æŒæ—§ç‰ˆæœ¬çš„è¿è¡Œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A/B æµ‹è¯•ï¼šHTTPRoute å¯ä»¥é€šè¿‡æƒé‡åˆ†é…æ¥å®ç° A/B æµ‹è¯•ã€‚æ‚¨å¯ä»¥å°†æµé‡è·¯ç”±åˆ°ä¸åŒçš„åç«¯æœåŠ¡ï¼Œå¹¶ä¸ºæ¯ä¸ªæœåŠ¡æŒ‡å®šä¸€ä¸ªæƒé‡ï¼Œä»¥ä¾¿æµ‹è¯•ä¸åŒç‰ˆæœ¬çš„åŠŸèƒ½å’Œæ€§èƒ½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŠ¨æ€è·¯ç”±ï¼šHTTPRoute æ”¯æŒåŸºäºè·¯å¾„ã€è¯·æ±‚å¤´ã€è¯·æ±‚å‚æ•°å’Œè¯·æ±‚ä½“ç­‰æ¡ä»¶çš„åŠ¨æ€è·¯ç”±ã€‚è¿™ä½¿å¾—æ‚¨å¯ä»¥æ ¹æ®è¯·æ±‚çš„ä¸åŒå±æ€§å°†æµé‡è·¯ç”±åˆ°ä¸åŒçš„åç«¯æœåŠ¡ï¼Œä»¥æ»¡è¶³ä¸åŒçš„éœ€æ±‚ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é‡å®šå‘ï¼šHTTPRoute æ”¯æŒé‡å®šå‘ï¼Œæ‚¨å¯ä»¥å°†æŸäº›è¯·æ±‚é‡å®šå‘åˆ°å¦ä¸€ä¸ª URL ä¸Šï¼Œä¾‹å¦‚å°†æ—§çš„ URL é‡å®šå‘åˆ°æ–°çš„ URLã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å‘¨è¾¹ç”Ÿæ€&#34;&gt;å‘¨è¾¹ç”Ÿæ€&lt;/h3&gt;
&lt;p&gt;ç›®å‰ï¼Œå°½ç®¡ Gateway API è¿˜å¤„äºå¼€å‘é˜¶æ®µï¼Œä½†å·²ç»æœ‰éƒ¨åˆ†é¡¹ç›®è¡¨ç¤ºæ”¯æŒæˆ–è®¡åˆ’æ”¯æŒ Gateway APIã€‚ä¸»è¦åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Istio æ˜¯æœ€æµè¡Œçš„æœåŠ¡ç½‘æ ¼é¡¹ç›®ä¹‹ä¸€ï¼ŒIstio 1.9 ç‰ˆæœ¬è®¡åˆ’å¼•å…¥å®éªŒæ€§çš„ Gateway API æ”¯æŒã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡ Gateway å’Œ HTTPRoute èµ„æºæ¥é…ç½® Istio çš„ Envoy ä»£ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Linkerd æ˜¯å¦ä¸€ä¸ªæµè¡Œçš„æœåŠ¡ç½‘æ ¼é¡¹ç›®ï¼ŒLinkerd 2.10 ç‰ˆæœ¬æ·»åŠ äº† Gateway API æ”¯æŒã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨ Gateway API èµ„æºæ¥é…ç½® Linkerd çš„ä»£ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Contour æ˜¯ä¸€ä¸ª Kubernetes Ingress Controllerï¼ŒContour 1.14.0 ç‰ˆæœ¬æ·»åŠ  Gateway API æ”¯æŒï¼Œå¯ä»¥ä½¿ç”¨ Gateway å’Œ HTTPRoute æ¥é…ç½® Contourã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Flagger æ˜¯ä¸€æ¬¾ Kubernetes çš„è“ç»¿éƒ¨ç½²å’Œ A/B æµ‹è¯•å·¥å…·ï¼ŒFlagger 0.25 ç‰ˆæœ¬æ·»åŠ äº†å¯¹ Gateway API çš„æ”¯æŒï¼Œå¯ä»¥ä½¿ç”¨ Gateway å’Œ HTTPRoute æ„å»º Flagger çš„æµé‡è·¯ç”±ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;HAProxy Ingress Controller æ”¯æŒ Gateway APIï¼Œå¯ä»¥ä½¿ç”¨ Gateway å’Œ HTTPRoute æ„å»º HAProxy çš„é…ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Traefik æ˜¯è‘—åçš„å¼€æºè¾¹ç¼˜è·¯ç”±å™¨ï¼ŒTraefik 2.5 ç‰ˆæœ¬å¼€å§‹æ”¯æŒ Gateway API å¹¶é€æ­¥æ·˜æ±° Ingress æ”¯æŒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é™¤æ­¤ä¹‹å¤–ï¼ŒApisixã€Envoy gatewayã€Higress ç­‰å¼€æºé¡¹ç›®ä¹Ÿæ”¯æŒæˆ–æ‰“ç®—æ”¯æŒ Gateway APIï¼Œå„å¤§äº‘æœåŠ¡å•†éƒ½åœ¨ç§¯æè·Ÿè¿› Gateway API è¿›å±•ï¼Œé¢„è®¡æœªæ¥ä¼šåœ¨ç›¸åº”çš„æœåŠ¡ä¸­æä¾› Gateway API æ”¯æŒã€‚å¯ä»¥çœ‹å‡ºï¼Œå°½ç®¡ Gateway API è¿˜ä¸ç®—æˆç†Ÿå’Œç¨³å®šï¼Œä½†ç”±äºå…¶å¼ºå¤§çš„åŠŸèƒ½å’Œä½œä¸º Kubernetes å®˜æ–¹é¡¹ç›®çš„å½±å“åŠ›ï¼Œå·²ç»è·å¾—å¤§é‡é¡¹ç›®çš„æ”¯æŒå’Œå…¼å®¹ã€‚æœåŠ¡ç½‘æ ¼ã€API ç½‘å…³ä»¥åŠå„å¤§äº‘æœåŠ¡å•†éƒ½å°†æ˜¯ Gateway API çš„é‡ç‚¹ç”Ÿæ€ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æœªæ¥è§„åˆ’&#34;&gt;æœªæ¥è§„åˆ’&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å®Œå–„åŠŸèƒ½å’Œç¨³å®šæ€§ï¼šç»§ç»­å®Œå–„ Gateway API çš„åŠŸèƒ½å’Œç¨³å®šæ€§ï¼Œä»¥ç¡®ä¿å…¶èƒ½å¤Ÿåº”å¯¹ä¸åŒåœºæ™¯çš„éœ€æ±‚ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç®¡ç†è§„æ¨¡ï¼šé’ˆå¯¹å¤§è§„æ¨¡ Kubernetes é›†ç¾¤çš„éœ€æ±‚ï¼Œä¼˜åŒ– Gateway API çš„æ€§èƒ½å’Œæ‰©å±•æ€§ï¼Œä½¿å…¶èƒ½å¤Ÿç®¡ç†æ›´å¤šçš„ç½‘å…³å’Œè·¯ç”±è§„åˆ™ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¢å¼ºå®‰å…¨æ€§ï¼šåŠ å¼º Gateway API çš„å®‰å…¨æ€§ï¼ŒåŒ…æ‹¬åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„åŠ å¯†ã€èº«ä»½éªŒè¯ç­‰æ–¹é¢ï¼Œä»¥ç¡®ä¿ç½‘ç»œæµé‡çš„å®‰å…¨æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®Œå–„æ–‡æ¡£å’Œç¤¾åŒºæ”¯æŒï¼šå®Œå–„ Gateway API çš„æ–‡æ¡£å’Œç¤¾åŒºæ”¯æŒï¼Œä»¥å¸®åŠ©ç”¨æˆ·æ›´å¥½åœ°ä½¿ç”¨å’Œäº†è§£è¯¥é¡¹ç›®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;gateway-api-è§„èŒƒè§£è¯»&#34;&gt;Gateway API è§„èŒƒè§£è¯»&lt;/h2&gt;
&lt;h3 id=&#34;åŸºç¡€æ¦‚å¿µ&#34;&gt;åŸºç¡€æ¦‚å¿µ&lt;/h3&gt;
&lt;p&gt;Kubernetes Gateway API å®šä¹‰äº†ä¸‰ç§åŸºæœ¬èµ„æºç±»å‹ï¼šGatewayClassã€Gatewayã€Routeã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Gatewayclass:&lt;/strong&gt; ä¸€ç»„å…±äº«é€šç”¨é…ç½®å’Œè¡Œä¸ºçš„ Gateway é›†åˆï¼Œä¸ IngressClassã€StorageClass ç±»ä¼¼ï¼Œéœ€è¦çŸ¥é“ Gateway API å¹¶ä¸ä¼šåˆ›å»ºçœŸæ­£çš„ç½‘å…³ï¼ŒçœŸæ­£çš„ç½‘å…³æ˜¯ç”±ä¸€äº›æ”¯æŒ Gateway API çš„ç¤¾åŒºï¼ˆåŸºç¡€è®¾å¤‡æä¾›å•†ï¼‰æ‰€æä¾›çš„ Controller æ‰€åˆ›å»ºï¼Œå¦‚ Envoyã€Istioã€Nginxã€‚GatewayClassï¼ŒGatewayclass çš„ä½œç”¨å°±æ˜¯ç»‘å®šä¸€ä¸ª Controller å®šä¹‰ä¸€ç§ç½‘å…³ç±»å‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Gateway:&lt;/strong&gt; å¯ä»¥è¯´æˆ GatewayClass çš„å…·ä½“å®ç°ï¼Œå£°æ˜åç”± GatewayClass çš„åŸºç¡€è®¾å¤‡æä¾›å•†æä¾›ä¸€ä¸ªå…·ä½“å­˜åœ¨çš„ Podï¼Œå……å½“äº†è¿›å…¥ Kubernetes é›†ç¾¤çš„æµé‡çš„å…¥å£ï¼Œè´Ÿè´£æµé‡æ¥å…¥ä»¥åŠå¾€åè½¬å‘ï¼ŒåŒæ—¶è¿˜å¯ä»¥èµ·åˆ°ä¸€ä¸ªåˆæ­¥è¿‡æ»¤çš„æ•ˆæœã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Route:&lt;/strong&gt; çœŸå®çš„è·¯ç”±ï¼Œå®šä¹‰äº†ç‰¹å®šåè®®çš„è§„åˆ™ï¼Œç”¨äºå°†è¯·æ±‚ä» Gateway æ˜ å°„åˆ° Kubernetes æœåŠ¡ã€‚ç›®å‰åªæœ‰ HTTPRoute è¿›å…¥äº† v1beta ç‰ˆæœ¬ï¼Œæ˜¯æ¯”è¾ƒç¨³å®šçš„ç‰ˆæœ¬ï¼Œåç»­  TCPRouteã€UDPRouteã€GRPCRouteã€TLSRoute ç­‰ä¹Ÿä¼šé™†ç»­è¿›å…¥ beta ç‰ˆæœ¬è¾¾åˆ°ç”Ÿäº§å¯ç”¨ï¼Œè¿™é‡Œå°†åªå¯¹ HTTPRoute è¿›è¡Œä»‹ç»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…³äºä»–ä»¬ä¸‰è€…ä¹‹é—´çš„å…³ç³»ï¼Œå®˜æ–¹æ–‡æ¡£ä¹Ÿç»™äº†ä¸€å¹…éå¸¸æ¸…æ™°çš„ç»“æ„å›¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œå›¾ç‰‡ä¸»è¦å¼ºè°ƒäº†é¢å‘è§’è‰²çš„ç‰¹ç‚¹ï¼Œå®˜æ–¹æƒ³è¡¨è¾¾æ„æ€æ˜¯ GatewayClass ç”±åŸºç¡€è®¾æ–½ä¾›åº”å•†æä¾›ï¼ŒGateway èµ„æºç”±é›†ç¾¤å·¥ç¨‹å¸ˆåˆ›å»ºï¼ŒåŸºæœ¬ç¯å¢ƒæ­å»ºå®Œæˆåï¼Œå¼€å‘è€…ä¾¿å¯ä»¥è½»æ¾åˆ›å»º HTTPRoute å°†è‡ªå·±çš„ä¸šåŠ¡ä»£ç†å‡ºæ¥ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://static.goodrain.com/wechat/gateway-api-indepth/1.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;å·¥ä½œåŸç†&#34;&gt;å·¥ä½œåŸç†&lt;/h3&gt;
&lt;h4 id=&#34;ç»“æ„å›¾&#34;&gt;ç»“æ„å›¾&lt;/h4&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://static.goodrain.com/wechat/gateway-api-indepth/2.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h4 id=&#34;gatewayclass&#34;&gt;GatewayClass&lt;/h4&gt;
&lt;p&gt;é€šè¿‡éƒ¨ç½² GatewayClass ç»‘å®šä¸‹æ¸¸å®ç°æä¾›çš„ Controllerï¼Œä¸ºé›†ç¾¤æä¾›ä¸€ç§ç½‘å…³èƒ½åŠ›ï¼Œè¿™é‡Œå¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§æ³¨å†Œå£°æ˜å§ï¼Œå°†ä½ çš„ä¸‹æ¸¸å®ç°æ³¨å†Œåˆ°é›†ç¾¤ä¸­ä¾› Gateway ç»‘å®šä½¿ç”¨ã€‚Controller å¯ä»¥çœ‹ä½œç›‘å¬ Gateway èµ„æºçš„ Operatorã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  controllerName: gateway.envoyproxy.io/gatewayclass-controller &lt;span class=&#34;c1&#34;&gt;#ç»‘å®šçš„ Controller åç§°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;gateway&#34;&gt;Gateway&lt;/h4&gt;
&lt;p&gt;Gateway èµ„æºæ˜¯ä¸€ä¸ªä¸­é—´å±‚ï¼Œéœ€è¦å®šä¹‰æ‰€è¦ç›‘å¬çš„ç«¯å£ã€åè®®ã€TLS é…ç½®ç­‰ä¿¡æ¯ï¼Œå¯ä»¥å°†ç½‘ç»œæµé‡çš„ç®¡ç†å’Œæ§åˆ¶é›†ä¸­åˆ°ä¸€ä¸ªä¸­å¿ƒåŒ–çš„ä½ç½®ï¼Œæé«˜é›†ç¾¤çš„å¯ç”¨æ€§å’Œå®‰å…¨æ€§ã€‚é…ç½®å®Œæˆåï¼Œç”± GatewayClass ç»‘å®šçš„ Controller ä¸ºæˆ‘ä»¬æä¾›ä¸€ä¸ªå…·ä½“å­˜åœ¨ Pod ä½œä¸ºæµé‡å…¥å£ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå„å®¶å®ç°åœ¨æ­¤å¤„è¿˜æ˜¯ç•¥æœ‰ä¸åŒï¼Œæ¯”å¦‚è¯´ Envoy å½“ä½ åˆ›å»º Gateway èµ„æºåï¼ŒEnvoy Controller ä¼šåˆ›å»ºä¸€ä¸ª Deployment èµ„æºä¸ºä½ æä¾›å…¥å£æµé‡ Podï¼Œç„¶è€Œ Nginx åˆ™æ˜¯è‡ªå·±æœ¬èº«å°±æ˜¯æµé‡å…¥å£ Pod ä¸ä¼šåˆ›å»ºæ–°çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-YAML&#34; data-lang=&#34;YAML&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;gatewayClassName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#ç»‘å®šçš„ GatewayClass åç§°ã€‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listeners&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# å®šä¹‰äº†ä¸€äº›ç›‘å¬é¡¹ï¼Œä¾› Route è¿›è¡Œç»‘å®š&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;allowedRoutes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#å®šä¹‰æµé‡è½¬å‘èŒƒå›´&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespaces&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;All&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#å…è®¸ Gateway å¾€æ‰€æœ‰çš„ Namespace çš„ Pod è½¬å‘æµé‡ã€‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#ç›‘å¬é¡¹åç§°ã€‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8088&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#ç›‘å¬é¡¹æ‰€å ç”¨çš„ç«¯å£&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;hostnameï¼š www.gateway.*.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#å®šä¹‰ä¸€ä¸ªåŸŸåï¼Œä¸€èˆ¬ä¸ºæ³›åŸŸåã€åŒ¹é…æ¥è‡ªè¯¥åŸŸåçš„æµé‡ã€‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#å®šä¹‰åè®®ï¼ŒHTTPæˆ–è€…HTTPS &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;allowedRoutes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespaces&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;All&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTPS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#ä¸º HTTPS é…ç½®åŠ å¯†åè®®&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Terminate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#åŠ å¯†åè®®ç±»å‹ï¼ŒTerminate æˆ– Passthrough&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;certificateRefs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Secret&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cafe-secret&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;åè®®ç±»å‹ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Terminate&lt;/strong&gt;ï¼šå°†åŠ å¯†çš„æµé‡è§£å¯†å¹¶å°†æ˜æ–‡æµé‡è½¬å‘åˆ°åç«¯æœåŠ¡ã€‚è¿™ç§æ¨¡å¼éœ€è¦åœ¨ç½‘å…³å¤„é…ç½®è¯ä¹¦å’Œå¯†é’¥ï¼Œä»¥ä¾¿å¯¹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æµé‡è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ï¼Œç¡®ä¿æ•°æ®å®‰å…¨æ€§ã€‚&lt;/li&gt;
&lt;li&gt;**Passthroughï¼š**å°†åŠ å¯†çš„æµé‡åŸæ ·è½¬å‘åˆ°åç«¯æœåŠ¡ã€‚è¿™ç§æ¨¡å¼ä¸éœ€è¦åœ¨ç½‘å…³å¤„é…ç½®è¯ä¹¦å’Œå¯†é’¥ï¼Œå› ä¸º TLS è¿æ¥åªåœ¨åç«¯æœåŠ¡å¤„ç»ˆæ­¢ã€‚è¿™ç§æ¨¡å¼é€‚ç”¨äºéœ€è¦å°† TLS æµé‡ç›´æ¥ä¼ é€’åˆ°åç«¯æœåŠ¡çš„åœºæ™¯ï¼Œå¦‚éœ€è¦å¯¹åç«¯æœåŠ¡è¿›è¡Œæ›´ç»†ç²’åº¦çš„è®¿é—®æ§åˆ¶æˆ–æµé‡ç›‘æ§çš„æƒ…å†µã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;httproute&#34;&gt;HTTPRoute&lt;/h4&gt;
&lt;p&gt;HTTPRoute ä¾¿è·Ÿä½ çš„ä¸šåŠ¡å¯†åˆ‡ç›¸å…³äº†ï¼Œåœ¨è¿™é‡Œå®šä¹‰è¯¦ç»†çš„è§„åˆ™ï¼Œå°†æµé‡ä»£ç†åˆ°å¯¹åº”çš„ä¸šåŠ¡æœåŠ¡ä¸Šã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-YAML&#34; data-lang=&#34;YAML&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#HTTPRoute A&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;parentRefs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#ç»‘å®š Gateway ç›‘å¬é¡¹&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#Gateway èµ„æºåç§°&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#Gatewayæ‰€åœ¨å‘½åç©ºé—´&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;sectionName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#ç›‘å¬é¡¹åç§°&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hostnames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#ä¸ºè·¯ç”±é…ç½®åŸŸå&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;www.gateway.example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#å¯é…ç½®æ³›åŸŸå,å¯é…ç½®å¤šä¸ª&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#é…ç½®è¯¦ç»†çš„è·¯ç”±è§„åˆ™ï¼Œå¯é…ç½®å¤šä¸ªï¼Œä¸‹é¢æœ‰å¯¹å„ç§è§„åˆ™ç±»å‹çš„è¯¦ç»†è§£æ&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;matches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#åŒ¹é…æ¡ä»¶&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#è·¯å¾„åŒ¹é…&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;PathPrefix&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#è·¯å¾„ç±»å‹ï¼šExact å®Œå…¨åŒ¹é…/PathPrefix å‰ç¼€åŒ¹é…/RegularExpression æ­£åˆ™åŒ¹é…&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/gateway &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;filters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#é«˜çº§è®¾ç½®&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;requestHeaderModifier&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#åŠ å·¥è¯·æ±‚å¤´&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;requestHeaderModifier&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#æ”¯æŒ set è¦†ç›–/add æ·»åŠ /remove åˆ é™¤&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;goodrain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;RequestRedirect&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#è¯·æ±‚é‡å®šå‘&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;requestRedirect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;scheme&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# é‡å®šå‘æ‰€ä½¿ç”¨çš„åè®®ï¼Œhttp/https&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hostname&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;www.baidu.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#é‡å®šå‘çš„åŸŸå&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#é‡å®šå‘æ‰€ä½¿ç”¨çš„ç«¯å£&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;statusCode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;301&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#é‡å®šå‘çŠ¶æ€ç ï¼š301 æ°¸ä¹…çš„é‡å®šå‘/302 ä¸´æ—¶é‡å®šå‘&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;--------------&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#HTTPRoute B&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;parentRefs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;gateway &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;envoy &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;sectionName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hostnames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;www.gateway.example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;matches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#è¯·æ±‚å¤´åŒ¹é…&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;service &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;goodrain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;backendRefs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#åç«¯è·¯ç”±&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;goodrain-v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# service åç§°&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#service ç«¯å£&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#æƒé‡&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;goodrain-v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;è§„åˆ™ç±»å‹ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;matches:&lt;/strong&gt; ç”±ä¸€ä¸ªæˆ–å¤šä¸ªåŒ¹é…æ¡ä»¶ç»„æˆï¼Œè¿™äº›åŒ¹é…æ¡ä»¶å¯ä»¥åŸºäº HTTP è¯·æ±‚çš„å„ç§å±æ€§ï¼ˆå¦‚è¯·æ±‚æ–¹æ³•ã€è·¯å¾„ã€å¤´éƒ¨ã€æŸ¥è¯¢å‚æ•°ç­‰ï¼‰è¿›è¡ŒåŒ¹é…ï¼Œä»è€Œç¡®å®šå“ªäº›è¯·æ±‚åº”è¯¥è¢«è·¯ç”±åˆ°è¯¥è§„åˆ™å¯¹åº”çš„åç«¯æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;filters:&lt;/strong&gt; å¯¹ä¼ å…¥è¯·æ±‚è¿›è¡Œæ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œä¾‹å¦‚ä¿®æ”¹è¯·æ±‚çš„å¤´éƒ¨ã€è½¬å‘è¯·æ±‚åˆ°å…¶ä»–æœåŠ¡ã€å°†è¯·æ±‚é‡å®šå‘åˆ°ä¸åŒçš„ URL ç­‰ã€‚å®ƒä»¬ç”±ä¸€ç»„è§„åˆ™ç»„æˆï¼Œæ¯ä¸ªè§„åˆ™éƒ½åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨ã€‚è¿™äº›è¿‡æ»¤å™¨å¯ä»¥åœ¨è¯·æ±‚è¢«è·¯ç”±åˆ°åç«¯æœåŠ¡ä¹‹å‰æˆ–ä¹‹åè¿›è¡Œå¤„ç†ï¼Œä»¥å®ç°å„ç§ä¸åŒçš„åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;backendRefs:&lt;/strong&gt; ç”¨æ¥æŒ‡å®šåç«¯æœåŠ¡çš„å¼•ç”¨ï¼Œå®ƒåŒ…å«ä¸€ä¸ªåç«¯æœåŠ¡çš„åˆ—è¡¨ï¼Œæ¯ä¸ªæœåŠ¡ç”±åç§°å’Œç«¯å£å·ç»„æˆï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œå°†è¯·æ±‚è·¯ç”±åˆ°åç«¯æœåŠ¡çš„å…¶ä¸­ä¸€ä¸ªå®ä¾‹ä¸­ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ·±å…¥äº†è§£ä»¥åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ HTTPRoute çš„ç”¨æ³•éå¸¸çš„çµæ´»ï¼Œå¯ä»¥é€šè¿‡å°†ä¸åŒçš„è§„åˆ™ç»„åˆæ­é…ï¼Œæ¥åˆ›å»ºä¸€æ¡é€‚åˆæˆ‘ä»¬ä¸šåŠ¡çš„è·¯ç”±ï¼Œå°±æ‹¿ä¸Šé¢çš„ yaml ä¸ºä¾‹ï¼Œæ•´ä½“æµé‡èµ°å‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“ http åè®®çš„è¯·æ±‚æµé‡è¿›å…¥åï¼ŒæŒ‰ç…§è§„åˆ™åŒ¹é…ï¼Œæµé‡ä¼šå‘ä¸‹è½¬å‘åˆ° HTTPRoute A çš„è·¯ç”±ä¸Šï¼ŒHTTPRoute A æŒ‰ç…§è§„åˆ™é¡ºåºï¼Œå…ˆå¯¹è¯·æ±‚è¿›è¡ŒåŠ å·¥å¤„ç†æ·»åŠ è¯·æ±‚å¤´ï¼Œä¹‹åå°†è¯·æ±‚é‡å®šå‘åˆ° HTTPRoute B ä¸Šï¼Œå†ç”± HTTPRoute å°†æµé‡æŒ‰ç…§æƒé‡æ¯”ä¾‹è·¯ç”±åˆ°å¯¹åº”çš„åç«¯æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè§„åˆ™é›†æœ‰ä¼˜å…ˆçº§ï¼Œå½“åŒæ—¶å­˜åœ¨å¤šä¸ªè§„åˆ™ï¼ˆruleï¼‰çš„æ—¶å€™ï¼Œæµé‡ä¼šä»ä¸Šå¾€ä¸‹è¿›è¡ŒåŒ¹é…ï¼Œåªè¦æœ‰åŒ¹é…ä¸Šæµé‡ä¼šç›´æ¥ä»£ç†åˆ°å…¶å¯¹åº”çš„åç«¯æˆ–é‡å®šå‘åˆ°å¯¹åº”çš„è·¯ç”±ã€‚&lt;/p&gt;
&lt;h2 id=&#34;gateway-api-å¿«é€Ÿä¸Šæ‰‹&#34;&gt;Gateway API å¿«é€Ÿä¸Šæ‰‹&lt;/h2&gt;
&lt;p&gt;æ•´ç†ä¸€ä¸‹éƒ¨ç½²æ€è·¯ï¼Œå¦‚æœåœ¨ä¸šåŠ¡ä¸­ä½¿ç”¨ Gateway API æˆ‘ä»¬éƒ½éœ€è¦åšä»€ä¹ˆã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Kubernetes Gateway API åŸºç¡€ CRDã€‚&lt;a href=&#34;https://gateway-api.sigs.k8s.io/guides/#installing-gateway-api&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰è£…ç½‘å…³ API CRD åœ°å€&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;Gateway API ä¸‹æ¸¸å®ç°ï¼Œå³åŸºç¡€è®¾å¤‡ä¾›åº”å•†ã€‚ï¼ˆåŒ…å« GatewayClass èµ„æºï¼‰&lt;a href=&#34;https://gateway-api.sigs.k8s.io/implementations/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸‹æ¸¸å®ç°åœ°å€&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;åˆ›å»º Gatewayï¼Œå®šä¹‰åŸºç¡€çš„è·¯ç”±æ–¹å¼ä¾› HTTPRoute é€‰æ‹©ã€‚æ ¹æ®ä¸Šé¢çš„å­—æ®µè§£é‡Šè‡ªè¡Œç¼–å†™ã€‚&lt;/li&gt;
&lt;li&gt;åˆ›å»º HTTPRoute è®¾ç½®è§„åˆ™ç»‘å®šè‡ªå·±çš„ä¸šåŠ¡ã€‚æ ¹æ®ä¸Šé¢çš„å­—æ®µè§£é‡Šè‡ªè¡Œç¼–å†™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢ä»¥ Envoy æä¾›çš„ demo ä¸ºä¾‹ï¼Œä¸²ä¸€ä¸‹æ•´ä½“æµç¨‹&lt;/p&gt;
&lt;h3 id=&#34;å®‰è£…-gateway-api-crd-å’Œ-envoy-controller&#34;&gt;å®‰è£… Gateway API CRD å’Œ Envoy Controller&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://github.com/envoyproxy/gateway/releases/download/v0.3.0/install.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æŸ¥çœ‹å®‰è£…æ•ˆæœ&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# æŸ¥çœ‹å®‰è£…çš„ CRD èµ„æº&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get crd &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;grep networking.k8s.io
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# æŸ¥çœ‹å®‰è£…çš„ envoy controller&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get pod -n envoy-gateway-system
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å®‰è£…-gatewayhttproute-åŠç¤ºä¾‹åº”ç”¨&#34;&gt;å®‰è£… Gatewayã€HTTPRoute åŠç¤ºä¾‹åº”ç”¨&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://github.com/envoyproxy/gateway/releases/download/v0.3.0/quickstart.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;å†…éƒ¨-gatewayclass-èµ„æº&#34;&gt;å†…éƒ¨ GatewayClass èµ„æº&lt;/h4&gt;
&lt;p&gt;èµ„æºçš„ controllerName å±æ€§å­—æ®µé…ç½®ç»‘å®šäº† envoy çš„ controller&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apiVersion: gateway.networking.k8s.io/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kind: GatewayClass
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name: eg
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  controllerName: gateway.envoyproxy.io/gatewayclass-controller
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;å†…éƒ¨-gateway-èµ„æº&#34;&gt;å†…éƒ¨ Gateway èµ„æº&lt;/h4&gt;
&lt;p&gt;èµ„æºçš„ gatewayClassName å±æ€§å­—æ®µé…ç½®ç»‘å®šäº† gatewayclass èµ„æºåç§° egï¼ŒåŒæ—¶æä¾›äº†ä¸€ä¸ª å¯¹å†…ç›‘å¬ç«¯å£ä¸º 80ï¼Œåè®®ç±»å‹ä¸º http çš„ç›‘å¬é¡¹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apiVersion: gateway.networking.k8s.io/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kind: Gateway
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name: eg
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  gatewayClassName: eg
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  listeners:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    - name: http
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      protocol: HTTP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      port: &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;å†…éƒ¨çš„-httproute-èµ„æº&#34;&gt;å†…éƒ¨çš„ HTTPRoute èµ„æº&lt;/h4&gt;
&lt;p&gt;èµ„æºçš„ parentRefs å±æ€§å­—æ®µé…ç½®ç»‘å®šäº† gateway èµ„æºåç§° egã€‚åŸŸåä¸º &lt;a href=&#34;https://www.example.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;www.example.com&lt;/a&gt;ï¼Œä»£ç†çš„åç«¯æœåŠ¡ç±»å‹é€‰æ‹©äº† serviceï¼Œåç§°ä¸º backendï¼ŒæœåŠ¡ç«¯å£ä¸º 3000ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-SQL&#34; data-lang=&#34;SQL&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gateway&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;networking&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;k8s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;io&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HTTPRoute&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;parentRefs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;eg&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hostnames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;www.example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;backendRefs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;matches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PathPrefix&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æŸ¥çœ‹å®‰è£…æ•ˆæœ&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# æŸ¥çœ‹å®‰è£…çš„ gatewayclass èµ„æº&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get gatewayclass
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# æŸ¥çœ‹å®‰è£…çš„ gateway èµ„æº&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get gateway
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# æŸ¥çœ‹å®‰è£…çš„ httproute èµ„æº&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get httproute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#æŸ¥çœ‹ç”± Controller æä¾›çš„æµé‡å…¥å£ Podã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get pod -n envoy-gateway-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#æŸ¥çœ‹è·¯ç”±è§£æåœ°å€,å…¶ä¸­ nodeport ç±»å‹çš„ svc ä¾¿æ˜¯ä½ çš„è§£æåœ°å€ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get svc -n envoy-gateway-system&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;grep LoadBalancer
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#è®¿é—®&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl --resolve www.example.com:31830:xx.xxx.xx.xxx --header &lt;span class=&#34;s2&#34;&gt;&amp;#34;Host: www.example.com&amp;#34;&lt;/span&gt;  http://www.example.com:31830/get                                           
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;gateway-api-ç”Ÿäº§æŒ‡å—&#34;&gt;Gateway API ç”Ÿäº§æŒ‡å—&lt;/h2&gt;
&lt;p&gt;Gateway API ä½¿ç”¨åˆ°ç”Ÿäº§éœ€è¦è€ƒè™‘æ˜“ç”¨æ€§ã€å¯ç®¡ç†æ€§å’Œç¨³å®šæ€§å› ç´ ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ˜“ç”¨æ€§&lt;/strong&gt;ï¼šGateway API æ‰©å±•äº†å¾ˆå¤šé…ç½®å†…å®¹ï¼Œå¦‚æœç›´æ¥å†™ yaml ä¸Šæ‰‹éš¾åº¦è¾ƒå¤§ï¼Œè€Œä¸”å®¹æ˜“å‡ºé”™ï¼Œæ‰€ä»¥éœ€è¦æœ‰ä¸€ä¸ªåŸºäº UI çš„ç®¡ç†å·¥å…·ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯ç®¡ç†æ€§&lt;/strong&gt;ï¼šGateway API æ”¯æŒåˆ†è§’è‰²ç®¡ç†å’Œä½¿ç”¨ï¼Œè·Ÿå¹³å°å·¥ç¨‹çš„æ€è·¯ä¸€è‡´ï¼Œä½†è¦ç”¨åˆ°ç”Ÿäº§éœ€è¦æœ‰ä¸€ä¸ªåˆ†æƒé™å’Œè§’è‰²çš„å¹³å°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¨³å®šæ€§&lt;/strong&gt;ï¼šGateway API å½“å‰çš„å®ç°ä¸­ï¼ŒEnvoy å’Œ Nginx å¯ä»¥ç”¨åˆ°ç”Ÿäº§ç¯å¢ƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åŸºäºä»¥ä¸Šå› ç´ ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒéœ€è¦ Gateway API çš„ç®¡ç†å·¥å…·ï¼Œå½“å‰ç›¸å¯¹æˆç†Ÿçš„å·¥å…·å¯ä»¥é€‰æ‹© Rainbondï¼Œå®ƒè¿è¡Œ Kubernetes åŸºç¡€ä¸Šï¼Œå®ƒä¹Ÿæ˜¯å¹³å°å·¥ç¨‹çš„è®¾è®¡æ€è·¯ï¼Œæä¾› web ç•Œé¢ç®¡ç† Kubernetes çš„èµ„æºï¼ŒåŒ…æ‹¬ Gateway APIï¼Œå¯¹ä½¿ç”¨è€…ä¸éœ€è¦å†™ Yaml æ–‡ä»¶ï¼Œèƒ½åŒºåˆ†ç®¡ç†å‘˜è§’è‰²å’Œæ™®é€šå¼€å‘è€…è§’è‰²ï¼Œç®¡ç†å‘˜å¯ä»¥é€šè¿‡ç®¡ç†ç•Œé¢å®‰è£…å…¼å®¹çš„ Gateway API çš„å®ç°ï¼Œæ¯”å¦‚ Envoy å’Œ Nginxï¼Œå®‰è£…å¥½çš„ç½‘å…³ï¼Œæ™®é€šå¼€å‘è€…åªéœ€è¦é…ç½®ä¸šåŠ¡çš„è·¯ç”±å°±å¯ä»¥ä½¿ç”¨ï¼Œä¸ç”¨å…³å¿ƒæ˜¯å“ªä¸€ç§å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å…·ä½“è½åœ°è¿‡ç¨‹ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;åœ¨-kubernetes-ä¸Šå®‰è£…-rainbond&#34;&gt;åœ¨ Kubernetes ä¸Šå®‰è£… Rainbond&lt;/h3&gt;
&lt;p&gt;å‚è€ƒå®‰è£…æ–‡æ¡£ï¼š &lt;a href=&#34;https://www.rainbond.com/docs/installation/install-with-helm/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŸºäº Kubernetes å®‰è£… Rainbond &lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;ç®¡ç†å‘˜å®‰è£…-gateway-api-çš„ç½‘å…³å®ç°&#34;&gt;ç®¡ç†å‘˜å®‰è£… Gateway API çš„ç½‘å…³å®ç°&lt;/h3&gt;
&lt;p&gt;é€šè¿‡ Rainbond æä¾›çš„åº”ç”¨å¸‚åœºï¼Œæœç´¢ GatewayAPI ä¼šå‡ºæ¥ä¸‰ä¸ªåº”ç”¨ï¼Œå…ˆå®‰è£… GatewayAPI-Baseï¼Œå†å®‰è£… GatewayAPI-Envoy æˆ– Gateway-Nginxï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¸¤ä¸ªéƒ½è£…ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://static.goodrain.com/wechat/gateway-api-indepth/3.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;ç®¡ç†å‘˜é…ç½®-gateway--api-çš„èµ„æº&#34;&gt;ç®¡ç†å‘˜é…ç½® Gateway  API çš„èµ„æº&lt;/h3&gt;
&lt;p&gt;åœ¨&lt;code&gt;å¹³å°ç®¡ç† / æ‰©å±• / èƒ½åŠ›&lt;/code&gt; ç‚¹å‡»å¯¹åº”èµ„æºçš„ç¼–è¾‘ï¼Œé…ç½® Gateway å’Œ GatewayClass èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://static.goodrain.com/wechat/gateway-api-indepth/4.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;å¼€å‘è€…é…ç½®ä¸šåŠ¡è·¯ç”±&#34;&gt;å¼€å‘è€…é…ç½®ä¸šåŠ¡è·¯ç”±&lt;/h3&gt;
&lt;p&gt;å¼€å‘è€…åœ¨è‡ªå·±å¼€å‘çš„åº”ç”¨ä¸­é…ç½®ç½‘å…³ï¼Œå¦‚æœåŒæ—¶å®‰è£…å¤šä¸ªç½‘å…³å®ç°ï¼Œå¯ä»¥å…ˆé€‰æ‹©ç½‘å…³ç±»å‹ï¼Œç„¶åé€šè¿‡ç•Œé¢é…ç½® HTTPRoute å­—æ®µã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://static.goodrain.com/wechat/gateway-api-indepth/5.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¡¥å……è¯´æ˜ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Rainbond å½“å‰ç‰ˆæœ¬åªæ”¯æŒ HTTPRouteï¼Œå…¶ä»–ç±»å‹çš„ Route æš‚æ—¶ä¸æ”¯æŒï¼›&lt;/li&gt;
&lt;li&gt;ä» Rainbond åº”ç”¨å¸‚åœºåªèƒ½å®‰è£… Envoy å’Œ Nginx ä¸¤ç§ç½‘å…³å®ç°ï¼Œè¦æ”¯æŒæ›´å¤šç½‘å…³å®ç°éœ€è¦ Rainbond å…ˆæ”¯æŒæˆ–è‡ªå·±åˆ¶ä½œæ’ä»¶ï¼›&lt;/li&gt;
&lt;li&gt;èµ„æ–™å‚è€ƒï¼š&lt;a href=&#34;https://www.rainbond.com/blog/gatewayapi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Rainbond çš„ Gateway API æ’ä»¶åˆ¶ä½œå®è·µ&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>å¦‚ä½•åœ¨ Kubernetes ä¸­å®ç°å¤šç§Ÿæˆ·éš”ç¦»ï¼šå‘½åç©ºé—´ã€RBAC å’Œç½‘ç»œç­–ç•¥çš„åº”ç”¨</title>
      <link>https://cloudnativecn.com/blog/multi-tenancy-in-kubernetes/</link>
      <pubDate>Wed, 12 Apr 2023 22:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/multi-tenancy-in-kubernetes/</guid>
      <description>&lt;p&gt;æ‚¨æ˜¯å¦åº”è¯¥è®©å¤šä¸ªå›¢é˜Ÿä½¿ç”¨åŒä¸€ä¸ª Kubernetes é›†ç¾¤ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æ‚¨æ˜¯å¦å¯ä»¥å®‰å…¨åœ°è¿è¡Œæ¥è‡ªä¸ä¿¡ä»»ç”¨æˆ·çš„ä¸ä¿¡ä»»å·¥ä½œè´Ÿè½½ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Kubernetes æ˜¯å¦å…·å¤‡å¤šç§Ÿæˆ·åŠŸèƒ½ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡å°†æ¢è®¨åœ¨è¿è¡Œå…·æœ‰å¤šä¸ªç§Ÿæˆ·çš„é›†ç¾¤æ—¶é¢ä¸´çš„æŒ‘æˆ˜ã€‚&lt;/p&gt;
&lt;p&gt;å¤šç§Ÿæˆ·å¯åˆ†ä¸ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è½¯å¤šç§Ÿæˆ·&lt;/strong&gt;ï¼Œé€‚ç”¨äºä¿¡ä»»æ‚¨çš„ç§Ÿæˆ· - æ¯”å¦‚ä¸åŒä¸€å®¶å…¬å¸çš„å›¢é˜Ÿå…±äº«é›†ç¾¤æ—¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¡¬å¤šç§Ÿæˆ·&lt;/strong&gt;ï¼Œé€‚ç”¨äºæ‚¨ä¸ä¿¡ä»»çš„ç§Ÿæˆ·ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ‚¨è¿˜å¯ä»¥æ··åˆä½¿ç”¨ï¼&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/multi-tenancy-in-kubernetes/1_hu46823315951738390.webp 400w,
               /blog/multi-tenancy-in-kubernetes/1_hu1916651277848988388.webp 760w,
               /blog/multi-tenancy-in-kubernetes/1_hu12218457800214974192.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/multi-tenancy-in-kubernetes/1_hu46823315951738390.webp&#34;
               width=&#34;760&#34;
               height=&#34;570&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åœ¨ç§Ÿæˆ·ä¹‹é—´å…±äº«é›†ç¾¤çš„åŸºæœ¬æ„å»ºå—æ˜¯å‘½åç©ºé—´ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å‘½åç©ºé—´åœ¨é€»è¾‘ä¸Šå¯¹èµ„æºè¿›è¡Œåˆ†ç»„ï¼Œå®ƒä»¬ä¸æä¾›ä»»ä½•å®‰å…¨æœºåˆ¶ï¼Œä¹Ÿä¸èƒ½ä¿è¯æ‰€æœ‰èµ„æºéƒ½éƒ¨ç½²åœ¨åŒä¸€èŠ‚ç‚¹ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/multi-tenancy-in-kubernetes/2_hu7204476384361083347.webp 400w,
               /blog/multi-tenancy-in-kubernetes/2_hu15950257320003112473.webp 760w,
               /blog/multi-tenancy-in-kubernetes/2_hu4951671648085674669.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/multi-tenancy-in-kubernetes/2_hu7204476384361083347.webp&#34;
               width=&#34;760&#34;
               height=&#34;570&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å‘½åç©ºé—´ä¸­çš„ Pod ä»ç„¶å¯ä»¥ä¸é›†ç¾¤ä¸­çš„æ‰€æœ‰å…¶ä»– Pod é€šä¿¡ï¼Œå‘ API å‘å‡ºè¯·æ±‚å¹¶ä½¿ç”¨å®ƒä»¬æƒ³è¦çš„ä»»ä½•èµ„æºã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥è®¿é—®ä»»ä½•å‘½åç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;é‚£åº”è¯¥æ€ä¹ˆé˜»æ­¢å®ƒï¼Ÿ&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/multi-tenancy-in-kubernetes/3_hu10453929336116540809.webp 400w,
               /blog/multi-tenancy-in-kubernetes/3_hu15482072640242115952.webp 760w,
               /blog/multi-tenancy-in-kubernetes/3_hu3600813020365239455.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/multi-tenancy-in-kubernetes/3_hu10453929336116540809.webp&#34;
               width=&#34;760&#34;
               height=&#34;570&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://learnk8s.io/rbac-kubernetes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€šè¿‡ RBACï¼Œæ‚¨å¯ä»¥é™åˆ¶ç”¨æˆ·å’Œåº”ç”¨ç¨‹åºå¯¹å‘½åç©ºé—´å†…å’Œå‘½åç©ºé—´ä¸­çš„å†…å®¹æ‰€èƒ½åšçš„äº‹æƒ…ã€‚&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¸¸è§çš„æ“ä½œæ˜¯æˆäºˆæœ‰é™ç”¨æˆ·æƒé™ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/multi-tenancy-in-kubernetes/4_hu18393607195714428149.webp 400w,
               /blog/multi-tenancy-in-kubernetes/4_hu1578366930084823489.webp 760w,
               /blog/multi-tenancy-in-kubernetes/4_hu11797881225436836802.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/multi-tenancy-in-kubernetes/4_hu18393607195714428149.webp&#34;
               width=&#34;760&#34;
               height=&#34;570&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/policy/resource-quotas/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ Quotas å’Œ LimitRangesï¼Œæ‚¨å¯ä»¥é™åˆ¶å‘½åç©ºé—´ä¸­éƒ¨ç½²çš„èµ„æºä»¥åŠå¯ä»¥ä½¿ç”¨çš„å†…å­˜ã€CPU ç­‰ã€‚&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¦‚æœæ‚¨æƒ³é™åˆ¶ç§Ÿæˆ·å¯¹å…¶å‘½åç©ºé—´æ‰€èƒ½åšçš„äº‹æƒ…ï¼Œè¿™æ˜¯ä¸€ä¸ªç»å¦™çš„æƒ³æ³•ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/multi-tenancy-in-kubernetes/5_hu11499914418091588437.webp 400w,
               /blog/multi-tenancy-in-kubernetes/5_hu5699172421217477059.webp 760w,
               /blog/multi-tenancy-in-kubernetes/5_hu7871351159907211771.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/multi-tenancy-in-kubernetes/5_hu11499914418091588437.webp&#34;
               width=&#34;760&#34;
               height=&#34;570&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ Pod éƒ½å¯ä»¥ä¸ Kubernetes ä¸­çš„ä»»ä½• Pod é€šä¿¡ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¯¹äºå¤šç§Ÿæˆ·æ¥è¯´è¿™ä¸æ˜¯å¾ˆå¥½ï¼Œä½†æ‚¨å¯ä»¥ä½¿ç”¨ &lt;a href=&#34;https://github.com/ahmetb/kubernetes-network-policy-recipes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Network Policies&lt;/a&gt; æ¥æ›´æ­£ã€‚&lt;/p&gt;
&lt;p&gt;ç½‘ç»œç­–ç•¥ç±»ä¼¼äºé˜²ç«å¢™è§„åˆ™ï¼Œå¯è®©æ‚¨éš”ç¦»å‡ºç«™å’Œå…¥ç«™æµé‡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/multi-tenancy-in-kubernetes/6_hu13689339412089852834.webp 400w,
               /blog/multi-tenancy-in-kubernetes/6_hu13364621688692986036.webp 760w,
               /blog/multi-tenancy-in-kubernetes/6_hu5567108739151399970.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/multi-tenancy-in-kubernetes/6_hu13689339412089852834.webp&#34;
               width=&#34;760&#34;
               height=&#34;570&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¤ªå¥½äº†ï¼Œå‘½åç©ºé—´ç°åœ¨å®‰å…¨äº†å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä¸è¦è¿™ä¹ˆå¿«ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶ RBACã€Network Policiesã€Quotas ç­‰ä¸ºå¤šç§Ÿæˆ·æä¾›äº†åŸºæœ¬æ„å»ºå—ï¼Œä½†è¿™è¿˜ä¸å¤Ÿã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Kubernetes æœ‰å‡ ä¸ªå…±äº«ç»„ä»¶ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯ Ingress æ§åˆ¶å™¨ï¼Œé€šå¸¸æ¯ä¸ªé›†ç¾¤éƒ¨ç½²ä¸€ä¸ªã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¦‚æœæ‚¨æäº¤äº†ä¸€ä¸ªå…·æœ‰ç›¸åŒè·¯å¾„çš„ Ingress æ¨¡æ¿ï¼Œåˆ™æœ€åä¸€ä¸ªä¼šè¦†ç›–å®šä¹‰ï¼Œåªæœ‰ä¸€ä¸ªä¼šèµ·ä½œç”¨ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/multi-tenancy-in-kubernetes/7_hu3614514531611951741.webp 400w,
               /blog/multi-tenancy-in-kubernetes/7_hu7875830298332880995.webp 760w,
               /blog/multi-tenancy-in-kubernetes/7_hu6455456522046967582.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/multi-tenancy-in-kubernetes/7_hu3614514531611951741.webp&#34;
               width=&#34;760&#34;
               height=&#34;570&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœ€å¥½çš„æ–¹æ³•æ˜¯åœ¨æ¯ä¸ªå‘½åç©ºé—´ä¸­éƒ¨ç½²ä¸€ä¸ªæ§åˆ¶å™¨ã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€ä¸ªæœ‰è¶£çš„æŒ‘æˆ˜æ˜¯ CoreDNSã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœå…¶ä¸­ä¸€ä¸ªç§Ÿæˆ·æ»¥ç”¨ DNS æ€ä¹ˆåŠï¼Ÿ&lt;/p&gt;
&lt;p&gt;æ•´ä¸ªé›†ç¾¤ä¹Ÿä¼šå—åˆ°å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;æ‚¨å¯ä»¥ä½¿ç”¨é¢å¤–çš„æ’ä»¶ &lt;a href=&#34;https://github.com/coredns/policy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/coredns/policy&lt;/a&gt; é™åˆ¶è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/multi-tenancy-in-kubernetes/8_hu17152574346581923905.webp 400w,
               /blog/multi-tenancy-in-kubernetes/8_hu16655517667028312025.webp 760w,
               /blog/multi-tenancy-in-kubernetes/8_hu9587161788673513675.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/multi-tenancy-in-kubernetes/8_hu17152574346581923905.webp&#34;
               width=&#34;760&#34;
               height=&#34;570&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åŒæ ·çš„æŒ‘æˆ˜ä¹Ÿé€‚ç”¨äº Kubernetes API æœåŠ¡å™¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Kubernetes ä¸çŸ¥é“ç§Ÿæˆ·ï¼Œå¦‚æœ API æ”¶åˆ°å¤ªå¤šè¯·æ±‚ï¼Œå°†å¯¹æ‰€æœ‰äººè¿›è¡Œé™æµã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä¸çŸ¥é“æ˜¯å¦æœ‰è§£å†³æ–¹æ³•ï¼&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/multi-tenancy-in-kubernetes/9_hu14821421594980632595.webp 400w,
               /blog/multi-tenancy-in-kubernetes/9_hu642915357545992023.webp 760w,
               /blog/multi-tenancy-in-kubernetes/9_hu9725205177026063732.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/multi-tenancy-in-kubernetes/9_hu14821421594980632595.webp&#34;
               width=&#34;760&#34;
               height=&#34;570&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å‡è®¾æ‚¨æˆåŠŸè§£å†³äº†å…±äº«èµ„æºçš„é—®é¢˜ï¼Œè¿˜æœ‰ kubelet å’Œå·¥ä½œè´Ÿè½½çš„æŒ‘æˆ˜ã€‚&lt;/p&gt;
&lt;p&gt;æ­£å¦‚ Philippe Bogaerts åœ¨&lt;a href=&#34;https://xxradar.medium.com/exploiting-applications-using-livenessprobes-in-kubernetes-cdff6329d320&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™ç¯‡æ–‡ç« &lt;/a&gt;ä¸­æ‰€è§£é‡Šçš„é‚£æ ·ï¼Œä¸€ä¸ªç§Ÿæˆ·å¯ä»¥é€šè¿‡ (æ»¥) ä½¿ç”¨æ´»åŠ¨æ¢é’ˆæ¥æ¥ç®¡é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;ä¿®å¤ä¸æ˜¯å¾®ä¸è¶³é“çš„ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/multi-tenancy-in-kubernetes/10_hu12920114844000112989.webp 400w,
               /blog/multi-tenancy-in-kubernetes/10_hu13872199305800541301.webp 760w,
               /blog/multi-tenancy-in-kubernetes/10_hu7803880429534573578.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/multi-tenancy-in-kubernetes/10_hu12920114844000112989.webp&#34;
               width=&#34;760&#34;
               height=&#34;570&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ‚¨å¯ä»¥å°†ä»£ç è´¨é‡æ£€æŸ¥å™¨ä½œä¸º CI/CD è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œæˆ–ä½¿ç”¨å‡†å…¥æ§åˆ¶å™¨éªŒè¯æäº¤åˆ°é›†ç¾¤çš„èµ„æºæ˜¯å¦å®‰å…¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/open-policy-agent/gatekeeper-library&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œæ˜¯ Open Policy Agent çš„è§„åˆ™åº“ã€‚&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/multi-tenancy-in-kubernetes/11_hu10166594371104058833.webp 400w,
               /blog/multi-tenancy-in-kubernetes/11_hu10854926958375360638.webp 760w,
               /blog/multi-tenancy-in-kubernetes/11_hu5533786704422911605.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/multi-tenancy-in-kubernetes/11_hu10166594371104058833.webp&#34;
               width=&#34;760&#34;
               height=&#34;570&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®¹å™¨ä¹Ÿæä¾›äº†æ¯”è™šæ‹Ÿæœºæ›´å¼±çš„éš”ç¦»æœºåˆ¶ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=JaMJJTb_bEE&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Lewis Denham-Parry åœ¨è¿™ä¸ªè§†é¢‘ä¸­å±•ç¤ºäº†å¦‚ä½•ä»å®¹å™¨ä¸­é€ƒè„±ã€‚&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è¯¥æ€ä¹ˆåŠï¼Ÿ&lt;/p&gt;
&lt;p&gt;æ‚¨å¯ä»¥ä½¿ç”¨å®¹å™¨æ²™ç®±ï¼Œä¾‹å¦‚ &lt;a href=&#34;https://gvisor.dev/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gVisor&lt;/a&gt;ã€è½»é‡çº§è™šæ‹Ÿæœºä½œä¸ºå®¹å™¨ (&lt;a href=&#34;https://katacontainers.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kata containers&lt;/a&gt;ã€&lt;a href=&#34;https://github.com/firecracker-microvm/firecracker-containerd&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;firecracker + containerd&lt;/a&gt;) æˆ–å…¨è™šæ‹Ÿæœº (&lt;a href=&#34;https://github.com/Mirantis/virtlet&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;virtlet ä½œä¸º CRI&lt;/a&gt;)ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/multi-tenancy-in-kubernetes/12_hu11393577123814071430.webp 400w,
               /blog/multi-tenancy-in-kubernetes/12_hu5488798261527943947.webp 760w,
               /blog/multi-tenancy-in-kubernetes/12_hu11336772839407018951.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/multi-tenancy-in-kubernetes/12_hu11393577123814071430.webp&#34;
               width=&#34;760&#34;
               height=&#34;570&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¸Œæœ›æ‚¨å·²ç»æ„è¯†åˆ°äº†è¿™ä¸ªä¸»é¢˜çš„å¤æ‚æ€§ä»¥åŠåœ¨ Kubernetes ä¸­æä¾›ä¸¥æ ¼çš„ç½‘ç»œã€å·¥ä½œè´Ÿè½½å’Œæ§åˆ¶å™¨ä¹‹é—´çš„åˆ†éš”è¾¹ç•Œçš„éš¾åº¦ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.jessfraz.com/post/hard-multi-tenancy-in-kubernetes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸å»ºè®®åœ¨ Kubernetes ä¸­æä¾›ç¡¬å¤šç§Ÿæˆ·ã€‚&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‚¨éœ€è¦ç¡¬å¤šç§Ÿæˆ·ï¼Œåˆ™å»ºè®®ä½¿ç”¨å¤šä¸ªé›†ç¾¤æˆ– Cluster-as-a-Service å·¥å…·ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes-sigs/cluster-api&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cluster API&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/openshift/hypershift&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HyperShift&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/clastix/kamaji&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kamaji&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://gardener.cloud/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gardener&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœæ‚¨å¯ä»¥å®¹å¿è¾ƒå¼±çš„å¤šç§Ÿæˆ·æ¨¡å‹ï¼Œä»¥æ¢å–ç®€å•å’Œä¾¿åˆ©ï¼Œåˆ™å¯ä»¥æ¨å‡ºæ‚¨çš„ RBACã€Quotas ç­‰è§„åˆ™ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œæœ‰ä¸€äº›å·¥å…·å¯ä»¥ä¸ºæ‚¨æŠ½è±¡å‡ºè¿™äº›é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes-sigs/cluster-api-provider-nested/tree/main/virtualcluster&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Virtual Cluster (wg-multitenancy)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.vcluster.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Vcluster&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/clastix/capsule&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Capsule&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/loft-sh/kiosk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kiosk&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ€åï¼Œå¦‚æœæ‚¨å–œæ¬¢è¿™ä¸ªä¸»é¢˜ï¼Œæ‚¨å¯èƒ½è¿˜ä¼šå–œæ¬¢ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Learnk8s åœ¨è¿è¡Œçš„ Kubernetes å·¥ä½œåŠ &lt;a href=&#34;https://learnk8s.io/training&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://learnk8s.io/training&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;è¿‡å»çš„ä¸»é¢˜é›†åˆ &lt;a href=&#34;https://twitter.com/danielepolencic/status/1298543151901155330&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://twitter.com/danielepolencic/status/1298543151901155330&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æˆ‘æ¯å‘¨å‘å¸ƒçš„ Kubernetes é€šè®¯ &lt;a href=&#34;https://learnk8s.io/learn-kubernetes-weekly&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://learnk8s.io/learn-kubernetes-weekly&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ Kyverno å’Œ Argo CD å®æ–½ Kubernetes æœ€ä½³å®è·µ</title>
      <link>https://cloudnativecn.com/blog/argo-cd-kyverno-best-practice-policies/</link>
      <pubDate>Mon, 10 Apr 2023 22:44:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/argo-cd-kyverno-best-practice-policies/</guid>
      <description>&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/argo-cd-kyverno-best-practice-policies/kyverno-argo_hu18378413893696632989.webp 400w,
               /blog/argo-cd-kyverno-best-practice-policies/kyverno-argo_hu4493266247842752210.webp 760w,
               /blog/argo-cd-kyverno-best-practice-policies/kyverno-argo_hu3328606411967802331.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/argo-cd-kyverno-best-practice-policies/kyverno-argo_hu18378413893696632989.webp&#34;
               width=&#34;760&#34;
               height=&#34;428&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æ­£åœ¨é˜…è¯»è¿™ç¯‡åšå®¢æ–‡ç« ï¼Œæˆ‘å‡è®¾ä½ å·²ç»ç†Ÿæ‚‰ Kubernetes å¹¶ä¸”çŸ¥é“å®ƒæ˜¯ä¸€ä¸ªå®¹å™¨ç¼–æ’å¹³å°ã€‚åœ¨åˆ›å»ºæ–°çš„åº”ç”¨ç¨‹åºç‰ˆæœ¬æ—¶ï¼Œä½ çš„å®¹å™¨æ„å»ºè¿‡ç¨‹å·²ç»å¾ˆå¥½äº†ã€‚Kubernetes æä¾›äº†å¹¿æ³›çš„åŠŸèƒ½ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿæ‰§è¡Œå¤æ‚çš„éƒ¨ç½²ç­–ç•¥ã€‚æŒ‘æˆ˜åœ¨äºæ ¹æ®ä½ çš„ç¯å¢ƒï¼Œæœ‰æ­£ç¡®å’Œé”™è¯¯çš„ä½¿ç”¨æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;ä½ ç»„ç»‡ä¸­çš„å¹³å°å·¥ç¨‹å¸ˆå¾ˆå¯èƒ½éå¸¸ç†Ÿæ‚‰ Kubernetesï¼Œäº†è§£å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°é›†ç¾¤ä¸­çš„æ­£ç¡®å’Œé”™è¯¯æ–¹å¼ã€‚æŒ‘æˆ˜åœ¨äºå‘å¹³å°çš„æ‰€æœ‰ç”¨æˆ·ä¼ é€’è¿™äº›ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;å¤§å¤šæ•°è¿ç»´äººå‘˜çš„ç†è§£å¾ˆå¯èƒ½æ¥è‡ªäºæ­£å¼åŸ¹è®­æˆ–èŠ±è´¹å¾ˆå¤šæ—¶é—´æ„å»ºå¹³å°å¹¶ä»é”™è¯¯ä¸­å­¦ä¹ ã€‚è¦æ±‚æ‰€æœ‰æ‰“ç®—ä¸å¹³å°äº¤äº’çš„åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜å…·æœ‰ç›¸åŒçš„ç»éªŒæ˜¯ä¸ç°å®çš„ã€‚è¿™å¯¹ç»„ç»‡æ¥è¯´åœ¨æ—¶é—´ã€ç²¾åŠ›å’Œå¯¹äº§å“å’Œå®¢æˆ·çš„æ½œåœ¨å½±å“æ–¹é¢éƒ½æ˜¯æ˜‚è´µçš„ï¼Œå› ä¸ºè¿™äº›ç»éªŒæ˜¯ä»é”™è¯¯ä¸­å­¦åˆ°çš„ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ¯ä¸ªç»„ç»‡å†…ï¼Œç”¨æˆ·ä½¿ç”¨å†…éƒ¨å¼€å‘å¹³å°çš„ç­–ç•¥å’Œæ ‡å‡†æ˜¯å·²çŸ¥çš„æˆ–éœ€è¦éµå¾ªçš„ã€‚æŒ‘æˆ˜åœ¨äºè®¸å¤šç»„ç»‡ä½¿ç”¨æ–‡æ¡£å’Œå¹¿æ³›çš„æ²Ÿé€šæ¥ç¡®ä¿ç”¨æˆ·éµå¾ªè¿™äº›æ ‡å‡†ã€‚è¿™åœ¨äººä»¬åç¦»é¢„æœŸæ ‡å‡†å¹¶å­¦ä¹ æ­£ç¡®æ–¹æ³•ä¹‹é—´æä¾›äº†é•¿æ—¶é—´çš„åé¦ˆå¾ªç¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;kyverno&#34;&gt;Kyverno&lt;/h2&gt;
&lt;p&gt;è¿™å°±æ˜¯ &lt;a href=&#34;https://kyverno.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kyverno&lt;/a&gt; çš„ç”¨æ­¦ä¹‹åœ°ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºäº Kubernetes çš„ç­–ç•¥å¼•æ“ï¼Œæä¾›äº†ä¸€ç§å°†å¹³å°ç®¡ç†å‘˜å­¦åˆ°çš„ç»éªŒç¼–ç åŒ–çš„æ–¹å¼ã€‚Kyverno ç›´æ¥éƒ¨ç½²åˆ° Kubernetes é›†ç¾¤ä¸­ï¼Œå¹¶ä½¿ç”¨è‡ªå®šä¹‰èµ„æºæ¥å®šä¹‰ç­–ç•¥ã€‚ä½¿ç”¨ admission webhookï¼ŒKyverno å¯ä»¥å®¡è®¡ç­–ç•¥è¿è§„æˆ–ç”šè‡³é˜»æ­¢å°è¯•è¿›å…¥é›†ç¾¤çš„è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;ç­–ç•¥å¼•æ“å¯ä»¥å¤§å¤§ç¼©çŸ­åœ¨ Kubernetes ä¸­å°è¯•åº”ç”¨æ›´æ”¹å¹¶å­¦ä¹ éƒ¨ç½²ä¸ç¬¦åˆå¹³å°ç®¡ç†å‘˜è®¾ç½®çš„æ ‡å‡†æ—¶çš„åé¦ˆå¾ªç¯ã€‚å½“åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜ä¸é›†ç¾¤äº¤äº’æ—¶ï¼Œç­–ç•¥ä¼šç«‹å³æä¾›åé¦ˆï¼ŒæŒ‡å‡ºä»–ä»¬æ˜¯å¦åç¦»äº†å¹³å°å›¢é˜Ÿåˆ¶å®šçš„æœ€ä½³å®è·µã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œä¸€ä¸ªåˆšå¼€å§‹ç†Ÿæ‚‰ Kubernetes çš„å¼€å‘äººå‘˜å†³å®šéƒ¨ç½²åº”ç”¨ç¨‹åºçš„ &lt;code&gt;latest&lt;/code&gt; æ ‡è®°ã€‚è¿™ä¼¼ä¹æ˜¯æ— å®³çš„ï¼Œä½†ä»–ä»¬ä¸çŸ¥é“ä½¿ç”¨å¯å˜æ ‡è®°çš„å±é™©ã€‚åœ¨æ­¤é”™è¯¯è¢«é›†ç¾¤ç®¡ç†å‘˜æ•æ‰å¹¶å‘ç”¨æˆ·æŠ¥å‘Šä¹‹å‰ï¼Œè¿™æ®µæ—¶é—´å¯èƒ½é€ æˆå¾ˆå¤§çš„æŸå¤±ã€‚&lt;/p&gt;
&lt;p&gt;ç›¸åï¼Œå½“ç”¨æˆ·å°è¯•å°† &lt;code&gt;latest&lt;/code&gt; æ ‡è®°éƒ¨ç½²åˆ°é›†ç¾¤ä¸­æ—¶ï¼Œä»–ä»¬å¯ä»¥ç«‹å³æ”¶åˆ°ä¸€ä¸ªæ¸…æ™°çš„æ¶ˆæ¯ï¼Œè§£é‡Šä¸ºä»€ä¹ˆä¸å…è®¸è¿™æ ·åšï¼Œå¹¶æä¾›çº æ­£ç­–ç•¥è¿è§„çš„æ­¥éª¤ã€‚è¿™ä½¿ä»–ä»¬å¯ä»¥ç»§ç»­å®ç°ä»–ä»¬æƒ³è¦å®Œæˆçš„ç›®æ ‡ï¼Œå°†ä»–ä»¬çš„åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°é›†ç¾¤ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ç»„ç»‡ç”šè‡³å¯ä»¥å°†ç­–ç•¥é›†æˆåˆ° CI/CD å·¥ä½œæµç¨‹ä¸­ï¼Œä»¥æ›´æ—©åœ°æ•æ‰ä»»ä½•è¿è§„è¡Œä¸ºã€‚å¦‚æœæŸäº›è¿è§„è¡Œä¸ºåœ¨é›†ç¾¤ä¸­å¾—ä»¥å®ç°ï¼ŒKyverno å¯ä»¥é˜»æ­¢ admission è¯·æ±‚ä»¥å¼ºåˆ¶æ‰§è¡Œè¯¥ç­–ç•¥ï¼Œç”šè‡³å¯ä»¥åœ¨åº”ç”¨å®ƒä»¬æ—¶æ”¹å˜èµ„æºï¼Œä½¿å®ƒä»¬ç¬¦åˆæœ€ä½³å®è·µã€‚&lt;/p&gt;
&lt;h2 id=&#34;gitops--argo-cd&#34;&gt;GitOps / Argo CD&lt;/h2&gt;
&lt;p&gt;ä½œä¸º Kubernetes ç®¡ç†å‘˜ï¼Œä½ å¯èƒ½å¥½å¥‡å¦‚ä½•ç®¡ç†è¿™äº›ç­–ç•¥ï¼Œè¿™å°±æ˜¯ Argo CD å’Œ GitOps çš„ä½œç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://akuity.io/gitops/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GitOps&lt;/a&gt; å°†åº”ç”¨ç¨‹åºå¼€å‘çš„æœ€ä½³å®è·µï¼ˆå¦‚ç‰ˆæœ¬æ§åˆ¶ã€åä½œã€åˆè§„æ€§å’Œå·¥å…·ï¼‰åº”ç”¨äº Kubernetesã€‚é›†ç¾¤ä¸­ä½¿ç”¨çš„ Kubernetes èµ„æºçš„æ¸…å•å­˜å‚¨åœ¨ Git ä¸­ï¼Œè¿™æä¾›äº†æ‰€éœ€çŠ¶æ€çš„ä¸å¯å˜ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://akuity.io/what-is-argo/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Argo CD&lt;/a&gt; å……å½“ GitOps ä»£ç†ï¼Œä¸æ–­åœ°å°†æœŸæœ›çŠ¶æ€ä¸é›†ç¾¤çš„å®é™…çŠ¶æ€è¿›è¡Œæ¯”è¾ƒã€‚å®ƒå°† Git ä¸­çš„ä»»ä½•æ›´æ”¹åº”ç”¨äº Kubernetes é›†ç¾¤ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ä»»ä½• Kubernetes æ¸…å•ä¸€æ ·ï¼ŒKyverno ç­–ç•¥å¯ä»¥é€šè¿‡ Git å­˜å‚¨å’Œç®¡ç†ã€‚è¿™ä½¿å®ƒä»¬å¯ä»¥éµå¾ªé€æ˜çš„æ‰¹å‡†æµç¨‹ï¼Œå¹¶æä¾›ç­–ç•¥ä½•æ—¶ä»¥åŠä¸ºä»€ä¹ˆå‘ç”Ÿæ›´æ”¹çš„å®¡è®¡è·Ÿè¸ªã€‚&lt;/p&gt;
&lt;h2 id=&#34;kyverno-æœ€ä½³å®è·µç­–ç•¥&#34;&gt;Kyverno æœ€ä½³å®è·µç­–ç•¥&lt;/h2&gt;
&lt;p&gt;è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä½¿ç”¨ Kyverno ç­–ç•¥å®æ–½ Kubernetes æœ€ä½³å®è·µçš„å…¸å‹ç¤ºä¾‹ã€‚æˆ‘ä»¬å°†ä»ä½¿ç”¨ Argo CD å‘é›†ç¾¤æ·»åŠ ç­–ç•¥å¼€å§‹ã€‚å¯¹äºæ­¤ç¤ºä¾‹ï¼ŒKyverno å’Œ Argo CD å·²å®‰è£…åœ¨é›†ç¾¤ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ &lt;a href=&#34;https://github.com/morey-tech/argo-cd-kyverno&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GitOps ä»“åº“&lt;/a&gt; ä¸­ï¼Œæ·»åŠ  &lt;code&gt;require-resource-requests&lt;/code&gt; ç­–ç•¥ï¼Œè¯¥ç­–ç•¥è¦æ±‚ pod å…·æœ‰å®šä¹‰çš„èµ„æºè¯·æ±‚ã€‚è¿™å¯¹ Kubernetes èƒ½å¤Ÿå°† pod &lt;a href=&#34;https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#how-pods-with-resource-requests-are-scheduled&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰æ’åˆ°å…·æœ‰è¶³å¤Ÿèµ„æºçš„èŠ‚ç‚¹ä¸Š&lt;/a&gt;è‡³å…³é‡è¦ã€‚å¦‚æœæ²¡æœ‰è¿™äº›èµ„æºè¯·æ±‚ï¼Œä»èµ„æºå¯ç”¨æ€§çš„è§’åº¦æ¥çœ‹ï¼ŒKubernetes å°†ç›²ç›®åœ°å°† pod å®‰æ’åˆ°èŠ‚ç‚¹ä¸Šã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kyverno.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterPolicy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;require-resource-requests&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;policies.kyverno.io/title&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Require Resource Requests&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;policies.kyverno.io/category&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Best Practices&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;policies.kyverno.io/severity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;medium&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;policies.kyverno.io/subject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;policies.kyverno.io/minversion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1.6.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;policies.kyverno.io/description&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;-&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      As application workloads share cluster resources, it is important to specify resources
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      requested and consumed by each Pod. Requiring resource requests per Pod is recommended,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      especially for memory and CPU. If a Namespace level request is specified, defaults will
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      automatically be applied to each Pod based on the LimitRange configuration. This policy
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;      validates that all containers have something specified for memory and CPU requests.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;validationFailureAction&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;enforce&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;background&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;validate-resource-requests&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;match&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;any&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kinds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespaces&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;validate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;CPU and memory resource requests are required.&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;pattern&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;requests&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;?*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cpu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;?*&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;validationFailureAction&lt;/code&gt; å­—æ®µç¡®å®š Kyverno å¦‚ä½•å“åº”å¤±è´¥çš„éªŒè¯æ£€æŸ¥çš„è¡Œä¸ºã€‚&lt;code&gt;require-resource-requests&lt;/code&gt; ç­–ç•¥è®¾ç½®ä¸ºå¼ºåˆ¶æ‰§è¡Œè§„åˆ™å¤±è´¥ï¼Œé˜»æ­¢ä»»ä½•è¿åå®ƒä»¬çš„è¯·æ±‚ã€‚å½“å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œå®ƒå°†åœ¨è´Ÿè´£çš„ç­–ç•¥èµ„æºä¸Šè®°å½•ä¸€ä¸ª &lt;code&gt;fail (blocked)&lt;/code&gt; äº‹ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;validate-resource-requests&lt;/code&gt; è§„åˆ™å°†åŒ¹é… &lt;code&gt;dev&lt;/code&gt; å‘½åç©ºé—´ä¸­çš„ä»»ä½• &lt;code&gt;Pod&lt;/code&gt; èµ„æºï¼Œå³ä½¿æ˜¯ä»æ›´é«˜çº§åˆ«çš„èµ„æºï¼ˆå¦‚ Deployment æˆ– ReplicaSetï¼‰ç”Ÿæˆçš„ã€‚å®ƒå°†éªŒè¯ pod ä¸­çš„å®¹å™¨ä¸Šçš„ &lt;code&gt;cpu&lt;/code&gt; å’Œ &lt;code&gt;memory&lt;/code&gt; èµ„æºè¯·æ±‚å­—æ®µæ˜¯å¦å®šä¹‰äº†å€¼ã€‚å½“ç­–ç•¥éªŒè¯å¤±è´¥æ—¶ï¼Œå®ƒå°†åŒ…æ‹¬è§„åˆ™ä¸­å®šä¹‰çš„ &lt;code&gt;message&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ªåº”ç”¨ç¨‹åºåˆ° Argo CDï¼Œè¯¥åº”ç”¨ç¨‹åºæŒ‡å‘åŒ…å«ç­–ç•¥çš„ä»“åº“ä¸­çš„ç›®å½•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;argoproj.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Application&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;policies&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kyverno&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;project&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;policies&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;repoURL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https://github.com/morey-tech/argo-cd-kyverno.git&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetRevision&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;directory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;recurse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;















&lt;figure  id=&#34;figure-kyverno-ç­–ç•¥åœ¨-argo-cd-ä¸­åŒæ­¥&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Kyverno ç­–ç•¥åœ¨ Argo CD ä¸­åŒæ­¥ã€‚&#34; srcset=&#34;
               /blog/argo-cd-kyverno-best-practice-policies/argo-cd-kyverno-policy-synced_hu1376607556978896386.webp 400w,
               /blog/argo-cd-kyverno-best-practice-policies/argo-cd-kyverno-policy-synced_hu3779173238734716698.webp 760w,
               /blog/argo-cd-kyverno-best-practice-policies/argo-cd-kyverno-policy-synced_hu16806491329971630157.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/argo-cd-kyverno-best-practice-policies/argo-cd-kyverno-policy-synced_hu1376607556978896386.webp&#34;
               width=&#34;760&#34;
               height=&#34;356&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Kyverno ç­–ç•¥åœ¨ Argo CD ä¸­åŒæ­¥ã€‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;éšç€ç­–ç•¥åŒæ­¥åˆ°é›†ç¾¤ä¸­ï¼Œæˆ‘ä»¬å°†éƒ¨ç½²å¦ä¸€ä¸ª Argo CD åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­åŒ…å«ä¸¤ä¸ª &lt;code&gt;nginx&lt;/code&gt; podï¼Œä¸€ä¸ªå°†é€šè¿‡ç­–ç•¥éªŒè¯ï¼Œå¦ä¸€ä¸ªå°†å› ç¼ºå°‘èµ„æºè¯·æ±‚è€Œå¤±è´¥ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-åº”ç”¨ç¨‹åºåŒæ­¥å¤±è´¥å› ä¸º-kyverno-ç­–ç•¥é˜»æ­¢äº†-pod-çš„åˆ›å»º&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;åº”ç”¨ç¨‹åºåŒæ­¥å¤±è´¥ï¼Œå› ä¸º Kyverno ç­–ç•¥é˜»æ­¢äº† pod çš„åˆ›å»ºã€‚&#34; srcset=&#34;
               /blog/argo-cd-kyverno-best-practice-policies/argo-cd-sync-failed-blocked-pod_hu2934968189233527941.webp 400w,
               /blog/argo-cd-kyverno-best-practice-policies/argo-cd-sync-failed-blocked-pod_hu2217019637692964096.webp 760w,
               /blog/argo-cd-kyverno-best-practice-policies/argo-cd-sync-failed-blocked-pod_hu16142896217537150665.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/argo-cd-kyverno-best-practice-policies/argo-cd-sync-failed-blocked-pod_hu2934968189233527941.webp&#34;
               width=&#34;760&#34;
               height=&#34;312&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      åº”ç”¨ç¨‹åºåŒæ­¥å¤±è´¥ï¼Œå› ä¸º Kyverno ç­–ç•¥é˜»æ­¢äº† pod çš„åˆ›å»ºã€‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åŒæ­¥æœ€ç»ˆå°†å¤±è´¥ï¼Œå› ä¸ºè¯¥ç­–ç•¥è®¾ç½®ä¸ºé˜»æ­¢åˆ›å»ºä»»ä½•åŒ…å«è¿è§„çš„èµ„æºã€‚æŸ¥çœ‹ Argo CD ä¸­çš„åŒæ­¥çŠ¶æ€æ—¶ï¼Œç”¨æˆ·å¯ä»¥çœ‹åˆ°æ¶ˆæ¯ä¸­çš„ Kyverno ç­–ç•¥å¤±è´¥å’Œè§„åˆ™è§£é‡Šå¤±è´¥åŸå› ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-åº”ç”¨ç¨‹åºåŒæ­¥æ‘˜è¦å…¶ä¸­åŒ…å«æ¥è‡ª-kyverno-ç­–ç•¥çš„æ¶ˆæ¯&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;åº”ç”¨ç¨‹åºåŒæ­¥æ‘˜è¦ï¼Œå…¶ä¸­åŒ…å«æ¥è‡ª Kyverno ç­–ç•¥çš„æ¶ˆæ¯ã€‚&#34; srcset=&#34;
               /blog/argo-cd-kyverno-best-practice-policies/argo-cd-sync-summary_hu3792617021131037843.webp 400w,
               /blog/argo-cd-kyverno-best-practice-policies/argo-cd-sync-summary_hu14748183961233453245.webp 760w,
               /blog/argo-cd-kyverno-best-practice-policies/argo-cd-sync-summary_hu8157213694201626380.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/argo-cd-kyverno-best-practice-policies/argo-cd-sync-summary_hu3792617021131037843.webp&#34;
               width=&#34;760&#34;
               height=&#34;235&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      åº”ç”¨ç¨‹åºåŒæ­¥æ‘˜è¦ï¼Œå…¶ä¸­åŒ…å«æ¥è‡ª Kyverno ç­–ç•¥çš„æ¶ˆæ¯ã€‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åŒæ­¥çŠ¶æ€è¿˜å°†æ¯ä¸ªèµ„æºçš„ç»“æœåˆ†è§£ï¼Œä½¿ç”¨æˆ·æ¸…æ¥šåœ°äº†è§£å“ªä¸ªèµ„æºå¤±è´¥ä»¥åŠåŸå› ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-åº”ç”¨ç¨‹åºåŒæ­¥ç»“æœæ˜¾ç¤ºåŒæ­¥çŠ¶æ€å’Œèµ„æºä¸Šçš„-kyverno-ç­–ç•¥æ¶ˆæ¯&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;åº”ç”¨ç¨‹åºåŒæ­¥ç»“æœï¼Œæ˜¾ç¤ºåŒæ­¥çŠ¶æ€å’Œèµ„æºä¸Šçš„ Kyverno ç­–ç•¥æ¶ˆæ¯ã€‚&#34; srcset=&#34;
               /blog/argo-cd-kyverno-best-practice-policies/argo-cd-sync-result-resources_hu3897358944372766107.webp 400w,
               /blog/argo-cd-kyverno-best-practice-policies/argo-cd-sync-result-resources_hu17117358413799015566.webp 760w,
               /blog/argo-cd-kyverno-best-practice-policies/argo-cd-sync-result-resources_hu6086413982999675171.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/argo-cd-kyverno-best-practice-policies/argo-cd-sync-result-resources_hu3897358944372766107.webp&#34;
               width=&#34;760&#34;
               height=&#34;184&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      åº”ç”¨ç¨‹åºåŒæ­¥ç»“æœï¼Œæ˜¾ç¤ºåŒæ­¥çŠ¶æ€å’Œèµ„æºä¸Šçš„ Kyverno ç­–ç•¥æ¶ˆæ¯ã€‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ç­–ç•¥èµ„æºä¸Šï¼Œäº‹ä»¶ä¹Ÿä¼šæ˜¾ç¤ºè¿è§„è¡Œä¸ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-kyverno-ç­–ç•¥äº‹ä»¶åœ¨-argo-cd-ä¸­&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Kyverno ç­–ç•¥äº‹ä»¶åœ¨ Argo CD ä¸­ã€‚&#34; srcset=&#34;
               /blog/argo-cd-kyverno-best-practice-policies/argo-cd-kyverno-policy-events_hu12756624536411826433.webp 400w,
               /blog/argo-cd-kyverno-best-practice-policies/argo-cd-kyverno-policy-events_hu5358802121498698652.webp 760w,
               /blog/argo-cd-kyverno-best-practice-policies/argo-cd-kyverno-policy-events_hu1244450036027279176.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/argo-cd-kyverno-best-practice-policies/argo-cd-kyverno-policy-events_hu12756624536411826433.webp&#34;
               width=&#34;760&#34;
               height=&#34;305&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Kyverno ç­–ç•¥äº‹ä»¶åœ¨ Argo CD ä¸­ã€‚
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦èµ„æºçš„ç­–ç•¥è¿è§„å¾—åˆ°è§£å†³ï¼ŒArgo CD åº”ç”¨ç¨‹åºå°±èƒ½å°†è¯¥èµ„æºåŒæ­¥åˆ°é›†ç¾¤ä¸­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h2&gt;
&lt;p&gt;Kyverno ä½œä¸ºç­–ç•¥å¼•æ“ï¼Œæ˜¯å‘å†…éƒ¨å¼€å‘è€…å¹³å°ç”¨æˆ·æä¾›å®ç°å¹³å°å›¢é˜Ÿåˆ¶å®šçš„æœ€ä½³å®è·µçš„æ¸…æ™°åé¦ˆçš„å¼ºå¤§å·¥å…·ã€‚ç„¶è€Œï¼Œè¿™åªæ˜¯ Kyverno èƒ½åŠ›çš„å†°å±±ä¸€è§’ã€‚æœ¬æ–‡ä¸­çš„ç¤ºä¾‹æ¼”ç¤ºäº†æ³¨å…¥æ§åˆ¶åŠŸèƒ½ï¼Œä½†ç­–ç•¥ä¹Ÿå¯ä»¥ã€ç”Ÿæˆå’Œæ¸…ç†èµ„æºã€‚è¿™æ ·å°±å¯ä»¥é€šè¿‡è‡ªåŠ¨æ›´æ–°èµ„æºæ¥å¼ºåˆ¶æ‰§è¡Œç­–ç•¥ï¼Œä½¿å…¶ç¬¦åˆè¿›å…¥é›†ç¾¤çš„èµ„æºï¼Œæˆ–è€…æ„å»ºä¸€ä¸ªè‡ªåŠ©å¼å¹³å°ï¼Œå“åº”åœ¨é›†ç¾¤ä¸­åˆ›å»ºçš„èµ„æºï¼Œåˆ›å»ºæ–°çš„é›†ç¾¤å¹¶ä½¿ç”¨ Argo CD å¼•å¯¼å®ƒä»¬ã€‚&lt;/p&gt;
&lt;p&gt;éµå¾ª GitOps åŸåˆ™å¹¶ä½¿ç”¨ Argo CD ç®¡ç†éƒ¨ç½²æ—¶ï¼Œç®¡ç†é›†ç¾¤çš„ç­–ç•¥å˜å¾—æ›´åŠ ç®€å•ã€‚Argo CD UI æ˜ç¡®äº†é€šè¿‡ç­–ç•¥éªŒè¯é˜»æ­¢çš„ä»»ä½•èµ„æºï¼Œä½¿ç”¨æˆ·æ˜“äºç†è§£å¦‚ä½•ä½¿èµ„æºç¬¦åˆæ ‡å‡†ã€‚&lt;/p&gt;
&lt;p&gt;Kyverno å’Œ Argo CD ä¸€èµ·å¼€è¾Ÿäº†ä¸€ä¸ªå…¨æ–°çš„é›†ç¾¤ç®¡ç†ä¸–ç•Œï¼Œå¯ä»¥æ ¹æ®æ‚¨ç»„ç»‡çš„éœ€æ±‚è¿›è¡Œæ‰©å±•ã€‚æœ‰å…³ä½¿ç”¨ Argo CD å’Œ Kyverno çš„æ›´å¤šæœ€ä½³å®è·µï¼Œè¯·å‚é˜… Nirmata åšå®¢ä¸Šçš„&lt;a href=&#34;https://nirmata.com/2023/03/09/3-essential-tips-for-using-argo-cd-and-kyverno/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;â€œä½¿ç”¨ Argo CD å’Œ Kyverno çš„ 3 ä¸ªåŸºæœ¬æŠ€å·§â€ ã€‚&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>æ˜¯æ—¶å€™æ€è€ƒ Kubernetes å‡ºå‘æµé‡å®‰å…¨äº†</title>
      <link>https://cloudnativecn.com/blog/egress-for-k8s/</link>
      <pubDate>Tue, 27 Dec 2022 12:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/egress-for-k8s/</guid>
      <description>&lt;h2 id=&#34;ä¸ºä½•è¦è¿›è¡Œ-egress-æµé‡ç­–ç•¥ç®¡æ§&#34;&gt;ä¸ºä½•è¦è¿›è¡Œ Egress æµé‡ç­–ç•¥ç®¡æ§&lt;/h2&gt;
&lt;p&gt;2021 å¹´ CNCF è°ƒæŸ¥æ˜¾ç¤ºï¼Œå…¨çƒå°† kubernetes ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒçš„ç”¨æˆ·å æ¯”å·²è¾¾ 59.77%ï¼Œæ¬§æ´²ç”¨æˆ·æ›´æ˜¯è¾¾åˆ°äº† 68.98%ã€‚ç”¨æˆ·æ­£è¶Šæ¥è¶Šå¤šçš„å°†ç”Ÿäº§ä¸šåŠ¡è¿ç§»åˆ° kubernetes ç¯å¢ƒä¸‹ã€‚Gartner 2021 Hype Cycle for Cloud Security ä¹Ÿæ˜¾ç¤ºäº†å®¹å™¨ä¸ Kubernetes å®‰å…¨å·²å¤„åœ¨â€slope of Enlightenmentâ€é˜¶æ®µã€‚è¿™è¯´æ˜ä¿æŠ¤ kubernetes é‡Œçš„åº”ç”¨æœåŠ¡æ­£å˜çš„è¶Šæ¥è¶Šé‡è¦ã€‚&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä»¬å»å®¡è§†è¿è¡Œåœ¨ kubernetes ä¸­çš„å¤§é‡å¾®æœåŠ¡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¾®æœåŠ¡å®‰å…¨å…·æœ‰å…¸å‹çš„å¾®è¾¹ç•Œä»¥åŠéœ€è¦è¿›è¡ŒæŒç»­æ€§å®‰å…¨å·¥ç¨‹çš„ç‰¹ç‚¹ã€‚æˆ‘ä»¬éœ€è¦ä»¥æ¯ä¸ªå¾®æœåŠ¡ä¸ºè¾¹ç•Œè¿›è¡Œä¿æŠ¤ï¼Œæ— è®ºæ˜¯å…¶è¿è¡Œæ—¶ï¼Œè¿˜æ˜¯å—åŒ—å’Œä¸œè¥¿æµé‡ã€‚éœ€è¦æ¯ä¸ªå¾®æœåŠ¡å•å…ƒåœ¨ç¼–ç ä¹‹åˆå°±å¼€å§‹ç€æ‰‹å®‰å…¨è€ƒè™‘ï¼Œè¿›è¡Œå®‰å…¨å·¦ç§»ï¼Œå®‰å…¨çš„é˜²æŠ¤è®¾æ–½ã€æ–¹æ³•ã€ç­–ç•¥åº”ä¸å¼€å‘è€…å’Œ kubernetes å¹³å°è¿ç»´è€…é€‚é…ã€‚è¿˜éœ€è¦æœ‰èƒ½åŠ›æ´å¯Ÿæ‰€æœ‰çš„æµé‡äº‹ä»¶ï¼Œé‡‡é›†æ‰€æœ‰è¿è¡Œæ—¶æ—¥å¿—ã€äº‹ä»¶ç­‰æ•°æ®ï¼Œé€šè¿‡æŒç»­æ€§çš„å®‰å…¨å·¥ç¨‹ç³»ç»Ÿå¯¹è¿™äº›æ•°æ®è¿›è¡Œåˆ†æï¼Œèšåˆå‡ºè§„åˆ™å¹¶åé¦ˆåˆ°å®‰å…¨çš„ç­–ç•¥è®¾å®šä¸­ã€‚&lt;/p&gt;
&lt;p&gt;kubernetes é‡Œçš„å¾®æœåŠ¡ä¸ä¼šåªåœ¨é›†ç¾¤å†…éƒ¨å°é—­è¿è¡Œï¼Œå®ƒéœ€è¦è®¿é—®é›†ç¾¤å¤–éƒ¨åº”ç”¨ã€æ•°æ®åº“ã€ç¬¬ä¸‰æ–¹ API æœåŠ¡ã€äº’è”ç½‘æœåŠ¡ç­‰ã€‚å‡ºå‘æµé‡é‡Œå¯èƒ½åŒ…å«ä¸šåŠ¡éœ€è¦çš„å¤–éƒ¨è®¿é—®ï¼Œå¼€æºç»„ä»¶æ›´æ–°çš„è®¿é—®ï¼Œç”šè‡³å¯èƒ½æ˜¯è¢«å…¥ä¾µçš„åº”ç”¨å‘ C2 è¿æ¥çš„æµé‡ã€‚å› æ­¤ï¼Œå¿…é¡»å¯¹ kubernetes ä¸­çš„å¾®æœåŠ¡ä¸»åŠ¨å¤–å‡ºæµé‡è¿›è¡Œç®¡æ§ï¼Œç¡®ä¿å…¶å®‰å…¨åˆè§„ã€‚åœ¨ä»¥äº‘åŸç”Ÿæ¶æ„ä¸ºæ ¸å¿ƒæŠ€æœ¯é©±åŠ¨çš„æ•°å­—åŒ–è½¬å‹ä¸‹ï¼Œä¼ä¸šä¼šå¤§é‡é‡‡ç”¨å¼€æºæŠ€æœ¯ï¼Œè€Œè¿™å¯èƒ½æ˜¯æœ€å®¹æ˜“å¼•å…¥å®‰å…¨é£é™©çš„åœ°æ–¹ï¼Œæ— è®ºæ˜¯å¦æœ‰æ˜ç¡®çš„å¼€æºå‡†å…¥æœºåˆ¶ï¼Œä¼ä¸šéƒ½åº”è¶³å¤Ÿé‡è§†è¿™äº›å¼€æºäº§å“å¯èƒ½çš„ä¸»åŠ¨å¤–è®¿æœåŠ¡ï¼Œå°†å…¶ç®¡æ§å¥½ï¼Œç¡®ä¿å®‰å…¨ã€‚&lt;/p&gt;
&lt;p&gt;ç®¡ç† kubernetes ä¸­çš„å‡ºå‘æµé‡ç­–ç•¥ï¼Œçœ‹ä¼¼ç®€å•çš„éœ€æ±‚ï¼Œè¦æƒ³åšå¥½å´å¹¶ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹ã€‚æœ¬æ–‡å°†å’Œæ‚¨ä¸€èµ·åˆ†æ kubernetes å‡ºå‘ç­–ç•¥çš„æŒ‘æˆ˜ï¼Œå¹¶é’ˆå¯¹å½“å‰å¸¸è§è§£å†³æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹è¿›è¡Œåˆ†æï¼Œæ€è€ƒä¼ä¸šåº”å¦‚ä½•åšå¥½ kubernetes å‡ºå‘æµé‡ç­–ç•¥ç®¡æ§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å­˜åœ¨çš„æŒ‘æˆ˜&#34;&gt;å­˜åœ¨çš„æŒ‘æˆ˜&lt;/h2&gt;
&lt;h3 id=&#34;åŠ¨æ€&#34;&gt;åŠ¨æ€&lt;/h3&gt;
&lt;p&gt;ä»æŠ€æœ¯è§’åº¦çœ‹ï¼Œè¿™æ˜¯ç¬¬ä¸€ä¸ªå­˜åœ¨çš„æŒ‘æˆ˜ã€‚åœ¨ kubernetes ç¯å¢ƒä¸‹ï¼Œå¾®æœåŠ¡å•å…ƒçš„ pods å°†æ˜¯é«˜åº¦åŠ¨æ€çš„ã€åˆ†æ•£çš„ã€‚IPã€ç½‘æ®µå’Œç‰©ç†ä½ç½®å°†ä¼šéšæ—¶å‘ç”Ÿå˜åŒ–ã€‚å› æ­¤ç›´æ¥é‡‡ç”¨ IP ç­‰ç‰¹å¾è¿›è¡Œé™æ€åŒ–ç­–ç•¥è®¾å®šå°†æ˜¯ä¸€ä»¶ä¸å¯èƒ½çš„äº‹æƒ…ã€‚ç­–ç•¥å¿…é¡»ä¾èµ–äºå…¶å®ƒæŠ½è±¡çš„åº”ç”¨æ ‡ç­¾ã€æœåŠ¡åæˆ–å‘½åç©ºé—´ç­‰è¿›è¡Œï¼Œå¹¶èƒ½åšåˆ°åŠ¨æ€æ„ŸçŸ¥å˜åŒ–ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç²’åº¦&#34;&gt;ç²’åº¦&lt;/h3&gt;
&lt;p&gt;ä¼ ç»Ÿåº”ç”¨ç¯å¢ƒä¸‹ï¼Œå¯¹ä¸€ä¸ªåº”ç”¨å‡ºå‘æµé‡ç­–ç•¥çš„ç®¡æ§ä¸€èˆ¬æ¥è¯´åªéœ€è¦å¯¹è¯¥åº”ç”¨æ‰€æ¶‰åŠçš„å°‘é‡éƒ¨ç½²è¿›è¡Œç­–ç•¥è®¾å®šå³å¯ã€‚ç„¶è€Œåœ¨å¾®æœåŠ¡åŠ å®¹å™¨åŒ–çš„ç¯å¢ƒä¸‹ï¼Œä¸€ä¸ªåº”ç”¨å¯èƒ½ä¼šæœ‰è®¸å¤šçš„å¾®æœåŠ¡ç»„æˆï¼Œè€Œä¸€ä¸ªå¾®æœåŠ¡åˆåŒ…å«è®¸å¤š podsã€‚ä¸åŒçš„å¾®æœåŠ¡å•å…ƒä¼šéœ€è¦ä¸åŒçš„å‡ºå‘ç­–ç•¥è§„åˆ™ï¼Œæ¯”å¦‚ payment éœ€è¦è¿æ¥ç¬¬ä¸‰æ–¹å¤–éƒ¨æ¥å£ï¼Œè€Œè¯„è®ºæœåŠ¡åˆ™ä¸éœ€è¦ä¸»åŠ¨è®¿é—®ç¬¬ä¸‰æ–¹æœåŠ¡ã€‚è¿™æ„å‘³ç€ç­–ç•¥è®¾å®šçš„ç²’åº¦éœ€è¦ç²¾ç»†åˆ°æ¯ä¸ªå¾®æœåŠ¡å•å…ƒï¼Œå¹¶ç¡®ä¿ç®¡æ§äº†æ‰€æœ‰ç›¸å…³çš„ podsã€‚å¯ä»¥çœ‹å‡ºï¼Œç­–ç•¥ç®¡æ§ç²’åº¦æ›´ç»†ã€å·¥ä½œé‡æ›´å¤§ã€å¤æ‚æ€§æ›´é«˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ååŒ&#34;&gt;ååŒ&lt;/h3&gt;
&lt;p&gt;å½“æˆ‘ä»¬è¦ä¸ºä¸åŒçš„å¾®æœåŠ¡å•å…ƒéƒ¨ç½²å‡ºå‘ç­–ç•¥æ—¶å€™ï¼Œè°åº”è¯¥ä¸ºæ­¤è´Ÿè´£ï¼Œåº”ç”¨å¼€å‘éƒ¨é—¨ï¼Ÿåº”ç”¨éƒ¨ç½²ä¸è¿ç»´éƒ¨é—¨ï¼Ÿkubernetes çš„ platformOps éƒ¨é—¨ï¼Ÿæˆ–æ˜¯å®‰å…¨éƒ¨é—¨ï¼Ÿæˆ‘ä»¬ä»¥å®‰å…¨å·¦ç§»çš„æ€æƒ³å»çœ‹å¾…è¿™ä»¶äº‹æ—¶ï¼Œæ˜¾ç„¶åº”ç”¨éƒ¨é—¨åº”è¯¥è€ƒè™‘ä»–çš„å¾®æœåŠ¡æ˜¯å¦éœ€è¦ä¸»åŠ¨å¤–è®¿ï¼Œéœ€è¦è®¿é—®å“ªäº›å¤–éƒ¨æœåŠ¡ã€‚ç„¶è€Œï¼Œå¦‚æœç”±åº”ç”¨å¼€å‘äººå‘˜è´Ÿè´£ï¼Œæ˜¯ä¸æ˜¯å¹³å°æˆ–å®‰å…¨éƒ¨é—¨å°±å¯ä»¥æ”¾æ‰‹ä¸ç®¡ï¼Ÿæ˜¾ç„¶ä¸æ˜¯ï¼Œåº”ç”¨å¼€å‘äººå‘˜æœ€å¤šæ˜¯ä¸ºå…¶æ‰€è´Ÿè´£çš„åº”ç”¨è®¾å®šå®‰å…¨ç­–ç•¥ï¼Œä¸åº”ç”¨æ— å…³çš„å…¨å±€æ€§åŸºç¡€å®‰å…¨ç­–ç•¥ï¼Œå¦‚ä½•å¿«é€Ÿè¡¥æ•‘åº”ç”¨å¼€å‘äººå‘˜è®¾å®šçš„é”™è¯¯ç­–ç•¥ï¼Œè¿™äº›ä¾ç„¶éœ€è¦ç”±å…¶ä»–å›¢é˜Ÿæ¥è´Ÿè´£ã€‚è€Œè¦æƒ³å¼€å‘éƒ¨é—¨èƒ½å¤Ÿè·µè¡Œå®‰å…¨å·¦ç§»çš„æ€æƒ³ï¼Œé‚£ä¹ˆ PlatformOps æˆ–å®‰å…¨éƒ¨é—¨åˆ™å¿…é¡»æä¾›å‹å¥½çš„å·¥å…·å¹¶å°†å®‰å…¨ç­–ç•¥çš„è®¾å®šé›†æˆåˆ° DevSecOps çš„ pipeline å½“ä¸­ï¼Œå¦‚æœå·¥å…·æˆ–æ–¹æ³•å¯¼è‡´å¼€å‘æ•ˆç‡ä¸‹é™ï¼Œå¼€å‘äººå‘˜å°†ä¸ä¹æ„å»ä½¿ç”¨ã€‚æ‰€ä»¥ï¼Œè¿™ä¸æ˜¯æŸä¸€ä¸ªéƒ¨é—¨çš„ç‹¬ç«‹å·¥ä½œï¼Œéœ€è¦å¤šå›¢é˜Ÿçš„åä½œæ¥ç¡®ä¿å®‰å…¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ•°æ®é©±åŠ¨&#34;&gt;æ•°æ®é©±åŠ¨&lt;/h3&gt;
&lt;p&gt;æ­£å¦‚æ–‡ç« å¼€å§‹æ‰€è¿°ï¼Œå®‰å…¨æ˜¯ä¸€ä¸ªæŒç»­å·¥ç¨‹åŒ–çš„å·¥ä½œï¼Œæ„å‘³ç€ä»»ä½•å‡ºå‘è®¿é—®è¡Œä¸ºä¸äº‹ä»¶éƒ½åº”è¢«è®°å½•åˆ°å®‰å…¨å·¥ç¨‹ç³»ç»Ÿä¸­è¿›è¡Œåˆ†æï¼Œä»¥ç¡®ä¿è¶³å¤Ÿçš„å¯è§æ€§å’Œæ´å¯Ÿã€‚å‡ºå‘å®‰å…¨ç®¡æ§ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç®€å•ç­–ç•¥è®¾å®šï¼Œéœ€å…·æœ‰å®Œæ•´æ—¥å¿—ã€è¡Œä¸ºã€äº‹ä»¶è¾“å‡ºçš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸šç•Œæ–¹æ¡ˆåˆ†æ&#34;&gt;ä¸šç•Œæ–¹æ¡ˆåˆ†æ&lt;/h2&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥é€ä¸€åˆ†æå½“å‰ä¸šç•Œå…³äºå‡ºå‘ç­–ç•¥ç®¡æ§çš„è§£å†³æ–¹æ¡ˆï¼Œé¦–å…ˆæˆ‘ä»¬å°†å…¶åˆ†ä¸º 6 å¤§ç±»æ–¹æ¡ˆï¼Œç„¶åå†é€ä¸€åˆ†æï¼š&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Category&lt;/th&gt;
          &lt;th&gt;Solutions or products&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;Platform based&lt;/td&gt;
          &lt;td&gt;Kubernetes Network policy&lt;br&gt;Openshift EgressIP&lt;br&gt;Openshift Egress Router pod&lt;br&gt;Openshift Egress Firewall&lt;br&gt;Openshift EgressNetworkPolicy&lt;/td&gt;
          &lt;td&gt;A specific feature of a platform provider&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;CNI based&lt;/td&gt;
          &lt;td&gt;Calico Egress pod&lt;br&gt;Calico Enhanced Network policy&lt;br&gt;Cilium Enhanced Network policy&lt;br&gt;Kube-ovn&lt;/td&gt;
          &lt;td&gt;The capability of CNI&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Service Mesh&lt;/td&gt;
          &lt;td&gt;NGINX Service Mesh&lt;br&gt;Istio&lt;/td&gt;
          &lt;td&gt;A function of Service Mesh&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Micro segmentation&lt;/td&gt;
          &lt;td&gt;PrismaNeu&lt;br&gt;Vector&lt;/td&gt;
          &lt;td&gt;From ZTA perspective or use enforcer container to control egress&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Fusion&lt;/td&gt;
          &lt;td&gt;F5 CES(Container Egress Service)&lt;br&gt;Fortinet&lt;/td&gt;
          &lt;td&gt;Use k8s native method to integrate exist security assets to k8s&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Others&lt;/td&gt;
          &lt;td&gt;DNS interception&lt;br&gt;Proxy pod&lt;/td&gt;
          &lt;td&gt;Intercept coredns or use a proxy pod as forward proxy&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;platform-based&#34;&gt;Platform based&lt;/h3&gt;
&lt;p&gt;kubernetes è‡ªå¸¦çš„ Network policyï¼Œè¿™æ˜¯æœ€å®¹æ˜“æƒ³åˆ°çš„å…³äºå‡ºå‘å®‰å…¨ç­–ç•¥ç®¡æ§æ–¹æ³•ã€‚å®ƒæ˜¯ k8s çš„è‡ªèº«èƒ½åŠ›ï¼Œå¯¹äºå¼€å‘è€…æˆ– PlatformOps äººå‘˜æ¥è¯´å…·æœ‰å¤©ç„¶çš„äº²å’Œæ€§ï¼Œèƒ½å¤Ÿå¾ˆå¥½çš„é€‚åº”å®‰å…¨å·¦ç§»çš„æ€æƒ³ã€‚ä½† Network policy éœ€ CNI æ”¯æŒã€‚å…¶å®ƒä¸€äº›ç¼ºç‚¹åœ¨äºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ²¡æœ‰é›†ç¾¤å…¨å±€æ€§çš„ç­–ç•¥èƒ½åŠ›ï¼Œä¸åŒ namespace ä¸‹è¦ç»´æŠ¤ç‹¬ç«‹çš„ policy&lt;/li&gt;
&lt;li&gt;æ²¡æœ‰ä»¥ k8s svc åç§°ä¸ºæ¡ä»¶çš„é€‰æ‹©èƒ½åŠ›ï¼ˆå¯æ”¹ä¸ºé€‰ pod æ ‡ç­¾ï¼Œä½†ä¸çµæ´»ï¼‰&lt;/li&gt;
&lt;li&gt;æ— æ˜¾å¼æ‹’ç»èƒ½åŠ›ï¼Œé€šè¿‡ç­–ç•¥çš„éš”ç¦»æ€§ç‰¹ç‚¹ï¼Œç„¶åæ–½åŠ å…·ä½“çš„ç™½åå•&lt;/li&gt;
&lt;li&gt;è§„åˆ™æ— ä¼˜å…ˆçº§æ¦‚å¿µ&lt;/li&gt;
&lt;li&gt;æ— æ˜ç¡®çš„é›†ç¾¤å¤–è®¿è§„åˆ™ï¼Œå¤–éƒ¨ç›®æ ‡æœåŠ¡åªèƒ½ä¾é å®½æ³›çš„ ipblock&lt;/li&gt;
&lt;li&gt;çº¯å››å±‚ï¼Œæ— ä¸ƒå±‚çš„æ§åˆ¶èƒ½åŠ›&lt;/li&gt;
&lt;li&gt;æ— ç­–ç•¥æ‰§è¡Œè°ƒè¯•èƒ½åŠ›&lt;/li&gt;
&lt;li&gt;æ— ç­–ç•¥æ‰§è¡Œæ—¥å¿—&lt;/li&gt;
&lt;li&gt;Networkpolicy çš„â€œéš”ç¦»æ€§â€ç‰¹ç‚¹ä½¿å¾—ç»´æŠ¤å·¥ä½œå˜å¾—åŠå…¶éº»çƒ¦ï¼Œä¾‹å¦‚ï¼Œæœ¬èº«åªæƒ³æ§åˆ¶å…¶å¯¹äº’è”ç½‘çš„è®¿é—®ï¼Œä½†å› ä¸ºéš”ç¦»æ€§ï¼Œå°±ä¸å¾—ä¸é¢å¤–ç»´æŠ¤è¯¥ pod åœ¨é›†ç¾¤å†…çš„æ‰€æœ‰å‡ºå‘ï¼ˆä¸œè¥¿å‘ï¼‰è®¿é—®&lt;/li&gt;
&lt;li&gt;ä¸èƒ½è§£å†³ k8s ä¸å¤–éƒ¨å®‰å…¨è®¾å¤‡ååŒé—®é¢˜ã€‚è¯•æƒ³ä¸€ä¸‹ï¼ŒNetwork policy åšäº†è§„åˆ™æ§åˆ¶åï¼Œé‚£ä¹ˆå¤–éƒ¨çš„å®‰å…¨è®¾å¤‡å°±å¯ä»¥ä¸ºè¯¥é›†ç¾¤æ‰“å¼€ä¸€ä¸ªé»˜è®¤é€šè¡Œçš„è§„åˆ™å—ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Openshiftï¼Œåœ¨ Egress æ–¹é¢æœ‰å››ä¸ªç‰¹æ€§ä¸ä¹‹æœ‰å…³ï¼Œåˆ†åˆ«æ˜¯æ ‡å‡†çš„ Network Policyï¼ŒEgress IPï¼ŒEgress Routerï¼ŒEgress Firewall ä»¥åŠ Egress NetworkPolicyã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Network Policyï¼Œå½“ Openshift ä½¿ç”¨ OVN-Kubernetes ä½œä¸º CNI æ—¶å®Œå…¨æ”¯æŒï¼Œè€Œä¼ ç»Ÿçš„ Openshift SDN CNI åˆ™ä»…æ˜¯éƒ¨åˆ†æ”¯æŒã€‚ä¸æ ‡å‡†çš„ kubernetes å¹¶æ— ä¸åŒï¼Œå…¶ä¼˜ç¼ºç‚¹è¿™é‡Œä¸å†åšé¢å¤–åˆ†æã€‚&lt;/li&gt;
&lt;li&gt;EgressIPï¼Œæ˜¯ç”¨æ¥å®ç° Pods æµé‡ç¦»å¼€é›†ç¾¤æ—¶å€™ä½¿ç”¨ç¡®å®šæ€§æº IP çš„ä¸€ç§åŠŸèƒ½ã€‚å½“ä½¿ç”¨ Openshift SDN CNI æ—¶ï¼Œè¯¥åŠŸèƒ½å°† Egress IP åº”ç”¨åˆ°æŒ‡å®šçš„ nodes ä¸Šä½œä¸º secondary IPï¼Œå¹¶ç”¨äº SNATã€‚å½“ä½¿ç”¨ OVN-kubernetes CNI æ—¶å€™ï¼Œåˆ™é€šè¿‡ OVS ä¸ºå…·ä½“çš„ pods æ‰§è¡Œ snat è§„åˆ™ã€‚ä½¿ç”¨ EgressIPï¼Œæœ¬èº«å¹¶ä¸æ˜¯å‡ºå‘å®‰å…¨ç­–ç•¥ç®¡æ§çš„ç›´æ¥æ–¹æ³•ï¼Œä½†æ˜¯å€ŸåŠ©ä¸ºä¸åŒçš„ namespace æŒ‡å®šç¡®å®šçš„æº IPï¼Œè¿™æ ·å¯ä»¥åœ¨é›†ç¾¤å¤–éƒ¨çš„å®‰å…¨è®¾å¤‡ä¸Šéƒ¨ç½²ä¸€äº›ç­–ç•¥æ¥æ‰§è¡Œæ§åˆ¶ã€‚æ˜¾è€Œæ˜“è§ï¼Œè¿™ç§ç­–ç•¥æ§åˆ¶æ–¹å¼æ¯”è¾ƒç²—æ”¾ï¼Œæ— æ³•åšåˆ°å¯¹ä¸åŒæœåŠ¡çš„ç²¾ç»†åŒ–ç²’åº¦ã€‚å¦‚æœ pods åˆ†æ•£åœ¨ä¸åŒçš„ nodes ä¸Šï¼Œåˆ™è¿˜ä¼šå­˜åœ¨ pods å‡ºé›†ç¾¤æµé‡è¦å…ˆåœ¨ä¸åŒ nodes ä¹‹é—´ç©¿è¶Šé—®é¢˜ï¼Œå¢åŠ äº†é¢å¤–çš„å»¶è¿Ÿã€‚æ­¤å¤–ï¼ŒEgressIP è¿˜å¿…é¡»ä¸ nodes çš„ä¸»ç½‘ç»œåœ°å€åŒå±ç›¸åŒç½‘æ®µï¼Œä¸”ä¸€ä¸ª node ä¸å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªä»¥ä¸Šçš„ EgressIPã€‚EgressIP ä¹Ÿä¸æ”¯æŒå…¬æœ‰äº‘ä»¥åŠ Redhat Openstack Platformã€‚&lt;/li&gt;
&lt;li&gt;Egress Router Podï¼Œå®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„ podï¼Œæ‹¥æœ‰ä¸¤ä¸ªç½‘å¡ï¼Œä½¿ç”¨ MacVlan æŠ€æœ¯å°†å…¶ä¸­ä¸€ä¸ªå®¹å™¨ç½‘å¡ä¸å¤–éƒ¨ç½‘ç»œç›´æ¥è¿é€šã€‚æ‰€æœ‰ pods å‡ºé›†ç¾¤æµé‡éƒ½ä¼šç»è¿‡è¯¥ podã€‚æ ¹æ®ä¸åŒçš„ CNIï¼ˆSDN æˆ– OVN-kubernetesï¼‰, å…·æœ‰çš„åŠŸèƒ½ä¹Ÿä¸åŒï¼Œåœ¨ OVN-kubernetes CNI ä¸‹ä»…æ”¯æŒé‡å®šå‘æ“ä½œã€‚ä¸€èˆ¬æ¥è¯´è¿™å¹¶ä¸é€‚åˆå¤§è§„æ¨¡ä½¿ç”¨ï¼Œä» Egress å®‰å…¨ç­–ç•¥è®¾å®šè§’åº¦ï¼Œè¿™ä¹Ÿä¾ç„¶æ— æ³•åŒºåˆ†ä¸åŒæœåŠ¡ï¼Œä¸”é›†ä¸­çš„ Egress pod å®¹æ˜“æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚&lt;/li&gt;
&lt;li&gt;EgressFirewallï¼Œå®ƒå®é™…æ˜¯ OVN-kubernetes çš„ç‰¹æ€§ã€‚å®¹è®¸ä¸ºæŸä¸ª project æˆ– namespace è®¾ç½®å‡ºå‘è®¿é—®è§„åˆ™ï¼Œå¯ä»¥åŸºäºåè®®ï¼Œç«¯å£ï¼ŒIPï¼ŒDNS ç­‰ç»´åº¦ã€‚åè®®ä»…æ”¯æŒ TCPï¼ŒUDPï¼ŒSCTP ä¸‰ç§ï¼Œæ— æ³•æ”¯æŒå…¶å®ƒåè®®æ§åˆ¶ã€‚å®ƒåªå®¹è®¸åŸºäº namespace çº§åˆ«è®¾å®šï¼Œä¸€ä¸ª namespace ä¸­åªå®¹è®¸è®¾ç½®ä¸€ä¸ªè§„åˆ™æ–‡ä»¶ï¼Œæ— æ³•ä¸ºé›†ç¾¤å†…çš„ä¸åŒ service æ¥è®¾å®šä¸åŒçš„ Egress è§„åˆ™ã€‚åŒæ—¶å®ƒé™åˆ¶æ¯ä¸ª namespace/project æœ€å¤§ 8000 æ¡è§„åˆ™ã€‚ä¹Ÿä¸æ”¯æŒå¯è§‚æµ‹æˆ–äº‹ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;Egress NetworkPolicyï¼Œä¸ EgressFirewall åŠŸèƒ½ç±»ä¼¼ï¼Œå½“é‡‡ç”¨ Openshift SDN CNI æ—¶å€™æ”¯æŒè¯¥ CRDã€‚ä½†æ˜¯ Egress NetworkPolicy å…·æœ‰æ›´å¤šçš„é™åˆ¶æ€§ï¼Œä¾‹å¦‚æ¯ä¸ª namespace/project æœ€å¤§æ”¯æŒ 1000 æ¡è§„åˆ™ï¼Œä¸”å¿…é¡»æ‰“å¼€ nework policy æˆ– multitennat æ¨¡å¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;cni-based&#34;&gt;CNI based&lt;/h3&gt;
&lt;p&gt;ä»¥ Calico å’Œ Cilium ä¸ºå…¸å‹ä»£è¡¨çš„ CNIï¼Œåœ¨æ ‡å‡† k8s Network Policy ä¸Šæ‰©å±•äº†éƒ¨åˆ†èƒ½åŠ›ï¼Œä¸»è¦è¡¨ç°åœ¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒå…¨å±€ç­–ç•¥ï¼ˆCalicoï¼ŒCiliumï¼‰&lt;/li&gt;
&lt;li&gt;DNS-based ç­–ç•¥æ”¯æŒï¼ˆCalico ä¼ä¸šï¼ŒCilium)&lt;/li&gt;
&lt;li&gt;L7 ä»… HTTP åè®®æ‰©å±•ï¼ˆCalicoï¼ŒCiliumï¼‰&lt;/li&gt;
&lt;li&gt;Logï¼ˆCalicoï¼ŒCiliumï¼‰&lt;/li&gt;
&lt;li&gt;æ‰©å±•ç­–ç•¥çš„åº”ç”¨å¯¹è±¡åˆ° pod ä»¥å¤–ï¼Œä¾‹å¦‚ node ç­‰ï¼ˆCalicoï¼ŒCiliumï¼‰&lt;/li&gt;
&lt;li&gt;å±‚æ¬¡åŒ–ç­–ç•¥ï¼Œè§’è‰²åŒ–è¾¹ç•Œè®¾å®šï¼ˆCalico ä¼ä¸šï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¦å®ç°è¿™äº›èƒ½åŠ›ï¼Œä¼ä¸šé¦–å…ˆéœ€ä½¿ç”¨è¿™äº› CNIã€‚éƒ¨åˆ†ä¼ä¸šç‰¹æ€§ï¼Œä¾‹å¦‚å±‚æ¬¡åŒ–ç­–ç•¥ä¸è§’è‰²è®¾å®šã€DNS æ”¯æŒç­‰éœ€è¦é¢å¤–è´­ä¹°æœåŠ¡ã€‚è¿™ä¼šé€ æˆç”¨æˆ· CNI æŠ€æœ¯é”å®šï¼Œä¸åˆ©äºå¤šäº‘åœºæ™¯éƒ¨ç½²ã€‚Calico åœ¨ä¸­å›½ä¹Ÿæ²¡æœ‰æœåŠ¡é”€å”®ï¼Œè¿™äº›éƒ½ä¼šé˜»ç¢å®¢æˆ·ä½“éªŒã€‚åœ¨ CNI ä¸Šé‡‡å–å¤æ‚çš„å®‰å…¨ç­–ç•¥ï¼Œä¼šå¯¼è‡´åœ¨é›†ç¾¤å†…éƒ¨åˆ›å»ºå¤§é‡å¤æ‚çš„è§„åˆ™ï¼Œé€ æˆæ’é”™å›°éš¾ï¼Œè¿ç»´æˆæœ¬å¢å¤§ã€‚å¤§é‡çš„è§„åˆ™ï¼Œä¹Ÿå¯èƒ½ä¼šå¯¼è‡´ç½‘ç»œæ€§èƒ½ä¸‹é™ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äº Calico Egress Podï¼Œæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ podï¼Œæ‹¥æœ‰å›ºå®šçš„å¯è·¯ç”±çš„ SNAT åœ°å€ï¼Œå½“ Egress æµé‡ä»è¯¥ä¸“ç”¨ pod æµå‡ºæ—¶ï¼Œæºå¸¦äº†ä¸“ç”¨å›ºå®šåœ°å€ï¼Œè¿™å®¹è®¸å¤–éƒ¨é˜²ç«å¢™ç­‰å®‰å…¨è®¾å¤‡åŸºäºè¯¥å›ºå®šåœ°å€è¿›è¡Œç­–ç•¥è®¾å®šã€‚å…¶è¡Œä¸ºä¸Šä¸ Openshift çš„ Egress Router pod ç±»ä¼¼ï¼Œä» Egress å®‰å…¨ç­–ç•¥è®¾å®šè§’åº¦ï¼Œå®ƒæ— æ³•ä¸ºä¸åŒæœåŠ¡æ‰§è¡Œç»†ç²’åº¦çš„å®‰å…¨ç­–ç•¥è®¾å®šæˆ–æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;service-mesh&#34;&gt;Service Mesh&lt;/h3&gt;
&lt;p&gt;Service Mesh å¹¶ä¸æ˜¯ Egress æµé‡ç®¡æ§çš„ä¸“é—¨æ–¹æ¡ˆï¼Œå› æ­¤è¦é€šè¿‡ Service Mesh å®ç° Egress çš„ç®¡æ§æ„å‘³ç€é¦–å…ˆéœ€è¦éƒ¨ç½²æ•´ä½“ Service Mesh æ–¹æ¡ˆï¼Œæ¯”å¦‚ Istioã€‚å¦‚æœä»…ä»…æ˜¯ä¸ºäº†å®ç° Egress çš„ç®¡æ§ï¼Œè¿™æ ·çš„æ–¹æ¡ˆä¼šæ˜¾å¾—è¾ƒé‡ã€‚Service Mesh æ‰€æ”¯æŒçš„åè®®èŒƒå›´ä¹Ÿè¾ƒå°‘ï¼Œè¿™å¯¹äºä¼ä¸šçš„å®‰å…¨ç­–ç•¥æ¥è¯´è¿˜ä¸è¶³å¤Ÿã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Istio ä¸­ï¼Œå½“è®¾ç½® meshConfig.outboundTrafficPolicy.mode ä¸º REGISTRY_ONLY åï¼Œå¯ä»¥é€šè¿‡ sidecar ç»“åˆ ServiceEntry èµ„æºå®ç°å¤–éƒ¨æœåŠ¡è®¿é—®çš„ç™½åå•ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ç»“åˆ Egress Gateway å°†æµé‡å¯¼å‘åˆ°ä¸“é—¨çš„ Egress Gatewayã€‚ç›¸æ¯”äº ServiceEntry æ–¹æ³•ï¼ŒEgress Gateway åˆ™ç»“åˆäº† VirtualService å’Œ DestinationRule æ¥å®ç°æ›´å¤šçš„æ§åˆ¶ï¼Œé…åˆ AuthorizationPolicy åˆ™å¯ä»¥æ§åˆ¶ç²’åº¦æ›´ç»†ä¸€äº›ã€‚&lt;/p&gt;
&lt;p&gt;æ— è®ºå“ªç§æ–¹å¼ï¼Œéƒ½å¿…é¡»ä¾èµ– sidecar è¿›è¡Œæµé‡çš„åŠ«æŒï¼Œå¦‚æœæœ‰å¨èƒç»•å¼€æˆ–ç ´åäº† sidecarï¼Œåˆ™æ„å‘³ç€æœ‰å®³è®¿é—®å¯ä»¥ç›´æ¥ç»•å¼€ç®¡æ§ï¼Œè¿™ä¸ªå®‰å…¨é—®é¢˜åœ¨ Istio çš„æ–‡æ¡£ä¸­è¢«åå¤æåŠã€‚æ‰€ä»¥æœ¬è´¨ä¸Šæ¥è¯´å®ƒä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ Egress æµé‡ç®¡æ§æ–¹æ¡ˆã€‚åŒæ—¶ï¼ŒService Mesh çš„æ€ç»´æ›´å¤šæ˜¯é¢å‘å¼€å‘è€…ï¼ˆå°½ç®¡å®ƒå¸¸å¸¸ä½“ç°çš„æ˜¯å¹³å°å±‚é¢çš„èƒ½åŠ›ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¾ç„¶éœ€è¦å›ç­”è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šå½“å¼€å‘è€…è®¾ç½®äº†å¤–éƒ¨æœåŠ¡è®¿é—®ç™½åå•åï¼Œé›†ç¾¤å¤–éƒ¨æ˜¯å¦å°±å¯ä»¥ä¿¡ä»»å¼€å‘è€…è¿™æ ·çš„è®¾ç½®ï¼Œå¤–éƒ¨å®‰å…¨è®¾å¤‡æ˜¯å¦å°±å¯ä»¥è®¾ç½®ä¸ºå®¹è®¸é›†ç¾¤çš„ä»»æ„å¤–éƒ¨è®¿é—®ï¼Ÿ&lt;/p&gt;
&lt;h3 id=&#34;micro-segmentation&#34;&gt;Micro Segmentation&lt;/h3&gt;
&lt;p&gt;å¾®åˆ†æ®µä¸€èˆ¬æ˜¯ Zero Trust Architecture (ZTA) é¢†åŸŸçƒ­è¡·çš„æ¦‚å¿µï¼Œé€šè¿‡æŠ€ä¸€äº›æŠ€æœ¯ï¼ˆå¦‚ TCï¼ŒIPtablesï¼ŒDPIï¼‰å¯¹åº•å±‚æµé‡è¿›è¡Œæ¢æŸ¥ã€æ“çºµä¸æ§åˆ¶ï¼Œå®ç°å¯¹å®¹å™¨å†…è¿›ç¨‹ã€å®¹å™¨é—´é€šä¿¡ã€å®¹å™¨ä¸é›†ç¾¤å¤–çš„é€šä¿¡çš„å¯è§†åŒ–ä¸ç­–ç•¥æ§åˆ¶ã€‚ä¸€èˆ¬æ¥è¯´ä¼šåœ¨é›†ç¾¤çš„å„ä¸ªä¸»æœºä¸Šå®‰è£… DaemonSet ç±»å®¹å™¨å®ç°å¯¹åº•å±‚æµé‡çš„æ¢æŸ¥ã€‚æ­¤ç±»æ–¹æ¡ˆå¯ä»¥åŸºäºè¾ƒç»†çš„ç²’åº¦è¿›è¡Œ Egress ç­–ç•¥æ§åˆ¶ï¼Œä¾‹å¦‚å¯¹å“ªäº›åº”ç”¨ç›¸å…³ pods é€šè¿‡å“ªäº›åè®®è®¿é—®å“ªäº›å¤–éƒ¨æœåŠ¡ï¼Œäº¦å¯é€‰æ‹©è¯¸å¦‚ Service account æˆ– Label ç­‰è¦ç´ ã€‚å¯¹äºåº”ç”¨å±‚åŠ å¯†æ•°æ®ï¼Œå¦‚æœæ˜¯ Istio ç¯å¢ƒåˆ™å¯é€šè¿‡æ¢æŸ¥ sidecar ä¸åº”ç”¨å®¹å™¨ä¹‹é—´æµé‡å®ç°æ˜æ–‡æ¢æŸ¥ï¼›å¦‚æœæ˜¯åº”ç”¨å®¹å™¨è‡ªèº«ç›´æ¥åŠ å¯†åˆ™æ— æ³•å®ç°æ¢æŸ¥ï¼Œä½†å¯ä»¥é€šè¿‡ç»“åˆ DNS è§£æã€SNI å®ç°ä¸€å®šç¨‹åº¦ä¸Šçš„ç­–ç•¥ç®¡æ§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;fusion&#34;&gt;Fusion&lt;/h3&gt;
&lt;p&gt;ä¸Šè¿°çš„å¤šç§ç±»å‹æ–¹æ¡ˆï¼Œä¸»è¦åˆ‡å…¥ç‚¹æ˜¯åœ¨é›†ç¾¤å†…ã€‚åœ¨å®¢æˆ·çš„å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œkubernetes é›†ç¾¤æ˜¯ä¸€ç§èµ„æºæ€§å¯¹è±¡ï¼Œä»ä¼ä¸šæ•´ä½“å®‰å…¨è§’åº¦æ¥çœ‹ï¼Œå¤–éƒ¨å®‰å…¨è®¾å¤‡ä¾ç„¶æœ‰å¿…è¦å¯¹ kubernetes é›†ç¾¤çš„å‡ºå‘æµé‡è¿›è¡Œç®¡æ§ã€‚è®©å¤–éƒ¨å®‰å…¨è®¾å¤‡ä¸ kubernetes é›†ç¾¤èåˆï¼Œå…¶éš¾ç‚¹åœ¨äºï¼Œä¼ ç»Ÿå®‰å…¨è®¾å¤‡ä¸æ˜¯ç›´æ¥é¢å‘ kubernetes è®¾è®¡ã€‚é«˜åŠ¨æ€æ€§ã€IP æ— å…³æ€§ä¼šæˆä¸ºä¼ ç»Ÿè®¾å¤‡è¿›è¡Œ kubernetes å‡ºå‘æµé‡ç®¡æ§çš„éš¾ç‚¹ã€‚ä½†è¿™å¹¶ä¸æ˜¯æ— æ³•è§£å†³çš„æŠ€æœ¯éš¾é¢˜ï¼Œå¦‚æœå¤–éƒ¨å®‰å…¨è®¾å¤‡å…·æœ‰è¾ƒå¥½çš„ API æ¥å£ï¼Œé€šè¿‡ä¸“é—¨è®¾è®¡çš„æ§åˆ¶å™¨åˆ™å¯ä»¥è§£å†³ä¸Šè¿°æŠ€æœ¯éš¾é¢˜ã€‚è¿™æ ·ï¼Œå¤–éƒ¨å®‰å…¨é˜²æŠ¤çš„æªæ–½ä¾¿å¯ä»¥åº”ç”¨åˆ° kubernetes é›†ç¾¤ä¸Šæ¥ï¼Œå½¢æˆå®Œæ•´çš„çºµæ·±é˜²å¾¡ä½“ç³»ã€‚åŒæ—¶å¯ä»¥ä¿æŠ¤ä¼ä¸šå·²æœ‰æŠ•èµ„ï¼ŒèŠ‚çº¦æˆæœ¬ã€‚é€šè¿‡é¢å‘ kubernetes çš„è‡ªå®šä¹‰èµ„æºç±»å‹è®¾è®¡ï¼Œè´Ÿè´£å¤–éƒ¨å®‰å…¨è®¾å¤‡çš„å›¢é˜Ÿä¹Ÿå› æ­¤å¯ä»¥ä»‹å…¥åˆ° kubernetes é›†ç¾¤çš„æ•´ä½“å®‰å…¨å·¥ä½œä¸­æ¥ï¼Œé¿å…äº†å›¢é˜Ÿçš„å‰²è£‚ã€‚&lt;/p&gt;
&lt;p&gt;F5 çš„ Application Firewall Manager (AFM) é€šè¿‡ä¸“ç”¨çš„å…è´¹æ§åˆ¶å™¨ï¼ˆCESï¼‰å®ç°äº†ä»¥ kubernetes åŸç”Ÿè‡ªå®šä¹‰èµ„æºï¼ˆCRDï¼‰æ–¹å¼è¿›è¡Œ Egress ç­–ç•¥çš„æ§åˆ¶ï¼Œå¹¶å®ç°äº†å®‰å…¨è§„åˆ™ä¸è§’è‰²çš„å±‚æ¬¡åŒ–è®¾å®šï¼Œè®©å®‰å…¨è®¾å¤‡ç®¡ç†å‘˜èåˆåˆ°äº† kubernetes å¹³å°ã€‚å€ŸåŠ© AFM çš„èƒ½åŠ›ï¼Œå¯å®ç° Egress æµé‡çš„é«˜çº§è®¿é—®è§„åˆ™ã€é™æµã€åè®®æ£€æŸ¥ã€æ—¥å¿—ä¸äº‹ä»¶å¯è§†åŒ–ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;Fortinet è‡ªèº«ä»¥åŠä¸ Calico ä¼ä¸šç‰ˆè”åˆï¼Œä¹Ÿå®ç°äº†ä¸ kubernetes çš„é›†æˆï¼Œä½†å…¶ä¸»è¦ç‰¹ç‚¹æ˜¯å°† kubernetes èµ„æºå¯¹è±¡è½¬åŒ–å¹¶å†™å…¥ Fortinet çš„åœ°å€ç»„ä¸­ï¼Œå…¶ç®¡ç†è§†è§’ä¾ç„¶æ˜¯é˜²ç«å¢™ç®¡ç†å‘˜è§†è§’ï¼Œè€Œä¸æ˜¯ kubernetes native æ–¹å¼ã€‚&lt;/p&gt;
&lt;h3 id=&#34;others&#34;&gt;Others&lt;/h3&gt;
&lt;p&gt;Proxy pod æ˜¯ä¸€ç§æ™®é€šçš„æ­£å‘ä»£ç†ï¼Œåº”ç”¨ä½¿ç”¨è¯¥ä»£ç†å®ç°å¯¹å¤–éƒ¨ä¸šåŠ¡çš„è®¿é—®ã€‚æ­¤ç§æ–¹å¼ä¸€èˆ¬ä»…é€‚åˆå°è§„æ¨¡åœºæ™¯ï¼Œä¸é€‚åˆå¤§è§„æ¨¡é›†ç¾¤åŠå¤æ‚ä¸šåŠ¡ã€‚DNS interceptionï¼Œå…¶åŸç†æ˜¯é€šè¿‡ patch corednsï¼Œå¦‚æœåº”ç”¨è®¿é—® ExternalService å¯¹è±¡ä¸­è®¾å®šçš„å¤–éƒ¨æœåŠ¡ï¼Œåˆ™å°†è¯·æ±‚å¼•å¯¼åˆ°ä¸€ä¸ªä¸“ç”¨çš„ proxy pod ä¸Šï¼ˆä¾‹å¦‚ Envoy ç­‰ï¼‰å®ç°å¯¹æµé‡çš„å¤„ç†ã€‚è¯¥æ–¹æ¡ˆåŒæ ·ä¸é€‚åˆå¤§è§„æ¨¡åœºæ™¯ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å®Œæˆå¯¹ä¸Šè¿° 6 ç±» Egress æµé‡ç®¡æ§æ–¹æ¡ˆçš„åˆ†æåï¼Œè®©æˆ‘ä»¬æ¥æ€»ç»“å’Œå¯¹æ¯”ä¸€ä¸‹è¿™äº›æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æ–¹æ¡ˆç‰¹æ€§æ¯”è¾ƒ&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;æ–¹æ¡ˆç‰¹æ€§æ¯”è¾ƒ&#34; srcset=&#34;
               /blog/egress-for-k8s/solutions-comparison_hu9170336069257629228.webp 400w,
               /blog/egress-for-k8s/solutions-comparison_hu4707590452245805263.webp 760w,
               /blog/egress-for-k8s/solutions-comparison_hu17144274194584100008.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/egress-for-k8s/solutions-comparison_hu9170336069257629228.webp&#34;
               width=&#34;760&#34;
               height=&#34;236&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æ–¹æ¡ˆç‰¹æ€§æ¯”è¾ƒ
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡º Network Policy è™½ç„¶æ˜¯ä¸€ä¸ª kubernetes åŸç”Ÿçš„æ–¹å¼ï¼Œä½†æ˜¾ç„¶å¹¶ä¸é€‚åˆäºé›†ç¾¤ Egress æµé‡çš„ç®¡æ§ã€‚CNI ç±»äº§å“æœ‰äº†ä¸€å®šçš„å¢å¼ºï¼Œä½†æ˜¯åœ¨åè®®æ£€æµ‹ã€ä¼ä¸šçº§æ”¯æŒæ–¹é¢è¿˜æ˜¯ä¸å¤Ÿã€‚å¾®åˆ†æ®µç±»äº§å“å…·æœ‰ç›¸å¯¹å®Œæ•´çš„èƒ½åŠ›ï¼Œä½†æ˜¯å¾®åˆ†æ®µæ˜¯ä¸€ä¸ªæ•´ä½“æ€§çš„è§£å†³æ–¹æ¡ˆï¼Œä»…ä»…ä½¿ç”¨å¾®åˆ†æ®µå®ç°é›†ç¾¤å‡ºå‘æµé‡çš„ç®¡æ§ä¼šæ˜¾å¾—æŠ•å…¥è¾ƒå¤§ï¼Œä¸”å¾®åˆ†æ®µçš„äº§å“ä¸€èˆ¬åº•å±‚æŠ€æœ¯è¾ƒä¸ºå¤æ‚ï¼Œè¿ç»´éš¾åº¦è¾ƒé«˜ã€‚å°†å¤–éƒ¨å®‰å…¨è®¾æ–½èå…¥åˆ° kubernetes å½“ä¸­å®ç°å‡ºå‘æµé‡ç®¡æ§çš„è§£å†³æ–¹æ³•æ›´åŠ é€‚åˆä¼ä¸šï¼Œæ— è®ºæ˜¯åŠŸèƒ½ç‰¹æ€§è¿˜æ˜¯è¿ç»´å¤æ‚åº¦éƒ½æ¯”è¾ƒé€‚åˆï¼Œæ›´åŠ é‡è¦çš„æ˜¯ï¼Œè¯¥ç±»æ–¹æ¡ˆå°†ä¼ä¸šçš„ä¼ ç»Ÿå®‰å…¨èµ„äº§ä¸ç°ä»£åº”ç”¨æ¶æ„è¿›è¡Œäº†ç»“åˆï¼Œè®©ä¸åŒéƒ¨é—¨èƒ½å¤Ÿç´§å¯†ååŒï¼Œå½¢æˆçºµæ·±é˜²å¾¡ä½“ç³»ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å¾€å¾€é‡è§† Ingress çš„èƒ½åŠ›ï¼Œè€Œå¿½è§†äº† Egress æµé‡çš„å®‰å…¨ç®¡æ§ã€‚ä½†æ— è®ºä»å®‰å…¨è¿˜æ˜¯åˆè§„çš„è§’åº¦ï¼ŒEgress æµé‡éƒ½åº”åŠ å¼ºç®¡æ§ã€‚å½“æ¼æ´å·²ç»ä¾µå…¥åº”ç”¨åï¼ŒEgress æµé‡ç®¡æ§å¾€å¾€æ˜¯æœ€åä¸€ä¸ªä¿æŠ¤çš„å…³å£ã€‚åœ¨ä¸Šå½“å‰ä¼—å¤šæ–¹æ¡ˆä¸­ï¼Œå¤§éƒ¨åˆ†çš„æ–¹æ¡ˆæ˜¯åŸºäº kubernetes å†…çš„ Network Policy å®ç°ï¼Œæœ‰çš„ä¾èµ–äºç‰¹å®šçš„ CNIï¼Œæœ‰çš„ä¾èµ–äºç‰¹å®šçš„ç¼–æ’å¹³å°ã€‚ä½†å½“æˆ‘ä»¬ä»ä¼ä¸šçš„æ•´ä½“å®‰å…¨æ¶æ„å»è€ƒè™‘æ—¶ï¼Œå°†å¤–éƒ¨å®‰å…¨è®¾å¤‡å¼•å…¥åˆ° kubernetes å®‰å…¨ä½“ç³»å½“ä¸­ä¸€ä»¶éå¸¸å¿…è¦çš„äº‹æƒ…ï¼Œåªæœ‰è¿™æ ·æ‰èƒ½å®ç°çœŸæ­£çš„å…¨é¢é˜²å¾¡ã€‚è€Œå½“æˆ‘ä»¬è®¨è®º DevSecOps æ—¶ï¼Œéœ€è¦è®©å¼€å‘ã€å¹³å°ã€å®‰å…¨ä¹ƒè‡³ç½‘ç»œè¿™äº›ä¸åŒå›¢é˜ŸåŒæ—¶å‚ä¸åˆ°æ•´ä½“å®‰å…¨å·¥ä½œä¸­ï¼Œå®ç°è·¨å›¢é˜Ÿçš„ç´§å¯†åä½œã€‚å…³äº F5 CES æ–¹æ¡ˆæ˜¯å¦‚ä½•å®ç° kubernetes Egress æµé‡å®‰å…¨ç®¡æ§ï¼Œä»¥åŠå¦‚ä½•å®ç°ä¸åŒå›¢é˜Ÿç´§å¯†åä½œï¼Œè¯·çœ‹è€ƒ &lt;a href=&#34;https://github.com/f5devcentral/container-egress-service&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Github CES é¡¹ç›®&lt;/a&gt;ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes çœŸçš„èƒ½æä¾›å¤šäº‘å¯ç§»æ¤æ€§å—ï¼Ÿ</title>
      <link>https://cloudnativecn.com/blog/does-kubernetes-really-give-you-multicloud-portability/</link>
      <pubDate>Wed, 23 Nov 2022 09:16:27 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/does-kubernetes-really-give-you-multicloud-portability/</guid>
      <description>&lt;p&gt;ä» 2017 å¹´èµ·æˆ‘ä»¬å°±å¼€å§‹ä¸ Kubernetes ç¤¾åŒºåˆä½œï¼Œå°† Kubernetes ä½œä¸ºåç«¯å®¹å™¨ç¼–æ’å¹³å°ï¼Œå°†æ— æ•°åº”ç”¨ç¨‹åºè¿ç§»åˆ°äº‘ç«¯ã€‚å…¶ä¸­æœ‰äº›è¿ç§»è¿›å±•é¡ºåˆ©ï¼Œè€Œå¦ä¸€äº›åˆ™é¢‡å…·æŒ‘æˆ˜æ€§ã€‚åŒæ ·ï¼Œæˆ‘ä»¬åˆ©ç”¨äº‘æœåŠ¡æä¾›å•†ï¼ˆCSPï¼‰çš„æœ¬åœ°å®¹å™¨ç¼–æ’è§£å†³æ–¹æ¡ˆæ¥æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œåœ¨æ˜“äºè¿ç§»çš„æƒ…å†µä¸‹è·å¾—äº†ç±»ä¼¼çš„ç»“æœã€‚æœ¬æ–‡æ— æ„è®¨è®ºè¿™äº›ç»éªŒï¼Œä¹Ÿæ— æ„è¯´æ˜ä¸€ç§æŠ€æœ¯èƒœè¿‡å¦ä¸€ç§æŠ€æœ¯ï¼Œè€Œæ˜¯è®¨è®ºä¸šåŠ¡é¢†å¯¼è€…å’Œæ¶æ„å¸ˆé€‰æ‹©åˆ©ç”¨ Kubernetes çš„åŸå› ã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ®æˆ‘ä»¬çš„ç»éªŒï¼Œæ ¹æ®ä½ çš„ç»„ç»‡ç»“æ„å’Œè¿è¥æ¨¡å¼ï¼Œå¤§è§„æ¨¡åˆ©ç”¨ Kubernetes æ¯”åˆ©ç”¨å…¶ä»– CSP åŸç”Ÿè§£å†³æ–¹æ¡ˆï¼Œå¦‚ AWS Elastic Container Serviceï¼ˆECSï¼‰ã€AWS Batchã€Lambdaã€Azure App Serviceã€Azure Functions æˆ– Google Cloud Run çš„å¼€é”€æ›´å¤§ã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes æ˜¯ä¸€ç§å¼€æºå®¹å™¨ç¼–æ’å¼•æ“ï¼Œå…¶æœ¬è´¨æ—¨åœ¨åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œã€‚å®ƒçš„æ¶æ„åœ¨å¦‚ä½•é€šè¿‡æœ¬åœ°ä½¿ç”¨æ’ä»¶å’Œæ‰©å±•æ¥å®ç°è¿™ç§å¯ç§»æ¤æ€§æ–¹é¢éå¸¸å‡ºè‰²ã€‚ä½†æ˜¯ï¼Œ&lt;strong&gt;è¿™æ˜¯é›†ç¾¤è¿ç»´çš„è´£ä»»&lt;/strong&gt;ï¼Œç”±ä»–ä»¬æ¥ç®¡ç†å’Œæ“ä½œè¿™äº›æ’ä»¶ã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒæŸäº›æœåŠ¡ï¼ˆå¦‚ EKSã€GKE å’Œ AKSï¼‰æ­£åœ¨åŠªåŠ›æ”¹å–„è¿™ç§ä½“éªŒã€‚å³ä½¿é‚£æ ·ï¼Œä½ ä¹Ÿå¿…é¡»é€‰æ‹©ä½ çš„ Kubernetes ç‰ˆæœ¬ï¼Œå®‰è£…å’Œé…ç½®æ’ä»¶ï¼Œå¹¶ç¡®ä¿ä½ çš„éƒ¨ç½²æ¸…å•ã€åº”ç”¨ç¨‹åºæ¥å£å’Œ Kubernetes é›†ç¾¤å…¬å¼€çš„ API ä»¥åŠè¿™äº›æ’ä»¶ä¹‹é—´çš„å…¼å®¹æ€§ã€‚æˆ‘ä»¬çŸ¥é“è¿™æ˜¯å¤§å¤šæ•°ä¼ä¸šçš„â€œæ­£å¸¸â€ç»´æŠ¤ï¼Œä¸ä¼šå“è·‘ä»–ä»¬ï¼Œä½†æˆ‘ä»¬æƒ³é—®é—®ä¸ºä»€ä¹ˆã€‚ä½ ä¸ºä»€ä¹ˆè¦æ‰¿æ‹…è¿™é¡¹ç»´æŠ¤å·¥ä½œï¼Ÿå½“ CSP åŸç”Ÿè§£å†³æ–¹æ¡ˆä¿æŒå…¶ API çš„å‘åå…¼å®¹æ€§æ¯” Kubernetes é•¿å¤šå¹´æ—¶ï¼Œä¸ºä»€ä¹ˆè¦è´Ÿæ‹…è¿™éƒ¨åˆ†å¼€é”€ï¼Ÿå½“æˆ‘ä»¬æ¨åŠ¨è¿™ä¸ªè¯é¢˜æ—¶ï¼Œæœ€å¸¸è§çš„ååº”æ˜¯ä¸šåŠ¡é¢†å¯¼è€…å’Œæ¶æ„å¸ˆæ‹…å¿ƒä¾›åº”å•†é”å®šå’Œ / æˆ–è®¤ä¸ºä»–ä»¬çš„åº”ç”¨ç¨‹åºå¿…é¡»åœ¨å¤šä¸ª CSP ä¸­ç§¯æè¿è¡Œã€‚ä½†æ˜¯ï¼Œè¿™äº›ç›¸åŒçš„ç»„ç»‡ä¸­çš„å¤§å¤šæ•°æ­£åœ¨ä¸ºå…¶æ•°æ®åº“åˆ©ç”¨ CSP åŸç”Ÿè§£å†³æ–¹æ¡ˆï¼Œå¹¶ä¸”åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸ºå…¶æœªå¼€å‘çš„åº”ç”¨ç¨‹åºåˆ©ç”¨å‡½æ•°å³æœåŠ¡ï¼ˆFaaSï¼‰åŠŸèƒ½ã€‚å¦‚æœä¸€å®¶å…¬å¸çœŸçš„æ‹…å¿ƒä¾›åº”å•†é”å®šåˆ°è¿™ä¸ªæ°´å¹³ï¼Œå®ƒåº”è¯¥å®Œå…¨ä¾èµ– Kubernetesï¼Œè¿è¡Œè‡ªå·±çš„æ•°æ®åº“ï¼Œå¹¶æ‰˜ç®¡æ‰€æœ‰è‡ªå·±çš„å·¥å…·å’Œç³»ç»Ÿï¼Œè€Œä¸æ˜¯å®Œå…¨åˆ©ç”¨ CSP åŸç”Ÿè§£å†³æ–¹æ¡ˆã€‚åˆ©ç”¨ FaaS ä¸ºå…¶æ–°å»ºåº”ç”¨ç¨‹åºæä¾›æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äº›è¡Œä¸šï¼ˆé«˜ç§‘æŠ€ï¼‰å¯èƒ½éœ€è¦å·¥ç¨‹èƒ½åŠ›æ‰èƒ½åœ¨è¿™ä¸ªçº§åˆ«æˆ–è§„æ¨¡ä¸Šè¿è¡Œ Kubernetesï¼Œä½†å¤§å¤šæ•°è¡Œä¸šï¼ˆé“¶è¡Œã€æ±½è½¦ã€åˆ¶é€ ç­‰ï¼‰é€šå¸¸æ²¡æœ‰ç›¸åŒçš„ä¸šåŠ¡é©±åŠ¨å› ç´ ã€‚å¦‚æœä½ å‘ç°è‡ªå·±èº«å¤„è¿™æ ·çš„è¡Œä¸šï¼Œå¹¶å¸Œæœ›æœ€å¤§é™åº¦åœ°å‘æŒ¥äº‘æ‰€èƒ½å¸¦æ¥çš„ä»·å€¼ï¼Œé‚£ä¹ˆæœ¬æ–‡é€‚åˆä½ ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å®éªŒçš„ç»“æœï¼ˆè¯¦è§ä¸‹æ–‡ï¼‰è¡¨æ˜ï¼Œç»™å®šä¸€ä¸ªåº”ç”¨ç¨‹åºè®¾è®¡ä¸ºåœ¨ä¸€ä¸ª CSP çš„æ‰˜ç®¡ Kubernetes ä¸­è¿è¡Œå¹¶ä¸å…¶ä»– CSP çš„æœåŠ¡ï¼ˆä¾‹å¦‚ DNSã€LBã€æ•°æ®åº“ç­‰ï¼‰é›†æˆï¼Œå®ƒä¸å°†è¯¥åº”ç”¨ç¨‹åºè¿ç§»åˆ°å¦ä¸€ä¸ª CSP ç®¡ç†çš„ Kubernetes çš„åŠªåŠ›ï¼Œå°±åƒå°†è¯¥åº”ç”¨ç¨‹åºè¿ç§»åˆ°å¦ä¸€ä¸ª CSP çš„åŸç”Ÿå®¹å™¨ç¼–æ’æœåŠ¡ä¸€æ ·ã€‚æ ¹æ®æˆ‘ä»¬çš„è°ƒæŸ¥ç»“æœï¼Œæˆ‘ä»¬è®¤ä¸ºï¼Œé‚£äº›ä»…ä»…ä¸ºäº†æœªæ¥çš„å¯ç§»æ¤æ€§è€Œé»˜è®¤ä½¿ç”¨ Kubernetes çš„ç»„ç»‡æ­£åœ¨é™åˆ¶äº‘å¯ä»¥ä¸ºä»–ä»¬æä¾›çš„ä»·å€¼ï¼Œå°¤å…¶æ˜¯è€ƒè™‘åˆ°å¤§é‡æ›´å¹¿æ³›çš„æŠ€æœ¯é©±åŠ¨å› ç´ åœ¨èµ·ä½œç”¨ã€‚å¯¹äºè¦æœ€å¤§åŒ–äº‘ä»·å€¼çš„ç»„ç»‡ï¼Œä»–ä»¬åº”è¯¥åˆ©ç”¨å¯ç”¨äºç»™å®šå·¥ä½œè´Ÿè½½çš„æœ€é«˜é˜¶ CSP åŸç”Ÿäº‘æœåŠ¡ï¼Œ&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8eugkjya9j30u010jmzp_hu438996247486696642.webp 400w,
               /blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8eugkjya9j30u010jmzp_hu3189636900338231401.webp 760w,
               /blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8eugkjya9j30u010jmzp_hu13486746842221680381.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8eugkjya9j30u010jmzp_hu438996247486696642.webp&#34;
               width=&#34;624&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;æœ¬å®éªŒ&#34;&gt;æœ¬å®éªŒ&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬çš„å·¥ä½œå‡è®¾æ‰˜ç®¡ Kubernetes æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œåº”ç”¨ç¨‹åºæ¶æ„å’Œæ•°æ®å¼•åŠ›éƒ½æ˜¯äº‘è¿ç§»çš„æœ€å¤§å› ç´ ã€‚åœ¨æŸäº›åœºæ™¯ä¸‹ï¼ŒKubernetes æ˜¯å”¯ä¸€çš„é€‰æ‹©ï¼Œä¾‹å¦‚æ— æ³•åœ¨ Google Cloud Run å’Œ Azure App Service ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚å¹¶éæ‰€æœ‰ CSP éƒ½æä¾›å¯ä»¥ä»¥ä¸ Kubernetes ç±»ä¼¼çš„æ–¹å¼ç¼–æ’å®¹å™¨çš„æœåŠ¡ â€”â€” ç›¸åï¼Œè¿™äº› CSP é€‰æ‹©æä¾›æ‰˜ç®¡ Kubernetesã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸ä¼šåˆ†æå±äºæ­¤ç±»çš„å·¥ä½œè´Ÿè½½ï¼Œå› ä¸ºå¦‚æœç¡®å®éœ€è¦å¤šäº‘ï¼Œå®ƒä»¬å¾ˆå¯èƒ½é»˜è®¤å±äº Kubernetesã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºæˆ‘ä»¬çš„å®éªŒï¼Œæˆ‘ä»¬é€‰æ‹©äº†ä¸€ä¸ªç”± Google å‘å¸ƒçš„ 12-factor åº”ç”¨ç¨‹åºï¼Œç§°ä¸º &lt;a href=&#34;https://github.com/GoogleCloudPlatform/microservices-demo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;microservices-demo&lt;/a&gt;ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†åº”ç”¨ç¨‹åºç½®äºè°·æ­Œäº‘çš„ GKEã€Azure AKSã€AWS EKS å’Œ AWS ECS ä¸­ï¼Œå¹¶æµ‹é‡äº†ä½¿ç”¨ Kubernetes åœ¨æ‰€æœ‰ä¸‰ä¸ª CSP ä¹‹é—´è¿ç§»å·¥ä½œè´Ÿè½½çš„å·¥ä½œé‡ï¼Œä»¥åŠå°†å·¥ä½œè´Ÿè½½ä» Google GKE è¿ç§»åˆ° AWS ECS çš„å·¥ä½œé‡ã€‚å·¥ç¨‹å·¥ä½œçš„ç»“æœè¯¦è¿°å¦‚ä¸‹ï¼Œè®°å½•çš„å¤§éƒ¨åˆ†å·¥ä½œæ˜¯åœ¨åˆå§‹ç³»ç»Ÿè®¾ç½®ä¸­ã€‚æˆ‘ä»¬è®¤ä¸ºï¼Œæ‰€æœ‰ä¸‰ç§è®¡ç®—è§£å†³æ–¹æ¡ˆçš„è¿›ä¸€æ­¥è¿ç§»å°†å¤§å¤§ç¼©çŸ­ï¼Œä½†è®¡ç®—è§£å†³æ–¹æ¡ˆä¹‹é—´ä¹Ÿæ²¡æœ‰åŒºåˆ«ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8eugophbij30s402q0sw_hu9414059660370980559.webp 400w,
               /blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8eugophbij30s402q0sw_hu10530458900893252573.webp 760w,
               /blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8eugophbij30s402q0sw_hu13640161908466334564.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8eugophbij30s402q0sw_hu9414059660370980559.webp&#34;
               width=&#34;760&#34;
               height=&#34;74&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;microservices-demo app çš„åº”ç”¨æ¶æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8eugu4pawj30sg0nc75f_hu17997527023222273734.webp 400w,
               /blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8eugu4pawj30sg0nc75f_hu5527272823127791943.webp 760w,
               /blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8eugu4pawj30sg0nc75f_hu496667884844972751.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8eugu4pawj30sg0nc75f_hu17997527023222273734.webp&#34;
               width=&#34;760&#34;
               height=&#34;623&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨åº”ç”¨ç¨‹åºè¿è¡Œä¸”æ—¥å¿—ä¸­æ²¡æœ‰é”™è¯¯å¹¶å°†æ—¥å¿—å¸è½½åˆ°æ—¥å¿—èšåˆè§£å†³æ–¹æ¡ˆåï¼Œæˆ‘ä»¬è®¤ä¸ºâ€œè¿ç§»â€å·²å®Œæˆã€‚è™½ç„¶æˆ‘ä»¬æ‰¿è®¤éœ€è¦æ›´å¤šçš„åŠªåŠ›æ¥å‡†å¤‡å¥½äº§å“ç”Ÿäº§ï¼›åº”ç”¨ç¨‹åºæœ¬èº«ä¸æ˜¯ç”Ÿäº§å°±ç»ªäº§å“ï¼Œå› æ­¤æˆ‘ä»¬çœç•¥äº†è¿™ä¸ªèŒƒå›´ã€‚æˆ‘ä»¬è¿˜å¢åŠ äº†æŒ‘æˆ˜ï¼Œå³æˆ‘ä»¬ä¸ä¼šä¿®æ”¹å¾®æœåŠ¡æ¼”ç¤ºåº”ç”¨ç¨‹åºçš„æºä»£ç ï¼Œå› ä¸ºæ›´æ”¹æºä»£ç å¯ä»¥ä½¿æˆ‘ä»¬çš„å·¥ä½œæ›´è½»æ¾å¹¶å½±å“æˆ‘ä»¬çš„å‘ç°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;gke&#34;&gt;GKE&lt;/h2&gt;
&lt;p&gt;Google åœ¨å…¶ &lt;a href=&#34;https://github.com/GoogleCloudPlatform/microservices-demo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;microservices-demo&lt;/a&gt; ä¸­æä¾›äº†æ‰€éœ€çš„ Kubernetes éƒ¨ç½²é…ç½®ï¼›ä½†æ˜¯ï¼Œå®ƒä¸æä¾›å¿…è¦åŸºç¡€è®¾æ–½çš„ä»£ç ã€‚æˆ‘ä»¬é€‰æ‹©ä½¿ç”¨ GKE-Autopilot ç±»å‹çš„é›†ç¾¤éƒ¨ç½²ï¼Œè®©éƒ¨ç½²å’Œç®¡ç†å˜å¾—æ›´åŠ è½»æ¾ã€‚&lt;a href=&#34;https://cloud.google.com/kubernetes-engine/docs/concepts/autopilot-overview&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Autopilot&lt;/a&gt; ç±»å‹çš„éƒ¨ç½²ç¡®ä¿äº† GKE æä¾›å’Œç®¡ç†é›†ç¾¤çš„åº•å±‚åŸºç¡€è®¾æ–½ï¼ŒåŒ…æ‹¬èŠ‚ç‚¹å’ŒèŠ‚ç‚¹æ± ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªä¼˜åŒ–çš„é›†ç¾¤å’Œä¸€ä¸ªæ— éœ€å¹²é¢„çš„ä½“éªŒã€‚ä¸‹é¢æ˜¯åº”ç”¨ç¨‹åºåœ¨ GKE ä¸­è¿è¡Œçš„æ¶æ„ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8eugmom1pj30sg0pvdi1_hu13403524637851055152.webp 400w,
               /blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8eugmom1pj30sg0pvdi1_hu1217183038310633453.webp 760w,
               /blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8eugmom1pj30sg0pvdi1_hu17530166406579622578.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8eugmom1pj30sg0pvdi1_hu13403524637851055152.webp&#34;
               width=&#34;760&#34;
               height=&#34;691&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ GKE é›†ç¾¤ä¸­å¯åŠ¨å’Œè¿è¡Œåº”ç”¨ç¨‹åºçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸º GKE è®¾ç½®æ‰€éœ€çš„ VPCã€‚&lt;/li&gt;
&lt;li&gt;è®¾ç½®å¿…è¦çš„ DNS åŒºåŸŸã€‚external-dns æœåŠ¡å°†ä½¿ç”¨è¿™äº›åŒºåŸŸä¸ºåº”ç”¨ç¨‹åºåˆ›å»ºæ‰€éœ€çš„ DNS è®°å½•ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ Autopilot æ„å»º GKE é›†ç¾¤&lt;/li&gt;
&lt;li&gt;è®¾ç½®å¿…è¦çš„æœåŠ¡å¸æˆ·æƒé™ï¼Œä»¥å…è®¸ Autopilot é…ç½®åŸºæœ¬çš„é›†ç¾¤ç›‘æ§åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;ä¸º external-dns åˆ›å»ºå¿…è¦çš„æœåŠ¡å¸æˆ·æ¥ç®¡ç† DNS è®°å½•ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Kubernetes éƒ¨ç½²å®Œæˆåï¼Œè¿˜éœ€è¦ä¸º Kubernetes éƒ¨ç½²é‡‡å–å…¶ä»–æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®‰è£…å¤–éƒ¨ DNS æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ManagedCertificate&lt;/strong&gt; éœ€è¦é€šè¿‡ &lt;strong&gt;networking.gke.io/v1&lt;/strong&gt; API ä¸ºè´Ÿè½½å‡è¡¡å™¨ä¸Šä½¿ç”¨çš„ SSL è¯ä¹¦å®šä¹‰ã€‚&lt;/li&gt;
&lt;li&gt;åˆ›å»ºäº†ä¸€ä¸ªä½¿ç”¨ GKE &lt;a href=&#34;https://cloud.google.com/kubernetes-engine/docs/concepts/alias-ips&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VPC åŸç”Ÿé›†ç¾¤ä¸­&lt;/a&gt;&lt;a href=&#34;https://cloud.google.com/load-balancing/docs/negs#zonal-neg&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;çš„ç½‘ç»œç«¯ç‚¹ç»„ (NEG)&lt;/a&gt; çš„&lt;strong&gt;æœåŠ¡&lt;/strong&gt;å®šä¹‰ã€‚Ingress æ˜¯ä½¿ç”¨å®¹å™¨åŸç”Ÿè´Ÿè½½å‡è¡¡çš„æ¨èæ–¹å¼ï¼Œå› ä¸ºå®ƒå…·æœ‰è®¸å¤šå¯ç®€åŒ– NEG ç®¡ç†çš„åŠŸèƒ½ã€‚å½“ &lt;a href=&#34;https://cloud.google.com/kubernetes-engine/docs/how-to/container-native-load-balancing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NEG ä¸ GKE Ingress ä¸€èµ·ä½¿ç”¨æ—¶&lt;/a&gt;ï¼ŒIngress æ§åˆ¶å™¨æœ‰åŠ©äºåˆ›å»ºè´Ÿè½½å‡è¡¡å™¨çš„æ‰€æœ‰æ–¹é¢ï¼ŒåŒ…æ‹¬åˆ›å»ºè™šæ‹Ÿ IP åœ°å€ã€è½¬å‘è§„åˆ™ã€å¥åº·æ£€æŸ¥ã€é˜²ç«å¢™è§„åˆ™ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;FrontEndConfig&lt;/strong&gt; å®šä¹‰æ˜¯é€šè¿‡ networking.gke.io/v1beta1 API åˆ›å»ºçš„ï¼Œä»¥ç¡®ä¿å­˜åœ¨å°† HTTP æµé‡é‡å®šå‘åˆ° HTTPS çš„è§„åˆ™ã€‚&lt;/li&gt;
&lt;li&gt;åˆ©ç”¨å…ˆå‰åˆ›å»ºçš„æœåŠ¡å’Œ FrontEndConfig åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ **Ingress ã€‚**è¿™ä¸ª Ingress å®šä¹‰ä¹Ÿå°†è¢« external-dns æœåŠ¡åˆ©ç”¨ï¼Œå®ƒå°†é…ç½®å¿…è¦çš„è®°å½•ä»¥æŒ‡å‘è´Ÿè½½å‡è¡¡å™¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ€»çš„æ¥è¯´ï¼Œé›†ç¾¤çš„é…ç½®å’Œå¸¦æœ‰é¢å¤–é…ç½®çš„å¾®æœåŠ¡æ¼”ç¤ºçš„éƒ¨ç½²å¤§çº¦èŠ±äº†ä¸¤å¤©æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œå¿…é¡»æ³¨æ„å®šä¹‰è´Ÿè½½å‡è¡¡å™¨é…ç½®å¹¶ç¡®ä¿å°† HTTP é‡å®šå‘åˆ° HTTPS çš„ Ingress è§„åˆ™ä½¿ç”¨çš„ API ä»å¤„äºæµ‹è¯•é˜¶æ®µ (networking.gke.io/v1beta1)ï¼›æ­¤é…ç½®çš„å¦ä¸€ä¸ªå…³é”®æ³¨æ„äº‹é¡¹æ˜¯ FrontEndConfig è¿˜å°†åˆ›å»ºå¦ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨æ¥è½¬å‘æµé‡ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8eugqg2pej312w0dvq3o_hu13886139945690015513.webp 400w,
               /blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8eugqg2pej312w0dvq3o_hu12504024127797678341.webp 760w,
               /blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8eugqg2pej312w0dvq3o_hu5030128323430927050.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8eugqg2pej312w0dvq3o_hu13886139945690015513.webp&#34;
               width=&#34;760&#34;
               height=&#34;271&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;aks--ä¸¤å¤©çš„è¿ç§»å·¥ä½œ&#34;&gt;AKS â€” ä¸¤å¤©çš„è¿ç§»å·¥ä½œ&lt;/h2&gt;
&lt;p&gt;å¯¹äº AKSï¼Œä¸ºäº†æµ‹è¯•å¯ç§»æ¤æ€§çš„æ˜“ç”¨æ€§ï¼Œæˆ‘ä»¬å†³å®šä½¿ç”¨åˆ©ç”¨ &lt;a href=&#34;https://docs.microsoft.com/en-us/azure/aks/virtual-nodes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;AKS è™šæ‹ŸèŠ‚ç‚¹&lt;/a&gt;ç±»å‹éƒ¨ç½²çš„ AKS ç¾¤é›†ã€‚ä½¿ç”¨è™šæ‹ŸèŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿé…ç½® podï¼Œå¹¶ä¸”åªéœ€æŒ‰ç§’ä¸ºå®ƒä»¬çš„æ‰§è¡Œæ—¶é—´ä»˜è´¹ã€‚ä½ æ— éœ€ç­‰å¾… Kubernetes é›†ç¾¤è‡ªåŠ¨ç¼©æ”¾å™¨éƒ¨ç½² VM è®¡ç®—èŠ‚ç‚¹æ¥è¿è¡Œé¢å¤–çš„ podã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°å¾®æœåŠ¡æ¼”ç¤ºçš„&lt;strong&gt;å‰ç«¯&lt;/strong&gt;å’Œ &lt;strong&gt;redis-cart&lt;/strong&gt; éƒ¨ç½²çš„ç»„ä»¶åœ¨ç‰¹å®šè´Ÿè½½ä¸‹ä¼šé—´æ­‡æ€§åœ°å¤±è´¥ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å†³å®šå°†è¿™äº›ç»„ä»¶éƒ¨ç½²åˆ°ä¸€ä¸ªå•ç‹¬çš„èŠ‚ç‚¹æ± ï¼Œå¹¶å…è®¸å°†å‰©ä½™çš„æœåŠ¡éƒ¨ç½²åˆ°è™šæ‹ŸèŠ‚ç‚¹ã€‚ä¸‹é¢æ˜¯åº”ç”¨ç¨‹åºåœ¨ AKS ä¸­è¿è¡Œçš„æ¶æ„ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8eugrzmjij30sg0m6n00_hu18163525273583585322.webp 400w,
               /blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8eugrzmjij30sg0m6n00_hu4605883294953858348.webp 760w,
               /blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8eugrzmjij30sg0m6n00_hu13577960984680394038.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8eugrzmjij30sg0m6n00_hu18163525273583585322.webp&#34;
               width=&#34;760&#34;
               height=&#34;592&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®¾ç½®é›†ç¾¤å¹¶éƒ¨ç½²å¾®æœåŠ¡æ¼”ç¤ºï¼Œæˆ‘ä»¬é‡‡å–äº†ä»¥ä¸‹æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸º AKS è®¾ç½® Azure ç½‘ç»œã€‚ä½œä¸ºè¿™é¡¹å·¥ä½œçš„ä¸€éƒ¨åˆ†ï¼Œåˆ›å»ºäº†ä¸‰ä¸ªç‹¬ç«‹çš„å­ç½‘ï¼Œä¸€ä¸ªç”¨äºè™šæ‹ŸèŠ‚ç‚¹ (ACI)ï¼Œä¸€ä¸ªä¾›ç½‘å…³ä½¿ç”¨ï¼Œå¦ä¸€ä¸ªç”¨äºå…¶ä½™é›†ç¾¤ç»„ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;è®¾ç½®å¿…è¦çš„ DNS åŒºåŸŸã€‚&lt;/li&gt;
&lt;li&gt;ä¸º AKS ç¾¤é›†è®¾ç½® Log Analytics å·¥ä½œåŒºã€‚&lt;/li&gt;
&lt;li&gt;è®¾ç½® AKS ç¾¤é›†ã€‚&lt;/li&gt;
&lt;li&gt;å¯ç”¨äº†ä»¥ä¸‹ Kubernetes é™„åŠ ç»„ä»¶ï¼š&lt;/li&gt;
&lt;li&gt;ç›‘æ§ï¼šContainer Insights ç›‘æ§é›†ç¾¤&lt;/li&gt;
&lt;li&gt;è™šæ‹ŸèŠ‚ç‚¹ (ACI)ï¼šåœ¨é›†ç¾¤ä¸­ä½¿ç”¨è™šæ‹ŸèŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;ingress-appgwï¼šå¸¦æœ‰ AKS ç¾¤é›†çš„åº”ç”¨ç¨‹åºç½‘å…³å…¥å£æ§åˆ¶å™¨&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åŸºç¡€è®¾æ–½å®Œæˆåï¼Œéœ€è¦å®Œæˆä»¥ä¸‹ Kubernetes éƒ¨ç½²é…ç½®ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®‰è£…å’Œé…ç½®&lt;strong&gt;å¤–éƒ¨ DNS&lt;/strong&gt; æœåŠ¡&lt;/li&gt;
&lt;li&gt;å®‰è£…å’Œé…ç½®&lt;strong&gt;çš„è¯ä¹¦ç®¡ç†å™¨&lt;/strong&gt;æœåŠ¡&lt;/li&gt;
&lt;li&gt;æ›´æ”¹äº†å¾®æœåŠ¡æ¼”ç¤ºæä¾›çš„éƒ¨ç½²å®šä¹‰ï¼Œä»¥å…è®¸é€šè¿‡å®šä¹‰æ‰€éœ€çš„ &lt;strong&gt;nodeSelector&lt;/strong&gt; å’Œ &lt;strong&gt;tolerations åœ¨è™šæ‹ŸèŠ‚ç‚¹èŠ‚ç‚¹æ± ä¸Šå®Œæˆéƒ¨ç½²&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;éœ€è¦å®šä¹‰ä½¿ç”¨ ingress-appgw é™„åŠ ç»„ä»¶å’Œ cert-manager æœåŠ¡çš„ Ingress **ã€‚**è¿™ä¸ª Ingress å®šä¹‰ä¹Ÿå°†è¢« external-dns æœåŠ¡åˆ©ç”¨ï¼Œå®ƒå°†é…ç½®å¿…è¦çš„è®°å½•ä»¥æŒ‡å‘ç½‘å…³ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ€»çš„æ¥è¯´ï¼Œé›†ç¾¤çš„é…ç½®å’Œå¸¦æœ‰é¢å¤–é…ç½®çš„å¾®æœåŠ¡æ¼”ç¤ºçš„éƒ¨ç½²å¤§çº¦èŠ±äº†ä¸¤å¤©æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œå¿…é¡»æ³¨æ„çš„æ˜¯ï¼Œç”±äºæ•´ä¸ª Kubernetes ä½“éªŒæ‰€éœ€çš„é™„åŠ ç»„ä»¶å’ŒæœåŠ¡ï¼Œç»´æŠ¤æ­¤é›†ç¾¤æ‰€éœ€çš„å·¥ä½œé‡å¢åŠ äº†ã€‚ä¸ GKE Autopilot ä¸åŒï¼Œéœ€è¦ä½¿ç”¨è™šæ‹ŸèŠ‚ç‚¹å’Œåº”ç”¨ç¨‹åºç½‘å…³è¿›è¡Œç›‘æ§çš„ AKS é™„åŠ ç»„ä»¶ã€‚æ­¤å¤–ï¼ŒAKS éœ€è¦ cert-manager æœåŠ¡æ¥è‡ªåŠ¨åŒ–è´Ÿè½½å‡è¡¡å™¨ä¸Šçš„è¯ä¹¦ç®¡ç†ã€‚æ‰€æœ‰è¿™äº›ç»„ä»¶éƒ½éœ€è¦é›†ç¾¤ç®¡ç†å‘˜è¿›è¡Œç»´æŠ¤ã€‚&lt;/p&gt;
&lt;h2 id=&#34;eks--ä¸¤å¤©çš„è¿ç§»å·¥ä½œ&#34;&gt;EKS â€” ä¸¤å¤©çš„è¿ç§»å·¥ä½œ&lt;/h2&gt;
&lt;p&gt;è€ƒè™‘åˆ°æˆ‘ä»¬æ‹¥æœ‰æ¥è‡ª GKE éƒ¨ç½²çš„ Kubernetes æ¸…å•ï¼Œå°†å·¥ä½œè´Ÿè½½è½¬ç§»åˆ° EKS å¹¶ä¸åƒä½ æƒ³è±¡çš„é‚£ä¹ˆç®€å•ã€‚æˆ‘ä»¬é€‰æ‹©ä¸å°† Fargate ç”¨äº EKS å®æ–½ï¼Œå› ä¸ºå½“æ—¶æ—¥å¿—è®°å½•éœ€è¦ä¸€ä¸ª sidecarï¼Œæˆ‘ä»¬é€‰æ‹©äº†è¿è¡Œ DaemonSet çš„ EC2 æ¥æ”¶é›†æ—¥å¿—ã€‚ä¸‹é¢æ˜¯ EKS è¿ç§»çš„æ¶æ„ï¼Œåé¢æ˜¯å¯¹è¿ç§»è¿‡ç¨‹çš„æè¿°ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8euhdkejej30sg0sggol_hu9067864062850532231.webp 400w,
               /blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8euhdkejej30sg0sggol_hu3925553493403700317.webp 760w,
               /blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8euhdkejej30sg0sggol_hu18173073118842989658.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8euhdkejej30sg0sggol_hu9067864062850532231.webp&#34;
               width=&#34;760&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;ç¯å¢ƒé…ç½®&#34;&gt;ç¯å¢ƒé…ç½®&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ä¸º EKS è®¾ç½® VPCã€‚&lt;/li&gt;
&lt;li&gt;è®¾ç½® Route53 åŸŸã€‚&lt;/li&gt;
&lt;li&gt;ä» ACM æä¾›è¯ä¹¦ã€‚&lt;/li&gt;
&lt;li&gt;æ„å»º EKS é›†ç¾¤ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºé›†ç¾¤ä¾›åº”å—ç®¡èŠ‚ç‚¹ç»„ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;è¿ç§»åŠªåŠ›&#34;&gt;è¿ç§»åŠªåŠ›&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;å®‰è£… Kubernetes æ’ä»¶ï¼š&lt;/li&gt;
&lt;li&gt;å¤–éƒ¨ DNS æ’ä»¶&lt;/li&gt;
&lt;li&gt;AWS è´Ÿè½½å‡è¡¡å™¨æ§åˆ¶å™¨&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ Fluent Bit çš„ AWS Container Insights&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹ Kubernetes æ¸…å•ä»¥ä½¿ç”¨æ–°æ’ä»¶ï¼š&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹äº† &lt;strong&gt;nodeSelector&lt;/strong&gt; å’Œ &lt;strong&gt;tolerations&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;ä¸ºå¤„ç†åˆ›å»º ALBã€ç®¡ç† R53 è®°å½•å’Œåº”ç”¨å…ˆå‰åˆ›å»ºçš„è¯ä¹¦çš„åº”ç”¨ç¨‹åºçš„å¤–éƒ¨å…¬å¼€ç«¯ç‚¹åˆ›å»ºå…¥å£å®šä¹‰&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™ä¸ªè¿‡ç¨‹èŠ±äº†æˆ‘ä»¬å¤§çº¦ä¸¤å¤©çš„æ—¶é—´ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†æ—¶é—´ç”¨äºåˆ†ææˆ‘ä»¬éœ€è¦å“ªäº›æ’ä»¶æ‰èƒ½é€šè¿‡ EKS ç”Ÿæ€ç³»ç»Ÿå®ç°æˆ‘ä»¬çš„ç›®æ ‡ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œä¸ AKS é…ç½®éå¸¸ç›¸ä¼¼ï¼Œæˆ‘ä»¬æœ‰ä¸€äº›æ’ä»¶éœ€è¦å®‰è£…ã€ç›‘æ§å’Œè¿è¡Œï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åºåœ¨ EKS é›†ç¾¤ä¸­æˆåŠŸè¿è¡Œã€‚å› æ­¤ï¼Œç»„ç»‡å°†æ‰¿æ‹…è¿™äº›ç¬¬ä¸‰æ–¹æ’ä»¶çš„å‡çº§ã€ç»´æŠ¤å’Œäº‹ä»¶ç®¡ç†çš„è´Ÿæ‹…ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ecs--ä¸¤å¤©çš„è¿ç§»å·¥ä½œ&#34;&gt;ECS â€” ä¸¤å¤©çš„è¿ç§»å·¥ä½œ&lt;/h2&gt;
&lt;p&gt;å°†å·¥ä½œè´Ÿè½½è½¬ç§»åˆ° ECS èµ·åˆä¼¼ä¹æ˜¯ä¸€é¡¹è‰°å·¨çš„å·¥ä½œï¼Œä½†å¹¶ä¸æ˜¯é‚£ä¹ˆå…·æœ‰æŒ‘æˆ˜æ€§ã€‚åœ¨è®©åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ï¼Œæˆ‘ä»¬é‡åˆ°äº†ä¸€ä¸ªé‡å¤§æŒ‘æˆ˜ã€‚è¯¥åº”ç”¨ç¨‹åºä½¿ç”¨å…¶ GRPC è°ƒç”¨çš„ä¸å®‰å…¨è®¾ç½®è¿›è¡Œäº†ç¡¬ç¼–ç ã€‚è¿™å¯¼è‡´äº†å‡ ä¸ªå°æ—¶çš„æŒ å¤´ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ç›´æ¥è®¿é—®å®¹å™¨ï¼Œä½†æ— æ³•é€šè¿‡ AWS Application Load Balancer è®¿é—®å®ƒä»¬ï¼Œå› ä¸º ALB ç°åœ¨ä¸æ”¯æŒ GRPC çš„æœªåŠ å¯†æµé‡ã€‚è¿™ä¸æ˜¯ EKS çš„é—®é¢˜ï¼Œå› ä¸ºæœåŠ¡åˆ°æœåŠ¡çš„è°ƒç”¨ç¡®å®åˆ©ç”¨ ALB è¿›è¡Œä¸œ / è¥¿æµé‡ï¼Œä»¥æ”¯æŒå†…ç½®çš„ Kubernetes æœåŠ¡ã€‚è™½ç„¶è¿™çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªéšœç¢ï¼Œä½†æˆ‘ä»¬èƒ½å¤Ÿå¿«é€Ÿè½¬å‘ä½¿ç”¨ AWS Cloud Map æ¥ä»£æ›¿æœåŠ¡åˆ°æœåŠ¡çš„æµé‡ã€‚è§£å†³ GRPC é—®é¢˜åï¼ŒECS è§£å†³æ–¹æ¡ˆçš„æ¶æ„å’Œæ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8euhbqubij30o80sg418_hu3930604228738275434.webp 400w,
               /blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8euhbqubij30o80sg418_hu4689840564317448816.webp 760w,
               /blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8euhbqubij30o80sg418_hu14957322432028141330.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/does-kubernetes-really-give-you-multicloud-portability/008vxvgGgy1h8euhbqubij30o80sg418_hu3930604228738275434.webp&#34;
               width=&#34;648&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;ç¯å¢ƒé…ç½®-1&#34;&gt;ç¯å¢ƒé…ç½®&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ä¸º ECS è®¾ç½® VPCã€‚&lt;/li&gt;
&lt;li&gt;è®¾ç½® Route53 åŸŸã€‚&lt;/li&gt;
&lt;li&gt;ä» ACM æä¾›è¯ä¹¦ã€‚&lt;/li&gt;
&lt;li&gt;è®¾ç½® Cloud Mapã€‚&lt;/li&gt;
&lt;li&gt;è®¾ç½®é…ç½®äº† Fargate å’Œ Container Insights çš„ ECS é›†ç¾¤ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;ecs-è¿ç§»å·¥ä½œ&#34;&gt;ECS è¿ç§»å·¥ä½œ&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;åˆ©ç”¨æ¥è‡ª GKE éƒ¨ç½²çš„ Kubernetes æ¸…å•æ¥ç¼–å†™å°†éƒ¨ç½² ECS ä»»åŠ¡ã€ECS æœåŠ¡ã€Route53 è®°å½•ã€é…ç½® ALB å’Œé…ç½® Cloud Map çš„ Terraform è„šæœ¬ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™ä¸ªè¿‡ç¨‹èŠ±äº†æˆ‘ä»¬å¤§çº¦ä¸¤å¤©çš„æ—¶é—´ï¼Œæˆ‘ä»¬è®©åº”ç”¨ç¨‹åºè¿è¡Œå¹¶è®°å½•æ—¥å¿—ï¼Œè€Œå®ç°æ—¥å¿—è®°å½•æ‰€éœ€çš„è™šæ‹Ÿæœºå’Œæ’ä»¶ä¸ºé›¶ã€‚&lt;/p&gt;
&lt;p&gt;ECS ä¸æ‰€æœ‰å…¶ä»–åŸºäº Kubernetes çš„éƒ¨ç½²ä¹‹é—´æœ€å¤§çš„å¼€å‘å·¥ä½œå·®å¼‚åœ¨äº ECS ä»»åŠ¡å’ŒæœåŠ¡éƒ¨ç½² Terraform è„šæœ¬çš„åˆ›å»ºã€‚è¿™äº›èŠ±äº†ä¸€ä¸ªä¸‹åˆçš„æ—¶é—´æ¥ç¼–å†™ï¼Œä½†æ˜¯ä¸€æ—¦æˆ‘ä»¬ç¼–å†™äº†ä¸€æ¬¡ä»£ç ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿå°†å®ƒé‡æ–°ç”¨äºæ‰€æœ‰å…¶ä»–æœåŠ¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¹³å°å‡çº§ã€ç»´æŠ¤å’Œäº‹ä»¶ç®¡ç†çš„ç»´æŠ¤è´Ÿæ‹…è½¬ç§»åˆ°è´£ä»»å…±æ‹…æ¨¡å‹çš„ AWS ç«¯ï¼Œä»è€Œä½¿ç»„ç»‡çš„å‘˜å·¥è…¾å‡ºæ—¶é—´æ¥æ›´å¤šåœ°å…³æ³¨é©±åŠ¨ä¸šåŠ¡ä»·å€¼çš„å·®å¼‚åŒ–ä»£ç ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æ€»è€Œè¨€ä¹‹ï¼Œéƒ¨ç½²åˆ°æ‰˜ç®¡ Kubernetes ä¸èƒ½è¢«è®¤ä¸ºæ˜¯å®Œå…¨å¯ç§»æ¤çš„ï¼ˆæˆ–å¯ç§»æ¤æ€§çš„é“¶å¼¹ï¼‰ï¼Œå› ä¸ºä½ éœ€è¦å®‰è£…å’Œç®¡ç†é™„åŠ ç»„ä»¶æˆ–æœåŠ¡ä»¥ç¡®ä¿åº”ç”¨ç¨‹åºè¢«éƒ¨ç½²å’Œé…ç½®ä¸ºå®ƒåº”è¯¥æ˜¯æ ·å­ã€‚ä½ åœ¨éƒ¨ç½²æ‹“æ‰‘çš„æ ¸å¿ƒç»„ä»¶ä¸ŠèŠ±è´¹çš„æ—¶é—´æ›´å°‘ï¼Œå¹¶ä¸”å½“ä½ å¸Œæœ›æ‹¥æœ‰å…³é”®åŠŸèƒ½æ—¶ï¼Œå¤§å¤šæ•°ä¾èµ–äºäº‘çš„é…ç½®éƒ½ä¼šå‘æŒ¥ä½œç”¨ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‡ªåŠ¨ DNS è®°å½•ç®¡ç†&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨åŒ–æ‰˜ç®¡è¯ä¹¦&lt;/li&gt;
&lt;li&gt;ç›‘æ§&lt;/li&gt;
&lt;li&gt;è´Ÿè½½å‡è¡¡å™¨ç®¡ç†&lt;/li&gt;
&lt;li&gt;ç§˜å¯†æ•´åˆ&lt;/li&gt;
&lt;li&gt;ç¼©æ”¾&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœä½ ä½¿ç”¨æ‰˜ç®¡èŠ‚ç‚¹ï¼ˆä¾‹å¦‚ï¼ŒAWS Fargateã€AKS è™šæ‹ŸèŠ‚ç‚¹ã€GKE Autopilotï¼‰ï¼Œä½ å°†é‡åˆ°å¯èƒ½å½±å“åº”ç”¨ç¨‹åºè¡Œä¸ºçš„é™åˆ¶ï¼Œä¾‹å¦‚æ— æ³•æ‰˜ç®¡çŠ¶æ€æˆ–ä½¿ç”¨å®ˆæŠ¤è¿›ç¨‹é›†ç±»å‹éƒ¨ç½²ã€‚å›é€€åˆ°å—ç®¡èŠ‚ç‚¹æ„å‘³ç€ï¼Œä½œä¸ºé›†ç¾¤ç®¡ç†å‘˜ï¼Œä½ ç°åœ¨è´Ÿè´£ç®¡ç†å‡çº§å’Œæ‰©å±•ã€‚ç»¼ä¸Šæ‰€è¿°ï¼ŒKubernetes æ˜¯ä¼ä¸šç»´æŠ¤æ€§æ›´é«˜çš„è§£å†³æ–¹æ¡ˆï¼Œä½†è¿™å¹¶ä¸æ˜¯åäº‹ï¼Œå› ä¸ºå®ƒä¹Ÿæ˜¯æœ€çµæ´»çš„è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶è‚¯å®šå­˜åœ¨ä¸ CSP æœåŠ¡ç›¸å…³çš„äº‘å¯ç§»æ¤æ€§é—®é¢˜ï¼Œä½†æˆ‘ä»¬è®¤ä¸ºå°†è¿™äº›é—®é¢˜åº”ç”¨äºå®¹å™¨ç¼–æ’æ—¶å¹¶æ²¡æœ‰å¤šå¤§æ„ä¹‰ã€‚ä» GKE è¿ç§»åˆ° ECS Fargate çš„åŠªåŠ›ç±»ä¼¼äºä» GKE è¿ç§»åˆ° EKS/AKS çš„åŠªåŠ›ï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™è¯æ˜äº†â€œå¯ç§»æ¤æ€§â€çš„è®ºç‚¹å¹¶æ²¡æœ‰çœŸæ­£ç«™å¾—ä½è„šã€‚å½“ä½ è½¬å‘åˆ©ç”¨é«˜é˜¶è®¡ç®—æœåŠ¡å¹¶å¼€å§‹å°†ä½ çš„æ•°æ®ä¹Ÿè½¬ç§»åˆ° CSP ç®¡ç†çš„æœåŠ¡æ—¶ï¼Œäº‘ä¸­çš„ä¾›åº”å•†é”å®šåœ¨æŸç§ç¨‹åº¦ä¸Šæ˜¯ä¸å¯é¿å…çš„ã€‚Kubernetes æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå¦‚æœä½ æœ‰å……åˆ†çš„æŠ€æœ¯åŸå› ï¼ˆå…¶ä¸­æœ‰å¾ˆå¤šï¼‰ï¼Œæˆ–è€…åªæ˜¯éœ€è¦åº”ç”¨ç¨‹åºåœ¨äº‘å†…å¤–è¿è¡Œï¼Œé‚£ä¹ˆ Kubernetes å¯èƒ½é€‚åˆä½ ã€‚ç„¶è€Œï¼Œå¦‚æœä½ æƒ³äº†è§£æœ‰å…³å®¹å™¨å’Œå¤šäº‘å¯ç§»æ¤æ€§çš„æ›´å¤šä¿¡æ¯ï¼Œæˆ‘ä»¬çš„åŒäº‹æœ€è¿‘å‘è¡¨äº†&lt;a href=&#34;https://www.mckinsey.com/business-functions/mckinsey-digital/our-insights/getting-the-most-from-cloud-services-and-containers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸€ç¯‡æ–‡ç« &lt;/a&gt;æ¥è®¨è®ºè¿™ä¸€ç‚¹ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>2022 å¹´å®¹å™¨ç”Ÿæ€ç³»ç»Ÿçš„ 9 å¤§è¶‹åŠ¿æ´å¯Ÿ</title>
      <link>https://cloudnativecn.com/blog/container-insights-2022/</link>
      <pubDate>Mon, 07 Nov 2022 10:16:27 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/container-insights-2022/</guid>
      <description>&lt;p&gt;è¿™é¡¹ç ”ç©¶å»ºç«‹åœ¨ Datadog ä»¥å‰ç‰ˆæœ¬çš„&lt;a href=&#34;https://www.datadoghq.com/container-report-2021/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®¹å™¨ä½¿ç”¨æŠ¥å‘Š&lt;/a&gt;ã€&lt;a href=&#34;https://www.datadoghq.com/container-orchestration-2018/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®¹å™¨ç¼–æ’æŠ¥å‘Š&lt;/a&gt;å’Œ&lt;a href=&#34;https://www.datadoghq.com/docker-adoption/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Docker ç ”ç©¶æŠ¥å‘Š&lt;/a&gt;çš„åŸºç¡€ä¸Šã€‚æœ€æ–°æ›´æ–°äº 2022 å¹´ 11 æœˆã€‚è¯‘è‡ªï¼š&lt;a href=&#34;https://www.datadoghq.com/container-report/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.datadoghq.com/container-report/&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç°ä»£å·¥ç¨‹å›¢é˜Ÿç»§ç»­æ‰©å±•ä»–ä»¬å¯¹å®¹å™¨çš„ä½¿ç”¨ï¼Œå¦‚ä»ŠåŸºäºå®¹å™¨çš„å¾®æœåŠ¡åº”ç”¨ç¨‹åºæ— å¤„ä¸åœ¨ã€‚ä¸æ–­å¢é•¿çš„å®¹å™¨ä½¿ç”¨æ­£åœ¨æ¨åŠ¨ç»„ç»‡é‡‡ç”¨äº’è¡¥æŠ€æœ¯æ¥ç®€åŒ–ä»–ä»¬æ“ä½œé›†ç¾¤çš„æ–¹å¼ï¼Œè€Œè¿™ç§ä¸æ–­æ‰©å±•çš„å®¹å™¨ç¯å¢ƒç»™ç»„ç»‡å¸¦æ¥äº†å®‰å…¨æŒ‘æˆ˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åœ¨æœ¬æŠ¥å‘Šä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥äº†æ•°ä¸‡ Datadog å®¢æˆ·&lt;/strong&gt;è¿è¡Œçš„è¶…è¿‡&lt;strong&gt;15 äº¿ä¸ªå®¹å™¨&lt;/strong&gt;ï¼Œä»¥äº†è§£å®¹å™¨ç”Ÿæ€ç³»ç»Ÿçš„çŠ¶æ€ã€‚ç»§ç»­é˜…è¯»ï¼Œäº†è§£ä»æœ€æ–°çš„å®é™…ä½¿ç”¨æ•°æ®ä¸­æ”¶é›†çš„æ›´å¤šè§è§£å’Œè¶‹åŠ¿ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;â€œè¿™é¡¹è°ƒæŸ¥è¡¨æ˜ï¼Œå®¹å™¨å’Œ Kubernetes é©å‘½æ­£åœ¨ä¸æ–­å‘å±•å£®å¤§ã€‚ç»“æœæ­ç¤ºäº†ä½¿ç”¨å®¹å™¨å’Œ Kubernetes çš„äº‘åŸç”Ÿç»„ç»‡ä¸ä»…å‘å±•å¾—æ›´å¿«ï¼Œè€Œä¸”è·å¾—äº†æ›´å¤§çš„ä¿¡å¿ƒâ€”â€”åœ¨æ¯”ä»¥å¾€ä»»ä½•æ—¶å€™éƒ½æ›´å…³é”®çš„ç”Ÿäº§ç¯å¢ƒä¸­æ„å»ºå’Œéƒ¨ç½²æ›´å¤§å‹çš„åº”ç”¨ç¨‹åºå’Œå·¥ä½œè´Ÿè½½ã€‚&lt;/p&gt;
&lt;p&gt;å¾—ç›Šäºäº‘åŸç”Ÿç”Ÿæ€ç³»ç»Ÿä¸­è¶…è¿‡ 175,000 åè´¡çŒ®è€…æ‰€æ¨åŠ¨çš„åˆ›æ–°ï¼Œäº‘åŸç”Ÿç»„ç»‡å·²ä¸ºå‰è¿›çš„é“è·¯åšå¥½äº†å‡†å¤‡ã€‚ä»–ä»¬æ­£åœ¨åˆ›é€ å¯ä»¥è®©å„ç§è§„æ¨¡çš„å·¥ç¨‹å›¢é˜Ÿéƒ½å¯ä»¥æ„å»ºå’Œè¿è¡Œåº”ç”¨ç¨‹åºçš„æŠ€æœ¯ï¼Œä»¥æ»¡è¶³å½“ä»Šåº”ç”¨ç¨‹åºçš„éœ€æ±‚ã€‚â€&lt;/p&gt;
&lt;p&gt;â€” Priyanka Sharmaï¼Œäº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šæ‰§è¡Œè‘£äº‹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;è¶‹åŠ¿-1kubernetes-ç»§ç»­æˆä¸ºæœ€å—æ¬¢è¿çš„å®¹å™¨ç®¡ç†ç³»ç»Ÿ&#34;&gt;è¶‹åŠ¿ 1ï¼šKubernetes ç»§ç»­æˆä¸ºæœ€å—æ¬¢è¿çš„å®¹å™¨ç®¡ç†ç³»ç»Ÿ&lt;/h2&gt;
&lt;p&gt;Kubernetes æ¯”ä»¥å¾€ä»»ä½•æ—¶å€™éƒ½æ›´å—æ¬¢è¿ã€‚å¦‚ä»Šï¼Œè¿‘ä¸€åŠçš„å®¹å™¨ç»„ç»‡è¿è¡Œ Kubernetes æ¥åœ¨ä¸æ–­å‘å±•çš„ç”Ÿæ€ç³»ç»Ÿä¸­éƒ¨ç½²å’Œç®¡ç†å®¹å™¨ã€‚Amazon Elastic Kubernetes Services (Amazon EKS) Blueprints å’Œ Amazon EKS Anywhere ç­‰å·¥å…·ä»¥åŠå…¶ä»–æ‰˜ç®¡ Kubernetes æœåŠ¡ä½¿å›¢é˜Ÿå¯ä»¥è½»æ¾åœ°åœ¨äº‘ä¸­å’Œæœ¬åœ°è¿è¡Œ Kubernetes é›†ç¾¤ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/container-insights-2022/008vxvgGgy1h7wbyje5nkj30ku0ce757_hu4078896352302961886.webp 400w,
               /blog/container-insights-2022/008vxvgGgy1h7wbyje5nkj30ku0ce757_hu10283414410459016190.webp 760w,
               /blog/container-insights-2022/008vxvgGgy1h7wbyje5nkj30ku0ce757_hu14418854862505600162.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/container-insights-2022/008vxvgGgy1h7wbyje5nkj30ku0ce757_hu4078896352302961886.webp&#34;
               width=&#34;750&#34;
               height=&#34;446&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;â€œåœ¨ AWSï¼Œæˆ‘ä»¬è‡´åŠ›äºä¸ºå®¢æˆ·æä¾›ç®€åŒ–çš„ Kubernetes ä½“éªŒï¼Œä»¥ä¾¿ä»–ä»¬å¯ä»¥è½»æ¾ç®¡ç†å’Œæ‰©å±•é›†ç¾¤ï¼ŒåŒæ—¶å—ç›Šäºå®Œå…¨æ‰˜ç®¡çš„ AWS æœåŠ¡çš„å®‰å…¨æ€§å’Œå¼¹æ€§ã€‚Amazon EKS Blueprints å’Œ Amazon EKS Anywhere ç­‰æ–°åŠŸèƒ½ä½¿å®¢æˆ·èƒ½å¤Ÿæ›´å¿«ã€æ›´è½»æ¾åœ°è·¨ AWS å’Œæœ¬åœ°ç¯å¢ƒé…ç½®å’Œéƒ¨ç½² Kubernetes é›†ç¾¤ï¼Œå› æ­¤ä»–ä»¬å¯ä»¥åœ¨ä»»ä½•éœ€è¦çš„åœ°æ–¹è·å¾—ç›¸åŒã€ä¸€è‡´çš„ Amazon EKS ä½“éªŒï¼Œä»¥æœ€å¥½åœ°æ”¯æŒä»–ä»¬çš„åº”ç”¨ç¨‹åºå’Œæœ€ç»ˆç”¨æˆ·ã€‚â€&lt;/p&gt;
&lt;p&gt;â€” Barry Cooksï¼ŒAmazon Web Services Kubernetes å‰¯æ€»è£&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;è¶‹åŠ¿-2æ— æœåŠ¡å™¨å®¹å™¨æŠ€æœ¯åœ¨æ‰€æœ‰ä¸»è¦å…¬å…±äº‘ä¸­ç»§ç»­æµè¡Œ&#34;&gt;è¶‹åŠ¿ 2ï¼šæ— æœåŠ¡å™¨å®¹å™¨æŠ€æœ¯åœ¨æ‰€æœ‰ä¸»è¦å…¬å…±äº‘ä¸­ç»§ç»­æµè¡Œ&lt;/h2&gt;
&lt;p&gt;æ‰€æœ‰ä¸»è¦äº‘æä¾›å•†ï¼ˆåŒ…æ‹¬ AWS App Runnerã€AWS Fargateã€Azure Container Appsã€Azure Container Instances (ACI) å’Œ Google Cloud Runï¼‰å¯¹æ— æœåŠ¡å™¨å®¹å™¨æŠ€æœ¯çš„ä½¿ç”¨ç‡ä» 2020 å¹´çš„ 21% å¢åŠ åˆ° 2022 å¹´çš„ 36%ï¼ˆå¹´åˆè‡³ä»Šï¼‰ã€‚è¿™ä¸æˆ‘ä»¬åœ¨ä¹‹å‰çš„ç ”ç©¶ä¸­çœ‹åˆ°çš„å¢é•¿ç›¸å‘¼åº”ï¼Œå…¶ä¸­åŒ…æ‹¬ Amazon ECS ç”¨æˆ·è½¬å‘ AWS Fargateã€‚&lt;/p&gt;
&lt;p&gt;å®¢æˆ·å°†å‡å°‘é…ç½®å’Œç®¡ç†åº•å±‚åŸºç¡€è®¾æ–½çš„éœ€æ±‚åˆ—ä¸ºå®¹å™¨é‡‡ç”¨æ— æœåŠ¡å™¨æŠ€æœ¯çš„ä¸»è¦åŸå› ä¹‹ä¸€ã€‚é‚£äº›ä¸ä½¿ç”¨æ— æœåŠ¡å™¨æŠ€æœ¯çš„å®¢æˆ·æ›´å–œæ¬¢ä»ç®¡ç†è‡ªå·±çš„åŸºç¡€æ¶æ„ä¸­è·å¾—çš„æ§åˆ¶åŠ›å’Œçµæ´»æ€§ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/container-insights-2022/008vxvgGgy1h7wc0jp6mjj30ku0cewff_hu820837707082465627.webp 400w,
               /blog/container-insights-2022/008vxvgGgy1h7wc0jp6mjj30ku0cewff_hu221623317289408729.webp 760w,
               /blog/container-insights-2022/008vxvgGgy1h7wc0jp6mjj30ku0cewff_hu15726130732652852007.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/container-insights-2022/008vxvgGgy1h7wc0jp6mjj30ku0cewff_hu820837707082465627.webp&#34;
               width=&#34;750&#34;
               height=&#34;446&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;è¶‹åŠ¿-3å¤šä¸ªäº‘æä¾›å•†çš„ä½¿ç”¨éšç€ç»„ç»‡è§„æ¨¡çš„å¢åŠ è€Œå¢åŠ &#34;&gt;è¶‹åŠ¿ 3ï¼šå¤šä¸ªäº‘æä¾›å•†çš„ä½¿ç”¨éšç€ç»„ç»‡è§„æ¨¡çš„å¢åŠ è€Œå¢åŠ &lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬çš„æ•°æ®æ˜¾ç¤ºï¼Œè¶…è¿‡ 30% çš„ä½¿ç”¨ 1,000 å°æˆ–æ›´å¤šä¸»æœºçš„å®¹å™¨ç»„ç»‡åœ¨å¤šä¸ªäº‘ä¸­å·¥ä½œï¼Œå¹¶ä¸”ç»„ç»‡è¿è¡Œçš„å®¹å™¨è¶Šå°‘ï¼Œå¤šäº‘ä½¿ç”¨ç‡æœ€ä½ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å‘ç°å¤šäº‘ç»„ç»‡å¹³å‡æ‹¥æœ‰æ¯”å•äº‘ç»„ç»‡æ›´å¤šçš„å®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/container-insights-2022/008vxvgGgy1h7wc690cy0j30ku0ce750_hu2002788632623474832.webp 400w,
               /blog/container-insights-2022/008vxvgGgy1h7wc690cy0j30ku0ce750_hu10540423688120754754.webp 760w,
               /blog/container-insights-2022/008vxvgGgy1h7wc690cy0j30ku0ce750_hu10547135402856979507.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/container-insights-2022/008vxvgGgy1h7wc690cy0j30ku0ce750_hu2002788632623474832.webp&#34;
               width=&#34;750&#34;
               height=&#34;446&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;è¶‹åŠ¿-4kubernetes-ingress-ä½¿ç”¨ç‡æ­£åœ¨ä¸Šå‡&#34;&gt;è¶‹åŠ¿ 4ï¼šKubernetes Ingress ä½¿ç”¨ç‡æ­£åœ¨ä¸Šå‡&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†å¤§è§„æ¨¡ç®¡ç†æ¥è‡ªé›†ç¾¤å¤–éƒ¨çš„è¯·æ±‚ï¼Œç®¡ç†å‘˜ç»å¸¸ä½¿ç”¨ Ingress æ¥é…ç½®åˆ°é›†ç¾¤ä¸­å¤šä¸ªæœåŠ¡çš„è·¯ç”±ã€‚å¦‚ä»Šï¼Œè¶…è¿‡ 35% çš„ç»„ç»‡ä½¿ç”¨ Ingressï¼Œè‡ª 2020 å¹´ 8 æœˆ Kubernetes 1.19 ç‰ˆæœ¬å‘å¸ƒä»¥æ¥ï¼ŒIngress å·²ç»æ™®éå¯ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;éšç€æˆ‘ä»¬çš„å®¢æˆ·æ“ä½œæ›´å¤šçš„é›†ç¾¤å’Œ Podï¼Œä»–ä»¬åœ¨è·¯ç”±å’Œç½‘ç»œç®¡ç†æ–¹é¢é¢ä¸´ç€è¶Šæ¥è¶Šå¤æ‚çš„é—®é¢˜ã€‚è®¸å¤š Kubernetes çš„æ—©æœŸé‡‡ç”¨è€…ä½¿ç”¨äº‘æä¾›çš„è´Ÿè½½å‡è¡¡å™¨å°†æµé‡è·¯ç”±åˆ°ä»–ä»¬çš„æœåŠ¡ã€‚ä½† Ingress é€šå¸¸æ›´å…·æˆæœ¬æ•ˆç›Šï¼Œå¹¶ä¸”è‡ªå‘å¸ƒä»¥æ¥å…¶é‡‡ç”¨ç‡ç¨³æ­¥æé«˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://gateway-api.sigs.k8s.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes Gateway API&lt;/a&gt;ï¼ˆäº 2022 å¹´ 7 æœˆå®Œæˆæµ‹è¯•ç‰ˆï¼‰æ˜¯å®¹å™¨ç½‘ç»œç®¡ç†å‘å±•çš„ä¸‹ä¸€æ­¥ã€‚Gateway API æä¾›é«˜çº§ç½‘ç»œåŠŸèƒ½ï¼ŒåŒ…æ‹¬ä½¿ç”¨è‡ªå®šä¹‰èµ„æºå’Œä½¿ç”¨ API èµ„æºå¯¹ç»„ç»‡è§’è‰²å»ºæ¨¡çš„é¢å‘è§’è‰²çš„è®¾è®¡ã€‚æˆ‘ä»¬æœŸå¾…çœ‹åˆ° Gateway API æ˜¯å¦ä¼šå–ä»£ Ingressï¼Œæˆ–è€…è¿™ä¸¤ç§æŠ€æœ¯æ˜¯å¦å¹¶æ’ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/container-insights-2022/008vxvgGgy1h7wc8i70cdj30ku0cemxs_hu13945575724311191908.webp 400w,
               /blog/container-insights-2022/008vxvgGgy1h7wc8i70cdj30ku0cemxs_hu5542078478041936092.webp 760w,
               /blog/container-insights-2022/008vxvgGgy1h7wc8i70cdj30ku0cemxs_hu16630714657264543880.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/container-insights-2022/008vxvgGgy1h7wc8i70cdj30ku0cemxs_hu13945575724311191908.webp&#34;
               width=&#34;750&#34;
               height=&#34;446&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;è¶‹åŠ¿-5æœåŠ¡ç½‘æ ¼ä»å¤„äºæ—©æœŸé˜¶æ®µistio-ä¸»å¯¼ä½¿ç”¨&#34;&gt;è¶‹åŠ¿ 5ï¼šæœåŠ¡ç½‘æ ¼ä»å¤„äºæ—©æœŸé˜¶æ®µï¼ŒIstio ä¸»å¯¼ä½¿ç”¨&lt;/h2&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼æä¾›æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€è¶…æ—¶å’Œé‡è¯•ï¼Œå¹¶å…è®¸ç®¡ç†å‘˜ç®¡ç†é›†ç¾¤çš„å®‰å…¨æ€§å¹¶ç›‘æ§å…¶æ€§èƒ½ã€‚æˆ‘ä»¬ä¹‹å‰çš„ç ”ç©¶è¯´æ˜äº†æœåŠ¡ç½‘æ ¼çš„æ—©æœŸé‡‡ç”¨ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„åˆå§‹æ¨¡å¼åŸºæœ¬ä¸Šæ²¡æœ‰å˜åŒ–ã€‚åœ¨æˆ‘ä»¬çš„å®¢æˆ·ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦çœ‹åˆ° Istio å’Œ Linkerdï¼Œå…¶ä¸­ Istio çš„å—æ¬¢è¿ç¨‹åº¦æ˜¯ Linkerd çš„ä¸‰å€å¤šã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/container-insights-2022/008vxvgGgy1h7wc9fn7llj30ku0cewf3_hu18271699145528997490.webp 400w,
               /blog/container-insights-2022/008vxvgGgy1h7wc9fn7llj30ku0cewf3_hu11020369557059959021.webp 760w,
               /blog/container-insights-2022/008vxvgGgy1h7wc9fn7llj30ku0cewf3_hu11703549338582979776.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/container-insights-2022/008vxvgGgy1h7wc9fn7llj30ku0cewf3_hu18271699145528997490.webp&#34;
               width=&#34;750&#34;
               height=&#34;446&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;â€œæœåŠ¡ç½‘æ ¼å·²ç»è¯æ˜äº†ä¸ºä¼ä¸šä¸­çš„æµé‡æä¾›ä¸€è‡´çš„å®‰å…¨æ€§ã€å¯è§‚æµ‹æ€§å’Œæ§åˆ¶çš„ä»·å€¼ã€‚Istio å·²æ˜ç¡®å°†è‡ªå·±ç¡®ç«‹ä¸ºé¢†å…ˆçš„ç½‘æ ¼è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä¸ºç¤¾åŒºä¸ºå®ç°è¿™ä¸€ç›®æ ‡æ‰€åšçš„å·¥ä½œæ„Ÿåˆ°è‡ªè±ªã€‚æœ€è¿‘å®Œæˆçš„å¯¹ CNCF çš„ Istio æèµ å°†åœ¨è¿™ä¸€æˆåŠŸçš„åŸºç¡€ä¸Šå‘å±•å£®å¤§æˆ‘ä»¬çš„ç¤¾åŒºã€‚â€&lt;/p&gt;
&lt;p&gt;â€”â€”Louis Ryanï¼ŒIstio çš„è”åˆåˆ›å§‹äººå…¼è°·æ­Œé¦–å¸­å·¥ç¨‹å¸ˆ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;è¶‹åŠ¿-6å¤§å¤šæ•°ä¸»æœºä½¿ç”¨è¶…è¿‡-18-ä¸ªæœˆçš„-kubernetes-ç‰ˆæœ¬&#34;&gt;è¶‹åŠ¿ 6ï¼šå¤§å¤šæ•°ä¸»æœºä½¿ç”¨è¶…è¿‡ 18 ä¸ªæœˆçš„ Kubernetes ç‰ˆæœ¬&lt;/h2&gt;
&lt;p&gt;Kubernetes æ¯å¹´å‘å¸ƒä¸‰ä¸ªæ–°ç‰ˆæœ¬ï¼Œä¸ºç”¨æˆ·æä¾›æ–°åŠŸèƒ½ã€å®‰å…¨æ”¹è¿›å’Œé”™è¯¯ä¿®å¤ã€‚æˆ‘ä»¬åœ¨ä¹‹å‰çš„ç ”ç©¶ä¸­çœ‹åˆ°ï¼Œç”¨æˆ·é€šå¸¸æ›´æ„¿æ„ç­‰å¾…ä¸€å¹´å¤šæ‰èƒ½é‡‡ç”¨è¿™äº›æ–°ç‰ˆæœ¬ã€‚æˆ‘ä»¬ä»è½¶äº‹ä¸­äº†è§£åˆ°ï¼Œä¸€äº›å®¢æˆ·å»¶è¿Ÿçš„åŸå› æ˜¯ä¸ºäº†ç¡®ä¿ä»–ä»¬çš„é›†ç¾¤çš„ç¨³å®šæ€§å’Œä¸ API ç‰ˆæœ¬çš„å…¼å®¹æ€§ã€‚å¦‚ä»Šï¼Œä½¿ç”¨æœ€å¤šçš„ç‰ˆæœ¬æ˜¯ v1.21ï¼Œå®ƒäº 2021 å¹´ 4 æœˆå‘å¸ƒï¼Œå¹¶äºä»Šå¹´æ—©äº›æ—¶å€™æ­£å¼è¿‡äº†ç”Ÿå‘½å‘¨æœŸç»ˆç»“æ—¥ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/container-insights-2022/008vxvgGgy1h7wcb5u0w5j30ku0cemy5_hu7884426757635580643.webp 400w,
               /blog/container-insights-2022/008vxvgGgy1h7wcb5u0w5j30ku0cemy5_hu2554215774634145209.webp 760w,
               /blog/container-insights-2022/008vxvgGgy1h7wcb5u0w5j30ku0cemy5_hu5904689561653064235.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/container-insights-2022/008vxvgGgy1h7wcb5u0w5j30ku0cemy5_hu7884426757635580643.webp&#34;
               width=&#34;750&#34;
               height=&#34;446&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;è¶‹åŠ¿-7è¶…è¿‡-30-çš„è¿è¡Œ-containerd-çš„ä¸»æœºä½¿ç”¨ä¸å—æ”¯æŒçš„ç‰ˆæœ¬&#34;&gt;è¶‹åŠ¿ 7ï¼šè¶…è¿‡ 30% çš„è¿è¡Œ containerd çš„ä¸»æœºä½¿ç”¨ä¸å—æ”¯æŒçš„ç‰ˆæœ¬&lt;/h2&gt;
&lt;p&gt;å…ˆå‰çš„ç ”ç©¶è¡¨æ˜ containerd çš„ä½¿ç”¨æœ‰æ‰€å¢åŠ ï¼Œè¿™æ˜¯ç»„ç»‡å¯ä»¥é‡‡ç”¨çš„ç¬¦åˆ CRI çš„è¿è¡Œæ—¶ä¹‹ä¸€ï¼Œå› ä¸º Dockershim æ­£åœ¨è¢«å¼ƒç”¨ã€‚æˆ‘ä»¬å‘ç°åªæœ‰å¤§çº¦ 69% çš„ containerd ä¸»æœºä½¿ç”¨çš„æ˜¯ 1.5 æˆ– 1.6 ç‰ˆæœ¬ï¼Œè¿™æ˜¯ç§¯ææ”¯æŒçš„ç‰ˆæœ¬ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¤§çº¦ 31% çš„ containerd ä¸»æœºæ­£åœ¨ä½¿ç”¨ 1.4 æˆ–æ›´æ—©çš„ç‰ˆæœ¬ï¼Œè¿™äº›ç‰ˆæœ¬å·²ç»è¿‡äº†ç”Ÿå‘½å‘¨æœŸçš„ç»ˆç»“æ—¥ã€‚&lt;/p&gt;
&lt;p&gt;è¿è¡Œè¾ƒæ—§çš„è½¯ä»¶ç‰ˆæœ¬ä¼šå¸¦æ¥æœ‰å…³å®‰å…¨æ€§å’Œåˆè§„æ€§çš„é—®é¢˜ï¼Œå¹¶ä¸”åœ¨å®¹å™¨è¿è¡Œæ—¶çš„æƒ…å†µä¸‹ï¼Œä¼šå¸¦æ¥å®¹å™¨é€ƒé€¸ç­‰æ¼æ´çš„é£é™©ã€‚è®¸å¤šä¸»æœºä½¿ç”¨ä¸å—æ”¯æŒçš„å®¹å™¨è¿è¡Œæ—¶ç‰ˆæœ¬è¿™ä¸€äº‹å®å‡¸æ˜¾äº†ç»„ç»‡åœ¨è¿è¡Œé€‚å½“çš„å·¥å…·ä»¥ç»´æŠ¤å®¹å™¨å®‰å…¨æ€§å’Œåˆè§„æ€§æ–¹é¢é¢ä¸´çš„æŒ‘æˆ˜ã€‚æ— æœåŠ¡å™¨å®¹å™¨æŠ€æœ¯é™ä½äº†è¿‡æ—¶è¿è¡Œæ—¶çš„é£é™©å’Œæ‰‹åŠ¨æ›´æ–°çš„è´Ÿæ‹…ï¼Œè¿™å¯èƒ½æ˜¯æˆ‘ä»¬çœ‹åˆ°æ‰€æœ‰äº‘éƒ½è½¬å‘æ— æœåŠ¡å™¨å®¹å™¨çš„åŸå› ä¹‹ä¸€ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/container-insights-2022/008vxvgGgy1h7wcc9pjexj30ku0ce74y_hu5116801282910452367.webp 400w,
               /blog/container-insights-2022/008vxvgGgy1h7wcc9pjexj30ku0ce74y_hu15811047954641942892.webp 760w,
               /blog/container-insights-2022/008vxvgGgy1h7wcc9pjexj30ku0ce74y_hu16562159669739141616.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/container-insights-2022/008vxvgGgy1h7wcc9pjexj30ku0ce74y_hu5116801282910452367.webp&#34;
               width=&#34;750&#34;
               height=&#34;446&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;è¶‹åŠ¿-8è®¿é—®ç®¡ç†æ­£åœ¨æ”¹è¿›ä½†ä»ç„¶æ˜¯ä¸€ä¸ªæŒ‘æˆ˜&#34;&gt;è¶‹åŠ¿ 8ï¼šè®¿é—®ç®¡ç†æ­£åœ¨æ”¹è¿›ï¼Œä½†ä»ç„¶æ˜¯ä¸€ä¸ªæŒ‘æˆ˜&lt;/h2&gt;
&lt;p&gt;Kubernetes ç®¡ç†å‘˜ä½¿ç”¨åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC) æ¥å…è®¸ä¸»ä½“ï¼ˆç”¨æˆ·ã€ç»„æˆ–æœåŠ¡è´¦æˆ·ï¼‰è®¿é—®æˆ–ä¿®æ”¹é›†ç¾¤ä¸­çš„èµ„æºã€‚æ ¹æ®å®‰å…¨æœ€ä½³å®è·µï¼Œä¸»ä½“åº”è¯¥åªæœ‰å¿…è¦çš„æƒé™ï¼Œå¹¶ä¸”ç®¡ç†å‘˜åœ¨æˆäºˆä¸å‡çº§é£é™©ç›¸å…³çš„ RBAC æƒé™æ—¶å¿…é¡»è°¨æ…ã€‚å…¶ä¸­åŒ…æ‹¬å…è®¸ä¸»ä½“åˆ—å‡ºæ‰€æœ‰æœºå¯†æˆ–åˆ›å»ºå·¥ä½œè´Ÿè½½ã€è¯ä¹¦æˆ–ä»¤ç‰Œè¯·æ±‚çš„æƒé™ï¼Œè¿™äº›è¯·æ±‚å¯ä»¥å…è®¸ä»–ä»¬ä¿®æ”¹è‡ªå·±çš„æƒé™ã€‚&lt;/p&gt;
&lt;p&gt;å¥½æ¶ˆæ¯æ˜¯ï¼Œéšç€ç»„ç»‡éƒ¨ç½²æ›´å¤šé›†ç¾¤ï¼Œè¿™äº›é›†ç¾¤ä¸­ä½¿ç”¨è¿‡åº¦å®½æ¾ç‰¹æƒçš„ç™¾åˆ†æ¯”æ­£åœ¨ä¸‹é™ã€‚æˆ‘ä»¬æ€€ç–‘éšç€ç»„ç»‡é‡‡ç”¨æƒé™å®¡è®¡ç­‰å®‰å…¨å®è·µå’Œè‡ªåŠ¨åŒ– RBAC æ‰«æä»ªç­‰å·¥å…·ï¼Œè¿™ä¸€æ•°å­—æ­£åœ¨ä¸‹é™ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å‘ç°å¤§çº¦ 40% çš„é›†ç¾¤ä»ç„¶ä½¿ç”¨å®½æ¾çš„æƒé™ï¼Œè¿™ä¼šå¸¦æ¥å®‰å…¨é£é™©ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/container-insights-2022/008vxvgGgy1h7wcdev59yj30ku0cet9l_hu10514464501877942294.webp 400w,
               /blog/container-insights-2022/008vxvgGgy1h7wcdev59yj30ku0cet9l_hu4965472205818328633.webp 760w,
               /blog/container-insights-2022/008vxvgGgy1h7wcdev59yj30ku0cet9l_hu10220171299495715387.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/container-insights-2022/008vxvgGgy1h7wcdev59yj30ku0cet9l_hu10514464501877942294.webp&#34;
               width=&#34;750&#34;
               height=&#34;446&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;è¶‹åŠ¿-9nginxredis-å’Œ-postgres-å†æ¬¡æˆä¸ºæœ€å—æ¬¢è¿çš„å®¹å™¨é•œåƒ&#34;&gt;è¶‹åŠ¿ 9ï¼šNGINXã€Redis å’Œ Postgres å†æ¬¡æˆä¸ºæœ€å—æ¬¢è¿çš„å®¹å™¨é•œåƒ&lt;/h2&gt;
&lt;p&gt;æˆªè‡³ 2022 å¹´ 9 æœˆï¼Œæœ€æµè¡Œçš„ç°æˆå®¹å™¨é•œåƒæ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;NGINXï¼šè¿™åˆæ˜¯æœ€æµè¡Œçš„å®¹å™¨é•œåƒã€‚NGINX ä¸ºè¿‘ 50% çš„ä½¿ç”¨å®¹å™¨çš„ç»„ç»‡æä¾›ç¼“å­˜ã€è´Ÿè½½å¹³è¡¡å’Œä»£ç†åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;Redisï¼šç»„ç»‡å¯ä»¥åœ¨å®¹å™¨ä¸­éƒ¨ç½² Redisï¼Œç”¨ä½œé”®å€¼æ•°æ®å­˜å‚¨ã€ç¼“å­˜æˆ–æ¶ˆæ¯ä»£ç†ã€‚&lt;/li&gt;
&lt;li&gt;Postgresï¼šè¿™ä¸ªå…³ç³»æ•°æ®åº“çš„ä½¿ç”¨æ¯”å»å¹´ç•¥æœ‰å¢é•¿ã€‚&lt;/li&gt;
&lt;li&gt;Elasticsearchï¼šè¿™ä¸ªé«˜æ€§èƒ½çš„æ–‡æ¡£å­˜å‚¨å’Œæœç´¢å¼•æ“ä»ç„¶æ˜¯æœ€æµè¡Œçš„é•œåƒä¹‹ä¸€ã€‚&lt;/li&gt;
&lt;li&gt;Kafkaï¼šç»„ç»‡å¯ä»¥é€šè¿‡åœ¨å®¹å™¨ä¸­éƒ¨ç½² Kafka è½»æ¾åœ°å°†äº‹ä»¶æµåŠŸèƒ½æ·»åŠ åˆ°åº”ç”¨ç¨‹åºä¸­ã€‚&lt;/li&gt;
&lt;li&gt;RabbitMQï¼šRabbitMQ åœ¨åŸºäºå¾®æœåŠ¡çš„åº”ç”¨ç¨‹åºä¸­æ”¯æŒè§£è€¦æ¶æ„ã€‚&lt;/li&gt;
&lt;li&gt;MongoDBï¼šMongoDB ä»ç„¶æ˜¯æœ€æµè¡Œçš„ NoSQL æ•°æ®åº“ä¹‹ä¸€ã€‚&lt;/li&gt;
&lt;li&gt;MySQLï¼šè¿™ä¸ªå¼€æºæ•°æ®åº“çš„æ’åæ¯”ä»¥å‰ä½ã€‚ä½†æ˜¯ MySQL çš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ä½¿å…¶åœ¨æœ€æµè¡Œçš„å®¹å™¨é•œåƒåˆ—è¡¨ä¸­æŒç»­å æœ‰ä¸€å¸­ä¹‹åœ°ã€‚&lt;/li&gt;
&lt;li&gt;Calicoï¼šCalico æ˜¯ä¸€ä¸ªç½‘ç»œæä¾›å•†ï¼Œè®©ç®¡ç†å‘˜å¯ä»¥ç®¡ç†å…¶ Kubernetes é›†ç¾¤å†…ç½‘ç»œçš„å®‰å…¨æ€§ã€‚&lt;/li&gt;
&lt;li&gt;GitLabï¼šä¸ºäº†å¸®åŠ©å›¢é˜Ÿé‡‡ç”¨å’Œç»´æŠ¤ DevOps å®è·µï¼ŒGitLab æä¾›äº†å­˜å‚¨åº“ç®¡ç†ã€é—®é¢˜è·Ÿè¸ªå’Œ CI/CD ç®¡é“ã€‚&lt;/li&gt;
&lt;li&gt;Vaultï¼šå›¢é˜Ÿå¯ä»¥ä½¿ç”¨ Vault æ¥ç®€åŒ–æœºå¯†ç®¡ç†å¹¶å¸®åŠ©ç»´æŠ¤å®‰å…¨çš„åº”ç”¨ç¨‹åºã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/container-insights-2022/008vxvgGgy1h7wcim7nrxj30ku0cedgh_hu7778555536475499852.webp 400w,
               /blog/container-insights-2022/008vxvgGgy1h7wcim7nrxj30ku0cedgh_hu5508975403228929622.webp 760w,
               /blog/container-insights-2022/008vxvgGgy1h7wcim7nrxj30ku0cedgh_hu1603001076238228144.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/container-insights-2022/008vxvgGgy1h7wcim7nrxj30ku0cedgh_hu7778555536475499852.webp&#34;
               width=&#34;750&#34;
               height=&#34;446&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ Kubernetes StatefulSets ä¸­ï¼Œæˆ‘ä»¬å‘ç° Redisã€Postgresã€Elasticsearchã€RabbitMQ å’Œ Kafka æ˜¯æœ€å¸¸éƒ¨ç½²çš„é•œåƒã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/container-insights-2022/008vxvgGgy1h7wciyjri3j30ku0cet9d_hu12309459542534645837.webp 400w,
               /blog/container-insights-2022/008vxvgGgy1h7wciyjri3j30ku0cet9d_hu12086625783955694832.webp 760w,
               /blog/container-insights-2022/008vxvgGgy1h7wciyjri3j30ku0cet9d_hu6510006890745605242.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/container-insights-2022/008vxvgGgy1h7wciyjri3j30ku0cet9d_hu12309459542534645837.webp&#34;
               width=&#34;750&#34;
               height=&#34;446&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å½»åº•ææ‡‚ Kubernetes ä¸­çš„è®¤è¯</title>
      <link>https://cloudnativecn.com/blog/authentication-k8s/</link>
      <pubDate>Thu, 15 Sep 2022 12:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/authentication-k8s/</guid>
      <description>&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡é¦–å…ˆä»‹ç»äº† K8s çš„è®¿é—®æ§åˆ¶è¿‡ç¨‹ï¼Œå¹¶å¯¹ K8s è®¤è¯çš„ç”¨æˆ·æ¨¡å‹è¿›è¡Œè®²è§£ã€‚æœ€åå¯¹è®¤è¯è¿‡ç¨‹ä¸­çš„ç”¨æˆ·è¯ä¹¦è®¤è¯ä»¥åŠ Service Account Token è®¤è¯è¿›è¡Œä¸¾ä¾‹å‰–æã€‚&lt;/p&gt;
&lt;h2 id=&#34;k8s-api-è¯·æ±‚è®¿é—®æ§åˆ¶çš„è¿‡ç¨‹&#34;&gt;K8s API è¯·æ±‚è®¿é—®æ§åˆ¶çš„è¿‡ç¨‹&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“ï¼Œä¸è®ºæ˜¯é€šè¿‡ kubectl å®¢æˆ·ç«¯è¿˜æ˜¯ REST è¯·æ±‚è®¿é—® K8s é›†ç¾¤ï¼Œæœ€ç»ˆéƒ½éœ€è¦ç»è¿‡ API Server æ¥è¿›è¡Œèµ„æºçš„æ“ä½œï¼Œç”Ÿæ•ˆç»“æœä¼šè¢«æŒä¹…åŒ–è‡³ etcd ä¸­ï¼Œetcd ä¸­çš„æ•°æ®å®‰å…¨å°±å˜å¾—ååˆ†é‡è¦ã€‚ä¸ºäº†ä¿è¯ etcd çš„å®‰å…¨æ€§ï¼ŒK8s åªå…è®¸ API Server å»è®¿é—®æ“ä½œ etcdï¼Œæ­¤æ—¶ API Server å°±æ‹…è´Ÿèµ·äº†æ•´ä¸ª etcd çš„å®‰å…¨ã€‚é‚£ä¹ˆ K8s æ˜¯å¦‚ä½•ç®¡æ§å’Œä¿éšœ API Server è®¿é—®è¿‡ç¨‹çš„å®‰å…¨çš„å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å¦‚ä¸‹å›¾ 1 æ‰€ç¤ºï¼Œæ•´ä¸ªè¿‡ç¨‹å¯ä»¥åˆ†ä¸º 4 ä¸ªé˜¶æ®µ&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-1-k8s-api-è¯·æ±‚è®¿é—®è¿‡ç¨‹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 1 K8s API è¯·æ±‚è®¿é—®è¿‡ç¨‹&#34; srcset=&#34;
               /blog/authentication-k8s/1_hu7214143804038122092.webp 400w,
               /blog/authentication-k8s/1_hu6756672019732618137.webp 760w,
               /blog/authentication-k8s/1_hu15048946325276729985.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/authentication-k8s/1_hu7214143804038122092.webp&#34;
               width=&#34;525&#34;
               height=&#34;295&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 1 K8s API è¯·æ±‚è®¿é—®è¿‡ç¨‹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ•´ä½“è¿‡ç¨‹ç®€è¿°ï¼šè¯·æ±‚å‘èµ·æ–¹è¿›è¡Œ K8s API è¯·æ±‚ï¼Œç»è¿‡ Authenticationï¼ˆè®¤è¯ï¼‰ã€Authorizationï¼ˆé‰´æƒï¼‰ã€AdmissionControlï¼ˆå‡†å…¥æ§åˆ¶ï¼‰ä¸‰ä¸ªé˜¶æ®µçš„æ ¡éªŒï¼Œæœ€åæŠŠè¯·æ±‚è½¬åŒ–ä¸ºå¯¹ K8s å¯¹è±¡çš„å˜æ›´æ“ä½œæŒä¹…åŒ–è‡³ etcd ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è®¤è¯é˜¶æ®µ&lt;/strong&gt;ã€‚å½“è¯·æ±‚å‘èµ·æ–¹å»ºç«‹ä¸ API Server çš„å®‰å…¨è¿æ¥åï¼Œè¿›å…¥è¯·æ±‚çš„è®¤è¯é˜¶æ®µï¼ˆå›¾ä¸­æ­¥éª¤ 1ï¼‰ã€‚è®¤è¯çš„æ–¹å¼ä¸»è¦æœ‰ï¼šå®¢æˆ·ç«¯è¯ä¹¦ã€å¯†ç ã€æ™®é€š tokenã€bootstrap token å’Œ JWT è®¤è¯ (ä¸»è¦ç”¨äº Service Account)ã€‚è®¤è¯æ¨¡å—ä¼šæ£€æŸ¥è¯·æ±‚å¤´æˆ–è€…å®¢æˆ·ç«¯è¯ä¹¦çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶é…ç½®ä¸€ç§æˆ–å‡ ç§æ–¹å¼å¯¹è¯·æ±‚è¿›è¡Œè®¤è¯ã€‚å¤šç§è®¤è¯æ–¹å¼ä¼šè¢«ä¾æ¬¡æ‰§è¡Œï¼Œåªè¦ä¸€ç§æ–¹å¼é€šè¿‡ï¼Œè¯·æ±‚ä¾¿å¾—åˆ°åˆæ³•è®¤è¯ã€‚å½“æ‰€æœ‰æ–¹å¼éƒ½æœªé€šè¿‡æ—¶ï¼Œä¼šè¿”å› 401 çŠ¶æ€ç å¹¶ä¸­æ–­è¯·æ±‚ã€‚è®¤è¯è§£å†³çš„é—®é¢˜æ˜¯æ ¡éªŒè®¿é—®æ–¹æ˜¯å¦åˆæ³•å¹¶è¯†åˆ«å…¶èº«ä»½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é‰´æƒé˜¶æ®µ&lt;/strong&gt;ã€‚K8s API è®¿é—®è¯·æ±‚å¿…é¡»åŒ…æ‹¬è¯·æ±‚è€…çš„ç”¨æˆ·åã€è¯·æ±‚çš„æ“ä½œä»¥åŠæ“ä½œå¯¹è±¡ï¼Œè¯¥é˜¶æ®µå°±æ˜¯å¯¹ç”¨æˆ·çš„æ“ä½œåˆæ³•æ€§è¿›è¡Œæ ¡éªŒã€‚å¦‚æœç°æœ‰ç­–ç•¥å£°æ˜ç”¨æˆ·å…·æœ‰å®Œæˆè¯·æ±‚æ“ä½œçš„æƒé™ï¼Œåˆ™å¯¹è¯·æ±‚è¿›è¡Œæˆæƒã€‚K8s æ”¯æŒ ABAC æ¨¡å¼ã€RBAC æ¨¡å¼ã€Webhook æ¨¡å¼ç­‰å¤šç§æˆæƒæ¨¡å—ã€‚åŒæ ·çš„ï¼Œå½“å¤šä¸ªæˆæƒæ¨¡å—è¢«é…ç½®æ—¶ï¼Œè¯·æ±‚åªè¦æ»¡è¶³å…¶ä¸­ä»»æ„ä¸€ç§æˆæƒè§„åˆ™ä¾¿ä¼šè¢«æ”¾è¡Œï¼Œåä¹‹ï¼ŒAPI Server ä¼šè¿”å› 403 çŠ¶æ€ç å¹¶ç»ˆæ­¢è¯¥è¯·æ±‚ã€‚é‰´æƒæ˜¯ä¸ºäº†åˆ¤åˆ«ç”¨æˆ·çš„æ“ä½œæƒé™èŒƒå›´ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å‡†å…¥æ§åˆ¶é˜¶æ®µ&lt;/strong&gt;ã€‚å‡†å…¥æ§åˆ¶æ˜¯è¯·æ±‚æ“ä½œè¢«æŒä¹…åŒ–åˆ° etcd ä¹‹å‰çš„â€œæ‹¦æˆªå™¨â€ã€‚å‡†å…¥æ§åˆ¶æ¨¡å—ç”±å¤šä¸ªâ€œå‡†å…¥æ§åˆ¶å™¨â€æ„æˆï¼Œâ€œå‡†å…¥æ§åˆ¶å™¨â€å°±æ˜¯ä¸€æ®µè‡ªå®šä¹‰ä»£ç ï¼Œå®ƒä»¬èƒ½å¤Ÿåœ¨è¯·æ±‚å¯¹ K8s åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤æˆ–è€…è¿æ¥ä¸€ä¸ª K8s å¯¹è±¡æ—¶ç”Ÿæ•ˆã€‚å®˜æ–¹è‡ªå¸¦äº† 30 å¤šä¸ªå‡†å…¥æ§åˆ¶å™¨å¯ä¾›ä½¿ç”¨ï¼ŒåŒæ—¶æ”¯æŒç”¨æˆ·æ‰©å±•ã€‚å‡†å…¥æ§åˆ¶å™¨çš„ä½œç”¨å¾€å¾€æ˜¯æ£€æŸ¥è¯·æ±‚çš„è§„èŒƒæ€§æˆ–è€…èµ‹äºˆä¸€äº›é»˜è®¤ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºä¸€ä¸ª pod æ—¶ï¼Œå‡†å…¥æ§åˆ¶å™¨ä¼šæ£€æŸ¥æäº¤çš„ä¿¡æ¯æ˜¯å¦ç¬¦åˆ pod èµ„æºçš„è§„èŒƒï¼Œå¹¶å¯¹è¯·æ±‚ä¸­æ²¡æœ‰æ˜ç¡®è§„å®šçš„å­—æ®µï¼Œè®¾ç½®å¯¹åº”çš„é»˜è®¤å€¼å¡«å……åˆ°è¯·æ±‚ä¸­ã€‚ä¸å‰ä¸¤ä¸ªé˜¶æ®µä¸åŒçš„æ˜¯ï¼Œåªè¦æœ‰ä¸€ä¸ªâ€œå‡†å…¥æ ¡éªŒâ€é€»è¾‘æœªé€šè¿‡ï¼Œé‚£ä¹ˆè¯·æ±‚å°±ä¼šè¢«æ‹’ç»ã€‚è‹¥è¯·æ±‚ä»…ä»…æ˜¯è¯»å–ä¸€ä¸ªå¯¹è±¡ï¼Œâ€œå‡†å…¥æ§åˆ¶å™¨â€å°†ä¸ä¼šç”Ÿæ•ˆã€‚å‡†å…¥æ§åˆ¶ä½œç”¨äº K8s ä¸­çš„å¯¹è±¡ï¼Œé€šè¿‡æ ¡éªŒè§„èŒƒå’Œé»˜è®¤å€¼çš„è®¾ç½®ï¼Œèƒ½å¤Ÿä¿è¯ç³»ç»Ÿçš„å®‰å…¨å¯é ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æŒä¹…åŒ–é˜¶æ®µ&lt;/strong&gt;ã€‚å½“æˆ‘ä»¬çš„è¯·æ±‚é€šè¿‡äº†å‰é¢ä¸‰ä¸ªé˜¶æ®µçš„æ ¡éªŒï¼Œå®ƒä¼šè¢«è½¬æ¢ä¸ºä¸€ä¸ª K8s å¯¹è±¡ç›¸åº”çš„å˜æ›´è¯·æ±‚ï¼Œæœ€ç»ˆæŒä¹…åŒ–åˆ° etcd ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè®¤è¯æˆæƒè¿‡ç¨‹åªå­˜åœ¨ HTTPS å½¢å¼çš„ API ä¸­ã€‚å³æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨ HTTP è¿æ¥åˆ° API Serverï¼Œæ˜¯ä¸ä¼šè¿›è¡Œè®¤è¯æˆæƒçš„ã€‚ä½† API Server çš„éå®‰å…¨è®¤è¯ç«¯å£ 8080 å·²ç»åœ¨ v1.12 ä¸­åºŸå¼ƒäº†ï¼Œå…¨é¢ä½¿ç”¨äº† HTTPSã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥è¯¦ç»†äº†è§£ä¸‹ K8s çš„è®¤è¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;k8s-çš„ç”¨æˆ·æ¨¡å‹&#34;&gt;K8s çš„ç”¨æˆ·æ¨¡å‹&lt;/h2&gt;
&lt;p&gt;ä»å›¾ 1 ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒK8s çš„ç”¨æˆ·ä¸»è¦åˆ†ä¸ºä¸¤ç±»ï¼šé€šè¿‡å®¢æˆ·ç«¯è¿›è¡Œè¿æ¥çš„äººç±»æ“ä½œè€…å’Œ K8s å†…è¯¸å¦‚è¿›ç¨‹ã€æ§åˆ¶å™¨ç­‰éäººç±»æ“ä½œçš„å®¢æˆ·ç«¯ã€‚æˆ‘ä»¬ç§°å‰è€…ä¸º Normal Usersï¼ˆå¸¸è§„ç”¨æˆ·ï¼‰ï¼Œåè€…ä¸º Service Accountï¼ˆæœåŠ¡è´¦æˆ·ï¼‰ã€‚å› ä¸º K8s å†…æ²¡æœ‰ä¸º Normal Users å®šä¹‰å­˜å‚¨å¯¹è±¡ï¼Œæˆ‘ä»¬æ— æ³•åƒæ“ä½œ pod ä¸€æ ·åœ¨ K8s å†…éƒ¨ç®¡ç†è¿™ç±»ç”¨æˆ·ï¼Œå®ƒä»¬é€šå¸¸æ˜¯ç”±å¤–éƒ¨æœåŠ¡è¿›è¡Œç®¡ç†ï¼Œå€Ÿç”±è¯ä¹¦å‡­è¯æˆ–è€…é™æ€é…ç½®æ–‡ä»¶è¿›è¡Œè®¤è¯ã€‚è€Œ Service Account å¯ç”± K8s API ç›´æ¥è¿›è¡Œç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹è¡¨ç»™å‡ºäº†å…¶ä¸»è¦åŒºåˆ«ï¼š&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;ç±»ç›®&lt;/th&gt;
          &lt;th&gt;Normal Users&lt;/th&gt;
          &lt;th&gt;Service Account&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;é’ˆå¯¹å¯¹è±¡&lt;/td&gt;
          &lt;td&gt;äººç±»ç”¨æˆ·&lt;/td&gt;
          &lt;td&gt;è¿›ç¨‹&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;èŒƒå›´&lt;/td&gt;
          &lt;td&gt;å…¨ cluster å”¯ä¸€&lt;/td&gt;
          &lt;td&gt;namespace&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;è®¾è®¡ç›®çš„&lt;/td&gt;
          &lt;td&gt;ä¸ä¼ä¸šæ•°æ®åº“åŒæ­¥ï¼Œåœ¨ç”¨æˆ·çº§åˆ«è¿›è¡Œæ“ä½œæƒé™çš„æ§åˆ¶&lt;/td&gt;
          &lt;td&gt;æ›´è½»é‡åŒ–ï¼Œåœ¨ä»»åŠ¡è¿›ç¨‹çº§åˆ«è¿›è¡Œç®¡æ§&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ä¸»è¦è®¤è¯æ–¹æ³•&lt;/td&gt;
          &lt;td&gt;Basic è®¤è¯ã€X509 è¯ä¹¦è®¤è¯&lt;/td&gt;
          &lt;td&gt;Service Account token è®¤è¯&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ä¾‹å­&lt;/td&gt;
          &lt;td&gt;æˆ‘ä»¬ä½¿ç”¨ kubectl æ“ä½œå®¢æˆ·ç«¯ï¼ŒK8s æ˜¯æŠŠæˆ‘ä»¬æ˜ å°„æˆ kubectl æ‰€ä½¿ç”¨å®¢æˆ·ç«¯è¯ä¹¦ä¸­ CN å­—æ®µæ‰€å¯¹åº”çš„ä¿¡æ¯ï¼Œè€Œä¸æ˜¯çœŸæ­£ä½ èº«ä»½è¯ä¸Šçš„ä¿¡æ¯&lt;/td&gt;
          &lt;td&gt;Pod ç­‰é€šè¿‡ API Server ä» etcd ä¸­æ£€ç´¢å’Œæ›´æ–°è‡ªèº«çŠ¶æ€æ—¶ï¼ŒAPI Server å¯¹å…¶è¿›è¡Œèº«ä»½è®¤è¯ï¼Œåªæœ‰é€šè¿‡æ ¡éªŒçš„ pod æ‰èƒ½è·å–ä¿¡æ¯&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥ä¸€æ¬¡æ€§å¯ç”¨å¤šç§è®¤è¯æ–¹å¼ï¼Œä½†é€šå¸¸åº”è¯¥è‡³å°‘åŒ…å«ä»¥ä¸‹ä¸¤æ–¹é¢ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é’ˆå¯¹äº Service Account çš„ token æ–¹å¼ï¼›&lt;/li&gt;
&lt;li&gt;è‡³å°‘ä¸€ç§ç”¨äº Normal Users èº«ä»½éªŒè¯çš„å…¶ä»–æ–¹å¼ã€‚
é€šè¿‡è®¤è¯çš„ç”¨æˆ·ä¼šè¢«åŒ…å«åœ¨åä¸º systemï¼šauthenticated çš„ group ä¸­ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;basic-è®¤è¯&#34;&gt;Basic è®¤è¯&lt;/h2&gt;
&lt;p&gt;è®¤è¯æ–¹æ³•æ˜¯ç®¡ç†å‘˜å°† passwordã€userã€uidã€group ä¿¡æ¯åŠ å…¥åˆ° csv æ ¼å¼çš„é™æ€æ–‡ä»¶ä¸­ï¼Œå¹¶åœ¨ API Server å¯åŠ¨æ—¶ä½¿ç”¨å‚æ•°&amp;ndash;Basic-authfile={æ–‡ä»¶è·¯å¾„}ï¼ŒæŒ‡å®šä½¿ç”¨çš„å‡­è¯æ–‡ä»¶ã€‚ä¹‹åï¼Œè®¤è¯å‡­è¯å°±å°†ä¸€ç›´æœ‰æ•ˆï¼Œåªæœ‰åœ¨é‡å¯ API Server æ—¶æ‰èƒ½ä¿®æ”¹å¯†ç ã€‚å‡­è¯æ–‡ä»¶ä¸­çš„æ•°æ®ç¤ºä¾‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;password,user,uid,&amp;#34;group1,group2,group3&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å…¶ä¸­ï¼Œå½“ä¸€ä¸ª user å¯¹åº”å¤šä¸ªç»„ï¼Œå¤šä¸ª group ä¹‹é—´éœ€è¦ç”¨é€—å·åˆ†éš”å¹¶ä¸”ä½¿ç”¨åŒå¼•å·ã€‚&lt;/p&gt;
&lt;p&gt;å®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼Œéœ€è¦åœ¨å¤´éƒ¨åŠ å…¥ Basic BASE64ENCODED(USER:PASSWORD)ï¼ŒæœåŠ¡ç«¯ä¼šæ ¡éªŒç”¨æˆ·åå’Œå¯†ç ã€‚è¯¥æ–¹å¼ä½¿ç”¨ç®€å•ï¼Œä½†æ˜¯å› ä¸ºç”¨æˆ·åå’Œå¯†ç ä½¿ç”¨æ˜æ–‡ï¼Œç”¨æˆ·åå’Œå¯†ç ä¿®æ”¹å¿…é¡»é‡å¯æœåŠ¡ï¼Œååˆ†ä¸çµæ´»ï¼Œä¸€èˆ¬åªç”¨äºæµ‹è¯•åœºæ™¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;x509-è¯ä¹¦è®¤è¯&#34;&gt;X509 è¯ä¹¦è®¤è¯&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡æˆ‘ä»¬å‡è®¾è¯»è€…å·²ç»äº†è§£æ•°å­—è¯ä¹¦å’Œ CA çš„åŸºæœ¬åŸç†ï¼Œè‹¥ä¸äº†è§£å¯ä»¥å…ˆé˜…è¯»ä¸‹è¿™ç¯‡æ–‡ç« &lt;a href=&#34;https://www.zhaohuabing.com/post/2020-03-19-pki/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ã€Šæ•°å­—è¯ä¹¦åŸç†ã€‹&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;K8s ä¸­ç»„ä»¶ä¹‹é—´é€šä¿¡ï¼Œè¯ä¹¦çš„éªŒè¯æ˜¯åœ¨åè®®å±‚é€šè¿‡ TLS å®Œæˆçš„ï¼ŒTLS éªŒè¯åˆ†ä¸º 2 ç§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœåŠ¡å™¨å•å‘è®¤è¯ï¼šæœåŠ¡å™¨ç«¯æŒæœ‰è¯ä¹¦è¯æ˜è‡ªå·±èº«ä»½ï¼Œç”¨äºæœåŠ¡ç«¯ä¸å…³å¿ƒå®¢æˆ·ç«¯èº«ä»½è€Œå®¢æˆ·ç«¯éœ€è¦ç¡®è®¤æœåŠ¡å™¨èº«ä»½çš„åœºæ™¯ã€‚ä¾‹å¦‚ç«è½¦ç¥¨è´­ç¥¨ç½‘ç«™ï¼Œæˆ‘ä»¬å¿…é¡»ä¿è¯å…¶æ˜¯å®˜æ–¹è€Œéæ¶æ„æœåŠ¡å™¨ï¼Œä½†ç½‘ç«™å…è®¸ä»»ä½•å®¢æˆ·ç«¯è¿›è¡Œè¿æ¥è®¿é—®ï¼›&lt;/li&gt;
&lt;li&gt;åŒå‘ TLS è®¤è¯ï¼šåŒæ–¹éƒ½è¦æŒæœ‰è¯ä¹¦ï¼Œå¹¶éªŒè¯å¯¹æ–¹è¯ä¹¦ç¡®è®¤èº«ä»½ã€‚ä¸€èˆ¬ç”¨äºæœåŠ¡ç«¯æŒæœ‰ä¿¡æ¯æ¯”è¾ƒæ•æ„Ÿï¼Œåªæœ‰ç‰¹å®šå®¢æˆ·ç«¯æ‰èƒ½è®¿é—®çš„åœºæ™¯ã€‚ä¾‹å¦‚ï¼šK8s å†…ç»„ä»¶æä¾›çš„æ¥å£å¾€å¾€åŒ…å«é›†ç¾¤å†…éƒ¨ä¿¡æ¯ï¼Œè‹¥è¢«éæ³•è®¿é—®ä¼šå½±å“æ•´ä½“å®‰å…¨ï¼Œæ‰€ä»¥ K8s å†…éƒ¨ç»„ä»¶ä¹‹é—´éƒ½æ˜¯åŒå‘ TLS è®¤è¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åŒå‘è®¤è¯çš„ç®€åŒ–è¿‡ç¨‹å¦‚ä¸‹å›¾ 2 æ‰€ç¤º&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-2-åŒå‘-tls-è¿‡ç¨‹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 2 åŒå‘ TLS è¿‡ç¨‹&#34; srcset=&#34;
               /blog/authentication-k8s/2_hu1814995259525763369.webp 400w,
               /blog/authentication-k8s/2_hu1516516584035953750.webp 760w,
               /blog/authentication-k8s/2_hu5311103239317620665.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/authentication-k8s/2_hu1814995259525763369.webp&#34;
               width=&#34;760&#34;
               height=&#34;309&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 2 åŒå‘ TLS è¿‡ç¨‹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å½“ä¸¤ä¸ªç»„ä»¶è¿›è¡ŒåŒå‘ TLS è®¤è¯æ—¶ï¼Œä¼šæ¶‰åŠåˆ°ä¸‹è¡¨ä¸­çš„ç›¸å…³æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;åç§°&lt;/th&gt;
          &lt;th&gt;ä½œç”¨&lt;/th&gt;
          &lt;th&gt;ä¾‹å­&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;æœåŠ¡ç«¯è¯ä¹¦&lt;/td&gt;
          &lt;td&gt;åŒ…å«æœåŠ¡ç«¯å…¬é’¥å’ŒæœåŠ¡ç«¯èº«ä»½ä¿¡æ¯&lt;/td&gt;
          &lt;td&gt;é€šè¿‡æ ¹è¯ä¹¦æ‰‹åŠ¨æˆ–è€… kubeadm è‡ªåŠ¨ç”Ÿæˆçš„ API Server æœåŠ¡ç«¯è¯ä¹¦æ–‡ä»¶ apiserver.crt&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æœåŠ¡å™¨ç§é’¥&lt;/td&gt;
          &lt;td&gt;ä¸»è¦ç”¨äº TLS è®¤è¯æ—¶è¿›è¡Œæ•°å­—ç­¾åï¼Œè¯æ˜è‡ªå·±æ˜¯æœåŠ¡ç«¯è¯ä¹¦çš„æ‹¥æœ‰è€…&lt;/td&gt;
          &lt;td&gt;é€šè¿‡æ ¹è¯ä¹¦æ‰‹åŠ¨æˆ–è€… kubeadm ç”Ÿæˆçš„ API Server æœåŠ¡ç«¯ç§é’¥æ–‡ä»¶ apiserver.key&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;å®¢æˆ·ç«¯è¯ä¹¦&lt;/td&gt;
          &lt;td&gt;åŒ…å«å®¢æˆ·ç«¯å…¬é’¥å’Œå®¢æˆ·ç«¯èº«ä»½ä¿¡æ¯&lt;/td&gt;
          &lt;td&gt;ç”±åŒä¸€ä¸ª CA æ ¹è¯ä¹¦ç­¾å‘çš„.crt æ–‡ä»¶&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;å®¢æˆ·ç«¯ç§é’¥&lt;/td&gt;
          &lt;td&gt;ä¸»è¦ç”¨äº TLS è®¤è¯æ—¶è¿›è¡Œæ•°å­—ç­¾åï¼Œè¯æ˜è‡ªå·±æ˜¯å®¢æˆ·ç«¯è¯ä¹¦çš„æ‹¥æœ‰è€…&lt;/td&gt;
          &lt;td&gt;ç”±åŒä¸€ä¸ª CA æ ¹è¯ä¹¦ç­¾å‘çš„.key æ–‡ä»¶&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æœåŠ¡ç«¯ CA æ ¹è¯ä¹¦&lt;/td&gt;
          &lt;td&gt;ç­¾å‘æœåŠ¡ç«¯è¯ä¹¦çš„ CA æ ¹è¯ä¹¦&lt;/td&gt;
          &lt;td&gt;é€šè¿‡ openssl ç­‰å·¥å…·ç”Ÿæˆçš„ ca.crt æ–‡ä»¶ï¼Œå¹¶åœ¨æœåŠ¡ç«¯å¯åŠ¨æ—¶è¿›è¡ŒæŒ‡å®š&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;å®¢æˆ·ç«¯ CA æ ¹è¯ä¹¦&lt;/td&gt;
          &lt;td&gt;ç­¾å‘å®¢æˆ·ç«¯è¯ä¹¦çš„ CA æ ¹è¯ä¹¦&lt;/td&gt;
          &lt;td&gt;é€šè¿‡ openssl ç­‰å·¥å…·ç”Ÿæˆçš„ ca.crt æ–‡ä»¶ï¼Œå¹¶åœ¨å®¢æˆ·ç«¯å¯åŠ¨æ—¶è¿›è¡ŒæŒ‡å®š (ä¸€èˆ¬ä¸æœåŠ¡ç«¯ä½¿ç”¨ä¸€ä¸ª)&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­æ¥æ¼”ç¤ºè¯ä¹¦ç­¾å‘å¹¶è¿›è¡Œå®¢æˆ·ç«¯é…ç½®çš„è¿‡ç¨‹ï¼Œæ¼”ç¤ºçš„ K8s ç¯å¢ƒå·²ç»å­˜åœ¨ CA æ ¹è¯ä¹¦æ–‡ä»¶ä»¥åŠ API Server æ–‡ä»¶ï¼Œæ–‡ä»¶å’Œç›®å½•æƒ…å†µå¦‚å›¾ 3 æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-3-æ–‡ä»¶å’Œç›®å½•æƒ…å†µå›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 3 æ–‡ä»¶å’Œç›®å½•æƒ…å†µå›¾&#34; srcset=&#34;
               /blog/authentication-k8s/3_hu4685183716069585946.webp 400w,
               /blog/authentication-k8s/3_hu6276677456612132083.webp 760w,
               /blog/authentication-k8s/3_hu16735841251110927431.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/authentication-k8s/3_hu4685183716069585946.webp&#34;
               width=&#34;760&#34;
               height=&#34;56&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 3 æ–‡ä»¶å’Œç›®å½•æƒ…å†µå›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ ca.crt æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„ CA æ ¹è¯ä¹¦ï¼Œapiserver.crt æ˜¯æˆ‘ä»¬ K8s API Server çš„æœåŠ¡ç«¯è¯ä¹¦æ–‡ä»¶ï¼Œå®ƒç”± ca.crt æ ¹è¯ä¹¦è¿›è¡Œç­¾å‘å’Œé…ç½®ï¼Œä¾‹å­ä¸­ API Server çš„å¯åŠ¨å‚æ•°å¦‚å›¾ 4 æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-4-api-server-çš„å¯åŠ¨é…ç½®&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 4 API Server çš„å¯åŠ¨é…ç½®&#34; srcset=&#34;
               /blog/authentication-k8s/4_hu4631753637600897373.webp 400w,
               /blog/authentication-k8s/4_hu4764704485189822001.webp 760w,
               /blog/authentication-k8s/4_hu5960347407495354496.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/authentication-k8s/4_hu4631753637600897373.webp&#34;
               width=&#34;760&#34;
               height=&#34;752&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 4 API Server çš„å¯åŠ¨é…ç½®
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;çº¢æ¡†éƒ¨åˆ†ä¿¡æ¯åˆ†åˆ«æŒ‡æ˜äº† API Server æ‰€ä½¿ç”¨çš„ CA æ ¹è¯ä¹¦ã€æœåŠ¡ç«¯è¯ä¹¦å’ŒæœåŠ¡ç«¯ç§é’¥çš„è·¯å¾„ã€‚ç­¾å‘ç”¨æˆ·è¯ä¹¦æ­¥éª¤å¦‚ä¸‹ (ä»¥ openssl å·¥å…·ä¸ºä¾‹):&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”Ÿæˆç§é’¥&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-5-ç”Ÿæˆç”¨æˆ·ç§é’¥&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 5 ç”Ÿæˆç”¨æˆ·ç§é’¥&#34; srcset=&#34;
               /blog/authentication-k8s/5_hu3274414583764584061.webp 400w,
               /blog/authentication-k8s/5_hu15840447660045036239.webp 760w,
               /blog/authentication-k8s/5_hu13244659677729125503.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/authentication-k8s/5_hu3274414583764584061.webp&#34;
               width=&#34;760&#34;
               height=&#34;122&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 5 ç”Ÿæˆç”¨æˆ·ç§é’¥
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;ä½¿ç”¨ç§é’¥ä¸ºç”¨æˆ·ç”Ÿæˆç­¾ç½²è¯·æ±‚æ–‡ä»¶&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-6-ç”Ÿæˆç­¾ç½²è¯·æ±‚æ–‡ä»¶&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 6 ç”Ÿæˆç­¾ç½²è¯·æ±‚æ–‡ä»¶&#34; srcset=&#34;
               /blog/authentication-k8s/6_hu595171702796449243.webp 400w,
               /blog/authentication-k8s/6_hu10327852342519010095.webp 760w,
               /blog/authentication-k8s/6_hu5820438244134525980.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/authentication-k8s/6_hu595171702796449243.webp&#34;
               width=&#34;760&#34;
               height=&#34;57&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 6 ç”Ÿæˆç­¾ç½²è¯·æ±‚æ–‡ä»¶
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å‘½ä»¤ä¸­æŒ‡å®šçš„ CN æ˜¯ Common Name çš„ç¼©å†™ï¼Œä»£è¡¨æœ€ç»ˆç”Ÿæˆå®¢æˆ·ç«¯è¯ä¹¦è®¤è¯é€šè¿‡ååœ¨ K8s å†…è¢«è¯†åˆ«çš„ç”¨æˆ·åï¼ŒO æ˜¯ Organization çš„ç¼©å†™ï¼Œä»£è¡¨è¢«è¯†åˆ«ç”¨æˆ·æ‰€å±çš„ç»„ã€‚&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;ä½¿ç”¨æœåŠ¡ç«¯ä¿¡ä»»çš„ CA å…¶ç­¾ç½²è¯ä¹¦&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-7-ç­¾ç½²è¯ä¹¦&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 7 ç­¾ç½²è¯ä¹¦&#34; srcset=&#34;
               /blog/authentication-k8s/7_hu5597611738431647055.webp 400w,
               /blog/authentication-k8s/7_hu11790372411716489819.webp 760w,
               /blog/authentication-k8s/7_hu4600657212429610038.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/authentication-k8s/7_hu5597611738431647055.webp&#34;
               width=&#34;760&#34;
               height=&#34;90&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 7 ç­¾ç½²è¯ä¹¦
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è‡³æ­¤ï¼Œä¸€ä¸ªå®¢æˆ·ç«¯è¯ä¹¦ä¾¿ç­¾å‘å®Œæ¯•äº†ã€‚æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å…¶ä¸­çš„å†…å®¹ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-8-my-usercrt&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 8 my-user.crt&#34; srcset=&#34;
               /blog/authentication-k8s/8_hu3827465335686382928.webp 400w,
               /blog/authentication-k8s/8_hu4248085342610045657.webp 760w,
               /blog/authentication-k8s/8_hu16996719998783698618.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/authentication-k8s/8_hu3827465335686382928.webp&#34;
               width=&#34;760&#34;
               height=&#34;335&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 8 my-user.crt
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ CN å’Œ O çš„ä¿¡æ¯å³æ¥è‡ªæ­¥éª¤ 2 æ‰€è¾“å…¥ï¼ŒK8s é€šè¿‡è¿™ä¸¤ä¸ªä¿¡æ¯ç¡®å®šè®¿é—®ç”¨æˆ·çš„ä¿¡æ¯ï¼Œç¤ºæ„å›¾å¦‚ 9 æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-9-ç”¨æˆ·ä¿¡æ¯è®¤è¯ç¤ºæ„å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 9 ç”¨æˆ·ä¿¡æ¯è®¤è¯ç¤ºæ„å›¾&#34; srcset=&#34;
               /blog/authentication-k8s/9_hu13743688514989029112.webp 400w,
               /blog/authentication-k8s/9_hu7235409725787407110.webp 760w,
               /blog/authentication-k8s/9_hu2018973858909751848.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/authentication-k8s/9_hu13743688514989029112.webp&#34;
               width=&#34;653&#34;
               height=&#34;263&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 9 ç”¨æˆ·ä¿¡æ¯è®¤è¯ç¤ºæ„å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆå¦‚ä½•é…ç½®å®¢æˆ·ç«¯æ‰èƒ½ä½¿ç”¨è¿™ä¸ªè¯ä¹¦å‘¢ï¼ŸK8s çš„æ¯ä¸ªå®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ï¼škubectlï¼‰éƒ½æœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ç”¨æ¥è®°å½•å®¢æˆ·ç«¯è¯ä¹¦éªŒè¯ç›¸å…³ä¿¡æ¯ï¼Œæˆ‘ä»¬ç§°ä¸º kubeconfigã€‚K8s ä¸­çš„æ¯ä¸ªç»„ä»¶éƒ½æœ‰ä¸€ä¸ªè¿™æ ·çš„é…ç½®æ–‡ä»¶æ¥å…³è”é›†ç¾¤ã€ç”¨æˆ·ä»¥åŠè¯ä¹¦çš„æƒ…å†µï¼Œæˆ‘ä»¬ä»¥ kubectl ä¸ºä¾‹ï¼Œæ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨ kubeconfigï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æŸ¥çœ‹å½“å‰ kubectl çš„é…ç½®æ–‡ä»¶å†…å®¹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œkubectl å‘½ä»¤ä»$HOME/.kube ç›®å½•ä¸‹æŸ¥æ‰¾ä¸€ä¸ªåå­—å«åš config çš„æ–‡ä»¶ä½œä¸º kubeconfigï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨å‘½ä»¤&lt;code&gt;kubectl config view&lt;/code&gt;æ¥åˆ—å‡ºç›¸å…³é…ç½®å†…å®¹ï¼Œç»“æœå¦‚å›¾ 10 æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-10-kubectl-config-view-ç»“æœå›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 10 kubectl config view ç»“æœå›¾&#34; srcset=&#34;
               /blog/authentication-k8s/10_hu7847038873275659541.webp 400w,
               /blog/authentication-k8s/10_hu11910637467842932033.webp 760w,
               /blog/authentication-k8s/10_hu10876940256301083158.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/authentication-k8s/10_hu7847038873275659541.webp&#34;
               width=&#34;578&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 10 kubectl config view ç»“æœå›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;clusters: é›†ç¾¤åˆ—è¡¨ã€‚åŒ…å«è®¿é—® API Server çš„ URLã€è®¤è¯ä¿¡æ¯ã€åç§°ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;contexts: kubectl çš„å¯ç”¨ä¸Šä¸‹æ–‡åˆ—è¡¨ï¼Œæ ‡æ˜äº†ç”¨æˆ·å’Œé›†ç¾¤çš„ä½¿ç”¨æ˜ å°„å…³ç³»ï¼›&lt;/li&gt;
&lt;li&gt;users: ç”¨æˆ·åˆ—è¡¨ï¼ŒåŒ…å«è®¿é—® API Server æ—¶çš„å®¢æˆ·ç«¯è¯ä¹¦ä¿¡æ¯ã€ç§é’¥ä»¥åŠåç§°ï¼›&lt;/li&gt;
&lt;li&gt;current-context: kubectl å½“å‰ä½¿ç”¨çš„ä¸Šä¸‹æ–‡åç§°ï¼Œå³ä¸Šä¸‹æ–‡åˆ—è¡¨ä¸­çš„æŸä¸ªç‰¹å®šé¡¹åç§°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Kubectl é…ç½® kubeconfig åä¸é›†ç¾¤è¿›è¡Œäº¤äº’æ—¶çš„æ•´ä½“ç»“æ„å¦‚å›¾ 11 æ‰€ç¤º&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-11-kubectl-äº¤äº’æ•´ä½“ç»“æ„å›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 11 kubectl äº¤äº’æ•´ä½“ç»“æ„å›¾&#34; srcset=&#34;
               /blog/authentication-k8s/11_hu16927080086883590297.webp 400w,
               /blog/authentication-k8s/11_hu5330806077162224667.webp 760w,
               /blog/authentication-k8s/11_hu9210422618633177107.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/authentication-k8s/11_hu16927080086883590297.webp&#34;
               width=&#34;721&#34;
               height=&#34;501&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 11 kubectl äº¤äº’æ•´ä½“ç»“æ„å›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;å»ºç«‹ç”¨æˆ·å’Œè¯ä¹¦çš„å…³ç³»&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-12-å»ºç«‹ç”¨æˆ·è¯ä¹¦å…³ç³»&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 12 å»ºç«‹ç”¨æˆ·è¯ä¹¦å…³ç³»&#34; srcset=&#34;
               /blog/authentication-k8s/12_hu7602223231870559078.webp 400w,
               /blog/authentication-k8s/12_hu13418338563024354619.webp 760w,
               /blog/authentication-k8s/12_hu8049179815141309035.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/authentication-k8s/12_hu7602223231870559078.webp&#34;
               width=&#34;760&#34;
               height=&#34;88&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 12 å»ºç«‹ç”¨æˆ·è¯ä¹¦å…³ç³»
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å†æ¬¡ä½¿ç”¨&lt;code&gt;kubectl config view&lt;/code&gt;æŸ¥çœ‹é…ç½®å¯ä»¥å‘ç°å¤šäº†ä¸€ä¸ª user çš„é…ç½®é¡¹&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-13-æ–°å¢çš„ç”¨æˆ·é…ç½®&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 13 æ–°å¢çš„ç”¨æˆ·é…ç½®&#34; srcset=&#34;
               /blog/authentication-k8s/13_hu2600333181634765006.webp 400w,
               /blog/authentication-k8s/13_hu6375932318747061984.webp 760w,
               /blog/authentication-k8s/13_hu10442600081876585826.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/authentication-k8s/13_hu2600333181634765006.webp&#34;
               width=&#34;706&#34;
               height=&#34;540&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 13 æ–°å¢çš„ç”¨æˆ·é…ç½®
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;æŠŠé›†ç¾¤ä¿¡æ¯å’Œç”¨æˆ·ä¿¡æ¯è¿›è¡Œå…³è”&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-14-å…³è”é›†ç¾¤å’Œç”¨æˆ·ä¿¡æ¯&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 14 å…³è”é›†ç¾¤å’Œç”¨æˆ·ä¿¡æ¯&#34; srcset=&#34;
               /blog/authentication-k8s/14_hu17045189443293797787.webp 400w,
               /blog/authentication-k8s/14_hu198161818721981352.webp 760w,
               /blog/authentication-k8s/14_hu3462240093587367710.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/authentication-k8s/14_hu17045189443293797787.webp&#34;
               width=&#34;760&#34;
               height=&#34;173&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 14 å…³è”é›†ç¾¤å’Œç”¨æˆ·ä¿¡æ¯
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›¾ 15 æ¼”ç¤ºé¦–å…ˆç”±é»˜è®¤çš„ context ä¸­ç®¡ç†å‘˜æƒé™çš„è¯ä¹¦æŸ¥çœ‹ pods çš„æƒ…å†µï¼Œæ¥ç€åˆ‡æ¢åˆ°æˆ‘ä»¬æ–°æ·»åŠ çš„ chris ç”¨æˆ·å†æŸ¥çœ‹ default ç©ºé—´ä¸‹ pods çš„æƒ…å†µå¯¹æ¯”ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-15-ä¸Šä¸‹æ–‡åˆ‡æ¢ä½¿ç”¨å¯¹æ¯”&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 15 ä¸Šä¸‹æ–‡åˆ‡æ¢ä½¿ç”¨å¯¹æ¯”&#34; srcset=&#34;
               /blog/authentication-k8s/15_hu3889720424118607309.webp 400w,
               /blog/authentication-k8s/15_hu650588303565614208.webp 760w,
               /blog/authentication-k8s/15_hu16237047274623720200.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/authentication-k8s/15_hu3889720424118607309.webp&#34;
               width=&#34;760&#34;
               height=&#34;328&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 15 ä¸Šä¸‹æ–‡åˆ‡æ¢ä½¿ç”¨å¯¹æ¯”
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å‘ç°ï¼Œå¼€å§‹æˆ‘ä»¬ä½¿ç”¨ Kubernetes-admin99 ç”¨æˆ·èƒ½å¤Ÿæ­£å¸¸æŸ¥è¯¢ defaut ä¸‹çš„ pod ä¿¡æ¯ï¼Œä½†åˆ‡æ¢åˆ°ä¸Šä¸‹æ–‡ chris@cluster99 åï¼Œè®¿é—®è¢«é˜»æ­¢äº†ï¼Œä½†æ˜¯ç”¨æˆ·æ²¡æœ‰è®¤è¯å¤±è´¥ï¼Œchris ç”¨æˆ·è¢«æ­£ç¡®è¯†åˆ«äº†ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬è™½ç„¶é€šè¿‡äº†è®¤è¯é˜¶æ®µï¼Œä½†æ˜¯åœ¨ç¬¬äºŒé˜¶æ®µï¼ˆé‰´æƒé˜¶æ®µï¼‰ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ä¸º chris ç”¨æˆ·æ·»åŠ ç›¸åº”çš„æ“ä½œæƒé™å¯¼è‡´ï¼ˆæƒé™æ§åˆ¶éƒ¨åˆ†æˆ‘ä»¬è®²è§£ï¼‰ï¼Œè‡³æ­¤å¯¹äºç”¨æˆ·çš„è®¤è¯å·²ç»ç”Ÿæ•ˆã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ x509 è¯ä¹¦è®¤è¯ç›¸å¯¹ Basic è®¤è¯æ¥è¯´æ˜¾ç„¶ä¼šæ›´å®‰å…¨ï¼Œåªè¦è¯ä¹¦ä¸æ³„éœ²ï¼Œä¾¿å¯è®¤ä¸ºæ˜¯å®‰å…¨çš„ã€‚ä½†ç›®å‰å´æ²¡æœ‰ä¾¿æ·çš„æ–¹æ¡ˆæ³¨é”€è¯ä¹¦ï¼Œè‹¥ä½¿ç”¨è¯ä¹¦è½®è½¬ï¼Œåˆ™éœ€è¦é‡æ–°åŠæ³•æ‰€æœ‰è¯ä¹¦ã€‚æ‰€ä»¥ä½¿ç”¨ x509 è¯ä¹¦è®¤è¯é€‚ç”¨äº Kubernetes å†…éƒ¨ç»„ä»¶ä¹‹é—´è®¤è¯ï¼Œæ™®é€šç”¨æˆ·è®¤è¯å¹¶ä¸æ¨èé€šè¿‡è¯ä¹¦çš„å½¢å¼è¿›è¡Œè®¤è¯ã€‚&lt;/p&gt;
&lt;p&gt;å›¾ 16 åˆ—å‡ºäº† K8s ä¸­å„ä¸ªä¸»è¦ç»„ä»¶è¯ä¹¦çš„ä½¿ç”¨æƒ…å†µ&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-16-k8s-ä¸»è¦ç»„ä»¶è¯ä¹¦ä½¿ç”¨æƒ…å†µ&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 16 K8s ä¸»è¦ç»„ä»¶è¯ä¹¦ä½¿ç”¨æƒ…å†µ&#34; srcset=&#34;
               /blog/authentication-k8s/16_hu3353745002612715060.webp 400w,
               /blog/authentication-k8s/16_hu17803138239770839340.webp 760w,
               /blog/authentication-k8s/16_hu9844126210590253516.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/authentication-k8s/16_hu3353745002612715060.webp&#34;
               width=&#34;658&#34;
               height=&#34;391&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 16 K8s ä¸»è¦ç»„ä»¶è¯ä¹¦ä½¿ç”¨æƒ…å†µ
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ kubelet å³ä½œä¸ºæœåŠ¡ç«¯ä¸º API Server æä¾›ä¸»æœºè¿è¡Œæƒ…å†µï¼ŒåŒæ—¶åˆä½œä¸ºå®¢æˆ·ç«¯ä» API Server ä¸­è·å–ä¿¡æ¯æ‰€ä»¥æ—¢å­˜åœ¨å®¢æˆ·ç«¯è¯ä¹¦åˆå­˜åœ¨æœåŠ¡ç«¯è¯ä¹¦ï¼ŒAPI Server åŒç†ï¼Œå…¶ä»–ç»„ä»¶åªä½œä¸ºå®¢æˆ·ç«¯ä» API Server ä¸­è·å–ä¿¡æ¯ï¼Œæ‰€ä»¥æ‹¥æœ‰å®¢æˆ·ç«¯è¯ä¹¦å³å¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;service-account-token-è®¤è¯&#34;&gt;Service Account token è®¤è¯&lt;/h2&gt;
&lt;p&gt;Service Account æ˜¯ K8s ä¸­å”¯ä¸€èƒ½å¤Ÿé€šè¿‡ API è‡ªå·±ç®¡ç†çš„å®ä½“è´¦å·ã€‚å®ƒä¸»è¦ç”¨äº Pod è®¿é—® API Serverã€‚æ¯ä¸ª namespace åˆ›å»ºçš„æ—¶å€™ï¼ŒK8s ä¼šè‡ªåŠ¨åœ¨è¿™ä¸ª namespace ä¸‹é¢åˆ›å»ºä¸€ä¸ªé»˜è®¤çš„ Service Account å’Œå¯¹åº”çš„ secret å®ä¾‹ï¼Œè¯¥ Service Account åªèƒ½è®¿é—®è¿™ä¸ª namespace çš„èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-17-default-ç©ºé—´ä¸‹çš„-service-account-å’Œå…¶å¯¹åº”çš„-secret&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 17 default ç©ºé—´ä¸‹çš„ Service Account å’Œå…¶å¯¹åº”çš„ secret&#34; srcset=&#34;
               /blog/authentication-k8s/17_hu4152083704749825890.webp 400w,
               /blog/authentication-k8s/17_hu11095785260200207908.webp 760w,
               /blog/authentication-k8s/17_hu1577389127385417517.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/authentication-k8s/17_hu4152083704749825890.webp&#34;
               width=&#34;760&#34;
               height=&#34;293&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 17 default ç©ºé—´ä¸‹çš„ Service Account å’Œå…¶å¯¹åº”çš„ secret
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Service Account åŒ…å«äº† namespaceã€token å’Œ ca ä¸‰éƒ¨åˆ†å†…å®¹ï¼Œé€šè¿‡ base64 ç¼–ç ä¿å­˜äºå¯¹åº”çš„ secret ä¸­ã€‚namespace æŒ‡å®šäº† Pod æ‰€å±çš„ namespaceï¼Œca ç”¨äºç”Ÿæˆå’ŒéªŒè¯ tokenï¼Œtoken ç”¨ä½œèº«ä»½éªŒè¯ã€‚ä¸‰è€…éƒ½é€šè¿‡ mount çš„æ–¹å¼æŒ‚è½½åœ¨ pod æ–‡ä»¶ç³»ç»Ÿçš„ç›®å½• /var/run/secrets/kubernetes.io/serviceaccount/ä¸‹ã€‚è‹¥åˆ›å»ºçš„podæœªè‡ªå·±æŒ‡å®šService Accountï¼ŒK8s ä¼šä¸ºå…¶ç»‘å®šé»˜è®¤çš„ Service Accountã€‚å›¾ 18ã€å›¾ 19 å’Œå›¾ 20 å±•ç¤ºäº†ä¸Šè¿°å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-18-service-account-å¯¹åº”-secret-å†…å®¹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 18 Service Account å¯¹åº” secret å†…å®¹&#34; srcset=&#34;
               /blog/authentication-k8s/18_hu16995806957132665329.webp 400w,
               /blog/authentication-k8s/18_hu5249789507748033297.webp 760w,
               /blog/authentication-k8s/18_hu2568778929777098793.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/authentication-k8s/18_hu16995806957132665329.webp&#34;
               width=&#34;760&#34;
               height=&#34;211&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 18 Service Account å¯¹åº” secret å†…å®¹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-19-default-ç©ºé—´ä¸‹çš„-pod-ç»‘å®šé»˜è®¤-service-account&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 19 default ç©ºé—´ä¸‹çš„ pod ç»‘å®šé»˜è®¤ Service Account&#34; srcset=&#34;
               /blog/authentication-k8s/19_hu228256288611775870.webp 400w,
               /blog/authentication-k8s/19_hu9575907881743374837.webp 760w,
               /blog/authentication-k8s/19_hu5155559304705148770.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/authentication-k8s/19_hu228256288611775870.webp&#34;
               width=&#34;760&#34;
               height=&#34;523&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 19 default ç©ºé—´ä¸‹çš„ pod ç»‘å®šé»˜è®¤ Service Account
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-20-æŒ‚è½½ç›®å½•ä¸‹çš„å†…å®¹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 20 æŒ‚è½½ç›®å½•ä¸‹çš„å†…å®¹&#34; srcset=&#34;
               /blog/authentication-k8s/20_hu16913121102641391032.webp 400w,
               /blog/authentication-k8s/20_hu16971859474830759017.webp 760w,
               /blog/authentication-k8s/20_hu205964637954778419.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/authentication-k8s/20_hu16913121102641391032.webp&#34;
               width=&#34;760&#34;
               height=&#34;165&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 20 æŒ‚è½½ç›®å½•ä¸‹çš„å†…å®¹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å½“ä¸ºä¸€ä¸ª Pod æŒ‡å®šäº† Service Account åï¼ŒK8s ä¼šä¸ºè¿™ä¸ª Service Account ç”Ÿæˆä¸€ä¸ª JWTï¼ˆJSON Web Tokenï¼‰ï¼Œå¹¶ä½¿ç”¨ secret å°†è¯¥ token åŠ è½½åˆ° pod ä¸Šã€‚JWT è®¤è¯æœºåˆ¶çš„åŸç†ä¹Ÿæ˜¯é€šè¿‡ CA æ ¹è¯ä¹¦è¿›è¡Œç­¾åå’Œå…¬ç§é’¥æ ¡éªŒ tokenã€‚å…¶ä¸­å…¬é’¥å’Œç§é’¥åˆ†åˆ«è¢«é…ç½®åˆ°äº† API Server å’Œ Controller-Manager çš„å‘½ä»¤è¡Œå‚æ•°ä¸­ã€‚å¦‚å›¾ 21 å’Œå›¾ 22 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-21-éƒ¨åˆ†-api-server-å¯åŠ¨å‚æ•°&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 21 éƒ¨åˆ† API Server å¯åŠ¨å‚æ•°ï¼‰&#34; srcset=&#34;
               /blog/authentication-k8s/21_hu5176539490796445777.webp 400w,
               /blog/authentication-k8s/21_hu16284925265359025807.webp 760w,
               /blog/authentication-k8s/21_hu16969583881457129096.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/authentication-k8s/21_hu5176539490796445777.webp&#34;
               width=&#34;749&#34;
               height=&#34;84&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 21 éƒ¨åˆ† API Server å¯åŠ¨å‚æ•°ï¼‰
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-22-éƒ¨åˆ†-controller-manager-å¯åŠ¨å‚æ•°&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 22 éƒ¨åˆ† Controller-Manager å¯åŠ¨å‚æ•°&#34; srcset=&#34;
               /blog/authentication-k8s/22_hu15607819021864693732.webp 400w,
               /blog/authentication-k8s/22_hu1575486291624067068.webp 760w,
               /blog/authentication-k8s/22_hu11779281005726068729.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/authentication-k8s/22_hu15607819021864693732.webp&#34;
               width=&#34;760&#34;
               height=&#34;55&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 22 éƒ¨åˆ† Controller-Manager å¯åŠ¨å‚æ•°
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¹‹å Pod ä¾¿å¯ä½¿ç”¨ token æ¥è®¿é—® API Server äº†ã€‚API Server å†éªŒè¯å¯¹åº” token ä¿¡æ¯ï¼Œå°±èƒ½çŸ¥é“è¿™ä¸ª token æ˜¯å¯¹åº” Service Accountï¼Œæœ€åè¯†åˆ«åˆ°å¯¹åº” Service Account çš„æƒé™ã€‚å›¾ 23 å±•ç¤ºäº† K8s ä½¿ç”¨å’ŒéªŒè¯ Service Account Token çš„è¿‡ç¨‹ã€‚å›¾ç‰‡æ¥æºäºæ–‡ç« ï¼šhttps://cloudnative.to/blog/k8s-certificate/#kube-apiserver-%E8%AF%81%E4%B9%A6%E9%85%8D%E7%BD%AE&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-23-service-accounttoken-çš„ä½¿ç”¨å’ŒéªŒè¯è¿‡ç¨‹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 23 Service AccountToken çš„ä½¿ç”¨å’ŒéªŒè¯è¿‡ç¨‹&#34; srcset=&#34;
               /blog/authentication-k8s/23_hu6023184116163721020.webp 400w,
               /blog/authentication-k8s/23_hu7048604637587267863.webp 760w,
               /blog/authentication-k8s/23_hu7590161468534651630.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/authentication-k8s/23_hu6023184116163721020.webp&#34;
               width=&#34;760&#34;
               height=&#34;462&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 23 Service AccountToken çš„ä½¿ç”¨å’ŒéªŒè¯è¿‡ç¨‹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸åˆ›å»º namespace åˆ›å»º defalut ç±»ä¼¼ï¼Œè‹¥æˆ‘ä»¬é€šè¿‡ K8s API çš„æ–¹å¼åˆ›å»º Service Accountï¼Œå®ƒä¸€æ ·ä¼šåˆ›å»ºå¯¹åº”çš„ secretã€‚å½“ Pod ä½¿ç”¨è¯¥ Service Account çš„ token å» API Server è®¤è¯ï¼ŒAPI Server ä¸€æ ·å¯ä»¥è¯†åˆ« Token å¯¹åº”çš„ Service Account ä»è€Œé€šè¿‡è®¤è¯ï¼ˆä¸è¯ä¹¦è®¤è¯ç›¸åŒçš„æ˜¯è‹¥æ²¡æœ‰è¿›è¡Œæˆæƒï¼Œä¸€æ ·æ— æ³•é€šè¿‡é‰´æƒé˜¶æ®µï¼‰ã€‚å¦‚å›¾ 24 å’Œå›¾ 25 æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-24-æ‰‹åŠ¨åˆ›å»º-service-account&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 24 æ‰‹åŠ¨åˆ›å»º Service Account&#34; srcset=&#34;
               /blog/authentication-k8s/24_hu3425233148891365600.webp 400w,
               /blog/authentication-k8s/24_hu5942971181573823993.webp 760w,
               /blog/authentication-k8s/24_hu14400708868136831557.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/authentication-k8s/24_hu3425233148891365600.webp&#34;
               width=&#34;760&#34;
               height=&#34;527&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 24 æ‰‹åŠ¨åˆ›å»º Service Account
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-25-æŸ¥çœ‹éªŒè¯åˆ›å»º-service-account-å¯¹åº”-secret&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 25 æŸ¥çœ‹éªŒè¯åˆ›å»º Service Account å¯¹åº” secret&#34; srcset=&#34;
               /blog/authentication-k8s/25_hu4088800826140589597.webp 400w,
               /blog/authentication-k8s/25_hu12497407446828368761.webp 760w,
               /blog/authentication-k8s/25_hu4093355550349320531.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/authentication-k8s/25_hu4088800826140589597.webp&#34;
               width=&#34;760&#34;
               height=&#34;314&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 25 æŸ¥çœ‹éªŒè¯åˆ›å»º Service Account å¯¹åº” secret
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;K8s çš„è®¿é—®æ§åˆ¶æœ‰ 4 ä¸ªé˜¶æ®µï¼Œå…¶ä¸­è®¤è¯é˜¶æ®µçš„ä¸»è¦å¯¹è±¡ä¸º Normal Users å’Œ Service Accountï¼Œå•å•é€šè¿‡è®¤è¯å¹¶ä¸èƒ½è®¿é—® API Serverï¼›&lt;/li&gt;
&lt;li&gt;X509 è¯ä¹¦è®¤è¯æ˜¯ K8s ä¸­é’ˆå¯¹ç”¨æˆ·çš„å¸¸ç”¨è®¤è¯æ–¹å¼ï¼Œå…¶ç»„ä»¶é—´åªç”¨äº†åŒå‘ TLS çš„è®¤è¯æ–¹å¼ï¼Œè‹¥å®¢æˆ·ç«¯éœ€è¦è®¿é—® API Server é™¤äº†ç”Ÿæˆå®¢æˆ·ç«¯è¯ä¹¦åŒæ—¶è¿˜è¦é…ç½®å¯¹åº”çš„ kubeconfigï¼›&lt;/li&gt;
&lt;li&gt;Service Account Token æ˜¯ K8s é’ˆå¯¹ Service Account çš„ä¸»è¦è®¤è¯æ–¹å¼ï¼Œå…¶è®¤è¯åŸç†æ˜¯åŸºäº JWTï¼Œå…¶ä¸­çš„è¯ä¹¦åªç”¨äºéªŒè¯ tokenï¼Œæœ€å API Service å¯¹äº Service Account çš„è¯†åˆ«æ˜¯åŸºäºä¼ é€’ç»™ API Service çš„ tokenï¼›&lt;/li&gt;
&lt;li&gt;Service Account ä¸»è¦è®¾è®¡ç”¨äº K8s å†…éƒ¨ï¼ŒPod ç­‰è¿›ç¨‹æ˜¯ä¸»è¦ä½¿ç”¨è€…ï¼Œå®ƒæ˜¯ K8s å”¯ä¸€è‡ªä¸»ç®¡ç†çš„è®¤è¯æ ‡è¯†ï¼Œåˆ›å»º Service Account åä¼šç”Ÿæˆå¯¹åº”çš„ secretã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å‚è€ƒèµ„æ–™&#34;&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://cloud.tencent.com/developer/article/2016079&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://cloud.tencent.com/developer/article/2016079&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.javashuo.com/article/p-gocttrgh-ny.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://www.javashuo.com/article/p-gocttrgh-ny.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cloudnative.to/blog/k8s-certificate/#kube-apiserver-%E8%AF%81%E4%B9%A6%E9%85%8D%E7%BD%AE&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://cloudnative.to/blog/k8s-certificate/#kube-apiserver-%E8%AF%81%E4%B9%A6%E9%85%8D%E7%BD%AE&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhuanlan.zhihu.com/p/468010077&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://zhuanlan.zhihu.com/p/468010077&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/reference/access-authn-authz/authentication/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.io/docs/reference/access-authn-authz/authentication/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes API Server handler æ³¨å†Œè¿‡ç¨‹åˆ†æ</title>
      <link>https://cloudnativecn.com/blog/apiserver-handler-register/</link>
      <pubDate>Fri, 12 Aug 2022 12:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/apiserver-handler-register/</guid>
      <description>&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;K8s æä¾› &lt;code&gt;Aggregated APIServer&lt;/code&gt; çš„æ‰©å±•æ–¹å¼ï¼Œç¼–å†™ &lt;code&gt;Aggregated APIServer&lt;/code&gt; æœ¬è´¨ä¸Šå’Œ K8s æ„å»ºæ–¹å¼ç±»ä¼¼ï¼Œç†è§£ APiServer èµ„æºçš„åŠ è½½æ–¹å¼ï¼Œèƒ½æ›´å¥½å¥½çš„ç†è§£å¦‚ä½•å¼€å‘&lt;code&gt;Aggregated APIServer&lt;/code&gt;ã€‚æœ¬æ–‡ä»¥å†…ç½®èµ„æºçš„ handler æ³¨å†Œè¿‡ç¨‹ä¸ºçº¿ç´¢ä»‹ç»äº† APiServer çš„å¯åŠ¨è¿‡ç¨‹å’Œ handler æ³¨å†Œè¿‡ç¨‹ã€‚ä½¿ç”¨ k8s ä»£ç  commit id ä¸º c6970e64528ba78b74bf77b86f9b78b7b61bd0cd&lt;/p&gt;
&lt;h2 id=&#34;apiserver-å¯åŠ¨è¿‡ç¨‹ä»‹ç»&#34;&gt;APIServer å¯åŠ¨è¿‡ç¨‹ä»‹ç»&lt;/h2&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-1-apiserver-å¯åŠ¨æµç¨‹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 1 APIServer å¯åŠ¨æµç¨‹&#34;
           src=&#34;https://cloudnativecn.com/blog/apiserver-handler-register/images/apiserver-startup-flow.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 1 APIServer å¯åŠ¨æµç¨‹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›¾ 1 ç»™å‡ºäº† ApiServer çš„åˆå§‹åŒ–æµç¨‹ï¼Œé¦–å…ˆé€šè¿‡ &lt;code&gt;CreateServerChain&lt;/code&gt;  æ„é€ å‡º 3 ä¸ª APIServerï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;AggregatorServerï¼šæ‹¦æˆª&lt;/strong&gt; &lt;code&gt;Aggregated APIServer&lt;/code&gt; &lt;strong&gt;ä¸­å®šä¹‰çš„èµ„æºå¯¹è±¡è¯·æ±‚ï¼Œå¹¶è½¬å‘ç»™ç›¸å…³çš„&lt;/strong&gt; &lt;code&gt;Aggregated APIServer&lt;/code&gt; &lt;strong&gt;å¤„ç†ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;KubeAPIServerï¼šç”¨äºå¤„ç† k8s çš„å†…å»ºèµ„æºï¼Œå¦‚ï¼šDeploymentï¼ŒConfigMap ç­‰ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;APIExtensionServerï¼šè´Ÿè´£å¤„ç†ç”¨æˆ·è‡ªå®šä¹‰èµ„æºã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å®ƒä»¬ä¹‹é—´çš„å¤„ç†é¡ºåºä¸ºå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“ç”¨æˆ·è¯·æ±‚è¿›æ¥ï¼Œå…ˆåˆ¤æ–­ &lt;code&gt;AggregatorServer&lt;/code&gt; èƒ½å¦å¤„ç†ï¼Œå¦åˆ™ä»£ç†ç»™ &lt;code&gt;kubeApiServer&lt;/code&gt; ï¼Œå¦‚æœ &lt;code&gt;kubeApiServer&lt;/code&gt; ä¸èƒ½å¤„ä»£ç†ç»™ &lt;code&gt;ApiExtensionServer&lt;/code&gt; å¤„ç†ï¼Œå¦‚æœéƒ½ä¸èƒ½å¤„ç†åˆ™äº¤ç»™ notFoundHandler å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-2-ä¸‰ç§-apiserver-è¯·æ±‚é¡ºåº&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 2 ä¸‰ç§ APIServer è¯·æ±‚é¡ºåº&#34; srcset=&#34;
               /blog/apiserver-handler-register/images/apiserver-request-order_hu15868699290746661335.webp 400w,
               /blog/apiserver-handler-register/images/apiserver-request-order_hu4183785347291185295.webp 760w,
               /blog/apiserver-handler-register/images/apiserver-request-order_hu6563126288998756143.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/apiserver-handler-register/images/apiserver-request-order_hu15868699290746661335.webp&#34;
               width=&#34;340&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 2 ä¸‰ç§ APIServer è¯·æ±‚é¡ºåº
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é™äºç¯‡å¹…åŸå› ï¼Œæœ¬æ–‡ä¸»è¦åˆ†æ kubeapiserver çš„å¯åŠ¨è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;CreateApiServerConfig&lt;/code&gt; é€šè¿‡è°ƒç”¨ &lt;code&gt;buildGenericConfig&lt;/code&gt; æ„å»º &lt;code&gt;genericapiserver.Config&lt;/code&gt;ã€‚&lt;code&gt;genericapiserver.Config&lt;/code&gt; ä¸­åŒ…å«äº†å¯åŠ¨&lt;code&gt;Genericapiserver&lt;/code&gt; æ‰€éœ€è¦çš„é…ç½®ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š&lt;code&gt;RequestTimeout&lt;/code&gt; å®šä¹‰äº†è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œ&lt;code&gt;AdmissionControl&lt;/code&gt; å¯¹è±¡è¿›è¡Œå‡†å…¥æ§åˆ¶ã€‚&lt;code&gt;buildGenericConfig&lt;/code&gt; ä¸­éœ€è¦æ³¨æ„çš„æ˜¯ &lt;code&gt;BuildHandlerChainFunc&lt;/code&gt;ï¼Œè¯·æ±‚åœ¨è·¯ç”±ç»™èµ„æºå¯¹è±¡çš„ handler å‰å…ˆç»è¿‡çš„&lt;code&gt;BuildHandlerChainFunc&lt;/code&gt; ä¸­å®šä¹‰çš„ &lt;code&gt;Filter&lt;/code&gt; ã€‚å‚è€ƒå›¾ 1ï¼Œé€šè¿‡æ·±å…¥ &lt;code&gt;buildGenericConfig&lt;/code&gt; å¯ä»¥å‘ç° &lt;code&gt;BuildHandlerChainFunc&lt;/code&gt; ä¼ å…¥çš„æ˜¯ &lt;code&gt;DefaultBuildHandlerChain&lt;/code&gt; ï¼Œå…¶ä¸­ &lt;code&gt;Filter&lt;/code&gt; å…ˆå®šä¹‰çš„åè°ƒç”¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// k8s.io/apiserver/pkg/server/config.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;DefaultBuildHandlerChain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;apiHandler&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Handler&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;filterlatency&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TrackCompleted&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;apiHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// æ„é€ æƒé™æ£€æŸ¥ filter
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;genericapifilters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WithAuthorization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Authorization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Authorizer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Serializer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// æ„é€ è®¤è¯ filter
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;genericapifilters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WithAuthentication&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Authentication&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Authenticator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;failedHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Authentication&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;APIAudiences&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// æ„é€ è¯·æ±‚è¶…æ—¶ filter, LongRunningFunc ä¼šåˆ¤æ–­è¯¥è¯·æ±‚æ˜¯å¦æ˜¯éœ€è¦ LongRunning çš„ï¼Œæ¯”å¦‚ watch çš„è¯·æ±‚ï¼Œå¦‚æœæ˜¯ï¼Œè¯¥ filter ä¸ä¼šå¯¹è¿™ç±»è¯·æ±‚ç”Ÿæ•ˆ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// WithTimeoutForNonLongRunningRequests will call the rest of the request handling in a go-routine with the
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// context with deadline. The go-routine can keep running, while the timeout logic will return a timeout to the client.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;genericfilters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WithTimeoutForNonLongRunningRequests&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LongRunningFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;genericapifilters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WithRequestDeadline&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;AuditBackend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;AuditPolicyRuleEvaluator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LongRunningFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Serializer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RequestTimeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;genericfilters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WithWaitGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LongRunningFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;HandlerChainWaitGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// åˆå§‹åŒ– RequestInfo çš„ filter å¹¶å°†å…¶æ”¾å…¥ context ä¸­ï¼Œåç»­çš„å¤„ç†é€»è¾‘å¯ä»¥ä» context ç›´æ¥è·å– RequestInfo
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;genericapifilters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WithRequestInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RequestInfoResolver&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;CreateKubeAPIServer&lt;/code&gt; ä¸­è°ƒç”¨äº†&lt;code&gt;kubeAPIServerConfig.Complete().New&lt;/code&gt; æ„é€ å‡ºäº† &lt;code&gt;kubeAPIServer&lt;/code&gt; çš„ &lt;code&gt;GenericServer&lt;/code&gt;ã€‚&lt;code&gt;kubeAPIServerConfig.Complete().New&lt;/code&gt; ä¸­é€šè¿‡è°ƒç”¨ &lt;code&gt;m.InstallLegacyAPI&lt;/code&gt; åˆå§‹åŒ–æ ¸å¿ƒèµ„æºå¹¶æ·»åŠ è¿›è·¯ç”±ä¸­ï¼Œå¯¹åº”çš„æ˜¯ä»¥ api å¼€å¤´çš„èµ„æºï¼Œå¦‚ï¼šPodï¼ŒConfigMap ç­‰ã€‚è°ƒç”¨ &lt;code&gt;m.InstallAPI&lt;/code&gt; åˆå§‹åŒ–ä»¥ apis å¼€å¤´çš„å†…ç½®èµ„æºå¦‚ï¼šDeploymentã€‚&lt;/p&gt;
&lt;h2 id=&#34;handler-çš„æ³¨å†Œè¿‡ç¨‹&#34;&gt;handler çš„æ³¨å†Œè¿‡ç¨‹&lt;/h2&gt;
&lt;p&gt;ä»å›¾ 1 å¯ä»¥çœ‹å‡º &lt;code&gt;InstallAPI&lt;/code&gt; ä¸ &lt;code&gt;InstallLegacyAPI&lt;/code&gt; çš„åˆ›å»ºè¿‡ç¨‹åŸºæœ¬ç±»ä¼¼ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç» &lt;code&gt;InstallAPI&lt;/code&gt; çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è°ƒç”¨ &lt;code&gt;InstallAPI&lt;/code&gt; ä¹‹å‰&lt;code&gt;kubeAPIServerConfig.Complete().New&lt;/code&gt; ä¼šå…ˆåˆ›å»ºå†…ç½®èµ„æºå¯¹è±¡çš„&lt;code&gt;RESTStorageProvider&lt;/code&gt; ä½œä¸º &lt;code&gt;InstallAPI&lt;/code&gt; çš„å…¥å‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//pkg/controlplane/instance.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;completedConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;New&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;delegationTarget&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;genericapiserver&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DelegationTarget&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Instance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// æ„é€ å†…ç½®èµ„æºçš„ RESTStorageProvider
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;restStorageProviders&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RESTStorageProvider&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;apiserverinternalrest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;StorageProvider&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;authenticationrest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RESTStorageProvider&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Authenticator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GenericConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Authentication&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Authenticator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;APIAudiences&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GenericConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Authentication&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;APIAudiences&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;authorizationrest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RESTStorageProvider&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Authorizer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GenericConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Authorization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Authorizer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;RuleResolver&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GenericConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RuleResolver&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;autoscalingrest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RESTStorageProvider&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;batchrest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RESTStorageProvider&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;certificatesrest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RESTStorageProvider&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;coordinationrest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RESTStorageProvider&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;discoveryrest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;StorageProvider&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;networkingrest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RESTStorageProvider&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;noderest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RESTStorageProvider&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;policyrest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RESTStorageProvider&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;rbacrest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RESTStorageProvider&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Authorizer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GenericConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Authorization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Authorizer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;schedulingrest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RESTStorageProvider&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;storagerest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RESTStorageProvider&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;flowcontrolrest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RESTStorageProvider&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InformerFactory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GenericConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SharedInformerFactory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// keep apps after extensions so legacy clients resolve the extensions versions of shared resource names.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;c1&#34;&gt;// See https://github.com/kubernetes/kubernetes/issues/42392
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;appsrest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;StorageProvider&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;admissionregistrationrest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RESTStorageProvider&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;eventsrest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RESTStorageProvider&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ExtraConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EventTTL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;InstallAPIs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ExtraConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;APIResourceConfigSource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GenericConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RESTOptionsGetter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;restStorageProviders&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;RESTStorageProvider&lt;/code&gt; æ˜¯ä¸€ä¸ªæ¥å£ï¼Œé€šè¿‡å…¶ &lt;code&gt;NewRESTStorage&lt;/code&gt; æ„é€ å‡º &lt;code&gt;APIGroupInfo&lt;/code&gt; ï¼Œ&lt;code&gt;APIGroupInfo&lt;/code&gt; åŒ…å«æ³¨å†Œèµ„æºæ‰€éœ€çš„åŸºæœ¬ä¿¡æ¯æ¯”å¦‚ç¼–è§£ç å™¨ï¼Œç»„ä¸‹æ‰€æœ‰èµ„æºçš„ Storage å¯¹è±¡&lt;code&gt;VersionedResourcesStorageMap&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//k8s.io/apiserver/pkg/server/genericapiserver.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Info about an API group.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;APIGroupInfo&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;PrioritizedVersions&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;schema&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GroupVersion&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Info about the resources in this group. It&amp;#39;s a map from version to resource to the storage.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;VersionedResourcesStorageMap&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Storage&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// NegotiatedSerializer controls how this group encodes and decodes data
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;NegotiatedSerializer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NegotiatedSerializer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// ParameterCodec performs conversions for query parameters passed to API calls
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;ParameterCodec&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ParameterCodec&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;VersionedResourcesStorageMap&lt;/code&gt; éœ€è¦é‡ç‚¹æ³¨æ„ï¼Œç¼–å†™ &lt;code&gt;Aggregated APIServer&lt;/code&gt; ä¸»è¦é€»è¾‘æ˜¯é€šè¿‡ &lt;code&gt;NewDefaultAPIGroupInfo&lt;/code&gt; åˆå§‹åŒ– &lt;code&gt;APIGroupInfo&lt;/code&gt; ä»¥åè®¾ç½® &lt;code&gt;VersionedResourcesStorageMap&lt;/code&gt; å±æ€§ã€‚&lt;code&gt;VersionedResourcesStorageMap&lt;/code&gt; çš„ç­¾åæ˜¯ &lt;code&gt;map[string]map[string]rest.Storage&lt;/code&gt;ã€‚ç¬¬ä¸€ä¸ª key æ˜¯ç‰ˆæœ¬å·ï¼Œç¬¬äºŒä¸ª key æ˜¯èµ„æºåç§°ï¼Œèµ„æºåç§°å¯ä»¥æ˜¯ deployment è¿™ç§èµ„æºï¼ŒåŒæ—¶ä¹Ÿèƒ½æ˜¯å­èµ„æºå¦‚ &lt;code&gt;pod/status&lt;/code&gt; , &lt;code&gt;pod/log&lt;/code&gt; ç­‰æ˜¯ pod çš„å­èµ„æºæœ‰å•ç‹¬çš„ storageã€‚æœ€ç»ˆæ„å»º handler çš„è¯·æ±‚è·¯å¾„æ˜¯åŸºäº &lt;code&gt;VersionedResourcesStorageMap&lt;/code&gt; ä¸­æä¾›çš„ç‰ˆæœ¬å·å’Œèµ„æºåç§°ç¡®å®šçš„ã€‚&lt;code&gt;rest.Storage&lt;/code&gt; ç”¨äºå¤„ç†å…·ä½“çš„è¯·æ±‚ï¼Œå…¶å£°æ˜å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// k8s.io/apiserver/pkg/registry/rest/rest.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Storage is a generic interface for RESTful storage services.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Resources which are exported to the RESTful API of apiserver need to implement this interface. It is expected
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// that objects may implement any of the below interfaces.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Storage&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// New returns an empty object that can be used with Create and Update after request data has been put into it.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// This object must be a pointer type for use with Codec.DecodeInto([]byte, runtime.Object)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nf&#34;&gt;New&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Destroy cleans up its resources on shutdown.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// Destroy has to be implemented in thread-safe way and be prepared
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// for being called more than once.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nf&#34;&gt;Destroy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®ç° &lt;code&gt;rest.Storage&lt;/code&gt; çš„æ¥å£æœ€åŸºæœ¬çš„ï¼Œå¦‚æœéœ€è¦æ”¯æŒä¸åŒçš„è¯·æ±‚ï¼Œè¿˜éœ€è¦å®ç°å…¶ä»–çš„æ¥å£ï¼Œç›¸å…³å®šä¹‰åœ¨ &lt;code&gt;k8s.io/apiserver/pkg/registry/rest/rest.go&lt;/code&gt; ä¸­ï¼Œå¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// k8s.io/apiserver/pkg/registry/rest/rest.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// èµ„æºå¯¹è±¡æ”¯æŒ POST è¯·æ±‚ï¼Œä¾‹å…¥é€šè¿‡ kubectl create ä¸€ä¸ªèµ„æºå¯¹è±¡ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Creater is an object that can create an instance of a RESTful object.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Creater&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// New returns an empty object that can be used with Create after request data has been put into it.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// This object must be a pointer type for use with Codec.DecodeInto([]byte, runtime.Object)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nf&#34;&gt;New&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Create creates a new version of a resource.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nf&#34;&gt;Create&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;createValidation&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ValidateObjectFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CreateOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// èµ„æºå¯¹è±¡æ”¯æŒ GET è¯·æ±‚ï¼Œä¾‹å¦‚é€šè¿‡ kubectl get ä¸€ä¸ªèµ„æºå¯¹è±¡ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Getter is an object that can retrieve a named RESTful resource.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Getter&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Get finds a resource in the storage by name and returns it.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// Although it can return an arbitrary error value, IsNotFound(err) is true for the
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// returned error value err when the specified resource is not found.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GetOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// æ”¯æŒå¯¹èµ„æºå¯¹è±¡è¿›è¡Œ watch æ“ä½œ ä¾‹å¦‚é€šè¿‡ kubectl get èµ„æºå¯¹è±¡ -wã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Watcher&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// &amp;#39;label&amp;#39; selects on labels; &amp;#39;field&amp;#39; selects on the object&amp;#39;s fields. Not all fields
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// are supported; an error should be returned if &amp;#39;field&amp;#39; tries to select on a field that
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// isn&amp;#39;t supported. &amp;#39;resourceVersion&amp;#39; allows for continuing/starting a watch at a
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// particular version.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nf&#34;&gt;Watch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;metainternalversion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ListOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;watch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åç»­çš„å¤„ç†ä¸­ä¼šä¾æ® &lt;code&gt;Creater&lt;/code&gt; ,&lt;code&gt;Getter&lt;/code&gt; å’Œ &lt;code&gt;Watcher&lt;/code&gt; ç­‰æ¥å£ç”Ÿæˆå¯¹åº”è¯·æ±‚çš„ handlerï¼Œåæ–‡ä¼šè¿›è¡Œå…·ä½“çš„åˆ†æã€‚k8s çš„å†…ç½®èµ„æºå­˜å‚¨éƒ½ä½¿ç”¨ etcdï¼Œå› æ­¤å†…ç½®èµ„æºçš„ Storage æ˜¯é€šè¿‡ &lt;code&gt;Store&lt;/code&gt; æ„å»ºã€‚&lt;code&gt;Store&lt;/code&gt; å®šä¹‰åœ¨ &lt;code&gt;/k8s.io/apiserver/pkg/registry/generic/registry/store.go&lt;/code&gt; æ–‡ä»¶ä¸­ï¼Œå·²ç»å®ç° &lt;code&gt;Creater&lt;/code&gt; , &lt;code&gt;Getter&lt;/code&gt;, &lt;code&gt;Watcher&lt;/code&gt;ç­‰æ¥å£ï¼Œå…¶ä»–çš„èµ„æºåªéœ€åœ¨åˆå§‹åŒ– &lt;code&gt;Store&lt;/code&gt; æ—¶ä¼ å…¥ä¸€äº›å¿…é¡»çš„å‚æ•°å³å¯ï¼Œæ— éœ€ç¼–å†™å­˜å‚¨å±‚çš„äº¤äº’ä»£ç ã€‚ä¸‹é¢ç»™å‡ºäº†æ„é€  deployment çš„ store çš„è¿‡ç¨‹ï¼Œå…¶ä»–å†…ç½®èµ„æºå¤§åŒå°å¼‚ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// NewREST returns a RESTStorage object that will work against deployments.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewREST&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;optsGetter&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;generic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RESTOptionsGetter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;REST&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;StatusREST&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RollbackREST&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;c1&#34;&gt;// åˆ›å»ºä¸€ä¸ª deployments çš„ genericregistry.Store
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;store&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;genericregistry&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Store&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// åˆå§‹åŒ–ä¸€ä¸ªç©ºèµ„æºå¯¹è±¡ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯ internal çš„ç‰ˆæœ¬ï¼Œä¸‹é¢å®šä¹‰çš„å„ç§ strategy æ“ä½œçš„å¯¹è±¡ä¹Ÿæ˜¯ internal ç‰ˆæœ¬ï¼Œè¿™æ ·å°±ä¸ç”¨ä¸ºæ¯ä¸€ç§ç‰ˆæœ¬ç¼–å†™ä¸€ä¸ª strategy ç­–ç•¥
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;NewFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;                  &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;apps&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// åˆå§‹åŒ–ä¸€ä¸ªç©ºèµ„æºå¯¹è±¡åˆ—è¡¨
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;NewListFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;              &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;apps&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DeploymentList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;DefaultQualifiedResource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;apps&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Resource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;deployments&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// åˆ›å»ºæ›´æ–°åˆ é™¤ç­–ç•¥ ä¸»è¦æ˜¯åšæ ¡éªŒåŠæ§åˆ¶é‚£äº›å­—æ®µä¸èƒ½è¢«ç”¨æˆ·è¦†ç›–ç”¨
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;CreateStrategy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;deployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Strategy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;UpdateStrategy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;deployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Strategy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;DeleteStrategy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;deployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Strategy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;ResetFieldsStrategy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;deployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Strategy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;TableConvertor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;printerstorage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TableConvertor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TableGenerator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;printers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewTableGenerator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;With&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;printersinternal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;AddHandlers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;generic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;StoreOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RESTOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;optsGetter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ç»§ç»­å®Œæˆ store å…¶ä»–å±æ€§çš„åˆå§‹åŒ–ï¼Œæ¯”å¦‚åˆå§‹åŒ– store.Storage å±æ€§ã€‚Storage ä¸»è¦ç”¨äºå’Œåº•å±‚å­˜å‚¨å±‚äº¤äº’
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;store&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;CompleteWithOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;statusStore&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;store&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// deployment çš„ status å­èµ„æºä¹Ÿæ˜¯ä½¿ç”¨ store, åŒºåˆ«æ˜¯æ›´æ–°ç­–ç•¥ä¸ä¸€æ ·ï¼Œå³åœ¨ update æ—¶ä¼šç”¨æ—§å¯¹è±¡çš„ spec å’Œ lable è¦†ç›–æ–°å¯¹è±¡çš„ï¼Œé˜²æ­¢é status å­—æ®µè¢«ç”¨æˆ·æ„å¤–è¦†ç›–
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;statusStore&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;UpdateStrategy&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;deployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;StatusStrategy&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;statusStore&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResetFieldsStrategy&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;deployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;StatusStrategy&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;REST&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;store&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;StatusREST&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;store&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statusStore&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RollbackREST&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;store&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;store&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;InstallAPIs&lt;/code&gt; è°ƒç”¨é“¾æ¡æ¯”è¾ƒæ·±ã€‚å‚è€ƒå›¾ 1ï¼Œæœ€ç»ˆä¼šæ¥åˆ°&lt;code&gt;k8s.io/apiserver/pkg/endpoints/groupversion.go&lt;/code&gt; çš„ &lt;code&gt;InstallREST&lt;/code&gt; æ–¹æ³•ã€‚&lt;code&gt;InstallREST&lt;/code&gt; æ–¹æ³•æ„é€ å‡º handler çš„å‰ç¼€ï¼Œåˆ›å»º&lt;code&gt;APIInstaller&lt;/code&gt;ï¼Œç„¶åè°ƒç”¨&lt;code&gt;installer.Install()&lt;/code&gt;æ–¹æ³•ç»§ç»­ handler çš„æ³¨å†Œ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// k8s.io/apiserver/pkg/endpoints/groupversion.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;APIGroupVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;InstallREST&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;container&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;restful&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Container&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;storageversion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResourceInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ä» InstallAPI è°ƒç”¨é“¾ä¸‹æ¥è¿™é‡Œçš„ g.Root ä¸º/apisï¼Œè¿™æ ·å°±å¯ä»¥ç¡®å®š handler çš„å‰ç¼€ä¸º/apis/{goup}/{version}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;prefix&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Join&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GroupVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GroupVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;installer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;APIInstaller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;             &lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;            &lt;span class=&#34;nx&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;minRequestTimeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MinRequestTimeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;apiResources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resourceInfos&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ws&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;registrationErrors&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;installer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Install&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;versionDiscoveryHandler&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;discovery&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewAPIVersionHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Serializer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GroupVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;staticLister&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;apiResources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;versionDiscoveryHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddToWebService&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ws&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;container&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ws&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;removeNonPersistedResources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;resourceInfos&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;utilerrors&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewAggregate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;registrationErrors&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;installer.Install()&lt;/code&gt; æ–¹æ³•ä¼šè°ƒç”¨&lt;code&gt;registerResourceHandlers&lt;/code&gt; æ–¹æ³•ï¼ŒçœŸæ­£å¼€å§‹åˆ›å»ºå’Œæ³¨å†Œå¤„ç†è¯·æ±‚çš„ handlerï¼Œéœ€è¦è¯´æ˜çš„æ˜¯&lt;code&gt;a.group.Storage&lt;/code&gt; æ˜¯ä¸Šæ–‡æåˆ°çš„&lt;code&gt;VersionedResourcesStorageMap&lt;/code&gt; ä¼ å…¥ç‰ˆæœ¬å·åè·å¾—çš„ mapã€‚è¯»è€…å¯ä»¥è‡ªè¡Œå‚è€ƒå›¾ 1 çš„è°ƒç”¨é“¾è¿›è¡Œåˆ†æã€‚&lt;code&gt;a.registerResourceHandlers&lt;/code&gt; å°±æ˜¯ä¸ºæ¯ä¸€ç§&lt;code&gt;Storage&lt;/code&gt;æ³¨å†Œ handlers&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Install handlers for API resources.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;APIInstaller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Install&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;APIResource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;storageversion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResourceInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;restful&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;WebService&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;apiResources&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;APIResource&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resourceInfos&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;storageversion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResourceInfo&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;errors&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;ws&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;newWebService&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Register the paths in a deterministic (sorted) order to get a deterministic swagger spec.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;paths&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// a.goup.Storage çš„ç­¾åæ˜¯ map[string]Storage, for å¾ªç¯çš„ path æ˜¯ map çš„ keyï¼Œå³èµ„æºåç§°
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Storage&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;path&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;sort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;path&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;paths&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;apiResource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resourceInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;registerResourceHandlers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ws&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;registerResourceHandlers&lt;/code&gt; ä¼šä¾æ®&lt;code&gt;rest.Storage&lt;/code&gt;å®ç°çš„æ¥å£ç”Ÿæˆç›¸å…³çš„ actionã€‚æœ€ç»ˆæ ¹æ® action ç”Ÿæˆ handler å¹¶æ³¨å†Œåˆ° rest å®¹å™¨ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// k8s.io/apiserver/pkg/endpoints/installer.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;APIInstaller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;registerResourceHandlers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;path&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;storage&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ws&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;restful&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;WebService&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;APIResource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;storageversion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResourceInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// åˆå§‹åŒ– rest å®¹å™¨ï¼Œæ ¹ç›®å½•æ˜¯ APIInstaller çš„ prefix å±æ€§ï¼Œä» InstallAPI è°ƒç”¨é“¾ä¸‹æ¥å€¼ä¸º/apis/{goup}/{version}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nx&#34;&gt;ws&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;newWebService&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// è¿›è¡Œç±»å‹è½¬æ¢åˆ¤æ–­å½“å‰çš„ storage æ”¯æŒå“ªäº›ç±»å‹çš„æ“ä½œ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;creater&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isCreater&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Creater&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;namedCreater&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isNamedCreater&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NamedCreater&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;lister&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isLister&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Lister&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;getter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isGetter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Getter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;getterWithOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isGetterWithOptions&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GetterWithOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;gracefulDeleter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isGracefulDeleter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GracefulDeleter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;collectionDeleter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isCollectionDeleter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CollectionDeleter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;updater&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isUpdater&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Updater&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;patcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isPatcher&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Patcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;watcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isWatcher&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Watcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;connecter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isConnecter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Connecter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;storageMeta&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isMetadata&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;StorageMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;storageVersionProvider&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isStorageVersionProvider&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;StorageVersionProvider&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// Get the list of actions for the given scope.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;namespaceScoped&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// æ„é€ æœ‰æ—  namespace èµ„æºçš„ action
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;c1&#34;&gt;// Handle non-namespace scoped resources like nodes.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// æ„é€ æœ‰ namespace èµ„æºçš„ action
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// æ„é€  handler çš„æ³¨å†Œè·¯å¾„
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	  &lt;span class=&#34;nx&#34;&gt;namespaceParamName&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;namespaces&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// Handler for standard REST verbs (GET, PUT, POST and DELETE).
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;namespaceParam&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ws&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;PathParameter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;namespace&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;object name and auth scope, such as for teams and projects&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;DataType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;string&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;namespacedPath&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namespaceParamName&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;/{namespace}/&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resource&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;namespaceParams&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;restful&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Parameter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;namespaceParam&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;//resourcePath çš„å€¼ä¸º /namespaces/{namespace}/{resource}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;resourcePath&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namespacedPath&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;resourceParams&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namespaceParams&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// itemPathï¼š /namespaces/{namespace}/{resource}/{name}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// name æ˜¯è¯·æ±‚èµ„æºå¯¹è±¡çš„åå­—
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;itemPath&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namespacedPath&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;/{name}&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;nameParams&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;namespaceParams&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nameParam&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;proxyParams&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nameParams&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pathParam&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;itemPathSuffix&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isSubresource&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;itemPathSuffix&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;subresource&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;c1&#34;&gt;// æœ‰å­èµ„æºç­‰æƒ…å†µä¸‹ resourcePath è¢«å®šä¹‰ä¸ºï¼š/namespaces/{namespace}/{resource}/{name}/{subResource}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;itemPath&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;itemPath&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;itemPathSuffix&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;c1&#34;&gt;// itemPath ä¸ resourcePath çš„å€¼ä¸€æ ·
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;resourcePath&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;itemPath&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;resourceParams&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nameParams&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;apiResource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;path&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;apiResource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Namespaced&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;apiResource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Kind&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resourceKind&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;namer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;handlers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ContextBasedNaming&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;Namer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;         &lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Namer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;ClusterScoped&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// æ ¹æ® storage å®ç°çš„æ¥å£æ·»åŠ æ·»åŠ ç›¸å…³çš„ action
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;appendIf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;LIST&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resourcePath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resourceParams&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isLister&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;appendIf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;POST&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resourcePath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resourceParams&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isCreater&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;appendIf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;DELETECOLLECTION&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resourcePath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resourceParams&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isCollectionDeleter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// DEPRECATED in 1.11
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;appendIf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;WATCHLIST&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;watch/&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resourcePath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resourceParams&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;allowWatchList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;appendIf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;itemPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nameParams&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isGetter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;getSubpath&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;appendIf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;itemPath&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;/{path:*}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proxyParams&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isGetter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;appendIf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;PUT&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;itemPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nameParams&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isUpdater&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;appendIf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;PATCH&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;itemPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nameParams&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isPatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;appendIf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;DELETE&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;itemPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nameParams&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isGracefulDeleter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// DEPRECATED in 1.11
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;appendIf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;WATCH&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;watch/&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;itemPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nameParams&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isWatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;appendIf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;CONNECT&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;itemPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nameParams&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isConnecter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;appendIf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;CONNECT&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;itemPath&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;/{path:*}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proxyParams&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isConnecter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;connectSubpath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// list or post across namespace.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;c1&#34;&gt;// For ex: LIST all pods in all namespaces by sending a LIST request at /api/apiVersion/pods.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;c1&#34;&gt;// TODO: more strongly type whether a resource allows these actions on &amp;#34;all namespaces&amp;#34; (bulk delete)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;isSubresource&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;appendIf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;LIST&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;params&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isLister&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;c1&#34;&gt;// DEPRECATED in 1.11
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;appendIf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;WATCHLIST&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;watch/&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;params&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;allowWatchList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;actions&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Verb&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Get a resource.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;restful&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RouteFunction&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;c1&#34;&gt;// æ„é€  get è¯·æ±‚çš„ handler
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;c1&#34;&gt;// restfulGetResourceWithOptions å’Œ restfulGetResource å°† handlers.GetResource å‡½æ•°è½¬æ¢æˆ restful.RouteFunctionï¼Œå³ handler çš„å‡½æ•°ç­¾å
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isGetterWithOptions&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;restfulGetResourceWithOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;getterWithOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reqScope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isSubresource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;restfulGetResource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;getter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reqScope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;c1&#34;&gt;// å°† handler æ³¨å†Œåˆ° rest å®¹å™¨ä¸­
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;c1&#34;&gt;// action.Path æ˜¯ä¸Šé¢å®šä¹‰çš„ itemPath æˆ– resourcePathï¼Œå¯¹äº GET æ¥è¯´æ˜¯ itemPath
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;c1&#34;&gt;// å½“å‰æ³¨å†Œçš„ handler çš„è·¯å¾„æ˜¯ ws çš„æ ¹è·¯å¾„åŠ ä¸Š ation.Path. å®Œæ•´çš„è·¯å¾„ä¸ºï¼š/apis/{goup}/{version}/namespaces/{namespace}/{resource}/{name}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;route&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ws&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;To&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nf&#34;&gt;Doc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;doc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nf&#34;&gt;Param&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ws&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;QueryParameter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;pretty&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;If &amp;#39;true&amp;#39;, then the output is pretty printed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)).&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nf&#34;&gt;Operation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;read&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;namespaced&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Title&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;subresource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;operationSuffix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nf&#34;&gt;Produces&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;storageMeta&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ProducesMIMETypes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Verb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mediaTypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nf&#34;&gt;Returns&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;StatusOK&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;OK&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;producedObject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nf&#34;&gt;Writes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;producedObject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isGetterWithOptions&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;AddObjectParams&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ws&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;versionedGetOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nf&#34;&gt;addParams&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Params&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;routes&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;route&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;LIST&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// List all resources of a kind.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;PUT&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Update a resource.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;PATCH&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Partially update a resource
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;POST&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Create a resource.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;DELETE&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Delete a resource.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;registerResourceHandlers&lt;/code&gt; ä¸­åˆ›å»ºçš„ handler å¹¶ä¸æ˜¯ç›´æ¥è°ƒç”¨&lt;code&gt;Creater&lt;/code&gt; ,&lt;code&gt;Updater&lt;/code&gt; ç­‰æ¥å£å®šä¹‰çš„æ–¹æ³•ï¼Œè€Œæ˜¯åœ¨å¤–é¢åŒ…äº†ä¸€å±‚ä»£ç è¿›è¡Œä¸€äº›é¢å¤–çš„å¤„ç†ï¼Œä¾‹å¦‚å¯¹è±¡çš„ç¼–è§£ç ï¼Œadmission control çš„å¤„ç†é€»è¾‘ï¼Œé’ˆå¯¹ watch è¿™ç§é•¿é“¾æ¥éœ€è¦è¿›è¡Œåè®®çš„å¤„ç†ç­‰ï¼Œç›¸å…³çš„å®šä¹‰åœ¨&lt;code&gt;k8s.io/apiserver/pkg/endpoints/handlers&lt;/code&gt; åŒ…ä¸‹ã€‚æ–‡æœ¬ä»¥ Get å’Œ Create ä¾‹ï¼Œåˆ†æè¯·æ±‚çš„å¤„ç†é€»è¾‘ã€‚&lt;/p&gt;
&lt;p&gt;Get è¯·æ±‚çš„å¤„ç†è¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œé€šè¿‡è¯·æ±‚çš„æŸ¥è¯¢ä¸²æ„é€ å‡º&lt;code&gt;metav1.GetOptions&lt;/code&gt; ï¼Œç„¶åäº¤ç»™ Getter æ¥å£å¤„ç†ï¼Œæœ€ååœ¨å°†æŸ¥è¯¢ç»“æœè¿›è¡Œè½¬æ¢å‘å›ç»™è¯·æ±‚è€…ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// k8s.io/apiserver/pkg/endpoints/handlers/get.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// GetResource returns a function that handles retrieving a single resource from a rest.Storage object.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;GetResource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Getter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scope&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RequestScope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;HandlerFunc&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getResourceHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;trace&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;utiltrace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Trace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;c1&#34;&gt;// check for export
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GetOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;c1&#34;&gt;// è·å–æŸ¥è¯¢ä¸²
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;values&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;URL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;values&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// å°†æŸ¥è¯¢ä¸²è§£ç æˆ metav1.GetOptions
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;				&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metainternalversionscheme&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ParameterCodec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;DecodeParameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;values&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MetaGroupVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;errors&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewBadRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;trace&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;trace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Step&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;About to Get from storage&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;c1&#34;&gt;// äº¤ç»™ Getter æ¥å£å¤„ç†
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// getResourceHandler is an HTTP handler function for get requests. It delegates to the
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// passed-in getterFunc to perform the actual get.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getResourceHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;scope&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RequestScope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;getter&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;getterFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;HandlerFunc&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResponseWriter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Namer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WithNamespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;trace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// å¯¹å¤„ç†ç»“æœè¿›è¡Œè½¬åŒ–ä¸ºç”¨æˆ·æœŸæœ›çš„æ ¼å¼å¹¶å†™å…¥åˆ° response ä¸­è¿”å›ç»™ç”¨æˆ·
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nf&#34;&gt;transformResponseObject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;trace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;StatusOK&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;outputMediaType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Create çš„å¤„ç†é€»è¾‘åœ¨ &lt;code&gt;createHandler&lt;/code&gt; ä¸­ï¼Œä»£ç è¾ƒé•¿ï¼Œä¸»è¦åšä»¥ä¸‹å‡ ä»¶äº‹æƒ…ï¼š&lt;/p&gt;
&lt;p&gt;1 å¯¹æŸ¥è¯¢ä¸²è¿›è¡Œè§£ç ç”Ÿæˆ &lt;code&gt;metav1.CreateOptions&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;p&gt;2 å¯¹è¯·æ±‚çš„ body ä½“ä¸­çš„æ•°æ®è¿›è¡Œè§£ç ï¼Œç”Ÿæˆèµ„æºå¯¹è±¡ã€‚è§£ç çš„å¯¹è±¡ç‰ˆæœ¬æ˜¯ internal ç‰ˆæœ¬ï¼Œinternal ç‰ˆæœ¬æ˜¯è¯¥èµ„æºå¯¹è±¡æ‰€æœ‰ç‰ˆæœ¬å­—æ®µçš„å…¨é›†ã€‚é’ˆå¯¹ä¸åŒç‰ˆæœ¬çš„å¯¹è±¡å†…éƒ¨å¯ä»¥ä½¿ç”¨ç›¸åŒçš„ä»£ç è¿›è¡Œå¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;3 å¯¹å¯¹è±¡è¿›è¡Œä¿®æ”¹çš„å‡†å…¥æ§åˆ¶ï¼Œåˆ¤æ–­æ˜¯å¦ä¿®éœ€è¦ä¿®æ”¹å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;4 äº¤ç»™ creater æ¥å£åˆ›å»ºèµ„æºå¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;5 å°†æ•°æ®è½¬æ¢ä¸ºæœŸæœ›çš„æ ¼å¼å†™å…¥ response ä¸­ï¼Œè°ƒç”¨ creater æ¥å£è¿”å›çš„ç»“æœä»ç„¶æ˜¯ internal ç‰ˆæœ¬ï¼Œç¼–ç æ—¶ï¼Œä¼šç¼–ç æˆç”¨æˆ·è¯·æ±‚çš„ç‰ˆæœ¬è¿”å›ç»™ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// k8s.io/apiserver/pkg/endpoints/handlers/create.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// CreateNamedResource returns a function that will handle a resource creation with name.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;CreateNamedResource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NamedCreater&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scope&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RequestScope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;admission&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;admission&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;HandlerFunc&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;createHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;admission&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;createHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NamedCreater&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scope&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RequestScope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;admit&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;admission&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;includeName&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;HandlerFunc&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResponseWriter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ä» request ä¸­å–å‡ºè¯·æ±‚ body
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;limitedReadBody&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MaxRequestBodyBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// å¯¹æŸ¥è¯¢ä¼ è¿›è¡Œè§£ç ç”Ÿæˆ metav1.CreateOptions
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CreateOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;values&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;URL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metainternalversionscheme&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ParameterCodec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;DecodeParameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;values&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MetaGroupVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// å°†è¯·æ±‚ body è§£ç æˆèµ„æºå¯¹è±¡ï¼ŒdefaultGVK æ˜¯ç”¨æˆ·è¯·æ±‚çš„ç‰ˆæœ¬ï¼Œè¿™é‡Œ decoder è§£ç å‡ºæ¥çš„å¯¹è±¡æ˜¯ internal ç‰ˆæœ¬çš„å¯¹è±¡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;gvk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;decoder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Decode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;defaultGVK&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;original&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;admissionAttributes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;admission&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewAttributesRecord&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Resource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Subresource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;admission&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Create&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;dryrun&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;IsDryRun&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DryRun&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;userInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// æ„å»ºè°ƒç”¨ create æ–¹æ³•çš„å‡½æ•°
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;requestFunc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Create&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;rest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AdmissionToValidateObjectFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;admit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;admissionAttributes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// Dedup owner references before updating managed fields
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nf&#34;&gt;dedupOwnerReferencesAndAddWarning&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;finisher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;FinishRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;c1&#34;&gt;// æ‰§è¡Œ mutation çš„ admission æ“ä½œï¼Œå³åœ¨åˆ›å»ºæ—¶å¯¹è±¡è¿›è¡Œä¿®æ”¹æ“ä½œã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;c1&#34;&gt;// admin åœ¨ buildGenericConfig ä¸­åˆå§‹åŒ–ï¼Œé€šè¿‡ config ä¼ é€’ç»™ genericseverï¼Œç„¶åä¼ é€’åˆ°æ­¤å¤„
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mutatingAdmission&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;admit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;admission&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MutationInterface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mutatingAdmission&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Handles&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;admission&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Create&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mutatingAdmission&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Admit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;admissionAttributes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;c1&#34;&gt;// Dedup owner references again after mutating admission happens
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nf&#34;&gt;dedupOwnerReferencesAndAddWarning&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;c1&#34;&gt;// è°ƒç”¨åˆ›å»ºæ–¹æ³•
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;requestFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// resutl ä¹Ÿæ˜¯ internal ç‰ˆæœ¬çš„å¯¹è±¡ï¼ŒtransformResponseObject ä¼šè½¬æ¢ä¸ºç”¨æˆ·è¯·æ±‚çš„ç‰ˆæœ¬å¹¶è¾“å‡º
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nf&#34;&gt;transformResponseObject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;trace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;outputMediaType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Create è¯·æ±‚çš„æµç¨‹å¯ä»¥æ€»ç»“ä¸ºä¸‹å›¾&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-3-create-è¯·æ±‚å¤„ç†æµç¨‹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 3 create è¯·æ±‚å¤„ç†æµç¨‹&#34; srcset=&#34;
               /blog/apiserver-handler-register/images/create-process-flow_hu11122843918710097913.webp 400w,
               /blog/apiserver-handler-register/images/create-process-flow_hu350902368417334019.webp 760w,
               /blog/apiserver-handler-register/images/create-process-flow_hu10728408497432908372.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/apiserver-handler-register/images/create-process-flow_hu11122843918710097913.webp&#34;
               width=&#34;760&#34;
               height=&#34;207&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 3 create è¯·æ±‚å¤„ç†æµç¨‹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»äº† K8s å†…ç½®èµ„æºçš„æ³¨å†Œè¿‡ç¨‹ï¼Œå¯¹ APIServer çš„è®¿é—®ä¼šå…ˆç»è¿‡ filterï¼Œå†è·¯ç”±ç»™å…·ä½“çš„ handlerã€‚filter åœ¨ &lt;code&gt;DefaultBuildHandlerChain&lt;/code&gt; ä¸­å®šä¹‰ï¼Œä¸»è¦å¯¹è¯·æ±‚åšè¶…æ—¶å¤„ç†ï¼Œè®¤è¯ï¼Œé‰´æƒç­‰æ“ä½œã€‚handler çš„æ³¨å†Œåˆ™æ˜¯åˆå§‹åŒ– &lt;code&gt;APIGoupInfo&lt;/code&gt; å¹¶è®¾ç½®å…¶ &lt;code&gt;VersionedResourcesStorageMap&lt;/code&gt; åä½œä¸ºå…¥å‚ï¼Œè°ƒç”¨ &lt;code&gt;GenericAPIServer.InstallAPIGroups&lt;/code&gt; å³å¯å®Œæˆ handler çš„æ³¨å†Œã€‚&lt;code&gt;k8s.io/apiserver/pkg/endpoints/handlers&lt;/code&gt; åŒ…ä¸­çš„ä»£ç åˆ™æ˜¯å¯¹ç”¨æˆ·è¯·æ±‚åšç¼–è§£ç ï¼Œå¯¹è±¡ç‰ˆæœ¬è½¬æ¢ï¼Œåè®®å¤„ç†ç­‰æ“ä½œï¼Œæœ€ååœ¨äº¤ç»™&lt;code&gt;rest.Storage&lt;/code&gt; å…·ä½“å®ç°çš„æ¥å£è¿›è¡Œå¤„ç†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kube_apiserver.html#kube-apiserver-%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kube_apiserver.html#kube-apiserver-å¤„ç†æµç¨‹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://hackerain.me/2020/10/05/kubernetes/kube-apiserver-genericapiserver.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://hackerain.me/2020/10/05/kubernetes/kube-apiserver-genericapiserver.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://hackerain.me/2020/09/19/kubernetes/kube-apiserver-storage-overview.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://hackerain.me/2020/09/19/kubernetes/kube-apiserver-storage-overview.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/gosoon/source-code-reading-notes/blob/master/kubernetes/kube_apiserver.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/gosoon/source-code-reading-notes/blob/master/kubernetes/kube_apiserver.md&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://time.geekbang.org/column/article/41876&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://time.geekbang.org/column/article/41876&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>CSI é©±åŠ¨å¼€å‘æŒ‡å—</title>
      <link>https://cloudnativecn.com/blog/develop-a-csi-driver/</link>
      <pubDate>Thu, 07 Jul 2022 12:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/develop-a-csi-driver/</guid>
      <description>&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;å¤–éƒ¨å­˜å‚¨æ¥å…¥ Kubernetes çš„æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼šIn-Tree å’Œ Out-of-Treeã€‚å…¶ä¸­ In-Tree æ˜¯æŒ‡å­˜å‚¨é©±åŠ¨çš„æºç éƒ½åœ¨ Kubernetes ä»£ç åº“ä¸­ï¼Œä¸ Kubernetes ä¸€èµ·å‘å¸ƒã€è¿­ä»£ã€ç®¡ç†ï¼Œè¿™ç§æ–¹å¼çµæ´»æ€§è¾ƒå·®ï¼Œä¸”é—¨æ§›è¾ƒé«˜ã€‚Out-of-Tree æ˜¯æŒ‡å­˜å‚¨æ’ä»¶ç”±ç¬¬ä¸‰æ–¹ç¼–å†™ã€å‘å¸ƒã€ç®¡ç†ï¼Œä½œä¸ºä¸€ç§æ‰©å±•ä¸ Kubernetes é…åˆä½¿ç”¨ã€‚Out-of-Tree ä¸»è¦æœ‰ FlexVolume å’Œ CSI ä¸¤ç§å®ç°æ–¹å¼ï¼Œå…¶ä¸­ï¼ŒFlexVolume å› ä¸ºå…¶å‘½ä»¤å¼çš„ç‰¹ç‚¹ï¼Œä¸æ˜“ç»´æŠ¤å’Œç®¡ç†ï¼Œä» Kubernetes v1.23 ç‰ˆæœ¬å¼€å§‹å·²è¢«å¼ƒç”¨ã€‚å› æ­¤ CSI å·²ç»æˆä¸º Kubernetes å­˜å‚¨æ‰©å±•ï¼ˆOut-of-Treeï¼‰çš„å”¯ä¸€æ–¹å¼ã€‚&lt;/p&gt;
&lt;h2 id=&#34;csi-ç»„æˆ&#34;&gt;CSI ç»„æˆ&lt;/h2&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-csi-architecture&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;csi-architecture&#34; srcset=&#34;
               /blog/develop-a-csi-driver/csi-architecture_hu16305224972259748500.webp 400w,
               /blog/develop-a-csi-driver/csi-architecture_hu5971302514969355805.webp 760w,
               /blog/develop-a-csi-driver/csi-architecture_hu5733481104496700788.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/develop-a-csi-driver/csi-architecture_hu16305224972259748500.webp&#34;
               width=&#34;760&#34;
               height=&#34;426&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      csi-architecture
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å‚è€ƒä¸Šå›¾ï¼ˆ&lt;a href=&#34;https://discuss.kubernetes.io/t/understanding-csi-architecture-and-communication/9404/2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å›¾ç‰‡å‡ºå¤„&lt;/a&gt;ï¼‰ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼š&lt;strong&gt;CSI Driver = DaemonSet + Deployment(StatefuleSet)&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç»¿è‰²éƒ¨åˆ†ï¼š&lt;strong&gt;Identityã€Nodeã€Controller&lt;/strong&gt; æ˜¯éœ€è¦å¼€å‘è€…è‡ªå·±å®ç°çš„ï¼Œè¢«ç§°ä¸º &lt;strong&gt;Custom Components&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç²‰è‰²éƒ¨åˆ†ï¼š&lt;strong&gt;node-driver-registrarã€external-attacherã€external-provisioner&lt;/strong&gt; ç»„ä»¶æ˜¯ Kubernetes å›¢é˜Ÿå¼€å‘å’Œç»´æŠ¤çš„ï¼Œè¢«ç§°ä¸º &lt;strong&gt;External Components&lt;/strong&gt;ï¼Œå®ƒä»¬éƒ½æ˜¯ä»¥ &lt;strong&gt;sidecar&lt;/strong&gt; çš„å½¢å¼ä¸ &lt;strong&gt;Custom Components&lt;/strong&gt; é…åˆä½¿ç”¨çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;custom-components&#34;&gt;Custom Components&lt;/h3&gt;
&lt;p&gt;Custom Components æœ¬è´¨æ˜¯ 3 ä¸ª gRPC Servicesï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Identity Service&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é¡¾åæ€ä¹‰ï¼Œä¸»è¦ç”¨äºå¯¹å¤–æš´éœ²è¿™ä¸ªæ’ä»¶æœ¬èº«çš„ä¿¡æ¯ï¼Œæ¯”å¦‚é©±åŠ¨çš„åç§°ã€é©±åŠ¨çš„èƒ½åŠ›ç­‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-protobuf&#34; data-lang=&#34;protobuf&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;service&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Identity&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;GetPluginInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GetPluginInfoRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GetPluginInfoResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;GetPluginCapabilities&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GetPluginCapabilitiesRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GetPluginCapabilitiesResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Probe&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ProbeRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ProbeResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Controller Service&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸»è¦å®šä¹‰ä¸€äº›&lt;strong&gt;æ— éœ€åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œ&lt;/strong&gt;çš„æ“ä½œï¼Œè¿™ä¹Ÿæ˜¯ä¸ä¸‹æ–‡çš„ Node Service æœ€æ ¹æœ¬çš„åŒºåˆ«ã€‚ä»¥ &lt;code&gt;CreateVolume&lt;/code&gt; ä¸ºä¾‹ï¼Œk8s é€šè¿‡è°ƒç”¨è¯¥æ–¹æ³•åˆ›å»ºåº•å±‚å­˜å‚¨ã€‚æ¯”å¦‚åº•å±‚ä½¿ç”¨äº†æŸäº‘ä¾›åº”å•†çš„äº‘ç¡¬ç›˜æœåŠ¡ï¼Œå¼€å‘è€…åœ¨ &lt;code&gt;CreateVolume&lt;/code&gt; æ–¹æ³•å®ç°ä¸­åº”è¯¥è°ƒç”¨äº‘ç¡¬ç›˜æœåŠ¡çš„åˆ›å»º/è®¢è´­äº‘ç¡¬ç›˜çš„ APIï¼Œè°ƒç”¨ API è¿™ä¸ªæ“ä½œæ˜¯ä¸éœ€è¦åœ¨ç‰¹å®šå®¿ä¸»æœºä¸Šæ‰§è¡Œçš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-protobuf&#34; data-lang=&#34;protobuf&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;service&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Controller&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CreateVolume&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CreateVolumeRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CreateVolumeResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DeleteVolume&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DeleteVolumeRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DeleteVolumeResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ControllerPublishVolume&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ControllerPublishVolumeRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ControllerPublishVolumeResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ControllerUnpublishVolume&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ControllerUnpublishVolumeRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ControllerUnpublishVolumeResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ValidateVolumeCapabilities&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ValidateVolumeCapabilitiesRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ValidateVolumeCapabilitiesResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ListVolumes&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ListVolumesRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ListVolumesResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;GetCapacity&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GetCapacityRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GetCapacityResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ControllerGetCapabilities&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ControllerGetCapabilitiesRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ControllerGetCapabilitiesResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CreateSnapshot&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CreateSnapshotRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CreateSnapshotResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DeleteSnapshot&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DeleteSnapshotRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DeleteSnapshotResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ListSnapshots&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ListSnapshotsRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ListSnapshotsResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ControllerExpandVolume&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ControllerExpandVolumeRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ControllerExpandVolumeResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ControllerGetVolume&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ControllerGetVolumeRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ControllerGetVolumeResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;option&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;alpha_method&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Node Service&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å®šä¹‰äº†&lt;strong&gt;éœ€è¦åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œ&lt;/strong&gt;çš„æ“ä½œï¼Œæ¯”å¦‚ï¼šmountã€unmountã€‚åœ¨å‰é¢çš„éƒ¨ç½²æ¶æ„å›¾ä¸­ï¼ŒNode Service ä½¿ç”¨ &lt;strong&gt;Daemonset&lt;/strong&gt; çš„æ–¹å¼éƒ¨ç½²ï¼Œä¹Ÿæ˜¯ä¸ºäº†ç¡®ä¿ Node Service ä¼šè¢«è¿è¡Œåœ¨æ¯ä¸ªèŠ‚ç‚¹ï¼Œä»¥ä¾¿æ‰§è¡Œè¯¸å¦‚ mount ä¹‹ç±»çš„æŒ‡ä»¤ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-protobuf&#34; data-lang=&#34;protobuf&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;service&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NodeStageVolume&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NodeStageVolumeRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NodeStageVolumeResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NodeUnstageVolume&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NodeUnstageVolumeRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NodeUnstageVolumeResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NodePublishVolume&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NodePublishVolumeRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NodePublishVolumeResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NodeUnpublishVolume&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NodeUnpublishVolumeRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NodeUnpublishVolumeResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NodeGetVolumeStats&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NodeGetVolumeStatsRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NodeGetVolumeStatsResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NodeExpandVolume&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NodeExpandVolumeRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NodeExpandVolumeResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NodeGetCapabilities&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NodeGetCapabilitiesRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NodeGetCapabilitiesResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;rpc&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NodeGetInfo&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NodeGetInfoRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;returns&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NodeGetInfoResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸Šå®šä¹‰å–è‡ª &lt;a href=&#34;https://github.com/container-storage-interface/spec/blob/master/csi.proto&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;csi.proto&lt;/a&gt;ï¼Œä½¿ç”¨çš„æ˜¯ &lt;a href=&#34;https://grpc.io/docs/what-is-grpc/introduction/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Protocol Buffers&lt;/a&gt; æè¿°è¯­è¨€ã€‚&lt;/p&gt;
&lt;h3 id=&#34;external-components&#34;&gt;External Components&lt;/h3&gt;
&lt;p&gt;External Components éƒ½æ˜¯ä»¥ sidecar çš„æ–¹å¼æä¾›ä½¿ç”¨çš„ã€‚å½“å¼€å‘å®Œä¸‰ä¸ª Custom Components ä¹‹åï¼Œå¼€å‘è€…éœ€è¦æ ¹æ®å­˜å‚¨çš„ç‰¹ç‚¹ï¼Œé€‰æ‹©åˆé€‚çš„ sidecar å®¹å™¨æ³¨å…¥åˆ° Pod ä¸­ã€‚è¿™é‡Œçš„ External Components é™¤äº†å‰é¢å›¾ä¸­æåˆ°çš„ node-driver-registrarã€external-attacherã€external-provisioner è¿˜æœ‰å¾ˆå¤šï¼Œå¯ä»¥å‚è€ƒ&lt;a href=&#34;https://kubernetes-csi.github.io/docs/sidecar-containers.html#kubernetes-csi-sidecar-containers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ï¼Œè¿™é‡Œå¯¹å¸¸ç”¨çš„ sidecars åšä¸€äº›ç®€å•ä»‹ç»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;https://kubernetes-csi.github.io/docs/livenessprobe.html#csi-livenessprobe&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;livenessprobe&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;liveessprobe&lt;/code&gt; ç›‘è§† CSI é©±åŠ¨ç¨‹åºçš„è¿è¡ŒçŠ¶å†µï¼Œå¹¶å°†å…¶æŠ¥å‘Šç»™ Kubernetesã€‚è¿™ä½¿å¾— Kubernetes èƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹é©±åŠ¨ç¨‹åºçš„é—®é¢˜ï¼Œå¹¶é‡æ–°å¯åŠ¨ pod æ¥å°è¯•ä¿®å¤é—®é¢˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;https://kubernetes-csi.github.io/docs/node-driver-registrar.html#csi-node-driver-registrar&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;node-driver-registrar&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;node-driver-registrar&lt;/code&gt; å¯ä» CSI driver è·å–é©±åŠ¨ç¨‹åºä¿¡æ¯ï¼ˆé€šè¿‡ &lt;code&gt;NodeGetInfo&lt;/code&gt; æ–¹æ³•ï¼‰ï¼Œå¹¶ä½¿ç”¨ kubelet æ’ä»¶æ³¨å†Œæœºåˆ¶åœ¨è¯¥èŠ‚ç‚¹ä¸Šçš„ kubelet ä¸­å¯¹å…¶è¿›è¡Œæ³¨å†Œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;https://kubernetes-csi.github.io/docs/external-provisioner.html#csi-external-provisioner&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;external-provisioner&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;external-provisioner&lt;/code&gt; ç»„ä»¶å¯¹äºå—å­˜å‚¨ï¼ˆå¦‚ cephï¼‰éå¸¸å…³é”®ã€‚å®ƒç›‘å¬ &lt;code&gt;PersistentVolumeClaim&lt;/code&gt; åˆ›å»ºï¼Œè°ƒç”¨ CSI é©±åŠ¨çš„ &lt;code&gt;CreateVolume&lt;/code&gt; æ–¹æ³•åˆ›å»ºå¯¹åº”çš„åº•å±‚å­˜å‚¨ï¼ˆå¦‚ ceph imageï¼‰ï¼Œä¸€æ—¦åˆ›å»ºæˆåŠŸï¼Œprovisioner ä¼šåˆ›å»ºä¸€ä¸ª &lt;code&gt;PersistentVolume&lt;/code&gt; èµ„æºã€‚å½“ç›‘å¬åˆ° &lt;code&gt;PersistentVolumeClaim&lt;/code&gt; åˆ é™¤æ—¶ï¼Œå®ƒä¼šè°ƒç”¨ CSI çš„ &lt;code&gt;DeleteVolume&lt;/code&gt; æ–¹æ³•åˆ é™¤åº•å±‚å­˜å‚¨ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™åˆ é™¤ &lt;code&gt;PersistentVolume&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;https://kubernetes-csi.github.io/docs/external-attacher.html#csi-external-attacher&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;external-attacher&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç”¨äºç›‘å¬ Kubernetes &lt;code&gt;VolumeAttachment&lt;/code&gt; å¯¹è±¡å¹¶è§¦å‘ CSI çš„ &lt;code&gt;Controller[Publish|Unpublish]Volume&lt;/code&gt; æ“ä½œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;https://kubernetes-csi.github.io/docs/external-resizer.html#csi-external-resizer&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;external-resizer&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç›‘å¬ &lt;code&gt;PersistentVolumeClaim&lt;/code&gt; èµ„æºä¿®æ”¹ï¼Œè°ƒç”¨ CSI &lt;code&gt;ControllerExpandVolume&lt;/code&gt; æ–¹æ³•ï¼Œæ¥è°ƒæ•´ volume çš„å¤§å°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;External Components ä¸ Custom Components å…±åŒç»„æˆéƒ¨ç½² yamlï¼Œå¯ä»¥å‚è€ƒ ceph-csi çš„éƒ¨ç½² yamlï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/ceph/ceph-csi/blob/v3.0.0/deploy/rbd/kubernetes/csi-rbdplugin-provisioner.yaml&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;csi-rbdplugin-provisioner.yaml&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/ceph/ceph-csi/blob/v3.0.0/deploy/rbd/kubernetes/csi-rbdplugin.yaml&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;csi-rbdplugin.yaml&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;psï¼šå…¶ä¸­ cephcsi é•œåƒæ˜¯å¼€å‘è€…å®ç°çš„ï¼ŒåŒ…å«æ‰€æçš„ 3 ä¸ª gRPC æœåŠ¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åŠ¨æ€å·ä¾›åº”dynamic-volume-provisioningæ‰§è¡Œè¿‡ç¨‹&#34;&gt;åŠ¨æ€å·ä¾›åº”ï¼ˆDynamic Volume Provisioningï¼‰æ‰§è¡Œè¿‡ç¨‹&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†å®ç° Identityã€Nodeã€Controller 3 ä¸ªæœåŠ¡ï¼Œéœ€è¦æ¸…æ¥šåŠ¨æ€å·ä¾›åº”çš„æ‰§è¡Œè¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-dynamic-provisioning-timeline&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;dynamic-provisioning-timeline&#34; srcset=&#34;
               /blog/develop-a-csi-driver/dynamic-provisioning-timeline_hu2257359240973063368.webp 400w,
               /blog/develop-a-csi-driver/dynamic-provisioning-timeline_hu14689849129388655571.webp 760w,
               /blog/develop-a-csi-driver/dynamic-provisioning-timeline_hu13500002942193029716.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/develop-a-csi-driver/dynamic-provisioning-timeline_hu2257359240973063368.webp&#34;
               width=&#34;760&#34;
               height=&#34;630&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      dynamic-provisioning-timeline
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ï¼ˆ&lt;a href=&#34;https://kingjcy.github.io/post/cloud/paas/base/kubernetes/k8s-store-csi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å›¾ç‰‡å‡ºå¤„&lt;/a&gt;ï¼‰&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;	 CreateVolume +------------+ DeleteVolume
 +-------------&amp;gt;|  CREATED   +--------------+
 |              +---+----^---+              |
 |       Controller |    | Controller       v
+++         Publish |    | Unpublish       +++
|X|          Volume |    | Volume          | |
+-+             +---v----+---+             +-+
                | NODE_READY |
                +---+----^---+
               Node |    | Node
              Stage |    | Unstage
             Volume |    | Volume
                +---v----+---+
                |  VOL_READY |
                +---+----^---+
               Node |    | Node
            Publish |    | Unpublish
             Volume |    | Volume
                +---v----+---+
                | PUBLISHED  |
                +------------+
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ï¼ˆå†…å®¹å–è‡ª&lt;a href=&#34;https://github.com/container-storage-interface/spec/blob/master/spec.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;csi-spec&lt;/a&gt;ï¼‰&lt;/p&gt;
&lt;p&gt;CSI Dynamic Volume Provisioning å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”¨æˆ·åˆ›å»º pod + pvcã€‚&lt;/li&gt;
&lt;li&gt;VolumeController çš„ PersistentVolumeController æ§åˆ¶å¾ªç¯ç›‘å¬åˆ° pvc åˆ›å»ºï¼Œå‘ç°ä½¿ç”¨çš„æ˜¯ Out-of-Tree æ¨¡å¼ï¼Œè·³è¿‡ã€‚è¯¥æ§åˆ¶å¾ªç¯ä¸»è¦è´Ÿè´£ In-Tree æ¨¡å¼ä¸‹ pv å’Œ pvc çš„ç»‘å®šã€‚&lt;/li&gt;
&lt;li&gt;external-provisioner ç›‘å¬åˆ° pvc åˆ›å»ºï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;è°ƒç”¨ Controller Service çš„ &lt;code&gt;CreateVolume&lt;/code&gt; æ–¹æ³•åˆ›å»ºåº•å±‚å­˜å‚¨ Volumeã€‚æ­¤æ—¶ Volume å±äº &lt;strong&gt;CREATED&lt;/strong&gt; çŠ¶æ€ï¼Œä»…åœ¨å­˜å‚¨ç³»ç»Ÿä¸­å­˜åœ¨ï¼Œå¯¹äºæ‰€æœ‰çš„ Node æˆ–è€… Container éƒ½æ˜¯ä¸å¯æ„ŸçŸ¥çš„ã€‚&lt;/li&gt;
&lt;li&gt;åˆ›å»º pvã€‚&lt;/li&gt;
&lt;li&gt;å°† pv ä¸ pvc ç»‘å®šï¼ˆç»‘å®šï¼šå°†è¿™ä¸ª pv å¯¹è±¡çš„åå­—å¡«åœ¨ pvc å¯¹è±¡çš„ spec.volumeName å­—æ®µä¸Šï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;VolumeController çš„ AttachDetachController æ§åˆ¶å¾ªç¯å‘ç° Volume æœªè¢«æŒ‚è½½åˆ°å®¿ä¸»æœºï¼Œéœ€è¦ Attach æ“ä½œï¼Œäºæ˜¯åˆ›å»º &lt;code&gt;VolumeAttachment&lt;/code&gt; å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;external-attacher ç›‘å¬åˆ° &lt;code&gt;VolumeAttachment&lt;/code&gt; èµ„æºåˆ›å»ºåï¼Œè°ƒç”¨ Controller Service çš„ &lt;code&gt;ControllerPublishVolume&lt;/code&gt; æ–¹æ³•ã€‚æ­¤æ—¶ï¼ŒVolume å¤„äº &lt;strong&gt;NODE_READY&lt;/strong&gt; çŠ¶æ€ï¼Œå³ï¼šNode å¯ä»¥æ„ŸçŸ¥åˆ° Volumeï¼Œä½†æ˜¯å®¹å™¨å†…ä¾ç„¶ä¸å¯è§ã€‚&lt;/li&gt;
&lt;li&gt;kubelet çš„ VolumeManagerReconciler æ§åˆ¶å¾ªç¯ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;æ‰§è¡Œ MountDevice æ“ä½œï¼Œè°ƒç”¨ Node Service çš„ &lt;code&gt;NodeStageVolume&lt;/code&gt; æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¸»è¦å®ç°å¯¹ Volume æ ¼å¼åŒ–ï¼Œç„¶åæŒ‚è½½åˆ°ä¸€ä¸ªä¸´æ—¶ç›®å½•ï¼ˆStaging ç›®å½•ï¼‰ä¸Šï¼Œç»è¿‡æ­¤æ“ä½œåï¼ŒVolume è¿›å…¥ &lt;strong&gt;VOL_READY&lt;/strong&gt; çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œ SetUp æ“ä½œï¼Œè°ƒç”¨ Node Service çš„ &lt;code&gt;NodePublishVolume&lt;/code&gt; æ–¹æ³•ï¼šå°† Staging ç›®å½•ï¼Œç»‘å®šæŒ‚è½½åˆ° Volume å¯¹åº”çš„å®¿ä¸»æœºç›®å½•ä¸Šï¼ŒVolume è¿›å…¥ &lt;strong&gt;PUBLISHED&lt;/strong&gt; çŠ¶æ€ï¼Œç”¨æˆ·æ­¤æ—¶å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;csi-å¼€å‘&#34;&gt;CSI å¼€å‘&lt;/h2&gt;
&lt;h3 id=&#34;ä»é›¶å¼€å§‹å®ç°ä¸€ä¸ª-nfs-csi&#34;&gt;ä»é›¶å¼€å§‹å®ç°ä¸€ä¸ª nfs-csi&lt;/h3&gt;
&lt;p&gt;ç›´æ¥å®ç° ceph-csi ä»£ç é‡æ¯”è¾ƒå¤šï¼Œä¸”éœ€è¦åŸºäº ceph é›†ç¾¤è°ƒè¯•ï¼Œå¯¹æ–°æ‰‹ä¸å¤ªå‹å¥½ã€‚æ‰€ä»¥æœ¬æ–‡å…ˆä»ä¸€ä¸ªç®€å•çš„ nfs-csi å…¥æ‰‹ï¼Œå†åˆ†æ ceph-csi çš„æ ¸å¿ƒä»£ç ã€‚é¦–å…ˆæ˜¯æ¡†æ¶æ­å»ºï¼Œå› ä¸ºé€»è¾‘å¹¶ä¸å¤æ‚ï¼Œæ‰€ä»¥é‡‡ç”¨ä¸€ç§æ¯”è¾ƒæ‰å¹³çš„ç›®å½•è®¾è®¡ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;.
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ LICENSE
â”œâ”€â”€ Makefile
â”œâ”€â”€ README.md
â”œâ”€â”€ driver
â”‚Â Â  â”œâ”€â”€ controller_server.go
â”‚Â Â  â”œâ”€â”€ driver.go
â”‚Â Â  â”œâ”€â”€ identity_server.go
â”‚Â Â  â”œâ”€â”€ node_server.go
â”‚Â Â  â”œâ”€â”€ server.go  // å¯¹ gRPC Server çš„ä¸€ä¸ªç®€å•å°è£…
â”‚Â Â  â””â”€â”€ utils.go   // å·¥å…·å‡½æ•°
â”œâ”€â”€ yamls    // å­˜æ”¾éƒ¨ç½²å’Œæµ‹è¯•yaml
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â””â”€â”€ main.go  // å…¥å£æ–‡ä»¶
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;èµ·ä¸€ä¸ª gRPC Serverï¼ŒæŠŠ 3 ä¸ªæœåŠ¡æ³¨å†Œåˆ° CSIï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nonBlockingGRPCServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;serve&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;endpoint&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ids&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IdentityServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cs&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ControllerServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ns&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NodeServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;proto&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ParseEndpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;endpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fatal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proto&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;unix&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;addr&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Remove&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;IsNotExist&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fatalf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Failed to remove %s, error: %s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Listen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;proto&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fatalf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Failed to listen: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;opts&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ServerOption&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;UnaryInterceptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LogGRPC&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;grpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;opts&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ids&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RegisterIdentityServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ids&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RegisterControllerServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ns&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RegisterNodeServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ns&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Listening for connections on address: %#v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;reflection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Register&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Serve&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fatalf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Failed to serve grpc server: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸åŒäºå¹³æ—¶å†™ gRPC æœåŠ¡æ‰€ç”¨çš„ endpoint &lt;code&gt;tcp://127.0.0.1:10000&lt;/code&gt;ï¼Œcsi gRPC æ˜¯åŸºäº UDSï¼ˆUNIX Domain Socketï¼‰&lt;code&gt;unix://tmp/csi.sock&lt;/code&gt;ã€‚UDS æ˜¯ä¸€ç§ IPC é€šä¿¡æœºåˆ¶ï¼Œä¸éœ€è¦ç»è¿‡ç½‘ç»œåè®®æ ˆï¼Œä¸éœ€è¦æ‰“åŒ…æ‹†åŒ…ã€è®¡ç®—æ ¡éªŒå’Œã€ç»´æŠ¤åºå·å’Œåº”ç­”ç­‰ï¼Œåœ¨åŒä¸€å°ä¸»æœºçš„é€šä¿¡ä¸­å…·æœ‰æ›´é«˜çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å…³äº-debug&#34;&gt;å…³äº Debug&lt;/h3&gt;
&lt;p&gt;å› ä¸ºå¼€å‘ csi é©±åŠ¨æœ¬è´¨æ˜¯å¼€å‘ gPRC æœåŠ¡ï¼Œå¸¸ç”¨çš„ gPRC è°ƒè¯•å·¥å…·ï¼šgrpcuiã€grpcurl éƒ½æ˜¯å¯ä»¥ç”¨æ¥è°ƒè¯•çš„ï¼Œä¸‹å›¾æ˜¯ grpcui ä½¿ç”¨ç•Œé¢ :&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-grpcui&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;grpcui&#34; srcset=&#34;
               /blog/develop-a-csi-driver/grpcui_hu15605276508778252533.webp 400w,
               /blog/develop-a-csi-driver/grpcui_hu9252825606128944436.webp 760w,
               /blog/develop-a-csi-driver/grpcui_hu18255405083049753180.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/develop-a-csi-driver/grpcui_hu15605276508778252533.webp&#34;
               width=&#34;760&#34;
               height=&#34;739&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      grpcui
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸€æ¬¾ &lt;a href=&#34;https://github.com/rexray/gocsi/tree/master/csc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;csc&lt;/a&gt; å·¥å…·ï¼Œé…ç½®ä¸€äº›ç®€å•çš„ç¯å¢ƒå˜é‡åï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œçš„æ–¹å¼è°ƒç”¨æ¥å£ï¼ˆ&lt;a href=&#34;https://github.com/kubernetes-csi/csi-driver-nfs/blob/master/docs/csi-dev.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨æ–‡æ¡£&lt;/a&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ csc identity plugin-info --endpoint &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$endpoint&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;nfs.csi.k8s.io&amp;#34;&lt;/span&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;v2.0.0&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;identity-å®ç°&#34;&gt;Identity å®ç°&lt;/h3&gt;
&lt;p&gt;gPRC æ¶å­æ­å¥½åå¯ä»¥å¼€å§‹å®ç°æ¥å£ï¼Œä»æœ€ç®€å•çš„ Identity æœåŠ¡å¼€å§‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ids&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IdentityServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;GetPluginInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GetPluginInfoRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GetPluginInfoResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GetPluginInfoResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;          &lt;span class=&#34;nx&#34;&gt;ids&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Driver&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;VendorVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ids&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Driver&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ids&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IdentityServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Probe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ProbeRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ProbeResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ProbeResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Ready&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;wrappers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;BoolValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}},&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ids&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IdentityServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;GetPluginCapabilities&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GetPluginCapabilitiesRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GetPluginCapabilitiesResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GetPluginCapabilitiesResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;Capabilities&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PluginCapability&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PluginCapability_Service_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PluginCapability_Service&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;						&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PluginCapability_Service_CONTROLLER_SERVICE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;GetPluginInfo&lt;/code&gt; æ¥å£è¿”å›é©±åŠ¨çš„åç§°å’Œç‰ˆæœ¬ä¿¡æ¯ï¼Œæ¯”å¦‚ ceph-csi çš„åç§°ï¼š&lt;code&gt;rbd.csi.ceph.com&lt;/code&gt;ï¼Œè¯¥åç§°ä¸ StorageClass yaml ä¸­çš„ &lt;code&gt;provisioner&lt;/code&gt; å­—æ®µå¯¹åº”ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;storage.k8s.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;StorageClass&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;csi-rbd-sc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;provisioner&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbd.csi.ceph.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;parameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;	 &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;reclaimPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Delete&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;allowVolumeExpansion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mountOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;discard&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;GetPluginCapabilities&lt;/code&gt; æ¥å£è¿”å›æ’ä»¶çš„èƒ½åŠ›ï¼Œå…·ä½“å¯ä»¥é˜…è¯» &lt;code&gt;csi.proto&lt;/code&gt; ä¸­å…³äº &lt;code&gt;PluginCapability&lt;/code&gt; çš„æ³¨é‡Š&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;controller-å®ç°&#34;&gt;Controller å®ç°&lt;/h3&gt;
&lt;p&gt;æ¥ä¸‹æ¥å®ç° Controller æœåŠ¡ã€‚åœ¨ nfs CSI Controller ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦å®ç° &lt;code&gt;CreateVolume&lt;/code&gt;ã€&lt;code&gt;DeleteVolume&lt;/code&gt;ã€&lt;code&gt;ControllerGetCapabilities&lt;/code&gt; å³å¯ã€‚ç»†å¿ƒçš„ä¼™ä¼´å¯èƒ½ä¼šæƒ³åˆ°ï¼Œnfs å…¶å®ä¹Ÿä¸ç”¨åˆ›å»ºå­˜å‚¨ï¼Œç›´æ¥æŒ‚è½½å°±å¯ä»¥ä½¿ç”¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;mount&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nfs&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nfsroot&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mnt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nfs&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½†æ˜¯ï¼Œä¸ºä»€ä¹ˆéœ€è¦å®ç° &lt;code&gt;CreateVolume&lt;/code&gt; æ–¹æ³•å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å› ä¸ºæˆ‘ä»¬ä¸èƒ½å°†åŒä¸€ä¸ª nfs ç›®å½•æŒ‚è½½ç»™å¤šä¸ª pod ä½¿ç”¨ï¼Œä¸æ˜¯åŠŸèƒ½ä¸Šä¸å…è®¸ï¼Œè€Œæ˜¯æƒé™ä¸Šä¸åº”è¯¥ã€‚æˆ‘ä»¬åº”è¯¥ç»™æ¯ä¸ª pv å»ºç«‹ä¸€ä¸ªç‹¬ç«‹çš„ç›®å½•ï¼Œè¿™æ ·äº’ç›¸ä¹‹é—´ä¸ä¼šå½±å“ã€‚å…·ä½“åšæ³•ç±»ä¼¼äºæ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# å…ˆæŠŠ nfs root mount åˆ°å®¿ä¸»æœºæŸä¸€ä¸´æ—¶ç›®å½•&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mount -t nfs nfsServer:/root/nfs /tmp/nfs-root-78y88
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# è¿›å…¥ root ç›®å½•åˆ›å»ºå­ç›®å½•&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir /tmp/nfs-root-78y88/pvc-31bf63ad-80c2-451c-a9c3-f80b9bad302c
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# å¸è½½&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;umount /tmp/nfs-root-78y88
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ ·ï¼Œåœ¨åç»­ä½¿ç”¨æ—¶ç›´æ¥æŒ‚è½½ &lt;code&gt;nfsServer:/root/nfs/pvc-31bf63ad-80c2-451c-a9c3-f80b9bad302c&lt;/code&gt; å³å¯&lt;/p&gt;
&lt;p&gt;&lt;code&gt;CreateVolume&lt;/code&gt; æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ControllerServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;CreateVolume&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CreateVolumeRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CreateVolumeResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;nfsVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;newNFSVolume&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reqCapacity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetParameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;codes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InvalidArgument&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// æŠŠ nfs root æŒ‚è½½åˆ°ä¸€ä¸ªä¸´æ—¶ç›®å½•
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalMount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nfsVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;volCap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;codes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Internal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;failed to mount nfs server: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// å–æ¶ˆæŒ‚è½½ï¼ˆdeferï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalUnmount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nfsVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Warningf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;failed to unmount nfs server: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// è·å–æƒé™å’Œå­ç›®å½•å
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;fileMode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;FileMode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Driver&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mountPermissions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;internalVolumePath&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getInternalVolumePath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nfsVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// åœ¨ nfs root ç›®å½•ä¸­åˆ›å»ºå­ç›®å½•
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Mkdir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;internalVolumePath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fileMode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;IsExist&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;codes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Internal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;failed to make subdirectory: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CreateVolumeResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Volume&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;nfsVolToCSI&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nfsVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)},&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;DeleteVolume&lt;/code&gt; åŸºæœ¬åŒ &lt;code&gt;CreateVolume&lt;/code&gt;ï¼Œåªæ˜¯ &lt;code&gt;mkdir&lt;/code&gt; æ¢æˆ &lt;code&gt;rm&lt;/code&gt; å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ControllerGetCapabilities&lt;/code&gt; è¿”å› Controller çš„èƒ½åŠ›ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ControllerServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ControllerGetCapabilities&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ControllerGetCapabilitiesRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ControllerGetCapabilitiesResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ControllerGetCapabilitiesResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;Capabilities&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ControllerServiceCapability&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ControllerServiceCapability_Rpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;Rpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ControllerServiceCapability_RPC&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;						&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ControllerServiceCapability_RPC_CREATE_DELETE_VOLUME&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ControllerServiceCapability_Rpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;Rpc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ControllerServiceCapability_RPC&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;						&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ControllerServiceCapability_RPC_SINGLE_NODE_MULTI_WRITER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;node-å®ç°&#34;&gt;Node å®ç°&lt;/h3&gt;
&lt;p&gt;å¯¹äº nfsï¼ŒNode æœåŠ¡éœ€è¦å®ç°ï¼š&lt;code&gt;NodePublishVolume&lt;/code&gt;ã€&lt;code&gt;NodeUnpublishVolume&lt;/code&gt;ã€&lt;code&gt;NodeGetInfo&lt;/code&gt;ã€&lt;code&gt;NodeGetCapabilities&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;NodeGetInfo&lt;/code&gt; è¿”å›å½“å‰ node æœåŠ¡è¿è¡Œåœ¨å“ªä¸ªèŠ‚ç‚¹ï¼Œå…¶ä¸­ï¼ŒnodeId æ˜¯é€šè¿‡ç¯å¢ƒå˜é‡ &lt;code&gt;fieldRef&lt;/code&gt; æ³¨å…¥çš„ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-nfs-csi-yaml&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;nfs-csi-yaml&#34; srcset=&#34;
               /blog/develop-a-csi-driver/nfs-csi-yaml_hu8393338938383196344.webp 400w,
               /blog/develop-a-csi-driver/nfs-csi-yaml_hu1442071210707933290.webp 760w,
               /blog/develop-a-csi-driver/nfs-csi-yaml_hu5596460644647088098.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/develop-a-csi-driver/nfs-csi-yaml_hu8393338938383196344.webp&#34;
               width=&#34;760&#34;
               height=&#34;588&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      nfs-csi-yaml
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ns&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NodeServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NodeGetInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NodeGetInfoRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NodeGetInfoResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NodeGetInfoResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;NodeId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ns&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Driver&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nodeID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;NodeGetCapabilities&lt;/code&gt; éœ€è¦é…ç½®ä»¥ä¸‹ 3 ç§èƒ½åŠ›ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;csi.NodeServiceCapability_RPC_GET_VOLUME_STATS
csi.NodeServiceCapability_RPC_SINGLE_NODE_MULTI_WRITER
csi.NodeServiceCapability_RPC_UNKNOWN
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Node æœåŠ¡çš„æ ¸å¿ƒæ˜¯ &lt;code&gt;NodePublishVolume&lt;/code&gt; æ–¹æ³•ï¼Œéœ€è¦æ‰§è¡Œ mount æ“ä½œï¼Œç­‰ä»·äºæ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mount -t nfs nfsServer:/root/nfs/pvc-31bf63ad-80c2-451c-a9c3-f80b9bad302c /var/lib/kubelet/pods/aad09eed-e4a2-42ca-84e4-d8301c7d6257/volumes/kubernetes.io~csi/pvc-31bf63ad-80c2-451c-a9c3-f80b9bad302c/mount
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;NodePublishVolume&lt;/code&gt; æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// NodePublishVolume mount the volume
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ns&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NodeServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NodePublishVolume&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NodePublishVolumeRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NodePublishVolumeResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	 &lt;span class=&#34;c1&#34;&gt;// æ ¹æ® req è·å– sourceã€targetPath
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;c1&#34;&gt;// æŠŠ nfsServer:/root/nfs/pvc-31bf63ad-80c2-451c-a9c3-f80b9bad302c æŒ‚è½½åˆ° /var/lib/kubelet/pods/aad09eed-e4a2-42ca-84e4-d8301c7d6257/volumes/kubernetes.io~csi/pvc-31bf63ad-80c2-451c-a9c3-f80b9bad302c/mount
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ns&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mounter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Mount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;targetPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;nfs&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mountOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;c1&#34;&gt;// é”™è¯¯å¤„ç†
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	 &lt;span class=&#34;c1&#34;&gt;// ä¿®æ”¹ç›®å½•æƒé™
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Chmod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;targetPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;FileMode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ns&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Driver&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mountPermissions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;codes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Internal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NodePublishVolumeResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è‡³æ­¤ï¼Œä¸€ä¸ªç®€å•çš„ nfs-csi å°±å®ç°å®Œæˆäº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ceph-csi-æ ¸å¿ƒæºç è§£æ&#34;&gt;Ceph-csi æ ¸å¿ƒæºç è§£æ&lt;/h2&gt;
&lt;p&gt;nfs ä¸ ceph è¿™ç±»å—å­˜å‚¨ä¸å¤ªç›¸åŒï¼Œä¸éœ€è¦åˆ›å»ºç£ç›˜ï¼ˆProvisionï¼‰ã€æŠŠç£ç›˜æŒ‚è½½åˆ°å®¿ä¸»æœºï¼ˆAttachï¼‰æ“ä½œï¼Œæ¯”å¦‚ ceph ä¸­çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rbd create -p pool-01 --image rbd-demo.img --size 10G
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rbd map pool-01/rbd-demo.img
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥æˆ‘ä»¬ç®€å•çœ‹ä¸€ä¸‹ ceph-csi æ˜¯å¦‚ä½•ç”¨ä»£ç å®ç°ä¸Šè¿°æ“ä½œçš„ã€‚é¦–å…ˆï¼Œåœ¨ä¹‹å‰çš„ Dynamic Volume Provisioning æ‰§è¡Œè¿‡ç¨‹ä¸­å·²ç»è®²è¿‡ï¼ŒProvision åº”è¯¥æ˜¯åœ¨ &lt;code&gt;CreateVolume&lt;/code&gt; æ–¹æ³•ä¸­å®ç°çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// CreateVolume creates the volume in backend
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ControllerServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;CreateVolume&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CreateVolumeRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CreateVolumeResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// è¯·æ±‚å‚æ•°æ ¡éªŒ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;validateVolumeReq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// æ ¹æ® secret æ„å»º ceph è¯·æ±‚å‡­è¯
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;util&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewUserCredentials&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetSecrets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;codes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Internal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;DeleteCredentials&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// å¤„ç†è¯·æ±‚å‚æ•°ï¼Œå¹¶è½¬æ¢ä¸º rbdVol ç»“æ„ä½“
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;parseVolCreateRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Destroy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Existence and conflict checks
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// æ£€æŸ¥å¹¶è·å–é”ï¼ˆåŒåå­˜å‚¨åœ¨åŒä¸€æ—¶é—´ï¼Œåªèƒ½åšåˆ›å»ºã€åˆ é™¤ç­‰æ“ä½œä¸­çš„ä¸€ä¸ªï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;acquired&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;VolumeLocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TryAcquire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;acquired&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;util&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;util&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;VolumeOperationAlreadyExistsFmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;codes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Aborted&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;util&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;VolumeOperationAlreadyExistsFmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;VolumeLocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// å¹‚ç­‰æ€§
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;found&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;checkVolExists&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ErrVolNameConflict&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;codes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;AlreadyExists&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;codes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Internal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// å·²ç»å­˜åœ¨åŒåå·
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;found&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Encrypted&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ensureEncryptionMetadataSet&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;util&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;volumeContext&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetParameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;volumeContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;pool&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pool&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;volumeContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;journalPool&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;JournalPool&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;volume&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Volume&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;VolumeId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;VolID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;CapacityBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;VolSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;VolumeContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;volumeContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;ContentSource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetVolumeContentSource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Topology&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;volume&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;AccessibleTopology&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Topology&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;						&lt;span class=&#34;nx&#34;&gt;Segments&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Topology&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CreateVolumeResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Volume&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;volume&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// å¿«ç…§
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;rbdSnap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;checkSnapshotSource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// é¢„å®š rbdVolume nameï¼Œå¹¶åˆ›å»º volumeID
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;reserveVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbdSnap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;codes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Internal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;errDefer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;undoVolReservation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;errDefer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Warningf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;util&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;failed undoing reservation of volume: %s (%s)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;errDefer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// åˆ›å»º image
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;createBackingImage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbdSnap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Encrypted&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ensureEncryptionMetadataSet&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;util&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;failed to save encryption status, deleting image %s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RbdImageName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;deleteErr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;deleteImage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;util&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;failed to delete rbd image: %s/%s with error: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RbdImageName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;deleteErr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;deleteErr&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;volumeContext&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetParameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;volumeContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;pool&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pool&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;volumeContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;journalPool&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;JournalPool&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;volume&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Volume&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;VolumeId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;VolID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;CapacityBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;VolSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;VolumeContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;volumeContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;ContentSource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetVolumeContentSource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Topology&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;volume&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;AccessibleTopology&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Topology&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;Segments&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbdVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Topology&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CreateVolumeResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Volume&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;volume&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆ›å»ºç£ç›˜é•œåƒï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;librbd&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;github.com/ceph/go-ceph/rbd&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;createImage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pOpts&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rbdVolume&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;util&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Credentials&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;librbd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;CreateImage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ioctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pOpts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RbdImageName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nb&#34;&gt;uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;util&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RoundOffVolSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pOpts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;VolSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;util&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MiB&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;errors&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Wrapf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;failed to create rbd image&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ° ceph-csi ä¸­æ˜¯ä½¿ç”¨ &lt;strong&gt;librbd&lt;/strong&gt; åº“è¿æ¥ ceph é›†ç¾¤è¿›è¡Œ image åˆ›å»ºã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„ &lt;code&gt;CreateVolume&lt;/code&gt; å®ç°çš„&lt;strong&gt;å¹‚ç­‰æ€§&lt;/strong&gt;ã€‚å› ä¸º k8s å¯èƒ½å› ä¸ºä¸€äº›å…¶ä»–åŸå› ï¼ˆæ¯”å¦‚ç½‘ç»œè¶…æ—¶é‡è¯•ï¼‰é‡å¤å‘é€è¯·æ±‚ï¼Œå®ç°ä¸­éœ€è¦å¯¹æ­¤è¿›è¡Œåˆ¤æ–­ï¼Œä¸å¯é‡å¤åˆ›å»ºã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥çœ‹ Attachï¼Œç†è®ºä¸Š Attach æ“ä½œåº”è¯¥æ˜¯åœ¨ &lt;code&gt;ControllerPublishVolume&lt;/code&gt; æ–¹æ³•ä¸­å®ç°çš„ï¼Œä½†å®é™…ä¸Š ceph çš„ map å‘½ä»¤éœ€è¦åˆ°å¯¹åº”çš„å®¿ä¸»æœºä¸Šæ‰èƒ½æ‰§è¡Œï¼Œæ‰€ä»¥å®ç°æ˜¯åœ¨ &lt;code&gt;NodeStageVolume&lt;/code&gt; æ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ns&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NodeServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NodeStageVolume&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NodeStageVolumeRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NodeStageVolumeResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// perform the actual staging and if this fails, have undoStagingTransaction
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// cleans up for us
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nx&#34;&gt;transaction&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ns&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;stageTransaction&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;volOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;staticVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;codes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Internal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NodeStageVolumeResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ns&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NodeServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;stageTransaction&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;csi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NodeStageVolumeRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;volOptions&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rbdVolume&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;staticVol&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stageTransaction&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Mapping RBD image
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;devicePath&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;devicePath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;attachRBDImage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;volOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;stagingTargetPath&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getStagingTargetPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// æŒ‚è½½åˆ° nodeStage
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ns&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;mountVolumeToStagePath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;staticVol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;stagingTargetPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;devicePath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// è®¾ç½®æƒé™
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Chmod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stagingTargetPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mo&#34;&gt;0777&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;transaction&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;attachRBDImage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;volOptions&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rbdVolume&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;util&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Credentials&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// åˆ¤æ–­ image æ˜¯å¦å·²ç» map åˆ° node ä¸Š
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;devicePath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;found&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;waitForPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;volOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;useNBD&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;found&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;backoff&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Backoff&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;Duration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbdImageWatcherInitDelay&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;Factor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;   &lt;span class=&#34;nx&#34;&gt;rbdImageWatcherFactor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;Steps&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;rbdImageWatcherSteps&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;waitForrbdImage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;backoff&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;volOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// æ‰§è¡Œ map æ“ä½œ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;devicePath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;createPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;volOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;devicePath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;createPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;volOpt&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rbdVolume&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;util&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Credentials&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Map options
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;mapOptions&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;s&#34;&gt;&amp;#34;--id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;s&#34;&gt;&amp;#34;-m&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;volOpt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Monitors&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;s&#34;&gt;&amp;#34;--keyfile=&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;KeyFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;s&#34;&gt;&amp;#34;map&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;imagePath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Execute map
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;output&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;execCommand&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rbd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mapOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;devicePath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œattach å®é™…å°±æ˜¯æ‰§è¡Œ &lt;code&gt;rbd map&lt;/code&gt; æŒ‡ä»¤ï¼Œä¸ä¹‹å‰çš„è®¾æƒ³ä¸€è‡´ã€‚å‡½æ•°åµŒå¥—æ¯”è¾ƒæ·±ï¼Œæ­¤å¤„åªä¿ç•™äº†æ ¸å¿ƒä»£ç ï¼Œå®Œæ•´ä»£ç å¯ä»¥å‚è€ƒ &lt;a href=&#34;https://github.com/ceph/ceph-csi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ceph-csi&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒèµ„æ–™&#34;&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes-csi/csi-driver-nfs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/kubernetes-csi/csi-driver-nfs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes-csi.github.io/docs/introduction.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes-csi.github.io/docs/introduction.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/container-storage-interface/spec/blob/master/spec.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/container-storage-interface/spec/blob/master/spec.md&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kingjcy.github.io/post/cloud/paas/base/kubernetes/k8s-store-csi/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kingjcy.github.io/post/cloud/paas/base/kubernetes/k8s-store-csi/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/ceph/ceph-csi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/ceph/ceph-csi&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ã€Šæ·±å…¥å‰–æ Kubernetesã€‹â€” å¼ ç£Š&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>åœ¨éå®¹å™¨ç¯å¢ƒä¸Šå®ç°æ•£è£…çš„ IPVS SVC</title>
      <link>https://cloudnativecn.com/blog/create-a-ipvs-svc-without-container/</link>
      <pubDate>Wed, 29 Sep 2021 00:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/create-a-ipvs-svc-without-container/</guid>
      <description>&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;å†…éƒ¨æœ‰é K8S ç¯å¢ƒä¸Šéœ€è¦ç±»ä¼¼ SVC çš„è´Ÿè½½å®ç°ï¼Œä¸€å¼€å§‹æ˜¯ç”¨ NGINX åšçš„ï¼Œæ‰€æœ‰ SVC åŸŸåéƒ½è§£ææˆä¸€ä¸ª dummy IPï¼Œç„¶å NGINX æ ¹æ® &lt;code&gt;server_name&lt;/code&gt; å» proxy ä¸åŒçš„ upstreamã€‚å¼€å§‹è¿˜æ˜¯èƒ½ç”¨çš„ï¼Œä½†æ˜¯åé¢ç»“æœåé¢å¾ˆå¤šæœåŠ¡ä¾èµ– &lt;code&gt;host&lt;/code&gt; è¿™ä¸ª headerï¼ŒæŠ¥é”™ç­¾åé”™è¯¯ï¼Œè€Œä¸”æ¯•ç«Ÿè¿™æ ·æ˜¯åœ¨ç”¨æˆ·æ€ï¼Œæ•ˆç‡ä¸å¦‚å†…æ ¸æ€é«˜ã€‚äºæ˜¯æ‰“ç®—æä¸‹ä¹‹å‰çš„æ‰“ç®—ï¼šæŠŠ IPVS çš„ &lt;code&gt;ClusterIP&lt;/code&gt; çš„ SVC æ‰£åˆ°é K8S ç¯å¢ƒä¸Šä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;kube-proxy çš„ SVC ç®€å•è®²å°±æ˜¯ node ä¸Šä»»ä½•è¿›ç¨‹è®¿é—® &lt;code&gt;SVC IP:SVC PORT&lt;/code&gt; ä¼šè¢« dnat æˆ &lt;code&gt;endpoint&lt;/code&gt; ï¼Œæ˜¯å·¥ä½œåœ¨å†…æ ¸æ€çš„å››å±‚è´Ÿè½½ï¼Œä¸ä¼šåœ¨æœºå™¨ä¸Šçœ‹åˆ°ç«¯å£ç›‘å¬ï¼Œè€Œé»˜è®¤éé›†ç¾¤çš„æœºå™¨æ˜¯æ— æ³•è®¿é—® SVC IPã€‚åœ¨ K8S é‡Œï¼Œendpoint çš„ ip æ— éå°±æ˜¯ &lt;code&gt;POD IP&lt;/code&gt;ï¼Œ&lt;code&gt;host IP&lt;/code&gt;ã€‚å‰è€…å°±æ˜¯ SVC é€‰ä¸­ PODï¼Œåè€…ä¾‹å¦‚ &lt;code&gt;kubernetes&lt;/code&gt; è¿™ä¸ª SVCï¼Œä¼š DNAT æˆæ¯ä¸ª &lt;code&gt;kube-apiserver&lt;/code&gt; çš„ &lt;code&gt;host IP:6443&lt;/code&gt; ç«¯å£ï¼Œä¹Ÿå¯èƒ½æ˜¯ &lt;code&gt;ExternalName&lt;/code&gt; æˆ–è€…æ‰‹åŠ¨åˆ›å»ºçš„ endpointã€‚æ—¢ç„¶ &lt;code&gt;kubernetes&lt;/code&gt; è¿™ä¸ª SVC å¯ä»¥ã€‚é‚£æˆ‘çš„æ‰“ç®—åº”è¯¥ä¹Ÿæ˜¯å¯ä»¥å®ç°çš„ã€‚ä½†æ˜¯ä¸€å¼€å§‹å®é™…æŒ‰ç…§æ€è·¯è¯•äº†ä¸‹å‘ç°ä¸è¡Œï¼Œç½‘ä¸Šçš„æ–‡ç« åŸºæœ¬éƒ½æ˜¯åœ¨å•æœº docker æˆ–è€…ç°æœ‰çš„ K8S ç¯å¢ƒä¸Šæçš„ï¼Œæ¼æ‰äº†å¾ˆå¤šç²¾åå’Œæ ¸å¿ƒæ€æƒ³ï¼Œè¿™é‡Œè®°å½•ä¸‹æˆ‘çš„æ€è·¯å’Œå®ç°è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¯å¢ƒä¿¡æ¯&#34;&gt;ç¯å¢ƒä¿¡æ¯&lt;/h2&gt;
&lt;p&gt;å‰é¢è¯´çš„ SVC ç°è±¡æ˜¯å’Œ &lt;code&gt;kube-proxy&lt;/code&gt; çš„æ¨¡å¼æ— å…³çš„ã€‚&lt;code&gt;iptables&lt;/code&gt; æ¨¡å¼æ’æŸ¥ä¸ç›´è§‚ï¼Œæˆ‘æ›´å€¾å‘äº &lt;code&gt;IPVS&lt;/code&gt; å»æï¼Œå®ƒæ›´ç›´è§‚ï¼Œè€Œä¸”æ”¯æŒæ›´å¤šçš„è°ƒåº¦ç®—æ³•ã€‚ç®¡ç† IPVS è§„åˆ™çš„è¯æˆ‘ä»¬éœ€è¦å®‰è£… &lt;code&gt;ipvsadm&lt;/code&gt; ï¼Œè¿™é‡Œæˆ‘æ˜¯ä¸¤å°å¹²å‡€çš„ CentOS 7.8 æ¥åšç¯å¢ƒã€‚&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;IP&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;192.168.2.111&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;192.168.2.222&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å…ˆå®‰è£…ä¸‹åŸºç¡€éœ€è¦çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;yum install -y ipvsadm curl wget tcpdump ipset conntrack-tools
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# å¼€å¯è½¬å‘&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sysctl -w net.ipv4.ip_forward&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ç¡®è®¤ iptables è§„åˆ™æ¸…ç©º&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -S
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-P INPUT ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-P FORWARD ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-P OUTPUT ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -t nat -S
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-P PREROUTING ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-P INPUT ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-P OUTPUT ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-P POSTROUTING ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;è¿‡ç¨‹&#34;&gt;è¿‡ç¨‹&lt;/h2&gt;
&lt;p&gt;å…ˆæ€è€ƒä¸‹ kube-proxy çš„ IPVSï¼Œå› ä¸º SVC ç«¯å£å’Œ POD çš„ç«¯å£ä¸ä¸€æ ·ï¼Œæ‰€ä»¥ kube-proxy ä½¿ç”¨çš„ &lt;code&gt;nat&lt;/code&gt; æ¨¡å¼ã€‚æš‚ä¸”æ‰“ç®—æ·»åŠ ä¸€ä¸ªä¸‹é¢ç±»ä¼¼çš„ SVCï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;IP:                169.254.11.2
Port:              https  80/TCP
TargetPort:        6443/TCP
Endpoints:         192.168.2.111:8080,192.168.2.222:8080
Session Affinity:  None
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;å‡†å¤‡å·¥ä½œ&#34;&gt;å‡†å¤‡å·¥ä½œ&lt;/h3&gt;
&lt;p&gt;web çš„è¯æˆ‘æ˜¯ä½¿ç”¨çš„ golang çš„ä¸€ä¸ªç®€å• web äºŒè¿›åˆ¶èµ·çš„ &lt;a href=&#34;https://github.com/m3ng9i/ran&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ran&lt;/a&gt; :&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;wget https://github.com/m3ng9i/ran/releases/download/v0.1.6/ran_linux_amd64.zip
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;unzip -x ran_linux_amd64.zip
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir www
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ä¸¤ä¸ªæœºå™¨åˆ›å»ºä¸åŒçš„ index æ–‡ä»¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; 192.168.2.111 &amp;gt; www/test
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; 192.168.2.222 &amp;gt; www/test
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;./ran_linux_amd64 -port &lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt; -listdir www
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸¤ä¸ªæœºå™¨çš„è¿™ä¸ª web éƒ½èµ·æ¥åæˆ‘ä»¬å¼€ä¸ªçª—å£å» &lt;code&gt;192.168.2.111&lt;/code&gt; ä¸Šç»§ç»­åé¢çš„æ“ä½œã€‚&lt;/p&gt;
&lt;h3 id=&#34;lvs-nat&#34;&gt;lvs nat&lt;/h3&gt;
&lt;p&gt;kube-proxy å¹¶æ²¡æœ‰åƒ lvs nat é‚£æ ·æœ‰å•ç‹¬çš„æœºå™¨åš &lt;code&gt;NAT GW&lt;/code&gt;ï¼Œæˆ–è€…è®¤ä¸ºæ¯ä¸ª node éƒ½æ˜¯è‡ªå·±çš„ &lt;code&gt;NAT GW&lt;/code&gt;ã€‚ç°åœ¨æ¥æ·»åŠ  &lt;code&gt;169.254.11.2:80&lt;/code&gt; è¿™ä¸ª SVCï¼Œä½¿ç”¨ ipvsadm æ·»åŠ ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ipvsadm --add-service --tcp-service 169.254.11.2:80 --scheduler rr
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…ˆæ·»åŠ æœ¬åœ°çš„ web ä½œä¸º real serverï¼Œä¸‹é¢å«ä¹‰æ˜¯æ·»åŠ ä¸ºä¸€ä¸ª nat ç±»å‹çš„ real serverï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ipvsadm --add-server --tcp-service 169.254.11.2:80 &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --real-server 192.168.2.111:8080 --masquerading --weight &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŸ¥çœ‹ä¸‹å½“å‰åˆ—è¡¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ipvsadm -ln
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP Virtual Server version 1.2.1 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;4096&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Prot LocalAddress:Port Scheduler Flags
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -&amp;gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TCP  169.254.11.2:80 rr
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -&amp;gt; 192.168.2.111:8080           Masq    &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;      &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å› ä¸ºæ˜¯è‡ªå·±çš„ &lt;code&gt;NAT GW&lt;/code&gt;ï¼Œæ‰€ä»¥ VIP é…ç½®åœ¨è‡ªå·±èº«ä¸Šï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ip addr add 169.254.11.2/32 dev eth0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æµ‹è¯•ä¸‹è®¿é—®çœ‹çœ‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl 169.254.11.2/www/test
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;192.168.2.111
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ·»åŠ ä¸Šå¦ä¸€ä¸ªèŠ‚ç‚¹çš„ 8080ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ipvsadm --add-server --tcp-service 169.254.11.2:80 &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --real-server 192.168.2.222:8080 --masquerading --weight &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ipvsadm -ln
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP Virtual Server version 1.2.1 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;4096&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Prot LocalAddress:Port Scheduler Flags
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -&amp;gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TCP  169.254.11.2:80 rr
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -&amp;gt; 192.168.2.111:8080           Masq    &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;      &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;         
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -&amp;gt; 192.168.2.222:8080           Masq    &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;      &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æµ‹è¯•ä¸‹è®¿é—®çœ‹çœ‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl 169.254.11.2/www/test
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å‘ç° curl åœ¨å¡ä½å’Œèƒ½è®¿é—®è¿”å› &lt;code&gt;192.168.2.111&lt;/code&gt; ä¹‹é—´åˆ‡æ¢ï¼Œæ²¡æœ‰è¿”å› &lt;code&gt;192.168.2.222&lt;/code&gt; çš„ã€‚æŸ¥çœ‹ä¸‹ IPVS çš„ connectionï¼Œå‘ç°è°ƒåº¦åˆ°éæœ¬æœºæ‰ä¼šå¡ä½ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ipvsadm -lnc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IPVS connection entries
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;pro expire state       &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;             virtual            destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TCP 00:48  SYN_RECV    169.254.11.2:50698 169.254.11.2:80    192.168.2.222:8080
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ &lt;code&gt;192.168.2.222&lt;/code&gt; ä¸ŠæŠ“åŒ…çœ‹çœ‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ tcpdump -nn -i eth0 port &lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcpdump: verbose output suppressed, use -v or -vv &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; full protocol decode
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;listening on eth0, link-type EN10MB &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Ethernet&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;, capture size &lt;span class=&#34;m&#34;&gt;262144&lt;/span&gt; bytes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;07:38:26.360716 IP 169.254.11.2.50710 &amp;gt; 192.168.2.222.8080: Flags &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;S&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, seq 768065283, win 43690, options &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;mss 65495,sackOK,TS val &lt;span class=&#34;m&#34;&gt;12276183&lt;/span&gt; ecr 0,nop,wscale 7&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, length &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;07:38:26.360762 IP 192.168.2.222.8080 &amp;gt; 169.254.11.2.50710: Flags &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;S.&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, seq 2142784980, ack 768065284, win 28960, options &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;mss 1460,sackOK,TS val &lt;span class=&#34;m&#34;&gt;676518144&lt;/span&gt; ecr 12276183,nop,wscale 7&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, length &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;07:38:27.362848 IP 169.254.11.2.50710 &amp;gt; 192.168.2.222.8080: Flags &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;S&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, seq 768065283, win 43690, options &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;mss 65495,sackOK,TS val &lt;span class=&#34;m&#34;&gt;12277186&lt;/span&gt; ecr 0,nop,wscale 7&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, length &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;07:38:27.362884 IP 192.168.2.222.8080 &amp;gt; 169.254.11.2.50710: Flags &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;S.&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, seq 2142784980, ack 768065284, win 28960, options &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;mss 1460,sackOK,TS val &lt;span class=&#34;m&#34;&gt;676519146&lt;/span&gt; ecr 12276183,nop,wscale 7&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, length &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;07:38:28.562629 IP 192.168.2.222.8080 &amp;gt; 169.254.11.2.50710: Flags &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;S.&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, seq 2142784980, ack 768065284, win 28960, options &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;mss 1460,sackOK,TS val &lt;span class=&#34;m&#34;&gt;676520346&lt;/span&gt; ecr 12276183,nop,wscale 7&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, length &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;07:38:29.368811 IP 169.254.11.2.50710 &amp;gt; 192.168.2.222.8080: Flags &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;S&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, seq 768065283, win 43690, options &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;mss 65495,sackOK,TS val &lt;span class=&#34;m&#34;&gt;12279192&lt;/span&gt; ecr 0,nop,wscale 7&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, length &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;07:38:29.368853 IP 192.168.2.222.8080 &amp;gt; 169.254.11.2.50710: Flags &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;S.&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, seq 2142784980, ack 768065284, win 28960, options &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;mss 1460,sackOK,TS val &lt;span class=&#34;m&#34;&gt;676521152&lt;/span&gt; ecr 12276183,nop,wscale 7&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, length &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;07:38:31.562633 IP 192.168.2.222.8080 &amp;gt; 169.254.11.2.50710: Flags &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;S.&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, seq 2142784980, ack 768065284, win 28960, options &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;mss 1460,sackOK,TS val &lt;span class=&#34;m&#34;&gt;676523346&lt;/span&gt; ecr 12276183,nop,wscale 7&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, length &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;07:38:33.376829 IP 169.254.11.2.50710 &amp;gt; 192.168.2.222.8080: Flags &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;S&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, seq 768065283, win 43690, options &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;mss 65495,sackOK,TS val &lt;span class=&#34;m&#34;&gt;12283200&lt;/span&gt; ecr 0,nop,wscale 7&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, length &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;07:38:33.376869 IP 192.168.2.222.8080 &amp;gt; 169.254.11.2.50710: Flags &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;S.&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, seq 2142784980, ack 768065284, win 28960, options &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;mss 1460,sackOK,TS val &lt;span class=&#34;m&#34;&gt;676525160&lt;/span&gt; ecr 12276183,nop,wscale 7&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, length &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;07:38:37.562632 IP 192.168.2.222.8080 &amp;gt; 169.254.11.2.50710: Flags &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;S.&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, seq 2142784980, ack 768065284, win 28960, options &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;mss 1460,sackOK,TS val &lt;span class=&#34;m&#34;&gt;676529346&lt;/span&gt; ecr 12276183,nop,wscale 7&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, length &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä» &lt;code&gt;Flags&lt;/code&gt; çœ‹ï¼Œå°±æ˜¯ tcp é‡ä¼ ï¼Œå¹¶ä¸” &lt;code&gt;SRC IP&lt;/code&gt; æ˜¯ VIPã€‚èŠ‚ç‚¹ &lt;code&gt;192.168.2.222.8080&lt;/code&gt; ç»™ &lt;code&gt;169.254.11.2.50710&lt;/code&gt; å›åŒ…ä¼šèµ°åˆ°ç½‘å…³ä¸Šå»ã€‚ç½‘å…³ä¸ŠæŠ“åŒ…ä¹Ÿçœ‹åˆ°ç¡®å®å¦‚æ­¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ tcpdump -nn -i eth0 host 169.254.11.2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcpdump: verbose output suppressed, use -v or -vv &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; full protocol decode
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;listening on eth0, link-type EN10MB &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Ethernet&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;, capture size &lt;span class=&#34;m&#34;&gt;262144&lt;/span&gt; bytes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;19:39:47.487362 IP 192.168.2.222.8080 &amp;gt; 169.254.11.2.50714: Flags &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;S.&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, seq 4149799699, ack 251479303, win 28960, options &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;mss 1460,sackOK,TS val &lt;span class=&#34;m&#34;&gt;676599263&lt;/span&gt; ecr 12357303,nop,wscale 7&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, length &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;19:39:47.487405 IP 192.168.2.222.8080 &amp;gt; 169.254.11.2.50714: Flags &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;S.&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, seq 4149799699, ack 251479303, win 28960, options &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;mss 1460,sackOK,TS val &lt;span class=&#34;m&#34;&gt;676599263&lt;/span&gt; ecr 12357303,nop,wscale 7&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, length &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;19:39:48.487838 IP 192.168.2.222.8080 &amp;gt; 169.254.11.2.50714: Flags &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;S.&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, seq 4149799699, ack 251479303, win 28960, options &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;mss 1460,sackOK,TS val &lt;span class=&#34;m&#34;&gt;676600264&lt;/span&gt; ecr 12357303,nop,wscale 7&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, length &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;19:39:48.487868 IP 192.168.2.222.8080 &amp;gt; 169.254.11.2.50714: Flags &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;S.&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, seq 4149799699, ack 251479303, win 28960, options &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;mss 1460,sackOK,TS val &lt;span class=&#34;m&#34;&gt;676600264&lt;/span&gt; ecr 12357303,nop,wscale 7&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, length &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;19:39:49.569667 IP 192.168.2.222.8080 &amp;gt; 169.254.11.2.50714: Flags &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;S.&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, seq 4149799699, ack 251479303, win 28960, options &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;mss 1460,sackOK,TS val &lt;span class=&#34;m&#34;&gt;676601346&lt;/span&gt; ecr 12357303,nop,wscale 7&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, length &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;19:39:49.569699 IP 192.168.2.222.8080 &amp;gt; 169.254.11.2.50714: Flags &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;S.&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, seq 4149799699, ack 251479303, win 28960, options &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;mss 1460,sackOK,TS val &lt;span class=&#34;m&#34;&gt;676601346&lt;/span&gt; ecr 12357303,nop,wscale 7&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, length &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;lvs-å’Œ-netfilter&#34;&gt;lvs å’Œ netfilter&lt;/h4&gt;
&lt;p&gt;åœ¨ä»‹ç» lvs çš„å®ç°ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ netfilterï¼ŒLinux çš„æ‰€æœ‰æ•°æ®åŒ…éƒ½ä¼šç»è¿‡å®ƒï¼Œè€Œæˆ‘ä»¬ä½¿ç”¨çš„ iptables æ˜¯ç”¨æˆ·æ€æä¾›çš„æ“ä½œå·¥å…·ä¹‹ä¸€ã€‚Linux å†…æ ¸å¤„ç†è¿›å‡ºçš„æ•°æ®åŒ…åˆ†ä¸ºäº† 5 ä¸ªé˜¶æ®µã€‚netfilter åœ¨è¿™ 5 ä¸ªé˜¶æ®µæä¾›äº† hook ç‚¹ï¼Œæ¥è®©æ³¨å†Œçš„ hook å‡½æ•°æ¥å®ç°å¯¹åŒ…çš„è¿‡æ»¤å’Œä¿®æ”¹ã€‚ä¸‹å›¾çš„ local process å°±æ˜¯ä¸Šå±‚çš„åè®®æ ˆã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ IPVS åœ¨ netfilter é‡Œçš„æ¨¡å‹å›¾ï¼ŒIPVS ä¹Ÿæ˜¯åŸºäº netfilter æ¡†æ¶çš„ï¼Œä½†åªå·¥ä½œåœ¨ &lt;code&gt;INPUT&lt;/code&gt; é“¾ä¸Šï¼Œé€šè¿‡æ³¨å†Œ &lt;code&gt;ip_vs_in&lt;/code&gt; é’©å­å‡½æ•°æ¥å¤„ç†è¯·æ±‚ã€‚å› ä¸º VIP æˆ‘ä»¬é…ç½®åœ¨æœºå™¨ä¸Šï¼ˆå¸¸è§„çš„ lvs nat çš„ VIP æ˜¯åœ¨ NAT GW ä¸Šï¼Œæˆ‘ä»¬è¿™é‡Œæ˜¯è‡ªå·±ï¼‰ï¼Œæˆ‘ä»¬ curl çš„æ—¶å€™å°±ä¼šè¿›åˆ° &lt;code&gt;INPUT&lt;/code&gt; é“¾ï¼Œ&lt;code&gt;ip_vs_in&lt;/code&gt; ä¼šåŒ¹é…ç„¶åç›´æ¥è·³è½¬è§¦å‘ &lt;code&gt;POSTROUTING&lt;/code&gt; é“¾ï¼Œè·³è¿‡ iptables è§„åˆ™ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-lvs-netfilter&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;lvs-netfilter&#34; srcset=&#34;
               /blog/create-a-ipvs-svc-without-container/lvs-netfilter_hu3448538245118405658.webp 400w,
               /blog/create-a-ipvs-svc-without-container/lvs-netfilter_hu5107094950310195869.webp 760w,
               /blog/create-a-ipvs-svc-without-container/lvs-netfilter_hu4730026604610297759.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/create-a-ipvs-svc-without-container/lvs-netfilter_hu3448538245118405658.webp&#34;
               width=&#34;718&#34;
               height=&#34;311&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      lvs-netfilter
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥è¯·æ±‚æµç¨‹æ˜¯ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# CIP: client IP    # RIP: real server IP

	CLIENT
	   | CIP:CPORT -&amp;gt; VIP:VPORT
	   |		||
	   |		\/
    	   | CIP:CPORT -&amp;gt; VIP:VPORT
   	LVS DNAT
   	   | CIP:CPORT -&amp;gt; RIP:RPORT
   	   |		||
	   |		\/
	   | CIP:CPORT -&amp;gt; RIP:RPORT
	   +
	REAL SERVER
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;lvs åšäº† DNAT å¹¶æ²¡æœ‰åš SNATï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨ iptables åš SNATï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ iptables -t nat -A POSTROUTING -m ipvs --vaddr 169.254.11.2 --vport 80 -j MASQUERADE
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è®¿é—®çœ‹çœ‹è¿˜æ˜¯ä¸é€šï¼ŒæŠ“åŒ…çœ‹è¿˜æ˜¯æ²¡ç”Ÿæ•ˆï¼Œnat æ˜¯ä¾èµ– &lt;code&gt;conntrack&lt;/code&gt; çš„ï¼Œè€Œ IPVS é»˜è®¤ä¸ä¼šè®°å½• conntrackï¼Œæˆ‘ä»¬éœ€è¦å¼€å¯ IPVS çš„ conntrack æ‰å¯ä»¥è®© MASQUERADE ç”Ÿæ•ˆã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# è®© Netfilter çš„ conntrack çŠ¶æ€ç®¡ç†åŠŸèƒ½ä¹Ÿèƒ½åº”ç”¨äº IPVS æ¨¡å—&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &amp;gt;  /proc/sys/net/ipv4/vs/conntrack
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$  curl 169.254.11.2/www/test
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;192.168.2.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl 169.254.11.2/www/test
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;192.168.2.222
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl 169.254.11.2/www/test
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;192.168.2.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl 169.254.11.2/www/test
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;192.168.2.222
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl 169.254.11.2/www/test
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;192.168.2.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl 169.254.11.2/www/test
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;192.168.2.222
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨å®ç°äº†å•ä¸ª SVC çš„ï¼Œä½†æ˜¯ä»”ç»†æ€è€ƒä¸‹è¿˜æ˜¯æœ‰é—®é¢˜ï¼Œå¦‚æœåç»­å¢åŠ å¦ä¸€ä¸ª SVC åˆå¾—å¢åŠ ä¸€ä¸ª iptables è§„åˆ™äº†ï¼Œé‚£å°±åˆå›åˆ° iptables çš„åŒ¹é…å¤æ‚åº¦è€—æ—¶é•¿ä¸Šå»äº†ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ iptables çš„ mark å’Œ ipset é…åˆå‡å°‘ iptables è§„åˆ™ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åˆ©ç”¨-ipset-å’Œ-iptable-çš„-mark&#34;&gt;åˆ©ç”¨ ipset å’Œ iptable çš„ mark&lt;/h3&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-iptables_netfilter&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;iptables_netfilter&#34; srcset=&#34;
               /blog/create-a-ipvs-svc-without-container/iptables_netfilter_hu11822433570661435642.webp 400w,
               /blog/create-a-ipvs-svc-without-container/iptables_netfilter_hu18191934556046985955.webp 760w,
               /blog/create-a-ipvs-svc-without-container/iptables_netfilter_hu9537959094937169371.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/create-a-ipvs-svc-without-container/iptables_netfilter_hu11822433570661435642.webp&#34;
               width=&#34;760&#34;
               height=&#34;401&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      iptables_netfilter
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;iptables çš„äº”é“¾å››è¡¨å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å…ˆåˆ æ‰åŸæœ‰çš„è§„åˆ™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -t nat -D POSTROUTING -m ipvs --vaddr 169.254.11.2 --vport &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt; -j MASQUERADE
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¹³æ—¶è‡ªå·±å®¶é‡Œä½¿ç”¨äº† openwrtï¼Œä¹‹å‰çœ‹äº†ä¸‹ä¸Šé¢çš„ iptables è§„åˆ™è®¾è®¡æŒºå¥½çš„ï¼Œç‰¹åˆ«æ˜¯é¢„ç•™äº†å¾ˆå¤šé“¾ä¸“é—¨ç»™ç”¨æˆ·åœ¨åˆé€‚çš„ä½ç½®æ’å…¥è§„åˆ™ï¼Œæ¯”å¦‚ä¸‹é¢çš„ &lt;code&gt;INPUT&lt;/code&gt; è§„åˆ™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A INPUT -i eth0 -m comment --comment &lt;span class=&#34;s2&#34;&gt;&amp;#34;!fw3&amp;#34;&lt;/span&gt; -j zone_lan_input
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A zone_lan_input -m comment --comment &lt;span class=&#34;s2&#34;&gt;&amp;#34;!fw3: Custom lan input rule chain&amp;#34;&lt;/span&gt; -j input_lan_rule
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A zone_lan_input -m conntrack --ctstate DNAT -m comment --comment &lt;span class=&#34;s2&#34;&gt;&amp;#34;!fw3: Accept port redirections&amp;#34;&lt;/span&gt; -j ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A zone_lan_input -m comment --comment &lt;span class=&#34;s2&#34;&gt;&amp;#34;!fw3&amp;#34;&lt;/span&gt; -j zone_lan_src_ACCEPT
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;zone_lan_src_ACCEPT&lt;/code&gt; æ˜¯æœ€åé¢ï¼Œ&lt;code&gt;zone_lan_input&lt;/code&gt; æ˜¯æœ€å¼€å§‹ï¼Œé‚£ç”¨æˆ·å‘ &lt;code&gt;input_lan_rule&lt;/code&gt; é“¾é‡Œæ’å…¥è§„åˆ™å³å¯ï¼Œåˆ©ç”¨å¤šä¸ªé“¾æ¥è®¾è®¡ä¹Ÿæ–¹ä¾¿åˆ«äººã€‚
è§„åˆ™è®¾è®¡æˆ‘ä»¬å…ˆé€†ç€æ¥æ€è€ƒä¸‹ï¼Œæœ€åè‚¯å®šæ˜¯ &lt;code&gt;MASQUERADE&lt;/code&gt; çš„ï¼Œå¾—åœ¨ nat è¡¨çš„ &lt;code&gt;POSTROUTING&lt;/code&gt; é“¾åˆ›å»º &lt;code&gt;MASQUERADE&lt;/code&gt; çš„è§„åˆ™ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æ·»åŠ ä¹‹å‰å…ˆæ€è€ƒä¸‹ï¼Œlvs åšäº† DNAT åï¼Œæœ€ååŒ…èµ°å‘äº† &lt;code&gt;POSTROUTING&lt;/code&gt; é“¾ï¼Œè€Œä¸”åé¢æˆ‘ä»¬æ˜¯æœ‰å¤šä¸ª SVC çš„ã€‚æ­¤åˆ»åŒ…çš„ &lt;code&gt;SRC IP&lt;/code&gt; ä¼šæ˜¯ &lt;code&gt;VIP&lt;/code&gt;ï¼Œè€Œ &lt;code&gt;DEST IP&lt;/code&gt; æ˜¯åšäº† DNAT åçš„ &lt;code&gt;real server&lt;/code&gt; ï¼Œè€Œä¸”åç»­å¯èƒ½æ˜¯åœ¨åœ¨ docker ç¯å¢ƒä¸Šéƒ¨ç½²ï¼Œå¯èƒ½é»˜è®¤æ¡¥æ¥ç½‘ç»œçš„å®¹å™¨ä¹Ÿä¼šå»è®¿é—® &lt;code&gt;SVC&lt;/code&gt;ï¼Œæ­¤åˆ»çš„ &lt;code&gt;SRC IP&lt;/code&gt; å°±ä¸ä¼šæ˜¯ç½‘å¡ä¸Šçš„ &lt;code&gt;VIP&lt;/code&gt; äº†ï¼Œä½†æ˜¯åœ¨ &lt;code&gt;PREROUTING&lt;/code&gt; é“¾çš„æ—¶å€™ï¼Œ&lt;code&gt;DEST IP&lt;/code&gt; è¿˜æ²¡å˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ­¤åˆ»åˆ©ç”¨ä¸€ä¸ª ipset å­˜å‚¨æ‰€æœ‰çš„ &lt;code&gt;SVC_IP:SVC_PORT&lt;/code&gt; åŒ¹é…ï¼Œç„¶åæ‰“ä¸Š markï¼Œç„¶ååœ¨ &lt;code&gt;POSTROUTING&lt;/code&gt; é“¾å»æ ¹æ® mark å»åš &lt;code&gt;MASQUERADE&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# PREROUTING é˜¶æ®µå¤„ç†&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# æä¾›ä¸€ä¸ªå…¥å£é“¾ï¼Œè€Œä¸æ˜¯ç›´æ¥æ·»åŠ åœ¨ PREROUTING é“¾ä¸Š&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;iptables -t nat -N ZGZ-SERVICES
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;iptables -t nat -A PREROUTING -m comment --comment &lt;span class=&#34;s2&#34;&gt;&amp;#34;zgz service portals&amp;#34;&lt;/span&gt; -j ZGZ-SERVICES
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# åœ¨ PREROUTING å­é“¾é‡Œå» ipset åŒ¹é…ï¼Œè·³è½¬åˆ°æˆ‘ä»¬ mark çš„é“¾&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;iptables -t nat -N ZGZ-MARK-MASQ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# åˆ›å»ºå­˜å‚¨æ‰€æœ‰ `SVC_IP:SVC_PORT` çš„ ipset &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ipset create ZGZ-CLUSTER-IP hash:ip,port -exist
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;iptables -t nat -A ZGZ-SERVICES -m comment --comment &lt;span class=&#34;s2&#34;&gt;&amp;#34;zgz service cluster ip + port for masquerade purpose&amp;#34;&lt;/span&gt; -m &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; --match-set ZGZ-CLUSTER-IP dst,dst -j ZGZ-MARK-MASQ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ä¸“é—¨ mark çš„é“¾&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;iptables -t nat -A ZGZ-MARK-MASQ -j MARK --set-xmark 0x2000/0x2000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# POSTROUTING é˜¶æ®µå¤„ç†&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# æä¾›ä¸€ä¸ªå…¥å£é“¾ï¼Œè€Œä¸æ˜¯ç›´æ¥æ·»åŠ åœ¨ POSTROUTING é“¾ä¸Š&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;iptables -t nat -N ZGZ-POSTROUTING
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;iptables -t nat -A POSTROUTING -m comment --comment &lt;span class=&#34;s2&#34;&gt;&amp;#34;zgz postrouting rules&amp;#34;&lt;/span&gt; -j ZGZ-POSTROUTING
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# åœ¨ POSTROUTING é˜¶æ®µåš snat&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;iptables -t nat -A ZGZ-POSTROUTING -m comment --comment &lt;span class=&#34;s2&#34;&gt;&amp;#34;zgz service traffic requiring SNAT&amp;#34;&lt;/span&gt; -m mark --mark 0x2000/0x2000 -j MASQUERADE
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åæ·»åŠ ä¸‹ &lt;code&gt;SVC_IP:SVC_PORT&lt;/code&gt; åˆ°æˆ‘ä»¬çš„ ipset é‡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ipset add ZGZ-CLUSTER-IP 169.254.11.2,tcp:80 -exist
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢æˆ‘ä»¬åˆ›å»ºçš„ ipset é‡Œ &lt;code&gt;ip,port&lt;/code&gt; å’Œ iptables é‡Œ &lt;code&gt;--match-set&lt;/code&gt; åé¢çš„ &lt;code&gt;dst,dst&lt;/code&gt; ç»„åˆåœ¨ä¸€èµ·å°±æ˜¯ &lt;code&gt;DEST IP&lt;/code&gt; å’Œ &lt;code&gt;DEST PORT&lt;/code&gt; åŒæ—¶åŒ¹é…ï¼Œä¸‹é¢æ˜¯ä¸€äº›ä¸¾ä¾‹ï¼š&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;ipset type&lt;/th&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;iptables match-set&lt;/th&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;Packet fields&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;hash:net,port,net&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;src,dst,dst&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;src IP CIDR address, dst port, dst IP CIDR address&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;hash:net,port,net&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;dst,src,src&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;dst IP CIDR address, src port, src IP CIDR address&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;hash:ip,port,ip&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;src,dst,dst&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;src IP address, dst port, dst IP address&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;hash:ip,port,ip&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;dst,src,src&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;dst IP address, src port, src ip address&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;hash:mac&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;src&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;src mac address&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;hash:mac&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;dst&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;dst mac address&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;hash:ip,mac&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;src,src&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;src IP address, src mac address&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;hash:ip,mac&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;dst,dst&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;dst IP address, dst mac address&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;hash:ip,mac&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;dst,src&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;dst IP address, src mac address&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ç„¶åè®¿é—®ä¸‹è¿˜æ˜¯ä¸é€šï¼Œçªç„¶æƒ³èµ·æ¥åœ¨æœºå™¨ä¸Šè®¿é—®æœ¬æœºçš„ IP ç«¯å£çš„æ—¶å€™æ˜¯å†…æ ¸ç›´æ¥è½¬å‘ç»™æœ¬åœ°è¿›ç¨‹ï¼Œè¿™ç§æ•°æ®åŒ…ä¼šåªç»è¿‡ &lt;code&gt;OUTPUT&lt;/code&gt; é“¾ï¼Œä¸ä¼šè¿‡ &lt;code&gt;PREROUTING&lt;/code&gt; ï¼Œä¸è¿‡æˆ‘ä»¬ä¸Šé¢çš„ &lt;code&gt;PREROUTING&lt;/code&gt; é“¾å¯ä»¥å¤„ç†åç»­çš„ docker å®¹å™¨ã€‚è°ƒè¯•äº†ä¸‹å‘ç°ç¡®å®ä¼šèµ° &lt;code&gt;OUTPUT&lt;/code&gt; é“¾ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;kern.warning /var/log/iptables.log&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; /etc/rsyslog.conf
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ systemctl restart rsyslog
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -t nat -I OUTPUT -m &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; --match-set ZGZ-CLUSTER-IP dst,dst  -j LOG --log-prefix &lt;span class=&#34;s1&#34;&gt;&amp;#39;**log-test**&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl 169.254.11.2/www/test
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cat /var/log/iptables.log
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Sep &lt;span class=&#34;m&#34;&gt;27&lt;/span&gt; 23:17:51 centos7 kernel: **log-test**IN&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;OUT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;lo &lt;span class=&#34;nv&#34;&gt;SRC&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;169.254.11.2 &lt;span class=&#34;nv&#34;&gt;DST&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;169.254.11.2 &lt;span class=&#34;nv&#34;&gt;LEN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;60&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;TOS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0x00 &lt;span class=&#34;nv&#34;&gt;PREC&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0x00 &lt;span class=&#34;nv&#34;&gt;TTL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;64&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;ID&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;44864&lt;/span&gt; DF &lt;span class=&#34;nv&#34;&gt;PROTO&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;TCP &lt;span class=&#34;nv&#34;&gt;SPT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;50794&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;DPT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;WINDOW&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;43690&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;RES&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0x00 SYN &lt;span class=&#34;nv&#34;&gt;URGP&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Sep &lt;span class=&#34;m&#34;&gt;27&lt;/span&gt; 23:17:52 centos7 kernel: **log-test**IN&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;OUT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;lo &lt;span class=&#34;nv&#34;&gt;SRC&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;169.254.11.2 &lt;span class=&#34;nv&#34;&gt;DST&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;169.254.11.2 &lt;span class=&#34;nv&#34;&gt;LEN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;60&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;TOS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0x00 &lt;span class=&#34;nv&#34;&gt;PREC&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0x00 &lt;span class=&#34;nv&#34;&gt;TTL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;64&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;ID&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2010&lt;/span&gt; DF &lt;span class=&#34;nv&#34;&gt;PROTO&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;TCP &lt;span class=&#34;nv&#34;&gt;SPT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;50796&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;DPT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;WINDOW&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;43690&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;RES&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0x00 SYN &lt;span class=&#34;nv&#34;&gt;URGP&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éœ€è¦æ·»åŠ ä¸‹é¢è§„åˆ™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;iptables -t nat -A OUTPUT -m comment --comment &lt;span class=&#34;s2&#34;&gt;&amp;#34;zgz service portals&amp;#34;&lt;/span&gt; -j ZGZ-SERVICES
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;keepalived-çš„è‡ªåŠ¨åŒ–å®ç°&#34;&gt;keepalived çš„è‡ªåŠ¨åŒ–å®ç°&lt;/h3&gt;
&lt;p&gt;åˆ°ç›®å‰ä¸ºæ­¢éƒ½æ˜¯æ‰‹åŠ¨æŒ¡ï¼Œè€Œä¸”æ²¡å¥åº·æ£€æŸ¥ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ keepalived åšä¸ªè‡ªåŠ¨æŒ¡çš„ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å®‰è£…-keepalived-2&#34;&gt;å®‰è£… keepalived 2&lt;/h4&gt;
&lt;p&gt;CentOS7 è‡ªå¸¦çš„æºé‡Œ &lt;code&gt;keepalived&lt;/code&gt; ç‰ˆæœ¬å¾ˆä½ï¼Œæˆ‘ä»¬å®‰è£…ä¸‹æ¯”è‡ªå¸¦æ–°çš„ç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;yum install -y http://www.nosuchhost.net/~cheese/fedora/packages/epel-7/x86_64/cheese-release-7-1.noarch.rpm
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;yum install -y keepalived
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# å¤‡ä»½ä¸‹è‡ªå¸¦çš„é…ç½®æ–‡ä»¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cp /etc/keepalived/keepalived.conf&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;,.bak&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;é…ç½®-keepalived&#34;&gt;é…ç½® keepalived&lt;/h4&gt;
&lt;p&gt;æˆ‘ä»¬éœ€è¦é…ç½®ä¸‹ keepalivedï¼Œä¿®æ”¹ä¹‹å‰å…ˆçœ‹ä¸‹é»˜è®¤ç›¸å…³çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ systemctl cat keepalived
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# /usr/lib/systemd/system/keepalived.service&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;Unit&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;Description&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;LVS and VRRP High Availability Monitor
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;After&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;syslog.target network-online.target
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;Service&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;Type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;forking
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;KillMode&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;process
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;EnvironmentFile&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;-/etc/sysconfig/keepalived
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;ExecStart&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/usr/sbin/keepalived &lt;span class=&#34;nv&#34;&gt;$KEEPALIVED_OPTIONS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;ExecReload&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/bin/kill -HUP &lt;span class=&#34;nv&#34;&gt;$MAINPID&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;Install&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;WantedBy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;multi-user.target
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cat /etc/sysconfig/keepalived
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Options for keepalived. See `keepalived --help&amp;#39; output and keepalived(8) and&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# keepalived.conf(5) man pages for a list of all options. Here are the most&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# common ones :&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# --vrrp               -P    Only run with VRRP subsystem.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# --check              -C    Only run with Health-checker subsystem.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# --dont-release-vrrp  -V    Dont remove VRRP VIPs &amp;amp; VROUTEs on daemon stop.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# --dont-release-ipvs  -I    Dont remove IPVS topology on daemon stop.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# --dump-conf          -d    Dump the configuration data.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# --log-detail         -D    Detailed log messages.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# --log-facility       -S    0-7 Set local syslog facility (default=LOG_DAEMON)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;KEEPALIVED_OPTIONS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;-D&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;/etc/sysconfig/keepalived&lt;/code&gt; é‡Œä¿®æ”¹ä¸ºä¸‹é¢ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-conf&#34; data-lang=&#34;conf&#34;&gt;KEEPALIVED_OPTIONS=&amp;#34;-D --log-console --log-detail --use-file=/etc/keepalived/keepalived.conf&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æˆ‘ä»¬é€‰æ‹©åœ¨ä¸»é…ç½®æ–‡ä»¶é‡Œå» include å­é…ç½®æ–‡ä»¶ï¼Œkeepalivd æ¥æ”¶ &lt;code&gt;kill -HUP&lt;/code&gt; ä¿¡å·è§¦å‘ reloadï¼Œåç»­è‡ªåŠ¨åŒ–æ·»åŠ  SVC çš„æ—¶å€™æ·»åŠ å­é…ç½®æ–‡ä»¶åå‘é€ä¿¡å·å³å¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat &amp;gt; /etc/keepalived/keepalived.conf &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt; EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;! Configuration File for keepalived
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;global_defs {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;# è®°ä½ keepalived çš„ä»»ä½•é…ç½®æ–‡ä»¶ä¸èƒ½æœ‰ x æƒé™
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;include /etc/keepalived/conf.d/*.conf
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir -p /etc/keepalived/conf.d/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å†™ä¸€ä¸ªè„šæœ¬ï¼Œä¸€ä¸ªæ˜¯ç”¨æ¥æ·»åŠ ä¸€ä¸ªå­é…ç½®æ–‡ä»¶é‡Œçš„ç›¸å…³ä¿¡æ¯åˆ° ipset é‡Œï¼Œå¦ä¸€æ–¹é¢ä¹Ÿè®©å®ƒåœ¨é‡å¯æˆ–è€…å¯åŠ¨ keepalived çš„æ—¶å€™æ¯æ¬¡èƒ½åˆå§‹åŒ–ï¼Œå…ˆæ·»åŠ  systemd çš„éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir -p /usr/lib/systemd/system/keepalived.service.d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat &amp;gt; /usr/lib/systemd/system/keepalived.service.d/10.keepalived.conf &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt; EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;[Service]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;ExecStartPre=/etc/keepalived/ipvs.sh
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åç¼–å†™è„šæœ¬ &lt;code&gt;/etc/keepalived/ipvs.sh&lt;/code&gt; :&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#!/bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; -e
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;dummy_if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;svc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;CONF_DIR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/etc/keepalived/conf.d/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;function&lt;/span&gt; ipset_init&lt;span class=&#34;o&#34;&gt;(){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ipset create ZGZ-CLUSTER-IP hash:ip,port -exist
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ipset flush ZGZ-CLUSTER-IP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; f ip port protocol
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; f in &lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;find  &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;CONF_DIR&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; -maxdepth &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; -type f -name &lt;span class=&#34;s1&#34;&gt;&amp;#39;*.conf&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        awk &lt;span class=&#34;s1&#34;&gt;&amp;#39;{if($1==&amp;#34;virtual_server&amp;#34;){printf $2&amp;#34; &amp;#34;$3&amp;#34; &amp;#34;;flag=1;};if(flag==1 &amp;amp;&amp;amp; $1==&amp;#34;protocol&amp;#34;){print $2;flag=0}}&amp;#39;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;read&lt;/span&gt; ip port protocol&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;c1&#34;&gt;# SVC IP port æ’å…¥ ipset é‡Œ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            ipset add ZGZ-CLUSTER-IP &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;,&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,,&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;:&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; -exist
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;c1&#34;&gt;# æ·»åŠ  SVC IP åˆ° dummy æ¥å£ä¸Š&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; ! ip r g &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep -qw lo&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                ip addr add &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;/32 dev &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;dummy_if&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;function&lt;/span&gt; create_Chain_in_nat&lt;span class=&#34;o&#34;&gt;(){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# delete use -X&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; Chain option
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nv&#34;&gt;option&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;-t nat --wait&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; Chain in &lt;span class=&#34;nv&#34;&gt;$@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; ! iptables &lt;span class=&#34;nv&#34;&gt;$option&lt;/span&gt; -S &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep -Eq -- &lt;span class=&#34;s2&#34;&gt;&amp;#34;-N\s+&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;Chain&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        iptables &lt;span class=&#34;nv&#34;&gt;$option&lt;/span&gt; -N &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;Chain&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;function&lt;/span&gt; create_Rule_in_nat&lt;span class=&#34;o&#34;&gt;(){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;cmd&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;iptables -t nat --wait &amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; ! &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;cmd&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;  --check &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$@&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; 2&amp;gt;/dev/null&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;cmd&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; -A &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$@&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;function&lt;/span&gt; iptables_init&lt;span class=&#34;o&#34;&gt;(){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    create_Chain_in_nat ZGZ-SERVICES  ZGZ-SERVICES-POSTROUTING ZGZ-SERVICES-MARK-MASQ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    create_Rule_in_nat ZGZ-SERVICES-MARK-MASQ -j MARK --set-xmark 0x2000/0x2000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    create_Rule_in_nat ZGZ-SERVICES -m comment --comment &lt;span class=&#34;s2&#34;&gt;&amp;#34;zgz service cluster ip + port for masquerade purpose&amp;#34;&lt;/span&gt; -m &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; --match-set ZGZ-CLUSTER-IP dst,dst -j ZGZ-SERVICES-MARK-MASQ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    create_Rule_in_nat PREROUTING -m comment --comment &lt;span class=&#34;s2&#34;&gt;&amp;#34;zgz service portals&amp;#34;&lt;/span&gt; -j ZGZ-SERVICES
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    create_Rule_in_nat OUTPUT -m comment --comment &lt;span class=&#34;s2&#34;&gt;&amp;#34;zgz service portals&amp;#34;&lt;/span&gt; -j ZGZ-SERVICES
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    create_Rule_in_nat ZGZ-SERVICES-POSTROUTING -m comment --comment &lt;span class=&#34;s2&#34;&gt;&amp;#34;zgz service traffic requiring SNAT&amp;#34;&lt;/span&gt; -m mark --mark 0x2000/0x2000 -j MASQUERADE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    create_Rule_in_nat POSTROUTING -m comment --comment &lt;span class=&#34;s2&#34;&gt;&amp;#34;zgz postrouting rules&amp;#34;&lt;/span&gt; -j ZGZ-SERVICES-POSTROUTING
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;function&lt;/span&gt; ipvs_svc_run&lt;span class=&#34;o&#34;&gt;(){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ip addr flush dev &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;dummy_if&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ipset_init
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  iptables_init
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# æ— å‚æ•°åˆ™æ˜¯ keepalived å¯åŠ¨ï¼Œä¹Ÿå¯ä»¥æ¥æ”¶å•ä¸ªé…ç½®æ–‡ä»¶å‚æ•°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;function&lt;/span&gt; main&lt;span class=&#34;o&#34;&gt;(){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; ! -d /proc/sys/net/ipv4/conf/&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;dummy_if&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ip link add &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;dummy_if&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt; dummy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$#&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; -eq &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ipvs_svc_run
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; file fullFile ip port protocol
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; file in &lt;span class=&#34;nv&#34;&gt;$@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nv&#34;&gt;fullFile&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;CONF_DIR&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;/&lt;span class=&#34;nv&#34;&gt;$file&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      awk &lt;span class=&#34;s1&#34;&gt;&amp;#39;{if($1==&amp;#34;virtual_server&amp;#34;){printf $2&amp;#34; &amp;#34;$3&amp;#34; &amp;#34;;flag=1;};if(flag==1 &amp;amp;&amp;amp; $1==&amp;#34;protocol&amp;#34;){print $2;flag=0}}&amp;#39;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;read&lt;/span&gt; ip port protocol&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;c1&#34;&gt;# SVC IP port æ’å…¥ ipset é‡Œ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          ipset add ZGZ-CLUSTER-IP &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;,&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,,&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;:&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; -exist
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;c1&#34;&gt;# æ·»åŠ  SVC IP åˆ° dummy æ¥å£ä¸Š&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; ! ip r g &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep -qw lo&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              ip addr add &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;/32 dev &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;dummy_if&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;# é‡æ–° reload &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  pkill --signal HUP keepalived
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;main &lt;span class=&#34;nv&#34;&gt;$@&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è„šæœ¬å°±å¦‚ä¸Šé¢æ‰€ç¤ºï¼Œè¯»å– keepalived çš„ lvs æ–‡ä»¶ï¼ŒæŠŠ &lt;code&gt;VIP:PORT&lt;/code&gt; åŠ åˆ° ipset é‡Œï¼ŒVIP åŠ åˆ° &lt;code&gt;dummy&lt;/code&gt; æ¥å£ä¸Šï¼Œä¹‹å‰æ˜¯åŠ åˆ° eth0 ä¸Šï¼Œä½†æ˜¯ä¸šåŠ¡ç½‘å¡å¯èƒ½ä¼šé‡å¯å½±å“ï¼Œdummy æ¥å£å’Œ loopback ç±»ä¼¼ï¼Œå®ƒæ€»æ˜¯ up çš„ï¼Œé™¤éä½  down æ‰å®ƒï¼ŒSVC åœ°å€é…ç½®åœ¨å®ƒä¸Šé¢ä¸ä¼šéšç€ç‰©ç†æ¥å£çŠ¶æ€å˜åŒ–è€Œå—åˆ°å½±å“ã€‚åˆ é™¤æ‰ä¹‹å‰ eth0 ä¸Šçš„ VIP &lt;code&gt;ip addr del 169.254.11.2/32 dev eth0&lt;/code&gt;ï¼Œç„¶åæŠŠå‰é¢çš„è½¬æˆ keepalived çš„é…ç½®æ–‡ä»¶æµ‹è¯•ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chmod a+x /etc/keepalived/ipvs.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat &amp;gt; /etc/keepalived/conf.d/test.conf &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt; EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;virtual_server 169.254.11.2 80 {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    delay_loop 6
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    lb_algo rr
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    lb_kind NAT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    protocol TCP
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    real_server  192.168.2.111 8080 {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        weight 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        HTTP_GET  {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;            url {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;              path /404
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;              status_code 404
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;            connect_port    8080
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;            connect_timeout 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;            retry 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;            delay_before_retry 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    real_server  192.168.2.222 8080 {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        weight 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        HTTP_GET  {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;            url {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;              path /404
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;              status_code 404
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;            connect_port    8080
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;            connect_timeout 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;            retry 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;            delay_before_retry 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æµ‹è¯•ä¸‹&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# å…ˆæ¸…ç†æ‰ä¹‹å‰æ‰‹åŠ¨æ·»åŠ çš„
ipvsadm --clear

systemctl daemon-reload
systemctl restart keepalived

$ curl 169.254.11.2/www/test
192.168.2.222
$ curl 169.254.11.2/www/test
192.168.2.111
$ curl 169.254.11.2/www/test
192.168.2.222
$ curl 169.254.11.2/www/test
192.168.2.111
$ ip a s SVC
4: SVC: &amp;lt;BROADCAST,NOARP&amp;gt; mtu 1500 qdisc noop state DOWN group default qlen 1000
    link/ether e6:a3:29:07:fa:57 brd ff:ff:ff:ff:ff:ff
    inet 169.254.11.2/32 scope global SVC
       valid_lft forever preferred_lft forever
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœæ‰ä¸€ä¸ª web ååœ¨æˆ‘ä»¬é…ç½®çš„å¥åº·æ£€æŸ¥å‡ ç§’ä¹Ÿå‰”é™¤äº† rsï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl 169.254.11.2/www/test
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl: &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;7&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; Failed connect to 169.254.11.2:80&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; Connection refused
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl 169.254.11.2/www/test
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;192.168.2.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl 169.254.11.2/www/test
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;192.168.2.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl 169.254.11.2/www/test
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;192.168.2.111
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl 169.254.11.2/www/test
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;192.168.2.111
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;ç³»ç»Ÿçš„ç›¸å…³é…ç½®&#34;&gt;ç³»ç»Ÿçš„ç›¸å…³é…ç½®&lt;/h4&gt;
&lt;p&gt;åé¢é‡å¯åå‘ç°ä¸é€šï¼Œå‘ç°å†…æ ¸æ¨¡å—æ²¡åŠ è½½ï¼Œä½¿ç”¨ &lt;code&gt;systemd-modules-load&lt;/code&gt; å»å¼€æœºåŠ è½½ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat  &amp;gt; /etc/modules-load.d/ipvs.conf &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt; EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;ip_vs
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;ip_vs_rr
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;ip_vs_wrr
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;ip_vs_sh
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat &amp;gt; /etc/sysctl.d/90.ipvs.conf &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt; EOF 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;# https://github.com/moby/moby/issues/31208 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;# ipvsadm -l --timout
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;# ä¿®å¤ipvsæ¨¡å¼ä¸‹é•¿è¿æ¥timeouté—®é¢˜ å°äº900å³å¯
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;net.ipv4.tcp_keepalive_time=600
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;net.ipv4.tcp_keepalive_intvl=30
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;net.ipv4.vs.conntrack=1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;docker-è¿è¡Œçš„æ–¹æ¡ˆ&#34;&gt;docker è¿è¡Œçš„æ–¹æ¡ˆ&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;docker-compose&lt;/code&gt; æ–‡ä»¶å¦‚ä¸‹ï¼Œè‡ªå·±æŠŠè„šæœ¬æŒ‚è½½è¿›å»å³å¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;3.5&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;services&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;keepalived&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;registry.aliyuncs.com/zhangguanzhang/keepalived:v2.2.0&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hostname&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;keepalived-ipvs&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;restart&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;unless-stopped&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;container_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;keepalived-ipvs&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;app=keepalived&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;network_mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;privileged&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cap_drop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;ALL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cap_add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;NET_BIND_SERVICE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;/usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;/lib/modules:/lib/modules&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;/run/xtables.lock:/run/xtables.lock&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;./conf.d/:/etc/keepalived/conf.d/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;./keepalived.conf:/etc/keepalived/keepalived.conf&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;./always-initsh.d:/always-initsh.d&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;dont-fork&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;log-console&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;log-detail&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;use-file=/etc/keepalived/keepalived.conf&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;logging&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;driver&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;json-file&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;max-file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;3&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;max-size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;20m&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å‚è€ƒæ–‡æ¡£&#34;&gt;å‚è€ƒæ–‡æ¡£&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.austintek.com/LVS/LVS-HOWTO/HOWTO/LVS-HOWTO.filter_rules.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Interaction between LVS and netfilter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.austintek.com/LVS/LVS-HOWTO/HOWTO/LVS-HOWTO.LVS-NAT.html#lvs_nat_intro&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;lvs nat&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/liexusong/linux-source-code-analyze/blob/master/lvs-principle-and-source-analysis-part2.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;lvs-principle-and-source-analysis&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.zsythink.net/archives/1199&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœ±åŒå°å¤§ä½¬çš„ iptables æŠ€æœ¯ç³»åˆ—&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>åœ¨ Kubernetes ä¸Šéƒ¨ç½²åº”ç”¨æ—¶å¦‚ä½•æ›´æ–°æ•°æ®åº“</title>
      <link>https://cloudnativecn.com/blog/running-database-migration-when-deploying-to-kubernetes/</link>
      <pubDate>Thu, 15 Jul 2021 10:42:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/running-database-migration-when-deploying-to-kubernetes/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://andrewlock.net/deploying-asp-net-core-applications-to-kubernetes-part-7-running-database-migrations/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä¼šä»‹ç»åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å¤šå‰¯æœ¬åº”ç”¨æ—¶ä¼šç¢°åˆ°çš„ä¸€ä¸ªç»å…¸é—®é¢˜ï¼šæ•°æ®åº“ schema æ›´æ–°ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥å°†ä¼šè®¨è®ºå‡ ç§å¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼Œä»ç®€å•åˆ°å¤æ‚ã€‚æœ€åä¼šæ€»ç»“ä¸€ä¸‹æˆ‘æ˜¯å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒè§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼šä½¿ç”¨ Kubernetes Job å’Œ init containerã€‚äº†è§£äº†è¿™äº›è§£å†³æ–¹æ¡ˆï¼ˆæœ€é‡è¦çš„æ˜¯è°¨æ…çš„è®¾è®¡æ•°æ®åº“ schemaï¼‰ä½ å¯ä»¥æ¯”è¾ƒä»å®¹çš„åº”å¯¹åº”ç”¨å‡çº§æ—¶çš„æ•°æ®åº“æ•°æ®æ›´æ–°çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»å…¸é—®é¢˜ä¸æ–­æ›´æ–°çš„æ•°æ®åº“&#34;&gt;ç»å…¸é—®é¢˜ï¼šä¸æ–­æ›´æ–°çš„æ•°æ®åº“&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªé—®é¢˜å…¶å®éå¸¸æ™®éï¼Œæ–°ç‰ˆæœ¬çš„åº”ç”¨éœ€è¦ä½¿ç”¨åˆ°æ–°çš„æ•°æ®åº“ schemaï¼Œæ‰€ä»¥å½“éƒ¨ç½²æ–°ç‰ˆæœ¬åº”ç”¨æ—¶ï¼Œå°±éœ€è¦æ›´æ–°æ•°æ®åº“çš„ schemaï¼Œé€šå¸¸æˆ‘ä»¬ç§°ä¹‹ä¸º æ•°æ®åº“ schema å˜æ›´ (database migrations),å‡ ä¹æ‰€æœ‰æ¶‰åŠæ•°æ®åº“çš„åº”ç”¨éƒ½ä¼šç¢°åˆ°ç±»ä¼¼çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰å¾ˆå¤šä¸åŒçš„æ–¹å¼æ¥ç®¡ç†æ•°æ®åº“çš„æ›´æ–°ï¼Œæ¯”å¦‚è¯´ EF Coreï¼Œè‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„æ›´æ–°æ•°æ®æ¥æ›´æ–°æ•°æ®åº“ã€‚æˆ–è€…ä¹Ÿæœ‰ä¸€äº›åº“å¯ä¾›ä½¿ç”¨ï¼Œæ¯”å¦‚ DbUp æˆ–è€… FluentMigrator å¯ä»¥è®©ä½ ä»¥ä»£ç æˆ–è€… SQL è„šæœ¬çš„æ–¹å¼å®šä¹‰æ•°æ®åº“å˜æ›´å¹¶è‡ªåŠ¨çš„åº”ç”¨è¿™äº›å˜æ›´ã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›æ–¹å¼éƒ½ç±»ä¼¼çš„ä¼šè®°å½•é‚£äº›å·²ç»åº”ç”¨åœ¨æ•°æ®åº“ä¸­çš„æ›´æ–°ï¼Œå“ªäº›è¿˜æ²¡æœ‰æ›´æ–°ï¼Œå¹¶æ‰§è¡Œé‚£äº›å¾…æ›´æ–°çš„éƒ¨åˆ†å°†å˜æ›´éƒ¨ç½²åˆ°æ•°æ®åº“é‡Œé¢ï¼Œä½†æ˜¯è¿™äº›å·¥å…·æ— æ³•æ§åˆ¶çš„ä¸€ç‚¹å°±æ˜¯ä»€ä¹ˆæ—¶å€™å»éƒ¨ç½²å˜æ›´ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç®€å•çš„-schema-æ›´æ–°ç­–ç•¥&#34;&gt;ç®€å•çš„ schema æ›´æ–°ç­–ç•¥&lt;/h2&gt;
&lt;p&gt;ä»€ä¹ˆæ—¶å€™è¿›è¡Œæ•°æ®åº“ schema å˜æ›´è¿™ä¸ªé—®é¢˜çœ‹èµ·æ¥å¥½åƒæœ‰ä¸ªå¾ˆæ˜ç¡®çš„ç­”æ¡ˆï¼šåœ¨æ–°åº”ç”¨è¿è¡Œä¹‹å‰ã€‚å¥½äº†ï¼Œå®é™…åº”ç”¨èµ·æ¥å°±ä¼šå‘ç°ï¼Œè¿™å¯¹äºå¤§å‹çš„ç½‘é¡µæœåŠ¡åœºæ™¯å°†ä¼šå˜å¾—å¼‚å¸¸å›°éš¾ï¼Œç‰¹åˆ«æ˜¯åº”ç”¨æœ‰å¾ˆå¤šå®ä¾‹çš„æ—¶å€™ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªç®€å•å¸¸è§çš„æ–¹å¼å¯èƒ½æ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å°†æµé‡åˆ‡æ¢åˆ°å¤‡ä»½ç«™ç‚¹&lt;/li&gt;
&lt;li&gt;åœæ­¢åº”ç”¨&lt;/li&gt;
&lt;li&gt;éƒ¨ç½²æ•°æ®åº“ schema æ›´æ–°&lt;/li&gt;
&lt;li&gt;å°†æµé‡åˆ‡æ¢å›ä¸»ç«™ç‚¹&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¾ˆæ˜æ˜¾è¿™å¯¹äºå½“å‰ 7*24 çš„å•†ä¸šä¸–ç•Œæ¥è¯´ï¼Œå°†ä¸ä¼šæ˜¯ä¸€ä¸ªå¯æ¥å—çš„æ–¹æ¡ˆã€‚å¦‚æœæ˜¯ä¸€ä¸ªç®€å•çš„æ²¡ä»€ä¹ˆæµé‡çš„é¡¹ç›®ï¼Œå®ƒå¯èƒ½å¯ä»¥æ»¡è¶³ä½ çš„è¦æ±‚ã€‚è¿™åªæ˜¯ç»•å¼€äº†é—®é¢˜è€Œæ²¡æœ‰æ ¹æœ¬çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå› æ­¤æˆ‘ä¸ä¼šå…·ä½“å†æ·±å…¥è®¨è®ºè¿™ä¸ªæ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥æ¢è®¨çš„æ–¹æ¡ˆä¼šé€‚ç”¨äºä»»ä½•ç½‘é¡µæœåŠ¡çš„åœºæ™¯ï¼Œä½†æ˜¯æˆ‘ä¼šä¸»è¦ä½¿ç”¨ Kubernetes çš„æ¦‚å¿µå’Œä¾‹å­ï¼Œå› ä¸ºè¿™æ˜¯å…³äº Kubernetes çš„æ–‡ç« ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ ä¸æ‰“ç®—ä½¿ç”¨è¿™äº›æ–¹æ¡ˆï¼Œä½†æ˜¯åˆæƒ³è¾¾åˆ°é›¶åœæœºçš„æ•ˆæœï¼Œé‚£ä½ éœ€è¦æ„è¯†åˆ°åœ¨æ•°æ®åº“å˜æ›´å‘ç”Ÿçš„æœŸé—´ï¼Œåº”ç”¨ä»£ç ä¼šè®¿é—®åˆ°ä¸åŒç‰ˆæœ¬çš„æ•°æ®åº“å®ä¾‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®‰å…¨çš„æ‰§è¡Œæ•°æ®åº“-schema-æ›´æ–°&#34;&gt;å®‰å…¨çš„æ‰§è¡Œæ•°æ®åº“ schema æ›´æ–°&lt;/h2&gt;
&lt;p&gt;è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªæ›´åŠ å®ç”¨çš„ä¾‹å­ï¼Œå‡è®¾ä½ è¿è¡Œä¸€ä¸ªåšå®¢å¹³å°ï¼Œæ‰“ç®—ç»™ BlogPost åŠ ä¸€ä¸ª Category åˆ†ç±»åŠŸèƒ½ï¼Œæ¯ä¸ªåšæ–‡ä¼šåˆ†é…åˆ°ä¸€ä¸ªå”¯ä¸€çš„ä¸Šå±‚åˆ†ç±»ï¼Œå› æ­¤éœ€è¦æ·»åŠ ä¸€ä¸ªåŒ…å«äº†åˆ†ç±»åˆ—è¡¨çš„ categories è¡¨ï¼Œç„¶ååœ¨ blog_posts è¡¨é‡Œæ·»åŠ ä¸€ä¸ª category_id åˆ—ï¼Œå¼•ç”¨ categories è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨è®©æˆ‘ä»¬è€ƒè™‘æ€ä¹ˆéƒ¨ç½²ï¼Œæˆ‘ä»¬çš„åº”ç”¨ä¼šæœ‰ä¸¤ç§çŠ¶æ€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Category ä»£ç æ·»åŠ å‰&lt;/li&gt;
&lt;li&gt;Category ä»£ç æ·»åŠ å&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¹åº”çš„æ•°æ®åº“ä¹Ÿä¼šæœ‰ä¸¤ç§çŠ¶æ€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœªåˆ›å»º categories è¡¨å’Œ category_id åˆ—&lt;/li&gt;
&lt;li&gt;å·²åˆ›å»º categories è¡¨å’Œ category_id åˆ—&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é‚£å¦‚ä½•åº”ç”¨æ•°æ®åº“è¿ç§»å°±æœ‰äº†ä¸¤ç§é€‰æ‹©ï¼š&lt;/p&gt;
&lt;p&gt;éƒ¨ç½²æ–°åº”ç”¨ï¼Œç„¶åæ‰§è¡Œæ•°æ®åº“å˜æ›´ã€‚è¿™æ ·åº”ç”¨çš„ç¬¬ä¸€ç§çŠ¶æ€å°±åªéœ€è¦å¤„ç†æ•°æ®åº“çš„ç¬¬ä¸€ç§çŠ¶æ€ï¼Œä½†æ˜¯ç¬¬äºŒç§çŠ¶æ€çš„åº”ç”¨åˆ™éœ€è¦å¤„ç†æ··åˆä¸¤ç§çŠ¶æ€çš„æ•°æ®åº“&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œæ•°æ®åº“å˜æ›´ï¼Œç„¶åéƒ¨ç½²æ–°åº”ç”¨ã€‚è¿™æ ·åº”ç”¨çš„ç¬¬ä¸€ç§çŠ¶æ€éœ€è¦å¤„ç†æ•°æ®åº“çš„ä¸¤ç§çŠ¶æ€ï¼Œä½†æ˜¯ç¬¬äºŒç§çŠ¶æ€çš„åº”ç”¨åˆ™å¯ä»¥ç¡®ä¿æ‰€éœ€çš„è¡¨å·²ç»æ·»åŠ ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æ•°æ®åº“è¿ç§»&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;./pics/database-migrations.png&#34; alt=&#34;æ•°æ®åº“è¿ç§»&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æ•°æ®åº“è¿ç§»
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šä¸¤ç§æ–¹å¼éƒ½é€‚ç”¨äºæ•°æ®åº“å˜æ›´ï¼Œä½†æ˜¯æˆ‘åå‘äºåè€…ã€‚å› ä¸ºæ•°æ®åº“çš„å˜æ›´é€šå¸¸æ˜¯æ•´ä¸ªéƒ¨ç½²æµç¨‹ä¸­æœ€éº»çƒ¦çš„ä¸€æ­¥ï¼Œå› æ­¤æˆ‘å¸Œæœ›èƒ½ä¼˜å…ˆå¤„ç†è¿™ä¸€æ­¥ï¼Œå¦‚æœå‘ç”Ÿä»€ä¹ˆé—®é¢˜ï¼Œæ•´ä¸ªéƒ¨ç½²æµç¨‹ä¼šç»ˆæ­¢ï¼Œé‚£æ–°ç‰ˆæœ¬çš„åº”ç”¨ä¹Ÿå°±ä¸ä¼šéƒ¨ç½²ä¸Šå»äº†ã€‚&lt;/p&gt;
&lt;p&gt;å®é™…æ“ä½œä¸­ï¼Œæ•°æ®åº“æ–°çš„ schema åº”è¯¥æ˜¯å¯ä»¥é€‚é…äºæ—§ç‰ˆæœ¬çš„åº”ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ ä¸èƒ½ç»™å·²å­˜åœ¨çš„è¡¨æ’å…¥ NOT NULL çš„åˆ—ï¼Œå› ä¸ºåº”ç”¨å¹¶ä¸çŸ¥é“å“ªä¸€åˆ—ä¼šæ— æ³•æ’å…¥ã€‚æ‰€ä»¥è¦ä¸å°±æŠŠæ–°åŠ çš„åˆ—è®¾ç½®ä¸ºå¿…é¡»é¡¹ï¼Œè¿™æ ·åœ¨æ¥ä¸‹æ¥çš„éƒ¨ç½²ä¸­å°±ä¼šå¼ºåˆ¶æ’å…¥æ•°æ®ï¼Œæˆ–è€…é…ç½®ä¸€ä¸ªé»˜è®¤å€¼ï¼Œæ¥ç¡®ä¿è¿™ä¸€åˆ—æ˜¯éç©ºçš„ã€‚&lt;/p&gt;
&lt;p&gt;æ€»çš„æ¥è¯´ï¼Œåªè¦ä½ äº†è§£äº†è¿™äº›æ–¹æ³•ï¼Œæ•°æ®åº“çš„å˜æ›´ä¸åº”è¯¥ä¼šç»™ä½ å¸¦æ¥å¾ˆå¤§çš„éº»çƒ¦ã€‚å½“å‡†å¤‡æ•°æ®åº“å˜æ›´çš„æ—¶å€™ï¼Œé—®è‡ªå·± &lt;strong&gt;â€å¦‚æœåªæ˜¯æ‰§è¡Œæ•°æ®åº“çš„æ•°æ®å˜æ›´ï¼Œä¼šä¸ä¼šç ´åç°æœ‰çš„åº”ç”¨è¿è¡Œï¼Ÿâ€œ&lt;/strong&gt;ï¼Œå¦‚æœè¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆæ˜¯ä¸ä¼šçš„è¯ï¼Œé‚£è¿™æ¬¡å˜æ›´å°±ä¸ä¼šæœ‰ä»€ä¹ˆéº»çƒ¦ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ—¶å€™æ‰§è¡Œæ•°æ®åº“è¿ç§»&#34;&gt;ä»€ä¹ˆæ—¶å€™æ‰§è¡Œæ•°æ®åº“è¿ç§»&lt;/h2&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬åŒæ„åœ¨æ–°åº”ç”¨å¯åŠ¨ä¹‹å‰æ‰§è¡Œæ•°æ®åº“çš„æ•°æ®æ›´æ–°ï¼Œä½†æ˜¯è¿™è¿˜æ˜¯ä¸å¤Ÿå…·ä½“æ¸…æ™°ï¼Œå› ä¸ºæˆ‘çœ‹åˆ°äº†ä¸‰ç§ä¸åŒçš„åšæ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åº”ç”¨å¯åŠ¨æ—¶æ‰§è¡Œæ•°æ®åº“ schema æ›´æ–°&lt;/li&gt;
&lt;li&gt;å°†æ•°æ®åº“ schema æ›´æ–°ä½œä¸ºéƒ¨ç½²æµç¨‹çš„ä¸€éƒ¨åˆ†&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ Kuberentes Job å’Œ åˆå§‹åŒ–å®¹å™¨ï¼ˆinit containerï¼‰æ¥æ‰§è¡Œæ•°æ®åº“ schema æ›´æ–°&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¯ç§åšæ³•éƒ½å„æœ‰åˆ©å¼Šï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬é€ä¸ªè®¨è®ºã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬æ¥ç€ä¸Šé¢çš„ä¾‹å­ï¼Œå‡è®¾ä½ çš„åšå®¢åº”ç”¨éƒ¨ç½²åœ¨ Kubernetes é‡Œé¢ï¼Œä½ ä¼šæœ‰ä¸€ä¸ª ingressï¼Œä¸€ä¸ª service å’Œä¸€ä¸ª deploymentï¼Œå°±åƒæˆ‘åœ¨&lt;a href=&#34;https://andrewlock.net/deploying-asp-net-core-applications-to-kubernetes-part-1-an-introduction-to-kubernetes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™ç¯‡æ–‡ç« &lt;/a&gt;æåˆ°è¿‡çš„ã€‚Deployment ä¼šç¡®ä¿åœ¨ä»»ä½•æ—¶å€™éƒ½æœ‰ä¸‰ä¸ªåº”ç”¨çš„å‰¯æœ¬æ¥å¤„ç†ç½‘é¡µçš„æµé‡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-æ•°æ®åº“å¼•æ“&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;./pics/blog-engine.png&#34; alt=&#34;æ•°æ®åº“å¼•æ“&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      æ•°æ®åº“å¼•æ“
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½ éœ€è¦åœ¨éƒ¨ç½²æ–°ç‰ˆæœ¬åº”ç”¨çš„æ—¶å€™ï¼Œæ‰§è¡Œæ•°æ®åº“ schema æ›´æ–°ï¼Œè®©æˆ‘ä»¬åˆ†æä¸€ä¸‹å‡ ä¸ªä¸åŒæ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;åº”ç”¨å¯åŠ¨æ—¶æ‰§è¡Œæ•°æ®åº“-schema-æ›´æ–°&#34;&gt;åº”ç”¨å¯åŠ¨æ—¶æ‰§è¡Œæ•°æ®åº“ schema æ›´æ–°&lt;/h3&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªæ–¹æ¡ˆæ˜¯åœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™æ‰§è¡Œæ•°æ®åº“ schema æ›´æ–°ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ EF Core çš„ &lt;code&gt;DbContext.Database.Migrate()&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CreateHostBuilder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;Build&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;using&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;Services&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;CreateScope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;ServiceProvider&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;GetRequiredService&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ApplicationDbContext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;Database&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;Migrate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// apply the migrations&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// start handling requests&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è™½ç„¶è¿™ä¸ªæ–¹æ¡ˆå¾ˆç®€å•ï¼Œä½†æ˜¯å®ƒå´æœ‰ä¸€äº›é‡è¦çš„é—®é¢˜æ²¡è§£å†³ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åº”ç”¨çš„æ¯ä¸ªå‰¯æœ¬éƒ½ä¼šå°è¯•å»åº”ç”¨åŒæ ·çš„æ•°æ®åº“ schema æ›´æ–°&lt;/li&gt;
&lt;li&gt;åº”ç”¨æœ‰è¶³å¤Ÿçš„æƒé™å¯¹æ•°æ®åº“åšæ‘§æ¯æ€§çš„æ”¹åŠ¨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¬¬ä¸€ç‚¹æ˜¯ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„é—®é¢˜ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸‰ä¸ªå‰¯æœ¬ï¼Œå½“æˆ‘ä»¬å°è¯•æ»šåŠ¨æ›´æ–°åº”ç”¨çš„æ—¶å€™ä¼šå¯¼è‡´çš„ç»“æœå°±æ˜¯å‡ ä¸ªåº”ç”¨åŒæ—¶å»ä¿®æ”¹æ•°æ®åº“ï¼Œè¿™ä¸ªåœ¨æˆ‘æ‰€çŸ¥é“çš„å·¥å…·ä¸­å¹¶ä¸æ˜¯ä¸€ä¸ªæ”¯æŒçš„åŠŸèƒ½ï¼Œè€Œä¸”ä¼´éšè€Œæ¥çš„æ˜¯æ•°æ®å´©æºƒçš„é£é™©ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶å¹¶éæ²¡æœ‰åŠæ³•å»ç¡®è®¤åªæœ‰ä¸€ä¸ªå‰¯æœ¬ä¼šä¿®æ”¹æ•°æ®åº“ï¼Œä½†æ˜¯æˆ‘å¹¶ä¸æ‰“ç®—ä»‹ç»ä»»ä½•ä¸€ç§ï¼Œå› ä¸ºæˆ‘ä¸æ„¿æ„å› ä¸ºä»»ä½•ä¸€ç§åŸå› å¯¼è‡´åº”ç”¨æœ‰æœºä¼šç ´åæˆ‘çš„æ•°æ®åº“ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒç‚¹å…¶å®æ˜¯å®‰å…¨ç›¸å…³çš„ï¼Œæ•°æ®åº“è¿ç§»æ˜¯ä¸€é¡¹å¾ˆå±é™©çš„æ“ä½œï¼Œå› ä¸ºå®ƒæœ‰æœºä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±æˆ–è€…æ¯åã€‚æ¯”è¾ƒå®‰å…¨çš„åšæ³•æ˜¯æ—¥å¸¸åº”ç”¨è¿è¡Œæ—¶è·Ÿæ•°æ®åº“è¿ç§»æ—¶ä½¿ç”¨ä¸åŒçš„æ•°æ®åº“è´¦æˆ·ï¼Œè¿™æ ·èƒ½å‡å°‘åº”ç”¨è¿è¡Œæ—¶æ„å¤–ï¼ˆæˆ–è€…æ¶æ„ï¼‰çš„æ•°æ®ä¸¢å¤±çš„å‘ç”Ÿæœºç‡ã€‚å¦‚æœåº”ç”¨æ²¡æœ‰æƒé™æ‰§è¡Œ &lt;code&gt;DROP&lt;/code&gt; è¡¨çš„åŠ¨ä½œï¼Œé‚£å°±å‡ ä¹æ²¡æœ‰è¿™ç§æ„å¤–å‘ç”Ÿçš„æœºä¼šäº†ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ çš„åº”ç”¨é™¤äº†è¿è¡Œä¸šåŠ¡ä»£ç å¤–è¿˜è¦æ‰§è¡Œæ•°æ®åº“å˜æ›´çš„æ“ä½œï¼Œé‚£æ— æ³•é¿å…çš„æ˜¯å®ƒä¸€å®šéœ€è¦ç‰¹æ®Šæƒé™ã€‚è¿™æ—¶å€™æœ€å¥½çš„åšæ³•å°±æ˜¯ç¡®ä¿åªæœ‰åœ¨éœ€è¦æ‰§è¡Œæ•°æ®åº“ schema æ›´æ–°çš„æ—¶å€™æ‰ä½¿ç”¨é‚£äº›ç‰¹æƒè´¦å·ï¼Œå½“ç„¶æœ€æœ€å®‰å…¨çš„åšæ³•å°±æ˜¯ä¸å…è®¸å®ƒä½¿ç”¨ç‰¹æƒè´¦æˆ·ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å°†æ•°æ®åº“-schema-æ›´æ–°ä½œä¸ºéƒ¨ç½²æµç¨‹çš„ä¸€éƒ¨åˆ†&#34;&gt;å°†æ•°æ®åº“ schema æ›´æ–°ä½œä¸ºéƒ¨ç½²æµç¨‹çš„ä¸€éƒ¨åˆ†&lt;/h3&gt;
&lt;p&gt;å¦å¤–ä¸€ä¸ªå¸¸è§çš„åšæ³•æ˜¯å°†æ•°æ®åº“ schema æ›´æ–°ä½œä¸ºéƒ¨ç½²æµç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œæ¯”å¦‚è¯´ Octopus Deploy çš„éƒ¨ç½²æ–¹æ¡ˆã€‚å®ƒè§£å†³äº†æˆ‘ä¸Šé¢æè¿°çš„ä¸¤ä¸ªé—®é¢˜ï¼Œèƒ½ç¡®ä¿ Octopus ä¸ä¼šå¹¶å‘çš„å»ä¿®æ”¹æ•°æ®åº“ schema, è€Œä¸”å½“æ•°æ®åº“çš„å˜æ›´å®Œæˆåï¼Œæ‰ä¼šéƒ¨ç½²åº”ç”¨çš„ä»£ç ã€‚å› ä¸ºè¿™ä¸¤ä¸ªéƒ¨ç½²çš„æ­¥éª¤è¢«æ‹†åˆ†å¼€äº†ï¼Œä½¿å¾—ä¸åŒçš„æƒé™è´¦æˆ·çš„ä½¿ç”¨å˜å¾—æ›´åŠ æ–¹ä¾¿å®¹æ˜“ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-octopus-éƒ¨ç½²&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;./pics/deployment-process.png&#34; alt=&#34;Octopus éƒ¨ç½²&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Octopus éƒ¨ç½²
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¯èƒ½å¤§å®¶ä¼šé—®ï¼ŒOctopus æ˜¯å¦‚ä½•æ‰§è¡Œæ•°æ®åº“çš„ schema æ›´æ–°äº†ï¼Œæ€ä¹ˆç¡®è®¤è¿™äº›æ›´æ–°å®Œæˆäº†å‘¢ï¼Ÿä¸Šé¢çš„ä¾‹å­é‡Œï¼ŒOctopus éœ€è¦ä¸€ä¸ªæ›´æ–°è„šæœ¬å¹¶ç›´æ¥æ‰§è¡Œè¿™ä¸ªè„šæœ¬ã€‚å¥½çš„ä¸€é¢æ˜¯è¿™æ ·å¾ˆå®¹æ˜“æ‰§è¡Œä½ çš„æ›´æ–°ä»»åŠ¡ï¼Œè€Œä¸”ä¸éœ€è¦åœ¨ä½ çš„åº”ç”¨ä»£ç é‡Œå»è§£å†³è¿™äº›æ›´æ–°çš„é—®é¢˜ã€‚ä½†æ˜¯å®ƒå´è®©ä½ é«˜åº¦ä¾èµ– Octopusï¼Œè¿™å¯èƒ½ä¼šæ˜¯ä½ ä¸æƒ³çœ‹åˆ°çš„ä¸€ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;å®é™…ä¸Šï¼Œæˆ‘è‡ªå·±å®ç”¨çš„åŠæ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ .NET Core CLI åº”ç”¨ä½œä¸ºæ•°æ®åº“å·¥å…·æ¥ä½¿ç”¨ï¼Œæˆ–è€…è¯´æˆ‘ç®€ç›´æŠŠå®ƒå½“æˆä¸€ä¸ªæ•°æ®åº“é€šç”¨å·¥å…·æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚è¯´ä½¿ç”¨ Jeremy D Miller çš„ Oakton, è¿™æ ·ç”šè‡³å¯ä»¥åˆ©ç”¨æ¥æ‰§è¡Œä¸€äº›å¸¸è§å‘½ä»¤ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« ä¼šæ¯”è¾ƒå†—é•¿ï¼Œå› æ­¤æˆ‘å¹¶ä¸æ‰“ç®—åœ¨è¿™é‡Œè§£é‡Šå¦‚ä½•å†™ä¸€ä¸ªç±»ä¼¼çš„ CLI å·¥å…·ï¼Œè€Œä¸”è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ .NET Core çš„å‘½ä»¤è¡Œé¡¹ç›®ï¼Œåº”è¯¥ä¸ä¼šæœ‰å¤ªå¤šéº»çƒ¦çš„åœ°æ–¹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦‚æœä½ é‡‡å–è¿™ç§æ–¹å¼ï¼Œé‚£è¿˜æœ‰ä¸€ä¸ªé—®é¢˜éœ€è¦è§£å†³ï¼Œå°±æ˜¯åœ¨å“ªé‡Œè¿è¡Œè¿™ä¸ª CLI å·¥å…·ï¼Ÿä½ çš„ CLI å·¥å…·åº”è¯¥ä¼šè¿è¡Œåœ¨æŸå°æœºå™¨ä¸Šé¢ï¼Œå› æ­¤ä½ åœ¨å‡†å¤‡éƒ¨ç½²çš„æ—¶å€™ä¹Ÿéœ€è¦è€ƒè™‘åˆ°è¿™æ–¹é¢çš„éœ€æ±‚ã€‚Serverless å¯èƒ½ä¸å¤ªåˆé€‚ï¼Œå› ä¸ºé€šå¸¸æ•°æ®åº“çš„æ•°æ®æ“ä½œä¼šæ˜¯è€—æ—¶æ¯”è¾ƒé•¿çš„åŠ¨ä½œã€‚&lt;/p&gt;
&lt;p&gt;ä½ çœ‹ï¼ŒOctopus å¯ä»¥æ¯”è¾ƒå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¦‚æœä½ åˆšå¥½æ­£åœ¨ä½¿ç”¨è¿™ä¸ªé¡¹ç›®ï¼Œå¾ˆæ˜æ˜¾ï¼Œå®ƒå°†ä¼šæ˜¯ä½ çš„é¦–é€‰æ–¹æ¡ˆäº†ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªå®Œå…¨åŸºäº Kubernetes çš„æ–¹æ¡ˆï¼Œä¹Ÿå°±æ˜¯æˆ‘ç°åœ¨é‡‡ç”¨çš„æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨-kuberentes-job-å’Œåˆå§‹åŒ–å®¹å™¨æ¥æ‰§è¡Œæ•°æ®åº“-schema-æ›´æ–°&#34;&gt;ä½¿ç”¨ Kuberentes Job å’Œåˆå§‹åŒ–å®¹å™¨æ¥æ‰§è¡Œæ•°æ®åº“ schema æ›´æ–°&lt;/h3&gt;
&lt;p&gt;æˆ‘å–œæ¬¢çš„ Kubernetes åŸç”Ÿçš„è§£å†³æ–¹æ¡ˆï¼Œä½¿ç”¨ Job å’Œåˆå§‹åŒ–å®¹å™¨ã€‚&lt;/p&gt;
&lt;h4 id=&#34;job&#34;&gt;Job&lt;/h4&gt;
&lt;p&gt;Kubernetes Job ä¼šè¿è¡Œä¸€ä¸ªæˆ–è€…å¤šä¸ª pod æ¥å¤„ç†å·¥ä½œè´Ÿè½½ï¼Œå¦‚æœ pod å‡ºé”™äº†ï¼Œå¯ä»¥é‡è¯•æ‰§è¡Œï¼Œå¦‚æœ pod æ­£å¸¸ç»“æŸï¼Œåˆ™ Job é¡ºåˆ©å®Œæˆã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦ç”¨æ¥åšæ•°æ®åº“æ•°æ®æ›´æ–°çš„åŠæ³•ï¼Œåˆ›å»ºä¸€ä¸ª job æ¥æ‰§è¡Œæ•°æ®åº“çš„ CLI å·¥å…·ï¼Œå‡ºç°ç½‘ç»œé—®é¢˜æ—¶å¯ä»¥æœ‰é€‰æ‹©çš„é‡è¯•ã€‚å› ä¸ºå®ƒæ˜¯ä¸€ä¸ª Kubernetes åŸç”Ÿæ¦‚å¿µï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Helm çš„åŠŸèƒ½ä¾†æ¨¡æ¿åŒ–ç®¡ç†ï¼Œå°†å®ƒåŒ…å«åœ¨æˆ‘ä»¬åº”ç”¨çš„ helm chart é‡Œé¢ã€‚ä»ä¸‹é¢çš„å›¾ç‰‡å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ç»™ test-app æ·»åŠ äº†ä¸€ä¸ª CLI é¡¹ç›®ï¼Œä¸»è¦æ˜¯ä¸€ä¸ª job.yamlã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-helm-chart&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;./pics/charts.png&#34; alt=&#34;Helm chart&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Helm chart
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæ–¹æ¡ˆéš¾åœ¨å¦‚ä½•åœ¨åº”ç”¨å¯åŠ¨ä¹‹å‰ç¡®ä¿ Job å·²ç»å®Œæˆï¼Œæˆ‘æ˜¯é€šè¿‡ä½¿ç”¨ Kubernetes çš„åˆå§‹åŒ–å®¹å™¨ä¾†è§£æ±ºè¿™ä¸ªé—®é¢˜çš„ã€‚&lt;/p&gt;
&lt;h4 id=&#34;åˆå§‹åŒ–å®¹å™¨-init-container&#34;&gt;åˆå§‹åŒ–å®¹å™¨ (Init Container)&lt;/h4&gt;
&lt;p&gt;å¦‚æœä½ è¿˜è®°å¾—è¿™ä¸€ç³»åˆ—æ–‡ç« é‡Œçš„ç¬¬ä¸€ç¯‡ï¼Œæˆ‘è®²è¿‡ Pod æ˜¯ Kubernetes é‡ŒåŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨çš„æœ€å°çš„è°ƒåº¦å•ä½ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼ŒPod ä¼šæœ‰ä¸€ä¸ªä¸»å®¹å™¨æä¾›åº”ç”¨çš„ä¸»è¦åŠŸèƒ½ï¼Œå¯èƒ½è¿˜ä¼šæœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ª sidecar å®¹å™¨æä¾›ä¸€äº›é™„åŠ çš„åŠŸèƒ½ï¼Œæ¯”å¦‚è¯´ metrics æˆ–è€… service meshã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©åœ¨ Pod é‡Œä½¿ç”¨åˆå§‹åŒ–å®¹å™¨ï¼Œè¿™æ · Kubernetes éƒ¨ç½² pod çš„æ—¶å€™ï¼Œå°±ä¼šå…ˆè¿è¡Œæ‰€æœ‰çš„åˆå§‹åŒ–å®¹å™¨ã€‚åªæœ‰å½“æ‰€æœ‰çš„åˆå§‹åŒ–å®¹å™¨éƒ½æ­£å¸¸è¿ä½œå¹¶é€€å‡ºæ—¶ï¼Œä¸»å®¹å™¨æ‰ä¼šå¼€å§‹è¿è¡Œï¼Œé€šå¸¸è¿™æ ·çš„åŠŸèƒ½ä¼šè¢«ç”¨äºä¸‹è½½æˆ–è€…åšä¸€äº›ä¸»å®¹å™¨è¦æ±‚çš„é¢„å…ˆé…ç½®ï¼Œè¿™æ ·å¯ä»¥è®©ä½ çš„ä¸»å®¹å™¨åªè´Ÿè´£è¿è¡Œä¸šåŠ¡ä»£ç è€Œä¸é¡»å…³æ³¨ç¯å¢ƒé…ç½®ã€‚&lt;/p&gt;
&lt;h4 id=&#34;ä½¿ç”¨-job-å’Œåˆå§‹åŒ–å®¹å™¨æ¥å¤„ç†æ•°æ®åº“æ•°æ®æ›´æ–°&#34;&gt;ä½¿ç”¨ Job å’Œåˆå§‹åŒ–å®¹å™¨æ¥å¤„ç†æ•°æ®åº“æ•°æ®æ›´æ–°&lt;/h4&gt;
&lt;p&gt;å½“æˆ‘åˆšå¼€å§‹æ¢ç´¢åˆå§‹åŒ–å®¹å™¨çš„æ—¶å€™ï¼Œæˆ‘å°è¯•è¿‡ç›´æ¥ä½¿ç”¨åˆå§‹åŒ–å®¹å™¨æ¥è´Ÿè´£æ•°æ®åº“æ•°æ®æ›´æ–°ï¼Œä½†æ˜¯è¿™åˆç¢°åˆ°äº†é‚£ä¸ªé—®é¢˜ï¼Œåœ¨åº”ç”¨è¿è¡Œçš„æ—¶å€™æ— æ³•é¿å…çš„å‡ºç°äº†åŒæ—¶é—´å‡ ä¸ªåº”ç”¨å‰¯æœ¬éƒ½å»ä¿®æ”¹æ•°æ®åº“çš„é—®é¢˜ã€‚å› æ­¤æˆ‘å†³å®šä½¿ç”¨ä¸¤æ­¥èµ°çš„æ–¹æ¡ˆï¼šä½¿ç”¨åˆå§‹åŒ–å®¹å™¨æ¥å»¶è¿Ÿä¸»å®¹å™¨å¯åŠ¨ç›´è‡³ç¡®è®¤æ•°æ®åº“è¿ç§»çš„ Job é¡ºåˆ©å®Œæˆã€‚&lt;/p&gt;
&lt;p&gt;ä¸»è¦æ­¥éª¤çœ‹èµ·æ¥åƒæ˜¯è¿™æ ·ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åº”ç”¨çš„ Helm chart åŒ…å«äº†åº”ç”¨çš„éƒ¨ç½²å’Œæ•°æ®åº“æ•°æ®æ›´æ–°çš„ Jobã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªåº”ç”¨çš„ Pod éƒ½ä¼šåŒ…å«ä¸€ä¸ªåˆå§‹åŒ–å®¹å™¨ï¼Œè¿™ä¸ªåˆå§‹åŒ–å®¹å™¨ä¼šä¸€ç›´ä¼‘çœ ç›´è‡³ç›¸å…³çš„ Job æˆåŠŸå®Œæˆã€‚å½“åˆå§‹åŒ–å®¹å™¨å‘ç° Job å®Œæˆæ—¶ï¼Œå®ƒè‡ªå·±ä¼šæ­£å¸¸é€€å‡ºï¼Œè¿™æ ·ä¸»å®¹å™¨æ‰ä¼šå¼€å§‹è¿è¡Œã€‚&lt;/li&gt;
&lt;li&gt;ä½œä¸ºæ»šåŠ¨æ›´æ–°çš„ä¸€éƒ¨åˆ†ï¼Œæ•°æ®åº“è¿ç§»çš„ Job ä¸€æ—¦éƒ¨ç½²ä¼šé©¬ä¸Šæ‰§è¡Œï¼Œæ–°ç‰ˆæœ¬çš„åº”ç”¨ä¹Ÿä¼šè¢«åˆ›å»ºå‡ºæ¥ä½†æ˜¯ä¸ä¼šè¿è¡Œï¼Œå› ä¸ºæ•°æ®åº“æ•°æ®æ›´æ–°çš„ Job è¿˜åœ¨è¿è¡Œï¼Œåˆå§‹åŒ–å®¹å™¨ä¹Ÿå°±è¿˜å¤„äºä¼‘çœ çŠ¶æ€ä¸­ï¼Œè¿™æ ·æ–°ç‰ˆæœ¬çš„ Pod å°±ä¼šè¢«æ¨è¿Ÿè¿è¡Œã€‚è€Œä¸”æ—§ç‰ˆæœ¬çš„ Pod ä¸ä¼šå—åˆ°å½±å“ï¼Œè¿˜èƒ½ç»§ç»­å¤„ç†ä¸šåŠ¡æµé‡ã€‚&lt;/li&gt;
&lt;li&gt;å½“æ•°æ®åº“æ•°æ®æ›´æ–°å®Œæˆæ—¶ï¼ŒJob å°±ä¼šæ­£å¸¸ç»“æŸã€‚&lt;/li&gt;
&lt;li&gt;å½“åˆå§‹åŒ–å®¹å™¨å‘ç°ç›¸å…³çš„ Job æ­£å¸¸ç»“æŸäº†ï¼Œå®ƒè‡ªå·±ä¹Ÿå°±ä¼šé€€å‡ºã€‚è¿™æ ·åº”ç”¨çš„å®¹å™¨æ‰ä¼šå¼€å§‹å¯åŠ¨å¹¶å¤„ç†ä¸šåŠ¡æµé‡ã€‚&lt;/li&gt;
&lt;li&gt;æ—§ç‰ˆæœ¬çš„ pod ä¼šæ ¹æ®æ»šåŠ¨æ›´æ–°çš„ç­–ç•¥è¢«ç§»é™¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-job-init&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;./pics/jobs-and-init-containers-1.png&#34; alt=&#34;Job init&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Job init
    &lt;/figcaption&gt;&lt;/figure&gt;

















&lt;figure  id=&#34;figure-job-int&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;./pics/jobs-and-init-containers-2.png&#34; alt=&#34;Job int&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Job int
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å°±åƒæˆ‘è¯´è¿‡çš„ï¼Œè¿™ä¸ªæ–¹æ¡ˆæˆ‘å·²ç»æˆåŠŸçš„ä½¿ç”¨äº†å¥½å‡ å¹´ï¼Œå› æ­¤æˆ‘è§‰å¾—å®ƒæ˜¯ä¸€ä¸ªåˆé€‚çš„è§£å†³æ–¹æ¡ˆã€‚æˆ‘åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¼šè¯¦ç»†çš„è§£é‡Šå¦‚ä½•å®æ–½è¿™ä¸ªæ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬å®Œæˆæœ¬æ¬¡æ¢è®¨ä¹‹å‰ï¼Œæˆ‘æƒ³å†èŠèŠæœ€åçš„ä¸€ä¸ªåšæ³•ï¼šä½¿ç”¨ Helm Chart Hooksã€‚&lt;/p&gt;
&lt;h4 id=&#34;helm-chart-hooks&#34;&gt;Helm Chart Hooks&lt;/h4&gt;
&lt;p&gt;å­—é¢ä¸Šæ¥çœ‹ï¼Œ&lt;a href=&#34;https://helm.sh/docs/topics/charts_hooks/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helm Chart Hooks&lt;/a&gt; çœ‹èµ·æ¥å¥½åƒå¯ä»¥å®ç°æˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬åœ¨æ‰§è¡Œä¸»è¦éƒ¨ç½²ä»»åŠ¡æ—¶ï¼Œæå‰è¿è¡Œä¸€ä¸ª Job ä½œä¸ºéƒ¨ç½²è¿™ä¸ª helm chart çš„ä¸€éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘ç¬¬ä¸€æ¬¡å°è¯•ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œè¿™æ­£å°±æ˜¯æˆ‘çš„åšæ³•ã€‚æˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ª Kubernetes çš„ Job é€šè¿‡æ·»åŠ  annotation æ¥è½¬åŒ–æˆä¸º Helm Hookï¼Œçœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;batch/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Job&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{{ .Release.Name }}&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# This is what defines this resource as a hook&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;helm.sh/hook&amp;#34;: &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;pre-install&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åªè¦æ·»åŠ ä¸Šè¿™ä¸€è¡Œå°±èƒ½ç¡®ä¿ Helm ä¸ä¼šå°†è¿™ä¸€éƒ¨åˆ†ä½œä¸ºä¸»è¦çš„å®‰è£…æˆ–è€…å‡çº§æµç¨‹ï¼Œç›¸åï¼Œå®ƒä¼šåœ¨éƒ¨ç½²ä¸»åº”ç”¨ä¹‹å‰å…ˆè¿è¡Œ jobï¼Œå¹¶ç­‰å¾…è¿™ä¸ª job å®Œæˆã€‚åªè¦è¿™ä¸ª job é¡ºåˆ©å®Œæˆï¼Œè¿™æ•´ä¸ª chart å°±ä¼šå¼€å§‹å®‰è£…ï¼Œå¹¶å¯¹ä½ çš„åº”ç”¨æ‰§è¡Œæ»šåŠ¨æ›´æ–°ã€‚å¦‚æœ Job å¤±è´¥äº†ï¼Œè¿™ä¸ª chart ä¸ä¼šç»§ç»­å®‰è£…ï¼Œæ­£åœ¨è¿è¡Œçš„åº”ç”¨ä¹Ÿä¸ä¼šå—å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘åˆšå¼€å§‹æµ‹è¯•è¿™ä¸ªæ–¹æ¡ˆçš„æ—¶å€™æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯æœ‰ä¸ªæ„å¤–ã€‚å¦‚æœæ•°æ®åº“çš„æ›´æ–°è€—æ—¶è¾ƒé•¿è¶…è¿‡äº† Helm çš„ timeout æ—¶é—´ï¼ŒHelm ä¼š timeout é€€å‡ºï¼Œè¿™æ ·æ•´ä¸ªéƒ¨ç½²å°±ä¸ä¼šç»§ç»­ï¼Œä½†æ˜¯å¹¶ä¸çŸ¥é“æ•°æ®åº“è¿ç§»åˆ°åº•æˆåŠŸäº†è¿˜æ˜¯å¤±è´¥äº†ã€‚&lt;/p&gt;
&lt;p&gt;äº‹å®ä¸Šç”Ÿäº§ç¯å¢ƒé€šå¸¸æœ‰æ›´å¤šçš„æ•°æ®é‡æ›´æ›´é«˜çš„è´Ÿè½½ï¼Œå› æ­¤å¯¹äºæ•°æ®åº“çš„å˜æ›´å¾ˆå¤§æœºç‡ä¼šå˜å¾—å¾ˆæ…¢ï¼Œç»“æœä¼šå¯¼è‡´ä¸Šé¢çš„æ„å¤–å‘ç”Ÿï¼Œæ‰€ä»¥æœ€ç»ˆæˆ‘ä»¬è¿˜æ˜¯é€‰æ‹©äº†å‰é¢æè¿°çš„åˆå§‹åŒ–å®¹å™¨çš„æ–¹å¼ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æˆ‘ä¹Ÿæœ‰æ®µæ—¶é—´æ²¡æœ‰äº†è§£è¿‡ Helm Chart Hooks äº†ï¼Œæœ‰å¯èƒ½è¿™ä¸ªé—®é¢˜å·²ç»è§£å†³äº†ï¼Œä½†æ˜¯æˆ‘å¹¶æ²¡æœ‰åœ¨æ–‡æ¡£ä¸­è§åˆ°ç›¸å…³æè¿°ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« ä¸­æˆ‘æè¿°äº†åº”ç”¨éƒ¨ç½²åœ¨ kubernetes çš„æ—¶å€™å¦‚ä½•è§£å†³æ•°æ®åº“æ•°æ®æ›´æ–°çš„é—®é¢˜ï¼Œä¹Ÿæ¢è®¨äº†è®©æ•°æ®åº“æ•°æ®æ›´æ–°é€‚åº”å¤šç‰ˆæœ¬åº”ç”¨çš„å¿…è¦æ€§å’Œå‡ ç§ä¸åŒçš„è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘æ¨èçš„æ–¹æ¡ˆæ˜¯åˆ›å»ºä¸€ä¸ª CLI å·¥å…·è´Ÿè´£æ‰§è¡Œæ•°æ®åº“æ•°æ®æ›´æ–°ï¼Œå¹¶ä»¥ Kubernetes Job çš„å½¢å¼è¿è¡Œã€‚å¦å¤–ï¼Œåœ¨åº”ç”¨çš„æ¯ä¸ª Pod æ·»åŠ ä¸€ä¸ªåˆå§‹åŒ–å®¹å™¨ï¼Œç¡®ä¿ Job æˆåŠŸå®Œæˆæ‰å¯åŠ¨åº”ç”¨å®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« åªæ˜¯æ¢è®¨äº†ä¸€äº›æ¦‚å¿µä¸Šçš„ä¸œè¥¿ï¼Œåœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­æˆ‘ä¼šä»”ç»†æè¿°å¦‚ä½•å®æ–½ï¼Œå¦‚ä½•ä»¥ Helm Chart çš„å½¢å¼éƒ¨ç½²ä¸€ä¸ª Kubernetes Job å¹¶ä½¿ç”¨åˆå§‹åŒ–å®¹å™¨æ¥æ§åˆ¶åº”ç”¨å®¹å™¨çš„å¯åŠ¨æµç¨‹ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å¦‚ä½•é€‰æ‹©æœ€ä½³çš„ Kubernetes é›†ç¾¤è‡ªåŠ¨ä¼¸ç¼©ç­–ç•¥</title>
      <link>https://cloudnativecn.com/blog/kubernetes-autoscaling-strategy/</link>
      <pubDate>Wed, 30 Jun 2021 18:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/kubernetes-autoscaling-strategy/</guid>
      <description>&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;è¿™ç¯‡å†…å®¹ç¯‡å¹…æ¯”è¾ƒé•¿ï¼Œå¦‚æœä¸æƒ³æ·±å…¥æ¢è®¨æˆ–æ—¶é—´æœ‰é™ï¼Œè¿™æ˜¯å…¨æ–‡ç®€è¿°ï¼š
åœ¨é»˜è®¤è®¾ç½®ä¸‹ï¼Œæ‰©å±• Kubernetes é›†ç¾¤ä¸­çš„ pod å’ŒèŠ‚ç‚¹å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´ã€‚
äº†è§£å¦‚ä½•è°ƒæ•´é›†ç¾¤èŠ‚ç‚¹çš„å¤§å°ã€é…ç½®æ°´å¹³å’Œé›†ç¾¤è‡ªåŠ¨ç¼©æ”¾å™¨ä»¥åŠè¿‡åº¦é…ç½®é›†ç¾¤ä»¥åŠ å¿«æ‰©å±•é€Ÿåº¦ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç›®å½•&#34;&gt;ç›®å½•&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å½“è‡ªåŠ¨ä¼¸ç¼©çš„ Pod æŠ¥é”™&lt;/li&gt;
&lt;li&gt;Kubernetes çš„ Cluster Autoscaler æ˜¯å¦‚ä½•å·¥ä½œçš„&lt;/li&gt;
&lt;li&gt;æ¢ç´¢ Pod è‡ªåŠ¨ä¼¸ç¼©æå‰æœŸ&lt;/li&gt;
&lt;li&gt;ä¸º Kubernetes èŠ‚ç‚¹é€‰æ‹©æœ€ä½³å®ä¾‹å¤§å°&lt;/li&gt;
&lt;li&gt;åœ¨ Kubernetes é›†ç¾¤ä¸­è¿‡åº¦é…ç½®èŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;ä¸º Pod é€‰æ‹©æ­£ç¡®çš„å†…å­˜å’Œ CPU èµ„æº&lt;/li&gt;
&lt;li&gt;å…³äºé›†ç¾¤çš„ç¼©å®¹&lt;/li&gt;
&lt;li&gt;ä¸ºä»€ä¹ˆä¸åŸºäºå†…å­˜æˆ– CPU è¿›è¡Œè‡ªåŠ¨ä¼¸ç¼©&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨ Kubernetes ä¸­ï¼Œè‡ªåŠ¨ä¼¸ç¼©åŠŸèƒ½åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pod æ°´å¹³è‡ªåŠ¨ä¼¸ç¼©ï¼ˆHorizontal Pod Autoscalerï¼ŒHPAï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pod å‚ç›´è‡ªåŠ¨ä¼¸ç¼©ï¼ˆVertical Pod Autoscalerï¼ŒVPAï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é›†ç¾¤è‡ªåŠ¨ä¼¸ç¼©ï¼ˆCluster Autoscalerï¼ŒCAï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™äº›è‡ªåŠ¨ä¼¸ç¼©ç»„ä»¶å±äºä¸åŒçš„ç±»åˆ«ï¼Œå…³æ³¨ç‚¹ä¹Ÿä¸åŒã€‚&lt;/p&gt;
&lt;p&gt;Horizontal Pod Autoscaler è´Ÿè´£å¢åŠ  Pod çš„å‰¯æœ¬æ•°é‡ã€‚éšç€ä½ çš„åº”ç”¨æ¥æ”¶åˆ°çš„æµé‡è¶Šæ¥è¶Šå¤šï¼Œä½ å¯ä»¥è®©è‡ªåŠ¨ä¼¸ç¼©ç»„ä»¶è°ƒæ•´å‰¯æœ¬æ•°é‡æ¥å¤„ç†æ›´å¤šçš„è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;Vertical Pod Autoscaler çš„ä½¿ç”¨åœºæ™¯æ˜¯ï¼Œå½“èµ„æºä¸è¶³æ— æ³•åˆ›å»ºæ›´å¤šçš„ Pod å‰¯æœ¬æ—¶ï¼Œè€Œåˆä»ç„¶éœ€è¦å¤„ç†æ›´å¤šçš„æµé‡ã€‚
ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œä½ æ— æ³•é€šè¿‡ç®€å•åœ°æ·»åŠ æ›´å¤šçš„ Pod å‰¯æœ¬æ¥æ‰©å®¹æ•°æ®åº“ã€‚æ•°æ®åº“å¯èƒ½éœ€è¦è¿›è¡Œæ•°æ®åˆ†ç‰‡æˆ–è€…é…ç½®åªè¯»èŠ‚ç‚¹ã€‚
ä½†ä½ å¯ä»¥é€šè¿‡å¢åŠ å†…å­˜å’Œ CPU èµ„æºæ¥è®©æ•°æ®åº“èƒ½å¤Ÿå¤„ç†æ›´å¤šçš„è¿æ¥æ•°ã€‚
è¿™æ­£æ˜¯ VPA çš„ç›®çš„ï¼Œå¢åŠ  Pod çš„èµ„æºå¤§å°ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œæˆ‘ä»¬è¦è¯´è¯´é›†ç¾¤è‡ªåŠ¨ä¼¸ç¼©ç»„ä»¶äº†ã€‚
å½“ä½ çš„é›†ç¾¤èµ„æºä¸è¶³æ—¶ï¼ŒCluster Autoscaler ä¼šé…ç½®ä¸€ä¸ªæ–°çš„è®¡ç®—å•å…ƒå¹¶å°†å…¶æ·»åŠ åˆ°é›†ç¾¤ä¸­ã€‚å¦‚æœç©ºèŠ‚ç‚¹è¿‡å¤šï¼Œä¼šç§»é™¤å®ƒä»¬ä»¥é™ä½æˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶è¿™ä¸‰ä¸ªç»„ä»¶éƒ½â€œè‡ªåŠ¨ä¼¸ç¼©â€äº†ä¸€äº›ä¸œè¥¿ï¼Œä½†å®ƒä»¬å¹¶ä¸é€ æˆç›¸äº’ä¹‹é—´çš„å¹²æ‰°ã€‚å®ƒä»¬å„è‡ªéƒ½æœ‰è‡ªå·±ä½¿ç”¨åœºæ™¯ï¼Œå®šä¹‰å’Œå·¥ä½œæœºåˆ¶ã€‚å¹¶ä¸”å®ƒä»¬æ˜¯åœ¨ç‹¬ç«‹çš„é¡¹ç›®ä¸­å¼€å‘çš„ï¼Œç‹¬ç«‹çš„ä½¿ç”¨ã€‚
ç„¶è€Œï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œä¸ºäº†æœ€å¥½çš„ scaling ä½ çš„é›†ç¾¤ï¼Œä½ å¿…é¡»èŠ±äº›å¿ƒæ€å»è®¾ç½®å¥½è¿™äº› Autoscalerï¼Œè®©æˆ‘ä»¬çœ‹ä¸ªä¾‹å­ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å½“è‡ªåŠ¨ä¼¸ç¼©çš„-pod-æŠ¥é”™&#34;&gt;å½“è‡ªåŠ¨ä¼¸ç¼©çš„ Pod æŠ¥é”™&lt;/h3&gt;
&lt;p&gt;æƒ³è±¡ä¸€ä¸‹ï¼Œæœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºå§‹ç»ˆéœ€è¦å¹¶ä½¿ç”¨ 1.5GB å†…å­˜å’Œ 0.25 ä¸ª vCPUã€‚
ä½ é…ç½®äº†ä¸€ä¸ªå…·æœ‰ 8GB å’Œ 2 ä¸ª vCPU çš„å•ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ â€”â€” å®ƒåº”è¯¥èƒ½å¤Ÿå®Œç¾åœ°å®¹çº³å››ä¸ª podï¼ˆå¹¶ä¸”è¿˜æœ‰ä¸€ç‚¹é¢å¤–çš„ç©ºé—´ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/kubernetes-autoscaling-strategy/single-node_hu4262560659082574121.webp 400w,
               /blog/kubernetes-autoscaling-strategy/single-node_hu1577238899259996802.webp 760w,
               /blog/kubernetes-autoscaling-strategy/single-node_hu753401011198124154.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-autoscaling-strategy/single-node_hu4262560659082574121.webp&#34;
               width=&#34;760&#34;
               height=&#34;502&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç°åœ¨ï¼Œä½ éƒ¨ç½²äº†ä¸€ä¸ª Pod å¹¶ä¸”é…ç½®å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;HPA é…ç½®æ¯ 10 ä¸ªè¯·æ±‚è¿›æ¥å°±æ·»åŠ ä¸€ä¸ª Pod å‰¯æœ¬ï¼ˆä¾‹å¦‚ï¼šå¦‚æœæœ‰ 40 ä¸ªå¹¶å‘è¯·æ±‚æ¶Œå…¥ï¼Œä¼šæ‰©å®¹åˆ° 4 ä¸ª Pod å‰¯æœ¬ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;CA é…ç½®åœ¨èµ„æºä¸è¶³æ—¶ï¼Œåˆ›å»ºæ›´å¤šçš„ Node èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;HPA å¯ä»¥é€šè¿‡åœ¨ deployment æ–‡ä»¶ä¸­ä½¿ç”¨ Custom Metricsï¼ˆä¾‹å¦‚åœ¨ Ingress Controller ä¸­çš„ queries per secondï¼ˆQPSï¼‰ï¼‰æ¥æ‰©å®¹ Pod å‰¯æœ¬æ•°é‡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç°åœ¨ï¼Œä½ å¼€å§‹ä¸ºé›†ç¾¤å¢åŠ  30 ä¸ªå¹¶å‘è¯·æ±‚ï¼Œå¹¶è§‚å¯Ÿä¸€ä¸‹æƒ…å†µï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;HPA å¼€å§‹æ‰©å®¹ Podã€‚&lt;/li&gt;
&lt;li&gt;åˆ›å»ºäº†ä¸¤ä¸ª Pod å‰¯æœ¬ã€‚&lt;/li&gt;
&lt;li&gt;CA æ²¡æœ‰è§¦å‘ - æ²¡æœ‰æ–°å¢é›†ç¾¤ Node èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™å¾ˆå¥½ç†è§£ï¼Œå› ä¸ºç°åœ¨æœ‰è¶³å¤Ÿçš„å†…å­˜å’Œ CPU èµ„æºæ¥æ”¯æŒæ›´å¤šçš„ Podã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;node-enogh.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½ è¿›ä¸€æ­¥å°†æµé‡å¢åŠ åˆ° 40 ä¸ªå¹¶å‘è¯·æ±‚ï¼Œå¹¶å†æ¬¡è§‚å¯Ÿï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;HPA åˆåˆ›å»ºäº†ä¸€ä¸ª Podã€‚&lt;/li&gt;
&lt;li&gt;è¿™ä¸ª Pod æ˜¯ pending çŠ¶æ€å¹¶ä¸”æ— æ³•è¢«éƒ¨ç½²ã€‚&lt;/li&gt;
&lt;li&gt;CA è§¦å‘åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ Node èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;æ–° Node èŠ‚ç‚¹å¯åŠ¨ 4 åˆ†é’Ÿåå¼€å§‹å·¥ä½œã€‚ä¹‹åï¼Œpending Pod ä¹ŸæˆåŠŸè¢«éƒ¨ç½²äº†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/kubernetes-autoscaling-strategy/pending-pod_hu4858593059223358216.webp 400w,
               /blog/kubernetes-autoscaling-strategy/pending-pod_hu6198962180695694275.webp 760w,
               /blog/kubernetes-autoscaling-strategy/pending-pod_hu14637481560824475192.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-autoscaling-strategy/pending-pod_hu4858593059223358216.webp&#34;
               width=&#34;760&#34;
               height=&#34;551&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/kubernetes-autoscaling-strategy/pending-pod-2_hu1841908331179461084.webp 400w,
               /blog/kubernetes-autoscaling-strategy/pending-pod-2_hu7255709272465050577.webp 760w,
               /blog/kubernetes-autoscaling-strategy/pending-pod-2_hu13920216712397982547.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-autoscaling-strategy/pending-pod-2_hu1841908331179461084.webp&#34;
               width=&#34;760&#34;
               height=&#34;562&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆç¬¬å››ä¸ª Pod æ²¡æœ‰éƒ¨ç½²åœ¨ç¬¬ä¸€ä¸ª Node èŠ‚ç‚¹ä¸Šå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Pod éƒ¨ç½²åœ¨é›†ç¾¤ä¸Šéœ€è¦æ¶ˆè€—å†…å­˜ï¼ŒCPUï¼Œç¡¬ç›˜ç©ºé—´ç­‰èµ„æºï¼Œåœ¨åŒä¸€ä¸ª Node ä¸Šï¼Œæ“ä½œç³»ç»Ÿå’Œ kubelet ç»„ä»¶ä¹Ÿéœ€è¦æ¶ˆè€—å†…å­˜å’Œ CPU èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes ä¸­ä¸€ä¸ª Worker Node èŠ‚ç‚¹çš„å†…å­˜å’Œ CPU ç­‰èµ„æºä½¿ç”¨åˆ†å¸ƒå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;éœ€è¦è¿è¡Œæ“ä½œç³»ç»Ÿå’Œä¸€äº›ç³»ç»Ÿçº§çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œä¾‹å¦‚ SSHï¼ŒSystemd ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦è¿è¡Œ Kubernetes Agent ç»„ä»¶ï¼Œä¾‹å¦‚ Kubeletï¼ŒContainer Runtimeï¼Œ&lt;a href=&#34;https://github.com/kubernetes/node-problem-detector&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Node Problem Detector&lt;/a&gt; ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦è¿è¡Œ Podã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦ä¿ç•™ä¸€äº›èµ„æºç”¨æ¥&lt;a href=&#34;https://kubernetes.io/docs/tasks/administer-cluster/reserve-compute-resources/#eviction-thresholds&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é©±é€é˜€å€¼&lt;/a&gt; ä¹‹ç”¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34;
           src=&#34;https://cloudnativecn.com/blog/kubernetes-autoscaling-strategy/eviction-threshold.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½ çŒœçš„æ²¡é”™ï¼Œæ‰€æœ‰è¿™äº›é…é¢éƒ½æ˜¯å¯å®šåˆ¶çš„ï¼Œä½†ä½ éœ€è¦å¥½å¥½è®¡ç®—ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¸€ä¸ª 8GB å†…å­˜å’Œ 2vCPU çš„å•ä¸ªèŠ‚ç‚¹çš„ï¼Œå¯ä»¥æŒ‰å¦‚ä¸‹ä¼°ç®—ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ“ä½œç³»ç»Ÿè¿è¡Œå¤§æ¦‚éœ€è¦ 100MB å†…å­˜å’Œ 0.1vCPUã€‚&lt;/li&gt;
&lt;li&gt;kubelet è¿è¡Œå¤§æ¦‚éœ€è¦ 1.8GB å†…å­˜å’Œ 0.07vCPUã€‚&lt;/li&gt;
&lt;li&gt;é©±é€é˜€å€¼å¤§æ¦‚éœ€è¦ 100MB å†…å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‰©ä½™çš„å¤§çº¦ 6GB å†…å­˜ç©ºé—´å’Œ 1.83vCPU æ˜¯æä¾›ç»™ Pod ä½¿ç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ çš„é›†ç¾¤éœ€è¦è¿è¡Œ DaemonSet èµ„æºï¼Œåƒ kube-proxyï¼Œé‚£ä¹ˆä½ åº”è¯¥è¿›ä¸€æ­¥å‡å°‘æä¾›ç»™ Pod çš„èµ„æºã€‚è€ƒè™‘åˆ° kube-proxy å¤§æ¦‚éœ€è¦ 128MB å†…å­˜å’Œ 0.1vCPUï¼Œé‚£ä¹ˆå‰©ä½™å¤§çº¦ 5.9GB å†…å­˜ç©ºé—´å’Œ 1.73vCPU æ˜¯æä¾›ç»™ Pod ä½¿ç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œå¦‚æœè¿˜éœ€è¦è¿è¡Œ CNI ç»„ä»¶ï¼ˆä¾‹å¦‚ï¼šFlannelï¼‰å’Œæ—¥å¿—æ”¶é›†ç»„ä»¶ï¼ˆFlentdï¼‰ï¼Œåˆä¼šè¿›ä¸€æ­¥å‡å°‘æä¾›ç»™ Pod çš„èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç»Ÿè®¡å®Œæ‰€æœ‰å…¶ä»–çš„èµ„æºå ç”¨æƒ…å†µåï¼Œé›†ç¾¤çš„å‰©ä½™ç©ºé—´å°±åªå¤Ÿè¿è¡Œä¸‰ä¸ª Pod äº†ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/kubernetes-autoscaling-strategy/left-space-pod_hu6522887157121436426.webp 400w,
               /blog/kubernetes-autoscaling-strategy/left-space-pod_hu231686492475808525.webp 760w,
               /blog/kubernetes-autoscaling-strategy/left-space-pod_hu14790420928521031132.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-autoscaling-strategy/left-space-pod_hu6522887157121436426.webp&#34;
               width=&#34;760&#34;
               height=&#34;444&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ç¬¬å››ä¸ªä¼šä¸€ç›´ä¿æŒâ€œpendingâ€çŠ¶æ€ï¼Œç›´åˆ°å®ƒè¢«è°ƒåº¦åˆ°å…¶ä»–çš„ Node èŠ‚ç‚¹ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;æ—¢ç„¶ Cluster Autoscaler çŸ¥é“æ²¡æœ‰ç©ºé—´å®¹çº³ç¬¬å››ä¸ª Podï¼Œä¸ºä»€ä¹ˆä¸æå‰é…ç½®ä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Ÿ
ä¸ºä»€ä¹ˆå®ƒè¦åœ¨ Pod å¤„äºâ€œpendingâ€çŠ¶æ€ä¹‹åå†è§¦å‘åˆ›å»ºæ–° Node èŠ‚ç‚¹çš„æ“ä½œï¼Ÿ&lt;/p&gt;
&lt;h3 id=&#34;kubernetes-çš„-cluster-autoscaler-æ˜¯å¦‚ä½•å·¥ä½œçš„&#34;&gt;Kubernetes çš„ Cluster Autoscaler æ˜¯å¦‚ä½•å·¥ä½œçš„&lt;/h3&gt;
&lt;p&gt;Cluster Autoscaler ä¸æ˜¯é€šè¿‡è§‚å¯Ÿå†…å­˜æˆ– CPU çš„ä½¿ç”¨æƒ…å†µæ¥è§¦å‘è‡ªåŠ¨ä¼¸ç¼©çš„ã€‚ç›¸ååœ°ï¼Œæ˜¯é€šè¿‡å¯¹äº‹ä»¶çš„å“åº”å’Œæ¯ 10s å¯¹ä¸å¯è°ƒåº¦çš„ Pod è¿›è¡Œæ£€æŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;å½“ Scheduler æ— æ³•æ‰¾åˆ°å¯ä»¥å®¹çº³å®ƒçš„ Node èŠ‚ç‚¹æ—¶ï¼ŒPod å°±ä¼šå˜æˆä¸å¯è°ƒåº¦çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ª Pod éœ€è¦ 1vCPU èµ„æºè€Œé›†ç¾¤åªæœ‰ 0.5vCPU èµ„æºå¯ç”¨ï¼ŒScheduler å°±ä¼šæŠŠè¯¥ Pod æ ‡è®°ä¸ºä¸å¯è°ƒåº¦çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ—¶ï¼ŒCluster Autoscaler ä¼šå¼€å§‹åˆ›å»ºæ–° Node èŠ‚ç‚¹ã€‚åˆ›å»ºå®Œæˆåï¼Œå®ƒä¼šæ‰«æé›†ç¾¤ä¸­çš„ä¸å¯è°ƒåº¦çŠ¶æ€çš„ Podï¼Œ&lt;a href=&#34;https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/FAQ.md#what-are-expanders&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ£€æŸ¥æ˜¯å¦å¯ä»¥å°†è¿™äº› Pod è°ƒåº¦åˆ°æ–°èŠ‚ç‚¹ä¸Š&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ çš„é›†ç¾¤å…·æœ‰å¤šç§èŠ‚ç‚¹ç±»å‹ï¼ˆé€šå¸¸ä¹Ÿç§°ä¸ºèŠ‚ç‚¹ç»„æˆ–èŠ‚ç‚¹æ± ï¼‰ï¼Œåˆ™ Cluster Autoscaler å°†ä½¿ç”¨ä»¥ä¸‹ç­–ç•¥é€‰æ‹©å…¶ä¸­ä¸€ç§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Random - éšæœºé€‰æ‹©ä¸€ç§èŠ‚ç‚¹ç±»å‹ï¼ˆé»˜è®¤ç­–ç•¥ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;Most Pods - é€‰æ‹©å°†è°ƒåº¦æœ€å¤š Pod çš„èŠ‚ç‚¹ç»„ã€‚&lt;/li&gt;
&lt;li&gt;Least waste - é€‰æ‹©æ‰©å®¹åç©ºé—² CPU æœ€å°‘çš„èŠ‚ç‚¹ç»„ã€‚&lt;/li&gt;
&lt;li&gt;Price - é€‰æ‹©æˆæœ¬æœ€ä½çš„èŠ‚ç‚¹ç»„ï¼ˆç›®å‰ä»…é€‚ç”¨äº GCPï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;Priority - é€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„èŠ‚ç‚¹ç»„ï¼ˆä¼˜å…ˆçº§å¯ä»¥æ‰‹åŠ¨è®¾ç½®ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸€æ—¦ç¡®å®šäº†èŠ‚ç‚¹ç±»å‹ï¼ŒCluster Autoscaler å°†è°ƒç”¨ç›¸å…³ API æ¥æä¾›æ–°çš„è®¡ç®—èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ AWSï¼ŒCluster Autoscaler å°†é¢„ç½®ä¸€ä¸ªæ–°çš„ EC2 å®ä¾‹ã€‚åœ¨ Azure ä¸Šï¼Œå®ƒå°†åˆ›å»ºä¸€ä¸ªæ–°çš„è™šæ‹Ÿæœºï¼Œå¹¶åœ¨ GCP ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„è®¡ç®—å¼•æ“ã€‚&lt;/p&gt;
&lt;p&gt;åˆ›å»ºçš„èŠ‚ç‚¹å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´æ‰èƒ½å‡ºç°åœ¨ Kubernetes ä¸­ã€‚è®¡ç®—èµ„æºå‡†å¤‡å°±ç»ªåï¼ŒèŠ‚ç‚¹å°†è¢«åˆå§‹åŒ–å¹¶æ·»åŠ åˆ°å¯ä»¥éƒ¨ç½²æœªè¢«è°ƒåº¦ Pod çš„é›†ç¾¤ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ä¸å¹¸çš„æ˜¯ï¼Œé…ç½®ä¸€ä¸ªæ–°èŠ‚ç‚¹é€šå¸¸ä¼šå¾ˆæ…¢ã€‚å®ƒå¯èƒ½ä¼šèŠ±è´¹å¥½å‡ åˆ†é’Ÿæ¥åšè¿™ä»¶äº‹ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™å‡ åˆ†é’Ÿåˆ°åº•å¹²äº†ä»€ä¹ˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ¢ç´¢-pod-è‡ªåŠ¨ä¼¸ç¼©å‰ç½®æœŸ&#34;&gt;æ¢ç´¢ Pod è‡ªåŠ¨ä¼¸ç¼©å‰ç½®æœŸ&lt;/h3&gt;
&lt;p&gt;åœ¨æ–°èŠ‚ç‚¹ä¸Šåˆ›å»ºæ–° Pod æ‰€éœ€çš„æ—¶é—´ç”±å››ä¸ªä¸»è¦å› ç´ å†³å®šï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;HPA çš„ååº”æ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;CA çš„ååº”æ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;Node èŠ‚ç‚¹çš„ååº”æ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;Pod åˆ›å»ºçš„æ—¶é—´ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é»˜è®¤åœ°ï¼Œ&lt;a href=&#34;https://github.com/kubernetes/kubernetes/blob/2da8d1c18fb9406bd8bb9a51da58d5f8108cb8f7/pkg/kubelet/kubelet.go#L1855&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubelet æ¯ 10 ç§’æŠ“å–ä¸€æ¬¡ Pod çš„ CPU å’Œå†…å­˜ä½¿ç”¨æƒ…å†µ&lt;/a&gt;ã€‚æ¯åˆ†é’Ÿï¼Œ&lt;a href=&#34;https://github.com/kubernetes-sigs/metrics-server/blob/master/FAQ.md#how-often-metrics-are-scraped&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Metrics Server éƒ½ä¼šèšåˆè¿™äº›æŒ‡æ ‡&lt;/a&gt;å¹¶å°†å®ƒä»¬å‘é€ç»™ Kubernetes API çš„å…¶ä»–ç»„ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;Horizontal Pod Autoscaler æ§åˆ¶å™¨è´Ÿè´£æ£€æŸ¥æŒ‡æ ‡å¹¶å†³å®šæ‰©å¤§æˆ–ç¼©å°å‰¯æœ¬æ•°é‡ã€‚&lt;/p&gt;
&lt;p&gt;é»˜è®¤åœ°ï¼Œ&lt;a href=&#34;https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/#how-does-the-horizontal-pod-autoscaler-work&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Horizontal Pod Autoscaler æ¯ 15 ç§’æ£€æŸ¥ä¸€æ¬¡ Pod æŒ‡æ ‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/FAQ.md#how-does-scale-up-work&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cluster Autoscaler æ¯ 10 ç§’æ£€æŸ¥ä¸€æ¬¡é›†ç¾¤ä¸­ä¸å¯è°ƒåº¦çš„ Pod&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦ CA æ£€æµ‹åˆ°ä¸å¯è°ƒåº¦çš„ Podï¼Œå®ƒå°±ä¼šè¿è¡Œä¸€ä¸ªç®—æ³•æ¥åšå†³ç­–ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;éœ€è¦å¤šå°‘ä¸ªèŠ‚ç‚¹æ¥å°†æ‰€æœ‰çš„ä¸å¯è°ƒåº¦ Pod éƒ¨ç½²å®Œæˆã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦åˆ›å»ºé‚£ç§ç±»å‹çš„èŠ‚ç‚¹ç»„ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ•´ä¸ªè¿‡ç¨‹çš„æ—¶é—´èŠ±è´¹åº”è¯¥æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨å°‘äº 100 ä¸ªèŠ‚ç‚¹ä¸”æ¯ä¸ªèŠ‚ç‚¹æœ€å¤š 30 ä¸ª Pod çš„é›†ç¾¤ä¸Šä¸è¶…è¿‡ 30 ç§’ã€‚å¹³å‡å»¶è¿Ÿåº”è¯¥æ˜¯å¤§çº¦ 5 ç§’ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨å…·æœ‰ 100 åˆ° 1000 ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ä¸Šä¸è¶…è¿‡ 60 ç§’ã€‚å¹³å‡å»¶è¿Ÿåº”çº¦ä¸º 15 ç§’ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/kubernetes-autoscaling-strategy/hpa-ca-time_hu16237664738337575101.webp 400w,
               /blog/kubernetes-autoscaling-strategy/hpa-ca-time_hu9299026900730662205.webp 760w,
               /blog/kubernetes-autoscaling-strategy/hpa-ca-time_hu14934810563230970992.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-autoscaling-strategy/hpa-ca-time_hu16237664738337575101.webp&#34;
               width=&#34;760&#34;
               height=&#34;327&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç„¶åæ˜¯èŠ‚ç‚¹é…ç½®æ—¶é—´ï¼Œè¿™ä¸»è¦å–å†³äºäº‘æä¾›å•†ã€‚åœ¨ 3-5 åˆ†é’Ÿå†…ä¾›åº”æ–°çš„è®¡ç®—èµ„æºæ˜¯éå¸¸æ ‡å‡†çš„ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/kubernetes-autoscaling-strategy/hpa-ca-time-2_hu1291935013523013971.webp 400w,
               /blog/kubernetes-autoscaling-strategy/hpa-ca-time-2_hu6366776972245057277.webp 760w,
               /blog/kubernetes-autoscaling-strategy/hpa-ca-time-2_hu17974098970417278610.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-autoscaling-strategy/hpa-ca-time-2_hu1291935013523013971.webp&#34;
               width=&#34;760&#34;
               height=&#34;356&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœ€åï¼ŒPod å¿…é¡»ç”±å®¹å™¨è¿è¡Œæ—¶åˆ›å»ºã€‚å¯åŠ¨ä¸€ä¸ªå®¹å™¨åº”è¯¥ä¸ä¼šè¶…è¿‡å‡ æ¯«ç§’ï¼Œä½†ä¸‹è½½å®¹å™¨é•œåƒå¯èƒ½éœ€è¦å‡ ç§’é’Ÿã€‚
å¦‚æœæ²¡æœ‰ç¼“å­˜å®¹å™¨æ˜ åƒï¼Œåˆ™ä»å®¹å™¨æ³¨å†Œè¡¨ä¸‹è½½æ˜ åƒå¯èƒ½éœ€è¦å‡ ç§’é’Ÿåˆ°ä¸€åˆ†é’Ÿçš„æ—¶é—´ï¼Œå…·ä½“å–å†³äºå±‚çš„å¤§å°å’Œæ•°é‡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/kubernetes-autoscaling-strategy/hpa-ca-time-3_hu7038861886697929922.webp 400w,
               /blog/kubernetes-autoscaling-strategy/hpa-ca-time-3_hu3216732657739122217.webp 760w,
               /blog/kubernetes-autoscaling-strategy/hpa-ca-time-3_hu7871637802044915231.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-autoscaling-strategy/hpa-ca-time-3_hu7038861886697929922.webp&#34;
               width=&#34;760&#34;
               height=&#34;332&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œå½“é›†ç¾¤ä¸­æ²¡æœ‰ç©ºé—´è€Œè§¦å‘è‡ªåŠ¨ä¼¸ç¼©çš„æ—¶é—´æ¶ˆè€—å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Horizontal Pod Autoscaler å¯èƒ½éœ€è¦é•¿è¾¾ 1min30s æ¥å¢åŠ å‰¯æœ¬æ•°é‡ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºå°‘äº 100 ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼ŒCluster Autoscaler åº”è¯¥èŠ±è´¹ä¸åˆ° 30s çš„æ—¶é—´ï¼Œå¯¹äºè¶…è¿‡ 100 ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œåº”è¯¥ä¸åˆ° 1minã€‚&lt;/li&gt;
&lt;li&gt;äº‘æä¾›å•†å¯èƒ½éœ€è¦ 3-5min æ¥åˆ›å»ºè®¡ç®—æœºèµ„æºã€‚&lt;/li&gt;
&lt;li&gt;å®¹å™¨è¿è¡Œæ—¶å¯èƒ½éœ€è¦é•¿è¾¾ 30s æ‰èƒ½ä¸‹è½½å®¹å™¨æ˜ åƒã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¦‚æœä½ çš„é›†ç¾¤è§„æ¨¡ä¸æ˜¯å¾ˆå¤§ï¼Œåœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œæ—¶é—´æ¶ˆè€—ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/kubernetes-autoscaling-strategy/hpa-ca-time-4_hu5062023007010673680.webp 400w,
               /blog/kubernetes-autoscaling-strategy/hpa-ca-time-4_hu14877449022482405594.webp 760w,
               /blog/kubernetes-autoscaling-strategy/hpa-ca-time-4_hu11615452178984300595.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-autoscaling-strategy/hpa-ca-time-4_hu5062023007010673680.webp&#34;
               width=&#34;760&#34;
               height=&#34;286&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¯¹äºè¶…è¿‡ 100 ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œæ€»å»¶è¿Ÿå¯èƒ½é«˜è¾¾ 7 åˆ†é’Ÿã€‚åœ¨æœ‰æ›´å¤š Pod æ¥å¤„ç†çªç„¶æ¿€å¢çš„æµé‡ä¹‹å‰ï¼Œæ‚¨æ˜¯å¦æ„¿æ„ç­‰å¾…è¿™ 7 åˆ†é’Ÿï¼Ÿ&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæä¾›äº†å‡ ç§å‡å°‘ scaling æ—¶é—´çš„æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è°ƒæ•´ Horizontal Pod Autoscaler çš„åˆ·æ–°æ—¶é—´ï¼ˆç”± &amp;ndash;horizontal-pod-autoscaler-sync-period å‚æ•°æ§åˆ¶ï¼Œé»˜è®¤ 15sï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è°ƒæ•´æŠ“å– Pod çš„ CPU å’Œå†…å­˜ä½¿ç”¨æƒ…å†µçš„é—´éš”é¢‘ç‡ï¼ˆç”± metric-resolution å˜é‡æ§åˆ¶ï¼Œé»˜è®¤ 60sï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è°ƒæ•´ Cluster Autoscaler æ‰«ææœªè¢«è°ƒåº¦ Pod çš„é—´éš”é¢‘ç‡ï¼ˆç”± scan-interval å˜é‡æ§åˆ¶ï¼Œé»˜è®¤ 10sï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è°ƒæ•´ Node èŠ‚ç‚¹ä¸Šç¼“å­˜å®¹å™¨é•œåƒçš„æ–¹å¼ï¼ˆ&lt;a href=&#34;https://github.com/senthilrch/kube-fledged&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é€šè¿‡è¯¸å¦‚ kube-fledged ç­‰å·¥å…·&lt;/a&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½†å³ä½¿å°†è¿™äº›è®¾ç½®è°ƒæ•´ä¸ºå¾ˆå°çš„å€¼ï¼Œä½ ä»ç„¶ä¼šæ”¶åˆ°äº‘æä¾›å•†åˆ›å»ºè®¡ç®—èµ„æºçš„æ—¶é—´é™åˆ¶ã€‚æœ‰ä»€ä¹ˆæ–¹å¼ä¼˜åŒ–è¿™ä¸ªéƒ¨åˆ†å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;è¿™é‡Œå¯ä»¥åšä¸¤ä»¶äº‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å°½å¯èƒ½åœ°é¿å…åˆ›å»ºæ–°åœ° Node èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;ä¸»åŠ¨æå‰åˆ›å»ºèŠ‚ç‚¹ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶èƒ½ç›´æ¥ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;ä¸º-kubernetes-èŠ‚ç‚¹é€‰æ‹©æœ€ä½³å®ä¾‹å¤§å°&#34;&gt;ä¸º Kubernetes èŠ‚ç‚¹é€‰æ‹©æœ€ä½³å®ä¾‹å¤§å°&lt;/h3&gt;
&lt;p&gt;é€‰æ‹©æ­£ç¡®çš„èŠ‚ç‚¹å®ä¾‹ç±»å‹å¯¹é›†ç¾¤çš„æ‰©å±•ç­–ç•¥æœ‰å¾ˆå¤§çš„å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;è€ƒè™‘ä¸€ä¸ªè¿™æ ·çš„åœºæ™¯ã€‚
ä½ æœ‰ä¸€ä¸ªåº”ç”¨éœ€è¦ 1GB çš„å†…å­˜èµ„æºå’Œ 0.1 vCPU èµ„æºã€‚
ä½ æä¾›çš„ Node èŠ‚ç‚¹æœ‰ 4GB çš„å†…å­˜èµ„æºå’Œ 1 vCPU èµ„æºã€‚
åœ¨ä¸ºæ“ä½œç³»ç»Ÿã€kubelet å’Œé©±é€é˜€å€¼ä¿ç•™å†…å­˜å’Œ CPU åï¼Œå°†æ‹¥æœ‰çº¦ 2.5GB çš„å†…å­˜èµ„æºå’Œ 0.7 vCPU å¯ç”¨äºè¿è¡Œ Podã€‚
æ‰€ä»¥ä½ çš„ Node èŠ‚ç‚¹åªèƒ½æ‰¿è½½ 2 ä¸ª Pod çš„è¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/kubernetes-autoscaling-strategy/k8s-node-instance_hu17413494490403895713.webp 400w,
               /blog/kubernetes-autoscaling-strategy/k8s-node-instance_hu1847250049180470744.webp 760w,
               /blog/kubernetes-autoscaling-strategy/k8s-node-instance_hu2169247228006774477.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-autoscaling-strategy/k8s-node-instance_hu17413494490403895713.webp&#34;
               width=&#34;760&#34;
               height=&#34;509&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ¯æ¬¡æ‰©å±• Pod å‰¯æœ¬æ—¶ï¼Œéƒ½å¯èƒ½ä¼šäº§ç”Ÿæœ€å¤š 7 åˆ†é’Ÿçš„å»¶è¿Ÿï¼ˆè§¦å‘ HPAï¼ŒCA å’Œäº‘æä¾›å•†é…ç½®è®¡ç®—èµ„æºçš„å‰ç½®æ—¶é—´ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚æœæ”¹æˆæä¾› 64GB çš„å†…å­˜å’Œ 16 vCPU çš„èŠ‚ç‚¹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¸ºæ“ä½œç³»ç»Ÿã€kubelet å’Œé©±é€é˜€å€¼ä¿ç•™å†…å­˜å’Œ CPU åï¼Œå°†æ‹¥æœ‰çº¦ 58.32GB çš„å†…å­˜èµ„æºå’Œ 15.8 vCPU å¯ç”¨äºè¿è¡Œ Podã€‚&lt;/p&gt;
&lt;p&gt;Node èŠ‚ç‚¹å¯ä»¥æ‰¿è½½ 58 ä¸ª Pod çš„è¿è¡Œï¼Œåªæœ‰è¶…è¿‡ 58 ä¸ª Pod å‰¯æœ¬æ—¶ï¼Œæ‰éœ€è¦ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/kubernetes-autoscaling-strategy/k8s-node-instance-2_hu6010788888033359248.webp 400w,
               /blog/kubernetes-autoscaling-strategy/k8s-node-instance-2_hu12484698531540543374.webp 760w,
               /blog/kubernetes-autoscaling-strategy/k8s-node-instance-2_hu14563871407028128934.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-autoscaling-strategy/k8s-node-instance-2_hu6010788888033359248.webp&#34;
               width=&#34;760&#34;
               height=&#34;587&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œæ¯æ¬¡å‘é›†ç¾¤ä¸­æ·»åŠ èŠ‚ç‚¹æ—¶ï¼Œéƒ½å¯ä»¥éƒ¨ç½²å¤šä¸ª Podã€‚å†æ¬¡è§¦å‘ Cluster Autoscaler çš„æœºä¼šæ›´å°‘ã€‚&lt;/p&gt;
&lt;p&gt;é€‰æ‹©å¤§å‹èŠ‚ç‚¹å®ä¾‹ç±»å‹è¿˜æœ‰å¦ä¸€ä¸ªå¥½å¤„ã€‚
ä¸º kubelet é¢„ç•™çš„èµ„æºã€æ“ä½œç³»ç»Ÿå’Œé©±é€é˜€å€¼ä¸è¿è¡Œ Pod çš„å¯ç”¨èµ„æºä¹‹é—´çš„æ¯”ç‡æ›´å¤§ã€‚
çœ‹çœ‹è¿™å¼ å›¾ï¼Œå®ƒæç»˜äº† Pod å¯ç”¨çš„å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/kubernetes-autoscaling-strategy/node-available-to-pod_hu17124288065392734086.webp 400w,
               /blog/kubernetes-autoscaling-strategy/node-available-to-pod_hu2714112493888934856.webp 760w,
               /blog/kubernetes-autoscaling-strategy/node-available-to-pod_hu10145973591821052108.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-autoscaling-strategy/node-available-to-pod_hu17124288065392734086.webp&#34;
               width=&#34;760&#34;
               height=&#34;501&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;éšç€ Node å®ä¾‹å¤§å°çš„å¢åŠ ï¼Œä½ å¯ä»¥æ³¨æ„åˆ°ï¼ˆæŒ‰æ¯”ä¾‹ï¼‰å¯ç”¨äº Pod çš„èµ„æºå¢åŠ ã€‚æ¢å¥è¯è¯´ï¼Œä¸æ‹¥æœ‰ä¸¤ä¸ªå¤§å°ä¸€åŠçš„å®ä¾‹ç›¸æ¯”ï¼Œå¯ä»¥æ›´é«˜æ•ˆåœ°åˆ©ç”¨èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;é‚£åº”è¯¥ä¸€ç›´é€‰æ‹©æœ€å¤§çš„å®ä¾‹å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;èŠ‚ç‚¹ä¸Šå¯ä»¥æ‹¥æœ‰çš„ Pod æ•°é‡å†³å®šäº†æ•ˆç‡çš„å³°å€¼ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€äº›äº‘æä¾›å•†å°† Pod çš„æ•°é‡é™åˆ¶ä¸º 110 ä¸ªï¼ˆæ¯”å¦‚ GKEï¼‰ã€‚å…¶ä»–ä¸€äº›é™åˆ¶æ˜¯ç”±åº•å±‚ç½‘ç»œåŸºäºæ¯ä¸ªå®ä¾‹ï¼ˆå³ AWSï¼‰è§„å®šçš„ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.google.com/spreadsheets/d/1RPpyDOLFmcgxMCpABDzrsBYWpPYCIBuvAoUQLwOGoQw/edit#gid=907731238&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹å¤§å¤šæ•°äº‘æä¾›å•†çš„é™åˆ¶&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ‰€ä»¥é€‰æ‹©æ›´å¤§çš„å®ä¾‹ç±»å‹å¹¶ä¸æ€»æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;çˆ†ç‚¸åŠå¾„ - å¦‚æœä½ åªæœ‰å‡ ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆä¸€ä¸ªå¤±è´¥èŠ‚ç‚¹çš„å½±å“æ¯”ä½ æœ‰å¾ˆå¤šèŠ‚ç‚¹çš„å½±å“æ›´å¤§ã€‚&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨ä¼¸ç¼©çš„æˆæœ¬æ›´é«˜ï¼Œå› ä¸ºä¸‹ä¸€ä¸ªå¢é‡æ˜¯ï¼ˆéå¸¸ï¼‰å¤§çš„èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å‡è®¾ä½ ä¸ºé›†ç¾¤é€‰æ‹©äº†æ­£ç¡®çš„å®ä¾‹ç±»å‹ï¼Œä½ åœ¨é…ç½®æ–°è®¡ç®—å•å…ƒæ—¶å¯èƒ½ä»ç„¶ä¼šé‡åˆ°å»¶è¿Ÿã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸æ˜¯åœ¨éœ€è¦æ‰©å±•æ—¶åˆ›å»ºæ–°èŠ‚ç‚¹ï¼Œè€Œæ˜¯æå‰åˆ›å»ºç›¸åŒçš„èŠ‚ç‚¹ä¼šæ€ä¹ˆæ ·ï¼Ÿ&lt;/p&gt;
&lt;h3 id=&#34;åœ¨-kubernetes-é›†ç¾¤ä¸­è¿‡åº¦é…ç½®èŠ‚ç‚¹&#34;&gt;åœ¨ Kubernetes é›†ç¾¤ä¸­è¿‡åº¦é…ç½®èŠ‚ç‚¹&lt;/h3&gt;
&lt;p&gt;å¦‚æœä½ å¯ä»¥è´Ÿæ‹…å¾—èµ·éšæ—¶å¯ç”¨çš„å¤‡ç”¨èŠ‚ç‚¹çš„è¯ï¼Œä½ å¯ä»¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æå‰åˆ›å»ºä¸€ä¸ªç©ºçš„ Node èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;ä¸€æ—¦ç©ºçš„ Node èŠ‚ç‚¹ä¸Šæœ‰ Pod äº†ï¼Œå°±ä¼šåˆ›å»ºå¦ä¸€ä¸ªç©ºçš„ Node èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ¢å¥è¯è¯´ï¼Œè®© Cluster Autoscaler æ€»æ˜¯ä¿æŒæœ‰ä¸€ä¸ªå¤‡ç”¨çš„ç©º Node èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ç§æƒè¡¡ï¼šä½ ä¼šäº§ç”Ÿé¢å¤–çš„æˆæœ¬ï¼Œä½†æ‰©å±•æ–°èŠ‚ç‚¹çš„é€Ÿåº¦ä¼šæé«˜ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æœ‰åæ¶ˆæ¯å’Œå¥½æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;p&gt;åæ¶ˆæ¯æ˜¯ Cluster Autoscaler æ²¡æœ‰å†…ç½®æ­¤åŠŸèƒ½ã€‚å®ƒä¸èƒ½è¢«æ˜¾å¼çš„é…ç½®ï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰æä¾›ç›¸åº”çš„å‚æ•°ã€‚&lt;/p&gt;
&lt;p&gt;å¥½æ¶ˆæ¯æ˜¯ä½ ä»ç„¶å¯ä»¥é€šè¿‡ä¸€äº› trick çš„æ–¹å¼æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥è¿è¡Œå…·æœ‰è¶³å¤Ÿè¯·æ±‚çš„ Deployment æ¥ä¿ç•™ä¸€ä¸ªå®Œæ•´çš„ Node èŠ‚ç‚¹ã€‚ä½ å¯ä»¥å°†è¿™äº› Pod è§†ä¸ºå ä½ç¬¦ - å®ƒæ—¨åœ¨ä¿ç•™ç©ºé—´ï¼Œè€Œä¸æ˜¯ä½¿ç”¨èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦åˆ›å»ºäº†çœŸæ­£çš„ Podï¼Œå°±å¯ä»¥é©±é€å ä½ç¬¦å¹¶éƒ¨ç½²çœŸæ­£çš„ Podã€‚&lt;/p&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼Œè¿™ä¸€æ¬¡ä½ ä»ç„¶éœ€è¦ç­‰å¾… 5 åˆ†é’Ÿæ‰èƒ½å°†èŠ‚ç‚¹æ·»åŠ åˆ°é›†ç¾¤ä¸­ï¼Œä½†ä½ å¯ä»¥ç»§ç»­ä½¿ç”¨å½“å‰èŠ‚ç‚¹ã€‚åŒæ—¶ï¼Œåœ¨åå°åˆæä¾›äº†ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨è¿è¡Œæ°¸ä¹…ä¼‘çœ çš„ pod çš„éƒ¨ç½²æ¥é…ç½®è¿‡åº¦é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/kubernetes-autoscaling-strategy/overprovision_hu1258878804439501974.webp 400w,
               /blog/kubernetes-autoscaling-strategy/overprovision_hu2630056432611028329.webp 760w,
               /blog/kubernetes-autoscaling-strategy/overprovision_hu6739906567174315330.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-autoscaling-strategy/overprovision_hu1258878804439501974.webp&#34;
               width=&#34;760&#34;
               height=&#34;594&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾ä¸­ï¼Œä½ éœ€è¦ç‰¹åˆ«å…³æ³¨å†…å­˜å’Œ CPU é…ç½®ã€‚Scheduler ä¼šä½¿ç”¨è¿™äº›å€¼æ¥å†³å®šéƒ¨ç½² Pod çš„ä½ç½®ã€‚åœ¨è¿™ç§ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå®ƒä»¬ç”¨äºä¿ç•™ç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥é…ç½®ä¸€ä¸ªå¤§å‹ Podï¼Œè¯¥ Pod çš„è¯·æ±‚å¤§è‡´ä¸å¯ç”¨èŠ‚ç‚¹èµ„æºç›¸åŒ¹é…ã€‚åŒæ—¶è¦ç¡®ä¿ä½ è€ƒè™‘äº† kubeletã€æ“ä½œç³»ç»Ÿã€kube-proxy ç­‰æ¶ˆè€—çš„èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ çš„èŠ‚ç‚¹å®ä¾‹æ˜¯ 2 vCPU å’Œ 8GB å†…å­˜ï¼Œå¹¶ä¸” pod çš„å¯ç”¨ç©ºé—´æ˜¯ 1.73 vCPU å’Œ ~5.9GB å†…å­˜ï¼Œåˆ™è¯¥èŠ‚ç‚¹å°±æ— æ³•æ‰¿è½½è¿™ä¸ª Podï¼Œå› ä¸ºå®é™…çš„ Pod å¯ç”¨èµ„æºæ˜¯è¦å°äºæ‰€éœ€èµ„æºçš„ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/kubernetes-autoscaling-strategy/placeholder_hu3665393535435934706.webp 400w,
               /blog/kubernetes-autoscaling-strategy/placeholder_hu8537364412748303870.webp 760w,
               /blog/kubernetes-autoscaling-strategy/placeholder_hu14667017955254131272.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-autoscaling-strategy/placeholder_hu3665393535435934706.webp&#34;
               width=&#34;760&#34;
               height=&#34;510&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ç¡®ä¿åœ¨åˆ›å»ºçœŸæ­£çš„ Pod æ—¶èƒ½å¿«é€Ÿçš„é©±é€å ä½ Podï¼Œå¯ä»¥ä½¿ç”¨&lt;a href=&#34;https://kubernetes.io/docs/concepts/scheduling-eviction/pod-priority-preemption/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¼˜å…ˆçº§å’ŒæŠ¢å &lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Pod Priority è¡¨ç¤ºä¸€ä¸ª Pod ç›¸å¯¹äºå…¶ä»– Pod çš„é‡è¦æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å½“ä¸€ä¸ª Pod æ— æ³•è¢«è°ƒåº¦æ—¶ï¼ŒScheduler ä¼šå°è¯•æŠ¢å ï¼ˆé©±é€ï¼‰è¾ƒä½ä¼˜å…ˆçº§çš„ Pod ä»¥è°ƒåº¦â€œpendingâ€çš„ Podã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨ PodPriorityClass åœ¨é›†ç¾¤ä¸­é…ç½® Pod ä¼˜å…ˆçº§ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/kubernetes-autoscaling-strategy/podpriority_hu985762606231537983.webp 400w,
               /blog/kubernetes-autoscaling-strategy/podpriority_hu11550272257731468272.webp 760w,
               /blog/kubernetes-autoscaling-strategy/podpriority_hu10273101373213117891.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-autoscaling-strategy/podpriority_hu985762606231537983.webp&#34;
               width=&#34;760&#34;
               height=&#34;306&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç”±äº Pod çš„é»˜è®¤ä¼˜å…ˆçº§ä¸º 0ï¼Œè€Œè¿‡åº¦é…ç½®çš„ PriorityClass å€¼ä¸º -1ï¼Œå› æ­¤å½“é›†ç¾¤ç©ºé—´ä¸è¶³æ—¶ï¼Œè¿™äº› Pod å°†é¦–å…ˆè¢«é€å‡ºã€‚&lt;/p&gt;
&lt;p&gt;PriorityClass è¿˜æœ‰ä¸¤ä¸ªå¯é€‰å­—æ®µï¼šglobalDefault å’Œ descriptionã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;description å­—æ®µæ˜¯æä¾›ç»™äººé˜…è¯»çš„å…³äº PriorityClass çš„æè¿°ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;globalDefault å­—æ®µè¡¨ç¤ºè¿™ä¸ª PriorityClass çš„å€¼åº”è¯¥ç”¨äºæ²¡æœ‰ priorityClassName çš„ Podã€‚ç³»ç»Ÿä¸­åªèƒ½å­˜åœ¨ä¸€ä¸ª global Default è®¾ç½®ä¸º true çš„ PriorityClassã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ä¸ºä½ çš„ Pod æŒ‡å®šä¼˜å…ˆçº§ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/kubernetes-autoscaling-strategy/priorityClassName_hu13272520934410389965.webp 400w,
               /blog/kubernetes-autoscaling-strategy/priorityClassName_hu1023455114921697901.webp 760w,
               /blog/kubernetes-autoscaling-strategy/priorityClassName_hu8496932784148399307.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-autoscaling-strategy/priorityClassName_hu13272520934410389965.webp&#34;
               width=&#34;760&#34;
               height=&#34;629&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è®¾ç½®å®Œæˆï¼&lt;/p&gt;
&lt;p&gt;å½“é›†ç¾¤ä¸­æ²¡æœ‰è¶³å¤Ÿçš„èµ„æºæ—¶ï¼ŒPause Pod ä¼šè¢«æŠ¢å ï¼Œå¹¶ç”±æ–°çš„ Pod å–è€Œä»£ä¹‹ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äº Pause pod å˜å¾—ä¸å¯è°ƒåº¦ï¼Œå®ƒä¼šå¼ºåˆ¶ Cluster Autoscaler å‘é›†ç¾¤æ·»åŠ æ›´å¤šèŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨ï¼Œä½ å·²å‡†å¤‡å¥½è¿‡åº¦é…ç½®é›†ç¾¤ï¼Œè¯¥æ˜¯æ—¶å€™è€ƒè™‘ä¼˜åŒ–åº”ç”¨ç¨‹åºä»¥è¿›è¡Œæ‰©å±•äº†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸º-pod-é€‰æ‹©æ­£ç¡®çš„å†…å­˜å’Œ-cpu-èµ„æº&#34;&gt;ä¸º Pod é€‰æ‹©æ­£ç¡®çš„å†…å­˜å’Œ CPU èµ„æº&lt;/h3&gt;
&lt;p&gt;Cluster Autoscaler ä¼šæ ¹æ®â€œpendingâ€Pod çš„å‡ºç°æ¥åšå‡º scaling å†³ç­–ã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes Scheduler æ ¹æ® Node èŠ‚ç‚¹çš„å†…å­˜å’Œ CPU è´Ÿè½½æƒ…å†µå†³å®šå°† Pod åˆ†é…ï¼ˆæˆ–ä¸åˆ†é…ï¼‰ç»™èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œå¿…é¡»ä¸ºä½ çš„å·¥ä½œè´Ÿè½½è®¾ç½®æ­£ç¡®çš„èµ„æºä½¿ç”¨è¯·æ±‚ï¼Œå¦åˆ™æ‚¨å¯èƒ½ä¼šè¿‡æ™šï¼ˆæˆ–è¿‡æ—©ï¼‰è§¦å‘è‡ªåŠ¨ä¼¸ç¼©æœºåˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ã€‚&lt;/p&gt;
&lt;p&gt;æ‚¨å†³å®šè¦æµ‹è¯•ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå¹¶å‘ç°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨å¹³å‡è´Ÿè½½ä¸‹ï¼Œåº”ç”¨ç¨‹åºæ¶ˆè€— 512MB å†…å­˜å’Œ 0.25 vCPUã€‚&lt;/li&gt;
&lt;li&gt;åœ¨é«˜å³°æœŸï¼Œåº”ç”¨ç¨‹åºåº”æœ€å¤šæ¶ˆè€— 4GB å†…å­˜å’Œ 1 vCPUã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/kubernetes-autoscaling-strategy/app-workload_hu2911705930292236993.webp 400w,
               /blog/kubernetes-autoscaling-strategy/app-workload_hu9799159034952797453.webp 760w,
               /blog/kubernetes-autoscaling-strategy/app-workload_hu8009901331041524876.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-autoscaling-strategy/app-workload_hu2911705930292236993.webp&#34;
               width=&#34;760&#34;
               height=&#34;554&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½ çš„å®¹å™¨çš„é™åˆ¶åº”è¯¥æ˜¯ 4GB å†…å­˜å’Œ 1 ä¸ª vCPUã€‚ä½†æ˜¯ï¼Œè¯·æ±‚å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Scheduler åœ¨åˆ›å»º Pod ä¹‹å‰ä½¿ç”¨ Pod çš„å†…å­˜å’Œ CPU è¯·æ±‚æ¥é€‰æ‹©æœ€ä½³èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ä½ å¯ä»¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å°†è¯·æ±‚è®¾ç½®ä¸ºä½äºå®é™…å¹³å‡ä½¿ç”¨é‡ã€‚&lt;/li&gt;
&lt;li&gt;ä¿å®ˆä¸€ç‚¹ï¼Œåˆ†é…æ›´æ¥è¿‘é™åˆ¶çš„è¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;è®¾ç½®è¯·æ±‚ä»¥åŒ¹é…å®é™…çš„é™åˆ¶ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/kubernetes-autoscaling-strategy/cpu-requests-1_hu8805870360747264115.webp 400w,
               /blog/kubernetes-autoscaling-strategy/cpu-requests-1_hu1827051322801564580.webp 760w,
               /blog/kubernetes-autoscaling-strategy/cpu-requests-1_hu8108581366972149427.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-autoscaling-strategy/cpu-requests-1_hu8805870360747264115.webp&#34;
               width=&#34;760&#34;
               height=&#34;606&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/kubernetes-autoscaling-strategy/cpu-requests-2_hu12174254556773532035.webp 400w,
               /blog/kubernetes-autoscaling-strategy/cpu-requests-2_hu12623377688460983538.webp 760w,
               /blog/kubernetes-autoscaling-strategy/cpu-requests-2_hu3283522225067225743.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-autoscaling-strategy/cpu-requests-2_hu12174254556773532035.webp&#34;
               width=&#34;760&#34;
               height=&#34;573&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/kubernetes-autoscaling-strategy/cpu-requests-3_hu1276010751788904147.webp 400w,
               /blog/kubernetes-autoscaling-strategy/cpu-requests-3_hu160690779207651423.webp 760w,
               /blog/kubernetes-autoscaling-strategy/cpu-requests-3_hu9013814076599903639.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-autoscaling-strategy/cpu-requests-3_hu1276010751788904147.webp&#34;
               width=&#34;760&#34;
               height=&#34;604&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å®šä¹‰ä½äºå®é™…ä½¿ç”¨çš„è¯·æ±‚æ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºä½ çš„èŠ‚ç‚¹ç»å¸¸ä¼šè¢«è¿‡åº¦ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œä½ å¯ä»¥åˆ†é… 256MB çš„å†…å­˜ä½œä¸ºå†…å­˜è¯·æ±‚ã€‚Scheduler å¯ä»¥ä¸ºæ¯ä¸ªèŠ‚ç‚¹å®‰è£…ä¸¤å€çš„ Podã€‚ç„¶è€Œï¼ŒPod åœ¨å®è·µä¸­ä½¿ç”¨ä¸¤å€çš„å†…å­˜å¹¶å¼€å§‹ç«äº‰èµ„æº (CPU) å¹¶è¢«é©±é€ï¼ˆèŠ‚ç‚¹ä¸Šæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://learnk8s.io/a/22fdf4559d43e563b3b9b0472ea68969.svg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿‡åº¦ä½¿ç”¨èŠ‚ç‚¹ä¼šå¯¼è‡´è¿‡å¤šçš„é©±é€ã€æ›´å¤šçš„ kubelet å·¥ä½œå’Œå¤§é‡çš„é‡æ–°è°ƒåº¦ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœå°†è¯·æ±‚è®¾ç½®ä¸ºä¸é™åˆ¶ç›¸åŒçš„å€¼ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;p&gt;åœ¨ Kubernetes ä¸­ï¼Œè¿™é€šå¸¸è¢«ç§°ä¸º Guaranteed Quality of Service ç±»ï¼ŒæŒ‡çš„æ˜¯ pod ä¸å¤ªå¯èƒ½è¢«ç»ˆæ­¢å’Œé©±é€ã€‚Scheduler å°†ä¸ºåˆ†é…çš„èŠ‚ç‚¹ä¸Šçš„ Pod ä¿ç•™æ•´ä¸ª CPU å’Œå†…å­˜ã€‚è¯¥ç±» Pod è¿è¡Œç¨³å®šï¼Œä½†åŒæ—¶è¯¥èŠ‚ç‚¹çš„ä½¿ç”¨æ•ˆç‡å°±ä¼šæ¯”è¾ƒä½ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ çš„åº”ç”¨å¹³å‡ä½¿ç”¨ 512MB çš„å†…å­˜ï¼Œä½†ä¸ºå®ƒé¢„ç•™äº† 4GBï¼Œé‚£ä¹ˆå¤§éƒ¨åˆ†æ—¶é—´æœ‰ 3.5GB æœªä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://learnk8s.io/a/3661626fe6a72a79770b9f8e2139e015.svg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™å€¼å¾—ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æƒ³è¦æ›´å¤šçš„ç¨³å®šæ€§ï¼Œæ˜¯å€¼å¾—çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æƒ³è¦æ•ˆç‡ï¼Œä½ å¯èƒ½å¸Œæœ›é™ä½è¯·æ±‚å¹¶åœ¨è¿™äº›è¯·æ±‚ä¸é™åˆ¶ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é€šå¸¸è¢«ç§°ä¸º Burstable Quality of Service ç±»ï¼ŒæŒ‡çš„æ˜¯ Pod æ¶ˆè€—ç¨³å®šä½†å¶å°”ä¼šçªç„¶ä½¿ç”¨æ›´å¤šå†…å­˜å’Œ CPUã€‚&lt;/p&gt;
&lt;p&gt;å½“ä½ çš„è¯·æ±‚ä¸åº”ç”¨çš„å®é™…ä½¿ç”¨ç›¸åŒ¹é…æ—¶ï¼ŒScheduler å°†é«˜æ•ˆåœ°å°†ä½ çš„ Pod æ‰“åŒ…åˆ°ä½ çš„èŠ‚ç‚¹ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰æ—¶ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½éœ€è¦æ›´å¤šå†…å­˜æˆ– CPUã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœ Node ä¸­æœ‰èµ„æºï¼Œåº”ç”¨ç¨‹åºå°†ä¼šåœ¨è¾¾åˆ°æœ€ä½æ¶ˆè€—ä¹‹å‰ä½¿ç”¨å®ƒä»¬ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœ Node ä¸­èµ„æºä¸è¶³ï¼ŒPod å°†ç«äº‰èµ„æºï¼ˆCPUï¼‰ï¼Œkubelet å¯èƒ½ä¼šå°è¯•é©±é€ Podï¼ˆå†…å­˜ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ­¤æ—¶ï¼Œä½ åº”è¯¥ä½¿ç”¨ Guaranteed Quality of Service è¿˜æ˜¯ Burstable Quality of Serviceï¼Ÿ&lt;/p&gt;
&lt;p&gt;è¿™å–å†³äºå¦‚ä¸‹ä¸¤ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å½“ä½ å¸Œæœ›æœ€å°åŒ– Pod çš„é‡æ–°è°ƒåº¦å’Œé©±é€æ—¶ï¼Œè¯·ä½¿ç”¨ Guaranteed Quality of Serviceï¼ˆè¯·æ±‚ç­‰äºé™åˆ¶ï¼‰ã€‚ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯ç”¨äºæ•°æ®åº“çš„ Podã€‚&lt;/li&gt;
&lt;li&gt;å½“ä½ æƒ³è¦ä¼˜åŒ–é›†ç¾¤å¹¶æ˜æ™ºåœ°ä½¿ç”¨èµ„æºæ—¶ï¼Œè¯·ä½¿ç”¨ Burstable Quality of Serviceï¼ˆè¯·æ±‚åŒ¹é…å®é™…å¹³å‡ä½¿ç”¨æƒ…å†µï¼‰ã€‚å¦‚æœæ‚¨æœ‰ Web åº”ç”¨ç¨‹åºæˆ– REST APIï¼Œæ‚¨å¯èƒ½å¸Œæœ›ä½¿ç”¨ Burstable Quality of Serviceã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é‚£å¦‚ä½•é€‰æ‹©æ­£ç¡®çš„è¯·æ±‚å’Œé™åˆ¶å€¼ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä½ åº”è¯¥åˆ†æåº”ç”¨ç¨‹åºå¹¶æµ‹é‡ç©ºé—²ã€è´Ÿè½½å’Œå³°å€¼æ—¶çš„å†…å­˜å’Œ CPU æ¶ˆè€—ã€‚æ›´ç›´æ¥çš„ç­–ç•¥åŒ…æ‹¬éƒ¨ç½² Vertical Pod Autoscaler å¹¶ç­‰å¾…å®ƒå»ºè®®æ­£ç¡®çš„å€¼ã€‚&lt;/p&gt;
&lt;p&gt;Vertical Pod Autoscaler ä» Pod æ”¶é›†æ•°æ®å¹¶åº”ç”¨å›å½’æ¨¡å‹æ¥æ¨æ–­è¯·æ±‚å’Œé™åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://learnk8s.io/setting-cpu-memory-limits-requests&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ‚¨å¯ä»¥åœ¨æœ¬æ–‡ä¸­äº†è§£æœ‰å…³å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œçš„æ›´å¤šä¿¡æ¯&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å…³äºé›†ç¾¤çš„ç¼©å®¹&#34;&gt;å…³äºé›†ç¾¤çš„ç¼©å®¹&lt;/h3&gt;
&lt;p&gt;æ¯ 10 ç§’ï¼Œåªæœ‰å½“è¯·æ±‚åˆ©ç”¨ç‡ä½äº 50% æ—¶ï¼ŒCluster Autoscaler æ‰ä¼šå†³å®šåˆ é™¤èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;æ¢å¥è¯è¯´ï¼Œå¯¹äºåŒä¸€èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰ Podï¼Œå®ƒä¼šæ±‡æ€» CPU å’Œå†…å­˜è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœå®ƒä»¬ä½äºèŠ‚ç‚¹å®¹é‡çš„ä¸€åŠï¼ŒCluster Autoscaler å°†è€ƒè™‘å½“å‰èŠ‚ç‚¹è¿›è¡Œç¼©å‡ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒCluster Autoscaler ä¸è€ƒè™‘å®é™…çš„ CPU å’Œå†…å­˜ä½¿ç”¨æˆ–é™åˆ¶ï¼Œè€ŒåªæŸ¥çœ‹èµ„æºè¯·æ±‚ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨ç§»é™¤èŠ‚ç‚¹ä¹‹å‰ï¼ŒCluster Autoscaler æ‰§è¡Œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Pod æ£€æŸ¥ä»¥ç¡®ä¿ Pod å¯ä»¥ç§»åŠ¨åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;Node èŠ‚ç‚¹æ£€æŸ¥ä»¥é˜²æ­¢èŠ‚ç‚¹è¿‡æ—©è¢«ç ´åã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœæ£€æŸ¥é€šè¿‡ï¼ŒCluster Autoscaler å°†ä»é›†ç¾¤ä¸­åˆ é™¤èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸ºä»€ä¹ˆä¸åŸºäºå†…å­˜æˆ–-cpu-è¿›è¡Œè‡ªåŠ¨ä¼¸ç¼©&#34;&gt;ä¸ºä»€ä¹ˆä¸åŸºäºå†…å­˜æˆ– CPU è¿›è¡Œè‡ªåŠ¨ä¼¸ç¼©&lt;/h3&gt;
&lt;p&gt;åœ¨æ‰©ç¼©å®¹æ—¶ï¼ŒåŸºäº CPU æˆ–å†…å­˜çš„ Cluster Autoscaler ä¸å…³å¿ƒ podã€‚&lt;/p&gt;
&lt;p&gt;æƒ³è±¡ä¸€ä¸‹ï¼Œæœ‰ä¸€ä¸ªåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œå¹¶è®¾ç½® Autoscaler æ¥æ·»åŠ ä¸€ä¸ªæ–°èŠ‚ç‚¹å½“ CPU ä½¿ç”¨ç‡è¾¾åˆ°æ€»å®¹é‡çš„ 80%ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åä½ å†³å®šåˆ›å»ºä¸€ä¸ªå…·æœ‰ 3 ä¸ªå‰¯æœ¬çš„ Deploymentã€‚ä¸‰ä¸ª Pod çš„æ€»èµ„æºä½¿ç”¨ç‡è¾¾åˆ°äº† CPU çš„ 85%ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªæ–°çš„ Node èŠ‚ç‚¹è¢«æä¾›ã€‚å¦‚æœä½ ä¸éœ€è¦æ›´å¤š Pod æ€ä¹ˆåŠï¼Ÿä½ æœ‰ä¸€ä¸ªå®Œæ•´èŠ‚ç‚¹å¤„äºç©ºé—²çš„çŠ¶æ€â€”â€”è¿™ä¸æ˜¯å¾ˆå¥½ã€‚è¿™ç§ä½¿ç”¨ Autoscaler çš„æ–¹å¼æ˜¯ä¸é¼“åŠ±çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;åœ¨ Kubernetes ä¸­å®šä¹‰å’Œå®æ–½æˆåŠŸçš„æ‰©ç¼©å®¹ç­–ç•¥éœ€è¦æ‚¨æŒæ¡å‡ ä¸ªä¸»é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç†Ÿæ‚‰ Kubernetes èŠ‚ç‚¹ä¸­çš„å¯åˆ†é…èµ„æºã€‚&lt;/li&gt;
&lt;li&gt;å¾®è°ƒ Metrics Serverã€Horizontal Pod Autoscaler å’Œ Cluster Autoscalers çš„åˆ·æ–°é—´éš”ã€‚&lt;/li&gt;
&lt;li&gt;è§„åˆ’é›†ç¾¤å’ŒèŠ‚ç‚¹å®ä¾‹å¤§å°ã€‚&lt;/li&gt;
&lt;li&gt;åšå¥½å®¹å™¨é•œåƒçš„ç¼“å­˜ã€‚&lt;/li&gt;
&lt;li&gt;åšå¥½åº”ç”¨ç¨‹åºåŸºå‡†æµ‹è¯•å’Œåˆ†æã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½†æ˜¯ä¸Šé¢è¿™äº›è¿˜ä¸å¤Ÿï¼Œä½ è¿˜éœ€è¦ä½¿ç”¨é€‚å½“çš„ç›‘æ§å·¥å…·ï¼Œåå¤æµ‹è¯•æ‚¨çš„æ‰©ç¼©å®¹ç­–ç•¥å¹¶è°ƒæ•´é›†ç¾¤çš„èŠ‚ç‚¹åˆ›å»ºé€Ÿåº¦å’Œæˆæœ¬ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Pinterest å¦‚ä½•æœ‰æŠŠæ¡åœ°æ‰©å±• Kubernetes</title>
      <link>https://cloudnativecn.com/blog/scaling-kubernetes-with-assurance-at-pinterest/</link>
      <pubDate>Sun, 13 Jun 2021 18:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/scaling-kubernetes-with-assurance-at-pinterest/</guid>
      <description>&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;è‡ªä¸Šæ¬¡æˆ‘ä»¬åˆ†äº« &lt;a href=&#34;https://medium.com/pinterest-engineering/building-a-kubernetes-platform-at-pinterest-fb3d9571c948&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pinterest çš„ Kubernetes ä¹‹æ—…&lt;/a&gt;å·²è¿‡å»ä¸€å¹´æœ‰å¤šã€‚ä»é‚£æ—¶èµ·ï¼Œæˆ‘ä»¬å·²äº¤ä»˜äº†è®¸å¤šåŠŸèƒ½ä»¥ä¿ƒè¿›å®¢æˆ·é‡‡ç”¨ï¼Œç¡®ä¿å¯ç”¨æ€§å’Œå¯ä¼¸ç¼©æ€§ï¼Œå¹¶å»ºç«‹è¿ç»´ç»éªŒå’Œæœ€ä½³å®è·µã€‚&lt;/p&gt;
&lt;p&gt;æ€»ä½“æ¥çœ‹ï¼ŒKubernetes å¹³å°ç”¨æˆ·éƒ½ç»™äºˆäº†ç§¯æçš„åé¦ˆã€‚æ ¹æ®æˆ‘ä»¬çš„ç”¨æˆ·è°ƒæŸ¥ï¼Œæˆ‘ä»¬çš„ç”¨æˆ·åˆ†äº«çš„å‰ä¸‰å¤§å¥½å¤„æœ‰ï¼Œå‡å°‘äº†ç®¡ç†è®¡ç®—èµ„æºçš„è´Ÿæ‹…ï¼Œæ›´å¥½çš„èµ„æºå’Œæ•…éšœéš”ç¦»ï¼Œä»¥åŠæ›´çµæ´»çš„å®¹é‡ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;åˆ° 2020 å¹´åº•ï¼Œæˆ‘ä»¬çš„ Kubernetes é›†ç¾¤ä¸Šå·²ç¼–æ’äº† 35K+Podï¼Œè¿è¡Œäº† 2500 + ä¸ªèŠ‚ç‚¹ã€‚è¿™æ”¯æ’‘äº†æˆ‘ä»¬ Pinterest çš„ç»å¤§éƒ¨åˆ†ä¸šåŠ¡ï¼Œå¹¶ä¸”æœ‰æœºå¢é•¿ä»å¦‚ç«ç®­èˆ¬è¿…é€Ÿã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç®€å•æ¦‚æ‹¬-2020-å¹´&#34;&gt;ç®€å•æ¦‚æ‹¬ 2020 å¹´&lt;/h3&gt;
&lt;p&gt;éšç€ç”¨æˆ·é‡‡ç”¨ç‡å¢é•¿ï¼Œå·¥ä½œè´Ÿè½½çš„å¤šæ ·æ€§å’Œæ•°é‡ä¹Ÿä¸æ–­å¢åŠ ã€‚è¿™è¦æ±‚ Kubernetes å¹³å°éœ€è¦æ›´å…·å¯æ‰©å±•æ€§æ‰èƒ½è·Ÿä¸Šå·¥ä½œè´Ÿè½½ç®¡ç†ï¼ŒPod è°ƒåº¦ä»¥åŠèŠ‚ç‚¹åˆ†é…ä¸ŠæŒç»­å¢é•¿çš„è´Ÿè½½ã€‚éšç€è¶Šæ¥è¶Šå¤šçš„å…³é”®ä¸šåŠ¡ç™»ä¸Š Kubernetesï¼Œå¯¹å¹³å°å¯é æ€§çš„æœŸæœ›è‡ªç„¶è€Œç„¶åœ°æå‡åˆ°äº†ä¸€ä¸ªæ–°çš„æ°´å¹³ã€‚&lt;/p&gt;
&lt;p&gt;å¹³å°èŒƒå›´å†…çš„ä¸­æ–­ç¡®å®å‘ç”Ÿè¿‡ã€‚2020 å¹´åˆï¼Œæˆ‘ä»¬çš„ä¸€ä¸ªé›†ç¾¤ç”±äº Pod åˆ›å»ºæ•°çŒ›å¢ï¼ˆæ¯”è®¡åˆ’å®¹é‡é«˜å‡º 3 å€ï¼‰ï¼Œå¯¼è‡´äº†é›†ç¾¤çš„ autoscaler ä¸€ä¸‹å°±å¯åŠ¨äº† 900 ä¸ªèŠ‚ç‚¹ã€‚kube-apiserver ç»„ä»¶å¼€å§‹å‡ºç°å»¶è¿Ÿå³°å€¼å’Œé”™è¯¯ç‡å¢åŠ ï¼Œç„¶åç”±äºèµ„æºçš„é™åˆ¶å¼•å‘äº† OOMKilledã€‚æ¥è‡ª Kubelet çš„éç»‘å®šé‡è¯•å¯¼è‡´äº† kube-apiserver è´Ÿè½½è·ƒå‡äº† 7 å€ã€‚çˆ†å‘æ€§çš„å†™å…¥æ“ä½œä½¿ etcd è¾¾åˆ°å…¶æ€»æ•°æ®é‡å¤§å°é™åˆ¶å¹¶å¼€å§‹æ‹’ç»æ‰€æœ‰çš„å†™å…¥è¯·æ±‚ï¼Œäºæ˜¯å¹³å°åœ¨å·¥ä½œè´Ÿè½½ç®¡ç†æ–¹é¢ä¸¢å¤±äº†å¯ç”¨æ€§ã€‚ä¸ºäº†ç¼“è§£è¿™ä¸€äº‹æ•…ï¼Œæˆ‘ä»¬ä¸å¾—ä¸åœ¨ etcd ä¸Šæ‰§è¡Œä¸€äº›æ“ä½œï¼Œå¦‚æ‰§è¡Œç‰ˆæœ¬å‹ç¼©ï¼Œæ•´ç†è¿‡å¤šç¢ç‰‡çš„ç©ºé—´ï¼Œä»¥åŠç¦ç”¨å‘Šè­¦æ¥æ¢å¤å®ƒï¼ˆå‚è€ƒ &lt;a href=&#34;https://etcd.io/docs/v3.4/op-guide/maintenance/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Maintenance|etcd&lt;/a&gt; ç« èŠ‚ï¼‰ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ä¸å¾—ä¸æš‚æ—¶æ‰©å¤§æ‰¿è½½ kube-apiserver å’Œ etcd çš„ Kubernetes ä¸»èŠ‚ç‚¹ï¼Œä»¥å‡å°‘èµ„æºé™åˆ¶å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-000_hu8172732425553456385.webp 400w,
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-000_hu14633511765479066145.webp 760w,
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-000_hu10411699133727424384.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-000_hu8172732425553456385.webp&#34;
               width=&#34;576&#34;
               height=&#34;231&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;2020 å¹´æ™šäº›æ—¶å€™ï¼Œä¸€ä¸ªåŸºç¡€ç»„ä»¶åœ¨ä¸ kube-apiserver é›†æˆæ—¶å‡ºç° bugï¼Œå¯¼è‡´å‘ kube-apiserver å‘èµ·å¤§é‡è¯·æ±‚ï¼ˆè·å–æ‰€æœ‰ Pod è·ŸèŠ‚ç‚¹ï¼‰ã€‚è¿™å¼•èµ· Kubernetes ä¸»èŠ‚ç‚¹èµ„æºä½¿ç”¨ç‡æ¿€å¢ï¼Œç„¶åè§¦å‘ OOMKilledã€‚å¹¸è¿çš„æ˜¯è¿™ä¸ªæœ‰é—®é¢˜çš„ç»„ä»¶å¾ˆå¿«è¢«å‘ç°å¹¶å›é€€ã€‚ä½†æ­¤æ¬¡äº‹ä»¶ä¸­ï¼Œå¹³å°çš„æ€§èƒ½ä¸‹é™äº†ï¼ŒåŒ…æ‹¬å·¥ä½œè´Ÿè½½æ‰§è¡Œå»¶è¿Ÿå’Œè¯·æ±‚çŠ¶æ€è¿‡æœŸã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-001_hu16459343773417012511.webp 400w,
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-001_hu13944018884449030531.webp 760w,
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-001_hu197175090648042706.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-001_hu16459343773417012511.webp&#34;
               width=&#34;576&#34;
               height=&#34;204&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;ä¸ºæ‰©å±•è§„æ¨¡åšå¥½å‡†å¤‡&#34;&gt;ä¸ºæ‰©å±•è§„æ¨¡åšå¥½å‡†å¤‡&lt;/h2&gt;
&lt;p&gt;åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸æ–­åæ€æˆ‘ä»¬çš„å¹³å°æ²»ç†ã€å¼¹æ€§å’Œå¯æ“ä½œæ€§é—®é¢˜ï¼Œå°¤å…¶æ˜¯å½“äº‹ä»¶å‘ç”Ÿå¹¶é‡åˆ›æˆ‘ä»¬æœ€è–„å¼±çš„åœ°æ–¹æ—¶ã€‚åœ¨ä¸€ä¸ªå·¥ç¨‹èµ„æºæœ‰é™çš„çµæ´»å›¢é˜Ÿä¸­ï¼Œæˆ‘ä»¬å¿…é¡»æ·±å…¥æŒ–æ˜ï¼Œæ‰¾å‡ºæ ¹æœ¬åŸå› ï¼Œå¹¶æ ¹æ®å›æŠ¥ä¸æˆæœ¬ç¡®å®šè§£å†³æ–¹æ¡ˆçš„ä¼˜å…ˆçº§ã€‚æˆ‘ä»¬å¤„ç†å¤æ‚çš„ Kubernetes ç”Ÿæ€ç³»ç»Ÿçš„ç­–ç•¥æ˜¯å°½é‡å‡å°‘ä¸ç¤¾åŒºæä¾›çš„å·®å¼‚ï¼Œå¹¶å›é¦ˆç»™ç¤¾åŒºï¼Œä½†ç»ä¸æ’é™¤è‡ªå·±ç¼–å†™å†…éƒ¨ç»„ä»¶çš„å¯èƒ½æ€§ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-002_hu8565871551694998345.webp 400w,
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-002_hu16075484642865479377.webp 760w,
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-002_hu9798828371088065589.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-002_hu8565871551694998345.webp&#34;
               width=&#34;576&#34;
               height=&#34;258&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;æ²»ç†&#34;&gt;æ²»ç†&lt;/h2&gt;
&lt;h3 id=&#34;å¼ºåˆ¶èµ„æºé…é¢&#34;&gt;å¼ºåˆ¶èµ„æºé…é¢&lt;/h3&gt;
&lt;p&gt;Kubernetes å·²æä¾›&lt;a href=&#34;https://kubernetes.io/docs/concepts/policy/resource-quotas/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;èµ„æºé…é¢&lt;/a&gt;ç®¡ç†ï¼Œä»¥ç¡®ä¿æ²¡æœ‰ä»»ä½•å‘½åç©ºé—´å¯ä»¥è¯·æ±‚æˆ–å ç”¨å¤§éƒ¨åˆ†ç»´åº¦çš„æœªè¢«å ç”¨çš„èµ„æºï¼Œä¾‹å¦‚ Pod ä¸ªæ•°ï¼ŒCPUï¼Œå†…å­˜ç­‰ç­‰ã€‚åœ¨ä¹‹å‰çš„äº‹æ•…ä¸­æåŠåˆ°ï¼Œåœ¨å•ä¸ªå‘½åç©ºé—´ä¸­åˆ›å»ºå¤§é‡ Pod å¯èƒ½ä½¿ kube-apiserver è¶…è´Ÿè·å¹¶å¯¼è‡´çº§è”æ•…éšœã€‚ä¸ºäº†ç¡®ä¿ç¨³å®šæ€§ï¼Œåœ¨æ¯ä¸ªå‘½åç©ºé—´ä¸­å¯¹èµ„æºçš„ä½¿ç”¨è¿›è¡Œçº¦æŸæ˜¯å…³é”®ã€‚&lt;/p&gt;
&lt;p&gt;å¼ºåˆ¶åœ¨æ¯ä¸ªå‘½åç©ºé—´ä¸­æ‰§è¡Œèµ„æºé…é¢é¢ä¸´çš„ä¸€ä¸ªæŒ‘æˆ˜æ˜¯æ‰€æœ‰ Pod éƒ½éœ€è¦æ˜¾å¼åœ°æŒ‡å®š&lt;a href=&#34;https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#requests-and-limits&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;èµ„æºè¯·æ±‚ä¸é™åˆ¶&lt;/a&gt;ã€‚åœ¨ Pinterest çš„ Kubernetes å¹³å°ä¸Šï¼Œä¸åŒå‘½åç©ºé—´çš„å·¥ä½œè´Ÿè½½æ˜¯ç”±ä¸åŒé¡¹ç›®çš„ä¸åŒå›¢é˜Ÿæ‰€æ‹¥æœ‰ï¼Œå¹³å°ç”¨æˆ·ä½¿ç”¨ Pinterest CRD æ¥é…ç½®ä»–ä»¬çš„å·¥ä½œè´Ÿè½½ã€‚æˆ‘ä»¬é€šè¿‡åœ¨ CRD çš„è½¬æ¢å±‚ç»™æ‰€æœ‰ Pod å’Œå®¹å™¨éƒ½æ·»åŠ ä¸Šé»˜è®¤çš„èµ„æºè¯·æ±‚ä¸é™åˆ¶ï¼Œé¢å¤–çš„ï¼Œæˆ‘ä»¬åœ¨ CRD æ ¡éªŒå±‚å°±æ‹’ç»ä»»ä½•æ²¡æœ‰é…ç½®èµ„æºè¯·æ±‚ä¸é™åˆ¶å®šä¹‰çš„ Podã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å…‹æœçš„å¦ä¸€ä¸ªæŒ‘æˆ˜æ˜¯ç®€åŒ–å›¢é˜Ÿä¸ç»„ç»‡çš„é…é¢ç®¡ç†ã€‚ä¸ºäº†å®‰å…¨åœ°å¯ç”¨èµ„æºé…é¢ï¼Œæˆ‘ä»¬é€šè¿‡ç ”ç©¶å†å²èµ„æºä½¿ç”¨æƒ…å†µï¼Œåœ¨å³°å€¼çš„åŸºç¡€ä¸Šå¢åŠ äº† 20% çš„ç¼“å†²ï¼Œå°†å…¶è®¾å®šä¸ºæ¯ä¸ªé¡¹ç›®çš„èµ„æºé…é¢åˆå§‹å€¼ã€‚åŒæ—¶æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå®šæ—¶ä»»åŠ¡å»ç›‘æ§é…é¢ä½¿ç”¨æƒ…å†µå¹¶åœ¨é¡¹ç›®ä½¿ç”¨è¾¾åˆ°ä¸€å®šé™åˆ¶æ—¶å‘è¯¥é¡¹ç›®å›¢é˜Ÿå‘é€è­¦æŠ¥ã€‚è¯¥æªæ–½é¼“åŠ±é¡¹ç›®æ‰€æœ‰è€…æ›´å¥½åœ°è¿›è¡Œèƒ½åŠ›è§„åˆ’ï¼Œå¹¶æå‡ºèµ„æºé…é¢å˜æ›´éœ€æ±‚ã€‚èµ„æºé…é¢å˜æ›´ä¼šåœ¨äººå·¥å®¡æŸ¥é€šè¿‡åè‡ªåŠ¨å®Œæˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;å®¢æˆ·ç«¯è®¿é—®&#34;&gt;å®¢æˆ·ç«¯è®¿é—®&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å¼ºåˆ¶æ‰€æœ‰ KubeAPI å®¢æˆ·ç«¯éµä» Kubernetes å·²æä¾›çš„æœ€ä½³å®è·µï¼š&lt;/p&gt;
&lt;h4 id=&#34;controller-framework&#34;&gt;Controller Framework&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/operator-framework&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Controller framework&lt;/a&gt; åˆ©ç”¨ &lt;a href=&#34;https://godoc.org/k8s.io/client-go/informers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;informer-reflector-cache æ¶æ„&lt;/a&gt;æä¾›äº†ä¸€ä¸ªå¯å…±äº«çš„ç¼“å­˜ä»¥ä¼˜åŒ–è¯»è¯·æ±‚ã€‚ &lt;strong&gt;Informers&lt;/strong&gt; ç”¨ä»¥ä» kube-apiserver è·å–å¹¶ç›‘è§†æ„Ÿå…´è¶£çš„å¯¹è±¡ã€‚&lt;strong&gt;Reflector&lt;/strong&gt; åæ˜ å¯¹è±¡å¯¹åº•å±‚ &lt;strong&gt;ç¼“å­˜&lt;/strong&gt;çš„ä¿®æ”¹å¹¶å°†ç›‘è§†åˆ°çš„äº‹ä»¶ä¼ æ’­ç»™äº‹ä»¶å¤„ç†å™¨ï¼ˆeventHandlersï¼‰ã€‚åœ¨åŒä¸ªæ§åˆ¶å™¨ä¸­çš„å¤šä¸ªç»„ä»¶å¯ä»¥ä» Informer æ³¨å†Œ OnCreateï¼ŒOnUpdateï¼ŒOnDelete äº‹ä»¶çš„å¤„ç†å™¨ï¼Œå¹¶ç›´æ¥ä»ç¼“å­˜ä¸­è·å–å¯¹è±¡è€Œä¸æ˜¯ä» kube-apiserverã€‚å› æ­¤ï¼Œå®ƒå‡å°‘äº†æ„å»ºä¸å¿…è¦çš„å¤šä½™çš„è¯·æ±‚è°ƒç”¨çš„æœºä¼šã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-controller-framework&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;controller-framework&#34; srcset=&#34;
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-003_hu11209230906671133169.webp 400w,
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-003_hu4990627924860330033.webp 760w,
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-003_hu15588581337499129085.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-003_hu11209230906671133169.webp&#34;
               width=&#34;576&#34;
               height=&#34;758&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      controller-framework
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h4 id=&#34;é™æµ&#34;&gt;é™æµ&lt;/h4&gt;
&lt;p&gt;Kubernetes API å®¢æˆ·ç«¯é€šå¸¸ç”±ä¸åŒçš„å®¢æˆ·ç«¯å…±äº«ï¼ŒAPI è°ƒç”¨ä¹Ÿé€šå¸¸æ˜¯ç”±ä¸åŒçš„çº¿ç¨‹å‘èµ·ã€‚Kubernetes é€šè¿‡å°†å…¶ API å®¢æˆ·ç«¯ä¸å¯é…ç½® QPS å’Œçªå‘çš„&lt;a href=&#34;https://en.wikipedia.org/wiki/Token_bucket&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŸºäºä»¤ç‰Œæ¡¶çš„é™æµå™¨&lt;/a&gt;ç»“åˆã€‚è¶…è¿‡é˜ˆå€¼çš„ API è¯·æ±‚å°†è¢«é™åˆ¶ï¼Œæ‰€ä»¥å•ä¸ªæ§åˆ¶å™¨å°†ä¸ä¼šé˜»å¡æ•´ä¸ª kube-apiserver çš„å¸¦å®½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¯å…±äº«ç¼“å­˜&#34;&gt;å¯å…±äº«ç¼“å­˜&lt;/h3&gt;
&lt;p&gt;é™¤äº†æ§åˆ¶å™¨æ¡†æ¶é™„å¸¦çš„ kube-apiserver å†…ç½®ç¼“å­˜å¤–ï¼Œæˆ‘ä»¬è¿˜åœ¨å¹³å° API å±‚æ·»åŠ äº†åŸºäºå†™ç¼“å­˜çš„ informerã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢ä¸å¿…è¦çš„è¯»è°ƒç”¨å¯¹ kube-apiserver çš„ç¡¬å†²å‡»ã€‚æœåŠ¡ç«¯çš„ç¼“å­˜é‡ç”¨ä¹Ÿé¿å…äº†åº”ç”¨ä»£ç ä¸­çš„åšå®¢æˆ·ç«¯ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äº&lt;strong&gt;æ¥è‡ªåº”ç”¨ç¨‹åº&lt;/strong&gt;åˆ° kube-apiserver çš„è®¿é—®ï¼Œæˆ‘ä»¬å¼ºåˆ¶è¦æ±‚æ‰€æœ‰è¯·æ±‚é€šè¿‡å¹³å° APIï¼Œä»¥åˆ©ç”¨å…±äº«ç¼“å­˜ï¼Œå¹¶ä¸ºè®¿é—®æ§åˆ¶å’Œæµæ§æŒ‡å®šå®‰å…¨èº«ä»½ã€‚å¯¹äº&lt;strong&gt;æ¥è‡ªå·¥ä½œè´Ÿè½½æ§åˆ¶å™¨&lt;/strong&gt;å¯¹ kube-apiserver çš„è®¿é—®ï¼Œæˆ‘ä»¬å¼ºåˆ¶æ‰€æœ‰æ§åˆ¶å™¨å®ç°éƒ½è¦åŸºäºæœ‰æµæ§çš„æ§åˆ¶å™¨æ¡†æ¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¼¹æ€§æ¢å¤èƒ½åŠ›&#34;&gt;å¼¹æ€§æ¢å¤èƒ½åŠ›&lt;/h2&gt;
&lt;h3 id=&#34;å¢å¼ºåŠ å›º-kubelet&#34;&gt;å¢å¼ºåŠ å›º kubelet&lt;/h3&gt;
&lt;p&gt;Kubernetes æ§åˆ¶å¹³é¢è¿›å…¥çº§è”æ•…éšœçš„ä¸€ä¸ªå…³é”®åŸå› æ˜¯ï¼Œä¼ ç»Ÿçš„åå°„å™¨å®ç°åœ¨å¤„ç†é”™è¯¯æ—¶è¿›è¡Œäº†&lt;strong&gt;æ— é™æ¬¡&lt;/strong&gt;çš„é‡è¯•ã€‚è¿™ç§ä¸å®Œå–„å¯èƒ½ä¼šè¢«æ”¾å¤§ï¼Œç‰¹åˆ«æ˜¯å½“ apiserver è¢« OOMKilled æ—¶ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´æ•´ä¸ªé›†ç¾¤åå°„å™¨çš„åŒæ­¥ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¸ç¤¾åŒºè¿›è¡Œäº†éå¸¸å¯†åˆ‡çš„åˆä½œï¼Œé€šè¿‡æŠ¥å‘Š &lt;a href=&#34;https://github.com/kubernetes/kubernetes/issues/87794&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;issues&lt;/a&gt;ï¼Œè®¨è®ºè§£å†³æ–¹æ¡ˆï¼Œæœ€åè®© PR (&lt;a href=&#34;https://github.com/kubernetes/kubernetes/pull/87829&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;1&lt;/a&gt;, &lt;a href=&#34;https://github.com/kubernetes/kubernetes/pull/87795&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2&lt;/a&gt;) é€šè¿‡å®¡æŸ¥å¹¶åˆå¹¶ã€‚æˆ‘ä»¬çš„æƒ³æ³•æ˜¯åœ¨ jitter reflector çš„ ListWatch é‡è¯•é€»è¾‘ä¸­åŠ å…¥æŒ‡æ•°åé€€ï¼Œè¿™æ · kubelet å’Œå…¶ä»–æ§åˆ¶å™¨å°±ä¸ä¼šåœ¨ kube-apiserver è¿‡è½½å’Œè¯·æ±‚å¤±è´¥æ—¶è¯•å›¾åå¤è¯·æ±‚ kube-apiserverã€‚è¿™ç§å¼¹æ€§æ”¹è¿›ä¸€èˆ¬æƒ…å†µæ˜¯æœ‰ç”¨çš„ï¼Œä½†æˆ‘ä»¬å‘ç°éšç€ Kubernetes é›†ç¾¤ä¸­èŠ‚ç‚¹å’Œ pods æ•°é‡çš„å¢åŠ ï¼Œå®ƒåœ¨ kubelet æ–¹é¢è‡³å…³é‡è¦ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¼˜åŒ–è°ƒæ•´å¹¶å‘è¯·æ±‚&#34;&gt;ä¼˜åŒ–è°ƒæ•´å¹¶å‘è¯·æ±‚&lt;/h3&gt;
&lt;p&gt;å½“æˆ‘ä»¬ç®¡ç†çš„èŠ‚ç‚¹è¶Šå¤šï¼Œåˆ›å»ºå’Œé”€æ¯çš„å·¥ä½œè´Ÿè½½è¶Šå¿«ï¼ŒæœåŠ¡éœ€è¦å¤„ç†çš„ API è¯·æ±‚ QPS å°±è¶Šé«˜ã€‚æˆ‘ä»¬é¦–å…ˆæ ¹æ®é¢„ä¼°çš„å·¥ä½œè´Ÿè½½ï¼Œå¢åŠ äº†å¯å˜å’Œä¸å¯å˜æ“ä½œçš„æœ€å¤§å¹¶å‘ API è°ƒç”¨è®¾ç½®ã€‚è¿™ä¸¤ä¸ªè®¾ç½®å°†å¼ºåˆ¶è¦æ±‚å¤„ç†ä¸­çš„ API è°ƒç”¨é‡ä¸è¶…è¿‡é…ç½®çš„æ•°é‡ï¼Œä»è€Œä½¿ kube-apiserver çš„ CPU å’Œå†…å­˜æ¶ˆè€—ä¿æŒåœ¨ä¸€å®šçš„é˜ˆå€¼å†…ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Kubernetes ä¸­çš„ API è¯·æ±‚å¤„ç†é“¾ä¸­ï¼Œæ¯ä¸ªè¯·æ±‚ä¸€å¼€å§‹å°±å°†ç»è¿‡ä¸€ç»„è¿‡æ»¤å™¨ã€‚è¿‡æ»¤å™¨é“¾æ˜¯å¼ºåˆ¶æœ€å¤§æ‰§è¡Œä¸­ API è°ƒç”¨æ•°çš„åœ°æ–¹ã€‚å¯¹äºè¶…è¿‡é…ç½®é˜ˆå€¼çš„ API è°ƒç”¨ï¼Œâ€œtoo many requestsâ€ï¼ˆHTTP 429ï¼‰å“åº”å°†è¢«è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä»¥è§¦å‘é€‚å½“çš„é‡è¯•ã€‚æœªæ¥çš„å·¥ä½œï¼Œæˆ‘ä»¬è®¡åˆ’å¯¹ &lt;a href=&#34;https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#eventratelimit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;EventRateLimit ç‰¹æ€§&lt;/a&gt;è¿›è¡Œæ›´å¤šçš„ç ”ç©¶ï¼Œè¿›è¡Œæ›´ç²¾ç»†çš„å‡†å…¥æ§åˆ¶ï¼Œæä¾›æ›´å¥½çš„æœåŠ¡è´¨é‡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¼“å­˜æ›´å¤šå†å²æ•°æ®&#34;&gt;ç¼“å­˜æ›´å¤šå†å²æ•°æ®&lt;/h3&gt;
&lt;p&gt;Watch ç¼“å­˜æ˜¯ kube-apiserver å†…éƒ¨çš„ä¸€ç§æœºåˆ¶ï¼Œå®ƒå°†æ¯ç§ç±»å‹çš„èµ„æºçš„è¿‡å»äº‹ä»¶ç¼“å­˜åˆ°ç¯ç¼“å†²åŒºä¸­ï¼Œä»¥å°½æœ€å¤§åŠªåŠ›å¤„ç†æ¥è‡ªç‰¹å®šç‰ˆæœ¬çš„ç›‘è§†è°ƒç”¨ã€‚ç¼“å­˜è¶Šå¤§ï¼ŒæœåŠ¡å™¨ä¸­å¯ä¿ç•™çš„äº‹ä»¶å°±è¶Šå¤šï¼Œå¹¶ä¸”æ›´æœ‰å¯èƒ½åœ¨è¿æ¥ä¸­æ–­æ—¶æ— ç¼åœ°ä¸ºå®¢æˆ·ç«¯æä¾›äº‹ä»¶æµã€‚é‰´äºè¿™ä¸€äº‹å®ï¼Œæˆ‘ä»¬è¿˜æ”¹è¿›äº† kube-apiserver çš„ç›®æ ‡ RAM å¤§å°ï¼Œè¯¥å†…å­˜æœ€ç»ˆæ ¹æ®å¯å‘å¼ä¼ è¾“åˆ°ç›‘è§†ç¼“å­˜å®¹é‡ï¼Œç”¨äºæä¾›æ›´å¼ºå¤§çš„äº‹ä»¶æµã€‚Kube-apiserver æä¾›äº†&lt;a href=&#34;https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ›´è¯¦ç»†çš„æ–¹æ³•&lt;/a&gt;æ¥é…ç½®ç»†ç²’åº¦çš„ watch ç¼“å­˜å¤§å°ï¼Œå¯ä»¥è¿›ä¸€æ­¥åˆ©ç”¨å®ƒæ¥æ»¡è¶³ç‰¹å®šçš„ç¼“å­˜è¦æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-004_hu12330530867384526641.webp 400w,
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-004_hu3847967356292233191.webp 760w,
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-004_hu815602199177989905.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-004_hu12330530867384526641.webp&#34;
               width=&#34;576&#34;
               height=&#34;463&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;å¯æ“ä½œæ€§&#34;&gt;å¯æ“ä½œæ€§&lt;/h2&gt;
&lt;h3 id=&#34;å¯è§‚æµ‹æ€§&#34;&gt;å¯è§‚æµ‹æ€§&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†å‡å°‘äº‹æ•…çš„æ£€æµ‹å’Œç¼“è§£æ—¶é—´ï¼Œæˆ‘ä»¬ä¸æ–­è‡´åŠ›äºæ”¹å–„ Kubernetes æ§åˆ¶å¹³é¢çš„å¯è§‚æµ‹æ€§ã€‚å¦‚ä½•å¹³è¡¡æ•…éšœè¦†ç›–ç‡å’Œä¿¡å·çµæ•åº¦æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æŒ‘æˆ˜ã€‚å¯¹äºç°æœ‰çš„ Kubernetes æŒ‡æ ‡ï¼Œæˆ‘ä»¬åˆ†æµå¹¶æŒ‘é€‰é‡è¦çš„æŒ‡æ ‡è¿›è¡Œç›‘æ§å’ŒæŠ¥è­¦ï¼Œä»¥ä¾¿æˆ‘ä»¬èƒ½æ›´ä¸»åŠ¨åœ°å‘ç°é—®é¢˜ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯¹ kube-apiserver è¿›è¡Œç›‘æµ‹ä»¥è¦†ç›–æ›´è¯¦ç»†çš„é¢†åŸŸï¼Œä»è€Œå¿«é€Ÿç¼©å°æ ¹æºã€‚æœ€åï¼Œæˆ‘ä»¬è°ƒæ•´è­¦æŠ¥ç»Ÿè®¡å’Œé˜ˆå€¼æ¥å‡å°‘å™ªéŸ³å’Œé”™è¯¯è­¦æŠ¥ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨é«˜å±‚é¢ä¸Šï¼Œæˆ‘ä»¬é€šè¿‡æŸ¥çœ‹ QPS å’Œå¹¶å‘è¯·æ±‚ã€é”™è¯¯ç‡å’Œè¯·æ±‚å»¶è¿Ÿæ¥ç›‘æ§ kube-apiserver çš„è´Ÿè½½ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡èµ„æºç±»å‹ã€è¯·æ±‚ç±»å‹å’Œç›¸å…³æœåŠ¡è´¦æˆ·æ¥ç»†åˆ†æµé‡ã€‚å¯¹äºåƒ listing è¿™æ ·æ˜‚è´µçš„æµé‡ï¼Œæˆ‘ä»¬è¿˜é€šè¿‡å¯¹å¯¹è±¡è®¡æ•°å’Œå­—èŠ‚å¤§å°æ¥æµ‹é‡è¯·æ±‚çš„æœ‰æ•ˆè½½è·ï¼Œå› ä¸ºå®ƒä»¬å³ä½¿æ˜¯å¾ˆå°çš„ QPS ä¹Ÿå¾ˆå®¹æ˜“è¶…è¿‡ kube-apiserver çš„è´Ÿè·ã€‚æœ€åï¼Œæˆ‘ä»¬ç›‘æµ‹ etcd watch äº‹ä»¶å¤„ç†çš„ QPS å’Œå»¶è¿Ÿå¤„ç†è®¡æ•°ï¼Œä½œä¸ºé‡è¦çš„æœåŠ¡å™¨æ€§èƒ½æŒ‡æ ‡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-005_hu12801422474040354663.webp 400w,
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-005_hu8864222536469011342.webp 760w,
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-005_hu12239406302682255533.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-005_hu12801422474040354663.webp&#34;
               width=&#34;576&#34;
               height=&#34;558&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;å¯è°ƒè¯•æ€§&#34;&gt;å¯è°ƒè¯•æ€§&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†æ›´å¥½åœ°äº†è§£ Kubernetes æ§åˆ¶å¹³é¢çš„æ€§èƒ½å’Œèµ„æºæ¶ˆè€—æƒ…å†µï¼Œæˆ‘ä»¬è¿˜åˆ©ç”¨äº† &lt;a href=&#34;https://github.com/etcd-io/bbolt&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;boltdb&lt;/a&gt; åº“å’Œ &lt;a href=&#34;https://github.com/brendangregg/FlameGraph&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;flamegraph &lt;/a&gt;æ„å»ºäº† etcd æ•°æ®å­˜å‚¨åˆ†æå·¥å…·ï¼Œä»¥å¯è§†åŒ–æ•°æ®å­˜å‚¨æ•…éšœã€‚æ•°æ®å­˜å‚¨åˆ†æçš„ç»“æœä¸ºå¹³å°ç”¨æˆ·æä¾›äº†ä¼˜åŒ–ä½¿ç”¨ç‡çš„æ´å¯ŸåŠ›ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-006_hu3158110180914816926.webp 400w,
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-006_hu15928016331352197104.webp 760w,
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-006_hu4592149089472447643.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-006_hu3158110180914816926.webp&#34;
               width=&#34;576&#34;
               height=&#34;89&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ç”¨äº† golang profiling å·¥å…· &lt;a href=&#34;https://blog.golang.org/pprof&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;pprof&lt;/a&gt; å’Œå¯è§†åŒ–å †å†…å­˜å ç”¨ã€‚æˆ‘ä»¬èƒ½å¤Ÿå¿«é€Ÿè¯†åˆ«èµ„æºæœ€å¯†é›†çš„ä»£ç è·¯å¾„å’Œè¯·æ±‚æ¨¡å¼ï¼Œä¾‹å¦‚ï¼Œåœ¨è°ƒç”¨ List èµ„æºæ—¶è½¬æ¢å“åº”å¯¹è±¡ã€‚ä½œä¸º kube-apiserver OOM è°ƒæŸ¥çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å‘ç°çš„å¦ä¸€ä¸ªå¤§é—®é¢˜æ˜¯ï¼Œkube-apiserver ä½¿ç”¨çš„ &lt;a href=&#34;https://www.kernel.org/doc/Documentation/cgroup-v1/memory.txt&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;page cache&lt;/a&gt; ä¹Ÿè¢«è®¡å…¥äº† cgroup çš„å†…å­˜é™åˆ¶ï¼ŒåŒ¿åå†…å­˜çš„ä½¿ç”¨å¯ä»¥çªƒå–åŒä¸€ cgroup ä¸‹çš„ page cacheã€‚å› æ­¤ï¼Œå³ä½¿ kube-apiserver åªæœ‰ 20GB çš„å †å†…å­˜ä½¿ç”¨é‡ï¼Œæ•´ä¸ª cgroup ä¹Ÿä¼šçœ‹åˆ°æœ‰ 200GB çš„å†…å­˜ä½¿ç”¨é‡å°†è§¦å‘é™åˆ¶ã€‚è™½ç„¶ç›®å‰çš„å†…æ ¸é»˜è®¤è®¾ç½®æ˜¯ä¸ä¸»åŠ¨å›æ”¶åˆ†é…çš„é¡µé¢ä»¥æœ‰æ•ˆåœ°é‡æ–°ä½¿ç”¨ï¼Œä½†æˆ‘ä»¬ç›®å‰æ­£åœ¨ç ”ç©¶è®¾ç½®åŸºäº memory.stat æ–‡ä»¶çš„ç›‘æ§ï¼Œå¹¶å¼ºåˆ¶ cgroup åœ¨å†…å­˜ä½¿ç”¨æ¥è¿‘æé™æ—¶å°½å¯èƒ½å¤šåœ°å›æ”¶é¡µé¢ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-007_hu15130931144568268825.webp 400w,
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-007_hu10039975959580278082.webp 760w,
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-007_hu5613748477057064687.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-007_hu15130931144568268825.webp&#34;
               width=&#34;380&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;é€šè¿‡æˆ‘ä»¬åœ¨æ²»ç†ã€å¼¹æ€§å’Œå¯æ“ä½œæ€§æ–¹é¢çš„åŠªåŠ›ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¤§å¤§å‡å°‘è®¡ç®—èµ„æºã€æ§åˆ¶å¹³é¢å¸¦å®½çš„çªç„¶ä½¿ç”¨æ¿€å¢ï¼Œå¹¶ç¡®ä¿æ•´ä¸ªå¹³å°çš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚åœ¨ä¼˜åŒ–æªæ–½æ¨å‡ºåï¼Œkube-apiserver çš„ QPSï¼ˆä¸»è¦æ˜¯è¯»è¯·æ±‚ï¼‰å‡å°‘äº† 90%ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ï¼Œè¿™ä½¿å¾— kube-apiserver çš„ä½¿ç”¨æ›´åŠ ç¨³å®šã€é«˜æ•ˆå’Œç¨³å¥ã€‚æˆ‘ä»¬å¯¹ Kubernetes å†…éƒ¨çš„æ·±å…¥äº†è§£å’Œè·å¾—çš„é¢å¤–è§è§£å°†ä½¿å›¢é˜Ÿèƒ½å¤Ÿæ›´å¥½åœ°è¿›è¡Œç³»ç»Ÿæ“ä½œå’Œé›†ç¾¤ç»´æŠ¤ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-008_hu16992780782577372849.webp 400w,
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-008_hu11403975900496734262.webp 760w,
               /blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-008_hu12807077039341307565.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/scaling-kubernetes-with-assurance-at-pinterest/scaling-kubernetes-with-assurance-at-pinterest-008_hu16992780782577372849.webp&#34;
               width=&#34;576&#34;
               height=&#34;261&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯ä¸€äº›å…³é”®è¦ç‚¹ï¼Œå¸Œæœ›èƒ½åœ¨ä½ è§£å†³ Kubernetes å¯æ‰©å±•æ€§å’Œå¯é æ€§é—®é¢˜çš„ä¸‹ä¸€ä¸ªæ—…ç¨‹ä¸­å¸®åŠ©åˆ°ä½ ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è¯Šæ–­é—®é¢˜ä»¥æ‰¾åˆ°&lt;strong&gt;å…¶æ ¹æº&lt;/strong&gt;ã€‚åœ¨å†³å®šâ€œå¦‚ä½•å¤„ç†â€ä¹‹å‰ï¼Œå…ˆå…³æ³¨â€œä¸ºä½•å¼•èµ·â€ã€‚è§£å†³é—®é¢˜çš„ç¬¬ä¸€æ­¥æ˜¯äº†è§£ç“¶é¢ˆæ˜¯ä»€ä¹ˆä»¥åŠä¸ºä½•å‡ºç°ç“¶é¢ˆã€‚å¦‚æœä½ æ‰¾åˆ°äº†æ ¹æœ¬åŸå› ï¼Œå°±ç­‰äºä½ æ‰¾åˆ°äº†ä¸€åŠçš„è§£å†³æ–¹æ¡ˆã€‚&lt;/li&gt;
&lt;li&gt;ç»å¤§å¤šæ•°æ—¶å€™ï¼Œé¦–å…ˆæŸ¥æ‰¾å¾®ä¹å…¶å¾®çš„æ”¹è¿›éƒ½æ˜¯å€¼å¾—çš„ï¼Œè€Œä¸æ˜¯ç«‹å³è‡´åŠ›äºå½»åº•åœ°æ”¹å˜æ¶æ„ã€‚è¿™ä¸€ç‚¹å°¤ä¸ºé‡è¦ï¼Œå°¤å…¶æ˜¯å½“ä½ æœ‰ä¸€åªå¾ˆçµæ´»çš„å›¢é˜Ÿæ—¶ã€‚&lt;/li&gt;
&lt;li&gt;å½“è®¡åˆ’è°ƒæŸ¥å’Œä¿®å¤æ—¶ï¼Œåšå‡º&lt;strong&gt;ä»¥æ•°æ®é©±åŠ¨&lt;/strong&gt;çš„å†³ç­–ã€‚æ­£ç¡®çš„é¥æµ‹æŠ€æœ¯å¯ä»¥å¸®åŠ©åšå‡ºæ›´å¥½çš„å†³ç­–ï¼Œç¡®å®šé¦–å…ˆéœ€è¦å…³æ³¨å’Œä¼˜åŒ–ä»€ä¹ˆã€‚&lt;/li&gt;
&lt;li&gt;å…³é”®çš„åŸºç¡€è®¾æ–½ç»„ä»¶åœ¨è®¾è®¡æ—¶åº”è€ƒè™‘åˆ°å¼¹æ€§ã€‚åˆ†å¸ƒå¼ç³»ç»Ÿæœ‰å¯èƒ½å‡ºç°æ•…éšœï¼Œæœ€å¥½æ˜¯&lt;strong&gt;å§‹ç»ˆä¸ºæœ€åçš„æƒ…å†µåšå‡†å¤‡&lt;/strong&gt;ã€‚æ­£ç¡®çš„ä¿æŠ¤æªæ–½èƒ½å¸®åŠ©é˜²æ­¢çº§è”æ•…éšœï¼Œå¹¶ä½¿æ•…éšœè¦†ç›–é¢æ›´å°ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å±•æœ›æœªæ¥&#34;&gt;å±•æœ›æœªæ¥&lt;/h2&gt;
&lt;h3 id=&#34;è”é‚¦federation&#34;&gt;è”é‚¦ï¼ˆFederationï¼‰&lt;/h3&gt;
&lt;p&gt;éšç€æˆ‘ä»¬çš„è§„æ¨¡ç¨³æ­¥å¢é•¿ï¼Œå•é›†ç¾¤æ¶æ„å·²ç»ä¸è¶³ä»¥æ”¯æ’‘ä¸æ–­å¢åŠ çš„å·¥ä½œè´Ÿè½½ã€‚åœ¨ç¡®ä¿äº†é«˜æ•ˆå’Œç¨³å¥çš„å•é›†ç¾¤ç¯å¢ƒä¹‹åï¼Œä½¿æˆ‘ä»¬çš„è®¡ç®—å¹³å°èƒ½å¤Ÿæ°´å¹³æ‰©å±•æ˜¯æˆ‘ä»¬å‰è¿›çš„ä¸‹ä¸€ä¸ªé‡Œç¨‹ç¢‘ã€‚é€šè¿‡åˆ©ç”¨è”é‚¦æ¡†æ¶ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä»¥æœ€å°çš„æ“ä½œå¼€é”€å°†æ–°é›†ç¾¤æ¥å…¥ç¯å¢ƒä¸­ï¼ŒåŒæ—¶ä¿æŒå¹³å°æ¥å£å¯¹ç»ˆç«¯ç”¨æˆ·çš„ç¨³å®šã€‚ç›®å‰æˆ‘ä»¬çš„è”é‚¦é›†ç¾¤ç¯å¢ƒæ­£åœ¨å¼€å‘ä¸­ï¼ŒæœŸå¾…ç€å®ƒåœ¨äº§å“åŒ–åæ‰€å¸¦æ¥çš„æ›´å¤šå¯èƒ½æ€§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å®¹é‡è§„åˆ’&#34;&gt;å®¹é‡è§„åˆ’&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å½“å‰é’ˆå¯¹å¼ºåˆ¶èµ„æºé…é¢çš„æ–¹æ³•æ˜¯ä¸€ç§ç®€å•çš„ã€ååº”å¼çš„å®¹é‡è§„åˆ’æ–¹æ³•ã€‚éšç€æˆ‘ä»¬æ·»åŠ æ›´å¤šçš„ç”¨æˆ·è´Ÿè½½å’Œç³»ç»Ÿç»„ä»¶ï¼Œå¹³å°çš„åŠ¨æ€å˜åŒ–å’Œé¡¹ç›®çº§åˆ«æˆ–é›†ç¾¤èŒƒå›´å†…çš„å®¹é‡é™åˆ¶å°†ä¼šè¿‡æ—¶ã€‚æˆ‘ä»¬éœ€è¦æ¢ç´¢ä¸€ç§æ›´å…·å‰ç»æ€§çš„å®¹é‡è§„åˆ’æ–¹å¼ï¼ŒåŸºäºå†å²æ•°æ®ï¼Œå¢é•¿è½¨è¿¹å’Œå¤æ‚çš„å®¹é‡æ¨¡å‹è¿›è¡Œé¢„æµ‹ï¼Œä¸ä»…å¯ä»¥æ¶µç›–èµ„æºé…é¢ï¼Œè¿˜å¯ä»¥æ¶µç›– API é…é¢ã€‚æˆ‘ä»¬æœŸå¾…æœ‰æ›´ç§¯æå’Œå‡†ç¡®çš„å®¹é‡è§„åˆ’æ¥é˜²æ­¢å¹³å°å‡ºç°è¿‡è½½æˆ–æ˜¯äº¤ä»˜èƒ½åŠ›ä¸è¶³ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é¸£è°¢&#34;&gt;é¸£è°¢&lt;/h2&gt;
&lt;p&gt;Pinterest çš„è®¸å¤šå·¥ç¨‹å¸ˆåœ¨æ‰©å±• Kubernetes å¹³å°ä»¥èµ¶ä¸Šä¸šåŠ¡å¢é•¿è¿™è¿‡ç¨‹ä¸­åšå‡ºäº†å¾ˆå¤šåŠªåŠ›ã€‚é™¤äº† Cloud Runtime å›¢é˜Ÿï¼ŒåŒ…æ‹¬ June Liuã€Harry Zhangã€Suli Xuã€Ming Zong å’Œ Quentin Miao ä¸ºå®ç°å¯æ‰©å±•å’Œç¨³å®šçš„è®¡ç®—å¹³å°è€ŒåŠªåŠ›å¤–ï¼Œé¢†å¯¼ SRE å·¥ä½œçš„ Balaji Narayananã€Roberto Alcala å’Œ Rodrigo Menezes ä¹Ÿå…±åŒè‡´åŠ›äºç¡®ä¿è®¡ç®—å¹³å°çš„åšå®åŸºç¡€ã€‚Kalim Moghul å’Œ Ryan Albrecht è´Ÿè´£é¢†å¯¼å®¹é‡è§„åˆ’å·¥ç¨‹å·¥ä½œï¼Œä»–ä»¬ä¸ºé¡¹ç›®çš„â€œèº«ä»½ç®¡ç†â€æ¨¡å—å’Œç³»ç»Ÿå±‚é¢çš„åˆ†æåšå‡ºäº†è´¡çŒ®ã€‚é¢†å¯¼å®‰å…¨å·¥ç¨‹å·¥ä½œçš„ Cedric Staub å’Œ Jeremy Krach ä¸€å¦‚æ—¢å¾€ä¿æŒäº†é«˜æ ‡å‡†ï¼Œä½¿æˆ‘ä»¬çš„å·¥ä½œè´Ÿè½½èƒ½å¤Ÿåœ¨å¤šç§Ÿæˆ·å¹³å°ä¸Šå®‰å…¨åœ°è¿è¡Œã€‚æœ€åï¼Œæˆ‘ä»¬çš„å¹³å°ç”¨æˆ· Dinghang Yuã€Karthik Anantha Padmanabhanã€Petro Saviukã€Michael Benedictã€Jasmine Qin å’Œå…¶ä»–è®¸å¤šäººï¼Œæä¾›äº†å¾ˆå¤šæœ‰ç”¨çš„åé¦ˆå’Œéœ€æ±‚ï¼Œå¹¶ä¸æˆ‘ä»¬ä¸€èµ·åŠªåŠ›ä½¿ä¸šåŠ¡æŒç»­å¢é•¿ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes1.18 æ¶æ„è®¾è®¡æºç é˜…è¯»</title>
      <link>https://cloudnativecn.com/blog/kubernetes-apiserver-cacher/</link>
      <pubDate>Fri, 14 May 2021 15:04:05 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/kubernetes-apiserver-cacher/</guid>
      <description>&lt;p&gt;å¥½æ¶ˆæ¯ï¼Œå¥½æ¶ˆæ¯ï¼æºç æ¶æ„å›¾ç³»åˆ—å®Œæ•´å•¦ï¼&lt;/p&gt;
&lt;p&gt;å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æ¨é¼ç¿ï¼ŒKubernetes æºç è®¾è®¡å›¾å·²ç»æ•´ç†å®Œæ•´å•¦ï¼Œå…¨éƒ¨æ”¾åœ¨äº†äº‘åŸç”Ÿç¤¾åŒºä¸‹ï¼Œæ¬¢è¿å¤§å®¶å‰æ¥é˜…è¯»ï¼&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æ–¹ä¾¿å¹¿å¤§è¯»è€…çš„é˜…è¯»ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰çš„æºç å›¾æ•´ç†åˆ°äº† GitBook ä¸­ï¼Œå¤§å®¶ä¸å¿…ä¸ºé˜…è¯»çš„é¡ºåºè€Œå›°æ‰°å•¦ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://i.cloudnative.to/kubernetes/kubernetes/index&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é˜…è¯»ç‚¹æˆ‘&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æºç è®¾è®¡å›¾å…±è¿‘ 200 ä½™å¼ ï¼ˆ100 ä½™å¼ æ˜¯æ‰‹ç»˜çš„æ¶æ„è®¾è®¡å›¾ï¼‰ï¼Œè¦†ç›–ä¸»è¦ç»„ä»¶åŒ…æ‹¬ API Serverï¼ŒControllerï¼ŒSchedulerï¼ŒProxyï¼ŒClient ç­‰ï¼ŒåŒæ—¶è¿˜æœ‰ Dockerï¼ŒGolang ç­‰ç›¸å…³éƒ¨åˆ†ã€‚æºç å›¾ç†å¿µä»¥æ¶æ„è®¾è®¡ï¼ˆæ•°æ®ç»“æ„çš„è®¾è®¡ï¼‰ä¸ºä¸»ï¼Œå†³ä¸ä¸ºäº†è®²è¿°æµç¨‹è€Œç”»æµç¨‹å›¾ï¼Œé˜…è¯»æ—¶éœ€è¦é…åˆæºç åŒæ—¶é˜…è¯»ï¼ŒåŒæ—¶ä¼šæœ‰ä¸€å°éƒ¨åˆ†çš„é—®é¢˜ç•™ç™½ï¼Œå¯ä»¥å¼•å¯¼è¯»è€…å¸¦ç€é—®é¢˜è¿›å…¥æºç ä¸­å¯»æ±‚ç­”æ¡ˆï¼Œå¸Œæœ›èƒ½ç±æ­¤å¸®åŠ©å¤§å®¶åœ¨å­¦ä¹  K8S çš„åŒæ—¶æé«˜è‡ªå·±çš„è®¾è®¡èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;ä»å»å¹´ 6 æœˆå¼€å§‹åˆ°ä»Šå¹´ï¼Œå¾ˆå¤šå›¾ä¾‹éƒ½ç»è¿‡å¤šæ¬¡æ‰“ç£¨ï¼Œå¤§å°ï¼Œå«ä¹‰ä¿è¯ä¸€è‡´ï¼Œå¦‚è™šçº¿ç®­å¤´ä»£è¡¨åŠ¨ä½œç­‰ï¼Œå¯¹å„ç§æµç¨‹å¦‚å¾ªç¯è¿­ä»£çš„ç”»å›¾è¡¨è¾¾ä¹Ÿç»è¿‡å¤šæ¬¡æ”¹ç‰ˆï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå°¤åœ¨å›¾ä¸­ä¸åŒå®ä½“çš„ç›¸äº’ä½ç½®æœ‰ä¸‹åŠŸå¤«ï¼Œå¦‚åŒä¸€æ°´å¹³çº¿ä»£è¡¨åŒä¸€å±‚æ¬¡ç­‰ï¼Œæ¬¢è¿åœ¨ç”»å›¾è¡¨è¾¾ä¸Šå¤šå¤šäº¤æµï¼Œå…±åŒæ¨è¿›å¦‚æ­¤ç†å¿µçš„æºç æ¶æ„å›¾ã€‚ï¼ˆé™¤ Kubernetes å¤–ï¼Œä¸å°‘çŸ¥åé¡¹ç›®çš„æºç æ¶æ„å›¾ä¹Ÿå·²å®Œæˆï¼Œæ¬¢è¿äº¤æµï¼‰&lt;/p&gt;
&lt;p&gt;è¿™ä¸€ç³»åˆ—å®Œæˆè¿‡ç¨‹ä¸­ï¼Œè¶…å“¥ï¼ˆJimmy Songï¼‰ç»™äºˆäº†æˆ‘å¾ˆå¤šæ”¯æŒï¼Œè¿˜æœ‰å“å“¥ï¼ˆæå“ï¼‰çš„é¼“åŠ±ï¼Œä¹Ÿæœ‰ä¸å°‘å‰è¾ˆç»™äºˆè‚¯å®šï¼Œæ„Ÿè°¢å¤§å®¶çš„å…³æ³¨å’Œé˜…è¯»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å›¾ä¾‹&#34;&gt;å›¾ä¾‹&lt;/h2&gt;
&lt;h3 id=&#34;éƒ¨åˆ†å…¨è§ˆå›¾&#34;&gt;éƒ¨åˆ†å…¨è§ˆå›¾&lt;/h3&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-éƒ¨åˆ†å…¨è§ˆå›¾&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;éƒ¨åˆ†å…¨è§ˆå›¾&#34; srcset=&#34;
               /blog/kubernetes-apiserver-cacher/all_hu15507910346309014532.webp 400w,
               /blog/kubernetes-apiserver-cacher/all_hu5314912498310537087.webp 760w,
               /blog/kubernetes-apiserver-cacher/all_hu7998244169082290475.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-apiserver-cacher/all_hu15507910346309014532.webp&#34;
               width=&#34;760&#34;
               height=&#34;344&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      éƒ¨åˆ†å…¨è§ˆå›¾
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;sharedinfomer&#34;&gt;SharedInfomer&lt;/h3&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-sharedinfomer&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;SharedInfomer&#34; srcset=&#34;
               /blog/kubernetes-apiserver-cacher/sharedinformer_hu13357600297952338619.webp 400w,
               /blog/kubernetes-apiserver-cacher/sharedinformer_hu16236558182509384179.webp 760w,
               /blog/kubernetes-apiserver-cacher/sharedinformer_hu1055781749607296559.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-apiserver-cacher/sharedinformer_hu13357600297952338619.webp&#34;
               width=&#34;378&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      SharedInfomer
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;cacher&#34;&gt;Cacher&lt;/h3&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-cacher&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Cacher&#34; srcset=&#34;
               /blog/kubernetes-apiserver-cacher/cacher_hu4843669606560075173.webp 400w,
               /blog/kubernetes-apiserver-cacher/cacher_hu5528499927364370308.webp 760w,
               /blog/kubernetes-apiserver-cacher/cacher_hu512284341156906751.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-apiserver-cacher/cacher_hu4843669606560075173.webp&#34;
               width=&#34;684&#34;
               height=&#34;693&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Cacher
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Cacher åŒ…å«äº† storage.Interface å®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹æ˜¯çœŸæ­£çš„å­˜å‚¨åç«¯å®ä¾‹ã€‚åŒæ—¶ï¼ŒCacher ä¹Ÿå®ç°äº† storage.Interface æ¥å£ï¼Œè¿™ä¸ªæ˜¯å…¸å‹çš„è£…é¥°å™¨æ¨¡å¼ã€‚Kubernetes æºç ä¸­ï¼Œæœ‰å¤§é‡ä¼˜é›…çš„è®¾è®¡æ¨¡å¼çš„è¿ç”¨ï¼Œåœ¨é˜…è¯»æ—¶å¯å¤šåŠ æ³¨æ„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;node&#34;&gt;Node&lt;/h3&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-node&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Node&#34; srcset=&#34;
               /blog/kubernetes-apiserver-cacher/node_hu9764077841731763717.webp 400w,
               /blog/kubernetes-apiserver-cacher/node_hu13774688828539969914.webp 760w,
               /blog/kubernetes-apiserver-cacher/node_hu13128507699920762795.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-apiserver-cacher/node_hu9764077841731763717.webp&#34;
               width=&#34;671&#34;
               height=&#34;691&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Node
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Nodes ä¸­ä¿å­˜äº† Node.Name åˆ° nodeInfoListItem é“¾è¡¨çš„æ˜ å°„ã€‚æ¯ä¸ª nodeInfoListItem å¯¹åº”ä¸€ä¸ª NodeInfo å®ä¾‹ï¼Œå®ä¾‹ä¸­ä¿å­˜äº† Node ä¿¡æ¯åŠç›¸å…³çš„ Pod ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;endpoint-controller&#34;&gt;Endpoint Controller&lt;/h3&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-endpoint-controller&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Endpoint Controller&#34; srcset=&#34;
               /blog/kubernetes-apiserver-cacher/endpointcontroller_hu17168709454566179869.webp 400w,
               /blog/kubernetes-apiserver-cacher/endpointcontroller_hu1973520761646903273.webp 760w,
               /blog/kubernetes-apiserver-cacher/endpointcontroller_hu16695559554428876111.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-apiserver-cacher/endpointcontroller_hu17168709454566179869.webp&#34;
               width=&#34;643&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Endpoint Controller
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾ä¸º syncService å®Œæ•´çš„æµç¨‹ã€‚ç¬¬ä¸€æ­¥ï¼Œå…ˆæ ¹æ®é€šè¿‡ Service è·å–çš„ Key å€¼ï¼Œè¿˜åŸ Namespace ä¸ Nameï¼Œè¿™ä¸¤ä¸ªå€¼æ˜¯åç»­å‘ API Server æŸ¥è¯¢çš„æ ¸å¿ƒä¾æ®ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœåŠ¡åˆ é™¤ï¼Œé‚£ä¹ˆé€šçŸ¥ API Server åˆ é™¤è¯¥æœåŠ¡ç›¸å…³çš„ Endpoint&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯åˆ›å»ºã€æ›´æ–°æœåŠ¡
&lt;ul&gt;
&lt;li&gt;ä» API Server æ ¹æ® (Namespace, Name) æ‹‰å–ä¸ç°æœ‰ä¸ Service.Spec.Selector ç›¸å…³çš„ Pod åˆ—è¡¨&lt;/li&gt;
&lt;li&gt;æ ¹æ® Pod åˆ—è¡¨è·å–å­ç½‘åœ°å€åˆ—è¡¨&lt;/li&gt;
&lt;li&gt;è·å–å½“å‰ä¸ Service å…³è”çš„ Endpoints&lt;/li&gt;
&lt;li&gt;DeepCopy è¿”å›çš„ Endpoints å¯¹è±¡ï¼Œå¹¶æ›´æ–° Copy çš„ Endpoints çš„å­ç½‘åœ°å€åˆ—è¡¨&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨æ–° Endpointsï¼Œé€šçŸ¥ API Server åˆ›å»ºæˆ–æ›´æ–° Endpoints èµ„æº&lt;/li&gt;
&lt;li&gt;åˆ›å»º/æ›´æ–°è¿‡ç¨‹å‘ç”Ÿé”™è¯¯æ—¶ï¼Œè®°å½•äº‹ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;iptable-proxier&#34;&gt;IPTable Proxier&lt;/h3&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-iptable-proxier&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;IPTable Proxier&#34; srcset=&#34;
               /blog/kubernetes-apiserver-cacher/iptable_hu6992857263809304447.webp 400w,
               /blog/kubernetes-apiserver-cacher/iptable_hu4902902797949040384.webp 760w,
               /blog/kubernetes-apiserver-cacher/iptable_hu17387346011684852985.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-apiserver-cacher/iptable_hu6992857263809304447.webp&#34;
               width=&#34;760&#34;
               height=&#34;547&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      IPTable Proxier
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Chain å¦‚ä¸Šå›¾ä¸­è™šçº¿æ–¹æ¡†æ‰€ç¤ºï¼Œä»£è¡¨äº†åŒ…å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå®é™…çš„è§„åˆ™æ‰§è¡Œè·¯å¾„ã€‚Table æ˜¯å¯ç®€å•ç†è§£ä¸ºè§„åˆ™çš„åˆ†ç±»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Rawï¼šConnection Tracking ç›¸å…³æ“ä½œ&lt;/li&gt;
&lt;li&gt;Mangleï¼šä¿®æ”¹ IP åŒ…&lt;/li&gt;
&lt;li&gt;Natï¼šåœ°å€è½¬æ¢&lt;/li&gt;
&lt;li&gt;Filterï¼šè¿‡æ»¤&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes ä¸Šå¦‚ä½•æ§åˆ¶å®¹å™¨çš„å¯åŠ¨é¡ºåºï¼Ÿ</title>
      <link>https://cloudnativecn.com/blog/k8s-1.18-container-start-sequence-control/</link>
      <pubDate>Tue, 04 May 2021 21:13:54 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/k8s-1.18-container-start-sequence-control/</guid>
      <description>&lt;p&gt;å»å¹´å†™è¿‡ä¸€ç¯‡åšå®¢ï¼š&lt;a href=&#34;https://mp.weixin.qq.com/s/5UXhXpwPDBh2xuGKq9Nqig&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ§åˆ¶ Pod å†…å®¹å™¨çš„å¯åŠ¨é¡ºåº&lt;/a&gt;ï¼Œåˆ†æäº† &lt;a href=&#34;https://github.com/tektoncd&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TektonCD&lt;/a&gt;  çš„å®¹å™¨å¯åŠ¨æ§åˆ¶çš„åŸç†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆè¦åšå®¹å™¨å¯åŠ¨é¡ºåºæ§åˆ¶ï¼Ÿæˆ‘ä»¬éƒ½çŸ¥é“ Pod ä¸­é™¤äº† &lt;code&gt;init-container&lt;/code&gt; ä¹‹å¤–ï¼Œæ˜¯å…è®¸æ·»åŠ å¤šä¸ªå®¹å™¨çš„ã€‚ç±»ä¼¼ TektonCD ä¸­ &lt;code&gt;task&lt;/code&gt; å’Œ &lt;code&gt;step&lt;/code&gt; çš„æ¦‚å¿µå°±åˆ†åˆ«ä¸ &lt;code&gt;pod&lt;/code&gt; å’Œ &lt;code&gt;container&lt;/code&gt; å¯¹åº”ï¼Œè€Œ &lt;code&gt;step&lt;/code&gt; æ˜¯æŒ‰ç…§é¡ºåºæ‰§è¡Œçš„ã€‚æ­¤å¤–è¿˜æœ‰æœåŠ¡ç½‘æ ¼çš„åœºæ™¯ï¼Œsidecar å®¹å™¨éœ€è¦åœ¨æœåŠ¡å®¹å™¨å¯åŠ¨ä¹‹å‰å®Œæˆé…ç½®çš„åŠ è½½ï¼Œä¹Ÿéœ€è¦å¯¹å®¹å™¨çš„å¯åŠ¨é¡ºåºåŠ ä»¥æ§åˆ¶ã€‚å¦åˆ™ï¼ŒæœåŠ¡å®¹å™¨å…ˆå¯åŠ¨ï¼Œè€Œ sidecar è¿˜æ— æ³•æä¾›ç½‘ç»œä¸Šçš„æ”¯æŒã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç°å®&#34;&gt;ç°å®&lt;/h3&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-sidecar-lifecycle-1&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://atbug.oss-cn-hangzhou.aliyuncs.com/2021/04/30/sidecarlifecycle1.gif&#34; alt=&#34;sidecar-lifecycle-1&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      sidecar-lifecycle-1
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;æœŸæœ›&#34;&gt;æœŸæœ›&lt;/h3&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-sidecar-lifecycle-2&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://atbug.oss-cn-hangzhou.aliyuncs.com/2021/04/30/sidecarlifecycle2.gif&#34; alt=&#34;sidecar-lifecycle-2&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      sidecar-lifecycle-2
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åˆ°äº†è¿™é‡Œè‚¯å®šæœ‰åŒå­¦ä¼šé—®ï¼Œ&lt;code&gt;spec.containers[]&lt;/code&gt; æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„æ˜¯æœ‰é¡ºåºçš„ã€‚Kubernetes ä¹Ÿç¡®å®æ˜¯æŒ‰ç…§é¡ºåºæ¥åˆ›å»ºå’Œå¯åŠ¨å®¹å™¨ï¼Œä½†æ˜¯ &lt;strong&gt;å®¹å™¨å¯åŠ¨æˆåŠŸï¼Œå¹¶ä¸è¡¨ç¤ºå®¹å™¨å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Kubernetes 1.18 éæ­£å¼ç‰ˆä¸­æ›¾åœ¨ Lifecycle å±‚é¢æä¾›äº†å¯¹  &lt;code&gt;sidecar ç±»å‹å®¹å™¨çš„&lt;/code&gt; æ”¯æŒï¼Œä½†æ˜¯æœ€ç»ˆè¯¥åŠŸèƒ½å¹¶&lt;a href=&#34;https://github.com/kubernetes/enhancements/issues/753#issuecomment-713471597&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ²¡æœ‰è½åœ°&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é‚£åˆ°åº•è¯¥æ€ä¹ˆåšï¼Ÿ&lt;/p&gt;
&lt;h2 id=&#34;tldr&#34;&gt;TL;DR&lt;/h2&gt;
&lt;p&gt;ç¬”è€…å‡†å¤‡äº†ä¸€ä¸ªç®€å•çš„ &lt;a href=&#34;https://github.com/addozhang/k8s-container-sequence-sample&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;go é¡¹ç›®&lt;/a&gt;ï¼Œç”¨äºæ¨¡æ‹Ÿ sidecar çš„å¯åŠ¨åŠé…ç½®åŠ è½½ã€‚&lt;/p&gt;
&lt;p&gt;å…‹éš†ä»£ç åå¯ä»¥é€šè¿‡ &lt;code&gt;make build&lt;/code&gt; æ„å»ºå‡ºé•œåƒï¼Œå‡å¦‚ä½ æ˜¯ç”¨çš„ minikube è¿›è¡Œçš„å®éªŒï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤ &lt;code&gt;make load-2-minikube&lt;/code&gt; å°†é•œåƒåŠ è½½åˆ° minikube èŠ‚ç‚¹ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ Deployment çš„æ–¹å¼è¿›è¡Œéƒ¨ç½²ï¼Œç›´æ¥ç”¨ Pod ä¹Ÿå¯ä»¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;creationTimestamp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sample&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sample&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sample&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;strategy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;creationTimestamp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sample&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;addozhang/k8s-container-sequence-sidecar:latest&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;sidecar&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IfNotPresent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;lifecycle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;postStart&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;/entrypoint&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;wait&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;busybox:latest&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;IfNotPresent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/bin/sh&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;-c&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;date; echo &amp;#39;app container started&amp;#39;; tail -f /dev/null&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹é¢çš„æˆªå›¾ä¸­ï¼Œæ¼”ç¤ºäº†åœ¨ &lt;code&gt;sample&lt;/code&gt; å‘½åç©ºé—´ä¸­ï¼Œpod å†…ä¸¤ä¸ªå®¹å™¨çš„æ‰§è¡Œé¡ºåºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-2021-04-30-062819&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://atbug.oss-cn-hangzhou.aliyuncs.com/2021/04/30/20210430-062819.gif&#34; alt=&#34;2021-04-30 06.28.19&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      2021-04-30 06.28.19
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;kubernetes-æºç &#34;&gt;Kubernetes æºç &lt;/h2&gt;
&lt;p&gt;åœ¨ kubelet çš„æºç  &lt;code&gt;pkg/kubelet/kuberuntime/kuberuntime_manager.go&lt;/code&gt; ä¸­ï¼Œ&lt;code&gt;#SyncPod&lt;/code&gt; æ–¹æ³•ç”¨äºåˆ›å»º Podï¼Œæ­¥éª¤æ¯”è¾ƒç¹çï¼Œç›´æ¥çœ‹ç¬¬ 7 æ­¥ï¼šåˆ›å»ºæ™®é€šå®¹å™¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// SyncPod syncs the running pod into the desired pod by executing following steps:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//  1. Compute sandbox and container changes.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//  2. Kill pod sandbox if necessary.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//  3. Kill any containers that should not be running.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//  4. Create sandbox if necessary.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//  5. Create ephemeral containers.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//  6. Create init containers.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//  7. Create normal containers.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;kubeGenericRuntimeManager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;SyncPod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;podStatus&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;kubecontainer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PodStatus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pullSecrets&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Secret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;backOff&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;flowcontrol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Backoff&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kubecontainer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PodSyncResult&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Step 7: start containers in podContainerChanges.ContainersToStart.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;idx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;podContainerChanges&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ContainersToStart&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nf&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;container&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;containerStartSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;idx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ &lt;code&gt;#start&lt;/code&gt; æ–¹æ³•ä¸­è°ƒç”¨äº† &lt;code&gt;#startContainer&lt;/code&gt; æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šå¯åŠ¨å®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨å¯åŠ¨çš„ç»“æœã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„ç»“æœè¿˜ &lt;strong&gt;åŒ…å«äº†å®¹å™¨çš„ Lifecycle hooks è°ƒç”¨&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡å¦‚å®¹å™¨çš„ &lt;code&gt;PostStart&lt;/code&gt; hook æ²¡æœ‰æ­£ç¡®çš„è¿”å›ï¼Œkubelet ä¾¿ä¸ä¼šå»åˆ›å»ºä¸‹ä¸€ä¸ªå®¹å™¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// startContainer starts a container and returns a message indicates why it is failed on error.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// It starts the container through the following steps:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// * pull the image
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// * create the container
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// * start the container
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// * run the post start lifecycle hooks (if applicable)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;kubeGenericRuntimeManager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;startContainer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;podSandboxID&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;podSandboxConfig&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;runtimeapi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PodSandboxConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;spec&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;startSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;podStatus&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;kubecontainer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PodStatus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pullSecrets&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Secret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;podIP&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;podIPs&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Step 4: execute the post start hook.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;container&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Lifecycle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;container&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Lifecycle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PostStart&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;kubeContainerID&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kubecontainer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ContainerID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;runtimeName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;ID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;   &lt;span class=&#34;nx&#34;&gt;containerID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;handlerErr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;runner&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;kubeContainerID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;container&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;container&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Lifecycle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PostStart&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;handlerErr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;recordContainerEvent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;container&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kubeContainerID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EventTypeWarning&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;events&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;FailedPostStartHook&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;killContainer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kubeContainerID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;container&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;FailedPostStartHook&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reasonFailedPostStartHook&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ErrorS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%s: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ErrPostStartHook&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;handlerErr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Failed to kill container&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;pod&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;KObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;s&#34;&gt;&amp;#34;podUID&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;UID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;containerName&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;container&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;containerID&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kubeContainerID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%s: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ErrPostStartHook&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;handlerErr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å®ç°æ–¹æ¡ˆ&#34;&gt;å®ç°æ–¹æ¡ˆ&lt;/h2&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://atbug.oss-cn-hangzhou.aliyuncs.com/2021/04/30/16197365667225.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/addozhang/k8s-container-sequence-sample/blob/main/cmd/entrypoint/wait.go#L26&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cmd/entrypoint/wait.go#L26&lt;/a&gt; ï¼ˆè¿™é‡Œå‚è€ƒäº† Istio çš„ pilot-agent å®ç°ï¼‰&lt;/p&gt;
&lt;p&gt;åœ¨ &lt;code&gt;PostStart&lt;/code&gt; ä¸­æŒç»­çš„å»æ£€æŸ¥ &lt;code&gt;/ready&lt;/code&gt; æ–­ç‚¹ï¼Œå¯ä»¥ hold ä½å½“å‰å®¹å™¨çš„åˆ›å»ºæµç¨‹ã€‚ä¿è¯ &lt;code&gt;/ready&lt;/code&gt; è¿”å› &lt;code&gt;200&lt;/code&gt; åï¼Œkubelet æ‰ä¼šå»åˆ›å»ºä¸‹ä¸€ä¸ªå®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ ·å°±è¾¾åˆ°äº†å‰é¢æˆªå›¾ä¸­æ¼”ç¤ºçš„æ•ˆæœã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Now&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Before&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;timeoutAt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;checkIfReady&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;sidecar is ready&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;sidecar is not ready&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Duration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;periodMillis&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Millisecond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;sidecar is not ready in %d second(s)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;timeoutSeconds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://banzaicloud.com/blog/k8s-sidecars/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Sidecar container lifecycle changes in Kubernetes 1.18&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://medium.com/@marko.luksa/delaying-application-start-until-sidecar-is-ready-2ec2d21a7b74&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Delaying application start until sidecar is ready&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>åˆ©ç”¨ Gateway API å‘å±• Kubernetes ç½‘ç»œ</title>
      <link>https://cloudnativecn.com/blog/evolving-kubernetes-networking-with-the-gateway-api/</link>
      <pubDate>Thu, 22 Apr 2021 10:03:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/evolving-kubernetes-networking-with-the-gateway-api/</guid>
      <description>&lt;p&gt;è¯‘è€…æ³¨ï¼šæœ¬æ–‡è¯‘è‡ª &lt;a href=&#34;https://kubernetes.io/blog/2021/04/22/evolving-kubernetes-networking-with-the-gateway-api/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Evolving Kubernetes networking with the Gateway API&lt;/a&gt;ï¼ŒGateway API çš„å‡ºç°è§£å†³äº† Ingress çš„å¯ç§»æ¤æ€§é—®é¢˜ï¼Œä¸”æœ‰åˆ©äºåŸºäºè§’è‰²çš„è®¿é—®è®¾è®¡ã€‚&lt;/p&gt;
&lt;p&gt;Ingress èµ„æºæ˜¯ Kubernetes ä¼—å¤šæˆåŠŸæ¡ˆä¾‹ä¸­çš„ä¸€ä¸ªã€‚å®ƒåˆ›é€ äº†ä¸€ä¸ª&lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¤šæ ·åŒ–çš„ Ingress æ§åˆ¶å™¨çš„ç”Ÿæ€ç³»ç»Ÿ&lt;/a&gt;ï¼Œè¿™äº›æ§åˆ¶å™¨ä»¥æ ‡å‡†åŒ–å’Œä¸€è‡´çš„æ–¹å¼åœ¨æ•°åä¸‡ä¸ªé›†ç¾¤ä¸­ä½¿ç”¨ã€‚è¿™ç§æ ‡å‡†åŒ–æœ‰åŠ©äºç”¨æˆ·é‡‡ç”¨ Kubernetesã€‚ç„¶è€Œï¼Œåœ¨ Ingress åˆ›å»ºäº”å¹´åï¼Œæœ‰è¿¹è±¡è¡¨æ˜å®ƒè¢«åˆ†å‰²æˆä¸åŒä½†&lt;a href=&#34;https://dave.cheney.net/paste/ingress-is-dead-long-live-ingressroute.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æƒŠäººç›¸ä¼¼çš„ CRD&lt;/a&gt; å’Œ &lt;a href=&#34;https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿‡è½½çš„æ³¨é‡Š&lt;/a&gt;ã€‚Ingress æ™®éå­˜åœ¨çš„å¯ç§»æ¤æ€§é—®é¢˜ä¹Ÿé™åˆ¶äº†å®ƒçš„æœªæ¥ã€‚&lt;/p&gt;
&lt;p&gt;é‚£æ˜¯åœ¨ 2019 å¹´åœ£åœ°äºšå“¥çš„ Kubecon ä¸Šï¼Œä¸€ç¾¤å……æ»¡æ¿€æƒ…çš„è´¡çŒ®è€…èšé›†åœ¨ä¸€èµ·ï¼Œè®¨è®º &lt;a href=&#34;https://static.sched.com/hosted_files/kccncna19/a5/Kubecon%20San%20Diego%202019%20-%20Evolving%20the%20Kubernetes%20Ingress%20APIs%20to%20GA%20and%20Beyond%20%5BPUBLIC%5D.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ingress çš„å‘å±•&lt;/a&gt;ã€‚æ‹¥æŒ¤çš„äººç¾¤æº¢å‡ºåˆ°äº†è¡—å¯¹é¢çš„é…’åº—å¤§å ‚ï¼Œè€Œè®¨è®ºå‡ºæ¥çš„ä¸œè¥¿åæ¥è¢«ç§°ä¸º &lt;a href=&#34;https://gateway-api.sigs.k8s.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gateway API&lt;/a&gt;ã€‚è¿™æ¬¡è®¨è®ºæ˜¯åŸºäºå‡ ä¸ªå…³é”®çš„å‡è®¾ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è·¯ç”±åŒ¹é…ã€æµé‡ç®¡ç†å’ŒæœåŠ¡æš´éœ²æ‰€ä¾æ®çš„ API æ ‡å‡†å·²ç»å•†ä¸šåŒ–ï¼Œå¯¹å…¶å®æ–½è€…å’Œç”¨æˆ·æä¾›çš„å®šåˆ¶ API çš„ä»·å€¼å¾ˆå°ã€‚&lt;/li&gt;
&lt;li&gt;å¯ä»¥é€šè¿‡å…±åŒçš„æ ¸å¿ƒ API èµ„æºæ¥è¡¨ç¤º L4/L7 çš„è·¯ç”±å’Œæµé‡ç®¡ç†ã€‚&lt;/li&gt;
&lt;li&gt;å¯ä»¥åœ¨ä¸ç‰ºç‰²æ ¸å¿ƒ API çš„ç”¨æˆ·ä½“éªŒçš„å‰æä¸‹ï¼Œä¸ºæ›´å¤æ‚çš„åŠŸèƒ½æä¾›æ‰©å±•æ€§ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;gateway-api-ä»‹ç»&#34;&gt;Gateway API ä»‹ç»&lt;/h2&gt;
&lt;p&gt;è¿™äº§å‡ºäº†ä¸€äº›è®¾è®¡åŸåˆ™ï¼Œä½¿ Gateway API èƒ½å¤Ÿåœ¨ Ingress çš„åŸºç¡€ä¸Šè¿›è¡Œæ”¹è¿›ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¡¨è¾¾æ€§&lt;/strong&gt;ï¼šé™¤äº† HTTP ä¸»æœº / è·¯å¾„åŒ¹é…å’Œ TLS ä¹‹å¤–ï¼ŒGateway API è¿˜å¯ä»¥è¡¨è¾¾ HTTP å¤´æ“ä½œã€æµé‡åŠ æƒå’Œé•œåƒã€TCP/UDP è·¯ç”±ç­‰èƒ½åŠ›ï¼Œä»¥åŠå…¶ä»–åªæœ‰åœ¨ Ingress ä¸­é€šè¿‡è‡ªå®šä¹‰æ³¨é‡Šæ‰èƒ½å®ç°çš„èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é¢å‘è§’è‰²çš„è®¾è®¡&lt;/strong&gt;ï¼šAPI èµ„æºæ¨¡å‹åæ˜ äº†è·¯ç”±å’Œ Kubernetes æœåŠ¡ç½‘ç»œä¸­å¸¸è§çš„è´£ä»»åˆ†ç¦»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯æ‰©å±•æ€§&lt;/strong&gt;ï¼šè¿™äº›èµ„æºå…è®¸åœ¨ API çš„å„ä¸ªå±‚é¢ä¸Šè¿›è¡Œä»»æ„çš„é…ç½®é™„åŠ ã€‚è¿™ä½¿å¾—åœ¨æœ€é€‚å½“çš„åœ°æ–¹è¿›è¡Œç»†åŒ–çš„å®šåˆ¶æˆä¸ºå¯èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çµæ´»çš„ä¸€è‡´æ€§&lt;/strong&gt;ï¼šGateway API å®šä¹‰äº†ä¸åŒçš„ä¸€è‡´æ€§çº§åˆ« â€”â€” æ ¸å¿ƒï¼ˆå¼ºåˆ¶æ”¯æŒï¼‰ã€æ‰©å±•ï¼ˆæ”¯æŒæ—¶å¯ç§»æ¤ï¼‰å’Œè‡ªå®šä¹‰ï¼ˆä¸ä¿è¯å¯ç§»æ¤æ€§ï¼‰ï¼Œä¸€èµ·è¢«ç§°ä¸º&lt;a href=&#34;https://gateway-api.sigs.k8s.io/concepts/guidelines/#conformance&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;çµæ´»çš„ä¸€è‡´æ€§&lt;/a&gt;ã€‚è¿™ä¿ƒè¿›äº†é«˜åº¦å¯ç§»æ¤çš„æ ¸å¿ƒ APIï¼ˆå¦‚ Ingressï¼‰ï¼Œä»ç„¶ä¸º Gateway æ§åˆ¶å™¨å®æ–½è€…æä¾›äº†çµæ´»æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;gateway-api-æ˜¯ä»€ä¹ˆæ ·å­çš„&#34;&gt;Gateway API æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;Gateway API å¼•å…¥äº†ä¸€äº›æ–°çš„èµ„æºç±»å‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://gateway-api.sigs.k8s.io/references/spec/#networking.x-k8s.io/v1alpha1.GatewayClass&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;strong&gt;GatewayClasses&lt;/strong&gt;&lt;/a&gt; æ˜¯é›†ç¾¤èŒƒå›´å†…çš„èµ„æºï¼Œä½œä¸ºæ¨¡æ¿ï¼Œæ˜ç¡®åœ°å®šä¹‰ç”±å…¶è¡ç”Ÿçš„ç½‘å…³çš„è¡Œä¸ºã€‚è¿™ä¸ StorageClasses çš„æ¦‚å¿µç±»ä¼¼ï¼Œä½†ç”¨äºç½‘ç»œæ•°æ®å¹³é¢ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://gateway-api.sigs.k8s.io/references/spec/#networking.x-k8s.io/v1alpha1.Gateway&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;strong&gt;Gateway&lt;/strong&gt;&lt;/a&gt; æ˜¯ GatewayClasses çš„éƒ¨ç½²å®ä¾‹ã€‚å®ƒä»¬æ˜¯æ‰§è¡Œè·¯ç”±çš„æ•°æ®å¹³é¢çš„é€»è¾‘è¡¨ç¤ºï¼Œå®ƒå¯èƒ½æ˜¯é›†ç¾¤å†…çš„ä»£ç†ã€ç¡¬ä»¶ LB æˆ–äº‘ LBã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è·¯ç”±&lt;/strong&gt; ä¸æ˜¯ä¸€ä¸ªå•ä¸€çš„èµ„æºï¼Œè€Œæ˜¯ä»£è¡¨è®¸å¤šä¸åŒçš„ç‰¹å®šåè®®çš„è·¯ç”±èµ„æºã€‚&lt;a href=&#34;https://gateway-api.sigs.k8s.io/references/spec/#networking.x-k8s.io/v1alpha1.HTTPRoute&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HTTPRoute&lt;/a&gt; æœ‰åŒ¹é…ã€è¿‡æ»¤å’Œè·¯ç”±è§„åˆ™ï¼Œè¿™äº›è§„åˆ™è¢«åº”ç”¨åˆ°å¯ä»¥å¤„ç† HTTP å’Œ HTTPS æµé‡çš„ç½‘å…³ã€‚åŒæ ·ï¼Œè¿˜æœ‰ &lt;a href=&#34;https://gateway-api.sigs.k8s.io/references/spec/#networking.x-k8s.io/v1alpha1.TCPRoute&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TCPRoutes&lt;/a&gt;ã€&lt;a href=&#34;https://gateway-api.sigs.k8s.io/references/spec/#networking.x-k8s.io/v1alpha1.UDPRoute&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;UDPRoutes&lt;/a&gt; å’Œ &lt;a href=&#34;https://gateway-api.sigs.k8s.io/references/spec/#networking.x-k8s.io/v1alpha1.TLSRoute&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TLSRoutes&lt;/a&gt;ï¼Œå®ƒä»¬ä¹Ÿæœ‰åè®®ç‰¹å®šçš„è¯­ä¹‰ã€‚è¿™ç§æ¨¡å¼ä¹Ÿå…è®¸ç½‘å…³ API åœ¨æœªæ¥é€æ­¥æ‰©å±•å…¶åè®®æ”¯æŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-gateway-api-èµ„æº&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Gateway API èµ„æº&#34; srcset=&#34;
               /blog/evolving-kubernetes-networking-with-the-gateway-api/008i3skNly1gpsl6ut5jlj31ed0u0jyp_hu18034923253733507188.webp 400w,
               /blog/evolving-kubernetes-networking-with-the-gateway-api/008i3skNly1gpsl6ut5jlj31ed0u0jyp_hu1157806241330964405.webp 760w,
               /blog/evolving-kubernetes-networking-with-the-gateway-api/008i3skNly1gpsl6ut5jlj31ed0u0jyp_hu12526185293278231001.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/evolving-kubernetes-networking-with-the-gateway-api/008i3skNly1gpsl6ut5jlj31ed0u0jyp_hu18034923253733507188.webp&#34;
               width=&#34;760&#34;
               height=&#34;453&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Gateway API èµ„æº
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;gateway-æ§åˆ¶å™¨çš„å®ç°&#34;&gt;Gateway æ§åˆ¶å™¨çš„å®ç°&lt;/h3&gt;
&lt;p&gt;å¥½æ¶ˆæ¯æ˜¯ï¼Œè™½ç„¶ Gateway è¿˜åœ¨ &lt;a href=&#34;https://github.com/kubernetes-sigs/gateway-api/releases&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Alpha&lt;/a&gt; é˜¶æ®µï¼Œä½†å·²ç»æœ‰å‡ ä¸ª &lt;a href=&#34;https://gateway-api.sigs.k8s.io/references/implementations/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gateway æ§åˆ¶å™¨å®ç°&lt;/a&gt;ï¼Œä½ å¯ä»¥è¿è¡Œã€‚ç”±äºå®ƒæ˜¯ä¸€ä¸ªæ ‡å‡†åŒ–çš„è§„æ ¼ï¼Œä¸‹é¢çš„ä¾‹å­éƒ½å¯ä»¥è¿è¡Œï¼Œè€Œä¸”åŠŸèƒ½åº”è¯¥å®Œå…¨ç›¸åŒã€‚æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å®‰è£…å’Œä½¿ç”¨è¿™äº› Gateway æ§åˆ¶å™¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®è·µ-gateway-api&#34;&gt;å®è·µ Gateway API&lt;/h2&gt;
&lt;p&gt;åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†å±•ç¤ºä¸åŒçš„ API èµ„æºä¹‹é—´çš„å…³ç³»ï¼Œå¹¶å¼•å¯¼ä½ å®Œæˆä¸€ä¸ªå¸¸è§çš„ä½¿ç”¨æ¡ˆä¾‹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;foo å›¢é˜Ÿåœ¨ foo å‘½åç©ºé—´ä¸­éƒ¨ç½²äº†ä»–ä»¬çš„åº”ç”¨ç¨‹åºã€‚ä»–ä»¬éœ€è¦æ§åˆ¶å…¶åº”ç”¨ç¨‹åºçš„ä¸åŒé¡µé¢çš„è·¯ç”±é€»è¾‘ã€‚&lt;/li&gt;
&lt;li&gt;Team bar æ­£åœ¨ bar å‘½åç©ºé—´ä¸­è¿è¡Œã€‚ä»–ä»¬å¸Œæœ›èƒ½å¤Ÿå¯¹ä»–ä»¬çš„åº”ç”¨ç¨‹åºè¿›è¡Œè“ç»¿éƒ¨ç½²ä»¥å‡å°‘é£é™©ã€‚&lt;/li&gt;
&lt;li&gt;å¹³å°å›¢é˜Ÿè´Ÿè´£ç®¡ç† Kubernetes é›†ç¾¤ä¸­æ‰€æœ‰åº”ç”¨ç¨‹åºçš„è´Ÿè½½å‡è¡¡å™¨å’Œç½‘ç»œå®‰å…¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢çš„ foo-route å¯¹ foo å‘½åç©ºé—´ä¸­çš„å„ç§æœåŠ¡è¿›è¡Œè·¯å¾„åŒ¹é…ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªåˆ° 404 æœåŠ¡å™¨çš„é»˜è®¤è·¯ç”±ã€‚è¿™é€šè¿‡ &lt;code&gt;foo.example.com/login&lt;/code&gt; å’Œ &lt;code&gt;foo.example.com/home&lt;/code&gt; åˆ†åˆ«æš´éœ²äº† foo-auth å’Œ foo-home æœåŠ¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTPRoute&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.x-k8s.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;foo-route&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;gateway&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;external-https-prod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hostnames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;foo.example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;matches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Prefix&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/login&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;forwardTo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;foo-auth&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;matches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Prefix&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/home&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;forwardTo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;foo-home&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;matches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Prefix&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;forwardTo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;foo-404&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨åŒä¸€ä¸ª Kubernetes é›†ç¾¤çš„ bar å‘½åç©ºé—´ä¸­è¿è¡Œçš„ bar å›¢é˜Ÿä¹Ÿå¸Œæœ›å°†ä»–ä»¬çš„åº”ç”¨ç¨‹åºæš´éœ²åœ¨äº’è”ç½‘ä¸Šï¼Œä½†ä»–ä»¬ä¹Ÿå¸Œæœ›æ§åˆ¶è‡ªå·±çš„é‡‘ä¸é›€å‘å¸ƒå’Œè“ç»¿éƒ¨ç½²ã€‚ä¸‹é¢çš„ HTTPRoute è¢«é…ç½®ä¸ºä»¥ä¸‹è¡Œä¸ºã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äºè®¿é—® &lt;code&gt;bar.example.com&lt;/code&gt;çš„æµé‡ï¼š
&lt;ul&gt;
&lt;li&gt;å°† 90% çš„æµé‡å‘é€åˆ° bar-v1&lt;/li&gt;
&lt;li&gt;å°† 10% çš„æµé‡å‘é€åˆ° bar-v2&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¯¹äºè®¿é—® &lt;code&gt;bar.example.com&lt;/code&gt; çš„æµé‡ï¼ŒHTTP header ä¸º &lt;code&gt;env: canary&lt;/code&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å°†æ‰€æœ‰çš„æµé‡å‘é€åˆ° bar-v2&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-the-routing-rules-configured-for-the-bar-v1-and-bar-v2-services&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;The routing rules configured for the bar-v1 and bar-v2 Services&#34; srcset=&#34;
               /blog/evolving-kubernetes-networking-with-the-gateway-api/008i3skNly1gpsl6via0rj31np0fxq5x_hu17555452796561273072.webp 400w,
               /blog/evolving-kubernetes-networking-with-the-gateway-api/008i3skNly1gpsl6via0rj31np0fxq5x_hu11996222496719994644.webp 760w,
               /blog/evolving-kubernetes-networking-with-the-gateway-api/008i3skNly1gpsl6via0rj31np0fxq5x_hu5891003975940492269.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/evolving-kubernetes-networking-with-the-gateway-api/008i3skNly1gpsl6via0rj31np0fxq5x_hu17555452796561273072.webp&#34;
               width=&#34;760&#34;
               height=&#34;203&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      The routing rules configured for the bar-v1 and bar-v2 Services
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTPRoute&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.x-k8s.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bar-route&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bar&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;gateway&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;external-https-prod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hostnames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;bar.example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;forwardTo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bar-v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;90&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bar-v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;matches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;values&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;canary&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;forwardTo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bar-v2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;è·¯ç”±å’Œç½‘å…³ç»‘å®š&#34;&gt;è·¯ç”±å’Œç½‘å…³ç»‘å®š&lt;/h3&gt;
&lt;p&gt;å› æ­¤ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ª HTTPRoute åŒ¹é…å¹¶å°†æµé‡è·¯ç”±åˆ°ä¸åŒçš„æœåŠ¡ã€‚ä½ å¯èƒ½æƒ³çŸ¥é“ï¼Œè¿™äº›æœåŠ¡åœ¨å“ªé‡Œå¯ä»¥è®¿é—®ï¼Ÿå®ƒä»¬æ˜¯é€šè¿‡å“ªäº›ç½‘ç»œæˆ– IP æš´éœ²çš„ï¼Ÿ&lt;/p&gt;
&lt;p&gt;è·¯ç”±å¦‚ä½•æš´éœ²ç»™å®¢æˆ·æ˜¯ç”±&lt;a href=&#34;https://gateway-api.sigs.k8s.io/concepts/api-overview/#route-binding&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è·¯ç”±ç»‘å®š&lt;/a&gt;ç®¡ç†çš„ï¼Œå®ƒæè¿°äº†è·¯ç”±å’Œç½‘å…³å¦‚ä½•åœ¨å½¼æ­¤ä¹‹é—´å»ºç«‹åŒå‘å…³ç³»ã€‚å½“è·¯ç”±ä¸ç½‘å…³ç»‘å®šæ—¶ï¼Œæ„å‘³ç€å®ƒä»¬çš„é›†ä½“è·¯ç”±è§„åˆ™è¢«é…ç½®åœ¨åº•å±‚è´Ÿè½½å‡è¡¡å™¨æˆ–ä»£ç†ä¸Šï¼Œå¹¶ä¸”è·¯ç”±å¯ä»¥é€šè¿‡ç½‘å…³è®¿é—®ã€‚å› æ­¤ï¼Œç½‘å…³æ˜¯ä¸€ä¸ªç½‘ç»œæ•°æ®å¹³é¢çš„é€»è¾‘è¡¨ç¤ºï¼Œå¯ä»¥é€šè¿‡è·¯ç”±é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-è·¯ç”±å¦‚ä½•ç»‘å®šåˆ°ç½‘å…³&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;è·¯ç”±å¦‚ä½•ç»‘å®šåˆ°ç½‘å…³&#34; srcset=&#34;
               /blog/evolving-kubernetes-networking-with-the-gateway-api/008i3skNly1gpsl6w3e9aj31fo0gotay_hu2205524796108199553.webp 400w,
               /blog/evolving-kubernetes-networking-with-the-gateway-api/008i3skNly1gpsl6w3e9aj31fo0gotay_hu8030765293624924398.webp 760w,
               /blog/evolving-kubernetes-networking-with-the-gateway-api/008i3skNly1gpsl6w3e9aj31fo0gotay_hu5562529403352749653.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/evolving-kubernetes-networking-with-the-gateway-api/008i3skNly1gpsl6w3e9aj31fo0gotay_hu2205524796108199553.webp&#34;
               width=&#34;760&#34;
               height=&#34;245&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      è·¯ç”±å¦‚ä½•ç»‘å®šåˆ°ç½‘å…³
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;è¡Œæ”¿æˆæƒ&#34;&gt;è¡Œæ”¿æˆæƒ&lt;/h3&gt;
&lt;p&gt;ç½‘å…³å’Œè·¯ç”±èµ„æºä¹‹é—´çš„åˆ†å‰²å…è®¸é›†ç¾¤ç®¡ç†å‘˜å°†ä¸€äº›è·¯ç”±é…ç½®å§”æ‰˜ç»™å„ä¸ªå›¢é˜Ÿï¼ŒåŒæ—¶ä»ç„¶ä¿ç•™é›†ä¸­æ§åˆ¶ã€‚ä¸‹é¢çš„ç½‘å…³èµ„æºåœ¨ 443 ç«¯å£æš´éœ² HTTPSï¼Œå¹¶ç”¨é›†ç¾¤ç®¡ç†å‘˜æ§åˆ¶çš„è¯ä¹¦ç»ˆæ­¢è¯¥ç«¯å£çš„æ‰€æœ‰æµé‡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Gateway&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.x-k8s.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;prod-web&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;gatewayClassName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;acme-lb&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;listeners&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTPS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;routes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTPRoute&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;gateway&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;external-https-prod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespaces&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;All&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;certificateRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;admin-controlled-cert&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹é¢çš„ HTTPRoute æ˜¾ç¤ºäº† Route å¦‚ä½•é€šè¿‡å®ƒçš„ &lt;code&gt;kind&lt;/code&gt;ï¼ˆHTTPRouteï¼‰å’Œèµ„æºæ ‡ç­¾ï¼ˆ&lt;code&gt;gateway=external-https-prod&lt;/code&gt;ï¼‰ç¡®ä¿å®ƒä¸ Gateway çš„é€‰æ‹©å™¨ç›¸åŒ¹é…ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# åŒ¹é…ç½‘å…³ä¸Šæ‰€éœ€çš„ kind é€‰æ‹©å™¨&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTPRoute&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;networking.x-k8s.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;foo-route&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;foo-ns&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# åŒ¹é…ç½‘å…³ä¸Šæ‰€éœ€çš„æ ‡ç­¾é€‰æ‹©å™¨&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;gateway&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;external-https-prod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ä»¥è§’è‰²ä¸ºå¯¼å‘çš„è®¾è®¡&#34;&gt;ä»¥è§’è‰²ä¸ºå¯¼å‘çš„è®¾è®¡&lt;/h3&gt;
&lt;p&gt;å½“ä½ æŠŠå®ƒæ”¾åœ¨ä¸€èµ·æ—¶ï¼Œä½ æœ‰ä¸€ä¸ªå•ä¸€çš„è´Ÿè½½å‡è¡¡åŸºç¡€è®¾æ–½ï¼Œå¯ä»¥è¢«å¤šä¸ªå›¢é˜Ÿå®‰å…¨åœ°å…±äº«ã€‚Gateway API ä¸ä»…æ˜¯ä¸€ä¸ªç”¨äºé«˜çº§è·¯ç”±çš„æ›´å…·è¡¨ç°åŠ›çš„ APIï¼Œè€Œä¸”æ˜¯ä¸€ä¸ªé¢å‘è§’è‰²çš„ APIï¼Œä¸ºå¤šç”¨æˆ·åŸºç¡€è®¾æ–½è€Œè®¾è®¡ã€‚å®ƒçš„å¯æ‰©å±•æ€§ç¡®ä¿äº†å®ƒåœ¨ä¿æŒå¯ç§»æ¤æ€§çš„åŒæ—¶ï¼Œè¿˜èƒ½ä¸ºæœªæ¥çš„ä½¿ç”¨åœºæ™¯è€Œå‘å±•ã€‚æœ€ç»ˆï¼Œè¿™äº›ç‰¹æ€§å°†ä½¿ Gateway API åœ¨æœªæ¥é€‚åº”ä¸åŒçš„ç»„ç»‡æ¨¡å¼å’Œå®æ–½æ–¹å¼ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å°è¯•å’Œå‚ä¸&#34;&gt;å°è¯•å’Œå‚ä¸&lt;/h3&gt;
&lt;p&gt;æœ‰è®¸å¤šèµ„æºå¯ä¾›æŸ¥é˜…ï¼Œä»¥äº†è§£æ›´å¤šã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æŸ¥é˜…&lt;a href=&#34;https://gateway-api.sigs.k8s.io/guides/getting-started/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç”¨æˆ·æŒ‡å—&lt;/a&gt;ï¼Œçœ‹çœ‹å¯ä»¥è§£å†³å“ªäº›ç”¨ä¾‹ã€‚&lt;/li&gt;
&lt;li&gt;è¯•ç”¨ç°æœ‰çš„&lt;a href=&#34;https://gateway-api.sigs.k8s.io/references/implementations/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç½‘å…³æ§åˆ¶å™¨&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æˆ–è€…&lt;a href=&#34;https://gateway-api.sigs.k8s.io/contributing/community/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‚ä¸è¿›æ¥&lt;/a&gt;ï¼Œå¸®åŠ©è®¾è®¡å¹¶å½±å“ Kubernetes æœåŠ¡ç½‘ç»œçš„æœªæ¥ï¼&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>åŒç¨‹æ—…è¡Œå¤§æ•°æ®é›†ç¾¤åœ¨ Kubernetes ä¸Šçš„æœåŠ¡åŒ–å®è·µ</title>
      <link>https://cloudnativecn.com/blog/2021-tongchenglvxing-shared/</link>
      <pubDate>Fri, 09 Apr 2021 02:40:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/2021-tongchenglvxing-shared/</guid>
      <description>&lt;p&gt;æœ¬æ–‡å°†å‘å¤§å®¶ä»‹ç»åŒç¨‹æ—…è¡Œå¤§æ•°æ®é›†ç¾¤åœ¨ Kubernetes ä¸ŠæœåŠ¡åŒ–å»ºè®¾çš„ä¸€äº›å®è·µå’Œç»éªŒã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;åŒç¨‹æ—…è¡Œå¤§æ•°æ®é›†ç¾¤ä» 2017 å¹´å¼€å§‹å®¹å™¨åŒ–æ”¹é€ ï¼Œç»å†äº†è‡ªç ”è°ƒåº¦ docker å®¹å™¨ï¼Œåˆ°ç°åœ¨çš„&lt;code&gt;äº‘èˆ±&lt;/code&gt;å¹³å°ï¼Œé‡‡ç”¨ &lt;code&gt;Kubernetes&lt;/code&gt; è°ƒåº¦ç¼–æ’å·¥å…·ç®¡ç†å¤§æ•°æ®é›†ç¾¤æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/2021-tongchenglvxing-shared/k8s%E6%BC%94%E8%BF%9B_hu12552818705488387887.webp 400w,
               /blog/2021-tongchenglvxing-shared/k8s%E6%BC%94%E8%BF%9B_hu6650528628609366321.webp 760w,
               /blog/2021-tongchenglvxing-shared/k8s%E6%BC%94%E8%BF%9B_hu17408789883869721509.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/2021-tongchenglvxing-shared/k8s%E6%BC%94%E8%BF%9B_hu12552818705488387887.webp&#34;
               width=&#34;760&#34;
               height=&#34;181&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­é‡åˆ°å¾ˆå¤šé—®é¢˜å’Œéš¾ç‚¹ï¼Œæœ¬æ–‡ä¼šå‘å¤§å®¶ä»‹ç»ä¸Šäº‘è¿‡ç¨‹ä¸­æ€»ç»“çš„ç»éªŒå’Œæ•™è®­ã€‚&lt;/p&gt;
&lt;p&gt;ä»Šå¤©çš„è®®é¢˜ä¸»è¦åˆ†ä¸‹é¢å‡ ç‚¹æ¥é˜è¿°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ºä»€ä¹ˆè¦å°†å¤§æ•°æ®é›†ç¾¤æœåŠ¡æ¬åˆ° Kubernetes ä¸Š&lt;/li&gt;
&lt;li&gt;åœ¨ä¸Šäº‘çš„è¿‡ç¨‹é‡åˆ°å“ªäº›ç—›ç‚¹&lt;/li&gt;
&lt;li&gt;å¤§æ•°æ®æœåŠ¡ä¸Šäº‘æ”»ç•¥&lt;/li&gt;
&lt;li&gt;ç°çŠ¶å’Œæœªæ¥å‘å±•&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é›†ç¾¤å³æœåŠ¡çš„ç†å¿µ&#34;&gt;é›†ç¾¤å³æœåŠ¡çš„ç†å¿µ&lt;/h2&gt;
&lt;p&gt;éƒ¨é—¨å†…éƒ¨å¾ˆæ—©å°±æå‡ºé›†ç¾¤å³æœåŠ¡çš„ç†å¿µï¼Œä½œä¸ºåŸºç¡€ç»„ä»¶ç ”å‘ï¼Œå¸Œæœ›ä»äº§å“çš„è§’åº¦æ¥çœ‹å¾…ç»„ä»¶æˆ–è€…é›†ç¾¤ï¼Œè®©ä¸šåŠ¡ç ”å‘èƒ½ç›´æ¥è§¦è¾¾åº•å±‚é›†ç¾¤ï¼Œå¯ä»¥åŒ…å«èŠ‚ç‚¹ã€æ—¥å¿—ã€ç›‘æ§ç­‰åŠŸèƒ½ï¼Œè®©é›†ç¾¤ä½¿ç”¨æ›´ç®€å•ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ¨è¡Œå°é›†ç¾¤åŒ–&#34;&gt;æ¨è¡Œå°é›†ç¾¤åŒ–&lt;/h3&gt;
&lt;p&gt;ä»¥å‰ç»„ä»¶ç ”å‘éƒ¨ç½²ä¸€ä¸ªç»„ä»¶é›†ç¾¤ï¼Œè¿™ä¸ªé›†ç¾¤ä¼šé™†ç»­æ‰¿æ¥ä¸€äº›ä¸šåŠ¡ï¼Œæ—¶å¸¸ä¼šé‡åˆ° A ä¸šåŠ¡å½±å“ B ä¸šåŠ¡ï¼Œé›†ç¾¤è´Ÿè´£äººä¼šå¼€å§‹è€ƒè™‘æ‹†åˆ†ï¼Œæ­å»ºå‡ºä¸€ä¸ªæ–°é›†ç¾¤å°†æ¶ˆè€—èµ„æºçš„ä¸šåŠ¡æ‹†åˆ†å‡ºå»ã€‚è¿™ç§æ˜¯ä»¥äººå·¥ä»‹å…¥çš„æ–¹å¼å»è¯„ä¼°ä¸šåŠ¡ä½“é‡å¹¶åˆ†é…èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨éƒ¨é—¨å¼€å§‹æ¨è¡Œå°é›†ç¾¤æ¨¡å¼ï¼Œæ¯ä¸ªä¸šåŠ¡ç ”å‘ç»„éƒ½å¯ä»¥ç”³è¯·ä¸€ä¸ªæˆ–è€…å¤šä¸ªé›†ç¾¤ï¼Œåœ¨ç‰©ç†å±‚é¢åšåˆ°èµ„æºéš”ç¦»ï¼Œäº’ä¸å½±å“ï¼Œä¸ä¼šå› ä¸º A ä¸šåŠ¡çš„æµé‡ä¸Šå‡è€Œå½±å“å…¶ä»–ä¸šåŠ¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è‡ªåŠ¨åŒ–è¿ç»´å»ºè®¾&#34;&gt;è‡ªåŠ¨åŒ–è¿ç»´å»ºè®¾&lt;/h3&gt;
&lt;p&gt;å°é›†ç¾¤åŒ–ä¼šå¯¼è‡´é›†ç¾¤æ•°é‡æˆå€çš„ä¸Šå‡ï¼Œå¦‚æœä¸åšè‡ªåŠ¨åŒ–è¿ç»´ï¼ŒäººåŠ›ä¼šè¿œè¿œè·Ÿä¸ä¸Šä¸šåŠ¡å¢é•¿ï¼Œåˆ°é‚£æ—¶ç»„ä»¶ç ”å‘ä¼šæ·¹æ²¡åœ¨æ•‘ç«å’Œè¿ç»´çš„æµ·æ´‹ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥éœ€è¦æ„å»ºä¸€ä¸ªé›†ç¾¤å…¨æµç¨‹è‡ªåŠ¨åŒ–å¹³å°ã€‚è¿™é‡Œé¢åŒ…å«æœåŠ¡ç”³è¯·ï¼ŒæœåŠ¡éƒ¨ç½²ï¼ŒæœåŠ¡è¿ç»´ç­‰åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/2021-tongchenglvxing-shared/devops%E5%8A%9F%E8%83%BD_hu4631385847257142812.webp 400w,
               /blog/2021-tongchenglvxing-shared/devops%E5%8A%9F%E8%83%BD_hu18113215885623029458.webp 760w,
               /blog/2021-tongchenglvxing-shared/devops%E5%8A%9F%E8%83%BD_hu10831752773962182212.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/2021-tongchenglvxing-shared/devops%E5%8A%9F%E8%83%BD_hu4631385847257142812.webp&#34;
               width=&#34;760&#34;
               height=&#34;83&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;å¦‚ä½•åˆ©ç”¨-kubernetes-åˆ©å™¨&#34;&gt;å¦‚ä½•åˆ©ç”¨ Kubernetes åˆ©å™¨&lt;/h3&gt;
&lt;p&gt;èµ·åˆè‡ªç ”ç¼–æ’å·¥å…·å»è°ƒåº¦å®¹å™¨ï¼Œä½†æ˜¯å®ç°çš„ä¸œè¥¿å¤ªå¤šï¼Œåœ¨äººåŠ›æœ‰é™çš„æƒ…å†µä¸‹ï¼Œè®¤ä¸ºè¿™æ¡è·¯ä¸å¯è¡Œã€‚&lt;/p&gt;
&lt;p&gt;2019 å¹´å¼€å§‹é‡‡ç”¨ &lt;code&gt;Kubernetes&lt;/code&gt; è°ƒåº¦ç¼–æ’å®¹å™¨ï¼Œå…ˆåé‡‡å–è¿‡ç”¨&lt;code&gt;Helm&lt;/code&gt; å·¥å…·ç¼–å†™æ¨¡æ¿éƒ¨ç½²ç»„ä»¶ï¼Œç”¨&lt;code&gt;Operator&lt;/code&gt;çš„æ–¹å¼ç®¡ç†æœåŠ¡ï¼Œç”¨ Statefulset/Deployment éƒ¨ç½²å¤§æ•°æ®é›†ç¾¤ã€‚è¿™äº›æ–¹å¼æœ€åéƒ½è¢«æ”¾å¼ƒã€‚Helm åªæ˜¯è§£å†³äº†éƒ¨ç½²çš„é—®é¢˜ï¼Œæƒ³è¦åŸºäº &lt;code&gt;Helm&lt;/code&gt; åšå¹³å°ç²¾ç»†åŒ–è¿ç»´æ¯”è¾ƒéº»çƒ¦ã€‚Operator çš„ç†å¿µæ˜¯é’ˆå¯¹æŸä¸ªç»„ä»¶åšè‡ªå®šä¹‰ CRDï¼Œå¤§æ•°æ®æœåŠ¡æœ‰åå‡ ç§ç»„ä»¶ï¼Œä¸ºæ¯ä¸ªç»„ä»¶ä¸“é—¨å®šåˆ¶ Operatorï¼Œè¿ç»´å’Œå¼€å‘æˆæœ¬è¿‡å¤§ï¼ŒåŸºäºæ­¤è¿˜è¦è§£å†³ Operator å’Œå¹³å°å±‚çš„äº¤äº’é€»è¾‘ï¼Œè¿™ä¸ªä¹Ÿä¸é€‚åˆåŒç¨‹çš„äººåŠ›é…æ¯”ã€‚&lt;code&gt;Statefulset&lt;/code&gt;å’Œ&lt;code&gt;Deployment&lt;/code&gt; æ²¡æ³•åšåˆ°ç²¾ç»†åŒ–è¿ç»´ï¼Œæ¯”å¦‚ä¸šåŠ¡æå‡ºå…³é—­æŸä¸ªæŒ‡å®šçš„ç‚¹ï¼Œå½“ä¸šåŠ¡é€»è¾‘å’Œåº•å±‚è¿ç»´é€»è¾‘è€¦åˆåœ¨ä¸€èµ·çš„æ—¶å€™ï¼Œå·²ç»å°è£…å¥½çš„ Workload å¹¶ä¸èƒ½æ‹¿æ¥å³ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºæ˜¯å¤§æ•°æ®ç”Ÿæ€ï¼ŒåŒç¨‹é€‰æ‹©é‡‡ç”¨&lt;code&gt;Java Client&lt;/code&gt; å’Œ &lt;code&gt;Kubernetes&lt;/code&gt; è¿›è¡Œäº¤äº’ï¼Œåœ¨&lt;code&gt;Kuberentes&lt;/code&gt; ä¸Šè‡ªç ” &lt;code&gt;äº‘èˆ±&lt;/code&gt; è°ƒåº¦å™¨ï¼Œå°†è¿ç»´ä¾§ä¸šåŠ¡é€»è¾‘å’Œå¹³å°äº¤äº’ä»£ç æ”¾åœ¨ä¸€èµ·ï¼Œæ„å»ºäº†ä¸€å¥—é€‚åˆè‡ªå·±çš„å¤§æ•°æ®æœåŠ¡è‡ªåŠ¨åŒ–è¿ç»´æ¡†æ¶ï¼Œå½“å‰è¦†ç›–äº†å‡ ä¹æ‰€æœ‰çš„å¤§æ•°æ®æœåŠ¡ï¼Œè®¡ç®—ç»„ä»¶æœ‰ Hiveã€Prestoã€Yarnï¼Œå­˜å‚¨ç»„ä»¶æœ‰ HDFSã€ClickHouseã€Kafkaã€Kudu ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/2021-tongchenglvxing-shared/%E4%BA%A4%E4%BA%92%E6%B5%81%E7%A8%8B_hu13103540012293217375.webp 400w,
               /blog/2021-tongchenglvxing-shared/%E4%BA%A4%E4%BA%92%E6%B5%81%E7%A8%8B_hu11742735412214539169.webp 760w,
               /blog/2021-tongchenglvxing-shared/%E4%BA%A4%E4%BA%92%E6%B5%81%E7%A8%8B_hu518306757647298313.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/2021-tongchenglvxing-shared/%E4%BA%A4%E4%BA%92%E6%B5%81%E7%A8%8B_hu13103540012293217375.webp&#34;
               width=&#34;760&#34;
               height=&#34;240&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;ä¸Šäº‘è¿‡ç¨‹é‡åˆ°äº†å“ªäº›ç—›ç‚¹&#34;&gt;ä¸Šäº‘è¿‡ç¨‹é‡åˆ°äº†å“ªäº›ç—›ç‚¹&lt;/h2&gt;
&lt;h3 id=&#34;kubernetes-ç¯å¢ƒé—®é¢˜&#34;&gt;Kubernetes ç¯å¢ƒé—®é¢˜&lt;/h3&gt;
&lt;p&gt;ç”±äºå¤§æ•°æ®ç»„ä»¶æœ‰å¾ˆå¤šæ˜¯åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿï¼Œç»„ä»¶æœ¬èº«ä¼šè¦æ±‚å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯èƒ½å¤Ÿç½‘ç»œäº’é€šï¼Œç«¯åˆ°ç«¯çš„å»ºç«‹è¿æ¥ã€‚è¿™å°±éœ€è¦&lt;code&gt;Kubernetes&lt;/code&gt;å®¹å™¨ç½‘ç»œè¦å’Œå¤–éƒ¨ç‰©ç†ç½‘ç»œæ‰“é€šï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é‡‡ç”¨&lt;code&gt;Proxy&lt;/code&gt;å±‚æ¥å±è”½åº•å±‚å­˜å‚¨ã€‚åŒç¨‹å¤§æ•°æ®é€‰æ‹©æ„å»º &lt;code&gt;Underlay&lt;/code&gt; çš„å®¹å™¨ç½‘ç»œï¼Œåšåˆ° IP ä¿æŒï¼Œå®¹å™¨ IP æå‰åˆ†é…ï¼ŒIP è‡ªåŠ¨å›æ”¶ç­‰åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;å°†&lt;code&gt;Service&lt;/code&gt;å±‚ç½‘ç»œå’Œå…¬å¸å››å±‚è´Ÿè½½ &lt;code&gt;TVS&lt;/code&gt; æœåŠ¡åšåˆ°å¾ˆå¥½çš„é›†æˆï¼Œåˆ©ç”¨ Endpoints å’Œ Service äº‹ä»¶ç›‘å¬æ¥ä¿è¯è´Ÿè½½æ•°æ®çš„ä¸€è‡´æ€§ã€‚ç”±äºç½‘ç»œç¯å¢ƒçš„é™åˆ¶ï¼Œä¸€ä¸ªæœºæˆ¿æ²¡æœ‰åŠæ³•åªæ­å»ºä¸€ä¸ª Kuberntes é›†ç¾¤ï¼Œéœ€è¦æ”¯æŒä¸€ä¸ªåº”ç”¨è·¨å¤š&lt;code&gt;Kubernetes&lt;/code&gt;é›†ç¾¤éƒ¨ç½²ï¼Œè´Ÿè½½æœåŠ¡è¦æ”¯æŒè·¨å¤šä¸ª&lt;code&gt;Kubernetes&lt;/code&gt;é›†ç¾¤çš„åº”ç”¨è´Ÿè½½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;DNS&lt;/code&gt; å±‚é‡‡ç”¨å­åŸŸçš„æ–¹å¼åšåˆ° Kubernetes å†…éƒ¨&lt;code&gt;CoreDns&lt;/code&gt; å’Œå…¬å¸&lt;code&gt;DNS&lt;/code&gt;æœåŠ¡å™¨æ•°æ®åŒæ­¥ï¼Œä¿è¯ä¸€è‡´æ€§ï¼Œä¿è¯å†…å¤–éƒ¨åŸŸåé€šä¿¡ä¸€è‡´ã€‚ç”±äºä¸€äº›ç»„ä»¶è¿ç§»çš„éœ€æ±‚ï¼Œéœ€è¦æä¾›åœ¨å®¹å™¨æ‹‰èµ·æ¥ä¹‹å‰é¢„å…ˆé…ç½®&lt;code&gt;DNS&lt;/code&gt;å’Œ&lt;code&gt;IP&lt;/code&gt;æ˜ å°„çš„åŠŸèƒ½ï¼Œæ‰€ä»¥åªå¥½æ ¹æ®å·²çŸ¥çš„&lt;code&gt;Pod&lt;/code&gt;æ ‡è¯†ï¼Œæå‰åˆ†é… IPã€‚&lt;/p&gt;
&lt;h3 id=&#34;åŸºäº-pod-çš„æ–¹å¼ç®¡ç†å®¹å™¨&#34;&gt;åŸºäº Pod çš„æ–¹å¼ç®¡ç†å®¹å™¨&lt;/h3&gt;
&lt;p&gt;åˆšå¼€å§‹çš„æ—¶å€™é‡‡ç”¨&lt;code&gt;Statefulset&lt;/code&gt;æ¥éƒ¨ç½²ä¸€äº›æœåŠ¡ï¼Œä¸€äº›å¼€æºçš„ Operator ä¹Ÿæ˜¯åŸºäº&lt;code&gt;STS&lt;/code&gt;ç®¡ç†æœåŠ¡ï¼Œæ¯”å¦‚æˆ‘æ­£åœ¨æŒç»­è´¡çŒ®çš„ &lt;code&gt;TiDB Operator&lt;/code&gt; ã€&lt;code&gt;Prometheus Operator&lt;/code&gt;ã€‚è™½ç„¶å¯ä»¥å¤ç”¨å·²æœ‰ Workload çš„åŠŸèƒ½ï¼Œä½†æ˜¯å½“åœºæ™¯å¤æ‚ï¼Œè¿™ä¹ˆåšåè€Œä¼šç¼ç¼è¡¥è¡¥ã€‚å¤§æ•°æ®ç»„ä»¶å°±æ˜¯è¿™æ ·ä¸€ä¸ªå¤æ‚çš„åœºæ™¯ï¼Œæ‰€ä»¥å†³å®šé‡‡ç”¨çº¯&lt;code&gt;Pod&lt;/code&gt;ç®¡ç†å®¹å™¨ï¼ŒåŸºäº Pod å»ç»„è£…æˆ &lt;code&gt;Group&lt;/code&gt;ã€‚æ¯”å¦‚ HDFS ç»„ä»¶ï¼Œä¼šæ‹†åˆ†æˆ &lt;code&gt;namenode&lt;/code&gt; ã€&lt;code&gt;journalnode&lt;/code&gt;ã€&lt;code&gt;datanode&lt;/code&gt; è¿™ä¸‰ä¸ª&lt;code&gt;Group&lt;/code&gt;ï¼Œæ¯ä¸ª&lt;code&gt;Group&lt;/code&gt;å¯ä»¥ç†è§£ä¸ºæ˜¯åŒä¸€ç§èŠ‚ç‚¹ç±»å‹çš„å®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;%e5%ae%b9%e5%99%a8%e4%be%8b%e5%ad%90&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;pod-é…ç½®æœ‰çŠ¶æ€&#34;&gt;Pod é…ç½®æœ‰çŠ¶æ€&lt;/h3&gt;
&lt;p&gt;å­˜å‚¨ç»„ä»¶æœ‰ä¸ªæ˜æ˜¾çš„ç‰¹æ€§å°±æ˜¯é…ç½®æ–‡ä»¶ä¸­ä¼šæœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ï¼Œæ¯”å¦‚&lt;code&gt;Zookeeper&lt;/code&gt;çš„ &lt;code&gt;myid&lt;/code&gt; , &lt;code&gt;Kafka&lt;/code&gt; çš„ &lt;code&gt;broker id&lt;/code&gt;ã€‚å°†è€é›†ç¾¤é€æ­¥è¿ç§»åˆ°&lt;code&gt;Kubernetes&lt;/code&gt;ä¸Šçš„æ—¶å€™ï¼Œè¿™äº›é…ç½®é¡¹éœ€è¦è‡ªå®šä¹‰ä¸”æŒä¹…åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/2021-tongchenglvxing-shared/%E9%85%8D%E7%BD%AE%E7%8A%B6%E6%80%81%E9%A1%B5%E9%9D%A2_hu8999205835617487072.webp 400w,
               /blog/2021-tongchenglvxing-shared/%E9%85%8D%E7%BD%AE%E7%8A%B6%E6%80%81%E9%A1%B5%E9%9D%A2_hu18034151470273815691.webp 760w,
               /blog/2021-tongchenglvxing-shared/%E9%85%8D%E7%BD%AE%E7%8A%B6%E6%80%81%E9%A1%B5%E9%9D%A2_hu13236965954040177923.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/2021-tongchenglvxing-shared/%E9%85%8D%E7%BD%AE%E7%8A%B6%E6%80%81%E9%A1%B5%E9%9D%A2_hu8999205835617487072.webp&#34;
               width=&#34;760&#34;
               height=&#34;417&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦‚æœç»„ä»¶æœ¬èº«çš„é…ç½®æ–‡ä»¶æ ¼å¼æ¯”è¾ƒå›ºå®šï¼Œä¼šåšæˆæ¨¡æ¿åŒ–ï¼Œå°†ç‰¹å®šçš„é…ç½®é¡¹æŠ½å‡ºæ¥æä¾›ç»™ç»„ä»¶ç ”å‘é…ç½®ï¼Œé€šè¿‡ç¯å¢ƒå˜é‡çš„æ–¹å¼æ³¨å…¥åˆ°å®¹å™¨ä¸­ã€‚å¯¹äºè‡ªå®šä¹‰ç‰¹åˆ«å¼ºçš„ç»„ä»¶ï¼Œä¼šåŸºäº&lt;code&gt;ConfigMap&lt;/code&gt;åšé…ç½®çš„ç‰ˆæœ¬æ§åˆ¶ï¼Œè®©ç»„ä»¶ç ”å‘å¯ä»¥å¾ˆæ–¹ä¾¿çš„å¡«å†™é…ç½®å¹¶æ¨é€é…ç½®ï¼Œ&lt;code&gt;ClickHouse&lt;/code&gt; å°±æ˜¯éå¸¸è‡ªå®šä¹‰é…ç½®çš„ç»„ä»¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä»¥è™šæ‹Ÿæœºçš„æ–¹å¼å¯åŠ¨å®¹å™¨&#34;&gt;ä»¥è™šæ‹Ÿæœºçš„æ–¹å¼å¯åŠ¨å®¹å™¨&lt;/h3&gt;
&lt;p&gt;ç”¨&lt;code&gt;Kubernetes&lt;/code&gt;éƒ¨ç½²æœ‰çŠ¶æ€æœåŠ¡çš„æ—¶å€™ï¼Œç”±äºé…ç½®é”™è¯¯ä¼šå¯¼è‡´å®¹å™¨åå¤&lt;code&gt;crash&lt;/code&gt;,è¿™ä¸ªæ—¶å€™ç»„ä»¶ç ”å‘åªå¸Œæœ›å¿«é€Ÿè¿›å…¥ç°åœºæ’æŸ¥é—®é¢˜ï¼Œæ‰€ä»¥é’ˆå¯¹å­˜å‚¨ç±»ç»„ä»¶å‡é‡‡ç”¨&lt;code&gt;tail -F&lt;/code&gt;çš„æ–¹å¼å¯åŠ¨å®¹å™¨ï¼Œè®©æœåŠ¡è¿›ç¨‹ä½œä¸ºåå°è¿›ç¨‹å¯åŠ¨ï¼Œé…ç½®å®Œå–„çš„å¥åº·æ£€æŸ¥ï¼Œå¿«é€Ÿå‘ç°èŠ‚ç‚¹çš„ä¸å¥åº·æ€§ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§æ–¹å¼è™½ç„¶è¿åäº†&lt;code&gt;Kubernetes&lt;/code&gt;çš„è®¾è®¡åŸåˆ™ï¼Œä½†æ˜¯æ˜“ç”¨æ€§ä¼šæ˜¾è‘—æå‡ã€‚åœ¨éƒ¨ç½² Yarn ç»„ä»¶çš„æ—¶å€™ï¼Œç”±äº&lt;code&gt;tail -F&lt;/code&gt;å‘½ä»¤ä¸ºä¸»è¿›ç¨‹ï¼Œå¯¼è‡´å¤§é‡åƒµå°¸è¿›ç¨‹ï¼Œæœ€åæ”¹ç”¨&lt;code&gt;bash&lt;/code&gt;å‘½ä»¤å¯åŠ¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;èµ„æºå¼‚æ„é—®é¢˜å’Œå¤šç›˜æŒ‚è½½é—®é¢˜&#34;&gt;èµ„æºå¼‚æ„é—®é¢˜å’Œå¤šç›˜æŒ‚è½½é—®é¢˜&lt;/h3&gt;
&lt;p&gt;åœ¨éƒ¨ç½² Yarn ç»„ä»¶è¿‡ç¨‹ä¸­ï¼Œç”±äºæœºå™¨è§„æ ¼çš„é—®é¢˜ï¼Œå¯¼è‡´åŒä¸€ä¸ªåº”ç”¨èŠ‚ç‚¹ä¹‹é—´çš„èµ„æºé…ç½®ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬è®¾è®¡é‡‡ç”¨åˆ’åˆ†èµ„æºæ± ï¼Œå°†ç›¸åŒè§„æ ¼çš„æœºå™¨åˆ†ä¸ºä¸€ä¸ªèµ„æºæ± ï¼Œä¸€ä¸ªåº”ç”¨æ ¹æ®èµ„æºæ± çš„é…ç½®æ¥è°ƒæ•´åˆé€‚çš„èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;åœ¨&lt;code&gt;Kubernetes&lt;/code&gt;ä¸­ä½¿ç”¨æœ¬åœ°ç›˜ï¼Œä¸€èˆ¬ä¼šæ¨è&lt;code&gt;localpv&lt;/code&gt;çš„æ–¹å¼ï¼Œå¤§æ•°æ®æŸäº›ç»„ä»¶ä¼šé‡‡ç”¨å¤šç›˜å†™å…¥çš„æ–¹å¼éƒ¨ç½²ï¼Œ&lt;code&gt;local pv&lt;/code&gt;çš„æ–¹å¼å¹¶ä¸èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åŒç¨‹å¤§æ•°æ®é€‰æ‹©é‡‡ç”¨&lt;code&gt;hostpath&lt;/code&gt;+&lt;code&gt;nodeselector&lt;/code&gt;çš„æ–¹å¼æ¥åšåˆ°å¤šç›˜ç»‘å®šä¸”èŠ‚ç‚¹ä¸æ¼‚ç§»ã€‚åœ¨æäº¤ç»™&lt;code&gt;Kubernetes Scheduler&lt;/code&gt;ä¹‹å‰ï¼Œä¼šåœ¨&lt;code&gt;äº‘èˆ±Scheduler&lt;/code&gt;åŸºäºèµ„æºæ± å’ŒèŠ‚ç‚¹ä¿¡æ¯å¯¹å®¹å™¨æå‰åšä¸€å±‚è°ƒåº¦ã€‚
èµ·åˆå‡†å¤‡ç”¨&lt;code&gt;hostpath&lt;/code&gt;+&lt;code&gt;nodename&lt;/code&gt;çš„æ–¹å¼æ¥åšåˆ°èŠ‚ç‚¹ä¸æ¼‚ç§»ï¼Œä½†æ˜¯&lt;code&gt;nodename&lt;/code&gt; ä¼šè·³è¿‡ Scheduler update æ­¥éª¤ï¼Œå¹¶ä¸ä¼šè¿›è¡Œ &lt;code&gt;bind&lt;/code&gt; pvc ç­‰æ­¥éª¤ã€‚è¯¦æƒ…å¯ä»¥å‚è€ƒ &lt;a href=&#34;https://github.com/kubernetes/kubernetes/issues/93145&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;issue 93145&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;dns-é—®é¢˜&#34;&gt;DNS é—®é¢˜&lt;/h3&gt;
&lt;p&gt;å¤§æ•°æ®é‡Œé¢å¾ˆå¤šç»„ä»¶èŠ‚ç‚¹éƒ½é‡‡ç”¨ &lt;code&gt;hostname&lt;/code&gt; ä½œä¸ºèŠ‚ç‚¹æ ‡è¯†ï¼Œæ¯”å¦‚&lt;code&gt;NodeManager&lt;/code&gt;é‡‡ç”¨&lt;code&gt;hostname&lt;/code&gt;æ³¨å†Œï¼Œ&lt;code&gt;Hbase&lt;/code&gt;ç»„ä»¶è¦æ”¯æŒåŸŸååè§£ï¼Œ&lt;code&gt;Kudu&lt;/code&gt;çš„ master èŠ‚ç‚¹ä¾èµ–è‡ªèº«çš„åŸŸåæå‰é€šä¿¡ã€‚è¿™äº›éƒ½è¿èƒŒäº† Kubernetes çš„è®¾è®¡ç†å¿µï¼Œ&lt;code&gt;Kubernetes&lt;/code&gt; åˆ›å»ºå®¹å™¨ï¼ŒCNI åˆ†é…å¾—åˆ° IPï¼Œè¿›ç¨‹å¯åŠ¨ OKï¼Œå®¹å™¨å˜æˆ Ready çŠ¶æ€ï¼ŒPod çš„ Service åŸŸåæ‰èƒ½é€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;åŒç¨‹å¤§æ•°æ®é€‰æ‹©ç”¨&lt;code&gt;Host&lt;/code&gt;ç½‘ç»œéƒ¨ç½²å¤§éƒ¨åˆ†çš„å­˜å‚¨ç»„ä»¶ï¼Œæ²¿ç”¨å®¿ä¸»æœºç½‘ç»œï¼Œé™¤äº†&lt;code&gt;Kubernetes&lt;/code&gt;é›†ç¾¤å­åŸŸå¤–å†åˆ›å»ºä¸€ä¸ªå­åŸŸç”¨äºç»„ä»¶æœ¬èº«æ ‡è¯†ï¼Œè¿™æ ·ç»„ä»¶è¿ç§»ä¼šå¾ˆæ–¹ä¾¿ï¼Œä¹Ÿä¸æœ‰ç½‘ç»œæŸè€—çš„çƒ¦æ¼ã€‚ä½†æ˜¯è¦åšå¥½å®¿ä¸»æœºç«¯å£çš„ç®¡ç†åˆ’åˆ†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è°ƒåº¦é—®é¢˜&#34;&gt;è°ƒåº¦é—®é¢˜&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†æå‡èµ„æºåˆ©ç”¨ç‡ï¼Œ&lt;code&gt;äº‘èˆ±&lt;/code&gt; å¹³å°ä¼šæœ‰å¾ˆå¤šåˆ†æ—¶æ®µçš„éƒ¨ç½²ä»»åŠ¡å’Œèµ„æºé”€æ¯ä»»åŠ¡ã€‚æ¯”å¦‚æŸä¸ª&lt;code&gt;Yarn&lt;/code&gt;é›†ç¾¤ï¼Œæ™šä¸Šçš„æ—¶å€™ï¼Œå¯¹å¯ä»¥æ··éƒ¨çš„èµ„æºæ± æ‰“ä¸Šæ ‡ç­¾ï¼Œåœ¨æ™šé«˜å³°çš„æ—¶å€™å°½å¯èƒ½çš„æ‰©å®¹&lt;code&gt;NodeManager&lt;/code&gt;ã€‚è¿™ä¸ªç±»ä¼¼äº&lt;code&gt;HPA&lt;/code&gt;ï¼Œç”±äºä¸šåŠ¡é€»è¾‘çš„å¤æ‚æ€§ï¼ŒåŒç¨‹åŸºäºè‡ªç ” &lt;code&gt;äº‘èˆ±Scheduler&lt;/code&gt; åšåˆ°è¿™ä¸€ç‚¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¤§æ•°æ®æœåŠ¡åŸºäº-kubernetes-çš„æ¶æ„ä½“ç³»&#34;&gt;å¤§æ•°æ®æœåŠ¡åŸºäº Kubernetes çš„æ¶æ„ä½“ç³»&lt;/h2&gt;
&lt;p&gt;ä»&lt;code&gt;2019&lt;/code&gt;å¹´å¼€å§‹è½¬å‘ &lt;code&gt;Kubernetes&lt;/code&gt; åˆ°ç°åœ¨ï¼ŒåŒç¨‹å·²ç»å»ºç«‹äº†ä¸€å¥—æˆç†Ÿçš„å¤§æ•°æ®æœåŠ¡&lt;code&gt;PAAS&lt;/code&gt;ä½“ç³»ã€‚
















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/2021-tongchenglvxing-shared/%E6%9E%B6%E6%9E%84_hu7804573487903145154.webp 400w,
               /blog/2021-tongchenglvxing-shared/%E6%9E%B6%E6%9E%84_hu4472288679174941598.webp 760w,
               /blog/2021-tongchenglvxing-shared/%E6%9E%B6%E6%9E%84_hu17353375903987510327.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/2021-tongchenglvxing-shared/%E6%9E%B6%E6%9E%84_hu7804573487903145154.webp&#34;
               width=&#34;717&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åŸºäº Kubernetes å±è”½åº•å±‚çš„åŸºç¡€è®¾æ–½ï¼Œæ”¯æŒå¤šæœºæˆ¿å¤š&lt;code&gt;Kubernetes&lt;/code&gt;é›†ç¾¤çš„åº”ç”¨éƒ¨ç½²ï¼Œé™¤äº†è¦è€ƒè™‘å„ç§å¤§æ•°æ®æœåŠ¡å¦‚ä½•è¿ç§»ä¸Šäº‘ï¼Œä¹Ÿè¦è€ƒè™‘æ•´ä¸ªå¹³å°çš„æ˜“ç”¨æ€§ï¼Œè®©ç»„ä»¶ç ”å‘æ— éœ€ç™»å½•æœºå™¨è¿›è¡Œè¿ç»´å’Œè¿ç§»ç­‰æ“ä½œã€‚åŒç¨‹è‡ªç ”äº†&lt;code&gt;äº‘èˆ±&lt;/code&gt;å¹³å°ï¼Œä¸»è¦æ‰¿æ‹…è¿™ä¸€èŒè´£ã€‚&lt;/p&gt;
&lt;p&gt;è€ƒè™‘åˆ°ä¸šåŠ¡ç ”å‘çš„æ¥å…¥æˆæœ¬ï¼Œå­¦ä¹ æˆæœ¬ï¼Œç ”å‘&lt;code&gt;æ§åˆ¶å°&lt;/code&gt;å¹³å°ï¼Œè®©åªè¯»çš„é›†ç¾¤ä¿¡æ¯å’Œé›†ç¾¤ç®¡ç†ç»“åˆèµ·æ¥ã€‚æ”¹å˜ä»¥å‰åº•å±‚ä¿¡æ¯è§¦æ‘¸ä¸åˆ°çš„æƒ…æ™¯ï¼Œè®©ä¸šåŠ¡ç ”å‘ä¹Ÿèƒ½åœ¨å¹³å°å±‚è·å–æ›´å¤šçš„ä¿¡æ¯ï¼Œå¯ä»¥å¯¹è‡ªå·±çš„æœåŠ¡åšå‡ºä¸€äº›åˆç†çš„åˆ¤æ–­ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç›‘æ§æ”¶é›†&#34;&gt;ç›‘æ§æ”¶é›†&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;Thanos&lt;/code&gt;+&lt;code&gt;Prometheus Operator&lt;/code&gt;æ¡†æ¶éƒ¨ç½²æ”¶é›†å„ä¸ªç»„ä»¶é›†ç¾¤çš„ç›‘æ§ï¼ŒæŒ‰ç…§ä»¥ä¸‹åŸåˆ™æ¥åšåˆ°ç›‘æ§çš„å¯æ‰©å±•ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªç»„ä»¶é›†ç¾¤å¯¹åº”ä¸€ä¸ª&lt;code&gt;Prometheus&lt;/code&gt;èŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªç»„ä»¶éƒ½å¯¹åº”ä¸€å¥—ç‹¬ç«‹çš„ Thanos é›†ç¾¤ï¼Œ&lt;code&gt;Thanos Query&lt;/code&gt; èšåˆåŒä¸€ç»„ä»¶çš„æ‰€æœ‰é›†ç¾¤ï¼Œ&lt;code&gt;Thanos Rule&lt;/code&gt; é€šè¿‡è‡ªç ”çš„&lt;code&gt;Sidecar&lt;/code&gt;åŒæ­¥ç»„ä»¶æŠ¥è­¦è§„åˆ™ï¼Œéƒ¨ç½²ç‹¬ç«‹çš„&lt;code&gt;AlterManager&lt;/code&gt;ï¼Œç‹¬ç«‹çš„&lt;code&gt;Grafana&lt;/code&gt;åº”ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªç»„ä»¶éƒ½æœ‰ä¸€ä¸ª ceph bucketï¼Œå°†å†å²ç›‘æ§æ•°æ®å­˜å‚¨åˆ°&lt;code&gt;Ceph&lt;/code&gt;ä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/2021-tongchenglvxing-shared/%E7%9B%91%E6%8E%A7_hu9620501066101648121.webp 400w,
               /blog/2021-tongchenglvxing-shared/%E7%9B%91%E6%8E%A7_hu14283603017917894343.webp 760w,
               /blog/2021-tongchenglvxing-shared/%E7%9B%91%E6%8E%A7_hu18283909278467117835.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/2021-tongchenglvxing-shared/%E7%9B%91%E6%8E%A7_hu9620501066101648121.webp&#34;
               width=&#34;760&#34;
               height=&#34;427&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç›‘æ§åŸŸåè§„åˆ™é…ç½®å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;Prometheus: &lt;code&gt;&amp;lt;åŸŸå&amp;gt;/prometheus/&amp;lt;ç»„ä»¶å&amp;gt;/&amp;lt;é›†ç¾¤åç§°&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Thanos Query:&lt;code&gt; &amp;lt;åŸŸå&amp;gt;/thanos/&amp;lt;ç»„ä»¶å&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Thanos Rule:&lt;code&gt; &amp;lt;åŸŸå&amp;gt;/thanos/rule/&amp;lt;ç»„ä»¶å&amp;gt;/alerts&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;AlertManger: &lt;code&gt; &amp;lt;åŸŸå&amp;gt;/thanos/alert/&amp;lt;ç»„ä»¶å&amp;gt;/#/alerts&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Grafana: &lt;code&gt; &amp;lt;åŸŸå&amp;gt;/grafana/&amp;lt;ç»„ä»¶å&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;é›†ç¾¤æœåŠ¡æ—¥å¿—æ”¶é›†&#34;&gt;é›†ç¾¤æœåŠ¡æ—¥å¿—æ”¶é›†&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;Filebeat&lt;/code&gt;é‡‡é›†é›†ç¾¤èŠ‚ç‚¹çš„æœåŠ¡æ—¥å¿—ï¼Œå°†&lt;code&gt;Filebeat&lt;/code&gt;å®¹å™¨å’ŒæœåŠ¡å®¹å™¨æ”¾åœ¨ä¸€ä¸ª&lt;code&gt;Pod&lt;/code&gt;ä¸­ï¼Œç”¨å¯Œå®¹å™¨çš„æ–¹å¼æ¥å¯åŠ¨æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/2021-tongchenglvxing-shared/%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86_hu9471894182432472101.webp 400w,
               /blog/2021-tongchenglvxing-shared/%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86_hu3295972579256756059.webp 760w,
               /blog/2021-tongchenglvxing-shared/%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86_hu10639971270745625301.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/2021-tongchenglvxing-shared/%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86_hu9471894182432472101.webp&#34;
               width=&#34;739&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨&lt;code&gt;Flink&lt;/code&gt;è®¡ç®—å±‚åšæ—¥å¿—è¯Šæ–­ï¼Œæä¾›é…ç½®è§„åˆ™åŠ¨æ€æ›´æ–°ï¼Œä¾¿äºæ›´å¿«é€Ÿå‘ç°é›†ç¾¤çš„æ•…éšœé—®é¢˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é›†ç¾¤ç”Ÿå‘½å‘¨æœŸå¹³å°åŒ–&#34;&gt;é›†ç¾¤ç”Ÿå‘½å‘¨æœŸå¹³å°åŒ–&lt;/h3&gt;
&lt;p&gt;ä¸€ä¸ªç»„ä»¶çš„é›†ç¾¤ä»ç”³è¯·åˆ›å»ºåˆ°æœåŠ¡é”€æ¯ä¸­é—´åŒ…å«å¾ˆå¤šç¯èŠ‚ï¼Œåº”è¯¥å°†è¿™äº›ç¯èŠ‚ç¨‹åºå¹¶å¹³å°åŒ–ï¼Œè®©åŸºç¡€æŠ€æœ¯èƒ½ä»¥å¹³å°ä»£ç çš„å½¢å¼æ²‰æ·€ä¸‹æ¥ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾æ˜¯ç”¨æˆ·ç”³è¯·&lt;code&gt;Hbase&lt;/code&gt;é›†ç¾¤æœåŠ¡çš„å·¥å•ï¼Œç”¨æˆ·åœ¨ç”³è¯·çš„æ—¶å€™åªéœ€è¦å¡«å†™å°‘é‡é…ç½®ã€‚ç®€å•å°±æ˜¯è®©ä¸šåŠ¡å°‘æ€è€ƒã€‚
















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;hbase%e6%9c%8d%e5%8a%a1%e7%94%b3%e8%af%b7&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç»„ä»¶&lt;code&gt;æ§åˆ¶å°&lt;/code&gt;ä¸ºä¸šåŠ¡ç ”å‘ä¾§æä¾›åªè¯»ä¿¡æ¯ï¼Œä¾‹å¦‚é›†ç¾¤ä¿¡æ¯ã€ç›‘æ§ã€æ—¥å¿—ã€æŠ¥è­¦ç­‰åŠŸèƒ½ï¼Œå’Œç»„ä»¶æœ¬èº«ç®¡æ§å¹³å°ç›¸ç»“åˆï¼Œä¸æä¾›æ“ä½œæˆ–è€…è¿ç»´é›†ç¾¤çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;hbase%e6%8e%a7%e5%88%b6%e5%8f%b0&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;code&gt;äº‘èˆ±å¹³å°&lt;/code&gt;ä¼šä¸ºç»„ä»¶ç ”å‘æä¾›å®Œå–„çš„è¿ç»´å’Œè¯Šæ–­åŠŸèƒ½ï¼Œè®©ä»–ä»¬æ— éœ€å…³å¿ƒåº•å±‚åŸºç¡€è®¾æ–½å±‚ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;hbase%e4%ba%91%e8%88%b1&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é›†ç¾¤æœåŠ¡åŒ–åï¼Œè®¡è´¹ï¼ŒæŠ¥è­¦é…ç½®ï¼Œæ—¥å¿—è¯Šæ–­èƒ½åŠŸèƒ½éƒ½èƒ½è½»æ¾çš„é›†æˆèµ·æ¥ã€‚
















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/2021-tongchenglvxing-shared/%E8%AE%A1%E8%B4%B9_hu10537656328367717063.webp 400w,
               /blog/2021-tongchenglvxing-shared/%E8%AE%A1%E8%B4%B9_hu10552472887181125278.webp 760w,
               /blog/2021-tongchenglvxing-shared/%E8%AE%A1%E8%B4%B9_hu4086752440651686485.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/2021-tongchenglvxing-shared/%E8%AE%A1%E8%B4%B9_hu10537656328367717063.webp&#34;
               width=&#34;760&#34;
               height=&#34;306&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;è‡ªç ”å¤§æ•°æ®äº‘åŸç”ŸæœåŠ¡æ¡†æ¶&#34;&gt;è‡ªç ”å¤§æ•°æ®äº‘åŸç”ŸæœåŠ¡æ¡†æ¶&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;äº‘èˆ±&lt;/code&gt;å¹³å°å°†æœåŠ¡åˆ†ä¸ºå•ä¸ªå®¹å™¨å’Œå¤šä¸ªå®¹å™¨ï¼Œç”¨æ•°é‡æ¥åŒºåˆ†ï¼Œåœ¨æ­¤ä¹‹ä¸Šç”¨ç»„è£…çš„æ–¹å¼æ”¯æŒå¤šèŠ‚ç‚¹ç±»å‹ï¼Œä¸€ä¸ªèŠ‚ç‚¹ç±»å‹å¯¹åº”ä¸€ä¸ª&lt;code&gt;Group&lt;/code&gt;,è¿™ä¸ª Group å°±æ˜¯ä¸€ç»„ç›¸åŒè§„æ ¼çš„å®¹å™¨ã€‚æ¯”å¦‚ Kudu ç»„ä»¶å°±åˆ†æˆä¸¤ä¸ª&lt;code&gt;Group&lt;/code&gt;,master å’Œ tserver ä¸¤ä¸ª&lt;code&gt;Group&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨ä¸€ä¸ª UML å›¾æ¥ç®€å•æè¿°ä»£ç å±‚ç»“æ„ï¼š
















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/2021-tongchenglvxing-shared/UML%E5%9B%BE_hu10578193804617529135.webp 400w,
               /blog/2021-tongchenglvxing-shared/UML%E5%9B%BE_hu3413362112973174332.webp 760w,
               /blog/2021-tongchenglvxing-shared/UML%E5%9B%BE_hu12533351858611661189.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/2021-tongchenglvxing-shared/UML%E5%9B%BE_hu10578193804617529135.webp&#34;
               width=&#34;760&#34;
               height=&#34;378&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¯¹&lt;code&gt;Kubernetes&lt;/code&gt;é›†ç¾¤çš„æ“ä½œä¼šåˆ†è§£æˆå¤šä¸ª&lt;code&gt;Task&lt;/code&gt;,&lt;code&gt;Task&lt;/code&gt;ä¹‹é—´æœ‰ä¾èµ–å…³ç³»ï¼Œç»„è£…æˆ&lt;code&gt;Job&lt;/code&gt;å‘é€ç»™&lt;code&gt;Kafka&lt;/code&gt;ï¼Œäº‘èˆ± Scheduler è¿›è¡Œæ¶ˆè´¹å’Œå¤„ç†ã€‚æ¯”å¦‚éƒ¨ç½²ä¸€ä¸ª&lt;code&gt;Zookeeper&lt;/code&gt;é›†ç¾¤ï¼Œå…ˆåˆ›å»ºå®¹å™¨ï¼Œå†åˆ›å»º&lt;code&gt;Service&lt;/code&gt;è´Ÿè½½ï¼Œé…ç½®&lt;code&gt;DNS&lt;/code&gt;ç­–ç•¥ï¼Œé…ç½®ç›‘æ§ï¼Œè¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„éƒ¨ç½²ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;%e4%bb%bb%e5%8a%a1%e6%ad%a5%e9%aa%a4&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;ç°çŠ¶&#34;&gt;ç°çŠ¶&lt;/h2&gt;
&lt;p&gt;å½“å‰åŒç¨‹å°†å‡ ä¹æ‰€æœ‰çš„å¤§æ•°æ®æœåŠ¡éƒ½é‡‡ç”¨ &lt;code&gt;Kubernetes&lt;/code&gt; å·¥å…·éƒ¨ç½²å’Œè°ƒåº¦ï¼Œæœ‰è¿‘&lt;code&gt;400+&lt;/code&gt;é›†ç¾¤æœåŠ¡è·‘åœ¨&lt;code&gt;Kubernetes&lt;/code&gt;ä¸Šï¼Œä¸€ä¸ªæ–°çš„ç»„ä»¶é›†ç¾¤å¯ä»¥åœ¨ 15 åˆ†é’Ÿä¹‹å†…å®Œæˆäº¤ä»˜ï¼Œæå¤§åœ°å‡å°‘ç»„ä»¶éƒ¨ç½²æ¶ˆè€—çš„æ—¶é—´ã€‚å½“æ‰€æœ‰çš„é›†ç¾¤æœåŠ¡è¢«å¹³å°åŒ–ç®¡ç†åï¼Œå¯¹äºæœºå™¨èµ„æºå±‚çš„è°ƒåº¦å’Œåˆ©ç”¨ç‡æå‡çš„éœ€æ±‚è¶Šæ¥è¶Šæ˜æ˜¾ï¼ŒåŒç¨‹åŸºäºèµ„æºç›‘æ§å¯¹ç»„ä»¶åšæ··åˆéƒ¨ç½²ï¼Œåˆ©ç”¨ç‡æå‡&lt;code&gt;30%&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¤§æ•°æ®åº•å±‚ä¸€èˆ¬ä¼šåˆ†ä¸ºè®¡ç®—å’Œå­˜å‚¨ï¼Œä½†æ˜¯éšç€æœºå™¨èµ„æºè¶Šæ¥è¶Šå¤šï¼Œèµ„æºå±‚çš„ç ”å‘ä¹Ÿæ˜¯å¾ˆå…³é”®çš„ä¸€ç¯ã€‚åŒç¨‹å¸Œæœ›å°†æ•°æ®ï¼Œèµ„æºï¼Œç®—æ³•æµç¨‹æ‰“é€šï¼Œè®©æ•°æ®ä½¿ç”¨æ›´ç®€å•ï¼Œè®©æ•°æ®å¤„ç†æ›´å¿«æ›´ç¨³å®šã€‚&lt;/p&gt;
&lt;p&gt;ä¸šç•Œæœ‰å¾ˆå¤šå…¬å¸ä¼šè€ƒè™‘å°†å¤§æ•°æ®è®¡ç®—ä»»åŠ¡ &lt;code&gt;native on Kubernetes&lt;/code&gt;,åŒç¨‹ä¹Ÿè¿›è¡Œè°ƒç ”å’Œå°è¯•ï¼Œå½“å‰å¤§å®¶éƒ½åªæ˜¯è§£å†³äº†éƒ¨ç½²çš„é—®é¢˜ï¼Œä»»åŠ¡çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸè¿˜éœ€è¦ç ”å‘å’Œæµ‹è¯•ã€‚æ‰€ä»¥åŒç¨‹è¿˜æ˜¯ç€é‡äº &lt;code&gt;Yarn&lt;/code&gt; on &lt;code&gt;Kubernetes&lt;/code&gt;,ä¸€äº›ç®—æ³•å’Œåˆ†æç±»çš„&lt;code&gt;Python&lt;/code&gt;ä»»åŠ¡ä¼šé‡‡ç”¨å®¹å™¨è°ƒåº¦æ–¹å¼è¿è¡Œã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœªæ¥æ–¹å‘&#34;&gt;æœªæ¥æ–¹å‘&lt;/h2&gt;
&lt;p&gt;åŒç¨‹å¤§æ•°æ®ä¸Šäº‘è¿˜æœ‰å¾ˆå¤šé—®é¢˜æ²¡æœ‰å»ä¼˜é›…çš„è§£å†³ï¼Œæ¯”å¦‚å·²æœ‰æœåŠ¡å¦‚ä½•å¹³æ»‘çš„é€šè¿‡å¹³å°çš„æ–¹å¼è¿ç§»ä¸Šäº‘ï¼Œç°åœ¨è¿˜æœ‰å¾ˆå¤šä¸­é—´è¿‡ç¨‹éœ€è¦èµ„æºç ”å‘ä»‹å…¥ã€‚&lt;/p&gt;
&lt;p&gt;æœªæ¥çš„æ–¹å‘ä¸»è¦åˆ†ä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é‡‡ç”¨æ··éƒ¨å’Œåˆ†æ—¶è°ƒåº¦ï¼Œæå‡é›†ç¾¤èµ„æºæ•´ä½“åˆ©ç”¨ç‡ã€‚&lt;/li&gt;
&lt;li&gt;ç”¨æ··æ²Œå·¥ç¨‹çš„æ–¹å¼æå‡ç»„ä»¶ç¨³å®šæ€§ã€‚&lt;/li&gt;
&lt;li&gt;è®¡ç®—ä»»åŠ¡ &lt;code&gt;native on Kubernetes&lt;/code&gt;,æä¾›é«˜ä¼˜ä¿éšœã€‚&lt;/li&gt;
&lt;li&gt;æŒç»­æå‡ PAAS å¹³å°æ˜“ç”¨æ€§ã€‚&lt;/li&gt;
&lt;li&gt;è®©åº•å±‚èµ„æºè§¦æ‰‹å¯åŠã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨ Kubernetes ä¸Šçš„è¿›åŒ–</title>
      <link>https://cloudnativecn.com/blog/distributed-systems-kubernetes/</link>
      <pubDate>Mon, 29 Mar 2021 22:30:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/distributed-systems-kubernetes/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ª &lt;a href=&#34;https://www.infoq.com/articles/distributed-systems-kubernetes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The Evolution of Distributed Systems on Kubernetes&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ 3 æœˆä»½çš„ QCon ä¸Šï¼Œæˆ‘åšäº†ä¸€ä¸ªå…³äº Kubernetes çš„åˆ†å¸ƒå¼ç³»ç»Ÿè¿›åŒ–çš„æ¼”è®²ã€‚é¦–å…ˆï¼Œæˆ‘æƒ³å…ˆé—®ä¸€ä¸ªé—®é¢˜ï¼Œå¾®æœåŠ¡ä¹‹åæ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ç›¸ä¿¡å¤§å®¶éƒ½æœ‰å„è‡ªçš„ç­”æ¡ˆï¼Œæˆ‘ä¹Ÿæœ‰æˆ‘çš„ç­”æ¡ˆã€‚ä½ ä¼šåœ¨æœ€åå‘ç°æˆ‘çš„æƒ³æ³•æ˜¯ä»€ä¹ˆã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œæˆ‘å»ºè®®å¤§å®¶çœ‹çœ‹åˆ†å¸ƒå¼ç³»ç»Ÿçš„éœ€æ±‚æ˜¯ä»€ä¹ˆï¼Ÿä»¥åŠè¿™äº›éœ€æ±‚åœ¨è¿‡å»æ˜¯å¦‚ä½•å‘å±•çš„ï¼Œä»å•ä½“åº”ç”¨å¼€å§‹åˆ° Kubernetesï¼Œå†åˆ°æœ€è¿‘çš„ Daprã€Istioã€Knative ç­‰é¡¹ç›®ï¼Œå®ƒä»¬æ˜¯å¦‚ä½•æ”¹å˜æˆ‘ä»¬åšåˆ†å¸ƒå¼ç³»ç»Ÿçš„æ–¹å¼ã€‚æˆ‘ä»¬å°†å°è¯•å¯¹æœªæ¥åšä¸€äº›é¢„æµ‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç°ä»£åˆ†å¸ƒå¼åº”ç”¨&#34;&gt;ç°ä»£åˆ†å¸ƒå¼åº”ç”¨&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†ç»™è¿™ä¸ªè¯é¢˜æä¾›æ›´å¤šçš„èƒŒæ™¯ä¿¡æ¯ï¼Œæˆ‘è®¤ä¸ºçš„åˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯ç”±æ•°ç™¾ä¸ªç»„ä»¶ç»„æˆçš„ç³»ç»Ÿã€‚è¿™äº›ç»„ä»¶å¯ä»¥æ˜¯æœ‰çŠ¶æ€çš„ã€æ— çŠ¶æ€çš„æˆ–è€…æ— æœåŠ¡å™¨çš„ã€‚æ­¤å¤–ï¼Œè¿™äº›ç»„ä»¶å¯ä»¥ç”¨ä¸åŒçš„è¯­è¨€åˆ›å»ºï¼Œè¿è¡Œåœ¨æ··åˆç¯å¢ƒä¸Šï¼Œå¹¶å¼€å‘å¼€æºæŠ€æœ¯ã€å¼€æ”¾æ ‡å‡†å’Œäº’æ“ä½œæ€§ã€‚æˆ‘ç›¸ä¿¡ä½ å¯ä»¥ä½¿ç”¨é—­æºè½¯ä»¶æ¥æ„å»ºè¿™æ ·çš„ç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥åœ¨ AWS å’Œå…¶ä»–åœ°æ–¹æ„å»ºã€‚å…·ä½“åˆ°è¿™æ¬¡æ¼”è®²ï¼Œæˆ‘å°†å…³æ³¨ Kubernetes ç”Ÿæ€ç³»ç»Ÿï¼Œä»¥åŠä½ å¦‚ä½•åœ¨ Kubernetes å¹³å°ä¸Šæ„å»ºè¿™æ ·ä¸€ä¸ªç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä»åˆ†å¸ƒå¼ç³»ç»Ÿçš„éœ€æ±‚è®²èµ·ã€‚æˆ‘è®¤ä¸ºæ˜¯æˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªåº”ç”¨æˆ–è€…æœåŠ¡ï¼Œå¹¶å†™ä¸€äº›ä¸šåŠ¡é€»è¾‘ã€‚é‚£ä»è¿è¡Œæ—¶çš„å¹³å°åˆ°æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä»€ä¹ˆå‘¢ï¼Ÿåœ¨åº•å±‚ï¼Œæœ€å¼€å§‹æ˜¯æˆ‘ä»¬è¦ä¸€äº›ç”Ÿå‘½å‘¨æœŸçš„èƒ½åŠ›ã€‚å½“ä½ ç”¨ä»»ä¸€è¯­è¨€å¼€å‘ä½ çš„åº”ç”¨æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰èƒ½åŠ›æŠŠè¿™ä¸ªåº”ç”¨å¯é åœ°æ‰“åŒ…å’Œéƒ¨ç½²ã€å›æ»šã€å¥åº·æ£€æŸ¥ã€‚å¹¶ä¸”èƒ½å¤ŸæŠŠåº”ç”¨éƒ¨ç½²åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œå¹¶å®ç°èµ„æºéš”ç¦»ã€æ‰©å±•ã€é…ç½®ç®¡ç†ï¼Œä»¥åŠæ‰€æœ‰è¿™äº›ã€‚è¿™äº›éƒ½æ˜¯ä½ åˆ›å»ºåˆ†å¸ƒå¼åº”ç”¨æ‰€éœ€è¦çš„ç¬¬ä¸€ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/distributed-systems-kubernetes/55image001-1616431697020_hu9131979445776838458.webp 400w,
               /blog/distributed-systems-kubernetes/55image001-1616431697020_hu7930013139641205576.webp 760w,
               /blog/distributed-systems-kubernetes/55image001-1616431697020_hu15692239461193842553.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/distributed-systems-kubernetes/55image001-1616431697020_hu9131979445776838458.webp&#34;
               width=&#34;760&#34;
               height=&#34;393&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒç‚¹æ˜¯å›´ç»•ç½‘ç»œã€‚æˆ‘ä»¬æœ‰äº†åº”ç”¨ä¹‹åï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒèƒ½å¤Ÿå¯é åœ°è¿æ¥åˆ°å…¶ä»–æœåŠ¡ï¼Œæ— è®ºè¯¥æœåŠ¡æ˜¯åœ¨é›†ç¾¤å†…éƒ¨è¿˜æ˜¯åœ¨å¤–éƒ¨ã€‚æˆ‘ä»¬å¸Œæœ›å…¶å…·æœ‰æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›ã€‚ä¸ºäº†ä¸åŒçš„å‘å¸ƒç­–ç•¥æˆ–æ˜¯å…¶ä»–çš„ä¸€äº›åŸå› çš„æˆ‘ä»¬å¸Œæœ›æœ‰æµé‡è½¬ç§»çš„èƒ½åŠ›ã€‚ç„¶åæˆ‘ä»¬è¿˜å¸Œæœ›å…¶å…·æœ‰ä¸å…¶ä»–ç³»ç»Ÿè¿›è¡Œå¼¹æ€§é€šä¿¡çš„èƒ½åŠ›ï¼Œæ— è®ºæ˜¯é€šè¿‡é‡è¯•ã€è¶…æ—¶è¿˜æ˜¯æ–­è·¯å™¨ã€‚è¦æœ‰é€‚å½“çš„å®‰å…¨ä¿éšœï¼Œå¹¶ä¸”è¦æœ‰è¶³å¤Ÿçš„ç›‘æ§ã€è¿½è¸ªã€å¯è§‚å¯Ÿæ€§ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/distributed-systems-kubernetes/25image002-1616431698392_hu8701719662680691179.webp 400w,
               /blog/distributed-systems-kubernetes/25image002-1616431698392_hu3065106969674822676.webp 760w,
               /blog/distributed-systems-kubernetes/25image002-1616431698392_hu11259500660724537834.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/distributed-systems-kubernetes/25image002-1616431698392_hu8701719662680691179.webp&#34;
               width=&#34;760&#34;
               height=&#34;399&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æœ‰äº†ç½‘ç»œä¹‹åï¼Œæ¥ä¸‹æ¥å°±æ˜¯æˆ‘ä»¬å¸Œæœ›æœ‰èƒ½åŠ›ä¸ä¸åŒçš„ API å’Œç«¯ç‚¹äº¤äº’ï¼Œå³èµ„æºç»‘å®š&amp;ndash;ä¸å…¶ä»–åè®®å’Œä¸åŒçš„æ•°æ®æ ¼å¼äº¤äº’ã€‚ç”šè‡³èƒ½å¤Ÿä»ä¸€ç§æ•°æ®æ ¼å¼è½¬æ¢æˆå¦ä¸€ç§æ•°æ®æ ¼å¼ã€‚æˆ‘è¿˜ä¼šåœ¨è¿™é‡ŒåŠ å…¥è¯¸å¦‚è¿‡æ»¤åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬è®¢é˜…ä¸€ä¸ªä¸»é¢˜æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿè®¸åªå¯¹æŸäº›äº‹ä»¶æ„Ÿå…´è¶£ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/distributed-systems-kubernetes/45image003-1616431697873_hu9753426525003081829.webp 400w,
               /blog/distributed-systems-kubernetes/45image003-1616431697873_hu6972971536173025823.webp 760w,
               /blog/distributed-systems-kubernetes/45image003-1616431697873_hu9035942388135368717.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/distributed-systems-kubernetes/45image003-1616431697873_hu9753426525003081829.webp&#34;
               width=&#34;760&#34;
               height=&#34;391&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½ è®¤ä¸ºæœ€åä¸€ç±»æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯çŠ¶æ€ã€‚å½“æˆ‘åœ¨è¯´çŠ¶æ€å’Œæœ‰çŠ¶æ€çš„æŠ½è±¡æ—¶ï¼Œæˆ‘å¹¶ä¸æ˜¯åœ¨è°ˆè®ºå®é™…çš„çŠ¶æ€ç®¡ç†ï¼Œæ¯”å¦‚æ•°æ®åº“æˆ–è€…æ–‡ä»¶ç³»ç»Ÿçš„åŠŸèƒ½ã€‚æˆ‘è¦è¯´çš„æ›´å¤šæ˜¯æœ‰å…³å¹•åä¾èµ–çŠ¶æ€çš„å¼€å‘äººå‘˜æŠ½è±¡ã€‚å¯èƒ½ï¼Œä½ éœ€è¦å…·æœ‰å·¥ä½œæµç®¡ç†çš„èƒ½åŠ›ã€‚ä¹Ÿè®¸ä½ æƒ³ç®¡ç†è¿è¡Œæ—¶é—´é•¿çš„è¿›ç¨‹æˆ–è€…åšä¸´æ—¶è°ƒåº¦æˆ–è€…æŸäº›å®šæ—¶ä»»åŠ¡æ¥å®šæœŸè¿è¡ŒæœåŠ¡ã€‚ä¹Ÿè®¸ä½ è¿˜æƒ³è¿›è¡Œåˆ†å¸ƒå¼ç¼“å­˜ï¼Œå…·æœ‰å¹‚ç­‰æ€§æˆ–è€…æ”¯æŒå›æ»šã€‚æ‰€æœ‰è¿™äº›éƒ½æ˜¯å¼€å‘äººå‘˜çº§çš„åŸè¯­ï¼Œä½†åœ¨å¹•åï¼Œå®ƒä»¬ä¾èµ–äºå…·æœ‰æŸç§çŠ¶æ€ã€‚ä½ æƒ³éšæ„ä½¿ç”¨è¿™äº›æŠ½è±¡æ¥åˆ›å»ºå®Œå–„çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/distributed-systems-kubernetes/26image004-1616431697348_hu5948608695338636896.webp 400w,
               /blog/distributed-systems-kubernetes/26image004-1616431697348_hu16225156866384803998.webp 760w,
               /blog/distributed-systems-kubernetes/26image004-1616431697348_hu5188712545243410462.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/distributed-systems-kubernetes/26image004-1616431697348_hu5948608695338636896.webp&#34;
               width=&#34;760&#34;
               height=&#34;430&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªåˆ†å¸ƒå¼ç³»ç»ŸåŸè¯­çš„æ¡†æ¶æ¥è¯„ä¼°å®ƒä»¬åœ¨ Kubernetes å’Œå…¶ä»–é¡¹ç›®ä¸Šçš„å˜åŒ–æƒ…å†µã€‚&lt;/p&gt;
&lt;h2 id=&#34;å•ä½“æ¶æ„ä¼ ç»Ÿä¸­é—´ä»¶åŠŸèƒ½&#34;&gt;å•ä½“æ¶æ„â€”â€”ä¼ ç»Ÿä¸­é—´ä»¶åŠŸèƒ½&lt;/h2&gt;
&lt;p&gt;å‡è®¾æˆ‘ä»¬ä»å•ä½“æ¶æ„ä»¥åŠå¦‚ä½•è·å¾—è¿™äº›èƒ½åŠ›å¼€å§‹ã€‚åœ¨é‚£ç§æƒ…å†µä¸‹ï¼Œé¦–å…ˆæ˜¯å½“æˆ‘è¯´å•ä½“çš„æ—¶å€™ï¼Œåœ¨åˆ†å¸ƒå¼åº”ç”¨çš„æƒ…å†µä¸‹æˆ‘æƒ³åˆ°çš„æ˜¯ ESBã€‚ESB æ˜¯ç›¸å½“å¼ºå¤§çš„ï¼Œå½“æˆ‘ä»¬æ£€æŸ¥æˆ‘ä»¬çš„éœ€æ±‚åˆ—è¡¨æ—¶ï¼Œæˆ‘ä»¬ä¼šè¯´ ESB å¯¹æ‰€æœ‰æœ‰çŠ¶æ€çš„æŠ½è±¡æœ‰å¾ˆå¥½çš„æ”¯æŒã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ ESBï¼Œä½ å¯ä»¥è¿›è¡Œé•¿æ—¶é—´è¿è¡Œçš„æµç¨‹çš„ç¼–æ’ã€åˆ†å¸ƒå¼äº‹åŠ¡ã€å›æ»šå’Œå¹‚ç­‰ã€‚æ­¤å¤–ï¼ŒESB è¿˜æä¾›äº†å‡ºè‰²çš„èµ„æºç»‘å®šèƒ½åŠ›ï¼Œå¹¶ä¸”æœ‰æ•°ç™¾ä¸ªè¿æ¥å™¨ï¼Œæ”¯æŒè½¬æ¢ã€ç¼–æ’ï¼Œç”šè‡³æœ‰è”ç½‘åŠŸèƒ½ã€‚æœ€åï¼ŒESB ç”šè‡³å¯ä»¥åšæœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ã€‚&lt;/p&gt;
&lt;p&gt;å®ƒå…·æœ‰å›´ç»•ç½‘ç»œè¿æ¥çš„å¼¹æ€§çš„æ‰€æœ‰åŠŸèƒ½ï¼Œå› æ­¤å®ƒå¯ä»¥è¿›è¡Œé‡è¯•ã€‚å¯èƒ½ ESB æœ¬è´¨ä¸Šä¸æ˜¯å¾ˆåˆ†å¸ƒå¼ï¼Œæ‰€ä»¥å®ƒä¸éœ€è¦éå¸¸é«˜çº§çš„ç½‘ç»œå’Œå‘å¸ƒèƒ½åŠ›ã€‚ESB æ¬ ç¼ºçš„ä¸»è¦æ˜¯ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚å› ä¸ºå®ƒæ˜¯å•ä¸€è¿è¡Œæ—¶ï¼Œæ‰€ä»¥ç¬¬ä¸€ä»¶äº‹å°±æ˜¯ä½ åªèƒ½ä½¿ç”¨ä¸€ç§è¯­è¨€ã€‚é€šå¸¸æ˜¯åˆ›å»ºå®é™…è¿è¡Œæ—¶çš„è¯­è¨€ï¼ŒJavaã€.NET æˆ–è€…å…¶ä»–çš„è¯­è¨€ã€‚ç„¶åï¼Œå› ä¸ºæ˜¯å•ä¸€è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬ä¸èƒ½è½»æ¾åœ°è¿›è¡Œå£°æ˜å¼çš„éƒ¨ç½²æˆ–è€…è‡ªåŠ¨è°ƒé…ã€‚éƒ¨ç½²æ˜¯ç›¸å½“å¤§ä¸”éå¸¸é‡çš„ï¼Œæ‰€ä»¥å®ƒé€šå¸¸æ¶‰åŠåˆ°äººæœºäº¤äº’ã€‚è¿™ç§å•ä½“æ¶æ„çš„å¦ä¸€ä¸ªéš¾ç‚¹æ˜¯æ‰©å±•ï¼šâ€œæˆ‘ä»¬æ— æ³•æ‰©å±•å•ä¸ªç»„ä»¶ã€‚â€&lt;/p&gt;
&lt;p&gt;æœ€åå´å¹¶éæœ€ä¸é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œå›´ç»•éš”ç¦»ï¼Œæ— è®ºæ˜¯èµ„æºéš”ç¦»è¿˜æ˜¯æ•…éšœéš”ç¦»ã€‚ä½¿ç”¨å•ä½“æ¶æ„æ— æ³•å®Œæˆæ‰€æœ‰è¿™äº›å·¥ä½œã€‚ä»æˆ‘ä»¬çš„éœ€æ±‚æ¡†æ¶æ¥çœ‹ï¼ŒESB çš„å•ä½“æ¶æ„ä¸ç¬¦åˆæ¡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/distributed-systems-kubernetes/40image005-1616431696438_hu7916307824860560120.webp 400w,
               /blog/distributed-systems-kubernetes/40image005-1616431696438_hu10235309058352701943.webp 760w,
               /blog/distributed-systems-kubernetes/40image005-1616431696438_hu5477747839955994561.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/distributed-systems-kubernetes/40image005-1616431696438_hu7916307824860560120.webp&#34;
               width=&#34;760&#34;
               height=&#34;401&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;äº‘åŸç”Ÿæ¶æ„å¾®æœåŠ¡å’Œ-kubernetes&#34;&gt;äº‘åŸç”Ÿæ¶æ„â€”â€”å¾®æœåŠ¡å’Œ Kubernetes&lt;/h2&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘å»ºè®®æˆ‘ä»¬ç ”ç©¶ä¸€ä¸‹äº‘åŸç”Ÿæ¶æ„ä»¥åŠè¿™äº›éœ€æ±‚æ˜¯å¦‚ä½•å˜åŒ–çš„ã€‚å¦‚æœæˆ‘ä»¬ä»ä¸€ä¸ªéå¸¸é«˜çš„å±‚é¢æ¥çœ‹ï¼Œè¿™äº›æ¶æ„æ˜¯å¦‚ä½•å‘ç”Ÿå˜åŒ–çš„ï¼Œäº‘åŸç”Ÿå¯èƒ½å§‹äºå¾®æœåŠ¡è¿åŠ¨ã€‚å¾®æœåŠ¡ä½¿æˆ‘ä»¬å¯ä»¥æŒ‰ä¸šåŠ¡é¢†åŸŸè¿›è¡Œæ‹†åˆ†å•ä½“åº”ç”¨ã€‚äº‹å®è¯æ˜ï¼Œå®¹å™¨å’Œ Kubernetes å®é™…ä¸Šæ˜¯ç®¡ç†è¿™äº›å¾®æœåŠ¡çš„ä¼˜ç§€å¹³å°ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ Kubernetes å¯¹äºå¾®æœåŠ¡ç‰¹åˆ«æœ‰å¸å¼•åŠ›çš„ä¸€äº›å…·ä½“ç‰¹æ€§å’ŒåŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/distributed-systems-kubernetes/13image006-1616431699209_hu6513061619412983264.webp 400w,
               /blog/distributed-systems-kubernetes/13image006-1616431699209_hu14243839355223502257.webp 760w,
               /blog/distributed-systems-kubernetes/13image006-1616431699209_hu169569007126024.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/distributed-systems-kubernetes/13image006-1616431699209_hu6513061619412983264.webp&#34;
               width=&#34;760&#34;
               height=&#34;447&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»ä¸€å¼€å§‹ï¼Œè¿›è¡Œå¥åº·çŠ¶å†µæ¢æµ‹çš„èƒ½åŠ›å°±æ˜¯ Kubernetes å—æ¬¢è¿çš„åŸå› ã€‚åœ¨å®è·µä¸­ï¼Œè¿™æ„å‘³ç€å½“ä½ å°†å®¹å™¨éƒ¨ç½²åˆ° Pod ä¸­æ—¶ï¼ŒKubernetes ä¼šæ£€æŸ¥è¿›ç¨‹çš„è¿è¡ŒçŠ¶å†µã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè¯¥è¿‡ç¨‹æ¨¡å‹è¿˜ä¸å¤Ÿå¥½ã€‚ä½ å¯èƒ½ä»ç„¶æœ‰ä¸€ä¸ªå·²å¯åŠ¨å¹¶æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œä½†æ˜¯å®ƒå¹¶ä¸å¥åº·ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿˜å¯ä»¥ä½¿ç”¨å°±ç»ªåº¦å’Œå­˜æ´»åº¦æ£€æŸ¥çš„åŸå› ã€‚Kubernetes ä¼šåšä¸€ä¸ªå°±ç»ªåº¦æ£€æŸ¥ï¼Œä»¥ç¡®å®šä½ çš„åº”ç”¨åœ¨å¯åŠ¨æœŸé—´ä½•æ—¶å‡†å¤‡æ¥å—æµé‡ã€‚å®ƒå°†è¿›è¡Œæ´»è·ƒåº¦æ£€æŸ¥ï¼Œä»¥æ£€æŸ¥æœåŠ¡çš„è¿è¡ŒçŠ¶å†µã€‚åœ¨ Kubernetes ä¹‹å‰ï¼Œè¿™å¹¶ä¸æ˜¯å¾ˆæµè¡Œï¼Œä½†ä»Šå¤©å‡ ä¹æ‰€æœ‰è¯­è¨€ã€æ‰€æœ‰æ¡†æ¶ã€æ‰€æœ‰è¿è¡Œæ—¶éƒ½æœ‰å¥åº·æ£€æŸ¥åŠŸèƒ½ï¼Œä½ å¯ä»¥åœ¨å…¶ä¸­å¿«é€Ÿå¯åŠ¨ç«¯ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/distributed-systems-kubernetes/29image007-1616431696697_hu15531866837335996387.webp 400w,
               /blog/distributed-systems-kubernetes/29image007-1616431696697_hu16608628452107273339.webp 760w,
               /blog/distributed-systems-kubernetes/29image007-1616431696697_hu4012741895156289995.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/distributed-systems-kubernetes/29image007-1616431696697_hu15531866837335996387.webp&#34;
               width=&#34;760&#34;
               height=&#34;388&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Kubernetes å¼•å…¥çš„ä¸‹ä¸€ä¸ªç‰¹æ€§æ˜¯å›´ç»•åº”ç”¨ç¨‹åºçš„æ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸâ€”â€”æˆ‘çš„æ„æ€æ˜¯ï¼Œä½ ä¸å†æ§åˆ¶ä½•æ—¶å¯åŠ¨ã€ä½•æ—¶å…³é—­æœåŠ¡ã€‚ä½ ç›¸ä¿¡å¹³å°å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚Kubernetes å¯ä»¥å¯åŠ¨ä½ çš„åº”ç”¨ï¼›å®ƒå¯ä»¥å°†å…¶å…³é—­ï¼Œç„¶ååœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šç§»åŠ¨å®ƒã€‚ä¸ºæ­¤ï¼Œä½ å¿…é¡»æ­£ç¡®æ‰§è¡Œå¹³å°åœ¨åº”ç”¨å¯åŠ¨å’Œå…³é—­æœŸé—´å‘Šè¯‰ä½ çš„äº‹ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes æµè¡Œçš„å¦ä¸€ä»¶ç‰¹æ€§æ˜¯å›´ç»•ç€å£°æ˜å¼éƒ¨ç½²ã€‚è¿™æ„å‘³ç€ä½ ä¸å†éœ€è¦å¯åŠ¨æœåŠ¡ï¼›æ£€æŸ¥æ—¥å¿—æ˜¯å¦å·²ç»å¯åŠ¨ã€‚ä½ ä¸å¿…æ‰‹åŠ¨å‡çº§å®ä¾‹â€”â€”æ”¯æŒå£°æ˜å¼éƒ¨ç½²çš„ Kubernetes å¯ä»¥ä¸ºä½ åšåˆ°è¿™ä¸€ç‚¹ã€‚æ ¹æ®ä½ é€‰æ‹©çš„ç­–ç•¥ï¼Œå®ƒå¯ä»¥åœæ­¢æ—§å®ä¾‹å¹¶å¯åŠ¨æ–°å®ä¾‹ã€‚æ­¤å¤–ï¼Œå¦‚æœå‡ºç°é—®é¢˜ï¼Œå¯ä»¥è¿›è¡Œå›æ»šã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–å°±æ˜¯å£°æ˜ä½ çš„èµ„æºéœ€æ±‚ã€‚åˆ›å»ºæœåŠ¡æ—¶ï¼Œå°†å…¶å®¹å™¨åŒ–ã€‚æœ€å¥½å‘Šè¯‰å¹³å°è¯¥æœåŠ¡å°†éœ€è¦å¤šå°‘ CPU å’Œå†…å­˜ã€‚Kubernetes åˆ©ç”¨è¿™äº›ä¿¡æ¯ä¸ºä½ çš„å·¥ä½œè´Ÿè½½æ‰¾åˆ°æœ€ä½³èŠ‚ç‚¹ã€‚åœ¨ä½¿ç”¨ Kubernetes ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»æ ¹æ®æˆ‘ä»¬çš„æ ‡å‡†å°†å®ä¾‹æ‰‹åŠ¨æ”¾ç½®åˆ°ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„åå¥½æ¥æŒ‡å¯¼ Kubernetesï¼Œå®ƒå°†ä¸ºæˆ‘ä»¬åšå‡ºæœ€ä½³çš„å†³ç­–ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä»Šï¼Œåœ¨ Kubernetes ä¸Šï¼Œä½ å¯ä»¥è¿›è¡Œå¤šè¯­è¨€é…ç½®ç®¡ç†ã€‚æ— éœ€åœ¨åº”ç”¨ç¨‹åºè¿è¡Œæ—¶è¿›è¡Œé…ç½®æŸ¥æ‰¾å°±å¯ä»¥è¿›è¡Œä»»ä½•æ“ä½œã€‚Kubernetes ä¼šç¡®ä¿é…ç½®æœ€ç»ˆåœ¨å·¥ä½œè´Ÿè½½æ‰€åœ¨çš„åŒä¸€èŠ‚ç‚¹ä¸Šã€‚è¿™äº›é…ç½®è¢«æ˜ å°„ä¸ºå·æˆ–ç¯å¢ƒå˜é‡ï¼Œä»¥ä¾›ä½ çš„åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;äº‹å®è¯æ˜ï¼Œæˆ‘åˆšæ‰è°ˆåˆ°çš„é‚£äº›ç‰¹å®šåŠŸèƒ½ä¹Ÿæ˜¯ç›¸å…³çš„ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœè¦è¿›è¡Œè‡ªåŠ¨æ”¾ç½®ï¼Œåˆ™å¿…é¡»å‘Šè¯‰ Kubernetes æœåŠ¡çš„èµ„æºéœ€æ±‚ã€‚ç„¶åï¼Œä½ å¿…é¡»å‘Šè¯‰å®ƒè¦ä½¿ç”¨çš„éƒ¨ç½²ç­–ç•¥ã€‚ä¸ºäº†è®©ç­–ç•¥æ­£ç¡®è¿è¡Œï¼Œä½ çš„åº”ç”¨ç¨‹åºå¿…é¡»æ‰§è¡Œæ¥è‡ªç¯å¢ƒçš„äº‹ä»¶ã€‚å®ƒå¿…é¡»æ‰§è¡Œå¥åº·æ£€æŸ¥ã€‚ä¸€æ—¦é‡‡ç”¨äº†æ‰€æœ‰è¿™äº›æœ€ä½³å®è·µå¹¶ä½¿ç”¨æ‰€æœ‰è¿™äº›åŠŸèƒ½ï¼Œä½ çš„åº”ç”¨å°±ä¼šæˆä¸ºå‡ºè‰²çš„äº‘åŸç”Ÿå…¬æ°‘ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ Kubernetes ä¸Šå®ç°è‡ªåŠ¨åŒ–äº†ï¼ˆè¿™æ˜¯åœ¨ Kubernetes ä¸Šè¿è¡Œå·¥ä½œè´Ÿè½½çš„åŸºæœ¬æ¨¡å¼ï¼‰ã€‚æœ€åï¼Œè¿˜æœ‰å›´ç»•ç€æ„å»º Pod ä¸­çš„å®¹å™¨ã€é…ç½®ç®¡ç†å’Œè¡Œä¸ºï¼Œè¿˜æœ‰å…¶ä»–æ¨¡å¼ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘è¦ç®€è¦ä»‹ç»çš„ä¸‹ä¸€ä¸ªä¸»é¢˜æ˜¯å·¥ä½œè´Ÿè½½ã€‚ä»ç”Ÿå‘½å‘¨æœŸçš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿè¿è¡Œä¸åŒçš„å·¥ä½œè´Ÿè½½ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ Kubernetes ä¸Šåšåˆ°è¿™ä¸€ç‚¹ã€‚è¿è¡ŒåäºŒè¦ç´ åº”ç”¨ç¨‹åºå’Œæ— çŠ¶æ€å¾®æœåŠ¡éå¸¸ç®€å•ã€‚Kubernetes å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚è¿™ä¸æ˜¯ä½ å°†è¦æ‰¿æ‹…çš„å”¯ä¸€å·¥ä½œé‡ã€‚å¯èƒ½ä½ è¿˜æœ‰æœ‰çŠ¶æ€çš„å·¥ä½œè´Ÿè½½ï¼Œä½ å¯ä»¥ä½¿ç”¨æœ‰çŠ¶æ€é›†åœ¨ Kubernetes ä¸Šå®Œæˆæ­¤å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯èƒ½è¿˜æœ‰çš„å¦ä¸€ä¸ªå·¥ä½œè´Ÿè½½æ˜¯å•ä¾‹ã€‚ä¹Ÿè®¸ä½ å¸Œæœ›æŸä¸ªåº”ç”¨ç¨‹åºçš„å®ä¾‹æ˜¯æ•´ä¸ªé›†ç¾¤ä¸­åº”ç”¨ç¨‹åºçš„å”¯ä¸€ä¸€ä¸ªå®ä¾‹&amp;ndash;ä½ å¸Œæœ›å®ƒæˆä¸ºå¯é çš„å•ä¾‹ã€‚å¦‚æœå¤±è´¥ï¼Œåˆ™é‡æ–°å¯åŠ¨ã€‚å› æ­¤ï¼Œä½ å¯ä»¥æ ¹æ®éœ€æ±‚ä»¥åŠæ˜¯å¦å¸Œæœ›å•ä¾‹è‡³å°‘å…·æœ‰ä¸€ç§æˆ–æœ€å¤šä¸€ç§è¯­ä¹‰æ¥åœ¨æœ‰çŠ¶æ€é›†å’Œå‰¯æœ¬é›†ä¹‹é—´è¿›è¡Œé€‰æ‹©ã€‚ä½ å¯èƒ½è¿˜æœ‰çš„å¦ä¸€ä¸ªå·¥ä½œè´Ÿè½½æ˜¯å›´ç»•ä½œä¸šå’Œå®šæ—¶ä½œä¸š&amp;ndash;æœ‰äº† Kubernetesï¼Œä½ ä¹Ÿå¯ä»¥å®ç°è¿™äº›ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬å°†æ‰€æœ‰è¿™äº› Kubernetes åŠŸèƒ½æ˜ å°„åˆ°æˆ‘ä»¬çš„éœ€æ±‚ï¼Œåˆ™ Kubernetes å¯ä»¥æ»¡è¶³ç”Ÿå‘½å‘¨æœŸéœ€æ±‚ã€‚æˆ‘é€šå¸¸åˆ›å»ºçš„éœ€æ±‚åˆ—è¡¨ä¸»è¦æ˜¯ç”± Kubernetes ä»Šå¤©æä¾›ç»™æˆ‘ä»¬çš„ã€‚è¿™äº›æ˜¯ä»»ä½•å¹³å°ä¸Šçš„é¢„æœŸåŠŸèƒ½ï¼Œè€Œ Kubernetes å¯ä»¥ä¸ºä½ çš„éƒ¨ç½²åšçš„æ˜¯é…ç½®ç®¡ç†ã€èµ„æºéš”ç¦»å’Œæ•…éšœéš”ç¦»ã€‚æ­¤å¤–ï¼Œé™¤äº†æ— æœåŠ¡å™¨æœ¬èº«ä¹‹å¤–ï¼Œå®ƒè¿˜æ”¯æŒå…¶ä»–å·¥ä½œè´Ÿè½½ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/distributed-systems-kubernetes/12image008-1616431698134_hu5767737819612051811.webp 400w,
               /blog/distributed-systems-kubernetes/12image008-1616431698134_hu13976301471427638806.webp 760w,
               /blog/distributed-systems-kubernetes/12image008-1616431698134_hu15713917923610150178.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/distributed-systems-kubernetes/12image008-1616431698134_hu5767737819612051811.webp&#34;
               width=&#34;760&#34;
               height=&#34;413&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç„¶åï¼Œå¦‚æœè¿™å°±æ˜¯ Kubernetes ç»™å¼€å‘è€…æä¾›çš„å…¨éƒ¨åŠŸèƒ½ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•æ‰©å±• Kubernetes å‘¢ï¼Ÿä»¥åŠå¦‚ä½•ä½¿å®ƒå…·æœ‰æ›´å¤šåŠŸèƒ½ï¼Ÿå› æ­¤ï¼Œæˆ‘æƒ³æè¿°å½“ä»Šä½¿ç”¨çš„ä¸¤ç§å¸¸ç”¨æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¿›ç¨‹å¤–æ‰©å±•æœºåˆ¶&#34;&gt;è¿›ç¨‹å¤–æ‰©å±•æœºåˆ¶&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆæ˜¯ Pod çš„æ¦‚å¿µï¼ŒPod æ˜¯ç”¨äºåœ¨èŠ‚ç‚¹ä¸Šéƒ¨ç½²å®¹å™¨çš„æŠ½è±¡ã€‚æ­¤å¤–ï¼ŒPod ç»™æˆ‘ä»¬æä¾›äº†ä¸¤ç»„ä¿è¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€ç»„æ˜¯éƒ¨ç½²ä¿è¯ &amp;ndash; Pod ä¸­çš„æ‰€æœ‰å®¹å™¨å§‹ç»ˆä½äºåŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚è¿™æ„å‘³ç€å®ƒä»¬å¯ä»¥é€šè¿‡ localhost ç›¸äº’é€šä¿¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿæˆ–é€šè¿‡å…¶ä»– IPC æœºåˆ¶è¿›è¡Œå¼‚æ­¥é€šä¿¡ã€‚&lt;/li&gt;
&lt;li&gt;Pod ç»™æˆ‘ä»¬çš„å¦ä¸€ç»„ä¿è¯æ˜¯å›´ç»•ç”Ÿå‘½å‘¨æœŸçš„ã€‚Pod ä¸­çš„æ‰€æœ‰å®¹å™¨å¹¶ééƒ½ç›¸ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/distributed-systems-kubernetes/22image009-1616431698660_hu2186102266844391204.webp 400w,
               /blog/distributed-systems-kubernetes/22image009-1616431698660_hu8698844719834944283.webp 760w,
               /blog/distributed-systems-kubernetes/22image009-1616431698660_hu13151315663467844865.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/distributed-systems-kubernetes/22image009-1616431698660_hu2186102266844391204.webp&#34;
               width=&#34;760&#34;
               height=&#34;420&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ ¹æ®ä½¿ç”¨çš„æ˜¯ init å®¹å™¨è¿˜æ˜¯åº”ç”¨ç¨‹åºå®¹å™¨ï¼Œä½ ä¼šè·å¾—ä¸åŒçš„ä¿è¯ã€‚ä¾‹å¦‚ï¼Œinit å®¹å™¨åœ¨å¼€å§‹æ—¶è¿è¡Œï¼›å½“ Pod å¯åŠ¨æ—¶ï¼Œå®ƒæŒ‰é¡ºåºä¸€ä¸ªæ¥ä¸€ä¸ªåœ°è¿è¡Œã€‚ä»–ä»¬ä»…åœ¨ä¹‹å‰çš„å®¹å™¨å·²æˆåŠŸå®Œæˆæ—¶è¿è¡Œã€‚å®ƒä»¬æœ‰åŠ©äºå®ç°ç”±å®¹å™¨é©±åŠ¨çš„ç±»ä¼¼å·¥ä½œæµçš„é€»è¾‘ã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€æ–¹é¢ï¼Œåº”ç”¨ç¨‹åºå®¹å™¨æ˜¯å¹¶è¡Œè¿è¡Œçš„ã€‚å®ƒä»¬åœ¨æ•´ä¸ª Pod çš„ç”Ÿå‘½å‘¨æœŸä¸­è¿è¡Œï¼Œè¿™ä¹Ÿæ˜¯ sidecar æ¨¡å¼çš„åŸºç¡€ã€‚sidecar å¯ä»¥è¿è¡Œå¤šä¸ªå®¹å™¨ï¼Œè¿™äº›å®¹å™¨å¯ä»¥åä½œå¹¶å…±åŒä¸ºç”¨æˆ·æä¾›ä»·å€¼ã€‚è¿™ä¹Ÿæ˜¯å½“ä»Šæˆ‘ä»¬çœ‹åˆ°çš„æ‰©å±• Kubernetes é™„åŠ åŠŸèƒ½çš„ä¸»è¦æœºåˆ¶ä¹‹ä¸€ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/distributed-systems-kubernetes/9image010-1616431695489_hu18172066442118132281.webp 400w,
               /blog/distributed-systems-kubernetes/9image010-1616431695489_hu10786452945911384530.webp 760w,
               /blog/distributed-systems-kubernetes/9image010-1616431695489_hu17971403999346182624.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/distributed-systems-kubernetes/9image010-1616431695489_hu18172066442118132281.webp&#34;
               width=&#34;760&#34;
               height=&#34;510&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£é‡Šä»¥ä¸‹åŠŸèƒ½ï¼Œæˆ‘å¿…é¡»ç®€è¦åœ°å‘Šè¯‰ä½  Kubernetes å†…éƒ¨çš„å·¥ä½œæ–¹å¼ã€‚å®ƒæ˜¯åŸºäºè°ƒè°å¾ªç¯çš„ã€‚è°ƒè°å¾ªç¯çš„æ€æƒ³æ˜¯å°†æœŸæœ›çŠ¶æ€é©±åŠ¨åˆ°å®é™…çŠ¶æ€ã€‚åœ¨ Kubernetes ä¸­ï¼Œå¾ˆå¤šåŠŸèƒ½éƒ½æ˜¯é è¿™ä¸ªæ¥å®ç°çš„ã€‚ä¾‹å¦‚ï¼Œå½“ä½ è¯´æˆ‘è¦ä¸¤ä¸ª Pod å®ä¾‹ï¼Œè¿™ç³»ç»Ÿçš„æœŸæœ›çŠ¶æ€ã€‚æœ‰ä¸€ä¸ªæ§åˆ¶å¾ªç¯ä¸æ–­åœ°è¿è¡Œï¼Œå¹¶æ£€æŸ¥ä½ çš„ Pod æ˜¯å¦æœ‰ä¸¤ä¸ªå®ä¾‹ã€‚å¦‚æœä¸å­˜åœ¨ä¸¤ä¸ªå®ä¾‹ï¼Œå®ƒå°†è®¡ç®—å·®å€¼ã€‚å®ƒå°†ç¡®ä¿å­˜åœ¨ä¸¤ä¸ªå®ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ–¹é¢çš„ä¾‹å­æœ‰å¾ˆå¤šã€‚ä¸€äº›æ˜¯å‰¯æœ¬é›†æˆ–æœ‰çŠ¶æ€é›†ã€‚èµ„æºå®šä¹‰æ˜ å°„åˆ°æ§åˆ¶å™¨æ˜¯ä»€ä¹ˆï¼Œå¹¶ä¸”æ¯ä¸ªèµ„æºå®šä¹‰éƒ½æœ‰ä¸€ä¸ªæ§åˆ¶å™¨ã€‚è¯¥æ§åˆ¶å™¨ç¡®ä¿ç°å®ä¸–ç•Œä¸æ‰€éœ€æ§åˆ¶å™¨ç›¸åŒ¹é…ï¼Œä½ ç”šè‡³å¯ä»¥ç¼–å†™è‡ªå·±çš„è‡ªå®šä¹‰æ§åˆ¶å™¨ã€‚&lt;/p&gt;
&lt;p&gt;å½“åœ¨ Pod ä¸­è¿è¡Œåº”ç”¨ç¨‹åºæ—¶ï¼Œä½ å°†æ— æ³•åœ¨è¿è¡Œæ—¶åŠ è½½ä»»ä½•é…ç½®æ–‡ä»¶æ›´æ”¹ã€‚ç„¶è€Œï¼Œä½ å¯ä»¥ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰æ§åˆ¶å™¨ï¼Œæ£€æµ‹ config map çš„å˜åŒ–ï¼Œé‡æ–°å¯åŠ¨ Pod å’Œåº”ç”¨ç¨‹åº&amp;ndash;ä»è€Œè·å–é…ç½®æ›´æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;äº‹å®è¯æ˜ï¼Œå³ä½¿ Kubernetes æ‹¥æœ‰ä¸°å¯Œçš„èµ„æºé›†åˆï¼Œä½†å®ƒä»¬å¹¶ä¸èƒ½æ»¡è¶³ä½ çš„æ‰€æœ‰ä¸åŒéœ€æ±‚ã€‚Kubernetes å¼•å…¥äº†è‡ªå®šä¹‰èµ„æºå®šä¹‰çš„æ¦‚å¿µã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥å¯¹éœ€æ±‚è¿›è¡Œå»ºæ¨¡å¹¶å®šä¹‰é€‚ç”¨äº Kubernetes çš„ APIã€‚å®ƒä¸å…¶ä»– Kubernetes åŸç”Ÿèµ„æºå…±å­˜ã€‚ä½ å¯ä»¥ç”¨èƒ½ç†è§£æ¨¡å‹çš„ä»»ä½•è¯­è¨€ç¼–å†™è‡ªå·±çš„æ§åˆ¶å™¨ã€‚ä½ å¯ä»¥è®¾è®¡ä¸€ä¸ªç”¨ Java å®ç°çš„ ConfigWatcherï¼Œæè¿°æˆ‘ä»¬å‰é¢æ‰€è§£é‡Šçš„å†…å®¹ã€‚è¿™å°±æ˜¯ operator æ¨¡å¼ï¼Œå³ä¸è‡ªå®šä¹‰èµ„æºå®šä¹‰ä¸€èµ·ä½¿ç”¨çš„æ§åˆ¶å™¨ã€‚å¦‚ä»Šï¼Œæˆ‘ä»¬çœ‹åˆ°å¾ˆå¤š operator åŠ å…¥ï¼Œè¿™å°±æ˜¯ç¬¬äºŒç§æ‰©å±• Kubernetes é™„åŠ åŠŸèƒ½çš„æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘æƒ³ç®€å•ä»‹ç»ä¸€ä¸‹åŸºäº Kubernetes æ„å»ºçš„ä¸€äº›å¹³å°ï¼Œè¿™äº›å¹³å°å¤§é‡ä½¿ç”¨ sidecar å’Œ operator æ¥ç»™å¼€å‘è€…æä¾›é¢å¤–çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼&#34;&gt;ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;è®©æˆ‘ä»¬ä»æœåŠ¡ç½‘æ ¼å¼€å§‹ï¼Œä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æœ‰ä¸¤ä¸ªæœåŠ¡ï¼ŒæœåŠ¡ A è¦è°ƒç”¨æœåŠ¡ Bï¼Œå¹¶ä¸”å¯ä»¥ç”¨ä»»ä½•è¯­è¨€ã€‚æŠŠè¿™ä¸ªå½“åšæ˜¯æˆ‘ä»¬çš„åº”ç”¨å·¥ä½œè´Ÿè½½ã€‚æœåŠ¡ç½‘æ ¼ä½¿ç”¨ sidecar æ§åˆ¶å™¨ï¼Œå¹¶åœ¨æˆ‘ä»¬çš„æœåŠ¡æ—è¾¹æ³¨å…¥ä¸€ä¸ªä»£ç†ã€‚ä½ æœ€ç»ˆä¼šåœ¨ Pod ä¸­å¾—åˆ°ä¸¤ä¸ªå®¹å™¨ã€‚ä»£ç†æ˜¯ä¸€ä¸ªé€æ˜çš„ä»£ç†ï¼Œä½ çš„åº”ç”¨å¯¹è¿™ä¸ªä»£ç†å®Œå…¨æ— æ„ŸçŸ¥&amp;ndash;å®ƒæ‹¦æˆªæ‰€æœ‰ä¼ å…¥å’Œä¼ å‡ºçš„æµé‡ã€‚æ­¤å¤–ï¼Œä»£ç†è¿˜å……å½“æ•°æ®é˜²ç«å¢™ã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›æœåŠ¡ä»£ç†çš„é›†åˆä»£è¡¨äº†ä½ çš„æ•°æ®å¹³é¢ï¼Œå¹¶ä¸”å¾ˆå°ä¸”æ— çŠ¶æ€ã€‚ä¸ºäº†è·å¾—æ‰€æœ‰çŠ¶æ€å’Œé…ç½®ï¼Œå®ƒä»¬ä¾èµ–äºæ§åˆ¶å¹³é¢ã€‚æ§åˆ¶å¹³é¢æ˜¯ä¿æŒæ‰€æœ‰é…ç½®ï¼Œæ”¶é›†æŒ‡æ ‡ï¼Œåšå‡ºå†³å®šå¹¶ä¸æ•°æ®å¹³é¢è¿›è¡Œäº¤äº’çš„æœ‰çŠ¶æ€éƒ¨åˆ†ã€‚æ­¤å¤–ï¼Œå®ƒä»¬æ˜¯ä¸åŒæ§åˆ¶å¹³é¢å’Œæ•°æ®å¹³é¢çš„æ­£ç¡®é€‰æ‹©ã€‚äº‹å®è¯æ˜ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªç»„ä»¶ - ä¸€ä¸ª API ç½‘å…³ï¼Œä»¥å°†æ•°æ®è·å–åˆ°æˆ‘ä»¬çš„é›†ç¾¤ä¸­ã€‚ä¸€äº›æœåŠ¡ç½‘æ ¼å…·æœ‰è‡ªå·±çš„ API ç½‘å…³ï¼Œè€ŒæŸäº›ä½¿ç”¨ç¬¬ä¸‰æ–¹ã€‚å¦‚æœä½ ç ”ç©¶ä¸‹æ‰€æœ‰è¿™äº›ç»„ä»¶ï¼Œå®ƒä»¬å°†æä¾›æˆ‘ä»¬æ‰€éœ€çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;API ç½‘å…³ä¸»è¦ä¸“æ³¨äºæŠ½è±¡æˆ‘ä»¬æœåŠ¡çš„å®ç°ã€‚å®ƒéšè—ç»†èŠ‚å¹¶æä¾›è¾¹ç•ŒåŠŸèƒ½ã€‚æœåŠ¡ç½‘æ ¼åˆ™ç›¸åã€‚åœ¨æŸç§ç¨‹åº¦ä¸Šï¼Œå®ƒå¢å¼ºäº†æœåŠ¡å†…çš„å¯è§æ€§å’Œå¯é æ€§ã€‚å¯ä»¥è¯´ï¼ŒAPI ç½‘å…³å’ŒæœåŠ¡ç½‘æ ¼å…±åŒæä¾›äº†æ‰€æœ‰ç½‘ç»œéœ€æ±‚ã€‚è¦åœ¨ Kubernetes ä¸Šè·å¾—ç½‘ç»œåŠŸèƒ½ï¼Œä»…ä½¿ç”¨æœåŠ¡æ˜¯ä¸å¤Ÿçš„ï¼šâ€œä½ éœ€è¦ä¸€äº›æœåŠ¡ç½‘æ ¼ã€‚â€&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/distributed-systems-kubernetes/19image011-1616431696146_hu10100560760239331041.webp 400w,
               /blog/distributed-systems-kubernetes/19image011-1616431696146_hu16534994009882140756.webp 760w,
               /blog/distributed-systems-kubernetes/19image011-1616431696146_hu9218339521223917458.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/distributed-systems-kubernetes/19image011-1616431696146_hu10100560760239331041.webp&#34;
               width=&#34;760&#34;
               height=&#34;592&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯-knative&#34;&gt;ä»€ä¹ˆæ˜¯ Knativeï¼Ÿ&lt;/h2&gt;
&lt;p&gt;æˆ‘è¦è®¨è®ºçš„ä¸‹ä¸€ä¸ªä¸»é¢˜æ˜¯ Knativeï¼Œè¿™æ˜¯ Google å‡ å¹´å‰å¯åŠ¨çš„ä¸€ä¸ªé¡¹ç›®ã€‚å®ƒæ˜¯ Kubernetes ä¹‹ä¸Šçš„ä¸€å±‚ï¼Œå¯ä¸ºæ‚¨æä¾›æ— æœåŠ¡å™¨åŠŸèƒ½ï¼Œå¹¶å…·æœ‰ä¸¤ä¸ªä¸»è¦æ¨¡å—ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Knative æœåŠ¡ - å›´ç»•ç€è¯·æ±‚ - åº”ç­”äº¤äº’ï¼Œä»¥åŠ&lt;/li&gt;
&lt;li&gt;Knative Eventing - æ›´å¤šçš„æ˜¯ç”¨äºäº‹ä»¶é©±åŠ¨çš„äº¤äº’ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åªæ˜¯è®©ä½ æ„Ÿå—ä¸€ä¸‹ï¼ŒKnative Serving æ˜¯ä»€ä¹ˆï¼Ÿé€šè¿‡ Knative Servingï¼Œä½ å¯ä»¥å®šä¹‰æœåŠ¡ï¼Œä½†è¿™ä¸åŒäº Kubernetes æœåŠ¡ã€‚è¿™æ˜¯ Knative æœåŠ¡ã€‚ä½¿ç”¨ Knative æœåŠ¡å®šä¹‰å·¥ä½œè´Ÿè½½åï¼Œä½ å°±ä¼šå¾—åˆ°å…·æœ‰æ— æœåŠ¡å™¨çš„ç‰¹å¾çš„éƒ¨ç½²ã€‚ä½ ä¸éœ€è¦æœ‰å¯åŠ¨å¹¶è¿è¡Œå®ä¾‹ã€‚å®ƒå¯ä»¥åœ¨è¯·æ±‚åˆ°è¾¾æ—¶ä»é›¶å¼€å§‹ã€‚ä½ å¾—åˆ°çš„æ˜¯æ— æœåŠ¡å™¨çš„èƒ½åŠ›ï¼›å®ƒå¯ä»¥è¿…é€Ÿæ‰©å®¹ï¼Œä¹Ÿå¯ä»¥ç¼©å®¹åˆ°é›¶ã€‚&lt;/p&gt;
&lt;p&gt;Knative Eventing ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå®Œå…¨å£°æ˜å¼çš„äº‹ä»¶ç®¡ç†ç³»ç»Ÿã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€äº›è¦ä¸ä¹‹é›†æˆçš„å¤–éƒ¨ç³»ç»Ÿï¼Œä»¥åŠä¸€äº›å¤–éƒ¨çš„äº‹ä»¶ç”Ÿäº§è€…ã€‚åœ¨åº•éƒ¨ï¼Œæˆ‘ä»¬å°†åº”ç”¨ç¨‹åºæ”¾åœ¨å…·æœ‰ HTTP ç«¯ç‚¹çš„å®¹å™¨ä¸­ã€‚å€ŸåŠ© Knative Eventingï¼Œæˆ‘ä»¬å¯ä»¥å¯åŠ¨ä»£ç†ï¼Œè¯¥ä»£ç†å¯ä»¥è§¦å‘ Kafka æ˜ å°„çš„ä»£ç†ï¼Œä¹Ÿå¯ä»¥åœ¨å†…å­˜æˆ–è€…æŸäº›äº‘æœåŠ¡ä¸­ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥å¯åŠ¨è¿æ¥åˆ°å¤–éƒ¨ç³»ç»Ÿçš„å¯¼å…¥å™¨ï¼Œå¹¶å°†äº‹ä»¶å¯¼å…¥åˆ°æˆ‘ä»¬çš„ä»£ç†ä¸­ã€‚è¿™äº›å¯¼å…¥å™¨å¯ä»¥åŸºäºï¼Œä¾‹å¦‚ï¼Œå…·æœ‰æ•°ç™¾ä¸ªè¿æ¥å™¨çš„ Apache Camelã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦æˆ‘ä»¬å°†äº‹ä»¶å‘é€ç»™ä»£ç†ï¼Œç„¶åç”¨ YAML æ–‡ä»¶å£°æ˜ï¼Œæˆ‘ä»¬å¯ä»¥è®©å®¹å™¨è®¢é˜…è¿™äº›äº‹ä»¶ã€‚åœ¨æˆ‘ä»¬çš„å®¹å™¨ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä»»ä½•æ¶ˆæ¯å®¢æˆ·ç«¯&amp;ndash;æ¯”å¦‚ Kafka å®¢æˆ·ç«¯ã€‚æˆ‘ä»¬çš„å®¹å™¨å°†ä½¿ç”¨äº‘äº‹ä»¶é€šè¿‡ HTTP POST è·å–äº‹ä»¶ã€‚è¿™æ˜¯ä¸€ä¸ªå®Œå…¨å¹³å°ç®¡ç†çš„æ¶ˆæ¯ä¼ é€’åŸºç¡€è®¾æ–½ã€‚ä½œä¸ºå¼€å‘äººå‘˜ï¼Œä½ å¿…é¡»åœ¨å®¹å™¨ä¸­ç¼–å†™ä¸šåŠ¡ä»£ç ï¼Œå¹¶ä¸”ä¸å¤„ç†ä»»ä½•æ¶ˆæ¯ä¼ é€’é€»è¾‘ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/distributed-systems-kubernetes/8image012-1616431698919_hu13314894158779601904.webp 400w,
               /blog/distributed-systems-kubernetes/8image012-1616431698919_hu14986837097726000115.webp 760w,
               /blog/distributed-systems-kubernetes/8image012-1616431698919_hu3342153112285909834.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/distributed-systems-kubernetes/8image012-1616431698919_hu13314894158779601904.webp&#34;
               width=&#34;760&#34;
               height=&#34;426&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»æˆ‘ä»¬çš„éœ€æ±‚çš„è§’åº¦æ¥çœ‹ï¼ŒKnative å¯ä»¥æ»¡è¶³å…¶ä¸­çš„ä¸€äº›è¦æ±‚ã€‚ä»ç”Ÿå‘½å‘¨æœŸçš„è§’åº¦æ¥çœ‹ï¼Œå®ƒä¸ºæˆ‘ä»¬çš„å·¥ä½œè´Ÿè½½æä¾›äº†æ— æœåŠ¡å™¨çš„åŠŸèƒ½ï¼Œå› æ­¤èƒ½å¤Ÿå°†å…¶æ‰©å±•åˆ°é›¶ï¼Œå¹¶ä»é›¶å¼€å§‹æ¿€æ´»ã€‚ä»ç½‘ç»œçš„è§’åº¦æ¥çœ‹ï¼Œå¦‚æœæœåŠ¡ç½‘æ ¼ä¹‹é—´å­˜åœ¨æŸäº›é‡å ï¼Œåˆ™ Knative ä¹Ÿå¯ä»¥è¿›è¡Œæµé‡è½¬ç§»ã€‚ä»ç»‘å®šçš„è§’åº¦æ¥çœ‹ï¼Œå®ƒå¯¹ä½¿ç”¨ Knative å¯¼å…¥ç¨‹åºè¿›è¡Œç»‘å®šæä¾›äº†å¾ˆå¥½çš„æ”¯æŒã€‚å®ƒå¯ä»¥ä½¿æˆ‘ä»¬è¿›è¡Œå‘å¸ƒ/è®¢é˜…ï¼Œæˆ–ç‚¹å¯¹ç‚¹äº¤äº’ï¼Œç”šè‡³å¯ä»¥è¿›è¡Œä¸€äº›æ’åºã€‚å®ƒå¯ä»¥æ»¡è¶³å‡ ç±»éœ€æ±‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯-dapr&#34;&gt;ä»€ä¹ˆæ˜¯ Daprï¼Ÿ&lt;/h2&gt;
&lt;p&gt;å¦ä¸€ä¸ªä½¿ç”¨ sidecar å’Œ operator çš„é¡¹ç›®æ˜¯ &lt;a href=&#34;https://dapr.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Dapr&lt;/a&gt;ï¼Œå®ƒæ˜¯å¾®è½¯å‡ ä¸ªæœˆå‰æ‰å¼€å§‹å¹¶ä¸”æ­£åœ¨è¿…é€Ÿæµè¡Œèµ·æ¥ã€‚æ­¤å¤–ï¼Œ1.0 ç‰ˆæœ¬ &lt;a href=&#34;https://www.infoq.com/news/2021/02/dapr-production-ready/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¢«è®¤ä¸ºæ˜¯ç”Ÿäº§å¯ç”¨çš„&lt;/a&gt;ã€‚å®ƒæ˜¯ä¸€ä¸ªä½œä¸º sidecar çš„åˆ†å¸ƒå¼ç³»ç»Ÿå·¥å…·åŒ…&amp;ndash;Dapr ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½æ˜¯ä½œä¸º sidecar æä¾›çš„ï¼Œå¹¶ä¸”æœ‰ä¸€å¥—ä»–ä»¬æ‰€è°“çš„æ„ä»¶æˆ–åŠŸèƒ½é›†çš„é›†åˆã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›åŠŸèƒ½æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç¬¬ä¸€ç»„åŠŸèƒ½æ˜¯å›´ç»•ç½‘ç»œã€‚Dapr å¯ä»¥è¿›è¡ŒæœåŠ¡å‘ç°å’ŒæœåŠ¡ä¹‹é—´çš„ç‚¹å¯¹ç‚¹é›†æˆã€‚åŒæ ·ï¼Œå®ƒä¹Ÿå¯ä»¥è¿›è¡ŒæœåŠ¡ç½‘æ ¼çš„è¿½è¸ªã€å¯é é€šä¿¡ã€é‡è¯•å’Œæ¢å¤ã€‚ç¬¬äºŒå¥—åŠŸèƒ½æ˜¯å›´ç»•èµ„æºç»‘å®šï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®ƒæœ‰å¾ˆå¤šäº‘ APIã€ä¸åŒç³»ç»Ÿçš„è¿æ¥å™¨ï¼Œä»¥åŠ&lt;/li&gt;
&lt;li&gt;ä¹Ÿå¯ä»¥åšæ¶ˆæ¯å‘å¸ƒ/è®¢é˜…å’Œå…¶ä»–é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ‰è¶£çš„æ˜¯ï¼ŒDapr è¿˜å¼•å…¥äº†çŠ¶æ€ç®¡ç†çš„æ¦‚å¿µã€‚é™¤äº† Knative å’ŒæœåŠ¡ç½‘æ ¼æä¾›çš„åŠŸèƒ½å¤–ï¼ŒDapr åœ¨çŠ¶æ€å­˜å‚¨ä¹‹ä¸Šè¿›è¡Œäº†æŠ½è±¡ã€‚æ­¤å¤–ï¼Œä½ é€šè¿‡å­˜å‚¨æœºåˆ¶æ”¯æŒä¸ Dapr è¿›è¡ŒåŸºäºé”®å€¼çš„äº¤äº’ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¾ƒé«˜çš„å±‚æ¬¡ä¸Šï¼Œæ¶æ„æ˜¯ä½ çš„åº”ç”¨ç¨‹åºä½äºé¡¶éƒ¨ï¼Œå¯ä»¥ä½¿ç”¨ä»»ä½•è¯­è¨€ã€‚ä½ å¯ä»¥ä½¿ç”¨ Dapr æä¾›çš„å®¢æˆ·ç«¯åº“ï¼Œä½†ä½ ä¸å¿…è¿™æ ·åšã€‚ä½ å¯ä»¥ä½¿ç”¨è¯­è¨€åŠŸèƒ½æ¥æ‰§è¡Œç§°ä¸º sidecar çš„ HTTP å’Œ gRPCã€‚ä¸ æœåŠ¡ç½‘æ ¼çš„åŒºåˆ«åœ¨äºï¼Œè¿™é‡Œçš„ Dapr sidecar ä¸æ˜¯ä¸€ä¸ªé€æ˜çš„ä»£ç†ã€‚å®ƒæ˜¯ä¸€ä¸ªæ˜¾å¼ä»£ç†ï¼Œä½ å¿…é¡»ä»ä½ çš„åº”ç”¨ä¸­è°ƒç”¨å®ƒï¼Œå¹¶é€šè¿‡ HTTP æˆ– gRPC ä¸ä¹‹äº¤äº’ã€‚æ ¹æ®ä½ éœ€è¦çš„åŠŸèƒ½ï¼ŒDapr å¯ä»¥ä¸å…¶ä»–å¦‚äº‘æœåŠ¡çš„ç³»ç»Ÿå¯¹è¯ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/distributed-systems-kubernetes/18image013-1616431699532_hu16402311390148551096.webp 400w,
               /blog/distributed-systems-kubernetes/18image013-1616431699532_hu9357467084476449215.webp 760w,
               /blog/distributed-systems-kubernetes/18image013-1616431699532_hu14923194081728954748.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/distributed-systems-kubernetes/18image013-1616431699532_hu16402311390148551096.webp&#34;
               width=&#34;760&#34;
               height=&#34;396&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ Kubernetes ä¸Šï¼ŒDapr æ˜¯ä½œä¸º sidecar éƒ¨ç½²çš„ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ Kubernetes ä¹‹å¤–å·¥ä½œï¼ˆä¸ä»…ä»…æ˜¯ Kubernetesï¼‰ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ª operator &amp;ndash; è€Œ sidecar å’Œ Operator æ˜¯ä¸»è¦çš„æ‰©å±•æœºåˆ¶ã€‚å…¶ä»–ä¸€äº›ç»„ä»¶ç®¡ç†è¯ä¹¦ã€å¤„ç†åŸºäº actor çš„å»ºæ¨¡å¹¶æ³¨å…¥ sidecarã€‚ä½ çš„å·¥ä½œè´Ÿè½½ä¸ sidecar äº¤äº’ï¼Œå¹¶å°½å…¶æ‰€èƒ½ä¸å…¶ä»–æœåŠ¡å¯¹è¯ï¼Œè®©ä½ ä¸ä¸åŒçš„äº‘æä¾›å•†è¿›è¡Œäº’æ“ä½œã€‚å®ƒè¿˜ä¸ºä½ æä¾›äº†é¢å¤–çš„åˆ†å¸ƒå¼ç³»ç»ŸåŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;ç»¼ä¸Šæ‰€è¿°ï¼Œè¿™äº›é¡¹ç›®æ‰€æä¾›çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥è¯´ ESB æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ—©æœŸåŒ–èº«ï¼Œå…¶ä¸­æˆ‘ä»¬æœ‰é›†ä¸­å¼çš„æ§åˆ¶å¹³é¢å’Œæ•°æ®å¹³é¢&amp;ndash;ä½†æ˜¯æ‰©å±•æ€§ä¸å¥½ã€‚åœ¨äº‘åŸç”Ÿä¸­ï¼Œé›†ä¸­å¼æ§åˆ¶å¹³é¢ä»ç„¶å­˜åœ¨ï¼Œä½†æ˜¯æ•°æ®å¹³é¢æ˜¯åˆ†æ•£çš„&amp;ndash;å¹¶ä¸”å…·æœ‰éš”éŸ³åŠŸèƒ½å’Œé«˜åº¦çš„å¯æ‰©å±•æ€§ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å§‹ç»ˆéœ€è¦ Kubernetes æ¥åšè‰¯å¥½çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä½ å¯èƒ½è¿˜éœ€è¦ä¸€ä¸ªæˆ–å¤šä¸ªé™„åŠ ç»„ä»¶ã€‚ä½ å¯èƒ½éœ€è¦ Istio æ¥è¿›è¡Œé«˜çº§è”ç½‘ã€‚ä½ å¯èƒ½ä¼šä½¿ç”¨ Knative æ¥è¿›è¡Œæ— æœåŠ¡å™¨å·¥ä½œè´Ÿè½½ï¼Œæˆ–è€…ä½¿ç”¨ Dapr æ¥åšé›†æˆã€‚è¿™äº›æ¡†æ¶å¯ä¸ Istio å’Œ Envoy å¾ˆå¥½çš„é…åˆä½¿ç”¨ã€‚ä» Dapr å’Œ Knative çš„è§’åº¦æ¥çœ‹ï¼Œä½ å¯èƒ½å¿…é¡»é€‰æ‹©ä¸€ä¸ªã€‚å®ƒä»¬å…±åŒä»¥äº‘åŸç”Ÿçš„æ–¹å¼æä¾›äº†æˆ‘ä»¬è¿‡å»åœ¨ ESB ä¸Šæ‹¥æœ‰çš„ä¸œè¥¿ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœªæ¥äº‘åŸç”Ÿè¶‹åŠ¿--ç”Ÿå‘½å‘¨æœŸè¶‹åŠ¿&#34;&gt;æœªæ¥äº‘åŸç”Ÿè¶‹åŠ¿&amp;ndash;ç”Ÿå‘½å‘¨æœŸè¶‹åŠ¿&lt;/h2&gt;
&lt;p&gt;åœ¨æ¥ä¸‹æ¥çš„éƒ¨åˆ†ï¼Œæˆ‘åˆ—å‡ºäº†ä¸€äº›æˆ‘è®¤ä¸ºåœ¨è¿™äº›é¢†åŸŸæ­£åœ¨å‘ç”Ÿä»¤äººæŒ¯å¥‹çš„å‘å±•çš„é¡¹ç›®ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/distributed-systems-kubernetes/8image014-1616431695762_hu18158981565469167442.webp 400w,
               /blog/distributed-systems-kubernetes/8image014-1616431695762_hu5584106365932737466.webp 760w,
               /blog/distributed-systems-kubernetes/8image014-1616431695762_hu3719055988436533500.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/distributed-systems-kubernetes/8image014-1616431695762_hu18158981565469167442.webp&#34;
               width=&#34;760&#34;
               height=&#34;443&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘æƒ³ä»ç”Ÿå‘½å‘¨æœŸå¼€å§‹ã€‚é€šè¿‡ Kubernetesï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºåº”ç”¨ç¨‹åºæä¾›ä¸€ä¸ªæœ‰ç”¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œè¿™å¯èƒ½ä¸è¶³ä»¥è¿›è¡Œæ›´å¤æ‚çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªæ›´å¤æ‚çš„æœ‰çŠ¶æ€åº”ç”¨ï¼Œåˆ™å¯èƒ½ä¼šæœ‰è¿™æ ·çš„åœºæ™¯ï¼Œå…¶ä¸­ Kubernetes ä¸­çš„éƒ¨ç½²åŸè¯­ä¸è¶³ä»¥ä¸ºåº”ç”¨æä¾›æ”¯æŒã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™äº›åœºæ™¯ä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ operator æ¨¡å¼ã€‚ä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ª operator æ¥è¿›è¡Œéƒ¨ç½²å’Œå‡çº§ï¼Œè¿˜å¯ä»¥å°† S3 ä½œä¸ºæœåŠ¡å¤‡ä»½çš„å­˜å‚¨ä»‹è´¨ã€‚æ­¤å¤–ï¼Œä½ å¯èƒ½è¿˜ä¼šå‘ç° Kubernetes çš„å®é™…å¥åº·æ£€æŸ¥æœºåˆ¶ä¸å¤Ÿå¥½ã€‚å‡è®¾å­˜æ´»æ£€æŸ¥å’Œå°±ç»ªæ£€æŸ¥ä¸å¤Ÿå¥½ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ operator å¯¹ä½ çš„åº”ç”¨è¿›è¡Œæ›´æ™ºèƒ½çš„å­˜æ´»å’Œå°±ç»ªæ£€æŸ¥ï¼Œç„¶ååœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œæ¢å¤ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸‰ä¸ªé¢†åŸŸå°±æ˜¯è‡ªåŠ¨ä¼¸ç¼©å’Œè°ƒæ•´ã€‚ä½ å¯ä»¥è®© operator æ›´å¥½çš„äº†è§£ä½ çš„åº”ç”¨ï¼Œå¹¶åœ¨å¹³å°ä¸Šè¿›è¡Œè‡ªåŠ¨è°ƒæ•´ã€‚ç›®å‰ï¼Œç¼–å†™ operator çš„æ¡†æ¶ä¸»è¦æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ Kubernetes ç‰¹åˆ«å…´è¶£å°ç»„çš„ Kubebuilderï¼Œå¦ä¸€ä¸ªæ˜¯çº¢å¸½åˆ›å»ºçš„ operator æ¡†æ¶çš„ä¸€éƒ¨åˆ†&amp;ndash;operator SDKã€‚å®ƒæœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢çš„å†…å®¹ï¼š&lt;/p&gt;
&lt;p&gt;Operator SDK è®©ä½ å¯ä»¥ç¼–å†™ operator &amp;ndash; operator ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨æ¥ç®¡ç† operator çš„ç”Ÿå‘½å‘¨æœŸï¼Œä»¥åŠå¯ä»¥å‘å¸ƒä½ çš„ operator åˆ° OperatorHubã€‚å¦‚ä»Šåœ¨ OperatorHubï¼Œä½ ä¼šçœ‹åˆ° 100 å¤šä¸ª operator ç”¨äºç®¡ç†æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—å’Œç›‘æ§å·¥å…·ã€‚ä»ç”Ÿå‘½å‘¨æœŸç©ºé—´æ¥çœ‹ï¼Œoperator å¯èƒ½æ˜¯ Kubernetes ç”Ÿæ€ç³»ç»Ÿä¸­å‘å±•æœ€æ´»è·ƒçš„é¢†åŸŸã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç½‘ç»œè¶‹åŠ¿---envoy&#34;&gt;ç½‘ç»œè¶‹åŠ¿ - Envoy&lt;/h2&gt;
&lt;p&gt;æˆ‘é€‰çš„å¦ä¸€ä¸ªé¡¹ç›®æ˜¯ &lt;a href=&#34;https://www.envoyproxy.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Envoy&lt;/a&gt;ã€‚æœåŠ¡ç½‘æ ¼æ¥å£è§„èŒƒçš„å¼•å…¥å°†ä½¿ä½ æ›´è½»æ¾åœ°åˆ‡æ¢ä¸åŒçš„æœåŠ¡ç½‘æ ¼å®ç°ã€‚åœ¨éƒ¨ç½²ä¸Š Istio å¯¹æ¶æ„è¿›è¡Œäº†ä¸€äº›æ•´åˆã€‚ä½ ä¸å†éœ€è¦ä¸ºæ§åˆ¶å¹³é¢éƒ¨ç½² 7 ä¸ª Podï¼›ç°åœ¨ï¼Œä½ åªéœ€è¦éƒ¨ç½²ä¸€æ¬¡å°±å¯ä»¥äº†ã€‚æ›´æœ‰è¶£çš„æ˜¯åœ¨ Envoy é¡¹ç›®çš„æ•°æ®å¹³é¢ä¸Šæ‰€æ­£åœ¨å‘ç”Ÿçš„ï¼šè¶Šæ¥è¶Šå¤šçš„ç¬¬ 7 å±‚åè®®è¢«æ·»åŠ åˆ° Envoy ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/distributed-systems-kubernetes/11image015-1616431697613_hu1934386658316778416.webp 400w,
               /blog/distributed-systems-kubernetes/11image015-1616431697613_hu67458695782938744.webp 760w,
               /blog/distributed-systems-kubernetes/11image015-1616431697613_hu4276126567250760196.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/distributed-systems-kubernetes/11image015-1616431697613_hu1934386658316778416.webp&#34;
               width=&#34;760&#34;
               height=&#34;379&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœåŠ¡ç½‘æ ¼å¢åŠ äº†å¯¹æ›´å¤šåè®®çš„æ”¯æŒï¼Œæ¯”å¦‚ MongoDBã€ZooKeeperã€MySQLã€Redisï¼Œè€Œæœ€æ–°çš„åè®®æ˜¯ Kafkaã€‚æˆ‘çœ‹åˆ° Kafka ç¤¾åŒºç°åœ¨æ­£åœ¨è¿›ä¸€æ­¥æ”¹è¿›ä»–ä»¬çš„åè®®ï¼Œä½¿å…¶å¯¹æœåŠ¡ç½‘æ ¼æ›´åŠ å‹å¥½ã€‚æˆ‘ä»¬å¯ä»¥é¢„æ–™å°†ä¼šæœ‰æ›´ç´§å¯†çš„é›†æˆã€æ›´å¤šçš„åŠŸèƒ½ã€‚æœ€æœ‰å¯èƒ½çš„æ˜¯ï¼Œä¼šæœ‰ä¸€äº›æ¡¥æ¥çš„èƒ½åŠ›ã€‚ä½ å¯ä»¥ä»æœåŠ¡ä¸­åœ¨ä½ çš„åº”ç”¨æœ¬åœ°åšä¸€ä¸ª HTTP è°ƒç”¨ï¼Œè€Œä»£ç†å°†åœ¨åå°ä½¿ç”¨ Kafkaã€‚ä½ å¯ä»¥åœ¨åº”ç”¨å¤–éƒ¨ï¼Œåœ¨ sidecar ä¸­é’ˆå¯¹ Kafka åè®®è¿›è¡Œè½¬æ¢å’ŒåŠ å¯†ã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€ä¸ªä»¤äººå…´å¥‹çš„å‘å±•æ˜¯å¼•å…¥äº† HTTP ç¼“å­˜ã€‚ç°åœ¨ Envoy å¯ä»¥è¿›è¡Œ HTTP ç¼“å­˜ã€‚ä½ ä¸å¿…åœ¨ä½ çš„åº”ç”¨ä¸­ä½¿ç”¨ç¼“å­˜å®¢æˆ·ç«¯ã€‚æ‰€æœ‰è¿™äº›éƒ½æ˜¯åœ¨ sidecar ä¸­é€æ˜åœ°å®Œæˆçš„ã€‚æœ‰äº† tap è¿‡æ»¤å™¨ï¼Œä½ å¯ä»¥ tap æµé‡å¹¶è·å¾—æµé‡çš„å‰¯æœ¬ã€‚æœ€è¿‘ï¼ŒWebAssembly çš„å¼•å…¥ï¼Œæ„å‘³ç€å¦‚æœä½ è¦ä¸º Envoy ç¼–å†™ä¸€äº›è‡ªå®šä¹‰çš„è¿‡æ»¤å™¨ï¼Œä½ ä¸å¿…ç”¨ C++ ç¼–å†™ï¼Œä¹Ÿä¸å¿…ç¼–è¯‘æ•´ä¸ª Envoy è¿è¡Œæ—¶ã€‚ä½ å¯ä»¥ç”¨ WebAssembly å†™ä½ çš„è¿‡æ»¤å™¨ï¼Œç„¶ååœ¨è¿è¡Œæ—¶è¿›è¡Œéƒ¨ç½²ã€‚è¿™äº›å¤§å¤šæ•°è¿˜åœ¨è¿›è¡Œä¸­ã€‚å®ƒä»¬ä¸å­˜åœ¨ï¼Œè¯´æ˜æ•°æ®å¹³é¢å’ŒæœåŠ¡ç½‘æ ¼æ— æ„åœæ­¢ï¼Œä»…æ”¯æŒ HTTP å’Œ gRPCã€‚ä»–ä»¬æœ‰å…´è¶£æ”¯æŒæ›´å¤šçš„åº”ç”¨å±‚åè®®ï¼Œä¸ºä½ æä¾›æ›´å¤šçš„åŠŸèƒ½ï¼Œä»¥å®ç°æ›´å¤šçš„ç”¨ä¾‹ã€‚æœ€ä¸»è¦çš„æ˜¯ï¼Œéšç€ WebAssembly çš„å¼•å…¥ï¼Œä½ ç°åœ¨å¯ä»¥åœ¨ sidecar ä¸­ç¼–å†™è‡ªå®šä¹‰é€»è¾‘ã€‚åªè¦ä½ æ²¡æœ‰åœ¨å…¶ä¸­æ·»åŠ ä¸€äº›ä¸šåŠ¡é€»è¾‘å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»‘å®šè¶‹åŠ¿---apache-camel&#34;&gt;ç»‘å®šè¶‹åŠ¿ - Apache Camel&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://camel.apache.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Apache Camel&lt;/a&gt; æ˜¯ä¸€ä¸ªç”¨äºé›†æˆçš„é¡¹ç›®ï¼Œå®ƒå…·æœ‰å¾ˆå¤šä½¿ç”¨ä¼ä¸šé›†æˆæ¨¡å¼è¿æ¥åˆ°ä¸åŒç³»ç»Ÿçš„è¿æ¥å™¨ã€‚Â æ¯”å¦‚ &lt;a href=&#34;https://camel.apache.org/releases/release-3.0.0/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Camel version 3&lt;/a&gt; å°±æ·±åº¦é›†æˆåˆ°äº† Kubernetes ä¸­ï¼Œå¹¶ä¸”ä½¿ç”¨äº†æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢æ‰€è®²çš„é‚£äº›åŸè¯­ï¼Œæ¯”å¦‚ operatorã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/distributed-systems-kubernetes/7image016-1616431694981_hu4014679567435536196.webp 400w,
               /blog/distributed-systems-kubernetes/7image016-1616431694981_hu16917727728406907847.webp 760w,
               /blog/distributed-systems-kubernetes/7image016-1616431694981_hu16266747455384627328.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/distributed-systems-kubernetes/7image016-1616431694981_hu4014679567435536196.webp&#34;
               width=&#34;760&#34;
               height=&#34;374&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥åœ¨ Camel ä¸­ç”¨ Javaã€JavaScript æˆ– YAML ç­‰è¯­è¨€ç¼–å†™ä½ çš„é›†æˆé€»è¾‘ã€‚æœ€æ–°çš„ç‰ˆæœ¬å¼•å…¥äº†ä¸€ä¸ª Camel operatorï¼Œå®ƒåœ¨ Kubernetes ä¸­è¿è¡Œå¹¶ç†è§£ä½ çš„é›†æˆã€‚å½“ä½ å†™å¥½ Camel åº”ç”¨ï¼Œå°†å…¶éƒ¨ç½²åˆ°è‡ªå®šä¹‰èµ„æºä¸­ï¼Œoperator å°±çŸ¥é“å¦‚ä½•æ„å»ºå®¹å™¨æˆ–æŸ¥æ‰¾ä¾èµ–é¡¹ã€‚æ ¹æ®å¹³å°çš„èƒ½åŠ›ï¼Œä¸ç®¡æ˜¯åªç”¨ Kubernetesï¼Œè¿˜æ˜¯å¸¦æœ‰ Knative çš„ Kubernetesï¼Œå®ƒéƒ½å¯ä»¥å†³å®šè¦ä½¿ç”¨çš„æœåŠ¡ä»¥åŠå¦‚ä½•å®ç°é›†æˆã€‚åœ¨è¿è¡Œæ—¶ä¹‹å¤–æœ‰ç›¸å½“å¤šçš„æ™ºèƒ½ &amp;ndash; åŒ…æ‹¬ operator &amp;ndash; æ‰€æœ‰è¿™äº›éƒ½éå¸¸å¿«åœ°å‘ç”Ÿã€‚ä¸ºä»€ä¹ˆæˆ‘ä¼šè¯´è¿™æ˜¯ä¸€ä¸ªç»‘å®šçš„è¶‹åŠ¿ï¼Ÿä¸»è¦æ˜¯å› ä¸º Apache Camel æä¾›çš„è¿æ¥å™¨çš„åŠŸèƒ½ã€‚è¿™é‡Œæœ‰è¶£çš„ä¸€ç‚¹æ˜¯å®ƒå¦‚ä½•ä¸ Kubernetes æ·±åº¦é›†æˆã€‚&lt;/p&gt;
&lt;h2 id=&#34;çŠ¶æ€è¶‹åŠ¿---cloudstate&#34;&gt;çŠ¶æ€è¶‹åŠ¿ - Cloudstate&lt;/h2&gt;
&lt;p&gt;å¦ä¸€ä¸ªæˆ‘æƒ³è®¨è®ºçš„é¡¹ç›®æ˜¯ &lt;a href=&#34;https://cloudstate.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cloudstate&lt;/a&gt; å’Œä¸çŠ¶æ€ç›¸å…³çš„è¶‹åŠ¿ã€‚Cloudstate æ˜¯ Lightbend çš„ä¸€ä¸ªé¡¹ç›®ï¼Œä¸»è¦è‡´åŠ›äºæ— æœåŠ¡å™¨å’ŒåŠŸèƒ½é©±åŠ¨çš„å¼€å‘ã€‚æœ€æ–°å‘å¸ƒçš„ç‰ˆæœ¬ï¼Œæ­£åœ¨ä½¿ç”¨ sidecar å’Œ operator ä¸ Kubernetes è¿›è¡Œæ·±åº¦é›†æˆã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/distributed-systems-kubernetes/8image017-1616431996943_hu7958518252389668386.webp 400w,
               /blog/distributed-systems-kubernetes/8image017-1616431996943_hu12735065375736212191.webp 760w,
               /blog/distributed-systems-kubernetes/8image017-1616431996943_hu11688810169149376020.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/distributed-systems-kubernetes/8image017-1616431996943_hu7958518252389668386.webp&#34;
               width=&#34;760&#34;
               height=&#34;447&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªåˆ›æ„æ˜¯ï¼Œå½“ä½ ç¼–å†™ä½ çš„åŠŸèƒ½æ—¶ï¼Œä½ åœ¨åŠŸèƒ½ä¸­è¦åšçš„å°±æ˜¯ä½¿ç”¨ gRPC æ¥è·å–çŠ¶æ€å¹¶ä¸ä¹‹è¿›è¡Œäº¤äº’ã€‚æ•´ä¸ªçŠ¶æ€ç®¡ç†åœ¨ä¸å…¶ä»– sidecar ç¾¤é›†çš„ sidear ä¸­è¿›è¡Œã€‚å®ƒä½¿ä½ èƒ½å¤Ÿè¿›è¡Œäº‹ä»¶æº¯æºã€CQRSã€é”®å€¼æŸ¥è¯¢ã€æ¶ˆæ¯ä¼ é€’ã€‚&lt;/p&gt;
&lt;p&gt;ä»åº”ç”¨ç¨‹åºè§’åº¦æ¥çœ‹ï¼Œä½ å¹¶ä¸äº†è§£æ‰€æœ‰è¿™äº›å¤æ‚æ€§ã€‚ä½ æ‰€åšçš„åªæ˜¯è°ƒç”¨ä¸€ä¸ªæœ¬åœ°çš„ sidecarï¼Œè€Œ sidecar ä¼šå¤„ç†è¿™äº›å¤æ‚çš„äº‹æƒ…ã€‚å®ƒå¯ä»¥åœ¨åå°ä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„æ•°æ®æºã€‚è€Œä¸”å®ƒæ‹¥æœ‰å¼€å‘äººå‘˜æ‰€éœ€çš„æ‰€æœ‰æœ‰çŠ¶æ€æŠ½è±¡ã€‚&lt;/p&gt;
&lt;p&gt;åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†äº‘åŸç”Ÿç”Ÿæ€ç³»ç»Ÿä¸­çš„æœ€æ–°æŠ€æœ¯ä»¥åŠä¸€äº›ä»åœ¨è¿›è¡Œä¸­çš„å¼€å‘ã€‚æˆ‘ä»¬å¦‚ä½•ç†è§£è¿™ä¸€åˆ‡ï¼Ÿ&lt;/p&gt;
&lt;h2 id=&#34;å¤šè¿è¡Œæ—¶å¾®æœåŠ¡å·²ç»åˆ°æ¥&#34;&gt;å¤šè¿è¡Œæ—¶å¾®æœåŠ¡å·²ç»åˆ°æ¥&lt;/h2&gt;
&lt;p&gt;å¦‚æœä½ çœ‹å¾®æœåŠ¡åœ¨ Kubernetes ä¸Šçš„æ ·å­ï¼Œåˆ™å°†éœ€è¦ä½¿ç”¨æŸäº›å¹³å°åŠŸèƒ½ã€‚æ­¤å¤–ï¼Œä½ å°†éœ€è¦é¦–å…ˆä½¿ç”¨ Kubernetes çš„åŠŸèƒ½è¿›è¡Œç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚ç„¶åï¼Œå¾ˆæœ‰å¯èƒ½é€æ˜åœ°ï¼Œä½ çš„æœåŠ¡ä¼šä½¿ç”¨æŸäº›æœåŠ¡ç½‘æ ¼ï¼ˆä¾‹å¦‚ Envoyï¼‰æ¥è·å¾—å¢å¼ºçš„ç½‘ç»œåŠŸèƒ½ï¼Œæ— è®ºæ˜¯æµé‡è·¯ç”±ã€å¼¹æ€§ã€å¢å¼ºçš„å®‰å…¨æ€§ï¼Œç”šè‡³å‡ºäºç›‘æ§çš„ç›®çš„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ ¹æ®ä½ çš„åœºæ™¯å’Œä½¿ç”¨çš„å·¥ä½œè´Ÿè½½å¯èƒ½éœ€è¦ Dapr æˆ–è€… Knativeã€‚æ‰€æœ‰è¿™äº›éƒ½ä»£è¡¨äº†è¿›ç¨‹å¤–é™„åŠ çš„åŠŸèƒ½ã€‚å‰©ä¸‹çš„å°±æ˜¯ç¼–å†™ä¸šåŠ¡é€»è¾‘ï¼Œä¸æ˜¯æ”¾åœ¨æœ€ä¸Šé¢è€Œæ˜¯ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„è¿è¡Œæ—¶æ¥ç¼–å†™ã€‚æœªæ¥çš„å¾®æœåŠ¡å¾ˆæœ‰å¯èƒ½å°†æ˜¯ç”±å¤šä¸ªå®¹å™¨ç»„æˆçš„è¿™ç§å¤šè¿è¡Œæ—¶ã€‚æœ‰äº›æ˜¯é€æ˜çš„ï¼Œæœ‰äº›åˆ™æ˜¯éå¸¸æ˜ç¡®çš„ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/distributed-systems-kubernetes/6image018-1616431996411_hu17523127410977922559.webp 400w,
               /blog/distributed-systems-kubernetes/6image018-1616431996411_hu10696267582455429059.webp 760w,
               /blog/distributed-systems-kubernetes/6image018-1616431996411_hu1059437279396433640.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/distributed-systems-kubernetes/6image018-1616431996411_hu17523127410977922559.webp&#34;
               width=&#34;760&#34;
               height=&#34;367&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;æ™ºèƒ½çš„-sidecar-å’Œæ„šè ¢çš„ç®¡é“&#34;&gt;æ™ºèƒ½çš„ sidecar å’Œæ„šè ¢çš„ç®¡é“&lt;/h2&gt;
&lt;p&gt;å¦‚æœæ›´æ·±å…¥åœ°çœ‹ï¼Œé‚£å¯èƒ½æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€äº›é«˜çº§è¯­è¨€ç¼–å†™ä¸šåŠ¡é€»è¾‘ã€‚æ˜¯ä»€ä¹ˆå¹¶ä¸é‡è¦ï¼Œä¸å¿…ä»…æ˜¯ Javaï¼Œå› ä¸ºä½ å¯ä»¥ä½¿ç”¨ä»»ä½•å…¶ä»–è¯­è¨€å¹¶åœ¨å†…éƒ¨å¼€å‘è‡ªå®šä¹‰é€»è¾‘ã€‚&lt;/p&gt;
&lt;p&gt;ä½ çš„ä¸šåŠ¡é€»è¾‘ä¸å¤–éƒ¨ä¸–ç•Œçš„æ‰€æœ‰äº¤äº’éƒ½æ˜¯é€šè¿‡ sidecar å‘ç”Ÿçš„ï¼Œå¹¶ä¸å¹³å°é›†æˆè¿›è¡Œç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚å®ƒä¸ºå¤–éƒ¨ç³»ç»Ÿæ‰§è¡Œç½‘ç»œæŠ½è±¡ï¼Œä¸ºä½ æä¾›é«˜çº§çš„ç»‘å®šåŠŸèƒ½å’ŒçŠ¶æ€æŠ½è±¡ã€‚sidecar æ˜¯ä½ ä¸éœ€è¦å¼€å‘çš„ä¸œè¥¿ã€‚ä½ å¯ä»¥ä»è´§æ¶ä¸Šæ‹¿åˆ°å®ƒã€‚ä½ ç”¨ä¸€ç‚¹ YAML æˆ– JSON é…ç½®å®ƒï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨å®ƒã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥è½»æ¾åœ°æ›´æ–° sidecarï¼Œå› ä¸ºå®ƒä¸å†è¢«åµŒå…¥åˆ°ä½ çš„è¿è¡Œæ—¶ã€‚è¿™ä½¿å¾—æ‰“è¡¥ä¸ã€æ›´æ–°å˜å¾—æ›´åŠ æ›´å®¹æ˜“ã€‚å®ƒä¸ºæˆ‘ä»¬çš„ä¸šåŠ¡é€»è¾‘å¯ç”¨äº†å¤šè¯­è¨€è¿è¡Œæ—¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¾®æœåŠ¡ä¹‹åæ˜¯ä»€ä¹ˆ&#34;&gt;å¾®æœåŠ¡ä¹‹åæ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h2&gt;
&lt;p&gt;è¿™è®©æˆ‘æƒ³åˆ°äº†æœ€åˆçš„é—®é¢˜ï¼Œå¾®æœåŠ¡ä¹‹åæ˜¯ä»€ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/distributed-systems-kubernetes/6image020-1616431995910_hu13588844936745446971.webp 400w,
               /blog/distributed-systems-kubernetes/6image020-1616431995910_hu14349919724544248412.webp 760w,
               /blog/distributed-systems-kubernetes/6image020-1616431995910_hu2986429091926892071.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/distributed-systems-kubernetes/6image020-1616431995910_hu13588844936745446971.webp&#34;
               width=&#34;760&#34;
               height=&#34;366&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬çœ‹ä¸‹æ¶æ„çš„å‘å±•å†ç¨‹ï¼Œåº”ç”¨æ¶æ„åœ¨å¾ˆé«˜çš„å±‚é¢ä¸Šæ˜¯ä»å•ä½“åº”ç”¨å¼€å§‹çš„ã€‚ç„¶è€Œå¾®æœåŠ¡ç»™æˆ‘ä»¬æä¾›äº†å¦‚ä½•æŠŠä¸€ä¸ªå•ä½“åº”ç”¨æ‹†åˆ†æˆç‹¬ç«‹çš„ä¸šåŠ¡åŸŸçš„æŒ‡å¯¼åŸåˆ™ã€‚ä¹‹ååˆå‡ºç°äº†æ— æœåŠ¡å™¨å’ŒåŠŸèƒ½å³æœåŠ¡ï¼ˆFaaSï¼‰ï¼Œæˆ‘ä»¬è¯´è¿‡å¯ä»¥æŒ‰æ“ä½œå°†å…¶è¿›ä¸€æ­¥æ‹†åˆ†ï¼Œä»è€Œå®ç°æé«˜çš„å¯æ‰©å±•æ€§ - å› ä¸ºæˆ‘ä»¬å¯ä»¥åˆ†åˆ«æ‰©å±•æ¯ä¸ªæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘æƒ³è¯´çš„æ˜¯ FaaS å¹¶ä¸æ˜¯æœ€å¥½çš„æ¨¡å¼ &amp;ndash; å› ä¸ºåŠŸèƒ½å¹¶ä¸æ˜¯å®ç°åˆç†çš„å¤æ‚æœåŠ¡çš„æœ€ä½³æ¨¡å¼ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“å¤šä¸ªæ“ä½œå¿…é¡»ä¸åŒä¸€ä¸ªæ•°æ®é›†è¿›è¡Œäº¤äº’æ—¶ï¼Œä½ å¸Œæœ›å®ƒä»¬é©»ç•™åœ¨ä¸€èµ·ã€‚å¯èƒ½æ˜¯å¤šè¿è¡Œæ—¶ï¼ˆæˆ‘æŠŠå®ƒç§°ä¸º &lt;a href=&#34;https://www.infoq.com/articles/multi-runtime-microservice-architecture/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Mecha æ¶æ„&lt;/a&gt;ï¼‰ï¼Œåœ¨è¯¥æ¶æ„ä¸­ä½ å°†ä¸šåŠ¡é€»è¾‘æ”¾åœ¨ä¸€ä¸ªå®¹å™¨ä¸­ï¼Œè€Œæ‰€æœ‰ä¸åŸºç¡€è®¾æ–½ç›¸å…³çš„å…³æ³¨ç‚¹ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„å®¹å™¨å­˜åœ¨ã€‚å®ƒä»¬å…±åŒä»£è¡¨å¤šè¿è¡Œæ—¶å¾®æœåŠ¡ã€‚ä¹Ÿè®¸è¿™æ˜¯ä¸€ä¸ªæ›´åˆé€‚çš„æ¨¡å‹ï¼Œå› ä¸ºå®ƒæœ‰æ›´å¥½çš„å±æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥è·å¾—å¾®æœåŠ¡çš„æ‰€æœ‰å¥½å¤„ã€‚ä»ç„¶å°†æ‰€æœ‰åŸŸå’Œæ‰€æœ‰é™ç•Œä¸Šä¸‹æ–‡æ”¾åœ¨ä¸€å¤„ã€‚ä½ å°†æ‰€æœ‰çš„åŸºç¡€è®¾æ–½å’Œåˆ†å¸ƒå¼åº”ç”¨éœ€æ±‚æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„å®¹å™¨ä¸­ï¼Œå¹¶åœ¨è¿è¡Œæ—¶å°†å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·ã€‚å¤§æ¦‚ï¼Œç°åœ¨æœ€æ¥è¿‘è¿™ç§æ¨¡å‹çš„æ˜¯ Daprã€‚ä»–ä»¬æ­£åœ¨éµå¾ªè¿™ç§æ¨¡å‹ã€‚å¦‚æœä½ ä»…å¯¹ç½‘ç»œæ–¹é¢æ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆå¯èƒ½ä½¿ç”¨ Envoy ä¹Ÿä¼šæ¥è¿‘è¿™ç§æ¨¡å‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…³äºä½œè€…&#34;&gt;å…³äºä½œè€…&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Bilgin Ibryam&lt;/strong&gt; æ˜¯çº¢å¸½å…¬å¸çš„äº§å“ç»ç†å’Œå‰æ¶æ„å¸ˆã€æäº¤äººï¼Œå¹¶ä¸”æ˜¯ Apache è½¯ä»¶åŸºé‡‘ä¼šçš„æˆå‘˜ã€‚ä»–æ˜¯å¼€æºå¸ƒé“è€…ï¼Œç»å¸¸å†™åšå®¢ã€å‘è¡¨æ¼”è®²ï¼Œæ˜¯ &lt;a href=&#34;https://k8spatterns.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes Patterns&lt;/a&gt; å’Œ Camel Design Patterns ä¹¦ç±çš„ä½œè€…ã€‚Bilgin ç›®å‰çš„å·¥ä½œä¸»è¦é›†ä¸­åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿã€äº‹ä»¶é©±åŠ¨æ¶æ„ä»¥åŠå¯é‡å¤çš„äº‘åŸç”Ÿåº”ç”¨å¼€å‘æ¨¡å¼å’Œå®è·µä¸Šã€‚è¯·å…³æ³¨ä»– @bibryam äº†è§£æœªæ¥ç±»ä¼¼ä¸»é¢˜çš„æ›´æ–°ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä¸ºä»€ä¹ˆ RBAC ä¸è¶³ä»¥ä¿éšœ Kubernetes çš„å®‰å…¨ï¼Ÿ</title>
      <link>https://cloudnativecn.com/blog/why-rbac-is-not-enough-for-kubernetes-api-security/</link>
      <pubDate>Thu, 17 Dec 2020 10:03:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/why-rbac-is-not-enough-for-kubernetes-api-security/</guid>
      <description>&lt;p&gt;Kubernetes ä¸å†æ˜¯ï¼ˆåªæ˜¯ï¼‰å¥½ç©çš„æ¸¸æˆäº†ã€‚å®ƒæ­£åœ¨è¢«ç”¨äºç”Ÿäº§ï¼›å®ƒæ˜¯å…³é”®ä»»åŠ¡ï¼›æ‰€æœ‰æ—§æœ‰çš„å®‰å…¨å’Œåˆè§„è§„åˆ™å’Œæ³•è§„éƒ½éœ€è¦ä»¥æŸç§æ–¹å¼åŠ è£…åˆ° Kubernetes ä¸Šã€‚ä¸å¹¸çš„æ˜¯ï¼Œåƒ RBAC è¿™æ ·çš„æ—§çš„è®¿é—®æ§åˆ¶å·¥å…·æ ¹æœ¬æ— æ³•åº”å¯¹æŒ‘æˆ˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¦‚è¿°&#34;&gt;æ¦‚è¿°&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Kubernetes API çš„è®¾è®¡ä¸å¤§å¤šæ•°ç°ä»£ API ä¸åŒã€‚&lt;/strong&gt; å®ƒæ˜¯åŸºäºæ„å›¾çš„ï¼Œè¿™æ„å‘³ç€ä½¿ç”¨ API çš„äººè€ƒè™‘çš„æ˜¯ä»–ä»¬æƒ³è¦ Kubernetes åšä»€ä¹ˆï¼Œè€Œä¸æ˜¯å¦‚ä½•å®ç°ã€‚å…¶ç»“æœæ˜¯ä¸€ä¸ªä»¤äººéš¾ä»¥ç½®ä¿¡çš„å¯æ‰©å±•æ€§ã€å¼¹æ€§ï¼Œå’Œä¸€ä¸ªå¼ºå¤§è€Œæµè¡Œçš„ç³»ç»Ÿã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŒæ—¶ï¼Œå…¶åŸºäºæ„å›¾çš„ API ç»™å®‰å…¨å¸¦æ¥äº†æŒ‘æˆ˜ã€‚&lt;/strong&gt; æ ‡å‡†çš„è®¿é—®æ§åˆ¶è§£å†³æ–¹æ¡ˆï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ã€åŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ã€è®¿é—®æ§åˆ¶åˆ—è¡¨æˆ– IAM ç­–ç•¥ï¼‰éƒ½ä¸å¤Ÿå¼ºå¤§ï¼Œæ— æ³•å¼ºåˆ¶æ‰§è¡ŒåŸºæœ¬çš„ç­–ç•¥ï¼Œæ¯”å¦‚è°å¯ä»¥æ›´æ”¹ pod ä¸Šçš„æ ‡ç­¾ï¼Œæˆ–è€…å“ªäº›é•œåƒå­˜å‚¨åº“æ˜¯å®‰å…¨çš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Kubernetes Admission Control å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œè®¾è®¡çš„ã€‚&lt;/strong&gt; Kubernetes Admission Controller å¹¶ä¸èƒ½è§£å†³å¼€ç®±å³ç”¨çš„è®¿é—®æ§åˆ¶é—®é¢˜ï¼Œä½†å®ƒä»¬å…è®¸ä½ ä½¿ç”¨ Webhook æ¥è§£å†³æˆæƒæŒ‘æˆ˜ä¸è§£è€¦ç­–ç•¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;kubernetes-åŸºäºæ„å›¾çš„-api&#34;&gt;Kubernetes åŸºäºæ„å›¾çš„ API&lt;/h2&gt;
&lt;p&gt;Kubernetes API æ¥å—äº†ä¸€ä¸ªä¸æˆ‘ä»¬å¤§å®¶ä¹ æƒ¯çš„ API èŒƒå¼æˆªç„¶ä¸åŒçš„ APIã€‚ä»Šå¤©çš„å¤§å¤šæ•° API éƒ½æ˜¯æ‰€è°“çš„ &lt;em&gt;åŸºäºè¡ŒåŠ¨çš„ï¼ˆaction-basedï¼‰&lt;/em&gt;ï¼Œè¿™æ„å‘³ç€å½“ä½ æƒ³åˆ°ä¸€ä¸ª API è°ƒç”¨æ—¶ï¼Œä½ æ­£åœ¨è€ƒè™‘ä½ æƒ³è¦æ‰§è¡Œçš„è¡ŒåŠ¨ï¼Œä»¥æ”¹å˜è½¯ä»¶çš„è¿è¡Œæ–¹å¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è®©ä¸€ä¸ªåº”ç”¨ç¨‹åºæš´éœ²åœ¨äº’è”ç½‘ä¸Šï¼Œä½ å¯èƒ½ä¼šè¿è¡Œ API openport (443)ï¼Œæ”¹å˜åº”ç”¨ç¨‹åºä¸Šçš„ç½‘ç»œè®¾ç½®ï¼Œä½¿ç«¯å£ 443 æ‰“å¼€ã€‚&lt;/p&gt;
&lt;p&gt;ç›¸æ¯”ä¹‹ä¸‹ï¼ŒKubernetes æœ‰æ‰€è°“çš„ &lt;em&gt;åŸºäºæ„å›¾çš„ï¼ˆintent-basedï¼‰&lt;/em&gt; APIï¼ˆæœ€è¿‘åœ¨ç½‘ç»œé¢†åŸŸæµè¡Œï¼Œä¾‹å¦‚ &lt;a href=&#34;https://medium.com/r/?url=https%3A%2F%2Fwww.sdxcentral.com%2Fsdn%2Fdefinitions%2Fwhat-is-intent-based-networking%2F&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;SDXCentral&lt;/a&gt;ï¼‰ï¼Œè¿™æ„å‘³ç€å½“ä½ æƒ³è¦è¿›è¡Œä¸€ä¸ª API è°ƒç”¨æ—¶ï¼Œä½ è¦è€ƒè™‘çš„æ˜¯ä½ å¸Œæœ›è¯¥ç³»ç»Ÿå¤„äºä½•ç§çŠ¶æ€ã€‚ä½ å¹¶ä¸å…³å¿ƒç”¨ä»€ä¹ˆæ“ä½œæ¥å®ç°è¿™ç§å¸Œæœ›çš„çŠ¶æ€ã€‚ä½ åªéœ€å‘Šè¯‰ç³»ç»Ÿä½ æƒ³è¦ä»€ä¹ˆï¼ˆä½ çš„æ„å›¾ï¼‰ï¼Œç³»ç»Ÿå°±ä¼šæƒ³å‡ºå¦‚ä½•å®ç°å®ƒ â€”â€” é‡‡å–å“ªäº›åŠ¨ä½œå°†ç³»ç»Ÿè¿‡æ¸¡åˆ°æœŸæœ›çš„çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥è¯´ä½ çš„åº”ç”¨ç¨‹åºåº”è¯¥è¿è¡Œ 1.7 ç‰ˆæœ¬çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåº”è¯¥ä½¿ç”¨å¸¦åŠ å¯†çš„æŒä¹…å­˜å‚¨ï¼Œå¹¶ä¸”åº”è¯¥è¿æ¥åˆ°äº’è”ç½‘ã€‚ç³»ç»Ÿä¼šè®¡ç®—å‡ºå¦‚ä½•å‡çº§æˆ–é™çº§äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¦‚ä½•å¼€å¯åŠ å¯†ï¼Œä»¥åŠå¦‚ä½•é‡æ–°é…ç½®ç½‘ç»œä»¥å…è®¸äº’è”ç½‘è¿æ¥ã€‚&lt;/p&gt;
&lt;p&gt;æ¶æ„ä¸Šçš„å…³é”®åŒºåˆ«åœ¨äºï¼Œ&lt;em&gt;åŸºäºæ„å›¾çš„&lt;/em&gt; ç³»ç»Ÿæ—¢èƒ½ç†è§£ç³»ç»Ÿå½“å‰æ‰€å¤„çš„çŠ¶æ€ï¼ˆæœ‰æ—¶ç§°ä¸º &lt;em&gt;å®é™…çŠ¶æ€&lt;/em&gt; ï¼‰ï¼Œä¹Ÿèƒ½ç†è§£ä½ å¯¹ç³»ç»Ÿåº”è¯¥å¤„äºä½•ç§çŠ¶æ€çš„æ„å›¾ï¼ˆ&lt;em&gt;æœŸæœ›çŠ¶æ€&lt;/em&gt;ï¼‰ã€‚ç³»ç»Ÿä¸æ–­åœ°è®¡ç®—ä¸¤è€…ä¹‹é—´çš„å·®è·ï¼Œå¹¶é‡‡å–ä»»ä½•å¿…è¦çš„è¡ŒåŠ¨ä½¿å®é™…çŠ¶æ€å˜æˆæœŸæœ›çŠ¶æ€ã€‚ç”¨æˆ·å¯ä»¥ç›´æ¥é€šè¿‡ API è°ƒç”¨æ¥æ”¹å˜æœŸæœ›çŠ¶æ€ï¼Œè€Œä¾é ç³»ç»Ÿæœ¬èº«æ¥æ”¹å˜å®é™…çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/why-rbac-is-not-enough-for-kubernetes-api-security/0081Kckwly1glqzp7lpo7j30l20ept9z_hu4181820861378181227.webp 400w,
               /blog/why-rbac-is-not-enough-for-kubernetes-api-security/0081Kckwly1glqzp7lpo7j30l20ept9z_hu14931162685243190760.webp 760w,
               /blog/why-rbac-is-not-enough-for-kubernetes-api-security/0081Kckwly1glqzp7lpo7j30l20ept9z_hu14235550164884704622.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/why-rbac-is-not-enough-for-kubernetes-api-security/0081Kckwly1glqzp7lpo7j30l20ept9z_hu4181820861378181227.webp&#34;
               width=&#34;758&#34;
               height=&#34;529&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Kubernetes çš„ API æ˜¯åŸºäºæ„å›¾çš„ã€‚æ¯ä¸ª API è°ƒç”¨éƒ½å…è®¸ä½ æŒ‡å®š Kubernetes ä¼—å¤šå¯¹è±¡ä¸­çš„ä¸€ä¸ªå¯¹è±¡çš„æœŸæœ›çŠ¶æ€ï¼špodã€serviceã€ingressã€configmap ç­‰ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯ä½ ä¸ºä¸€ä¸ª nginx å·¥ä½œè´Ÿè½½å®šä¹‰çš„æœŸæœ›çŠ¶æ€ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# nginx-pod.yaml&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx	&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åè¦æŠŠè¿™ä¸ªæƒ³è¦çš„çŠ¶æ€å‘é€åˆ° Kubernetesï¼Œç”¨ kubectlï¼ŒæŠŠä¸Šé¢çš„ YAML æ–‡ä»¶äº¤ç»™å®ƒå°±è¡Œäº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f nginx-pod.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å‡è®¾ä½ æƒ³æ”¹å˜ nginx çš„ç‰ˆæœ¬ï¼ŒæŒ‚è½½ä¸€ä¸ªå¤–éƒ¨å·ï¼Œæˆ–è€…æä¾›é¢å¤–çš„é…ç½®ï¼Œä½ æ›´æ–° nginx-pod.yaml æ–‡ä»¶åˆ°ä»»ä½•ä½ æƒ³è¦çš„çŠ¶æ€ï¼Œç„¶åå†ä½¿ç”¨ kubectl applyã€‚æ›´æ–° nginx-pod.yaml æ–‡ä»¶åˆ°ä»»ä½•éœ€è¦çš„çŠ¶æ€ï¼Œç„¶åå†ä½¿ç”¨ kubectl applyã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f nginx-pod.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œçš„å…³é”®è¦ç‚¹æ˜¯ï¼Œä½ ä¸æ˜¯åœ¨è¿è¡Œåƒ updateVersion æˆ– mountVolume è¿™æ ·çš„ APIï¼Œè€Œæ˜¯åœ¨æ”¹å˜ä¸€äº›æè¿°ç³»ç»Ÿåº”è¯¥å¤„äºä»€ä¹ˆçŠ¶æ€çš„ YAMLï¼Œå¹¶é€šè¿‡è¿è¡Œ apply æ¥è¯´&amp;quot; ä½¿ä¹‹å¦‚æ­¤ &amp;ldquo;ã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes çš„ API æ¨¡å‹æœ‰å‡ ä¸ªä¼˜åŠ¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å‡å°‘å­¦ä¹ æ›²çº¿&lt;/strong&gt;ã€‚ä½ è¦å­¦ä¹ æ¯ä¸ªå¯¹è±¡çš„ YAML æ ¼å¼å’Œä¸€ç³»åˆ—åŠ¨ä½œï¼Œå¦‚åˆ›å»ºã€åº”ç”¨ã€è·å–ã€æè¿°ã€åˆ é™¤ã€‚æ— è®ºå¦‚ä½•ï¼Œä½ éƒ½éœ€è¦å­¦ä¹ æ¯ä¸ªå¯¹è±¡çš„ YAML é…ç½®æ ¼å¼ï¼ˆè¿™æ ·ä½ æ‰èƒ½è¯»æ‡‚å®ƒï¼‰ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œ&lt;em&gt;åŸºäºåŠ¨ä½œçš„&lt;/em&gt; API è¿˜éœ€è¦ä½ å­¦ä¹ å¯èƒ½æ˜¯ 1,000 ä¸ªåŠ¨ä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯æ‰©å±•æ€§&lt;/strong&gt;ã€‚Kubernetes æ”¯æŒè‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼ˆCRDï¼‰ã€‚å› æ­¤ï¼Œé™¤äº†æ‰€æœ‰å¸¸è§çš„ podã€serviceã€ingress ç­‰ï¼Œä½ è¿˜å¯ä»¥å®šä¹‰è‡ªå·±çš„èµ„æºã€‚è¿™æ˜¯å¯èƒ½çš„ï¼Œå› ä¸º API è¡¨é¢ä¸éœ€è¦æ‰©å±•æ¥å¤„ç†æ–°çš„èµ„æºç±»å‹ã€‚ä½ åªéœ€è¦å†™ä¸€äº›æè¿°èµ„æºçš„ YAMLï¼Œç„¶åè°ƒç”¨åŒæ ·çš„åå‡ ä¸ªåŠ¨ä½œï¼Œä¾‹å¦‚ï¼šåˆ›å»ºã€åº”ç”¨ã€è·å–ã€æè¿°ã€åˆ é™¤ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å¸ƒå¼ç³»ç»Ÿ&lt;/strong&gt;ã€‚åœ¨ä½¿ç”¨å•†ç”¨ç¡¬ä»¶æ„å»ºçš„äº‘ä¸Šè¿è¡Œå¤§è§„æ¨¡ç³»ç»Ÿï¼Œè¦æ±‚åœ¨é¢å¯¹æ•…éšœæ—¶å…·æœ‰éš¾ä»¥ç½®ä¿¡çš„å¼¹æ€§ã€‚Kubernetes åŸºäºæ„å›¾çš„æ¶æ„è®©å®ƒçŸ¥é“è‡ªå·±åº”è¯¥åšä»€ä¹ˆï¼Œæ‰€ä»¥å½“æ¯”å¦‚è¯´å‘ç”Ÿç¡¬ä»¶æ•…éšœæ—¶ï¼Œå®ƒå¯ä»¥å°è¯•è¿›è¡Œè¡¥å¿ã€‚Brian Grantï¼ˆGoogle Kubernetes çš„è”åˆæŠ€æœ¯è´Ÿè´£äººï¼‰æ›¾å°± &lt;a href=&#34;https://docs.google.com/document/d/1cLPGweVEYrVqQvBLJg6sxV-TrE5Rm2MNOBA_cxZP2WU/edit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å£°æ˜å¼åº”ç”¨ç®¡ç†&lt;/a&gt; å’Œ &lt;a href=&#34;https://docs.google.com/document/d/1RmHXdLhNbyOWPW_AtnnowaRfGejw-qlKQIuLKQWlwzs/edit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes èµ„æºç®¡ç†&lt;/a&gt; å†™è¿‡å¤§é‡æ–‡ç« ï¼Œå¹¶æŒ‡å‡º Kubernetes API æ˜¯è§£å†³è®¸å¤šåˆ†å¸ƒå¼ç³»ç»Ÿé—®é¢˜çš„å…³é”®ï¼šæ•…éšœã€åˆ†å¸ƒã€è‡ªåŠ¨ä¼¸ç¼©ã€å¤šæ‰€æœ‰è€…ã€å¯ç”¨æ€§ã€æ€§èƒ½ã€å¯é€†æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆ-rbac-ä¸è¶³ä»¥ä¿è¯-kubernetes-çš„-api-å®‰å…¨&#34;&gt;ä¸ºä»€ä¹ˆ RBAC ä¸è¶³ä»¥ä¿è¯ Kubernetes çš„ API å®‰å…¨ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;åŸºäº Kubernetes æ„å›¾çš„ API çš„æŒ‘æˆ˜æ¥è‡ªäºä½ æƒ³è¦ä¿æŠ¤å’Œä¿éšœ API çš„å®‰å…¨æ—¶ â€”â€” å½“ä½ æƒ³è¦æ§åˆ¶å“ªäº›äººå¯ä»¥ä½¿ç”¨è¯¥ API åšä»€ä¹ˆæ—¶ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ˜¯ Kubernetes ç®¡ç†å‘˜ï¼Œè´Ÿè´£é›†ç¾¤çš„è¿ç»´ã€å®‰å…¨å’Œåˆè§„æ€§ã€‚æ–°æ‰‹ Kubernetes å¼€å‘äººå‘˜éœ€è¦æŠ¤æ ï¼›å®‰å…¨å›¢é˜Ÿéœ€è¦æ§åˆ¶å’Œå¯è§æ€§ï¼›åˆè§„å›¢é˜Ÿéœ€è¦å¸®åŠ©å°†å¤è€çš„è§„å®šæ˜ å°„åˆ°è¿™ä¸ªå…¨æ–°çš„ç³»ç»Ÿï¼›ä½ ä»è‡ªå·±çš„ç»éªŒä¸­çŸ¥é“ä½ éœ€è¦é‡‡ç”¨å“ªäº› Kubernetes æœ€ä½³å®è·µã€‚&lt;/p&gt;
&lt;p&gt;ç†æƒ³æƒ…å†µä¸‹ï¼Œä½ ä¼šåœ¨ Kubernetes æœ¬èº«å†…éƒ¨é€šè¿‡è®¾ç½®è®¿é—®æ§åˆ¶æ¥æ‰§è¡Œè¿™äº›è§„åˆ™ã€æ³•è§„å’Œæœ€ä½³å®è·µã€‚åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰æ˜¯å‡ åå¹´æ¥çš„è§£å†³æ–¹æ¡ˆï¼Œä½¿ä½ èƒ½å¤Ÿæ§åˆ¶å“ªäº›ç”¨æˆ·å¯ä»¥åœ¨å“ªäº›èµ„æºä¸Šè¿è¡Œå“ªäº› APIã€‚Kubernetes RBACï¼ˆè‡ª &lt;a href=&#34;https://kubernetes.io/blog/2017/10/using-rbac-generally-available-18/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2017 å¹´æœ«&lt;/a&gt; å¼€å§‹æä¾›ï¼‰æ˜¯ä½ çš„ç¬¬ä¸€é“é˜²çº¿ã€‚å®ƒå¯ä»¥è®©ä½ ä¸ºç‰¹å®šçš„ç”¨æˆ·ç»„æä¾›å¯¹èµ„æºçš„åªè¯»è®¿é—®ã€‚å®ƒè®©ä½ é€šè¿‡ç»™ä¸åŒçš„ç”¨æˆ·ç»„åˆ†é… Kubernetes çš„ä¸åŒéƒ¨åˆ†ï¼ˆä¹Ÿå°±æ˜¯ &lt;em&gt;namespace&lt;/em&gt;ï¼‰æ¥éš”ç¦»ä¸åŒçš„ç”¨æˆ·ç»„ï¼ˆè™½ç„¶ä¸æ˜¯å®Œå…¨éš”ç¦»ï¼‰ã€‚å®ƒå¯ä»¥è®©ä½ é™åˆ¶ service account
çš„æƒé™ã€‚æ‰€æœ‰è¿™äº›éƒ½æ˜¯æœ‰ä»·å€¼çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä½†ä¸åŸºäºåŠ¨ä½œçš„ç³»ç»Ÿç›¸æ¯”ï¼ŒRBAC å¤„ç†äº†ç»å¤§éƒ¨åˆ†çš„è®¿é—®æ§åˆ¶éœ€æ±‚ï¼ŒKubernetes ä¸­çš„ RBAC ç”±äºå…¶åŸºäºæ„å›¾çš„ APIï¼Œæä¾›çš„æ§åˆ¶ &lt;em&gt;è¦å°‘å¾—å¤š&lt;/em&gt;ã€‚ä» API çš„è§’åº¦æ¥çœ‹ï¼Œåªæœ‰åå‡ ä¸ªåŠ¨ä½œï¼Œè¿™æ„å‘³ç€å¦‚æœ alice å¯ä»¥æ›´æ–°ä¸€ä¸ªèµ„æºï¼Œå¥¹å°±å¯ä»¥æ›´æ–°è¿™ä¸ªèµ„æºçš„ä»»ä½•éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼ŒSRE éœ€è¦è¯»å–é›†ç¾¤ä¸­çš„å¤§éƒ¨åˆ†èµ„æºï¼Œä»¥ä¾¿åœ¨å‡ºç°é—®é¢˜æ—¶èƒ½å¤Ÿè¯Šæ–­å‡ºé—®é¢˜ã€‚ä½†å½“ SRE å‘ç°æŸä¸ªèŠ‚ç‚¹ä¸Šå‡ºç°é—®é¢˜æ—¶ï¼Œä¾‹å¦‚é‚»å±…æœ‰å™ªéŸ³ï¼Œå¥¹å¯èƒ½éœ€è¦å¯¹è¯¥èŠ‚ç‚¹è¿›è¡Œæ’ç©ºï¼ˆdrainï¼‰ï¼Œä»¥ä¾¿å°†å·¥ä½œè´Ÿè½½è½¬ç§»åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œç¼“è§£é—®é¢˜ã€‚ä¸å¹¸çš„æ˜¯ï¼ŒAPI æ²¡æœ‰ drain åŠ¨ä½œ â€”â€” é‚£äº›æ˜¯ CLI æä¾›çš„å®ï¼Œåªæ˜¯æ›´æ–°èŠ‚ç‚¹ä¸Šçš„æ³¨é‡Šã€‚ä½¿ç”¨ RBAC è¯•å›¾è¾¾åˆ°è¿™ä¸ªçº§åˆ«çš„ç²’åº¦æ˜¯ç¹çè€Œå¤æ‚çš„ï¼Œä»¥è‡³äºä¸åˆ‡å®é™…ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢çš„åŸºäºæ„å›¾çš„ K8s RBAC å›¾ä»æ¦‚å¿µä¸Šæ˜¾ç¤ºäº†ä½ å¿…é¡»ä½¿ç”¨ RBAC çš„å·¥ä½œå†…å®¹ â€”â€” ä½ å¯ä»¥é€‰æ‹©å“ªäº›ç”¨æˆ· / æ“ä½œ / èµ„æºç»„åˆæ˜¯å…è®¸çš„ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/why-rbac-is-not-enough-for-kubernetes-api-security/0081Kckwly1glr08337z4j30b908s75g_hu17636965456372440573.webp 400w,
               /blog/why-rbac-is-not-enough-for-kubernetes-api-security/0081Kckwly1glr08337z4j30b908s75g_hu13826012102215218576.webp 760w,
               /blog/why-rbac-is-not-enough-for-kubernetes-api-security/0081Kckwly1glr08337z4j30b908s75g_hu9249601880525831879.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/why-rbac-is-not-enough-for-kubernetes-api-security/0081Kckwly1glr08337z4j30b908s75g_hu17636965456372440573.webp&#34;
               width=&#34;405&#34;
               height=&#34;316&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç›¸åï¼Œæƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœ Kubernetes æ˜¯åŸºäºåŠ¨ä½œçš„ï¼ˆä¾‹å¦‚ï¼Œå®ƒåŒ…æ‹¬ cordonã€drainã€setImageã€mountVolumeã€openPort ç­‰ APIï¼‰ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ RBAC æ¥æˆäºˆè¯»ä»¥åŠ cordon å’Œ drainï¼Œä½†æ²¡æœ‰å…¶ä»–çš„åŠŸèƒ½ã€‚åŸºäºåŠ¨ä½œçš„ API åªæ˜¯æœ‰æ›´å¤šçš„åå­—ï¼Œä½ å¯ä»¥åœ¨ç¼–å†™ RBAC ç­–ç•¥æ—¶ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/why-rbac-is-not-enough-for-kubernetes-api-security/0081Kckwly1glr0978kbej30bc0d5wgf_hu4984167636949259744.webp 400w,
               /blog/why-rbac-is-not-enough-for-kubernetes-api-security/0081Kckwly1glr0978kbej30bc0d5wgf_hu17174394118376911739.webp 760w,
               /blog/why-rbac-is-not-enough-for-kubernetes-api-security/0081Kckwly1glr0978kbej30bc0d5wgf_hu7559872517331098407.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/why-rbac-is-not-enough-for-kubernetes-api-security/0081Kckwly1glr0978kbej30bc0d5wgf_hu4984167636949259744.webp&#34;
               width=&#34;408&#34;
               height=&#34;473&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç®€è€Œè¨€ä¹‹ï¼ŒKubernetes API æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„ã€å¯æ‰©å±•çš„ã€ç»Ÿä¸€çš„èµ„æºæ¨¡å‹ï¼Œä½†ä¹Ÿæ­£æ˜¯è¿™ä¸ªèµ„æºæ¨¡å‹ä½¿å¾— RBAC å¯¹äºå¾ˆå¤šç”¨ä¾‹æ¥è¯´è¿‡äºç²—ç²’åº¦ã€‚RBAC æ‰€èƒ½æä¾›çš„æ§åˆ¶æ˜¯éå¸¸å®è´µçš„ï¼Œä½†æ¯”èµ·å…¶ä»–ç³»ç»Ÿï¼ŒRBAC è¿˜è¿œä¸èƒ½æ»¡è¶³ Kubernetes çš„éœ€è¦ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æˆ‘ä»¬éœ€è¦ä»€ä¹ˆæ¥ä¿è¯-k8s-çš„-api-å®‰å…¨&#34;&gt;æˆ‘ä»¬éœ€è¦ä»€ä¹ˆæ¥ä¿è¯ K8s çš„ API å®‰å…¨ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;é‚£ä¹ˆå¦‚æœ RBAC ä¸èƒ½æä¾›è¶³å¤Ÿçš„æ§åˆ¶ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚&amp;ldquo;æ‰€æœ‰çš„ pod å¿…é¡»åªä½¿ç”¨æ¥è‡ªå—ä¿¡ä»»çš„å­˜å‚¨åº“çš„é•œåƒ&amp;rdquo;ï¼ˆæ¯”å¦‚è¯´ï¼Œhooli.comï¼‰ä»»ä½•æ—¶å€™æœ‰äººè¿è¡Œï¼Œæ¯”å¦‚è¯´ï¼Œkubectl applyï¼Œè®¿é—®æ§åˆ¶ç³»ç»Ÿéœ€è¦æ ¹æ®ç”¨æˆ·ã€åŠ¨ä½œ apply å’Œæè¿° pod çš„ YAML åšå‡ºå†³å®šã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx-1493591563-bvl8q&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;production&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;securityContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;privileged&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;hooli.com/frontend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;frontend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;securityContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;privileged&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;dnsPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterFirst&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;restartPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Always&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸ºäº†åšå‡ºæ­£ç¡®çš„å†³ç­–ï¼Œè®¿é—®æ§åˆ¶ç³»ç»Ÿéœ€è¦æå–é•œåƒåç§°åˆ—è¡¨ï¼ˆå¦‚&lt;code&gt;nginx&lt;/code&gt;å’Œ&lt;code&gt;hooli.com/frontend&lt;/code&gt;ï¼‰ï¼Œå¹¶è¿›è¡Œå­—ç¬¦ä¸²æ“ä½œä»¥æå–ä»“åº“çš„åç§°ï¼ˆå¦‚é»˜è®¤çš„ repo å’Œ hooli.comï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ç§æ–¹æ¡ˆæ˜¯å°†ä¸€å †å…³äº Kubernetes èµ„æºçš„çŸ¥è¯†æ„å»ºåˆ°è®¿é—®æ§åˆ¶ç³»ç»Ÿæœ¬èº«ã€‚ç„¶åç®¡ç†å‘˜å¯ä»¥å†™ä¸€ä¸ªç­–ç•¥ï¼Œæ¯”å¦‚è°å¯ä»¥ &lt;code&gt;update-labels&lt;/code&gt;ï¼Œ&lt;code&gt;permitted-image-registries&lt;/code&gt; æ˜¯ä»€ä¹ˆï¼Œç­‰ç­‰ã€‚è¿™å°±æ˜¯å¤§å¤šæ•°ç³»ç»Ÿçš„åšæ³• â€”â€” å‘æ˜ä¸€å †æƒé™ï¼Œç„¶ååœ¨ä¸Šé¢å»ºç«‹ä¸€ä¸ªè‡ªå®šä¹‰çš„è®¿é—®æ§åˆ¶ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æ„å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„è®¿é—®æ§åˆ¶ç³»ç»Ÿå¯¹äº Kubernetes æ¥è¯´æ˜¯è¡Œä¸é€šçš„ï¼Œå› ä¸ºå®ƒå…è®¸ç”¨æˆ·å’Œå‚å•†å‘æ˜è‡ªå·±çš„ YAML æ ¼å¼ï¼ˆè‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼‰ï¼Œå¹¶å®‰è£…å®ç°è¿™äº›æ ¼å¼çš„ä»£ç ã€‚æ‰€ä»¥ Kubernetes çš„èµ„æºå¯æ‰©å±•æ€§è¦æ±‚ä»»ä½•å®šåˆ¶çš„ Kubernetes è®¿é—®æ§åˆ¶ç³»ç»Ÿæœ¬èº«éƒ½æ˜¯å¯æ‰©å±•çš„ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œä¸ç®¡æˆ‘ä»¬åšä»€ä¹ˆï¼Œæˆ‘ä»¬éƒ½éœ€è¦ä¸€ä¸ªè®¿é—®æ§åˆ¶ç³»ç»Ÿï¼Œè®©ç®¡ç†å‘˜ç¼–å†™ç­–ç•¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ YAML æ–‡ä»¶çš„å±‚æ¬¡ç»“æ„è¿›è¡Œé€’å‡ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹æ•°ç»„ä¸­çš„å…ƒç´ è¿›è¡Œè¿­ä»£ã€‚&lt;/li&gt;
&lt;li&gt;æ“ä½œå­—ç¬¦ä¸²ã€IPã€æ•°å­—ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ ‡å‡†çš„è®¿é—®æ§åˆ¶èŒƒå¼éƒ½ä¸èƒ½æ»¡è¶³è¿™äº›è¦æ±‚ã€‚è¿™åŒ…æ‹¬åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰ã€åŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ï¼ˆABACï¼‰ã€è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆACLï¼‰ï¼Œç”šè‡³æ˜¯ IAM é£æ ¼çš„ç­–ç•¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨å‡†è®¸æ§åˆ¶æ¥åº”æ€¥&#34;&gt;ä½¿ç”¨å‡†è®¸æ§åˆ¶æ¥åº”æ€¥&lt;/h3&gt;
&lt;p&gt;å¹¸è¿çš„æ˜¯ï¼ŒKubernetes å›¢é˜Ÿé¢„è§åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ª &lt;a href=&#34;https://medium.com/r/?url=https%3A%2F%2Fkubernetes.io%2Fdocs%2Freference%2Faccess-authn-authz%2Fadmission-controllers%2F&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Admission Control&lt;/a&gt; æœºåˆ¶ï¼Œåœ¨è¿™é‡Œä½ å¯ä»¥æŠŠæ§åˆ¶çš„èŒƒå›´è¿œè¿œè¶…è¿‡ RBAC å’Œæ ‡å‡†çš„è®¿é—®æ§åˆ¶æœºåˆ¶ã€‚Kubernetes API æœåŠ¡å™¨æä¾›äº†ä¸€æ¡è®¿é—®æ§åˆ¶çš„ç®¡é“ï¼Œåˆ†ä¸º Authorizationï¼ˆå¦‚ RBACï¼‰ï¼Œå’Œ Admissionã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/why-rbac-is-not-enough-for-kubernetes-api-security/0081Kckwly1glr2h345xpj30rg06rq42_hu11507309307311218235.webp 400w,
               /blog/why-rbac-is-not-enough-for-kubernetes-api-security/0081Kckwly1glr2h345xpj30rg06rq42_hu15592891245449615254.webp 760w,
               /blog/why-rbac-is-not-enough-for-kubernetes-api-security/0081Kckwly1glr2h345xpj30rg06rq42_hu16680062373890401136.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/why-rbac-is-not-enough-for-kubernetes-api-security/0081Kckwly1glr2h345xpj30rg06rq42_hu11507309307311218235.webp&#34;
               width=&#34;760&#34;
               height=&#34;187&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆæƒï¼ˆAuthorizationï¼‰å‘ç”Ÿåœ¨æ¯æ¬¡ API è°ƒç”¨ä¸Šï¼Œè€Œå‡†è®¸ï¼ˆAddmissionï¼‰åªå‘ç”Ÿåœ¨æ›´æ–°ï¼ˆåˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤ï¼‰ä¸Šã€‚é€šè¿‡æˆæƒï¼Œä½ å°†è·å¾—ä»¥ä¸‹ä¿¡æ¯ä»¥åšå‡ºå†³å®šï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç”¨æˆ·&lt;/strong&gt;ï¼šç”¨æˆ·ã€ç»„ã€è®¤è¯æä¾›çš„é¢å¤–å±æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨ä½œ&lt;/strong&gt;ï¼šè·¯å¾„ã€API åŠ¨è¯ã€HTTP åŠ¨è¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èµ„æº&lt;/strong&gt;ï¼šèµ„æºã€å­èµ„æºã€å‘½åç©ºé—´ã€API ç»„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡ Admissionï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ª YAML ä¸­çš„ AdmissionReview å¯¹è±¡ã€‚å®ƒåŒ…æ‹¬æ‰€æœ‰å…³äºèµ„æºè¢«ä¿®æ”¹çš„ä¿¡æ¯ï¼Œä»¥åšå‡ºä»»ä½•ä½ æƒ³è¦çš„å†³å®šï¼ˆè§ä¸‹é¢çš„ &lt;code&gt;request.object&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;admission.k8s.io/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;AdmissionReview&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;frontend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;creationTimestamp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2018-10-27T02:12:20Z&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;frontend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;uid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bbfee96d-d98d-11e8-b280-080027868e77&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Always&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;terminationMessagePath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/dev/termination-log&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;terminationMessagePolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;File&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumeMounts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/var/run/secrets/kubernetes.io/serviceaccount&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default-token-tm9v8&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;readOnly&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;dnsPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterFirst&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;restartPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Always&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;schedulerName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default-scheduler&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;securityContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceAccount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceAccountName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;terminationGracePeriodSeconds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tolerations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;effect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NoExecute&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;node.kubernetes.io/not-ready&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;operator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Exists&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tolerationSeconds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;300&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;effect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NoExecute&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;node.kubernetes.io/unreachable&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;operator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Exists&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tolerationSeconds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;300&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default-token-tm9v8&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secretName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default-token-tm9v8&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;phase&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Pending&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;qosClass&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;BestEffort&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;oldObject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;operation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;pods&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;uid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;bbfeef88-d98d-11e8-b280-080027868e77&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;userInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;groups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;system:masters&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;system:authenticated&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;minikube-user &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“ç„¶ï¼Œä½ å¯ä»¥é€šè¿‡ç¼–å†™ã€éƒ¨ç½²å’Œç»´æŠ¤å®ç°å‡†å…¥æ§åˆ¶ webhook åè®®ï¼ˆä¸€ä¸ªç®€å•çš„ HTTP/json APIï¼‰çš„è‡ªå®šä¹‰ä»£ç ï¼Œç¼–å†™ä»»ä½•ä½ å–œæ¬¢çš„é€»è¾‘æ¥ä¿æŠ¤ä½ çš„ APIã€‚ç°åœ¨ï¼Œå¦‚æœä½ ä¸æƒ³æ”¯æŒå’Œç»´æŠ¤è‡ªå®šä¹‰ä»£ç ï¼Œä½ å¯ä»¥ä½¿ç”¨ &lt;a href=&#34;https://medium.com/r/?url=https%3A%2F%2Fwww.openpolicyagent.org&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Open Policy Agent&lt;/a&gt; ä½œä¸º Kubernetes &lt;a href=&#34;https://www.openpolicyagent.org/docs/latest/kubernetes-tutorial/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‡†å…¥æ§åˆ¶å™¨&lt;/a&gt;ï¼Œå¹¶åˆ©ç”¨å…¶å£°æ˜å¼ç­–ç•¥è¯­è¨€ã€‚è¯¥è¯­è¨€åŒ…æ‹¬ä¸Šè¿°æ‰€éœ€çš„è¡¨è¾¾èƒ½åŠ›ï¼šè¿­ä»£ã€ç‚¹æ³¨å’Œ 50 å¤šä¸ªå†…ç½®çš„å¯ç”¨äºå­—ç¬¦ä¸²æ“çºµç­‰ã€‚æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ &lt;a href=&#34;https://blog.openpolicyagent.org/securing-the-kubernetes-api-with-open-policy-agent-ce93af0552c3&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&amp;rdquo; åˆ©ç”¨ Open Policy Agent ç¡®ä¿ Kubernetes API å®‰å…¨ &amp;quot; ä¸€æ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ·±å…¥ç ”ç©¶äº† Kubernetes æ‰€é¢ä¸´çš„ API å®‰å…¨æŒ‘æˆ˜ï¼Œå¹¶é‡ç‚¹ä»‹ç»äº†ä»¥ä¸‹å‡ ä¸ªå…³é”®è¦ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Kubernetes åŸºäºæ„å›¾çš„ API è®©ç”¨æˆ·ä¸“æ³¨äºä»–ä»¬å¸Œæœ› Kubernetes å¤„äºä»€ä¹ˆçŠ¶æ€ï¼Œè€Œä¸æ˜¯å¦‚ä½•å®ç°å®ƒã€‚&lt;/li&gt;
&lt;li&gt;åŸºäºæ„å›¾çš„æ–¹æ³•çš„æ ¸å¿ƒå¥½å¤„ä¹‹ä¸€æ˜¯ï¼Œå®ƒä½¿ Kubernetes åœ¨é¢å¯¹æ•…éšœæ—¶å…·æœ‰å¼¹æ€§ã€‚å› ä¸ºç³»ç»ŸçŸ¥é“è‡ªå·±åº”è¯¥åšä»€ä¹ˆï¼Œæ‰€ä»¥å½“æ•…éšœå‘ç”Ÿæ—¶ï¼ŒKubernetes çŸ¥é“å¦‚ä½•æ¢å¤ã€‚&lt;/li&gt;
&lt;li&gt;Kubernetes çš„ API è¿˜æä¾›äº†å·¨å¤§çš„å¯æ‰©å±•æ€§ã€‚ç”¨æˆ·å¯ä»¥åˆ›å»ºè‡ªå·±çš„è‡ªå®šä¹‰èµ„æºï¼Œè€Œæ— éœ€æ‰©å±• APIã€‚&lt;/li&gt;
&lt;li&gt;Kubernetes çš„ API æ‰€é¢ä¸´çš„æŒ‘æˆ˜æ˜¯ï¼Œä¸€ä¸ªè®¿é—®æ§åˆ¶å†³ç­–å¯èƒ½éœ€è¦åˆ†æä¸€ä¸ªä»»æ„çš„ YAML æ–‡æ¡£ï¼Œä¾‹å¦‚ä½¿ç”¨ç‚¹ç¬¦å·ã€è¿­ä»£å’Œå­—ç¬¦ä¸²æ“çºµã€‚æ ‡å‡†çš„è®¿é—®æ§åˆ¶ç³»ç»Ÿï¼Œå¦‚ RBACã€ABACã€ACLs å’Œ IAMï¼Œæ ¹æœ¬æ²¡æœ‰è¶³å¤Ÿçš„è¡¨è¾¾èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;Kubernetes å›¢é˜Ÿå¼•å…¥äº†å‡†å…¥æ§åˆ¶ï¼ˆAdmission Controlï¼‰ï¼Œä»¥èµ‹äºˆç”¨æˆ·æ§åˆ¶ API çš„é¢å¤–æƒåŠ›ã€‚ä½ å¯ä»¥ä½¿ç”¨å£°æ˜å¼æˆæƒè§£å†³æ–¹æ¡ˆï¼ˆå¦‚ Open Policy Agentï¼‰ä½œä¸º Kubernetes Admission Controllerï¼Œä¸ºä½ æä¾›æ‰€éœ€çš„è¡¨è¾¾èƒ½åŠ›ï¼Œä»¥å…‹æœè¿™äº›æ–°çš„è®¿é—®æŒ‘æˆ˜ï¼Œå¹¶æä¾›çœŸæ­£æœ‰æ•ˆçš„ç²’åº¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>äºšé©¬é€Š EKS å‘è¡Œç‰ˆï¼ˆEKS-Dï¼‰ä»‹ç»</title>
      <link>https://cloudnativecn.com/blog/introducing-amazon-eks-distro/</link>
      <pubDate>Tue, 01 Dec 2020 10:03:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/introducing-amazon-eks-distro/</guid>
      <description>&lt;p&gt;ä»Šå¤©ï¼Œæˆ‘ä»¬å‘å¸ƒäº† &lt;a href=&#34;https://distro.eks.amazonaws.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Amazon EKS Distro&lt;/a&gt;ï¼ˆEKS-Dï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäº &lt;a href=&#34;https://amazonaws-china.com/eks/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Amazon Elastic Kubernetes Service&lt;/a&gt;ï¼ˆAmazon EKSï¼‰çš„ Kubernetes å‘è¡Œç‰ˆï¼Œå¹¶ç”± Amazon EKS ç”¨äºåˆ›å»ºå¯é å’Œå®‰å…¨çš„ Kubernetes é›†ç¾¤ã€‚é€šè¿‡ EKS-Dï¼Œä½ å¯ä»¥ä¾èµ– EKS éƒ¨ç½²çš„ç›¸åŒç‰ˆæœ¬çš„ Kubernetes åŠå…¶ä¾èµ–é¡¹ã€‚è¿™åŒ…æ‹¬æœ€æ–°çš„ä¸Šæ¸¸æ›´æ–°ä»¥åŠæ‰©å±•çš„å®‰å…¨è¡¥ä¸æ”¯æŒã€‚EKS-D éµå¾ªä¸äºšé©¬é€Š EKS ç›¸åŒçš„ Kubernetes ç‰ˆæœ¬å‘å¸ƒå‘¨æœŸï¼Œæˆ‘ä»¬ä»¥ &lt;a href=&#34;https://github.com/aws/eks-distro&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GitHub ä¸Šçš„å¼€æºé¡¹ç›®çš„æ–¹å¼&lt;/a&gt; æä¾›ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç» EKS Distroï¼Œå¹¶ä½¿ç”¨åˆä½œä¼™ä¼´ç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¾‹å­æ¥è§£é‡Šå¼€å§‹ä½¿ç”¨ EKS Distro çš„ä¸åŒæ–¹æ³•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯-eks-d&#34;&gt;ä»€ä¹ˆæ˜¯ EKS-Dï¼Ÿ&lt;/h2&gt;
&lt;p&gt;é€šè¿‡ EKS Distroï¼Œä½ ç°åœ¨å¯ä»¥åœ¨é€šè¿‡ EKS æä¾›çš„ç›¸åŒ Kubernetes å‘è¡Œç‰ˆä¸Šå®ç°æ ‡å‡†åŒ–ã€‚è¿™æ„å‘³ç€ä½ ç°åœ¨å¯ä»¥æ‰‹åŠ¨éƒ¨ç½²å¯é å’Œå®‰å…¨çš„é›†ç¾¤ï¼Œè€Œæ— éœ€æŒç»­æµ‹è¯•å’Œè·Ÿè¸ª Kubernetes æ›´æ–°ã€ä¾èµ–æ€§å’Œå®‰å…¨è¡¥ä¸ã€‚æ¯ä¸ª EKS Distro ç‰ˆæœ¬éƒ½éµå¾ª &lt;a href=&#34;https://docs.aws.amazon.com/eks/latest/userguide/kubernetes-versions.html#kubernetes-release-calendar&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;EKS&lt;/a&gt; éªŒè¯æ–° Kubernetes ç‰ˆæœ¬å…¼å®¹æ€§çš„ &lt;a href=&#34;https://docs.aws.amazon.com/eks/latest/userguide/kubernetes-versions.html#kubernetes-release-calendar&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æµç¨‹&lt;/a&gt;ã€‚ä½ è¿˜å¯ä»¥é€‰æ‹©ä½¿ç”¨æä¾›çš„æ„å»ºç¯å¢ƒè®¾ç½®ã€å·¥å…·å’Œæˆ‘ä»¬å‘å¸ƒçš„é•œåƒçš„å“ˆå¸Œå€¼é‡ç° EKS Distro çš„æ„å»ºï¼Œä»¥ç¡®è®¤ä½ çš„ä¸‹è½½åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚é€šè¿‡ EKS-Dï¼Œæˆ‘ä»¬ä¸ºç¤¾åŒºæ”¯æŒåˆ°æœŸåçš„ Kubernetes ç‰ˆæœ¬æä¾›äº†æ‰©å±•æ”¯æŒï¼Œæ›´æ–°äº†ä»¥å‰ç‰ˆæœ¬çš„æ„å»ºï¼Œç°åœ¨æœ‰äº†æœ€æ–°çš„å®‰å…¨è¡¥ä¸ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿‡å»ä¸¤å¹´å¤§è§„æ¨¡è¿è¥ Amazon EKS ä¹‹åï¼ˆæˆ‘ä»¬è¯´çš„æ˜¯å…¨çƒæ•°ç™¾ä¸‡ä¸ªå„ç§è§„æ¨¡çš„é›†ç¾¤ï¼‰ï¼Œæˆ‘ä»¬ç°åœ¨èƒ½å¤Ÿç¡®å®šå“ªäº›å·¥ä½œã€&lt;a href=&#34;https://kccncna19.sched.com/event/Uaav/living-with-the-pathology-of-the-cloud-how-aws-runs-lots-of-clusters-micah-hausler-amazon&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å“ªäº›ç»„ä»¶è¦è¿è¡Œä»¥åŠå¦‚ä½•è¿è¡Œ&lt;/a&gt;ã€‚æˆ‘ä»¬å·²ç»äº†è§£åˆ°ï¼Œå®¢æˆ·å¸Œæœ›åœ¨ä¼ä¸šå†…éƒ¨å’Œäº‘ç«¯è·å¾—ä¸€è‡´çš„ä½“éªŒï¼Œä»¥ä¾¿è¿›è¡Œè¿ç§»æˆ–å®ç°æ··åˆäº‘è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œå®¢æˆ·æœ‰ä¸€ä¸ªç”¨ä¾‹ï¼Œç”±äºæ•°æ®ä¸»æƒçš„åŸå› ï¼Œéƒ¨åˆ†å·¥ä½œè´Ÿè½½é©»ç•™åœ¨å†…éƒ¨çš„ Kubernetes é›†ç¾¤ä¸­ï¼Œè€Œå…¶ä»–éƒ¨åˆ†åˆ™è¿è¡Œåœ¨ EKS ä¸Šã€‚ç°åœ¨ä½ æ‰‹å¤´å°±æœ‰äº†åŸºäº EKS çš„è§£å†³æ–¹æ¡ˆå‚è€ƒç³»ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/introducing-amazon-eks-distro/0081Kckwgy1glhwzwpf3fj30rs0fst9y_hu16920178346378028945.webp 400w,
               /blog/introducing-amazon-eks-distro/0081Kckwgy1glhwzwpf3fj30rs0fst9y_hu13977768674712960677.webp 760w,
               /blog/introducing-amazon-eks-distro/0081Kckwgy1glhwzwpf3fj30rs0fst9y_hu13621210419555434779.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/introducing-amazon-eks-distro/0081Kckwgy1glhwzwpf3fj30rs0fst9y_hu16920178346378028945.webp&#34;
               width=&#34;760&#34;
               height=&#34;432&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¯¹äº EC2 ä¸Šçš„ EKSï¼Œä½ å¯ä»¥ &lt;a href=&#34;https://docs.aws.amazon.com/eks/latest/userguide/worker.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è‡ªå·±&lt;/a&gt; ç®¡ç†èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;a href=&#34;https://docs.aws.amazon.com/eks/latest/userguide/managed-node-groups.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ‰˜ç®¡èŠ‚ç‚¹ç»„&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³ä¸€è‡´æ€§çš„è¦æ±‚ï¼Œæˆ‘ä»¬æƒ³åˆ°äº† EKS Distroï¼Œæˆ‘ä»¬åŸºäº EKS çš„ Kubernetes å‘è¡Œç‰ˆï¼Œä½ å¯ä»¥åœ¨ä»»ä½•ç¯å¢ƒä¸‹è¿è¡Œï¼Œæ— è®ºæ˜¯è£¸æœºè¿˜æ˜¯è™šæ‹Ÿæœºã€‚EKS-D å°†ä¸Šæ¸¸çš„ï¼ˆæœªä¿®æ”¹çš„ï¼‰Kubernetes å’ŒåŒ…ï¼ŒæŒ‰ç…§ä¸€å®šçš„ã€ç‰¹æ„çš„æ–¹å¼è¿›è¡Œé…ç½®ï¼Œç§°ä¸º &lt;a href=&#34;https://github.com/cncf/k8s-conformance/blob/master/faq.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes å‘è¡Œç‰ˆ&lt;/a&gt;ï¼Œå¹¶å°†è¿™äº› &lt;a href=&#34;https://github.com/aws/eks-distro&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½œä¸ºå¼€æº&lt;/a&gt; æä¾›ã€‚fork å’Œ distribution ä¹‹é—´çš„åŒºåˆ«å¾ˆé‡è¦ï¼šfork æ˜¯ä¸€ä¸ªæ›¿ä»£ä¸Šæ¸¸çš„ä»£ç åº“ã€‚å¦ä¸€æ–¹é¢ï¼Œå‘è¡Œç‰ˆæ˜¯ä¸€ä¸ªç‰¹å®šçš„ä¸‹æ¸¸ä»£ç åº“ï¼Œæ¯”å¦‚ Linux å‘è¡Œç‰ˆæœ‰ Ubuntu å’Œ Amazon Linux 2ï¼Œæ¯”å¦‚ Hadoop å‘è¡Œç‰ˆï¼ŒEMR ä¸­æœ‰ç”± Cloudera æä¾›çš„å¹¶å‘è¡Œç‰ˆã€‚&lt;/p&gt;
&lt;p&gt;ä»é«˜å±‚çš„è§’åº¦æ¥çœ‹ï¼ŒEKS Distro çš„æƒ…å†µå¦‚ä¸‹ï¼ˆè€ƒè™‘åˆ°ä¸€äº›ä¸Šæ¸¸çš„å¼€æºé¡¹ç›®ï¼ŒåŒ…æ‹¬ Kubernetes å’Œ etcdï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/introducing-amazon-eks-distro/0081Kckwgy1glhwzx24n5j30sg0p1q45_hu2380088779758218248.webp 400w,
               /blog/introducing-amazon-eks-distro/0081Kckwgy1glhwzx24n5j30sg0p1q45_hu638091276136822797.webp 760w,
               /blog/introducing-amazon-eks-distro/0081Kckwgy1glhwzx24n5j30sg0p1q45_hu7298929565670948849.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/introducing-amazon-eks-distro/0081Kckwgy1glhwzx24n5j30sg0p1q45_hu2380088779758218248.webp&#34;
               width=&#34;760&#34;
               height=&#34;669&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é€šè¿‡ EKS Distroï¼Œä½ å¯ä»¥é€šè¿‡å•ä¸€ä¾›åº”å•†å®‰å…¨åœ°è®¿é—®å¯å®‰è£…ã€å¯å¤åˆ¶çš„ Kubernetes æ„å»ºï¼Œä»¥åˆ›å»ºé›†ç¾¤ï¼Œå¹¶åœ¨ç¤¾åŒºæ”¯æŒåˆ°æœŸåæä¾› Kubernetes ç‰ˆæœ¬çš„æ‰©å±•å®‰å…¨è¡¥ä¸æ”¯æŒã€‚æˆ‘ä»¬å°†æ ¹æ® Amazon EKS ç‰ˆæœ¬ç”Ÿå‘½å‘¨æœŸæ”¿ç­–æä¾›é•¿è¾¾ 14 ä¸ªæœˆçš„ Kubernetes æ‰©å±•ç»´æŠ¤æ”¯æŒï¼Œä¸ºä½ æä¾›å¿…è¦çš„æ—¶é—´çª—å£æ¥æ›´æ–°ä½ çš„åŸºç¡€è®¾æ–½ï¼Œä½¿å…¶ä¸ä½ çš„è½¯ä»¶ç”Ÿå‘½å‘¨æœŸä¿æŒä¸€è‡´ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¼€å§‹ä½¿ç”¨-eks-d&#34;&gt;å¼€å§‹ä½¿ç”¨ EKS-D&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬ä¸ä¸€äº› &lt;a href=&#34;https://amazonaws-china.com/eks/eks-distro&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åˆä½œä¼™ä¼´åˆä½œ&lt;/a&gt;ï¼Œæä¾›å®‰è£…æ–¹æ³•ä»¥åŠä¸ EKS Distro çš„é›†æˆã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å°†é‡ç‚¹ä»‹ç»å‡ å®¶åˆä½œä¼™ä¼´ï¼Œä»¥åŠä»–ä»¬ä¸ºå¸®åŠ©ä½ å¼€å§‹ä½¿ç”¨ EKS-D æ‰€åšçš„å·¥ä½œã€‚&lt;/p&gt;
&lt;h3 id=&#34;weaveworks&#34;&gt;Weaveworks&lt;/h3&gt;
&lt;p&gt;Weave Kubernetes Platformï¼ˆWKPï¼‰ä¸º Amazon EKS Distroï¼ˆEKS-Dï¼‰å¸¦æ¥äº† GitOpsï¼Œå¹¶ä¸ºå†…éƒ¨å®‰è£…ã€åˆ›å»ºå’Œç®¡ç† EKS-D é›†ç¾¤æä¾›æ”¯æŒã€‚ä¸ä»»ä½• Kubernetes å‘è¡Œç‰ˆä¸€æ ·ï¼ŒEKS-D éœ€è¦é…ç½®ã€å‡çº§ä»¥åŠé¢å¤–çš„ç»„ä»¶å’Œé™„åŠ ç»„ä»¶ï¼Œå¦‚æ—¥å¿—ã€è·Ÿè¸ªå’ŒæŒ‡æ ‡ã€‚WKP é€šè¿‡å°† GitOps æ·»åŠ åˆ°ä½ çš„ Kubernetes ç¯å¢ƒçš„æ¯ä¸€å±‚ï¼Œä¸º EKS-D æˆ–ä»»ä½•å…¶ä»–äº‘ç«¯å’Œä¼ä¸šå†…éƒ¨çš„å‘è¡Œç‰ˆè§£å†³äº†è¿™äº›é—®é¢˜ã€‚é€šè¿‡åˆ©ç”¨ Cluster API é¡¹ç›®ï¼ŒGitOps å·¥ä½œæµå¯ä»¥ç®¡ç†æ•´ä¸ªé›†ç¾¤ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬ç»´æŠ¤ã€å‡çº§å’Œè¡¥ä¸ï¼Œä»¥åŠ Prometheus å’Œ Grafana ç­‰å¹³å°ç»„ä»¶çš„é›†ç¾¤é…ç½®ã€‚é€šè¿‡ WKP äº¤ä»˜å’Œç®¡ç† EKS-D é›†ç¾¤ï¼Œåº”ç”¨å¼€å‘å›¢é˜Ÿå¯ä»¥è·å¾—æœ€æ–°çš„ GitOps åŠŸèƒ½ï¼Œä»è€Œå®ç°æ›´é¢‘ç¹çš„éƒ¨ç½²ï¼Œç¼©çŸ­ä»·å€¼å®ç°æ—¶é—´ï¼Œæé«˜å¯é æ€§å’Œå¯é‡å¤æ€§ã€‚å¹³å°å›¢é˜Ÿè¿˜å¯ä»¥è·å¾—å¯¹å†…éƒ¨éƒ¨ç½² EKS-D çš„å…¨é¢æ´å¯Ÿå’Œè§‚å¯Ÿèƒ½åŠ›ã€‚Weaveworks &lt;a href=&#34;https://weave.works/blog/on-prem-kubernetes-gitops-eks-distro&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‘å¸ƒçš„åšå®¢æ–‡ç« &lt;/a&gt; è¿›ä¸€æ­¥è¯¦ç»†æè¿°äº† EKS-D å’Œ WKP ä¹‹é—´çš„å…³ç³»ã€‚å¦å¤–ä¸€ç¯‡æ–‡ç« åˆ™æ˜¯ &lt;a href=&#34;https://weave.works/blog/multicluster-gitops-eks-d-wkp&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨ EKS-D å’Œ EKS-D æ··åˆåœºæ™¯ä¸‹çš„ WKP æ¼”ç¤º&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;kubestack&#34;&gt;Kubestack&lt;/h3&gt;
&lt;p&gt;Kubestack å°±æ˜¯è¦ä¸º Terraform å’Œ Kubernetes æä¾›æœ€ä½³çš„ GitOps å¼€å‘è€…ä½“éªŒï¼Œä»æœ¬åœ°å¼€å‘ï¼Œä¸€ç›´åˆ°ç”Ÿäº§ã€‚é€šè¿‡ä»–ä»¬ &lt;a href=&#34;https://dev.to/kubestack/localhost-eks-development-environments-with-eks-d-and-kubestack-4p6&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‘å¸ƒåšæ–‡&lt;/a&gt; äº†è§£å¦‚ä½•ä½¿ç”¨ Kubestack ç®¡ç† EKS-D é›†ç¾¤ï¼Œä½ ä¹Ÿå¯ä»¥æ‰¾åˆ°ä¸€ä¸ª &lt;a href=&#34;https://www.youtube.com/watch?v=TcVwtfFww4w&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è§†é¢‘ demo&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;kubermatic&#34;&gt;Kubermatic&lt;/h3&gt;
&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨ Kubermatic çš„ &lt;a href=&#34;https://www.kubermatic.com/products/kubeone/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;KubeOne&lt;/a&gt; å®‰è£… EKS-Dã€‚KubeOne æ˜¯ä¸€ä¸ªåŸºç¡€è®¾æ–½å¯¹ç­‰çš„å¼€æº Kubernetes é›†ç¾¤ç”Ÿå‘½å‘¨æœŸç®¡ç†å·¥å…·ï¼Œå¯ä»¥è‡ªåŠ¨éƒ¨ç½²å’Œ Day 2 æ“ä½œå•ä¸ª Kubernetes é›†ç¾¤ã€‚äº†è§£å¦‚ä½•ä½¿ç”¨ Kubermatic çš„å¼€æºé›†ç¾¤ç”Ÿå‘½å‘¨æœŸç®¡ç†å·¥å…· KubeOne åœ¨ AWS å’Œ Amazon Linux 2 ä¸Š &lt;a href=&#34;https://www.kubermatic.com/blog/run-amazon-eks-distro-with-kubeone&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®‰è£… EKS-D&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;aqua-security&#34;&gt;Aqua Security&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†ä¿æŠ¤ EKS-D çš„å®‰å…¨ï¼Œä½ éœ€è¦ä¸€ä¸ªæ•´ä½“çš„æ–¹æ³•æ¥å¾æœ Kubernetes çš„å¤æ‚æ€§ã€‚Aqua æä¾› KSPMï¼ˆKubernetes å®‰å…¨æ€åŠ¿ç®¡ç†ï¼‰æ¥æé«˜å¯è§‚å¯Ÿæ€§å’Œè¡¥æ•‘é”™è¯¯é…ç½®ï¼Œä»¥åŠå…ˆè¿›çš„ã€æ— ä»£ç†çš„ Kubernetes è¿è¡Œæ—¶ä¿æŠ¤ã€‚ä½ è¿˜å¯ä»¥ä½¿ç”¨ Kubernetes åŸç”ŸåŠŸèƒ½ï¼Œä¸ºä½ çš„ Kubernetes åº”ç”¨å®ç°ç­–ç•¥é©±åŠ¨çš„å…¨ç”Ÿå‘½å‘¨æœŸä¿æŠ¤å’Œåˆè§„æ€§ã€‚äº†è§£æ›´å¤šå…³äº &lt;a href=&#34;https://blog.aquasec.com/aws-security-eks-distro&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Aqua çš„ EKS-D é›†æˆçš„ä¿¡æ¯&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;sysdig&#34;&gt;Sysdig&lt;/h3&gt;
&lt;p&gt;Sysdig æä¾›å®‰å…¨å’Œå¯è§†æ€§ï¼Œä»¥æ£€æµ‹å’Œå“åº”è¿è¡Œæ—¶å¨èƒï¼ŒéªŒè¯åˆè§„æ€§ï¼Œå¹¶ç›‘æ§å’Œæ’é™¤ EKS-D ä¸Šçš„å®¹å™¨ã€‚æŸ¥çœ‹ä»–ä»¬çš„ &lt;a href=&#34;https://sysdig.com/blog/security-compliance-visibility-amazon-eks-d&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‘å¸ƒåšå®¢æ–‡ç« &lt;/a&gt;ï¼Œäº†è§£æ›´å¤šå…³äºä½¿ç”¨ CNCF Falco å’Œ Sysdig Secure ç®¡ç† EKS-D å·¥ä½œè´Ÿè½½ä¸­çš„è¿è¡Œæ—¶å®‰å…¨çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;tetrate&#34;&gt;Tetrate&lt;/h3&gt;
&lt;p&gt;Tetrate Service Bridgeï¼ˆTSBï¼‰&lt;a href=&#34;https://www.tetrate.io/blog/tetrate-expands-aws-partnership-to-bring-enterprise-grade-istio-for-eks-and-eks-distro/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¯åœ¨ EKS å’Œ EKS-D ä¸Šå®ç°è·¨å·¥ä½œè´Ÿè½½çš„ç»Ÿä¸€åº”ç”¨è¿æ¥å’Œå®‰å…¨&lt;/a&gt;ã€‚TSB ä¸ºä¼ä¸šçº§ï¼ˆä¸Šæ¸¸æˆ–ç¬¦åˆ FIPS æ ‡å‡†ï¼‰Istio å’Œ Envoy Proxy æä¾›äº†ä¾¿æ·çš„è®¿é—®å’Œæ“ä½œæ€§ã€‚å¤šç§Ÿæˆ·ã€æµé‡ç®¡ç†ã€ç½‘çŠ¶å’Œåº”ç”¨çº§å¯è§‚å¯Ÿæ€§ã€ç«¯åˆ°ç«¯ mTLSï¼ˆç›¸äº’ä¼ è¾“å±‚å®‰å…¨ï¼‰ã€ç»†ç²’åº¦æˆæƒå’Œåº”ç”¨å®‰å…¨æ˜¯ TSB çš„å…³é”®è¦ç´ ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ç³»åˆ—åˆä½œä¼™ä¼´ä¸€ç›´åœ¨å¼€å±•æ›´å¤šä¸ EKS-D æœ‰å…³çš„æ´»åŠ¨ï¼ŒåŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;h3 id=&#34;ä¾›åº”å’Œç®¡ç†&#34;&gt;ä¾›åº”å’Œç®¡ç†&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;äº†è§£å¦‚ä½• &lt;a href=&#34;https://rancher.com/blog/2020/RKE2-supports-amazon-EKS-distro&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ Rancher çš„ RKE2 éƒ¨ç½² EKS-D&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://snapcraft.io/eks&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;çœ‹çœ‹ä½¿ç”¨ Canonical çš„ MicroK8s å®‰è£… EKS-D&lt;/a&gt; æœ‰å¤šç®€å• &lt;a href=&#34;https://snapcraft.io/eks&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ï¼Œä¸€ç›®äº†&lt;/a&gt; ç„¶&lt;/li&gt;
&lt;li&gt;æ¢ç´¢å¦‚ä½•ä½¿ç”¨ &lt;a href=&#34;https://rafay.co/the-kubernetes-current/how-to-provision-and-manage-amazons-eks-distribution-using-rafay&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Rafay çš„æ‰˜ç®¡ Kubernetes å¹³å°ï¼ˆMKPï¼‰æ¥ç®¡ç† EKS-D é›†ç¾¤&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æŸ¥çœ‹å¦‚ä½• &lt;a href=&#34;https://pulumi.com/blog/amazon-eks-distro&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä½¿ç”¨ Pulumi é…ç½® EKS-D é›†ç¾¤&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.upbound.io/eks-d-and-upbound/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Upbound Cloud ä½¿ EKS-D ç”¨æˆ·å¯ä»¥è½»æ¾åœ°å°†é›†ç¾¤çš„é…ç½®æ•´åˆ&lt;/a&gt; åˆ°ä¸€ä¸ªä¸ç¯å¢ƒæ— å…³çš„ Crossplane é…ç½®åº“ä¸­ã€‚åˆ©ç”¨è¿™äº›é…ç½®ï¼Œé›†ç¾¤å°±å¯ä»¥é€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„ API æ¥å£åœ¨ä¼ä¸šå†…éƒ¨ã€äº‘ç«¯æˆ–è¾¹ç¼˜è¿›è¡Œé…ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;è§‚å¯Ÿæ€§&#34;&gt;è§‚å¯Ÿæ€§&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ Instanaï¼Œä½ å¯ä»¥ &lt;a href=&#34;https://instana.com/blog/instana-brings-best-in-class-observability-with-the-new-amazon-kubernetes-distribution/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è‡ªåŠ¨ç›‘æ§å’Œå¯è§†åŒ–&lt;/a&gt; EKS-D çš„å·¥ä½œè´Ÿè½½&lt;/li&gt;
&lt;li&gt;Sumo Logic å±•ç¤ºäº†ä»–ä»¬å¦‚ä½• &lt;a href=&#34;https://www.sumologic.com/blog/monitor-aws-kubernetes-service/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸ EKS-D ä¸€èµ·å·¥ä½œ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Epsagon ä½¿ä½ èƒ½å¤Ÿ &lt;a href=&#34;https://epsagon.com/announcements/amazon-eks-distro/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç›‘æ§ EKS-D å·¥ä½œè´Ÿè½½&lt;/a&gt;ï¼ŒåŒ…æ‹¬æ§åˆ¶å¹³é¢æŒ‡æ ‡&lt;/li&gt;
&lt;li&gt;Datadog æä¾›äº†è·¨å†…éƒ¨ã€æ··åˆå’Œäº‘è®¡ç®—åŸºç¡€è®¾æ–½çš„è™šæ‹Ÿæœºã€å®¹å™¨å’Œæ— æœåŠ¡å™¨ç¯å¢ƒçš„å¥åº·çŠ¶å†µçš„å¯è§†æ€§ã€‚äº†è§£æœ‰å…³ &lt;a href=&#34;https://www.datadoghq.com/blog/amazon-eks-distro-monitoring/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;EKS-D æ”¯æŒ&lt;/a&gt; çš„æ›´å¤šä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;Splunk åŸºç¡€è®¾æ–½ç›‘æ§ä¸ºæ‰€æœ‰ Kubernetes ç¯å¢ƒ â€”â€” äº‘åŸç”Ÿ Amazon EKSã€ä¸ Amazon Outposts çš„æ··åˆ &lt;a href=&#34;https://www.splunk.com/en_us/blog/devops/monitor-amazon-eks-distro-eks-d-with-splunk.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¯å¢ƒ&lt;/a&gt; ä»¥åŠå†…éƒ¨ &lt;a href=&#34;https://www.splunk.com/en_us/blog/devops/monitor-amazon-eks-distro-eks-d-with-splunk.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è‡ªæˆ‘ç®¡ç†çš„ EKS-D ç¯å¢ƒ&lt;/a&gt; æä¾›äº†ä¼ä¸šçº§ç›‘æ§è§£å†³æ–¹æ¡ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å®‰å…¨&#34;&gt;å®‰å…¨&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;äº†è§£ &lt;a href=&#34;https://nirmata.com/2020/11/20/nirmata-delivers-consistent-hybrid-cloud-kubernetes-with-aws/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Nirmata çš„ EKS ç®¡ç†å™¨ä¸ EKS-D çš„é›†æˆ&lt;/a&gt;ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒæ¥åŠ å¼ºä½ çš„å®‰å…¨æ€åŠ¿&lt;/li&gt;
&lt;li&gt;Alcide ä¸ºè·¨è¶Š EKSã€Outposts å’Œ &lt;a href=&#34;https://blog.alcide.io/alcide-and-amazon-eks-distro&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–°å¢åŠ çš„ EKS-D çš„&lt;/a&gt; æ··åˆéƒ¨ç½²æä¾›é›†ä¸­ç»Ÿä¸€çš„å®‰å…¨è¦†ç›–&lt;/li&gt;
&lt;li&gt;æŸ¥çœ‹ Tigera å›´ç»• &lt;a href=&#34;https://www.tigera.io/blog/tigera-amazon-eks-distro&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Calico å’Œ Calico Enterprise æ”¯æŒæ‰€&lt;/a&gt; åšçš„å·¥ä½œ &lt;a href=&#34;https://www.tigera.io/blog/tigera-amazon-eks-distro&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ï¼Œä»¥å®ç°è¿è¡Œ EKS-D çš„é›†ç¾¤çš„å¼ºå¤§å®‰å…¨æ€§å’Œåˆè§„æ€§&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½ å¯ä»¥æƒ³è±¡ï¼Œè¿™åªæ˜¯æ—…ç¨‹çš„å¼€å§‹ã€‚ä½ å¯èƒ½ä¼šé—®ï¼Œä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;h2 id=&#34;ä¸‹ä¸€æ­¥&#34;&gt;ä¸‹ä¸€æ­¥&lt;/h2&gt;
&lt;p&gt;è¦å¼€å§‹ä½¿ç”¨ EKS Distroï¼Œè¯·è®¿é—® &lt;a href=&#34;https://distro.eks.amazonaws.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://distro.eks.amazonaws.com&lt;/a&gt;ï¼Œå¹¶ä½¿ç”¨ kops æˆ– kubeadm æˆ–ä¸Šè¿°ä»»ä½•ä¸€ä¸ªåˆä½œä¼™ä¼´æä¾›çš„è§£å†³æ–¹æ¡ˆäº²è‡ªå°è¯•ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥é€šè¿‡ GitHub æä¾›åé¦ˆå’Œ PRï¼Œæˆä¸º EKS-D ç¤¾åŒºçš„ä¸€å‘˜ã€‚å¦‚æœä½ å–œæ¬¢æ›´å¤šçš„äº’åŠ¨äº¤æµï¼Œå¯ä»¥åœ¨ Kubernetes Slack ç¤¾åŒºé€šè¿‡ #eks é¢‘é“æˆ– AWS å¼€å‘è€… Slack é¢‘é“åŠ å…¥æˆ‘ä»¬ï¼Œæˆ‘ä»¬åœ¨é‚£é‡Œè®¾ç½®äº† #eks-d é¢‘é“ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¾ˆé«˜å…´äº†è§£ä½ ä½¿ç”¨ EKS Distro çš„æƒ…å†µï¼Œå¹¶å¬å–ä½ çš„åé¦ˆå’Œå»ºè®®ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Arm64 é“¶æ²³éº’éºŸç³»ç»Ÿå…‹éš†æœºå™¨ä¸Š k8s vxlan è·¨èŠ‚ç‚¹ä¸é€šçš„ä¸€æ¬¡æ’æŸ¥</title>
      <link>https://cloudnativecn.com/blog/arm-kylin-clone-vxlan-error/</link>
      <pubDate>Mon, 09 Nov 2020 00:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/arm-kylin-clone-vxlan-error/</guid>
      <description>&lt;h2 id=&#34;ç”±æ¥&#34;&gt;ç”±æ¥&lt;/h2&gt;
&lt;p&gt;å’Œæˆ‘åšå®¢å‰ä¸€ç¯‡æ–‡ç«  &lt;a href=&#34;https://zhangguanzhang.github.io/2020/10/20/kylin-v10-k8s-overlay-error/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é“¶æ²³éº’éºŸ arm64 ç³»ç»Ÿä¸Š k8s é›†ç¾¤è·¨èŠ‚ç‚¹ä¸é€šçš„ä¸€æ¬¡æ’æŸ¥&lt;/a&gt; ä¸ä¸€æ ·ï¼Œä»æ¥æ²¡é‡åˆ°è¿‡è¿™æ ·çš„é—®é¢˜ï¼Œè¿™é‡Œè®°å½•ä¸‹ã€‚å®æ–½åœ¨å®¢æˆ·é‚£è¾¹éƒ¨ç½²ä¸šåŠ¡åï¼Œä¸šåŠ¡åœ¨æµè§ˆå™¨ä¸Šæ— æ³•è®¿é—®ï¼Œæˆ‘è¿œç¨‹ä¸Šå»æŸ¥çœ‹æ—¥å¿—å‘ç° pod å†…éƒ¨æ— æ³• DNS æ— æ³•è§£æï¼Œnginx è¿ä¸ä¸Š upsteam æŠ¥é”™è€Œå¯åŠ¨å¤±è´¥ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯è·¨èŠ‚ç‚¹ä¸é€šã€‚å®é™…æ’æŸ¥è¿‡ç¨‹ä¹Ÿæœ‰å¾€é”™è¯¯çš„æ–¹å‘æµªè´¹äº†ä¸€äº›æ—¶é—´å’Œå°è¯•ï¼Œå°±ä¸å†™è¿›æ¥äº†ï¼Œä»¥æ­£ç¡®çš„è§’åº¦å†™ä¸‹æ’æŸ¥è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¯å¢ƒä¿¡æ¯&#34;&gt;ç¯å¢ƒä¿¡æ¯&lt;/h3&gt;
&lt;p&gt;OS æ˜¯ arm64 çš„é“¶æ²³éº’éºŸç³»ç»Ÿï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cat /etc/os-release
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;NAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Kylin Linux Advanced Server&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;VERSION&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;V10 (Tercel)&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;ID&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;kylin&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;VERSION_ID&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;V10&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;PRETTY_NAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Kylin Linux Advanced Server V10 (Tercel)&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;ANSI_COLOR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0;31&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ uname -a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Linux localhost.localdomain 4.19.90-17.ky10.aarch64 &lt;span class=&#34;c1&#34;&gt;#1 SMP Sun Jun 28 14:27:40 CST 2020 aarch64 aarch64 aarch64 GNU/Linux&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é›†ç¾¤ä¿¡æ¯ï¼ˆå’Œé›†ç¾¤ç‰ˆæœ¬æ²¡å…³ç³»ï¼‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl version -o json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;clientVersion&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;major&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;1&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;minor&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;15&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;gitVersion&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;v1.15.12&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;gitCommit&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;e2a822d9f3c2fdb5c9bfbe64313cf9f657f0a725&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;gitTreeState&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;clean&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;buildDate&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;2020-05-06T05:17:59Z&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;goVersion&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;go1.12.17&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;compiler&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;gc&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;platform&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;linux/arm64&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;serverVersion&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;major&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;1&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;minor&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;15&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;gitVersion&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;v1.15.12&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;gitCommit&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;e2a822d9f3c2fdb5c9bfbe64313cf9f657f0a725&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;gitTreeState&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;clean&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;buildDate&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;2020-05-06T05:09:48Z&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;goVersion&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;go1.12.17&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;compiler&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;gc&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;platform&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;linux/arm64&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;node ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get node -o wide
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME            STATUS   ROLES         AGE   VERSION    INTERNAL-IP     EXTERNAL-IP   OS-IMAGE                                   KERNEL-VERSION            CONTAINER-RUNTIME
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.18.27.252   Ready    master,node   32h   v1.15.12   172.18.27.252   &amp;lt;none&amp;gt;        Kylin Linux Advanced Server V10 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Tercel&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;   4.19.90-17.ky10.aarch64   docker://18.9.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.18.27.253   Ready    master,node   32h   v1.15.12   172.18.27.253   &amp;lt;none&amp;gt;        Kylin Linux Advanced Server V10 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Tercel&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;   4.19.90-17.ky10.aarch64   docker://18.9.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.18.27.254   Ready    master,node   32h   v1.15.12   172.18.27.254   &amp;lt;none&amp;gt;        Kylin Linux Advanced Server V10 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Tercel&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;   4.19.90-17.ky10.aarch64   docker://18.9.0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;coredns ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n kube-system get po -o wide -l k8s-app&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;kube-dns
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                      READY   STATUS    RESTARTS   AGE     IP              NODE            NOMINATED NODE   READINESS GATES
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;coredns-677d9c57f-pqvfv   1/1     Running   &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;          21h     10.187.0.5      172.18.27.253   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;coredns-677d9c57f-zjf86   1/1     Running   &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;          4h45m   10.187.1.12     172.18.27.252   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æ’æŸ¥è¿‡ç¨‹&#34;&gt;æ’æŸ¥è¿‡ç¨‹&lt;/h3&gt;
&lt;p&gt;å‘½ä»¤éƒ½æ˜¯åœ¨ &lt;code&gt;172.18.27.252&lt;/code&gt; ä¸Šæ‰§è¡Œçš„ï¼Œç”¨ &lt;code&gt;dig @coredns_svc_ip +short kubernetes.default.svc.cluster1.local&lt;/code&gt; æµ‹å‘ç°æ—¶è€Œèƒ½è§£æï¼Œæ—¶è€Œä¸èƒ½è§£æï¼Œç„¶åå‘ç°æ˜¯è·¨èŠ‚ç‚¹çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ &lt;code&gt;172.18.27.252&lt;/code&gt; ä¸Šå»è¯·æ±‚ &lt;code&gt;172.18.27.253&lt;/code&gt; ä¸Šçš„ coredns çš„ metrics æ¥å£ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -I 10.187.0.5:9153/metrics
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶ååœ¨ &lt;code&gt;172.18.27.253&lt;/code&gt; ä¸ŠæŠ“åŒ…ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ tcpdump -nn -i flannel.1 host 10.187.0.5 and port &lt;span class=&#34;m&#34;&gt;9153&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;dropped privs to tcpdump
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcpdump: verbose output suppressed, use -v or -vv &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; full protocol decode
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;listening on flannel.1, link-type EN10MB &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Ethernet&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;, capture size &lt;span class=&#34;m&#34;&gt;262144&lt;/span&gt; bytes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;^C
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; packets captured
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; packets received by filter
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; packets dropped by kernel
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ²¡æœ‰åŒ…ï¼Œåœ¨ &lt;code&gt;172.18.27.253&lt;/code&gt; ä¸ŠæŠ“äº†ä¸‹ &lt;code&gt;8472&lt;/code&gt; ç«¯å£æ˜¯æ­£å¸¸èƒ½æ”¶åŒ…çš„ã€‚åƒä¹‹å‰çš„é‚£ä¸ªæ–‡ç«  &lt;a href=&#34;https://zhangguanzhang.github.io/2020/10/20/kylin-v10-k8s-overlay-error/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é“¶æ²³éº’éºŸ arm64 ç³»ç»Ÿä¸Š k8s é›†ç¾¤è·¨èŠ‚ç‚¹ä¸é€šçš„ä¸€æ¬¡æ’æŸ¥&lt;/a&gt; çœ‹äº†ä¸‹ï¼Œ253 æœºå™¨ä¸ŠæŸ¥çœ‹è·¯ç”±ä¹Ÿæ²¡é—®é¢˜ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip route get 10.187.1.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;10.187.1.0 via 10.187.1.0 dev flannel.1 src 10.187.0.0 uid &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    cache
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“æ—¶å„ç§æ‰‹æ®µçœ‹äº†ä¸ªéï¼Œç»“æœæœ‰ç‚¹çœ‰ç›®äº†ï¼ˆæˆ‘åº”è¯¥åƒä¸Šç¯‡æ–‡ç« ä¸€æ ·å…ˆçœ‹ä¸‹ vxlan çš„ vtep ä¿¡æ¯çš„ã€‚ã€‚ã€‚ï¼‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get node -o yaml &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep -A3 Vtep
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      flannel.alpha.coreos.com/backend-data: &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;VtepMAC&amp;#34;:&amp;#34;fe:22:77:eb:2f:a4&amp;#34;}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      flannel.alpha.coreos.com/backend-type: vxlan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      flannel.alpha.coreos.com/kube-subnet-manager: &lt;span class=&#34;s2&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      flannel.alpha.coreos.com/public-ip: 172.18.27.252
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      flannel.alpha.coreos.com/backend-data: &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;VtepMAC&amp;#34;:&amp;#34;fe:22:77:eb:2f:a4&amp;#34;}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      flannel.alpha.coreos.com/backend-type: vxlan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      flannel.alpha.coreos.com/kube-subnet-manager: &lt;span class=&#34;s2&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      flannel.alpha.coreos.com/public-ip: 172.18.27.253
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      flannel.alpha.coreos.com/backend-data: &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;VtepMAC&amp;#34;:&amp;#34;fe:22:77:eb:2f:a4&amp;#34;}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      flannel.alpha.coreos.com/backend-type: vxlan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      flannel.alpha.coreos.com/kube-subnet-manager: &lt;span class=&#34;s2&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      flannel.alpha.coreos.com/public-ip: 172.18.27.254
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;vtep çš„ mac åœ°å€éƒ½ä¸€æ ·ï¼ŒæŸ¥çœ‹ä¸‹ï¼Œå‘ç°ä¸‰å°æœºå™¨éƒ½æ˜¯ä¸€æ ·çš„ï¼Œçœ‹ä¸‹ç½‘å¡å’Œ flannel.1 çš„ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip -4 a s enp1s0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2: enp1s0: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class=&#34;m&#34;&gt;1500&lt;/span&gt; qdisc fq_codel state UP group default qlen &lt;span class=&#34;m&#34;&gt;1000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    link/ether dc:2d:cb:17:3e:a1 brd ff:ff:ff:ff:ff:ff
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    inet 172.18.27.252/25 brd 172.18.27.255 scope global noprefixroute enp1s0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       valid_lft forever preferred_lft forever
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip -d link show  flannel.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;394: flannel.1: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class=&#34;m&#34;&gt;1450&lt;/span&gt; qdisc noqueue state UNKNOWN mode DEFAULT group default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    link/ether fe:22:77:eb:2f:a4 brd ff:ff:ff:ff:ff:ff promiscuity &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; minmtu &lt;span class=&#34;m&#34;&gt;68&lt;/span&gt; maxmtu &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    vxlan id &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; 172.18.27.252 dev enp1s0 srcport &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; dstport &lt;span class=&#34;m&#34;&gt;8472&lt;/span&gt; nolearning ttl auto ageing &lt;span class=&#34;m&#34;&gt;300&lt;/span&gt; udpcsum noudp6zerocsumtx noudp6zerocsumrx addrgenmode none numtxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; numrxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; gso_max_size &lt;span class=&#34;m&#34;&gt;65536&lt;/span&gt; gso_max_segs &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# å¦ä¸€å°æœºå™¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip -4 a s enp1s0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2: enp1s0: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class=&#34;m&#34;&gt;1500&lt;/span&gt; qdisc fq_codel state UP group default qlen &lt;span class=&#34;m&#34;&gt;1000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    link/ether dc:2d:cb:17:3e:86 brd ff:ff:ff:ff:ff:ff
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    inet 172.18.27.254/25 brd 172.18.27.255 scope global noprefixroute enp1s0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       valid_lft forever preferred_lft forever
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip -d link show flannel.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;66: flannel.1: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class=&#34;m&#34;&gt;1450&lt;/span&gt; qdisc noqueue state UNKNOWN mode DEFAULT group default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    link/ether fe:22:77:eb:2f:a4 brd ff:ff:ff:ff:ff:ff promiscuity &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; minmtu &lt;span class=&#34;m&#34;&gt;68&lt;/span&gt; maxmtu &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    vxlan id &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; 172.18.27.254 dev enp1s0 srcport &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; dstport &lt;span class=&#34;m&#34;&gt;8472&lt;/span&gt; nolearning ttl auto ageing &lt;span class=&#34;m&#34;&gt;300&lt;/span&gt; udpcsum noudp6zerocsumtx noudp6zerocsumrx addrgenmode none numtxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; numrxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; gso_max_size &lt;span class=&#34;m&#34;&gt;65536&lt;/span&gt; gso_max_segs &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°ç½‘å¡ enp1s0 çš„ mac æ˜¯ä¸ä¸€æ ·çš„ï¼ŒæŸ¥çœ‹äº†ä¸‹å‡ ä¸ªæœºå™¨çš„ç½‘å¡é…ç½®æ–‡ä»¶çš„ UUID å’Œ HWADDR éƒ½ä¸ä¸€æ ·ã€‚ä¸Šé¢å‘½ä»¤å¯ä»¥çœ‹å‡ºåªæœ‰ flannel.1 çš„ MAC æ˜¯ä¸€æ ·ï¼Œå°è¯•åˆ é™¤ç„¶åé‡å¯ flanneld çœ‹çœ‹é‡å»ºå’‹æ ·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip link &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; flannel.1 down
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip link &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; flannel.1 up
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip -d link show  flannel.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;4: flannel.1: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class=&#34;m&#34;&gt;1450&lt;/span&gt; qdisc noqueue state UNKNOWN mode DEFAULT group default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    link/ether fe:22:77:eb:2f:a4 brd ff:ff:ff:ff:ff:ff promiscuity &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; minmtu &lt;span class=&#34;m&#34;&gt;68&lt;/span&gt; maxmtu &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    vxlan id &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; 172.18.27.253 dev enp1s0 srcport &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; dstport &lt;span class=&#34;m&#34;&gt;8472&lt;/span&gt; nolearning ttl auto ageing &lt;span class=&#34;m&#34;&gt;300&lt;/span&gt; udpcsum noudp6zerocsumtx noudp6zerocsumrx addrgenmode none numtxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; numrxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; gso_max_size &lt;span class=&#34;m&#34;&gt;65536&lt;/span&gt; gso_max_segs &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip link delete flannel.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ docker ps -a &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;grep -m1 flanneld
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0aa5998260ba        122cdb7aa710                                &lt;span class=&#34;s2&#34;&gt;&amp;#34;/opt/bin/flanneld -â€¦&amp;#34;&lt;/span&gt;    &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt; hours ago          Up &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; hours                                          k8s_kube-flannel_kube-flannel-ds-2zqr9_kube-system_1ed6eba1-fa30-405e-83d0-314160c25313_1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ docker restart 0aa
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0aa
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip -d link show  flannel.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;22: flannel.1: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class=&#34;m&#34;&gt;1450&lt;/span&gt; qdisc noqueue state UNKNOWN mode DEFAULT group default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    link/ether fe:22:77:eb:2f:a4 brd ff:ff:ff:ff:ff:ff promiscuity &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; minmtu &lt;span class=&#34;m&#34;&gt;68&lt;/span&gt; maxmtu &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    vxlan id &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; 172.18.27.253 dev enp1s0 srcport &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; dstport &lt;span class=&#34;m&#34;&gt;8472&lt;/span&gt; nolearning ttl auto ageing &lt;span class=&#34;m&#34;&gt;300&lt;/span&gt; udpcsum noudp6zerocsumtx noudp6zerocsumrx addrgenmode eui64 numtxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; numrxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; gso_max_size &lt;span class=&#34;m&#34;&gt;65536&lt;/span&gt; gso_max_segs &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿˜æ˜¯ä¸€æ‘¸ä¸€æ ·ï¼Œå¥½å¥‡è¿™ä¸ª mac åœ°å€å¦‚ä½•æ¥çš„ï¼Œå°±å»çœ‹äº†ä¸‹ &lt;a href=&#34;https://github.com/coreos/flannel/blob/v0.11.0/backend/vxlan/vxlan.go#L104-L137&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;flannel æ·»åŠ  flannel.1 çš„æºç éƒ¨åˆ†&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-golang&#34; data-lang=&#34;golang&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;devAttrs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;vxlanDeviceAttrs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;vni&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cfg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;VNI&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sprintf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;flannel.%v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cfg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;VNI&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;vtepIndex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;be&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;extIface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Iface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;vtepAddr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;nx&#34;&gt;be&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;extIface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IfaceAddr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;vtepPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;nx&#34;&gt;cfg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;gbp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;cfg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GBP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newVXLANDevice&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;devAttrs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;directRouting&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cfg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DirectRouting&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;subnetAttrs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newSubnetAttrs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;be&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;extIface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ExtAddr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;MACAddr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;dev.MACAddr()&lt;/code&gt; æ˜¯ç›´æ¥ return çš„ &lt;code&gt;dev.link.HardwareAddr&lt;/code&gt;ï¼Œgoland é‡Œ find usage ä¸‹å‹æ ¹æ²¡æ‰¾åˆ°èµ‹å€¼çš„åœ°æ–¹ã€‚ï¼ˆå¯ä»¥åŠ ä»£ç æ‰“å°ä¸‹åˆ°åº• mac åœ°å€ä»å“ªé‡Œè·å–çš„ï¼Œä½†æ˜¯ç¯å¢ƒæ˜¯è¿œç¨‹çš„ï¼Œå¾—ä¸€æ¬¡ä¸€æ¬¡ç¼–è¯‘å‘è¿‡å»å¤ªéº»çƒ¦äº†æˆ‘å°±æ²¡å¼„äº†ï¼‰æ¯«æ— å¤´ç»ªä¹±æ’æŸ¥äº†ä¸€æ®µæ—¶é—´ã€‚ç„¶åçªå‘å¥‡æƒ³æ‰‹åŠ¨æŒ‰ç…§ vxlan åˆ›å»ºçš„æ­¥éª¤æµ‹è¯•æ·»åŠ ä¸‹çœ‹çœ‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip link add &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt; vxlan id &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; dev enp1s0 &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; 10.186.0.0 dstport &lt;span class=&#34;m&#34;&gt;8473&lt;/span&gt; nolearning
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip -d link show &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;696: test: &amp;lt;BROADCAST,MULTICAST&amp;gt; mtu &lt;span class=&#34;m&#34;&gt;1450&lt;/span&gt; qdisc noop state DOWN mode DEFAULT group default qlen &lt;span class=&#34;m&#34;&gt;1000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    link/ether ca:32:f1:0d:c6:dc brd ff:ff:ff:ff:ff:ff promiscuity &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; minmtu &lt;span class=&#34;m&#34;&gt;68&lt;/span&gt; maxmtu &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    vxlan id &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; 10.186.0.0 dev enp1s0 srcport &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; dstport &lt;span class=&#34;m&#34;&gt;8473&lt;/span&gt; nolearning ttl auto ageing &lt;span class=&#34;m&#34;&gt;300&lt;/span&gt; udpcsum noudp6zerocsumtx noudp6zerocsumrx addrgenmode eui64 numtxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; numrxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; gso_max_size &lt;span class=&#34;m&#34;&gt;65536&lt;/span&gt; gso_max_segs &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip link delete &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip link add &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt; vxlan id &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; dev enp1s0 &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; 10.186.0.0 dstport &lt;span class=&#34;m&#34;&gt;8473&lt;/span&gt; nolearning
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip -d link show &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;697: test: &amp;lt;BROADCAST,MULTICAST&amp;gt; mtu &lt;span class=&#34;m&#34;&gt;1450&lt;/span&gt; qdisc noop state DOWN mode DEFAULT group default qlen &lt;span class=&#34;m&#34;&gt;1000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    link/ether ca:32:f1:0d:c6:dc brd ff:ff:ff:ff:ff:ff promiscuity &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; minmtu &lt;span class=&#34;m&#34;&gt;68&lt;/span&gt; maxmtu &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    vxlan id &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; 10.186.0.0 dev enp1s0 srcport &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; dstport &lt;span class=&#34;m&#34;&gt;8473&lt;/span&gt; nolearning ttl auto ageing &lt;span class=&#34;m&#34;&gt;300&lt;/span&gt; udpcsum noudp6zerocsumtx noudp6zerocsumrx addrgenmode eui64 numtxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; numrxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; gso_max_size &lt;span class=&#34;m&#34;&gt;65536&lt;/span&gt; gso_max_segs &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å‘ç°æ‰‹åŠ¨åˆ›å»ºçš„ç½‘ç»œè®¾å¤‡ mac å±…ç„¶ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼ˆå®é™…ä¸Š ide é‡Œæ‰¾ä¸Šé¢é‚£ä¸ª &lt;code&gt;HardwareAddr&lt;/code&gt; çš„èµ‹å€¼æ˜¯åœ¨å¼•å…¥çš„ä¸€ä¸ª &lt;code&gt;netlink&lt;/code&gt; åŒ…é‡Œèµ‹å€¼çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ flannel åˆ›å»ºæ¥å£çš„æ—¶å€™å’Œæ‰‹åŠ¨æ·»åŠ ç±»ä¼¼ï¼Œæ²¡æœ‰ç›´æ¥è®¾ç½® mac åœ°å€ï¼Œè€Œæ˜¯ç³»ç»Ÿè¿”å›çš„ï¼‰ï¼Œç„¶ååŒæ ·æ­¥éª¤åœ¨æˆ‘æœºå™¨ä¸Šæµ‹è¯•æ˜¯ä¸ä¸€æ ·çš„ï¼Œçœ‹äº†ä¸‹å®¢æˆ·æ˜¯å•¥æœåŠ¡å™¨ï¼Œå‘ç°å±…ç„¶æ˜¯è™šæœºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cat /sys/class/dmi/id/product_name
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;KVM Virtual Machine
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‰å°æœºå™¨ä¸Šæ·»åŠ æ¥å£çš„ mac åœ°å€éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæœºå™¨æ˜¯ä¸æ˜¯å…‹éš†çš„ï¼Ÿè¯¢é—®äº†ä¸‹åŒäº‹ï¼ŒåŒäº‹è¯´æ˜¯çš„ã€‚å…¶å®è¿™å°±æ˜¯å¼•èµ·æ•…éšœçš„æ ¹æºï¼Œåº”è¯¥å†…éƒ¨ mac åœ°å€é»˜è®¤æ˜¯ä¸éšæœºçš„ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹ä¸‹ç½‘å¡ç­–ç•¥æ˜¯å’‹æ ·çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ networkctl status flannel.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ networkctl status enp1s0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å±…ç„¶éƒ½ä¸ºç©ºï¼Œubuntu çš„æœºå™¨ä¸Šæ˜¯æœ‰ä¸ªä¼˜å…ˆçº§ä½çš„ link æ–‡ä»¶çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ networkctl status enp10s0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â— 2: enp10s0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       Link File: /lib/systemd/network/99-default.link
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Network File: n/a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            Type: ether
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           State: n/a &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;unmanaged&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            Path: platform-80040000000.pcie-controller-pci-0000:0a:00.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          Driver: igb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          Vendor: Intel Corporation
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           Model: I210 Gigabit Network Connection
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      HW Address: 00:09:06:xx:xx:xx &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Esteem Networks&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Address: 10.226.45.23
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  fe80::209:xxx:xxxx:xxxx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         Gateway: 10.226.45.254
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸€äº›äº‘ä¸»æœºæˆ‘çœ‹ä¹Ÿæ²¡è¿™ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯ä¸Šé¢æ·»åŠ çš„æ¥å£æ¯æ¬¡ mac ä¸ä¸€æ ·ï¼Œåº”è¯¥å…¶ä»– OS æ”¹äº†é»˜è®¤çš„è¡Œä¸ºã€‚&lt;/p&gt;
&lt;h3 id=&#34;è§£å†³æ–¹æ³•&#34;&gt;è§£å†³æ–¹æ³•&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥ç”¨ systemd å†™ä¸€ä¸ª link é…ç½®æ–‡ä»¶æ”¹å˜ç­–ç•¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cat&lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;&amp;#39;EOF&amp;#39;&amp;gt;/etc/systemd/network/10-flannel.link
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;[Match]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;OriginalName=flannel*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;[Link]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;MACAddressPolicy=none
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ä¸€å¼€å§‹åªæ·»åŠ ä¸Šé¢çš„ï¼Œç»“æœé‡å¯åæ–‡ä»¶æ²¡äº†ï¼Œä¸‹é¢çš„æ–‡ä»¶ä¹Ÿè¿½åŠ äº†ä¸‹ï¼Œç„¶åé‡å¯è¿˜æ˜¯å¤±æ•ˆã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ç„¶åä¸Šä¸‹ä¸¤ä¸ªæ­¥éª¤éƒ½æ•´å°±è¡Œäº†ã€‚å¦‚æœä½ ä¹Ÿé‡åˆ°äº†ï¼Œå…ˆå•ç‹¬ä¸Šé¢çš„æ–‡ä»¶è¯•è¯•ï¼Œä¸è¡Œå†ä¸‹é¢çš„ä¹ŸåŠ ä¸Šè¯•è¯•ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cat&lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;&amp;#39;EOF&amp;#39;&amp;gt;&amp;gt;/etc/systemd/networkd.conf
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;[Match]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;OriginalName=flannel*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;[Link]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;MACAddressPolicy=none
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¡®è®¤ç”Ÿæ•ˆæ–‡ä»¶&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ networkctl status flannel.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â— 36: flannel.1                                              
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             Link File: /etc/systemd/network/10-flannel.link
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          Network File: n/a                                 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  Type: vxlan                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                 State: routable &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;unmanaged&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                Driver: vxlan                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            HW Address: fe:22:77:eb:2f:a4                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   MTU: &lt;span class=&#34;m&#34;&gt;1450&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;min: 68, max: 65535&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;          
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   VNI: &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;                                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                 Local: 172.18.27.252                       
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      Destination Port: &lt;span class=&#34;m&#34;&gt;8472&lt;/span&gt;                                
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Underlying Device: enp1s0                              
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Queue Length &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Tx/Rx&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;: 1/1                                 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;               Address: 10.187.1.0 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†æµ‹è¯•ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip -d link show flannel.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;4: flannel.1: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class=&#34;m&#34;&gt;1450&lt;/span&gt; qdisc noqueue state UNKNOWN mode DEFAULT group default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    link/ether fe:22:77:eb:2f:a4 brd ff:ff:ff:ff:ff:ff promiscuity &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; minmtu &lt;span class=&#34;m&#34;&gt;68&lt;/span&gt; maxmtu &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    vxlan id &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; 172.18.27.253 dev enp1s0 srcport &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; dstport &lt;span class=&#34;m&#34;&gt;8472&lt;/span&gt; nolearning ttl auto ageing &lt;span class=&#34;m&#34;&gt;300&lt;/span&gt; udpcsum noudp6zerocsumtx noudp6zerocsumrx addrgenmode eui64 numtxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; numrxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; gso_max_size &lt;span class=&#34;m&#34;&gt;65536&lt;/span&gt; gso_max_segs &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip link delete flannel.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ docker ps -a &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep -m1 flanneld
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;f8759c103131        122cdb7aa710                                   &lt;span class=&#34;s2&#34;&gt;&amp;#34;/opt/bin/flanneld -â€¦&amp;#34;&lt;/span&gt;    &lt;span class=&#34;m&#34;&gt;27&lt;/span&gt; minutes ago      Up &lt;span class=&#34;m&#34;&gt;27&lt;/span&gt; minutes                                   k8s_kube-flannel_kube-flannel-ds-85kps_kube-system_127265f3-f3ea-4f89-87e1-aa6c0e0d356f_0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ docker restart f87
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;f87
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ip -d link show flannel.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;36: flannel.1: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class=&#34;m&#34;&gt;1450&lt;/span&gt; qdisc noqueue state UNKNOWN mode DEFAULT group default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    link/ether 1a:e0:cc:e3:a7:04 brd ff:ff:ff:ff:ff:ff promiscuity &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; minmtu &lt;span class=&#34;m&#34;&gt;68&lt;/span&gt; maxmtu &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    vxlan id &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; 172.18.27.253 dev enp1s0 srcport &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; dstport &lt;span class=&#34;m&#34;&gt;8472&lt;/span&gt; nolearning ttl auto ageing &lt;span class=&#34;m&#34;&gt;300&lt;/span&gt; udpcsum noudp6zerocsumtx noudp6zerocsumrx addrgenmode eui64 numtxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; numrxqueues &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; gso_max_size &lt;span class=&#34;m&#34;&gt;65536&lt;/span&gt; gso_max_segs &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœç„¶å˜äº†ï¼Œå¦‚æœæ²¡å˜å°è¯•æŠŠ &lt;code&gt;none&lt;/code&gt; æ”¹æˆ &lt;code&gt;random&lt;/code&gt; è¯•è¯•ã€‚ç„¶åæ¯ä¸ªèŠ‚ç‚¹è¿™æ ·æ“ä½œåï¼ŒæŸ¥çœ‹ä¸‹äº†ä¸‹ vtep ä¿¡æ¯æ­£å¸¸äº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get node -o yaml &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep -A3 Vtep
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      flannel.alpha.coreos.com/backend-data: &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;VtepMAC&amp;#34;:&amp;#34;9a:1e:00:9d:0c:60&amp;#34;}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      flannel.alpha.coreos.com/backend-type: vxlan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      flannel.alpha.coreos.com/kube-subnet-manager: &lt;span class=&#34;s2&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      flannel.alpha.coreos.com/public-ip: 172.18.27.252
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      flannel.alpha.coreos.com/backend-data: &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;VtepMAC&amp;#34;:&amp;#34;1a:e0:cc:e3:a7:04&amp;#34;}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      flannel.alpha.coreos.com/backend-type: vxlan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      flannel.alpha.coreos.com/kube-subnet-manager: &lt;span class=&#34;s2&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      flannel.alpha.coreos.com/public-ip: 172.18.27.253
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      flannel.alpha.coreos.com/backend-data: &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;VtepMAC&amp;#34;:&amp;#34;fe:22:77:eb:2f:a4&amp;#34;}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      flannel.alpha.coreos.com/backend-type: vxlan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      flannel.alpha.coreos.com/kube-subnet-manager: &lt;span class=&#34;s2&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      flannel.alpha.coreos.com/public-ip: 172.18.27.254
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æµ‹è¯•ä¸‹è·¨èŠ‚ç‚¹é€šä¿¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl -I 10.187.0.5:9153/metrics
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Content-Length: &lt;span class=&#34;m&#34;&gt;16905&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Content-Type: text/plain&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0.0.4&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;charset&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;utf-8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Date: Fri, &lt;span class=&#34;m&#34;&gt;06&lt;/span&gt; Nov &lt;span class=&#34;m&#34;&gt;2020&lt;/span&gt; 01:47:31 GMT
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h3&gt;
&lt;p&gt;åº”è¯¥ä¸€å¼€å§‹å°±çœ‹ä¸‹ vtep ä¿¡æ¯çš„ï¼Œå…¶æ¬¡åº”è¯¥æ˜¯ os çš„é—®é¢˜ï¼Œç¼ºå°‘ link æ–‡ä»¶ã€‚è¿˜æœ‰è¿™ä¸ªå’Œ flannel æ²¡å…³ç³»ï¼Œåªè¦ç”¨åˆ° Linux è‡ªå¸¦çš„ vxlan æ¥å£åœ¨è¿™ç§åœºæ™¯ä¸Šéƒ½ä¼šå‡ºç°ï¼Œä¾‹å¦‚ calico æ–°ç‰ˆæœ¬ä¹Ÿæœ‰ vxlan æ¨¡å¼ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒæ–‡æ¡£&#34;&gt;å‚è€ƒæ–‡æ¡£&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.jinbuguo.com/systemd/systemd.link.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;systemd link&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>æ·±å…¥ç†è§£ Kubernetes ç½‘ç»œæ¨¡å‹ï¼šè‡ªå·±å®ç° kube-proxy çš„åŠŸèƒ½</title>
      <link>https://cloudnativecn.com/blog/k8s-node-proxy/</link>
      <pubDate>Mon, 19 Oct 2020 16:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/k8s-node-proxy/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ª &lt;a href=&#34;https://arthurchiao.art/blog/cracking-k8s-node-proxy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cracking kubernetes node proxy (aka kube-proxy)&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes ä¸­æœ‰å‡ ç§ç±»å‹çš„ä»£ç†ã€‚å…¶ä¸­æœ‰ &lt;strong&gt;node proxier&lt;/strong&gt; æˆ– &lt;a href=&#34;https://kubernetes.io/docs/reference/command-line-tools-reference/kube-proxy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kube-proxy&lt;/a&gt;ï¼Œå®ƒåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šåæ˜  Kubernetes API ä¸­å®šä¹‰çš„æœåŠ¡ï¼Œå¯ä»¥è·¨ä¸€ç»„åç«¯æ‰§è¡Œç®€å•çš„ TCP/UDP/SCTP æµè½¬å‘ [1]ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æ›´å¥½åœ°ç†è§£èŠ‚ç‚¹ä»£ç†æ¨¡å‹ï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ç”¨ä¸åŒçš„æ–¹æ³•è®¾è®¡å’Œå®ç°æˆ‘ä»¬è‡ªå·±ç‰ˆæœ¬çš„ &lt;code&gt;kube-proxy&lt;/code&gt;; å°½ç®¡è¿™äº›åªæ˜¯ &lt;code&gt;toy-proxy&lt;/code&gt;ï¼Œä½†ä»&lt;strong&gt;é€æ˜æµé‡æ‹¦æˆªã€è½¬å‘ã€è´Ÿè½½å‡è¡¡&lt;/strong&gt;ç­‰æ–¹é¢æ¥è¯´ï¼Œå®ƒä»¬çš„å·¥ä½œæ–¹å¼ä¸ K8S é›†ç¾¤ä¸­è¿è¡Œçš„æ™®é€š &lt;code&gt;kube-proxy&lt;/code&gt; åŸºæœ¬ç›¸åŒã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡æˆ‘ä»¬çš„ &lt;code&gt;toy-proxy&lt;/code&gt; ç¨‹åºï¼Œé K8S èŠ‚ç‚¹ï¼ˆä¸åœ¨ K8S é›†ç¾¤ä¸­ï¼‰ä¸Šçš„åº”ç”¨ç¨‹åºï¼ˆæ— è®ºæ˜¯å®¿ä¸»æœ¬åœ°åº”ç”¨ç¨‹åºï¼Œè¿˜æ˜¯åœ¨ VM/å®¹å™¨ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºï¼‰ä¹Ÿå¯ä»¥é€šè¿‡ &lt;strong&gt;ClusterIP&lt;/strong&gt; è®¿é—® K8S æœåŠ¡ &amp;ndash; &lt;strong&gt;æ³¨æ„ï¼Œåœ¨ kubernetes çš„è®¾è®¡ä¸­ï¼ŒClusterIP åªèƒ½åœ¨ K8S é›†ç¾¤èŠ‚ç‚¹ä¸­è®¿é—®ï¼ˆåœ¨æŸç§æ„ä¹‰ä¸Šï¼Œæˆ‘ä»¬çš„ &lt;code&gt;toy-proxy&lt;/code&gt; ç¨‹åºå°†é K8S èŠ‚ç‚¹å˜æˆäº† K8S èŠ‚ç‚¹ï¼‰ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;èƒŒæ™¯çŸ¥è¯†&#34;&gt;èƒŒæ™¯çŸ¥è¯†&lt;/h2&gt;
&lt;p&gt;äº†è§£ Linux å†…æ ¸ä¸­çš„æµé‡æ‹¦æˆªå’Œä»£ç†éœ€è¦å…·å¤‡ä»¥ä¸‹èƒŒæ™¯çŸ¥è¯†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;netfilter&#34;&gt;Netfilter&lt;/h3&gt;
&lt;p&gt;Netfilter æ˜¯ Linux å†…æ ¸å†…éƒ¨çš„&lt;strong&gt;åŒ…è¿‡æ»¤å’Œå¤„ç†æ¡†æ¶&lt;/strong&gt;ã€‚å¦‚æœä½ ä¸ç†Ÿæ‚‰ Iptables å’Œ Netfilter ä½“ç³»ç»“æ„ï¼Œè¯·å‚é˜… &lt;a href=&#34;https://www.digitalocean.com/community/tutorials/a-deep-dive-into-iptables-and-netfilter-architecture&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;A Deep Dive into Iptables and Netfilter Architecture&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸€äº›è¦ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸»æœºä¸Šçš„&lt;strong&gt;æ‰€æœ‰æ•°æ®åŒ…&lt;/strong&gt;éƒ½å°†é€šè¿‡ netfilter æ¡†æ¶&lt;/li&gt;
&lt;li&gt;åœ¨ netfilter æ¡†æ¶ä¸­æœ‰ &lt;strong&gt;5 ä¸ªé’©å­&lt;/strong&gt;ç‚¹ï¼š&lt;code&gt;PRE_ROUTING&lt;/code&gt;, &lt;code&gt;INPUT&lt;/code&gt;, &lt;code&gt;FORWARD&lt;/code&gt;, &lt;code&gt;OUTPUT&lt;/code&gt;, &lt;code&gt;POST_ROUTING&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å‘½ä»¤è¡Œå·¥å…· &lt;code&gt;iptables&lt;/code&gt; å¯ç”¨äº&lt;strong&gt;åŠ¨æ€åœ°å°†è§„åˆ™æ’å…¥åˆ°é’©å­ç‚¹ä¸­&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;å¯ä»¥é€šè¿‡ç»„åˆå„ç§ &lt;code&gt;iptables&lt;/code&gt; è§„åˆ™æ¥æ“ä½œæ•°æ®åŒ…ï¼ˆæ¥å—/é‡å®šå‘/åˆ é™¤/ä¿®æ”¹ï¼Œç­‰ç­‰ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-the-5-hook-points-in-netfilter-framework&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;The 5 hook points in netfilter framework&#34; srcset=&#34;
               /blog/k8s-node-proxy/proxy_hooks_hu2776462015808867037.webp 400w,
               /blog/k8s-node-proxy/proxy_hooks_hu16745656888037045867.webp 760w,
               /blog/k8s-node-proxy/proxy_hooks_hu14867894520476118171.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/k8s-node-proxy/proxy_hooks_hu2776462015808867037.webp&#34;
               width=&#34;760&#34;
               height=&#34;366&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      The 5 hook points in netfilter framework
    &lt;/figcaption&gt;&lt;/figure&gt;

æ­¤å¤–ï¼Œè¿™ 5 ä¸ªé’©å­ç‚¹è¿˜å¯ä»¥ä¸å†…æ ¸çš„å…¶ä»–ç½‘ç»œè®¾æ–½ï¼Œå¦‚å†…æ ¸è·¯ç”±å­ç³»ç»Ÿè¿›è¡ŒååŒå·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œåœ¨æ¯ä¸ªé’©å­ç‚¹ä¸­ï¼Œè§„åˆ™è¢«ç»„ç»‡åˆ°å…·æœ‰é¢„å®šä¹‰ä¼˜å…ˆçº§çš„ä¸åŒé“¾ä¸­ã€‚ä¸ºäº†æŒ‰ç›®çš„ç®¡ç†é“¾ï¼Œé“¾è¢«è¿›ä¸€æ­¥ç»„ç»‡åˆ°è¡¨ä¸­ã€‚ç°åœ¨æœ‰ 5 ä¸ªè¡¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;filter&lt;/code&gt;ï¼šåšæ­£å¸¸çš„è¿‡æ»¤ï¼Œå¦‚æ¥å—ï¼Œæ‹’ç»/åˆ ï¼Œè·³&lt;/li&gt;
&lt;li&gt;&lt;code&gt;nat&lt;/code&gt;ï¼šç½‘ç»œåœ°å€è½¬æ¢ï¼ŒåŒ…æ‹¬ SNATï¼ˆæº nat) å’Œ DNATï¼ˆç›®çš„ nat)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;mangle&lt;/code&gt;ï¼šä¿®æ”¹åŒ…å±æ€§ï¼Œä¾‹å¦‚ TTL&lt;/li&gt;
&lt;li&gt;&lt;code&gt;raw&lt;/code&gt;ï¼šæœ€æ—©çš„å¤„ç†ç‚¹ï¼Œè¿æ¥è·Ÿè¸ªå‰çš„ç‰¹æ®Šå¤„ç† (conntrack æˆ– CTï¼Œä¹ŸåŒ…å«åœ¨ä¸Šå›¾ä¸­ï¼Œä½†è¿™ä¸æ˜¯é“¾ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;security&lt;/code&gt;ï¼šæœ¬æ–‡æœªæ¶‰åŠ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å°†è¡¨/é“¾æ·»åŠ åˆ°ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°æ›´è¯¦ç»†çš„è§†å›¾ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-iptables-tablechains-inside-hook-points&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;iptables table/chains inside hook points&#34; srcset=&#34;
               /blog/k8s-node-proxy/proxy_hooks-and-tables_hu9061616707638239881.webp 400w,
               /blog/k8s-node-proxy/proxy_hooks-and-tables_hu1346142565222670238.webp 760w,
               /blog/k8s-node-proxy/proxy_hooks-and-tables_hu2530678926635210521.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/k8s-node-proxy/proxy_hooks-and-tables_hu9061616707638239881.webp&#34;
               width=&#34;760&#34;
               height=&#34;455&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      iptables table/chains inside hook points
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;vip-ä¸è´Ÿè½½å‡è¡¡-lb&#34;&gt;VIP ä¸è´Ÿè½½å‡è¡¡ (LB)&lt;/h3&gt;
&lt;p&gt;è™šæ‹Ÿ IP (IP) å°†æ‰€æœ‰åç«¯ IP éšè—ç»™å®¢æˆ·ç«¯/ç”¨æˆ·ï¼Œå› æ­¤å®¢æˆ·ç«¯/ç”¨æˆ·æ€»æ˜¯ä¸ VIP çš„åç«¯æœåŠ¡é€šä¿¡ï¼Œè€Œä¸éœ€è¦å…³å¿ƒ VIP åé¢æœ‰å¤šå°‘å®ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;VIP æ€»æ˜¯ä¼´éšç€è´Ÿè½½å‡è¡¡ï¼Œå› ä¸ºå®ƒéœ€è¦åœ¨ä¸åŒçš„åç«¯ä¹‹é—´åˆ†é…æµé‡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-vip-and-load-balancing&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;VIP and load balancing&#34; srcset=&#34;
               /blog/k8s-node-proxy/proxy_vip-and-lb_hu13837995078890881933.webp 400w,
               /blog/k8s-node-proxy/proxy_vip-and-lb_hu318969994400624863.webp 760w,
               /blog/k8s-node-proxy/proxy_vip-and-lb_hu4698259149088716632.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/k8s-node-proxy/proxy_vip-and-lb_hu13837995078890881933.webp&#34;
               width=&#34;760&#34;
               height=&#34;504&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      VIP and load balancing
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;cross-host-ç½‘ç»œæ¨¡å‹&#34;&gt;Cross-host ç½‘ç»œæ¨¡å‹&lt;/h3&gt;
&lt;p&gt;ä¸»æœº A ä¸Šçš„å®ä¾‹ï¼ˆå®¹å™¨ã€VM ç­‰ï¼‰å¦‚ä½•ä¸ä¸»æœº B ä¸Šçš„å¦ä¸€ä¸ªå®ä¾‹é€šä¿¡ï¼Ÿæœ‰å¾ˆå¤šè§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›´æ¥è·¯ç”±ï¼šBGP ç­‰&lt;/li&gt;
&lt;li&gt;éš§é“ï¼šVxLAN, IPIP, GRE ç­‰&lt;/li&gt;
&lt;li&gt;NATï¼šä¾‹å¦‚ docker çš„æ¡¥æ¥ç½‘ç»œæ¨¡å¼&lt;/li&gt;
&lt;li&gt;å…¶å®ƒæ–¹å¼&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;èŠ‚ç‚¹ä»£ç†æ¨¡å‹&#34;&gt;èŠ‚ç‚¹ä»£ç†æ¨¡å‹&lt;/h2&gt;
&lt;p&gt;åœ¨ kubernetes ä¸­ï¼Œä½ å¯ä»¥å°†åº”ç”¨ç¨‹åºå®šä¹‰ä¸º &lt;code&gt;Service&lt;/code&gt;ã€‚&lt;code&gt;Service&lt;/code&gt; æ˜¯ä¸€ç§æŠ½è±¡ï¼Œå®ƒå®šä¹‰äº†ä¸€ç»„ pod çš„é€»è¾‘é›†å’Œè®¿é—®å®ƒä»¬çš„ç­–ç•¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;service-ç±»å‹&#34;&gt;Service ç±»å‹&lt;/h3&gt;
&lt;p&gt;K8S ä¸­å®šä¹‰äº† 4 ç§ &lt;code&gt;Service&lt;/code&gt; ç±»å‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ClusterIP&lt;/code&gt;ï¼šé€šè¿‡ VIP è®¿é—® Serviceï¼Œä½†è¯¥ VIP åªèƒ½åœ¨æ­¤é›†ç¾¤å†…è®¿é—®&lt;/li&gt;
&lt;li&gt;&lt;code&gt;NodePort&lt;/code&gt;ï¼šé€šè¿‡ NodeIP:NodePort è®¿é—® Serviceï¼Œè¿™æ„å‘³ç€è¯¥ç«¯å£å°†æš´éœ²åœ¨é›†ç¾¤å†…çš„æ‰€æœ‰èŠ‚ç‚¹ä¸Š&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ExternalIP&lt;/code&gt;ï¼šä¸ &lt;code&gt;ClusterIP&lt;/code&gt; ç›¸åŒï¼Œä½†æ˜¯è¿™ä¸ª VIP å¯ä»¥ä»è¿™ä¸ªé›†ç¾¤ä¹‹å¤–è®¿é—®&lt;/li&gt;
&lt;li&gt;&lt;code&gt;LoadBalancer&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« å°†å…³æ³¨ &lt;code&gt;ClusterIP&lt;/code&gt;ï¼Œä½†æ˜¯å…¶ä»–ä¸‰ç§ç±»å‹åœ¨æµé‡æ‹¦æˆªå’Œè½¬å‘æ–¹é¢çš„åº•å±‚å®ç°éå¸¸ç›¸ä¼¼ã€‚&lt;/p&gt;
&lt;h3 id=&#34;èŠ‚ç‚¹ä»£ç†&#34;&gt;èŠ‚ç‚¹ä»£ç†&lt;/h3&gt;
&lt;p&gt;ä¸€ä¸ª Service æœ‰ä¸€ä¸ª VIPï¼ˆæœ¬æ–‡ä¸­çš„ &lt;code&gt;ClusterIP&lt;/code&gt;ï¼‰å’Œå¤šä¸ªç«¯ç‚¹ï¼ˆåç«¯ podï¼‰ã€‚æ¯ä¸ª pod æˆ–èŠ‚ç‚¹éƒ½å¯ä»¥é€šè¿‡ VIP ç›´æ¥è®¿é—®åº”ç”¨ç¨‹åºã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼ŒèŠ‚ç‚¹ä»£ç†ç¨‹åºéœ€è¦åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œå®ƒåº”è¯¥èƒ½å¤Ÿé€æ˜åœ°æ‹¦æˆªåˆ°ä»»ä½• &lt;code&gt;ClusterIP:Port&lt;/code&gt;[æ³¨è§£ 1] çš„æµé‡ï¼Œå¹¶å°†å®ƒä»¬é‡å®šå‘åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªåç«¯ podã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-kubernetes-proxier-model&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Kubernetes proxier model&#34; srcset=&#34;
               /blog/k8s-node-proxy/proxy_k8s-proxier-model_hu17944153611068516652.webp 400w,
               /blog/k8s-node-proxy/proxy_k8s-proxier-model_hu15481241643214429877.webp 760w,
               /blog/k8s-node-proxy/proxy_k8s-proxier-model_hu4652385144498400898.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/k8s-node-proxy/proxy_k8s-proxier-model_hu17944153611068516652.webp&#34;
               width=&#34;760&#34;
               height=&#34;206&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Kubernetes proxier model
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨è§£ 1ï¼š&lt;/p&gt;
&lt;p&gt;å¯¹ &lt;code&gt;ClusterIP&lt;/code&gt; çš„ä¸€ä¸ªå¸¸è§è¯¯è§£æ˜¯ï¼Œ&lt;code&gt;ClusterIP&lt;/code&gt; æ˜¯å¯è®¿é—®çš„â€”â€”å®ƒä»¬ä¸æ˜¯é€šè¿‡å®šä¹‰è®¿é—®çš„ã€‚å¦‚æœ ping ä¸€ä¸ª &lt;code&gt;ClusterIP&lt;/code&gt;ï¼Œå¯èƒ½ä¼šå‘ç°å®ƒä¸å¯è®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ®å®šä¹‰ï¼Œ&lt;strong&gt;&amp;lt;Protocol,ClusterIP,Port&amp;gt;&lt;/strong&gt; å…ƒç»„ç‹¬ç‰¹åœ°å®šä¹‰äº†ä¸€ä¸ªæœåŠ¡ï¼ˆå› æ­¤ä¹Ÿå®šä¹‰äº†ä¸€ä¸ªæ‹¦æˆªè§„åˆ™ï¼‰ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªæœåŠ¡è¢«å®šä¹‰ä¸º &lt;code&gt;&amp;lt;tcp,10.7.0.100,80&amp;gt;&lt;/code&gt;ï¼Œé‚£ä¹ˆä»£ç†åªå¤„ç† &lt;code&gt;tcp:10.7.0.100:80&lt;/code&gt; çš„æµé‡ï¼Œå…¶ä»–æµé‡ï¼Œä¾‹å¦‚ã€‚&lt;code&gt;tcp:10.7.0.100:8080&lt;/code&gt;, &lt;code&gt;udp:10.7.0.100:80&lt;/code&gt; å°†ä¸ä¼šè¢«ä»£ç†ã€‚å› æ­¤ï¼Œä¹Ÿæ— æ³•è®¿é—® ClusterIPï¼ˆICMP æµé‡ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯å¸¦æœ‰ IPVS æ¨¡å¼çš„ &lt;code&gt;kube-proxy&lt;/code&gt;ï¼Œé‚£ä¹ˆç¡®å®å¯ä»¥é€šè¿‡ ping è®¿é—® &lt;code&gt;ClusterIP&lt;/code&gt;ã€‚è¿™æ˜¯å› ä¸º IPVS æ¨¡å¼å®ç°æ¯”å®šä¹‰æ‰€éœ€è¦çš„åšå¾—æ›´å¤šã€‚ä½ å°†åœ¨ä¸‹é¢å‡ èŠ‚ä¸­çœ‹åˆ°ä¸åŒä¹‹å¤„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;èŠ‚ç‚¹ä»£ç†çš„è§’è‰²åå‘ä»£ç†&#34;&gt;èŠ‚ç‚¹ä»£ç†çš„è§’è‰²ï¼šåå‘ä»£ç†&lt;/h3&gt;
&lt;p&gt;æƒ³æƒ³èŠ‚ç‚¹ä»£ç†çš„ä½œç”¨ï¼Œåœ¨ K8S ç½‘ç»œæ¨¡å‹ä¸­ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªåå‘ä»£ç†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå®ƒå°†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†æ‰€æœ‰åç«¯ pod éšè—åˆ°å®¢æˆ·ç«¯&lt;/li&gt;
&lt;li&gt;è¿‡æ»¤æ‰€æœ‰å‡ºå£æµé‡ï¼ˆå¯¹åç«¯çš„è¯·æ±‚ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¹äº ingress trafficï¼Œå®ƒä»€ä¹ˆä¹Ÿä¸åšã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ€§èƒ½é—®é¢˜&#34;&gt;æ€§èƒ½é—®é¢˜&lt;/h3&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬åœ¨ä¸»æœºä¸Šæœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”åœ¨ K8S é›†ç¾¤ä¸­æœ‰ 1K ä¸ªæœåŠ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ°¸è¿œæ— æ³•çŒœæµ‹è¯¥åº”ç”¨ç¨‹åºåœ¨ä¸‹ä¸€æ—¶åˆ»å°†è®¿é—®å“ªä¸ªæœåŠ¡ï¼ˆè¿™é‡Œå¿½ç•¥ç½‘ç»œç­–ç•¥ï¼‰ã€‚å› æ­¤ï¼Œä¸ºäº†è®©åº”ç”¨ç¨‹åºèƒ½å¤Ÿè®¿é—®æ‰€æœ‰æœåŠ¡ï¼Œæˆ‘ä»¬å¿…é¡»ä¸ºèŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰æœåŠ¡åº”ç”¨æ‰€æœ‰ä»£ç†è§„åˆ™ã€‚å°†è¿™ä¸ªæƒ³æ³•æ¨å¹¿åˆ°æ•´ä¸ªé›†ç¾¤ï¼Œè¿™æ„å‘³ç€ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ‰€æœ‰æœåŠ¡çš„ä»£ç†è§„åˆ™åº”è¯¥åº”ç”¨äºæ•´ä¸ªé›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨æŸç§æ„ä¹‰ä¸Šï¼Œè¿™æ˜¯ä¸€ä¸ªå®Œå…¨åˆ†å¸ƒå¼çš„ä»£ç†æ¨¡å‹ï¼Œå› ä¸ºä»»ä½•èŠ‚ç‚¹éƒ½æ‹¥æœ‰é›†ç¾¤çš„æ‰€æœ‰è§„åˆ™ã€‚&lt;/p&gt;
&lt;p&gt;å½“é›†ç¾¤å˜å¤§æ—¶ï¼Œè¿™ä¼šå¯¼è‡´ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ï¼Œå› ä¸ºæ¯ä¸ªèŠ‚ç‚¹ä¸Šå¯èƒ½æœ‰æ•°åä¸‡æ¡è§„åˆ™ [6,7]ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æµ‹è¯•ç¯å¢ƒ&#34;&gt;æµ‹è¯•ç¯å¢ƒ&lt;/h2&gt;
&lt;h3 id=&#34;é›†ç¾¤æ‹“æ‰‘å’Œæµ‹è¯•ç¯å¢ƒ&#34;&gt;é›†ç¾¤æ‹“æ‰‘å’Œæµ‹è¯•ç¯å¢ƒ&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹ç¯å¢ƒè¿›è¡Œæµ‹è¯•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ª k8s é›†ç¾¤
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ª master èŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ª node èŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;ç½‘ç»œè§£å†³æ–¹æ¡ˆï¼šç›´æ¥è·¯ç”±ï¼ˆPodIP å¯ç›´æ¥è·¯ç”±ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªé k8s èŠ‚ç‚¹ï¼Œä½†æ˜¯å®ƒå¯ä»¥åˆ°è¾¾å·¥ä½œèŠ‚ç‚¹å’Œ Podï¼ˆå¾—ç›Šäºç›´æ¥è·¯ç”±ç½‘ç»œæ–¹æ¡ˆï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-test-env&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;test env&#34; srcset=&#34;
               /blog/k8s-node-proxy/proxy_test-env_hu9897318036868610782.webp 400w,
               /blog/k8s-node-proxy/proxy_test-env_hu12074722423503924436.webp 760w,
               /blog/k8s-node-proxy/proxy_test-env_hu3463865948786728687.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/k8s-node-proxy/proxy_test-env_hu9897318036868610782.webp&#34;
               width=&#34;760&#34;
               height=&#34;385&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      test env
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°†åœ¨å·¥ä½œèŠ‚ç‚¹ä¸Šéƒ¨ç½² podï¼Œå¹¶ä» test èŠ‚ç‚¹é€šè¿‡ &lt;code&gt;ClusterIP&lt;/code&gt; è®¿é—® pod ä¸­çš„åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;h3 id=&#34;åˆ›å»ºä¸€ä¸ª-service&#34;&gt;åˆ›å»ºä¸€ä¸ª Service&lt;/h3&gt;
&lt;p&gt;åˆ›å»ºä¸€ä¸ªç®€å•çš„ &lt;code&gt;Statefulset&lt;/code&gt;ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€ä¸ª &lt;code&gt;Service&lt;/code&gt;ï¼Œè¯¥ &lt;code&gt;Service&lt;/code&gt; å°†æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªåç«¯ pod:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# see appendix for webapp.yaml&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl create -f webapp.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get svc -o wide webapp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME     TYPE        CLUSTER-IP     EXTERNAL-IP   PORT&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;S&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;   AGE     SELECTOR
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;webapp   ClusterIP   10.7.111.132   &amp;lt;none&amp;gt;        80/TCP    2m11s   &lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;webapp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get pod -o wide &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep webapp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;webapp-0    2/2     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;    2m12s 10.5.41.204    node1    &amp;lt;none&amp;gt;  &amp;lt;none&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åº”ç”¨ç¨‹åºåœ¨å¸¦æœ‰ tcp åè®®çš„ 80 ç«¯å£ä¸Šè¿è¡Œã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¯è¾¾æ€§æµ‹è¯•&#34;&gt;å¯è¾¾æ€§æµ‹è¯•&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆè®¿é—® PodIP+Port:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl 10.5.41.204:80
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;!DOCTYPE html&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;/html&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆåŠŸçš„ï¼ç„¶åç”¨ &lt;code&gt;ClusterIP&lt;/code&gt; æ›¿æ¢ PodIP å†è¯•ä¸€æ¬¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl 10.7.111.132:80
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;^C
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­£å¦‚æ‰€æ–™ï¼Œå®ƒæ˜¯ä¸å¯è®¿é—®çš„ï¼&lt;/p&gt;
&lt;p&gt;åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶å¦‚ä½•ä½¿ç”¨ä¸åŒçš„æ–¹æ³•ä½¿ &lt;code&gt;ClusterIP&lt;/code&gt; å¯è®¿é—®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®ç°é€šè¿‡-userspace-socket-å®ç°-proxy&#34;&gt;å®ç°ï¼šé€šè¿‡ userspace socket å®ç° proxy&lt;/h2&gt;
&lt;h3 id=&#34;ä¸­é—´äººæ¨¡å‹&#34;&gt;ä¸­é—´äººæ¨¡å‹&lt;/h3&gt;
&lt;p&gt;æœ€å®¹æ˜“ç†è§£çš„å®ç°æ˜¯åœ¨æ­¤ä¸»æœºä¸Šçš„é€šä¿¡è·¯å¾„ä¸­æ’å…¥æˆ‘ä»¬çš„ &lt;code&gt;toy-proxy&lt;/code&gt; ä½œä¸ºä¸­é—´äººï¼šå¯¹äºä»æœ¬åœ°å®¢æˆ·ç«¯åˆ° ClusterIP:Port çš„æ¯ä¸ªè¿æ¥ï¼Œ&lt;strong&gt;æˆ‘ä»¬æ‹¦æˆªè¯¥è¿æ¥å¹¶å°†å…¶åˆ†å‰²ä¸ºä¸¤ä¸ªå•ç‹¬çš„è¿æ¥&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœ¬åœ°å®¢æˆ·ç«¯å’Œ &lt;code&gt;toy-proxy&lt;/code&gt; ä¹‹é—´çš„è¿æ¥&lt;/li&gt;
&lt;li&gt;è¿æ¥ &lt;code&gt;toy-proxy&lt;/code&gt; å’Œåç«¯ pod&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å®ç°æ­¤ç›®çš„çš„æœ€ç®€å•æ–¹æ³•æ˜¯åœ¨ç”¨æˆ·ç©ºé—´ä¸­å®ç°å®ƒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ç›‘å¬èµ„æº&lt;/code&gt;ï¼šå¯åŠ¨ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œç›‘å¬ K8S apiserverã€ç›‘è§†æœåŠ¡ (ClusterIP) å’Œç«¯ç‚¹ (Pod) çš„å˜åŒ–&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ä»£ç†é€šä¿¡&lt;/code&gt;ï¼šå¯¹äºä»æœ¬åœ°å®¢æˆ·ç«¯åˆ°æœåŠ¡ (ClusterIP) çš„æ¯ä¸ªè¿æ¥è¯·æ±‚ï¼Œé€šè¿‡å……å½“ä¸­é—´äººæ¥æ‹¦æˆªè¯·æ±‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;åŠ¨æ€åº”ç”¨ä»£ç†è§„åˆ™&lt;/code&gt;ï¼šå¯¹äºä»»ä½• Service/Endpoint æ›´æ–°ï¼Œç›¸åº”åœ°æ›´æ”¹ &lt;code&gt;toy-proxy&lt;/code&gt; è¿æ¥è®¾ç½®&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¹äºæˆ‘ä»¬ä¸Šé¢çš„æµ‹è¯•åº”ç”¨ &lt;code&gt;webapp&lt;/code&gt;ï¼Œæ•°æ®æµç¨‹å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-userspace-proxier&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;userspace-proxier&#34; srcset=&#34;
               /blog/k8s-node-proxy/proxy_userspace-proxier_hu16646697825184275106.webp 400w,
               /blog/k8s-node-proxy/proxy_userspace-proxier_hu4799029571535232269.webp 760w,
               /blog/k8s-node-proxy/proxy_userspace-proxier_hu4636100371206998633.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/k8s-node-proxy/proxy_userspace-proxier_hu16646697825184275106.webp&#34;
               width=&#34;760&#34;
               height=&#34;477&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      userspace-proxier
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;poc-å®ç°&#34;&gt;POC å®ç°&lt;/h3&gt;
&lt;p&gt;è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸Šå›¾çš„æ¦‚å¿µéªŒè¯å®ç°ã€‚&lt;/p&gt;
&lt;h4 id=&#34;ä»£ç &#34;&gt;ä»£ç &lt;/h4&gt;
&lt;p&gt;ä»¥ä¸‹ä»£ç çœç•¥äº†ä¸€äº›é”™è¯¯å¤„ç†ä»£ç ï¼Œä¾¿äºé˜…è¯»ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-golang&#34; data-lang=&#34;golang&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;clusterIP&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;10.7.111.132&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;podIP&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;10.5.41.204&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;port&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;80&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;proto&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;tcp&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nf&#34;&gt;addRedirectRules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;clusterIP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proto&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nf&#34;&gt;createProxy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;podIP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proto&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;addRedirectRules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;clusterIP&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;port&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proto&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strconv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Itoa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;cmd&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;iptables&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;-t&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;nat&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;-A&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;OUTPUT&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;-p&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;tcp&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;s&#34;&gt;&amp;#34;-d&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;clusterIP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;--dport&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;-j&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;REDIRECT&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;--to-port&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cmd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;createProxy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;podIP&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;port&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;proto&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;host&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Listen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;proto&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;JoinHostPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strconv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Itoa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;inConn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Accept&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;outConn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Dial&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;proto&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;JoinHostPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;podIP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strconv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Itoa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;in&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TCPConn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;WaitGroup&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Proxying %v &amp;lt;-&amp;gt; %v &amp;lt;-&amp;gt; %v &amp;lt;-&amp;gt; %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;in&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RemoteAddr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;in&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LocalAddr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LocalAddr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RemoteAddr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;copyBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;in&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;copyBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;in&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inConn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TCPConn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;outConn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TCPConn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;copyBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;dst&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;src&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TCPConn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;WaitGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Done&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;io&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;dst&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;src&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HasSuffix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;use of closed network connection&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;io.Copy error: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;dst&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;src&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;ä¸€äº›è§£é‡Š&#34;&gt;ä¸€äº›è§£é‡Š&lt;/h4&gt;
&lt;h5 id=&#34;traffic-æ‹¦æˆª&#34;&gt;traffic æ‹¦æˆª&lt;/h5&gt;
&lt;p&gt;æˆ‘ä»¬æƒ³æ‹¦æˆªæ‰€æœ‰å‘å¾€ &lt;code&gt;ClusterIP:Port&lt;/code&gt; çš„æµé‡ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Šä»»ä½•è®¾å¤‡éƒ½æ²¡æœ‰é…ç½®&lt;code&gt;ClusterIP&lt;/code&gt;ï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•æ‰§è¡Œè¯¸å¦‚ listenï¼ˆClusterIPï¼ŒPortï¼‰ä¹‹ç±»çš„æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•æ‰èƒ½æ‹¦æˆªå‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šä½¿ç”¨&lt;code&gt;iptables/netfilter&lt;/code&gt; æä¾›çš„ &lt;code&gt;REDIRECT&lt;/code&gt; èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹å‘½ä»¤ä¼šå°†æ‰€æœ‰å‘å¾€ &lt;code&gt;ClusterIP:Port&lt;/code&gt; çš„æµé‡å®šå‘åˆ° &lt;code&gt;localhost:Port&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sudo iptables -t nat -A OUTPUT -p tcp -d &lt;span class=&#34;nv&#34;&gt;$CLUSTER_IP&lt;/span&gt; --dport &lt;span class=&#34;nv&#34;&gt;$PORT&lt;/span&gt; -j REDIRECT --to-port &lt;span class=&#34;nv&#34;&gt;$PORT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœä½ ç°åœ¨ä¸èƒ½ç†è§£è¿™ä¸€ç‚¹ï¼Œä¸è¦å®³æ€•ã€‚ç¨åæˆ‘ä»¬å°†è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡ä¸‹é¢å‘½ä»¤çš„è¾“å‡ºæ¥éªŒè¯è¿™ä¸€ç‚¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -t nat -L -n
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain OUTPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;      destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;REDIRECT   tcp  --  0.0.0.0/0   10.7.111.132         tcp dpt:80 redir ports &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ä»£ç ä¸­ï¼Œå‡½æ•° &lt;code&gt;addRedirectRules()&lt;/code&gt; åŒ…è£…äº†ä¸Šè¿°è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h5 id=&#34;åˆ›å»º-proxy&#34;&gt;åˆ›å»º proxy&lt;/h5&gt;
&lt;p&gt;å‡½æ•° &lt;code&gt;createProxy()&lt;/code&gt; åˆ›å»ºç”¨æˆ·ç©ºé—´ä»£ç†ï¼Œå¹¶æ‰§è¡ŒåŒå‘è½¬å‘ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å¯è¾¾æ€§æµ‹è¯•-1&#34;&gt;å¯è¾¾æ€§æµ‹è¯•&lt;/h4&gt;
&lt;p&gt;ç¼–è¯‘ä»£ç å¹¶æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ go build toy-proxy-userspace.go
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sudo ./toy-proxy-userspace
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨æµ‹è¯•è®¿é—®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl &lt;span class=&#34;nv&#34;&gt;$CLUSTER_IP&lt;/span&gt;:&lt;span class=&#34;nv&#34;&gt;$PORT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;!DOCTYPE html&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;/html&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆåŠŸï¼æˆ‘ä»¬çš„ä»£ç†ä¼ è¾¾çš„ä¿¡æ¯æ˜¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sudo ./toy-proxy-userspace
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Creating proxy between &amp;lt;host ip&amp;gt;:53912 &amp;lt;-&amp;gt; 127.0.0.1:80 &amp;lt;-&amp;gt; &amp;lt;host ip&amp;gt;:40194 &amp;lt;-&amp;gt; 10.5.41.204:80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¡¨ç¤ºï¼Œå¯¹äºåŸ &lt;code&gt;&amp;lt;host ip&amp;gt;:53912 &amp;lt;-&amp;gt; 10.7.111.132:80&lt;/code&gt; çš„è¿æ¥è¯·æ±‚ï¼Œå°†å…¶æ‹†åˆ†ä¸ºä¸¤ä¸ªè¿æ¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;host ip&amp;gt;:53912 &amp;lt;-&amp;gt; 127.0.0.1:80&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;host ip&amp;gt;:40194 &amp;lt;-&amp;gt; 10.5.41.204:80&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åˆ é™¤è¿™æ¡è§„åˆ™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -t nat -L -n --line-numbers
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain OUTPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;num  target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;    REDIRECT   tcp  --  0.0.0.0/0   10.7.111.132         tcp dpt:80 redir ports &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# iptables -t nat -D OUTPUT &amp;lt;num&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -t nat -D OUTPUT &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ–è€…åˆ é™¤ï¼ˆåˆ·æ–°ï¼‰æ‰€æœ‰è§„åˆ™ï¼Œå¦‚æœä½ æŠŠ iptabels å¼„çš„ä¸€å›¢ç³Ÿçš„æƒ…å†µä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -t nat -F &lt;span class=&#34;c1&#34;&gt;# delete all rules&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -t nat -X &lt;span class=&#34;c1&#34;&gt;# delete all custom chains&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;æ”¹è¿›&#34;&gt;æ”¹è¿›&lt;/h4&gt;
&lt;p&gt;åœ¨è¿™ä¸ª &lt;code&gt;toy-proxy&lt;/code&gt; å®ç°ä¸­ï¼Œæˆ‘ä»¬æ‹¦æˆªäº† &lt;code&gt;ClusterIP:80&lt;/code&gt; åˆ° &lt;code&gt;localhost:80&lt;/code&gt;ï¼Œä½†æ˜¯å¦‚æœè¯¥ä¸»æœºä¸Šçš„æœ¬æœºåº”ç”¨ç¨‹åºä¹Ÿæƒ³ä½¿ç”¨ &lt;code&gt;localhost:80&lt;/code&gt; æ€ä¹ˆåŠï¼Ÿæ­¤å¤–ï¼Œå¦‚æœå¤šä¸ªæœåŠ¡éƒ½å…¬å¼€ 80 ç«¯å£ä¼šæ€æ ·ï¼Ÿæ˜¾ç„¶ï¼Œæˆ‘ä»¬éœ€è¦åŒºåˆ†è¿™äº›åº”ç”¨ç¨‹åºæˆ–æœåŠ¡ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„æ­£ç¡®æ–¹æ³•æ˜¯ï¼šä¸ºæ¯ä¸ªä»£ç†åˆ†é…ä¸€ä¸ªæœªä½¿ç”¨çš„ä¸´æ—¶ç«¯å£ TmpPortï¼Œæ‹¦æˆª &lt;code&gt;ClusterIP:Port&lt;/code&gt; åˆ° &lt;code&gt;local:TmpPort&lt;/code&gt;ã€‚ä¾‹å¦‚ï¼Œapp1 ä½¿ç”¨ 10001, app2 ä½¿ç”¨ 10002ã€‚&lt;/p&gt;
&lt;p&gt;å…¶æ¬¡ï¼Œä¸Šé¢çš„ä»£ç åªå¤„ç†ä¸€ä¸ªåç«¯ï¼Œå¦‚æœæœ‰å¤šä¸ªåç«¯ pod æ€ä¹ˆåŠï¼Ÿå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡è´Ÿè½½å‡è¡¡ç®—æ³•å°†è¯·æ±‚åˆ†å‘åˆ°ä¸åŒçš„åç«¯ podã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-userspace-proxier-2&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;userspace-proxier-2&#34; srcset=&#34;
               /blog/k8s-node-proxy/proxy_userspace-proxier-2_hu9056754510759284500.webp 400w,
               /blog/k8s-node-proxy/proxy_userspace-proxier-2_hu16376695801191297477.webp 760w,
               /blog/k8s-node-proxy/proxy_userspace-proxier-2_hu4847877466195675373.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/k8s-node-proxy/proxy_userspace-proxier-2_hu9056754510759284500.webp&#34;
               width=&#34;760&#34;
               height=&#34;477&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      userspace-proxier-2
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h4 id=&#34;ä¼˜ç¼ºç‚¹&#34;&gt;ä¼˜ç¼ºç‚¹&lt;/h4&gt;
&lt;p&gt;è¿™ç§æ–¹æ³•éå¸¸å®¹æ˜“ç†è§£å’Œå®ç°ï¼Œä½†æ˜¯ï¼Œå®ƒçš„æ€§èƒ½ä¼šå¾ˆå·®ï¼Œå› ä¸ºå®ƒå¿…é¡»åœ¨ä¸¤ç«¯ä»¥åŠå†…æ ¸å’Œç”¨æˆ·ç©ºé—´å†…å­˜ä¹‹é—´å¤åˆ¶å­—èŠ‚ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ²¡æœ‰åœ¨è¿™ä¸Šé¢èŠ±å¤ªå¤šæ—¶é—´ï¼Œå¦‚æœä½ æ„Ÿå…´è¶£ï¼Œå¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹ç”¨æˆ·ç©ºé—´ &lt;code&gt;kube-proxy&lt;/code&gt; çš„ç®€å•å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å®ç°è¿™ä¸ªä»»åŠ¡çš„å¦ä¸€ç§æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®ç°é€šè¿‡-iptables-å®ç°-proxy&#34;&gt;å®ç°ï¼šé€šè¿‡ iptables å®ç° proxy&lt;/h2&gt;
&lt;p&gt;ç”¨æˆ·ç©ºé—´ä»£ç†ç¨‹åºçš„ä¸»è¦ç“¶é¢ˆæ¥è‡ªå†…æ ¸ - ç”¨æˆ·ç©ºé—´åˆ‡æ¢å’Œæ•°æ®å¤åˆ¶ã€‚&lt;strong&gt;å¦‚æœæˆ‘ä»¬å¯ä»¥å®Œå…¨åœ¨å†…æ ¸ç©ºé—´ä¸­å®ç°ä»£ç†&lt;/strong&gt;ï¼Œå®ƒå°†åœ¨æ€§èƒ½ä¸Šå¤§å¤§æé«˜ï¼Œä»è€Œå‡»è´¥ç”¨æˆ·ç©ºé—´çš„ä»£ç†ã€‚&lt;code&gt;iptables&lt;/code&gt; å¯ç”¨äºå®ç°è¿™ä¸€ç›®æ ‡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å¼€å§‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬é¦–å…ˆå¼„æ¸…æ¥šåœ¨æ‰§è¡Œ &lt;code&gt;curl ClusterIP:Port&lt;/code&gt; æ—¶çš„æµé‡è·¯å¾„ï¼Œç„¶åç ”ç©¶å¦‚ä½•ä½¿ç”¨ &lt;code&gt;iptables&lt;/code&gt; è§„åˆ™ä½¿å…¶å¯è®¿é—®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;host---clusteripå•ä¸€åç«¯&#34;&gt;Host -&amp;gt; ClusterIPï¼ˆå•ä¸€åç«¯ï¼‰&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;ClusterIP&lt;/code&gt; ä¸å­˜åœ¨äºä»»ä½•ç½‘ç»œè®¾å¤‡ä¸Šï¼Œæ‰€ä»¥ä¸ºäº†è®©æˆ‘ä»¬çš„æ•°æ®åŒ…æœ€ç»ˆåˆ°è¾¾åç«¯ Podï¼Œæˆ‘ä»¬éœ€è¦å°† &lt;code&gt;ClusterIP&lt;/code&gt; è½¬æ¢ä¸º PodIPï¼ˆå¯è·¯ç”±ï¼‰ï¼Œå³ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¡ä»¶ï¼šåŒ¹é… &lt;code&gt;dst=ClusterIP,proto=tcp,dport=80&lt;/code&gt; çš„æ•°æ®åŒ…&lt;/li&gt;
&lt;li&gt;æ“ä½œï¼šå°†æ•°æ®åŒ…çš„ IP æŠ¥å¤´ä¸­çš„ &lt;code&gt;dst=ClusterIP&lt;/code&gt; æ›¿æ¢ä¸º &lt;code&gt;dst=PodIP&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”¨ç½‘ç»œæœ¯è¯­æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªç½‘ç»œåœ°å€è½¬æ¢ (NAT) è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h4 id=&#34;åœ¨å“ªé‡Œåš-dnat&#34;&gt;åœ¨å“ªé‡Œåš DNAT&lt;/h4&gt;
&lt;p&gt;é€šè¿‡ curl æŸ¥çœ‹å‡ºå£æ•°æ®åŒ…è·¯å¾„ï¼ˆä¸‹å›¾å±•ç¤ºäº†æ•°æ®æµå‘è¿‡ç¨‹ï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-host-to-clusterip-dnat&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;host-to-clusterip-dnat&#34; srcset=&#34;
               /blog/k8s-node-proxy/proxy_host-to-clusterip-dnat_hu15521898331386684230.webp 400w,
               /blog/k8s-node-proxy/proxy_host-to-clusterip-dnat_hu9460590773386704000.webp 760w,
               /blog/k8s-node-proxy/proxy_host-to-clusterip-dnat_hu14946257083914344153.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/k8s-node-proxy/proxy_host-to-clusterip-dnat_hu15521898331386684230.webp&#34;
               width=&#34;760&#34;
               height=&#34;454&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      host-to-clusterip-dnat
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;curl process&amp;gt; -&amp;gt; raw -&amp;gt; CT -&amp;gt; mangle -&amp;gt; dnat -&amp;gt; filter -&amp;gt; security -&amp;gt; snat -&amp;gt; &amp;lt;ROUTING&amp;gt; -&amp;gt; mangle -&amp;gt; snat -&amp;gt; NIC
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¾ˆæ˜æ˜¾ï¼Œåœ¨ OUTPUT é’©ä¸­åªæœ‰ä¸€ä¸ª dnatï¼ˆé“¾ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­è¿›è¡Œ DNATã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬å°†å¦‚ä½•è¿›è¡Œé»‘å®¢å…¥ä¾µã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ£€æŸ¥å½“å‰çš„-nat-è§„åˆ™&#34;&gt;æ£€æŸ¥å½“å‰çš„ NAT è§„åˆ™&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;NAT&lt;/code&gt; è§„åˆ™è¢«ç»„ç»‡åˆ° &lt;code&gt;nat&lt;/code&gt; è¡¨ä¸­ã€‚æ£€æŸ¥ &lt;code&gt;nat&lt;/code&gt; è¡¨ä¸­çš„å½“å‰è§„åˆ™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# -t &amp;lt;table&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# -L list rules&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# -n numeric output&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -t nat -L -n
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain PREROUTING &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain INPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain OUTPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DOCKER     all  --  0.0.0.0/0    !127.0.0.0/8   ADDRTYPE match dst-type LOCAL
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain POSTROUTING &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¾“å‡ºæ˜¾ç¤ºé™¤äº†ä¸ DOCKER ç›¸å…³çš„è§„åˆ™å¤–ï¼Œæ²¡æœ‰å…¶ä»–è§„åˆ™ã€‚è¿™äº› DOCKER è§„åˆ™æ˜¯ DOCKER åœ¨å®‰è£…æ—¶æ’å…¥çš„ï¼Œä½†å®ƒä»¬ä¸ä¼šå½±å“æˆ‘ä»¬åœ¨è¿™ç¯‡æ–‡ç« ä¸­çš„å®éªŒã€‚æ‰€ä»¥æˆ‘ä»¬å¿½ç•¥å®ƒä»¬ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å¢åŠ -dnat-è§„åˆ™&#34;&gt;å¢åŠ  DNAT è§„åˆ™&lt;/h4&gt;
&lt;p&gt;ä¸ºäº†ä¾¿äºæŸ¥çœ‹ï¼Œæˆ‘ä»¬ä¸ä¼šç”¨ go ä»£ç åŒ…è£… &lt;code&gt;iptables&lt;/code&gt; å‘½ä»¤ï¼Œè€Œæ˜¯ç›´æ¥æ˜¾ç¤ºå‘½ä»¤æœ¬èº«ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„ï¼šåœ¨ç»§ç»­ä¹‹å‰ï¼Œè¯·ç¡®ä¿åˆ é™¤äº†åœ¨ä¸Šä¸€èŠ‚ä¸­æ·»åŠ çš„æ‰€æœ‰è§„åˆ™ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç¡®è®¤ç›®å‰æ— æ³•è®¿é—® ClusterIPï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl &lt;span class=&#34;nv&#34;&gt;$CLUSTER_IP&lt;/span&gt;:&lt;span class=&#34;nv&#34;&gt;$PORT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;^C
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨æ·»åŠ æˆ‘ä»¬çš„å‡ºå£ NAT è§„åˆ™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cat ENV
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;CLUSTER_IP&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;10.7.111.132
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;POD_IP&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;10.5.41.204
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;PORT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;PROTO&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;tcp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# -p               &amp;lt;protocol&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# -A               add rule&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# --dport          &amp;lt;dst port&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# -d               &amp;lt;dst ip&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# -j               jump to&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# --to-destination &amp;lt;ip&amp;gt;:&amp;lt;port&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -t nat -A OUTPUT -p &lt;span class=&#34;nv&#34;&gt;$PROTO&lt;/span&gt; --dport &lt;span class=&#34;nv&#34;&gt;$PORT&lt;/span&gt; -d &lt;span class=&#34;nv&#34;&gt;$CLUSTER_IP&lt;/span&gt; -j DNAT --to-destination &lt;span class=&#34;nv&#34;&gt;$POD_IP&lt;/span&gt;:&lt;span class=&#34;nv&#34;&gt;$PORT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†æ¬¡æ£€æŸ¥è§„åˆ™è¡¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -t nat -L -n
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain OUTPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;      destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DNAT       tcp  --  0.0.0.0/0   10.7.111.132   tcp dpt:80 to:10.5.41.204:80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è§„åˆ™å·²ç»è¢«æ·»åŠ ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æµ‹è¯•å¯è¾¾æ€§&#34;&gt;æµ‹è¯•å¯è¾¾æ€§&lt;/h4&gt;
&lt;p&gt;ç°åœ¨å†ä¸€æ¬¡è®¿é—®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl &lt;span class=&#34;nv&#34;&gt;$CLUSTER_IP&lt;/span&gt;:&lt;span class=&#34;nv&#34;&gt;$PORT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;!DOCTYPE html&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;/html&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°±æ˜¯è¿™æ ·ï¼è®¿é—®æˆåŠŸã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ç­‰ç­‰ï¼æˆ‘ä»¬æœŸæœ›å‡ºå£çš„äº¤é€šåº”è¯¥æ˜¯æ­£ç¡®çš„ï¼Œä½†æˆ‘ä»¬æ²¡æœ‰æ·»åŠ ä»»ä½• NAT è§„åˆ™çš„å…¥å£è·¯å¾„ï¼Œæ€ä¹ˆå¯èƒ½äº¤é€šæ˜¯æ­£å¸¸çš„ä¸¤ä¸ªæ–¹å‘ï¼Ÿäº‹å®è¯æ˜ï¼Œå½“ä½ ä¸ºä¸€ä¸ªæ–¹å‘æ·»åŠ ä¸€ä¸ª NAT è§„åˆ™æ—¶ï¼ŒLinux å†…æ ¸ä¼šè‡ªåŠ¨ä¸ºå¦ä¸€ä¸ªæ–¹å‘æ·»åŠ ä¿ç•™è§„åˆ™ï¼è¿™ä¸ conntrack (CTï¼Œè¿æ¥è·Ÿè¸ªï¼‰æ¨¡å—ååŒå·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-host-to-clusterip-dnat-ct&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;host-to-clusterip-dnat-ct&#34; srcset=&#34;
               /blog/k8s-node-proxy/proxy_host-to-clusterip-dnat-ct_hu15764346066960949968.webp 400w,
               /blog/k8s-node-proxy/proxy_host-to-clusterip-dnat-ct_hu12613674374887565743.webp 760w,
               /blog/k8s-node-proxy/proxy_host-to-clusterip-dnat-ct_hu7987959470077778126.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/k8s-node-proxy/proxy_host-to-clusterip-dnat-ct_hu15764346066960949968.webp&#34;
               width=&#34;760&#34;
               height=&#34;454&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      host-to-clusterip-dnat-ct
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h4 id=&#34;æ¸…ç†&#34;&gt;æ¸…ç†&lt;/h4&gt;
&lt;p&gt;åˆ é™¤è¿™äº›è§„åˆ™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -t nat -L -n --line-numbers
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain OUTPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;num  target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;    DNAT       tcp  --  0.0.0.0/0   10.7.111.132   tcp dpt:80 to:10.5.41.204:80
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# iptables -t &amp;lt;table&amp;gt; -D &amp;lt;chain&amp;gt; &amp;lt;num&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -t nat -D OUTPUT &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;host---clusteripå¤šä¸ªåç«¯&#34;&gt;Host -&amp;gt; ClusterIPï¼ˆå¤šä¸ªåç«¯ï¼‰&lt;/h3&gt;
&lt;p&gt;åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ä¸€ä¸ªåç«¯ Pod æ‰§è¡Œ NATã€‚ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å¤šåç«¯æƒ…å†µã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„ï¼šåœ¨ç»§ç»­ä¹‹å‰ï¼Œè¯·ç¡®ä¿åˆ é™¤äº†åœ¨ä¸Šä¸€èŠ‚ä¸­æ·»åŠ çš„æ‰€æœ‰è§„åˆ™ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;ä¼¸ç¼©-webapp&#34;&gt;ä¼¸ç¼© webapp&lt;/h4&gt;
&lt;p&gt;é¦–å…ˆæ‰©å¤§æˆ‘ä»¬çš„æœåŠ¡åˆ° 2 ä¸ªåç«¯ pod:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl scale sts webapp --replicas&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;statefulset.apps/webapp scaled
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get pod -o wide &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep webapp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;webapp-0   2/2     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;   1h24m   10.5.41.204    node1    &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;webapp-1   2/2     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;   11s     10.5.41.5      node1    &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;é€šè¿‡è´Ÿè½½å¹³è¡¡æ·»åŠ -dnat-è§„åˆ™&#34;&gt;é€šè¿‡è´Ÿè½½å¹³è¡¡æ·»åŠ  DNAT è§„åˆ™&lt;/h4&gt;
&lt;p&gt;æˆ‘ä»¬éœ€è¦ &lt;code&gt;iptables&lt;/code&gt; ä¸­çš„ &lt;code&gt;statistic&lt;/code&gt; æ¨¡å—ä»¥æ¦‚ç‡çš„æ–¹å¼å°†è¯·æ±‚åˆ†å‘åˆ°åç«¯ podï¼Œè¿™æ ·æ‰èƒ½è¾¾åˆ°è´Ÿè½½å‡è¡¡çš„æ•ˆæœï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# -m &amp;lt;module&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -t nat -A OUTPUT -p &lt;span class=&#34;nv&#34;&gt;$PROTO&lt;/span&gt; --dport &lt;span class=&#34;nv&#34;&gt;$PORT&lt;/span&gt; -d &lt;span class=&#34;nv&#34;&gt;$CLUSTER_IP&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -m statistic --mode random --probability 0.5  &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -j DNAT --to-destination &lt;span class=&#34;nv&#34;&gt;$POD1_IP&lt;/span&gt;:&lt;span class=&#34;nv&#34;&gt;$PORT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -t nat -A OUTPUT -p &lt;span class=&#34;nv&#34;&gt;$PROTO&lt;/span&gt; --dport &lt;span class=&#34;nv&#34;&gt;$PORT&lt;/span&gt; -d &lt;span class=&#34;nv&#34;&gt;$CLUSTER_IP&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -m statistic --mode random --probability 1.0  &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    -j DNAT --to-destination &lt;span class=&#34;nv&#34;&gt;$POD2_IP&lt;/span&gt;:&lt;span class=&#34;nv&#34;&gt;$PORT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢çš„å‘½ä»¤æŒ‡å®šåœ¨ä¸¤ä¸ª pod ä¹‹é—´éšæœºåˆ†é…è¯·æ±‚ï¼Œæ¯ä¸ªéƒ½æœ‰ 50% çš„æ¦‚ç‡ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨æ£€æŸ¥è¿™äº›è§„åˆ™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -t nat -L -n
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain OUTPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;target  prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;      destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DNAT    tcp  --  0.0.0.0/0   10.7.111.132  tcp dpt:80 statistic mode random probability 0.50000000000 to:10.5.41.204:80
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DNAT    tcp  --  0.0.0.0/0   10.7.111.132  tcp dpt:80 statistic mode random probability 1.00000000000 to:10.5.41.5:80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;















&lt;figure  id=&#34;figure-host-to-clusterip-lb-ct&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;host-to-clusterip-lb-ct&#34; srcset=&#34;
               /blog/k8s-node-proxy/proxy_host-to-clusterip-lb-ct_hu15456537130159766436.webp 400w,
               /blog/k8s-node-proxy/proxy_host-to-clusterip-lb-ct_hu5984122934329609534.webp 760w,
               /blog/k8s-node-proxy/proxy_host-to-clusterip-lb-ct_hu18394521068809989649.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/k8s-node-proxy/proxy_host-to-clusterip-lb-ct_hu15456537130159766436.webp&#34;
               width=&#34;760&#34;
               height=&#34;454&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      host-to-clusterip-lb-ct
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h4 id=&#34;éªŒè¯&#34;&gt;éªŒè¯&lt;/h4&gt;
&lt;p&gt;ç°åœ¨ï¼Œæˆ‘ä»¬æ¥éªŒè¯ä¸‹è´Ÿè½½å‡è¡¡æ˜¯å¦ç”Ÿæ•ˆã€‚æˆ‘ä»¬å‘å‡º 8 ä¸ª è¯·æ±‚ï¼Œå¹¶æ•è·åˆ°è¿™ä¸ªä¸»æœºé€šä¿¡çš„çœŸå® PodIPs:&lt;/p&gt;
&lt;p&gt;åœ¨æµ‹è¯•èŠ‚ç‚¹ä¸Šæ‰“å¼€ä¸€ä¸ª shell:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; i in &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;1..8&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; curl &lt;span class=&#34;nv&#34;&gt;$CLUSTER_IP&lt;/span&gt;:&lt;span class=&#34;nv&#34;&gt;$PORT&lt;/span&gt; 2&amp;gt;&lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &amp;gt;/dev/null&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; sleep 1&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æµ‹è¯•èŠ‚ç‚¹ä¸Šçš„å¦ä¸€ä¸ª shell çª—å£ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ tcpdump -nn -i eth0 port &lt;span class=&#34;nv&#34;&gt;$PORT&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep &lt;span class=&#34;s2&#34;&gt;&amp;#34;GET /&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;10.21.0.7.48306 &amp;gt; 10.5.41.5.80:   ... HTTP: GET / HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;10.21.0.7.48308 &amp;gt; 10.5.41.204.80: ... HTTP: GET / HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;10.21.0.7.48310 &amp;gt; 10.5.41.204.80: ... HTTP: GET / HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;10.21.0.7.48312 &amp;gt; 10.5.41.5.80:   ... HTTP: GET / HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;10.21.0.7.48314 &amp;gt; 10.5.41.5.80:   ... HTTP: GET / HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;10.21.0.7.48316 &amp;gt; 10.5.41.204.80: ... HTTP: GET / HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;10.21.0.7.48318 &amp;gt; 10.5.41.5.80:   ... HTTP: GET / HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;10.21.0.7.48320 &amp;gt; 10.5.41.204.80: ... HTTP: GET / HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ Pod1 ä¸­æœ‰ 4 æ¬¡ï¼Œåœ¨ Pod2 ä¸­æœ‰ 4 æ¬¡ï¼Œæ¯ä¸ª pod æœ‰ 50%ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ¸…ç†-1&#34;&gt;æ¸…ç†&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -t nat -L -n --line-numbers
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain OUTPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;num  target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;    DNAT    tcp  --  0.0.0.0/0   10.7.111.132  tcp dpt:80 statistic mode random probability 0.50000000000 to:10.5.41.204:80
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;    DNAT    tcp  --  0.0.0.0/0   10.7.111.132  tcp dpt:80 statistic mode random probability 1.00000000000 to:10.5.41.5:80
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -t nat -D OUTPUT &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ iptables -t nat -D OUTPUT &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;pod-app-a---clusterip-app-b&#34;&gt;Pod (app A) -&amp;gt; ClusterIP (app B)&lt;/h3&gt;
&lt;p&gt;å¦‚æœæƒ³é€šè¿‡ hostA ä¸Šçš„ &lt;code&gt;Pod A&lt;/code&gt; é€šè¿‡ &lt;code&gt;ClusterIP&lt;/code&gt; è®¿é—® &lt;code&gt;Pod B&lt;/code&gt;ï¼ŒB çš„ Pod é©»ç•™åœ¨ hostB ä¸Šï¼Œæˆ‘ä»¬åº”è¯¥åšä»€ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;p&gt;å®é™…ä¸Šï¼Œè¿™ä¸ &lt;code&gt;Host -&amp;gt; ClusterIP&lt;/code&gt; æƒ…å†µéå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼šåœ¨æ‰§è¡Œ NAT ä¹‹åï¼ŒæºèŠ‚ç‚¹ (hostA) éœ€è¦å°†åŒ…å‘é€åˆ°ç›®çš„åœ° Pod æ‰€åœ¨çš„æ­£ç¡®ç›®çš„åœ°èŠ‚ç‚¹ (hostB)ã€‚æ ¹æ®ä¸åŒçš„è·¨ä¸»æœºç½‘ç»œè§£å†³æ–¹æ¡ˆï¼Œè¿™æœ‰å¾ˆå¤§ä¸åŒï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¯¹äºç›´æ¥è·¯ç”±çš„æƒ…å†µä¸‹ï¼Œä¸»æœºåªæ˜¯å‘é€æ•°æ®åŒ…ã€‚å¯¹åº”çš„æœ‰è¿™äº›è§£å†³æ–¹æ¡ˆï¼š
&lt;ul&gt;
&lt;li&gt;calico + bird&lt;/li&gt;
&lt;li&gt;cilium + kube-routerï¼ˆCilium BGP çš„é»˜è®¤è§£å†³æ–¹æ¡ˆï¼‰&lt;/li&gt;
&lt;li&gt;cilium + birdï¼ˆå®é™…ä¸Šè¿™åªæ˜¯æˆ‘ä»¬çš„æµ‹è¯•ç¯å¢ƒç½‘ç»œè§£å†³æ–¹æ¡ˆï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¯¹äºéš§é“çš„æƒ…å†µï¼Œæ¯ä¸ªä¸»æœºä¸Šå¿…é¡»æœ‰ä¸€ä¸ªä»£ç†ï¼Œå®ƒåœ¨ DNAT ä¹‹åæ‰§è¡Œ encapï¼Œåœ¨ SNAT ä¹‹å‰æ‰§è¡Œ decapã€‚è¿™äº›è§£å†³æ–¹æ¡ˆåŒ…æ‹¬ï¼š
&lt;ul&gt;
&lt;li&gt;calico + VxLAN æ¨¡å¼&lt;/li&gt;
&lt;li&gt;flannel + IPIP æ¨¡å¼&lt;/li&gt;
&lt;li&gt;flannel + VxLAN æ¨¡å¼&lt;/li&gt;
&lt;li&gt;cilium + VxLAN æ¨¡å¼&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åƒ aws çš„ ENI æ¨¡å¼ï¼šç±»ä¼¼äºç›´æ¥è·¯ç”±ï¼Œä½†ä¸éœ€è¦ BGP ä»£ç†
&lt;ul&gt;
&lt;li&gt;cilium + ENI æ¨¡å¼&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº†éš§é“çš„æƒ…å†µï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-tunneling&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;tunneling&#34; srcset=&#34;
               /blog/k8s-node-proxy/proxy_tunneling_hu15501064366038255698.webp 400w,
               /blog/k8s-node-proxy/proxy_tunneling_hu17919711343941952749.webp 760w,
               /blog/k8s-node-proxy/proxy_tunneling_hu11276063665444233148.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/k8s-node-proxy/proxy_tunneling_hu15501064366038255698.webp&#34;
               width=&#34;760&#34;
               height=&#34;353&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      tunneling
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä»£ç†ä¸éš§é“ç›¸å…³çš„èŒè´£åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŒæ­¥æ‰€æœ‰èŠ‚ç‚¹ä¹‹é—´çš„éš§é“ä¿¡æ¯&lt;/strong&gt;ï¼Œä¾‹å¦‚æè¿°å“ªä¸ªå®ä¾‹åœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šçš„ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åœ¨ DNAT ä¹‹åå¯¹ pod æµé‡æ‰§è¡Œå°è£…&lt;/strong&gt;ï¼šå¯¹äºæ‰€æœ‰çš„å‡ºå£æµé‡ï¼Œä¾‹å¦‚æ¥è‡ª hostA çš„ &lt;code&gt;dst=&amp;lt;PodIP&amp;gt;&lt;/code&gt;ï¼Œå…¶ä¸­ PodIP åœ¨ hostB ä¸Šï¼Œé€šè¿‡æ·»åŠ å¦ä¸€ä¸ªå¤´æ¥å°è£…æ•°æ®åŒ…ï¼Œä¾‹å¦‚ VxLAN å¤´ï¼Œå…¶ä¸­å°è£…å¤´æœ‰ &lt;code&gt;src=hostA_IP,dst=hostB_IP&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åœ¨ SNAT ä¹‹å‰å¯¹ Pod æµé‡æ‰§è¡Œè§£å°è£…&lt;/strong&gt;ï¼šè§£å°è£…æ¯ä¸ªå…¥å£å°è£…çš„æ•°æ®åŒ…ï¼šåˆ é™¤å¤–å±‚ï¼ˆä¾‹å¦‚ VxLAN æ ‡å¤´ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åŒæ—¶ï¼Œä¸»æœºéœ€è¦å†³å®šï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å“ªäº›æ•°æ®åŒ…åº”è¯¥äº¤ç»™è§£ç å™¨ï¼ˆpod æµé‡ï¼‰ï¼Œå“ªäº›ä¸åº”è¯¥ï¼ˆä¾‹å¦‚ä¸»æœºæµé‡ï¼‰&lt;/li&gt;
&lt;li&gt;å“ªäº›åŒ…åº”è¯¥å°è£…ï¼ˆpod æµé‡ï¼‰ï¼Œå“ªäº›ä¸åº”è¯¥ï¼ˆä¾‹å¦‚ä¸»æœºæµé‡ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;é‡æ–°æ„é€ -iptables-è§„åˆ™&#34;&gt;é‡æ–°æ„é€  iptables è§„åˆ™&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„ï¼šåœ¨ç»§ç»­ä¹‹å‰ï¼Œè¯·ç¡®ä¿åˆ é™¤äº†åœ¨ä¸Šä¸€èŠ‚ä¸­æ·»åŠ çš„æ‰€æœ‰è§„åˆ™ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å½“ä½ æœ‰å¤§é‡çš„ Service æ—¶ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„ iptables è§„åˆ™å°†ç›¸å½“å¤æ‚ï¼Œå› æ­¤ä½ éœ€è¦è¿›è¡Œä¸€äº›ç»“æ„åŒ–å·¥ä½œæ¥ç»„ç»‡è¿™äº›è§„åˆ™ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨ nat è¡¨ä¸­åˆ›å»ºå‡ ä¸ªä¸“ç”¨çš„ iptables é“¾ï¼Œå…·ä½“å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é“¾ &lt;code&gt;KUBE-SERVICES&lt;/code&gt;ï¼šæ‹¦æˆª nat è¡¨çš„è¾“å‡ºé“¾ä¸­æ‰€æœ‰åˆ°æ­¤é“¾çš„å‡ºå£æµé‡ï¼Œå¦‚æœå®ƒä»¬è¢«æŒ‡å®šä¸º ClusterIPï¼Œåˆ™æ‰§è¡Œ DNAT&lt;/li&gt;
&lt;li&gt;é“¾ &lt;code&gt;KUBE-SVC-WEBAPP&lt;/code&gt;ï¼šå¦‚æœ &lt;code&gt;dst&lt;/code&gt;ã€&lt;code&gt;proto&lt;/code&gt; å’Œ &lt;code&gt;port&lt;/code&gt; åŒ¹é…ï¼Œåˆ™æ‹¦æˆªè¯¥é“¾ &lt;code&gt;KUBE-SERVICES&lt;/code&gt; ä¸­çš„æ‰€æœ‰æµé‡&lt;/li&gt;
&lt;li&gt;é“¾ &lt;code&gt;KUBE-SEP-WEBAPP1&lt;/code&gt;ï¼šæ‹¦æˆª 50% çš„æµé‡åœ¨ &lt;code&gt;KUBE-SVC-WEBAPP&lt;/code&gt; åˆ°è¿™é‡Œ&lt;/li&gt;
&lt;li&gt;é“¾ &lt;code&gt;KUBE-SEP-WEBAPP2&lt;/code&gt;ï¼šæ‹¦æˆª 50% çš„æµé‡åœ¨ &lt;code&gt;KUBE-SVC-WEBAPP&lt;/code&gt; åˆ°è¿™é‡Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;DNAT è·¯å¾„ç°åœ¨ä¸ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;OUTPUT -&amp;gt; KUBE-SERVICES -&amp;gt; KUBE-SVC-WEBAPP --&amp;gt; KUBE-SEP-WEBAPP1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                         &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;                                          &lt;span class=&#34;se&#34;&gt;\-&lt;/span&gt;-&amp;gt; KUBE-SEP-WEBAPP2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœä½ æœ‰å¤šä¸ª Serviceï¼ŒDNAT è·¯å¾„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;OUTPUT -&amp;gt; KUBE-SERVICES -&amp;gt; KUBE-SVC-A --&amp;gt; KUBE-SEP-A1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;              &lt;span class=&#34;se&#34;&gt;\-&lt;/span&gt;-&amp;gt; KUBE-SEP-A2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;--&amp;gt; KUBE-SVC-B --&amp;gt; KUBE-SEP-B1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;              &lt;span class=&#34;se&#34;&gt;\-&lt;/span&gt;-&amp;gt; KUBE-SEP-B2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;--&amp;gt; KUBE-SVC-C --&amp;gt; KUBE-SEP-C1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                     &lt;span class=&#34;se&#34;&gt;\-&lt;/span&gt;-&amp;gt; KUBE-SEP-C2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;iptables å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cat add-dnat-structured.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt; ../ENV
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; -x
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;KUBE_SVCS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;KUBE-SERVICES&amp;#34;&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;# chain that serves as kubernetes service portal&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;SVC_WEBAPP&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;KUBE-SVC-WEBAPP&amp;#34;&lt;/span&gt;     &lt;span class=&#34;c1&#34;&gt;# chain that serves as DNAT entrypoint for webapp&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;WEBAPP_EP1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;KUBE-SEP-WEBAPP1&amp;#34;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;# chain that performs dnat to pod1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;WEBAPP_EP2&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;KUBE-SEP-WEBAPP2&amp;#34;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;# chain that performs dnat to pod2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# OUTPUT -&amp;gt; KUBE-SERVICES&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo iptables -t nat -N &lt;span class=&#34;nv&#34;&gt;$KUBE_SVCS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo iptables -t nat -A OUTPUT -p all -s 0.0.0.0/0 -d 0.0.0.0/0 -j &lt;span class=&#34;nv&#34;&gt;$KUBE_SVCS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# KUBE-SERVICES -&amp;gt; KUBE-SVC-WEBAPP&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo iptables -t nat -N &lt;span class=&#34;nv&#34;&gt;$SVC_WEBAPP&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo iptables -t nat -A &lt;span class=&#34;nv&#34;&gt;$KUBE_SVCS&lt;/span&gt; -p &lt;span class=&#34;nv&#34;&gt;$PROTO&lt;/span&gt; -s 0.0.0.0/0 -d &lt;span class=&#34;nv&#34;&gt;$CLUSTER_IP&lt;/span&gt; --dport &lt;span class=&#34;nv&#34;&gt;$PORT&lt;/span&gt; -j &lt;span class=&#34;nv&#34;&gt;$SVC_WEBAPP&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# KUBE-SVC-WEBAPP -&amp;gt; KUBE-SEP-WEBAPP*&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo iptables -t nat -N &lt;span class=&#34;nv&#34;&gt;$WEBAPP_EP1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo iptables -t nat -N &lt;span class=&#34;nv&#34;&gt;$WEBAPP_EP2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo iptables -t nat -A &lt;span class=&#34;nv&#34;&gt;$WEBAPP_EP1&lt;/span&gt; -p &lt;span class=&#34;nv&#34;&gt;$PROTO&lt;/span&gt; -s 0.0.0.0/0 -d 0.0.0.0/0 --dport &lt;span class=&#34;nv&#34;&gt;$PORT&lt;/span&gt; -j DNAT --to-destination &lt;span class=&#34;nv&#34;&gt;$POD1_IP&lt;/span&gt;:&lt;span class=&#34;nv&#34;&gt;$PORT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo iptables -t nat -A &lt;span class=&#34;nv&#34;&gt;$WEBAPP_EP2&lt;/span&gt; -p &lt;span class=&#34;nv&#34;&gt;$PROTO&lt;/span&gt; -s 0.0.0.0/0 -d 0.0.0.0/0 --dport &lt;span class=&#34;nv&#34;&gt;$PORT&lt;/span&gt; -j DNAT --to-destination &lt;span class=&#34;nv&#34;&gt;$POD2_IP&lt;/span&gt;:&lt;span class=&#34;nv&#34;&gt;$PORT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo iptables -t nat -A &lt;span class=&#34;nv&#34;&gt;$SVC_WEBAPP&lt;/span&gt; -p &lt;span class=&#34;nv&#34;&gt;$PROTO&lt;/span&gt; -s 0.0.0.0/0 -d 0.0.0.0/0 -m statistic --mode random --probability 0.5  -j &lt;span class=&#34;nv&#34;&gt;$WEBAPP_EP1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo iptables -t nat -A &lt;span class=&#34;nv&#34;&gt;$SVC_WEBAPP&lt;/span&gt; -p &lt;span class=&#34;nv&#34;&gt;$PROTO&lt;/span&gt; -s 0.0.0.0/0 -d 0.0.0.0/0 -m statistic --mode random --probability 1.0  -j &lt;span class=&#34;nv&#34;&gt;$WEBAPP_EP2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨æµ‹è¯•æˆ‘ä»¬è®¾è®¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ./add-dnat-structured.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;++ &lt;span class=&#34;nv&#34;&gt;KUBE_SVCS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;KUBE-SERVICES
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;++ &lt;span class=&#34;nv&#34;&gt;SVC_WEBAPP&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;KUBE-SVC-WEBAPP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;++ &lt;span class=&#34;nv&#34;&gt;WEBAPP_EP1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;KUBE-SEP-WEBAPP1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;++ &lt;span class=&#34;nv&#34;&gt;WEBAPP_EP2&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;KUBE-SEP-WEBAPP2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;++ sudo iptables -t nat -N KUBE-SERVICES
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;++ sudo iptables -t nat -A OUTPUT -p all -s 0.0.0.0/0 -d 0.0.0.0/0 -j KUBE-SERVICES
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;++ sudo iptables -t nat -N KUBE-SVC-WEBAPP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;++ sudo iptables -t nat -A KUBE-SERVICES -p tcp -s 0.0.0.0/0 -d 10.7.111.132 --dport &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt; -j KUBE-SVC-WEBAPP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;++ sudo iptables -t nat -N KUBE-SEP-WEBAPP1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;++ sudo iptables -t nat -N KUBE-SEP-WEBAPP2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;++ sudo iptables -t nat -A KUBE-SEP-WEBAPP1 -p tcp -s 0.0.0.0/0 -d 0.0.0.0/0 --dport &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt; -j DNAT --to-destination 10.5.41.204:80
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;++ sudo iptables -t nat -A KUBE-SEP-WEBAPP2 -p tcp -s 0.0.0.0/0 -d 0.0.0.0/0 --dport &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt; -j DNAT --to-destination 10.5.41.5:80
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;++ sudo iptables -t nat -A KUBE-SVC-WEBAPP -p tcp -s 0.0.0.0/0 -d 0.0.0.0/0 -m statistic --mode random --probability 0.5 -j KUBE-SEP-WEBAPP1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;++ sudo iptables -t nat -A KUBE-SVC-WEBAPP -p tcp -s 0.0.0.0/0 -d 0.0.0.0/0 -m statistic --mode random --probability 1.0 -j KUBE-SEP-WEBAPP2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ£€æŸ¥è¿™äº›è§„åˆ™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sudo iptables -t nat -L -n
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain OUTPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;KUBE-SERVICES  all  --  0.0.0.0/0            0.0.0.0/0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain KUBE-SEP-WEBAPP1 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DNAT       tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:80 to:10.5.41.204:80
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain KUBE-SEP-WEBAPP2 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DNAT       tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:80 to:10.5.41.5:80
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain KUBE-SERVICES &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;KUBE-SVC-WEBAPP  tcp  --  0.0.0.0/0            10.7.111.132         tcp dpt:80
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain KUBE-SVC-WEBAPP &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;target     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;KUBE-SEP-WEBAPP1  tcp  --  0.0.0.0/0            0.0.0.0/0            statistic mode random probability 0.50000000000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;KUBE-SEP-WEBAPP2  tcp  --  0.0.0.0/0            0.0.0.0/0            statistic mode random probability 1.00000000000
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl &lt;span class=&#34;nv&#34;&gt;$CLUSTER_IP&lt;/span&gt;:&lt;span class=&#34;nv&#34;&gt;$PORT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;!DOCTYPE html&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;/html&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆåŠŸï¼&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ å°†ä¸Šé¢çš„è¾“å‡ºä¸æ™®é€šçš„ &lt;code&gt;kube-proxy&lt;/code&gt; è§„åˆ™è¿›è¡Œæ¯”è¾ƒï¼Œè¿™ä¸¤ä¸ªè§„åˆ™æ˜¯éå¸¸ç›¸ä¼¼çš„ï¼Œä¸‹é¢æ˜¯ä»å¯ç”¨ &lt;code&gt;kube-proxy&lt;/code&gt; çš„èŠ‚ç‚¹æå–çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain OUTPUT &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;target         prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;KUBE-SERVICES  all  --  0.0.0.0/0            0.0.0.0/0            /* kubernetes service portals */
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain KUBE-SERVICES &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;target                     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;KUBE-SVC-YK2SNH4V42VSDWIJ  tcp  --  0.0.0.0/0            10.7.22.18           /* default/nginx:web cluster IP */ tcp dpt:80
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain KUBE-SVC-YK2SNH4V42VSDWIJ &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;target                     prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;KUBE-SEP-GL2BLSI2B4ICU6WH  all  --  0.0.0.0/0            0.0.0.0/0            /* default/nginx:web */ statistic mode random probability 0.33332999982
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;KUBE-SEP-AIRRSG3CIF42U3PX  all  --  0.0.0.0/0            0.0.0.0/0            /* default/nginx:web */
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain KUBE-SEP-GL2BLSI2B4ICU6WH &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;target          prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DNAT            tcp  --  0.0.0.0/0            0.0.0.0/0            /* default/nginx:web */ tcp to:10.244.3.181:80
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Chain KUBE-SEP-AIRRSG3CIF42U3PX &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; references&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;target          prot opt &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt;               destination
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DNAT            tcp  --  0.0.0.0/0            0.0.0.0/0            /* default/nginx:web */ tcp to:10.244.3.182:80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;è¿›ä¸€æ­¥é‡æ–°æ„é€ -iptables-è§„åˆ™&#34;&gt;è¿›ä¸€æ­¥é‡æ–°æ„é€  iptables è§„åˆ™&lt;/h3&gt;
&lt;p&gt;TODOï¼šä¸ºæ¥è‡ªé›†ç¾¤å¤–éƒ¨çš„æµé‡æ·»åŠ è§„åˆ™ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®ç°é€šè¿‡-ipvs-å®ç°-proxy&#34;&gt;å®ç°ï¼šé€šè¿‡ ipvs å®ç° proxy&lt;/h2&gt;
&lt;p&gt;è™½ç„¶åŸºäº iptables çš„ä»£ç†åœ¨æ€§èƒ½ä¸Šä¼˜äºåŸºäºç”¨æˆ·ç©ºé—´çš„ä»£ç†ï¼Œä½†åœ¨é›†ç¾¤æœåŠ¡è¿‡å¤šçš„æƒ…å†µä¸‹ä¹Ÿä¼šå¯¼è‡´æ€§èƒ½ä¸¥é‡ä¸‹é™ [6,7]ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬è´¨ä¸Šï¼Œè¿™æ˜¯å› ä¸º iptables åˆ¤å†³æ˜¯åŸºäºé“¾çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¤æ‚åº¦ä¸º O(n) çš„çº¿æ€§ç®—æ³•ã€‚iptables çš„ä¸€ä¸ªå¥½çš„æ›¿ä»£æ–¹æ¡ˆæ˜¯ IPVSâ€”â€”å†…æ ¸ä¸­çš„ L4 è´Ÿè½½å‡è¡¡å™¨ï¼Œå®ƒåœ¨åº•å±‚ä½¿ç”¨ ipsetï¼ˆå“ˆå¸Œå®ç°ï¼‰ï¼Œå› æ­¤å¤æ‚åº¦ä¸º O(1)ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ ipvs å®ç°ç›¸åŒçš„ç›®æ ‡ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„ï¼šåœ¨ç»§ç»­ä¹‹å‰ï¼Œè¯·ç¡®ä¿åˆ é™¤äº†åœ¨ä¸Šä¸€èŠ‚ä¸­æ·»åŠ çš„æ‰€æœ‰è§„åˆ™ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;å®‰è£…-ipvs&#34;&gt;å®‰è£… IPVS&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ yum install -y ipvsadm
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# -l  list load balancing status&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# -n  numeric output&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ipvsadm -ln
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Prot LocalAddress:Port Scheduler Flags
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -&amp;gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é»˜è®¤æ— è§„åˆ™&lt;/p&gt;
&lt;h4 id=&#34;å¢åŠ è™šæ‹ŸçœŸæ­£çš„-services&#34;&gt;å¢åŠ è™šæ‹Ÿ/çœŸæ­£çš„ services&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨ ipvs å®ç°è´Ÿè½½å‡è¡¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# -A/--add-service           add service&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# -t/--tcp-service &amp;lt;address&amp;gt; VIP + Port&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# -s &amp;lt;method&amp;gt;                scheduling-method&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# -r/--real-server &amp;lt;address&amp;gt; real backend IP + Port&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# -m                         masquerading (NAT)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ipvsadm -A -t &lt;span class=&#34;nv&#34;&gt;$CLUSTER_IP&lt;/span&gt;:&lt;span class=&#34;nv&#34;&gt;$PORT&lt;/span&gt; -s rr
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ipvsadm -a -t &lt;span class=&#34;nv&#34;&gt;$CLUSTER_IP&lt;/span&gt;:&lt;span class=&#34;nv&#34;&gt;$PORT&lt;/span&gt; -r &lt;span class=&#34;nv&#34;&gt;$POD1_IP&lt;/span&gt; -m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ipvsadm -a -t &lt;span class=&#34;nv&#34;&gt;$CLUSTER_IP&lt;/span&gt;:&lt;span class=&#34;nv&#34;&gt;$PORT&lt;/span&gt; -r &lt;span class=&#34;nv&#34;&gt;$POD2_IP&lt;/span&gt; -m
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ–è€…ä½¿ç”¨æˆ‘çš„è„šæœ¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ./ipvs-add-server.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Adding virtual server CLUSTER_IP:PORT&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;10.7.111.132:80 ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Adding real servers ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;10.7.111.132:80 -&amp;gt; 10.5.41.204
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;10.7.111.132:80 -&amp;gt; 10.5.41.5
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Done
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†æ¬¡æ£€æŸ¥çŠ¶æ€ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ipvsadm -ln
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Prot LocalAddress:Port Scheduler Flags
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -&amp;gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TCP  10.7.111.132:80 rr
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -&amp;gt; 10.5.41.5:80                 Masq    &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;      &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -&amp;gt; 10.5.41.204:80               Masq    &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;      &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸€äº›è§£é‡Šï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äºæ‰€æœ‰å‘å¾€ &lt;code&gt;10.7.111.132:80&lt;/code&gt; çš„æµé‡ï¼Œå°†è´Ÿè½½å‡è¡¡åˆ° &lt;code&gt;10.5.41.5:80&lt;/code&gt; å’Œ &lt;code&gt;10.5.41.204:80&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨è½®è¯¢ (rr) ç®—æ³•å®ç°è´Ÿè½½å‡è¡¡&lt;/li&gt;
&lt;li&gt;ä¸¤ä¸ªåç«¯ï¼Œæ¯ä¸ªåç«¯çš„æƒé‡ä¸º 1ï¼ˆå„ 50ï¼…ï¼‰&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ MASQï¼ˆå¢å¼ºå‹ SNATï¼‰åœ¨ VIP å’Œ RealIP ä¹‹é—´è¿›è¡Œæµé‡è½¬å‘&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;éªŒè¯-1&#34;&gt;éªŒè¯&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; i in &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;1..8&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; curl &lt;span class=&#34;nv&#34;&gt;$CLUSTER_IP&lt;/span&gt;:&lt;span class=&#34;nv&#34;&gt;$PORT&lt;/span&gt; 2&amp;gt;&lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &amp;gt;/dev/null&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; sleep 1&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ tcpdump -nn -i eth0 port &lt;span class=&#34;nv&#34;&gt;$PORT&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep &lt;span class=&#34;s2&#34;&gt;&amp;#34;HTTP: GET&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.21.0.7.49556 &amp;gt; 10.5.41.204.80: ... HTTP: GET / HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.21.0.7.49558 &amp;gt; 10.5.41.5.80  : ... HTTP: GET / HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.21.0.7.49560 &amp;gt; 10.5.41.204.80: ... HTTP: GET / HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.21.0.7.49562 &amp;gt; 10.5.41.5.80  : ... HTTP: GET / HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.21.0.7.49566 &amp;gt; 10.5.41.204.80: ... HTTP: GET / HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.21.0.7.49568 &amp;gt; 10.5.41.5.80  : ... HTTP: GET / HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.21.0.7.49570 &amp;gt; 10.5.41.204.80: ... HTTP: GET / HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.21.0.7.49572 &amp;gt; 10.5.41.5.80  : ... HTTP: GET / HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®Œç¾ï¼&lt;/p&gt;
&lt;h3 id=&#34;æ¸…ç†-2&#34;&gt;æ¸…ç†&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ./ipvs-del-server.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Deleting real servers ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;10.7.111.132:80 -&amp;gt; 10.5.41.204
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;10.7.111.132:80 -&amp;gt; 10.5.41.5
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Deleting virtual server CLUSTER_IP:PORT&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;10.7.111.132:80 ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Done
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å®ç°é€šè¿‡-bpf-å®ç°-proxy&#34;&gt;å®ç°ï¼šé€šè¿‡ bpf å®ç° proxy&lt;/h2&gt;
&lt;p&gt;è¿™ä¹Ÿæ˜¯ä¸€ä¸ª &lt;code&gt;O(1)&lt;/code&gt; ä»£ç†ï¼Œä½†æ˜¯ä¸ IPVS ç›¸æ¯”å…·æœ‰æ›´é«˜çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨ä¸åˆ° 100 è¡Œ C ä»£ç ä¸­ä½¿ç”¨ eBPF å®ç°ä»£ç†åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å…ˆå†³æ¡ä»¶&#34;&gt;å…ˆå†³æ¡ä»¶&lt;/h3&gt;
&lt;p&gt;å¦‚æœä½ æœ‰è¶³å¤Ÿçš„æ—¶é—´å’Œå…´è¶£æ¥é˜…è¯» eBPF/BPFï¼Œå¯ä»¥è€ƒè™‘é˜…è¯» &lt;a href=&#34;https://docs.cilium.io/en/v1.6/bpf/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cilium: BPF and XDP Reference Guide&lt;/a&gt;ï¼Œå®ƒå¯¹å¼€å‘äººå‘˜æ¥è¯´æ˜¯ä¸€ä¸ªå®Œç¾çš„ BPF æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å®ç°&#34;&gt;å®ç°&lt;/h3&gt;
&lt;p&gt;è®©æˆ‘ä»¬çœ‹çœ‹å‡ºå£éƒ¨åˆ†çš„åŸºæœ¬æ¦‚å¿µï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¯¹äºæ‰€æœ‰æµé‡ï¼ŒåŒ¹é… &lt;code&gt;dst=CLUSTER_IP &amp;amp;&amp;amp; proto==TCP &amp;amp;&amp;amp; dport==80&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ›´æ”¹ç›®æ ‡ IPï¼š&lt;code&gt;CLUSTER_IP -&amp;gt; POD_IP&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ›´æ–° IP å’Œ TCP æŠ¥å¤´ä¸­çš„æ ¡éªŒå’Œæ–‡ä»¶ï¼ˆå¦åˆ™æˆ‘ä»¬çš„æ•°æ®åŒ…å°†è¢«ä¸¢å¼ƒï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;__section&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;egress&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;tc_egress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;__sk_buff&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;skb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;__be32&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cluster_ip&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mh&#34;&gt;0x846F070A&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// 10.7.111.132
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;__be32&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pod_ip&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mh&#34;&gt;0x0529050A&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;     &lt;span class=&#34;c1&#34;&gt;// 10.5.41.5
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;l3_off&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ETH_HLEN&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// IP header offset
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;l4_off&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;l3_off&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// TCP header offset: l3_off + sizeof(struct iphdr)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;__be32&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;                     &lt;span class=&#34;c1&#34;&gt;// IP checksum
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;skb&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data_end&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;skb&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data_end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data_end&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;l4_off&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// not our packet
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TC_ACT_OK&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iphdr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip4&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iphdr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;l3_off&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;daddr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cluster_ip&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ip4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;protocol&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IPPROTO_TCP&lt;/span&gt; &lt;span class=&#34;cm&#34;&gt;/* || tcp-&amp;gt;dport == 80 */&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TC_ACT_OK&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// DNAT: cluster_ip -&amp;gt; pod_ip, then update L3 and L4 checksum
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;sum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;csum_diff&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;daddr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pod_ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;skb_store_bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;skb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;l3_off&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;offsetof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iphdr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;daddr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pod_ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;l3_csum_replace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;skb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;l3_off&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;offsetof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iphdr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;check&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nf&#34;&gt;l4_csum_replace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;skb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;l4_off&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;offsetof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tcphdr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;check&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;BPF_F_PSEUDO_HDR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TC_ACT_OK&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯¹äºå…¥å£éƒ¨åˆ†ï¼Œéå¸¸ç±»ä¼¼äºå‡ºå£ä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;__section&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ingress&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;tc_ingress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;__sk_buff&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;skb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;__be32&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cluster_ip&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mh&#34;&gt;0x846F070A&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// 10.7.111.132
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;__be32&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pod_ip&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mh&#34;&gt;0x0529050A&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;     &lt;span class=&#34;c1&#34;&gt;// 10.5.41.5
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;l3_off&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ETH_HLEN&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// IP header offset
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;l4_off&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;l3_off&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// TCP header offset: l3_off + sizeof(struct iphdr)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;__be32&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;                     &lt;span class=&#34;c1&#34;&gt;// IP checksum
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;skb&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data_end&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;skb&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data_end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data_end&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;l4_off&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// not our packet
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TC_ACT_OK&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iphdr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip4&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iphdr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;l3_off&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;saddr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pod_ip&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ip4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;protocol&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IPPROTO_TCP&lt;/span&gt; &lt;span class=&#34;cm&#34;&gt;/* || tcp-&amp;gt;dport == 80 */&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TC_ACT_OK&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// SNAT: pod_ip -&amp;gt; cluster_ip, then update L3 and L4 header
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;sum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;csum_diff&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;saddr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cluster_ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;skb_store_bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;skb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;l3_off&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;offsetof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iphdr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;saddr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cluster_ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;l3_csum_replace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;skb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;l3_off&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;offsetof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iphdr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;check&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nf&#34;&gt;l4_csum_replace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;skb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;l4_off&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;offsetof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tcphdr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;check&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;BPF_F_PSEUDO_HDR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TC_ACT_OK&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;__license&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;__section&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;license&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;GPL&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ç¼–è¯‘å¹¶åŠ è½½åˆ°å†…æ ¸ä¸­&#34;&gt;ç¼–è¯‘å¹¶åŠ è½½åˆ°å†…æ ¸ä¸­&lt;/h3&gt;
&lt;p&gt;ç°åœ¨ä½¿ç”¨æˆ‘çš„å°è„šæœ¬ç¼–è¯‘å’ŒåŠ è½½åˆ°å†…æ ¸ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ./compile-and-load.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;++ sudo tc filter show dev eth0 egress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;filter protocol all pref &lt;span class=&#34;m&#34;&gt;49152&lt;/span&gt; bpf chain &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;filter protocol all pref &lt;span class=&#34;m&#34;&gt;49152&lt;/span&gt; bpf chain &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; handle 0x1 toy-proxy-bpf.o:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;egress&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; direct-action not_in_hw id &lt;span class=&#34;m&#34;&gt;18&lt;/span&gt; tag f5f39a21730006aa jited
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;++ sudo tc filter show dev eth0 ingress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;filter protocol all pref &lt;span class=&#34;m&#34;&gt;49152&lt;/span&gt; bpf chain &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;filter protocol all pref &lt;span class=&#34;m&#34;&gt;49152&lt;/span&gt; bpf chain &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; handle 0x1 toy-proxy-bpf.o:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ingress&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; direct-action not_in_hw id &lt;span class=&#34;m&#34;&gt;19&lt;/span&gt; tag b41159c5873bcbc9 jited
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è„šæœ¬æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cat compile-and-load.sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; -x
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;NIC&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;eth0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# compile c code into bpf code&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;clang -O2 -Wall -c toy-proxy-bpf.c -target bpf -o toy-proxy-bpf.o
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# add tc queuing discipline (egress and ingress buffer)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo tc qdisc del dev &lt;span class=&#34;nv&#34;&gt;$NIC&lt;/span&gt; clsact 2&amp;gt;&lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &amp;gt;/dev/null
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo tc qdisc add dev &lt;span class=&#34;nv&#34;&gt;$NIC&lt;/span&gt; clsact
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# load bpf code into the tc egress and ingress hook respectively&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo tc filter add dev &lt;span class=&#34;nv&#34;&gt;$NIC&lt;/span&gt; egress bpf da obj toy-proxy-bpf.o sec egress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo tc filter add dev &lt;span class=&#34;nv&#34;&gt;$NIC&lt;/span&gt; ingress bpf da obj toy-proxy-bpf.o sec ingress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# show info&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo tc filter show dev &lt;span class=&#34;nv&#34;&gt;$NIC&lt;/span&gt; egress
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo tc filter show dev &lt;span class=&#34;nv&#34;&gt;$NIC&lt;/span&gt; ingress
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;éªŒè¯-2&#34;&gt;éªŒè¯&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl &lt;span class=&#34;nv&#34;&gt;$CLUSTER_IP&lt;/span&gt;:&lt;span class=&#34;nv&#34;&gt;$PORT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;!DOCTYPE html&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;/html&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®Œç¾ï¼&lt;/p&gt;
&lt;h3 id=&#34;æ¸…ç†-3&#34;&gt;æ¸…ç†&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sudo tc qdisc del dev &lt;span class=&#34;nv&#34;&gt;$NIC&lt;/span&gt; clsact 2&amp;gt;&lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &amp;gt;/dev/null
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ç”¨ä¸åŒçš„æ–¹æ³•æ‰‹å·¥å®ç°äº† &lt;code&gt;kube-proxy&lt;/code&gt; çš„æ ¸å¿ƒåŠŸèƒ½ã€‚å¸Œæœ›ä½ ç°åœ¨å¯¹ kubernetes èŠ‚ç‚¹ä»£ç†æœ‰äº†æ›´å¥½çš„ç†è§£ï¼Œä»¥åŠå…³äºç½‘ç»œçš„å…¶ä»–ä¸€äº›é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ç¯‡æ–‡ç« ä¸­ä½¿ç”¨çš„ä»£ç å’Œè„šæœ¬ï¼š&lt;a href=&#34;https://github.com/icyxp/icyxp.github.io/tree/mastercode&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å‚è€ƒæ–‡çŒ®&#34;&gt;å‚è€ƒæ–‡çŒ®&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/reference/command-line-tools-reference/kube-proxy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes Doc: CLI - kube-proxy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/enhancements/blob/master/keps/sig-network/0011-ipvs-proxier.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes/enhancements: enhancements/0011-ipvs-proxier.md&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/service/#publishing-services-service-types&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes Doc: Service types&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/cluster-administration/proxies/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Proxies in Kubernetes - Kubernetes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://medium.com/@benmeier_/a-quick-minimal-ipvs-load-balancer-demo-d5cc42d0deb4&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;A minimal IPVS Load Balancer demo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.google.com/presentation/d/1BaIAywY2qqeHtyGZtlyAp89JIZs59MZLKcFLxKE6LyM/edit#slide=id.p3&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Scaling Kubernetes to Support 50,000 Services&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhuanlan.zhihu.com/p/37230013&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åä¸ºäº‘åœ¨ K8S å¤§è§„æ¨¡åœºæ™¯ä¸‹çš„ Service æ€§èƒ½ä¼˜åŒ–å®è·µ&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;é™„å½•&#34;&gt;é™„å½•&lt;/h2&gt;
&lt;p&gt;webapp.yaml:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;webapp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;webapp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;web&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;webapp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;StatefulSet&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;webapp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;webapp&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;webapp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;webapp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# affinity:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#   nodeAffinity:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#     requiredDuringSchedulingIgnoredDuringExecution:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#       nodeSelectorTerms:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#       - matchExpressions:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#         - key: kubernetes.io/hostname&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#           operator: In&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#           values:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#           - node1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tolerations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;effect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NoSchedule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;smoke&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;operator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Equal&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;webapp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx-slim:0.8&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;web&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>å¦‚ä½•æ„å»º Kubernetes Mutating Admission Webhook</title>
      <link>https://cloudnativecn.com/blog/mutating-admission-webhook/</link>
      <pubDate>Sat, 17 Oct 2020 16:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/mutating-admission-webhook/</guid>
      <description>&lt;p&gt;æœ¬æ–‡è¯‘è‡ª &lt;a href=&#34;https://medium.com/@didil/building-a-kubernetes-mutating-admission-webhook-7e48729523ed&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Building a Kubernetes Mutating Admission Webhook&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å½“ä½ åœ¨ Kubernetes ä¸­åˆ›å»º Pod çš„æ—¶å€™ï¼Œæ˜¯å¦æ³¨æ„åˆ°åœ¨å®¹å™¨çš„ &lt;em&gt;/var/run/secrets/kubernetes.io/serviceaccount/token&lt;/em&gt;  è·¯å¾„ä¸Šå­˜æ”¾äº†ä¸€ä¸ªç”¨äºè®¤è¯çš„ token æ–‡ä»¶ï¼Ÿä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼Œåœ¨ Kubernetes é›†ç¾¤ä¸­éªŒè¯ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl run busybox --image&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;busybox --restart&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;Never -it --rm -- ls -l /var/run/secrets/kubernetes.io/serviceaccount/token
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# output&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/var/run/secrets/kubernetes.io/serviceaccount/token
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ³¨ï¼šåœ¨ Kubernetes 1.6 ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œä½ å¯ä»¥ &lt;a href=&#34;https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#use-the-default-service-account-to-access-the-api-server&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å–æ¶ˆ&lt;/a&gt; è¿™ä¸€ä¸ªè‡ªåŠ¨æ³¨å…¥çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œéœ€è¦æ·»åŠ ä¸€ä¸ªâ€œhello.txtâ€æ–‡ä»¶åˆ°æ‰€æœ‰ï¼ˆæˆ–æŸç»„ï¼‰pod çš„å®¹å™¨æ–‡ä»¶ç³»ç»Ÿå†…ï¼Œä¸èƒ½é€šè¿‡åœ¨ pod spec ä¸­æ˜¾å¼æŒ‡å®š volumeMount çš„æ–¹å¼ï¼Œæˆ‘ä»¬æœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•è¾¾åˆ°ç›®çš„å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®©å®éªŒæ›´å…·è¶£å‘³æ€§ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ª ASCIIâ€œå°ä½œå“â€ï¼ˆç”¨è¿™ä¸ªå·¥å…·ç”Ÿæˆçš„ï¼‰æ¥ä½œä¸ºæˆ‘ä»¬çš„â€œhello.txtâ€æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-hellotxt-æ–‡ä»¶å†…å®¹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;hello.txt æ–‡ä»¶å†…å®¹&#34; srcset=&#34;
               /blog/mutating-admission-webhook/hello1_hu5375354487923240541.webp 400w,
               /blog/mutating-admission-webhook/hello1_hu17970409920714418750.webp 760w,
               /blog/mutating-admission-webhook/hello1_hu14802191951120334724.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/mutating-admission-webhook/hello1_hu5375354487923240541.webp&#34;
               width=&#34;712&#34;
               height=&#34;171&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      hello.txt æ–‡ä»¶å†…å®¹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;ä½•ä¸º-admission-webhook&#34;&gt;ä½•ä¸º Admission Webhook&lt;/h2&gt;
&lt;p&gt;å®ç°è¯¥æ³¨å…¥çš„åŠŸèƒ½çš„æ–¹å¼ä¹‹ä¸€ï¼Œå°±æ˜¯æˆ‘ä»¬ä¸Šæ–‡ä¸­æåˆ°çš„ï¼Œä½¿ç”¨ Kubernetes Admission Webhooksã€‚è¿™æ˜¯ä½•æ–¹ç¥åœ£ï¼Ÿæ¥çœ‹ä¸‹å®˜æ–¹æ–‡æ¡£ç»™çš„å®šä¹‰ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Admission webhook æ˜¯ä¸€ç§ç”¨äºæ¥æ”¶å‡†å…¥è¯·æ±‚å¹¶å¯¹å…¶è¿›è¡Œå¤„ç†çš„ HTTP å›è°ƒæœºåˆ¶ã€‚å¯ä»¥å®šä¹‰ä¸¤ç§ç±»å‹çš„ admission webhookï¼Œå³ &lt;a href=&#34;https://kubernetes.io/zh/docs/reference/access-authn-authz/admission-controllers/#validatingadmissionwebhook&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;validating admission webhook&lt;/a&gt; å’Œ &lt;a href=&#34;https://kubernetes.io/zh/docs/reference/access-authn-authz/admission-controllers/#mutatingadmissionwebhook&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;mutating admission webhook&lt;/a&gt;ã€‚Mutating admission webhook ä¼šå…ˆè¢«è°ƒç”¨ã€‚å®ƒä»¬å¯ä»¥æ›´æ”¹å‘é€åˆ° API æœåŠ¡å™¨çš„å¯¹è±¡ä»¥æ‰§è¡Œè‡ªå®šä¹‰çš„è®¾ç½®é»˜è®¤å€¼æ“ä½œã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸‹æ–‡è¿™å¼ å€Ÿç”¨è‡ª &lt;a href=&#34;https://kubernetes.io/blog/2019/03/21/a-guide-to-kubernetes-admission-controllers/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes.io blog post&lt;/a&gt; çš„æµç¨‹å›¾å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†è§£ Admission Webhook çš„æ¦‚å¿µã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å‡†å…¥æ§åˆ¶å™¨å¤„ç†æµç¨‹&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å‡†å…¥æ§åˆ¶å™¨å¤„ç†æµç¨‹&#34; srcset=&#34;
               /blog/mutating-admission-webhook/controller_hu14595458884203449067.webp 400w,
               /blog/mutating-admission-webhook/controller_hu3027374971789997852.webp 760w,
               /blog/mutating-admission-webhook/controller_hu2144610809693246263.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/mutating-admission-webhook/controller_hu14595458884203449067.webp&#34;
               width=&#34;760&#34;
               height=&#34;283&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å‡†å…¥æ§åˆ¶å™¨å¤„ç†æµç¨‹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæœ¬æ–‡å°†é‡‡ç”¨ Kubernetes æä¾›çš„ Mutating Admission Webhook è¿™ä¸€æœºåˆ¶ï¼Œæ¥å®ç°æ³¨å…¥â€œhello.txtâ€æ–‡ä»¶åˆ° Pod å®¹å™¨ä¸­ï¼Œæˆ‘ä»¬æ¯æ¬¡å‘é€è¯·æ±‚è°ƒç”¨ API åˆ›å»º Pod çš„æ—¶å€™ï¼ŒPod çš„ spec ä¿¡æ¯ä¼šè¢«å…ˆä¿®æ”¹ï¼Œå†å­˜å‚¨ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œå·¥ä½œèŠ‚ç‚¹ä¸Šçš„ Kublet åˆ›å»º Pod çš„æ—¶å€™ï¼Œå°†ä¼šé¢„ç½®â€œhello.txtâ€æ–‡ä»¶ã€‚æ–‡ä»¶çš„åˆ›å»ºæµç¨‹æ˜¯å…¨è‡ªåŠ¨çš„ã€‚ä¸€èµ·æ¥è¯•è¯•ï¼&lt;/p&gt;
&lt;h2 id=&#34;åˆ›å»º-admission-webhook&#34;&gt;åˆ›å»º Admission Webhook&lt;/h2&gt;
&lt;p&gt;ç¬”è€…å·²ç»æŠŠä¸‹æ–‡æåˆ°çš„ä»£ç å’Œå‘½ä»¤éƒ½ä¸Šä¼ åˆ°äº† &lt;a href=&#34;https://github.com/didil/k8s-hello-mutating-webhook&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;github ä»“åº“&lt;/a&gt;ã€‚è¯»è€…å¯ä»¥è·Ÿç€è¾¹çœ‹è¾¹æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆéœ€è¦æœ‰ä¸€ä¸ªæ­£å¸¸è¿è¡Œçš„ Kubernetes é›†ç¾¤ã€‚è¯»è€…å¯ä»¥é€šè¿‡ &lt;a href=&#34;https://kind.sigs.k8s.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kind&lt;/a&gt; å¿«é€Ÿèµ·ä¸€ä¸ªé›†ç¾¤ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ç€ï¼Œå®šä¹‰ä¸€ä¸ªåŒ…å«äº†â€œhello.txtâ€æ–‡ä»¶å†…å®¹çš„ &lt;a href=&#34;https://kubernetes.io/docs/concepts/configuration/configmap/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ConfigMap&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ConfigMap&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;hello-configmap&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hello.txt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;\n /$$$$$$$$ /$$   /$$ /$$$$$$  /$$$$$$        /$$$$$$  /$$$$$$        /$$
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;    \  /$$  /$$$$$$   /$$$$$$ \n|__  $$__/| $$  | $$|_  $$_/ /$$__  $$      |_  $$_/
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;    /$$__  $$      | $$  /$$/ /$$__  $$ /$$__  $$\n   | $$   | $$  | $$  | $$  | $$
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;    \ \\__/        | $$  | $$  \\__/      | $$ /$$/ | $$  \\ $$| $$  \\__/\n   | $$
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;    \  | $$$$$$$$  | $$  |  $$$$$$         | $$  |  $$$$$$       | $$$$$/  |  $$$$$$/|
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;    \ $$$$$$ \n   | $$   | $$__  $$  | $$   \\____  $$        | $$   \\____  $$      |
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;    $$  $$   &amp;gt;$$__  $$ \\____  $$\n   | $$   | $$  | $$  | $$   /$$  \\ $$        |
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;    $$   /$$  \\ $$      | $$\\  $$ | $$  \\ $$ /$$  \\ $$\n   | $$   | $$  | $$ /$$$$$$|
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;    \ $$$$$$/       /$$$$$$|  $$$$$$/      | $$ \\  $$|  $$$$$$/|  $$$$$$/\n   |__/
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;    \  |__/  |__/|______/ \\______/       |______/ \\______/       |__/  \\__/ \\______/
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;    \ \\______/ \n                                                                                                  \n
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;    \                                                                                                 \n
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;    \                                                                                                 \n&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸ºäº†æ„å»º webhookï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªç®€æ´çš„ Go API æœåŠ¡ç«¯ã€‚http handler æ˜¯å®ç° webhook ä»£ç çš„æœ€é‡è¦éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;app&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;App&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;HandleMutate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResponseWriter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;admissionReview&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;admissionv1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;AdmissionReview&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// read the AdmissionReview from the request json body
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;readJSON&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;admissionReview&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HandleError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// unmarshal the pod from the AdmissionRequest
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;corev1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;json&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unmarshal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;admissionReview&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Raw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HandleError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;unmarshal to pod: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// add the volume to the pod
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Volumes&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;corev1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Volume&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;hello-volume&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;VolumeSource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;corev1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;VolumeSource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;ConfigMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;corev1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ConfigMapVolumeSource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;LocalObjectReference&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;corev1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LocalObjectReference&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;hello-configmap&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// add volume mount to all containers in the pod
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;VolumeMounts&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;VolumeMounts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;corev1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;VolumeMount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;hello-volume&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;MountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;/etc/config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;containersBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;json&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Marshal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HandleError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;marshall containers: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;volumesBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;json&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Marshal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HandleError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;marshall volumes: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// build json patch
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;patch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;JSONPatchEntry&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;JSONPatchEntry&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;OP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;s&#34;&gt;&amp;#34;add&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;Path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;s&#34;&gt;&amp;#34;/metadata/labels/hello-added&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;`&amp;#34;OK&amp;#34;`&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;JSONPatchEntry&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;OP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;s&#34;&gt;&amp;#34;replace&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;Path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;s&#34;&gt;&amp;#34;/spec/containers&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;containersBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;JSONPatchEntry&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;OP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;s&#34;&gt;&amp;#34;replace&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;Path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;s&#34;&gt;&amp;#34;/spec/volumes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;volumesBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;patchBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;json&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Marshal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;patch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HandleError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;marshall jsonpatch: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;patchType&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;admissionv1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PatchTypeJSONPatch&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// build admission response
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;admissionResponse&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;admissionv1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;AdmissionResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;UID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;admissionReview&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;UID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;Allowed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;   &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;Patch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;nx&#34;&gt;patchBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;PatchType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;patchType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;respAdmissionReview&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;admissionv1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;AdmissionReview&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;TypeMeta&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TypeMeta&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;Kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;s&#34;&gt;&amp;#34;AdmissionReview&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;APIVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;admission.k8s.io/v1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;Response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;admissionResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nf&#34;&gt;jsonOk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;respAdmissionReview&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢è¿™éƒ¨åˆ†ä»£ç ï¼Œå’Œ Kubernetes å†…éƒ¨ä»£ç æœ‰è¯¸å¤šç±»ä¼¼ï¼Œéƒ½ä½¿ç”¨äº† æºè‡ª &lt;a href=&#34;https://github.com/kubernetes/api&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/kubernetes/api&lt;/a&gt;  å’Œ &lt;a href=&#34;https://github.com/kubernetes/apimachinery&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/kubernetes/apimachinery&lt;/a&gt; çš„ schema ç±»å‹ã€‚ä¸Šè¿°ä»£ç ä¸»è¦åšäº†å¦‚ä¸‹äº‹æƒ…ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†æ¥è‡ª Http è¯·æ±‚ä¸­çš„ AdmissionReview  json è¾“å…¥ååºåˆ—åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;è¯»å– Pod çš„ spec ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;å°† hello-configmap ä½œä¸ºæ•°æ®æºï¼Œæ·»åŠ  hello-volume å·åˆ° Podã€‚&lt;/li&gt;
&lt;li&gt;æŒ‚è½½å·è‡³ Pod å®¹å™¨ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;ä»¥ &lt;a href=&#34;http://jsonpatch.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;JSON PATCH&lt;/a&gt; çš„å½¢å¼è®°å½•å˜æ›´ä¿¡æ¯ï¼ŒåŒ…æ‹¬å·çš„å˜æ›´ï¼Œå·æŒ‚è½½ä¿¡æ¯çš„å˜æ›´ã€‚é¡ºé“ä¸ºå®¹å™¨æ·»åŠ ä¸€ä¸ªâ€œhello-added=trueâ€çš„æ ‡ç­¾ã€‚&lt;/li&gt;
&lt;li&gt;æ„å»º json æ ¼å¼çš„å“åº”ç»“æœï¼Œç»“æœä¸­åŒ…å«äº†è¿™æ¬¡è¯·æ±‚ä¸­çš„è¢«ä¿®æ”¹çš„éƒ¨åˆ†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¬”è€… &lt;a href=&#34;https://github.com/didil/k8s-hello-mutating-webhook/blob/main/webhook/api/app_test.go&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ­¤å¤„&lt;/a&gt; è¿˜ä¸ºè¿™ä¸ª handler ç¼–å†™äº†å•å…ƒ/åŠŸèƒ½æµ‹è¯•ï¼Œä»¥ç¡®ä¿å®ƒçš„åŠŸèƒ½å®ç°ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸã€‚&lt;/p&gt;
&lt;h2 id=&#34;åŠ ç‚¹æ”¹è¿›tls&#34;&gt;åŠ ç‚¹æ”¹è¿›ï¼šTLS&lt;/h2&gt;
&lt;p&gt;Webhook API æœåŠ¡å™¨éœ€è¦é€šè¿‡ TLS æ–¹å¼é€šä¿¡ã€‚å¦‚æœæƒ³å°†å…¶éƒ¨ç½²è‡³ Kubernetes é›†ç¾¤å†…ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è¯ä¹¦ã€‚ç¬”è€…é€šè¿‡ &lt;a href=&#34;https://github.com/newrelic/k8s-webhook-cert-manager&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;New Relic&lt;/a&gt; è¿™ä¸ªè½¯ä»¶æ¥ç”Ÿæˆ Webhook è¯ä¹¦ã€‚ç¬”è€…åˆ›å»ºäº†ä¸€ä¸ª &lt;a href=&#34;https://github.com/didil/k8s-webhook-cert-manager&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸ªäººåˆ†æ”¯&lt;/a&gt;ï¼Œå¯¹ä»£ç åšäº†ç‚¹æ”¹åŠ¨ï¼Œä»¥ç¡®ä¿å…¶å¯ä»¥ Job æ–¹å¼éƒ¨ç½²ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;batch/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Job&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;webhook-cert-setup&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceAccountName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;webhook-cert-sa&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;webhook-cert-setup&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# This is a minimal kubectl image based on Alpine Linux that signs certificates using the k8s extension api server&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;quay.io/didil/k8s-webhook-cert-manager:0.13.19-1-a&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;./generate_certificate.sh&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;--service&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;hello-webhook-service&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;--webhook&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;hello-webhook.leclouddev.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;--secret&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;hello-tls-secret&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;--namespace&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;restartPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;OnFailure&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;backoffLimit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å…¶ä»–-yaml&#34;&gt;å…¶ä»– YAML&lt;/h2&gt;
&lt;p&gt;å®Œæˆ webhook API æœåŠ¡ç«¯çš„é•œåƒæ„å»ºåï¼Œå°†å…¶æ¨é€è‡³é•œåƒä»“åº“ï¼Œå¹¶å°†å…¶ä½œä¸ºä¸€ä¸ª Deployment éƒ¨ç½²åˆ°é›†ç¾¤ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;hello-webhook-deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;hello-webhook&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;hello-webhook&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;hello-webhook&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;hello-webhook&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;CONTAINER_IMAGE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumeMounts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;hello-tls-secret&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/tls&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;readOnly&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;limits&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;128Mi&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cpu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;500m&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;           
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;hello-tls-secret&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secretName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;hello-tls-secret&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åæ˜¯ä¸€ä¸ª ClusterIP ç±»å‹çš„ Serviceï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;hello-webhook-service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterIP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;hello-webhook&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ç€ï¼Œåˆ›å»ºä¸€ä¸ª MutatingWebhookConfiguration å°†æˆ‘ä»¬åˆ›å»ºçš„ webhook ä¿¡æ¯æ³¨å†Œåˆ° Kubernetes API serverï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;admissionregistration.k8s.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;MutatingWebhookConfiguration&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;hello-webhook.leclouddev.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;webhooks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;hello-webhook.leclouddev.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;objectSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hello&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;v1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;operations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;CREATE&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;pods&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Namespaced&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clientConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;service&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;default&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;hello-webhook-service&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/mutate&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;admissionReviewVersions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;v1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;v1beta1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;sideEffects&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;None&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;timeoutSeconds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚ä¸Šè¿°çš„æ¸…å•ä¿¡æ¯æ‰€ç¤ºï¼Œæˆ‘ä»¬è¦æ±‚ Kubernetes æŠŠï¼ˆéƒ¨ç½²äº† MutatingWebhookConfigurationï¼‰å‘½åç©ºé—´ä¸­æ‰€æœ‰çš„ Pod åˆ›å»ºè¯·æ±‚ï¼Œåªè¦åŒ¹é…ä¸Šâ€œhello=trueâ€æ ‡ç­¾çš„ï¼Œå°±å°†å…¶è½¬å‘åˆ° hello-webhook-service çš„â€œ/mutateâ€è·¯å¾„ä¸‹ï¼Œäº¤ç»™å…¶å¤„ç†ã€‚æ ‡ç­¾æ˜¯å¯é€‰çš„ã€‚æ­¤å¤„ç¬”è€…é€šè¿‡æ ‡ç­¾åŒ¹é…æ¥è¯´æ˜ï¼Œå¦‚æœæ ‡ç­¾ä¸åŒ¹é…æˆ–è€…ä¸å…·å¤‡æ ‡ç­¾çš„è¯·æ±‚ï¼Œå°±å¯ä»¥ç»•å¼€ Mutating Webhook çš„é¢„å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#service-reference&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™ç¯‡æ–‡ç« &lt;/a&gt; ä¸­æåˆ°äº†â€œcaBundleâ€ï¼Œç„¶è€Œæˆ‘ä»¬ä¸Šé¢æ–‡ä»¶ä¸­â€œclientConfigâ€ä¸­å´ä¸å­˜åœ¨â€œcaBundleâ€key å­—æ®µã€‚ä¸å¿…æ„Ÿåˆ°å¥‡æ€ªï¼Œé‚£æ˜¯å› ä¸º webhook-cert-setup Job ä¼šä¸ºæˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºè¿™ä¸ª keyã€‚&lt;/p&gt;
&lt;h2 id=&#34;éƒ¨ç½²-webhook&#34;&gt;éƒ¨ç½² Webhook&lt;/h2&gt;
&lt;p&gt;é¡¹ç›®å·®ä¸å¤šå°±ç»ªå¯ä»¥éƒ¨ç½²äº†ã€‚æˆ‘ä»¬ç”¨ &lt;a href=&#34;https://github.com/didil/k8s-hello-mutating-webhook/blob/main/Makefile#L16&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Makefile&lt;/a&gt; å’Œ Kustomize æ¥éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ make k8s-deploy
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# output&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kustomize build k8s/other &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;configmap/hello-configmap created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;service/hello-webhook-service created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mutatingwebhookconfiguration.admissionregistration.k8s.io/hello-webhook.leclouddev.com created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kustomize build k8s/csr &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;serviceaccount/webhook-cert-sa created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;clusterrole.rbac.authorization.k8s.io/webhook-cert-cluster-role created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;clusterrolebinding.rbac.authorization.k8s.io/webhook-cert-cluster-role-binding created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;job.batch/webhook-cert-setup created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Waiting &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; cert creation ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl certificate approve hello-webhook-service.default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;certificatesigningrequest.certificates.k8s.io/hello-webhook-service.default approved
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kustomize build k8s/csr &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;serviceaccount/webhook-cert-sa unchanged
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;clusterrole.rbac.authorization.k8s.io/webhook-cert-cluster-role unchanged
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;clusterrolebinding.rbac.authorization.k8s.io/webhook-cert-cluster-role-binding unchanged
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;job.batch/webhook-cert-setup unchanged
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Waiting &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; cert creation ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl certificate approve hello-webhook-service.default
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;certificatesigningrequest.certificates.k8s.io/hello-webhook-service.default approved
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; k8s/deployment &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;        kustomize edit &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; image &lt;span class=&#34;nv&#34;&gt;CONTAINER_IMAGE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;quay.io/didil/hello-webhook:0.1.8&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kustomize build k8s/deployment &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.apps/hello-webhook-deployment created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿è¡Œä¸€ä¸ªå¸¦æœ‰â€œhello=trueâ€æ ‡ç­¾çš„ busybox å®¹å™¨ï¼Œæ£€æŸ¥çœ‹æˆ‘ä»¬çš„ mutating webhook æ˜¯å¦åœ¨æ­£å¸¸è¿è¡Œã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl run busybox-1 --image&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;busybox  --restart&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;Never -l&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;busybox,hello&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt; -- sleep &lt;span class=&#34;m&#34;&gt;3600&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;çœ‹çœ‹å®¹å™¨å†…çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯å¦æœ‰ hello.txtï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; busybox-1 -it -- sh -c &lt;span class=&#34;s2&#34;&gt;&amp;#34;ls /etc/config/hello.txt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# output&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/etc/config/hello.txt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†æ£€æŸ¥ä¸‹æ–‡ä»¶å†…å®¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; busybox-1 -it -- sh -c &lt;span class=&#34;s2&#34;&gt;&amp;#34;cat /etc/config/hello.txt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;















&lt;figure  id=&#34;figure-the-file-is-in-the-pod-container-&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;The file is in the pod container !&#34; srcset=&#34;
               /blog/mutating-admission-webhook/hello2_hu14387523389833771630.webp 400w,
               /blog/mutating-admission-webhook/hello2_hu15025655004058209829.webp 760w,
               /blog/mutating-admission-webhook/hello2_hu4585089374527484192.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/mutating-admission-webhook/hello2_hu14387523389833771630.webp&#34;
               width=&#34;712&#34;
               height=&#34;207&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      The file is in the pod container !
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥å†åˆ›å»ºç¬¬äºŒä¸ªå®¹å™¨ï¼Œä¸å¸¦â€œhello=trueâ€æ ‡ç­¾çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl run busybox-2 --image&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;busybox --restart&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;Never -l&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;busybox -- sleep &lt;span class=&#34;m&#34;&gt;3600&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# output&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;pod/busybox-2 created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; busybox-2 -it -- sh -c &lt;span class=&#34;s2&#34;&gt;&amp;#34;ls /etc/config/hello.txt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# output&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ls: /etc/config/hello.txt: No such file or directory
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å’Œæˆ‘ä»¬é¢„æœŸçš„ä¸€è‡´ï¼Œç¬¬ä¸€æ¬¡åˆ›å»ºçš„ busybox å®¹å™¨ï¼ŒåŒ¹é…ä¸Šäº† webhook çš„æ ‡ç­¾ï¼Œæ³¨å…¥äº†æ–‡ä»¶ã€‚ç¬¬äºŒæ¬¡åˆ›å»ºçš„ busybox å®¹å™¨åˆ™æ²¡æœ‰ã€‚&lt;/p&gt;
&lt;p&gt;å†æ¥æ£€æŸ¥ä¸‹æ˜¯å¦åªæœ‰ buxybox-1 å®¹å™¨å…·å¤‡â€œhello-addedâ€æ ‡ç­¾ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get pod -l&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;busybox -L&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;hello-added
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# output&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME        READY   STATUS    RESTARTS   AGE    HELLO-ADDED
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;busybox-1   1/1     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          3m7s   OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;busybox-2   1/1     Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          53s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Mutating Webhook ç”Ÿæ•ˆäº†ï¼&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å°è¯•ç”¨ Mutating Admission Webhooks å¯¹ Kubernetes è¿›è¡Œäº†åˆæ¬¡æ‹“å±•ã€‚æ–‡ä¸­æ²¡æœ‰æåŠ Validating Admission Webhooksï¼Œå¦‚æœä½ éœ€è¦å¯¹  &lt;a href=&#34;https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/#validation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OpenAPI schemas&lt;/a&gt; ä¹‹å¤–çš„èµ„æºè¿›è¡Œæ ¡éªŒï¼Œä½ å¯ä»¥è¿›ä¸€æ­¥æ·±å…¥äº†è§£ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›æœ¬æ–‡å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œå¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜å’Œè¯„è®ºï¼Œå¯ä»¥è”ç³»æˆ‘ã€‚ä¸‹ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦ä¸€ç§æ‹“å±• Kubernetes çš„æ–¹å¼ï¼šå®ç°ä¸€ä¸ª Kubernetes Operatorã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes client-go informer æ¶æ„ä»‹ç»</title>
      <link>https://cloudnativecn.com/blog/client-go-informer-arch/</link>
      <pubDate>Sun, 30 Aug 2020 07:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/client-go-informer-arch/</guid>
      <description>&lt;h2 id=&#34;ä¸€ç®€ä»‹&#34;&gt;ä¸€ã€ç®€ä»‹&lt;/h2&gt;
&lt;p&gt;åœ¨ kubernetes ç³»ç»Ÿä¸­ï¼Œç»„ä»¶ä¹‹é—´é€šè¿‡ http åè®®è¿›è¡Œé€šä¿¡ï¼Œé€šè¿‡ informer æ¥åšåˆ°äº†æ¶ˆæ¯çš„å®æ—¶æ€§ã€å¯é æ€§ã€é¡ºåºæ€§ï¼Œé€šè¿‡ informer æœºåˆ¶ä¸ api-server è¿›è¡Œé€šä¿¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;äºŒæ¶æ„è®¾è®¡&#34;&gt;äºŒã€æ¶æ„è®¾è®¡&lt;/h2&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-infomer&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;infomer&#34; srcset=&#34;
               /blog/client-go-informer-arch/informer_hu11917337178354665956.webp 400w,
               /blog/client-go-informer-arch/informer_hu8946399096677742660.webp 760w,
               /blog/client-go-informer-arch/informer_hu17724400967991650329.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/client-go-informer-arch/informer_hu11917337178354665956.webp&#34;
               width=&#34;760&#34;
               height=&#34;633&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      infomer
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;1reflector&#34;&gt;1.Reflector&lt;/h3&gt;
&lt;h4 id=&#34;1-ç®€ä»‹&#34;&gt;(1) ç®€ä»‹&lt;/h4&gt;
&lt;p&gt;informer å¯ä»¥å¯¹ kubernetes api server çš„èµ„æºæ‰§è¡Œç›‘æ§ï¼ˆwatchï¼‰æ“ä½œï¼Œç±»å‹å¯ä»¥æ˜¯ kubernetes å†…ç½®èµ„æºä¹Ÿå¯ä»¥æ˜¯ crd è‡ªå®šä¹‰èµ„æºï¼Œå…¶ä¸­æœ€æ ¸å¿ƒçš„åŠŸèƒ½æ˜¯ Reflectorï¼ŒReflector ç”¨äºç›‘æ§æŒ‡å®šèµ„æºçš„ kubernetes èµ„æºï¼Œå½“èµ„æºå‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œä¾‹å¦‚å‘ç”Ÿäº† Added èµ„æºæ·»åŠ ç­‰äº‹ä»¶ ä¼šå°†å…¶èµ„æºå¯¹è±¡å­˜æ”¾åœ¨æœ¬åœ°ç¼“å­˜ DeltaFIFO ä¸­ã€‚&lt;/p&gt;
&lt;h4 id=&#34;2-æ ¸å¿ƒä»‹ç»listandwatch&#34;&gt;(2) æ ¸å¿ƒä»‹ç»ï¼ˆlistandwatchï¼‰&lt;/h4&gt;
&lt;p&gt;ç¬¬ä¸€éƒ¨åˆ†é¦–å…ˆè·å–èµ„æºåˆ—è¡¨æ•°æ®ã€‚
ç¬¬äºŒéƒ¨åˆ†é€šè¿‡ watchhandler æ¥ç›‘æ§èµ„æºå¯¹è±¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// path: staging/src/k8s.io/client-go/tools/cache/reflector.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ListAndWatch é¦–å…ˆåˆ—å‡ºæ‰€æœ‰é¡¹ç›®ï¼Œå¹¶åœ¨è°ƒç”¨æ—¶è·å–èµ„æºç‰ˆæœ¬ï¼Œç„¶åä½¿ç”¨èµ„æºç‰ˆæœ¬è¿›è¡Œè§‚çœ‹ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//å¦‚æœ ListAndWatch ç”šè‡³æ²¡æœ‰å°è¯•åˆå§‹åŒ– watchï¼Œå®ƒå°†è¿”å›é”™è¯¯ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Reflector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ListAndWatch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Listing and watching %v from %s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;expectedType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resourceVersion&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//ä»æ‰€è¦åŒæ­¥æ•°æ®çš„èµ„æºå¯¹è±¡çš„ç¬¬ 0 ä¸ªç‰ˆæœ¬å¼€å§‹
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ListOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResourceVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;initTrace&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;trace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;New&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Reflector ListAndWatch&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;trace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Field&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;initTrace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LogIfLong&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;listCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;panicCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;recover&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;panicCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;c1&#34;&gt;//å¦‚æœ listerWatcher æ”¯æŒï¼Œåˆ™å°è¯•ä»¥å—çš„å½¢å¼æ”¶é›†åˆ—è¡¨ï¼›å¦‚æœä¸æ”¯æŒï¼Œåˆ™å°è¯•ç¬¬ä¸€ä¸ª
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;c1&#34;&gt;//åˆ—è¡¨è¯·æ±‚å°†è¿”å›å®Œæ•´çš„å“åº”ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;New&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;SimplePageFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;opts&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ListOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listerWatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;List&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;opts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;WatchListPageSize&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PageSize&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;WatchListPageSize&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;c1&#34;&gt;//è¿”å›å®Œæ•´åˆ—è¡¨
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;List&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Background&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nb&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;panicCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nb&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%s: Failed to list %v: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;expectedType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;initTrace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Step&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Objects listed&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;//é€šè¿‡ list è½¬æ¢æˆ‘ä»¬å¾—åˆ° listMetaInterface
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;listMetaInterface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;meta&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ListAccessor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%s: Unable to understand list result %#v: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;//listMetaInterface å¯ä»¥è·å– groupversion ç„¶åä»è€Œè½¬æ¢ä¸º kind
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;resourceVersion&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;listMetaInterface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetResourceVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;initTrace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Step&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Resource version extracted&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;//å¾—åˆ° []runtime.Object
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;meta&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ExtractList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%s: Unable to understand list result %#v (%v)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;initTrace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Step&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Objects extracted&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;//ç„¶åå­˜å…¥ç¼“å­˜
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;cm&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;		func (r *Reflector) syncWith(items []runtime.Object, resourceVersion string) error {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;			found := make([]interface{}, 0, len(items))
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;			for _, item := range items {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;				found = append(found, item)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;			}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;		//è°ƒç”¨ store çš„ replace æ¥æ›¿æ¢
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;			return r.store.Replace(found, resourceVersion)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;		 */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;syncWith&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resourceVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%s: Unable to sync list result: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;initTrace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Step&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;SyncWith done&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;setLastSyncResourceVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;resourceVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;initTrace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Step&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Resource version updated&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}();&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;//è°ƒç”¨ api çš„æ¥å£ watch
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listerWatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Watch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;io&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EOF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;c1&#34;&gt;// watch closed normally
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;io&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ErrUnexpectedEOF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%s: Watch for %v closed with unexpected EOF: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;expectedType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;utilruntime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HandleError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%s: Failed to watch %v: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;expectedType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;c1&#34;&gt;//å¦‚æœå‡ºç°â€œè¿æ¥è¢«æ‹’ç»â€é”™è¯¯ï¼Œåˆ™æ„å‘³ç€æœ€æœ‰å¯èƒ½çš„ apiserver æ²¡æœ‰å“åº”ã€‚é‡æ–°åˆ—å‡ºæ‰€æœ‰å¯¹è±¡æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œå› ä¸ºå¾ˆå¯èƒ½æˆ‘ä»¬å°†èƒ½å¤Ÿåœ¨ç»“æŸçš„åœ°æ–¹é‡æ–°å¼€å§‹ç›‘è§†ã€‚å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œè¯·ç­‰å¾…å¹¶é‡æ–°å‘é€ç›‘è§†è¯·æ±‚ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;utilnet&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;IsConnectionRefused&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;watchHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;resourceVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resyncerrc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;errorStopRequested&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;apierrs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;IsResourceExpired&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%s: watch of %v ended with: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;expectedType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Warningf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%s: watch of %v ended with: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;expectedType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;3-æµç¨‹ä»‹ç»&#34;&gt;(3) æµç¨‹ä»‹ç»&lt;/h4&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-infomer&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;infomer&#34; srcset=&#34;
               /blog/client-go-informer-arch/reflector_hu13246955231557946655.webp 400w,
               /blog/client-go-informer-arch/reflector_hu9831033630731829911.webp 760w,
               /blog/client-go-informer-arch/reflector_hu11640029137753410287.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/client-go-informer-arch/reflector_hu13246955231557946655.webp&#34;
               width=&#34;438&#34;
               height=&#34;485&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      infomer
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é€šè¿‡ç»™ NewRefector ä¼ å…¥ä¸€ä¸ª listerwatcher æ•°æ®æ¥å£å¯¹è±¡æ¥å®ä¾‹åŒ–ä¸€ä¸ª Reflector å¯¹è±¡ã€‚
Reflector å…·å¤‡ list å’Œ watch æ–¹æ³• æœ€é‡è¦çš„æ˜¯ ListAndWatchã€‚
list ä¸»è¦æ˜¯ç”¨æ¥è·å–èµ„æºåˆ—è¡¨æ•°æ®ã€‚
watch ä¸»è¦æ˜¯ç”¨æ¥ç›‘æ§èµ„æºå¯¹è±¡ï¼Œå‘ç”Ÿ event çš„æ—¶å€™æ’å…¥æœ¬åœ°ç¼“å­˜ DeltaFIFO ä¸­å¹¶æ›´æ–° ResourceVersionã€‚&lt;/p&gt;
&lt;h3 id=&#34;2deltafifo&#34;&gt;2.DeltaFIFO&lt;/h3&gt;
&lt;h4 id=&#34;1-ç®€ä»‹-1&#34;&gt;(1) ç®€ä»‹&lt;/h4&gt;
&lt;p&gt;DeltaFIFO å¯ä»¥æ‹†åˆ†å¼€æ¥ç†è§£ FIFO æ˜¯ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—ã€‚Delta æ˜¯ä¸€ä¸ªèµ„æºå¯¹è±¡å­˜å‚¨ï¼Œå®ƒå¯ä»¥ä¿å­˜èµ„æºå¯¹è±¡çš„æ“ä½œç±»å‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// path: staging/src/k8s.io/client-go/tools/cache/delta_fifo.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;DeltaFIFO&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Deltas&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;queue&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;2-ç”Ÿäº§è€…&#34;&gt;(2) ç”Ÿäº§è€…&lt;/h4&gt;
&lt;p&gt;åœ¨ç”Ÿäº§è€…æ–¹æ³•ä¸­ queueActionLocked å†…éƒ¨é€šè¿‡ keyof æ‹¿åˆ°å¯¹åº” obj çš„ä¸€ä¸ª idï¼Œitems æ˜¯ä¸€ä¸ª map[string]Deltas çš„ä¸€ä¸ª map é‚£ä¹ˆå°±ä»¥è¿™ä¸ª id ä¸º map çš„ keyï¼Œvalue([]Delta) çš„è¯ åˆå§‹åŒ–ä¸€ä¸ª[]Delta åˆ‡ç‰‡å¹¶ä¸”ä»¥ f.items[id]ä¸ºåˆå§‹åˆ‡ç‰‡ å†æ·»åŠ ä¸€ä¸ª Delta{actionType, obj}ï¼Œç„¶åä½¿ç”¨ dedupDeltas å¯¹ newDeltas åšå»é‡æ“ä½œã€‚æˆ‘ä»¬ä¼šå¯¹ f.items[id] ï¼Œitems è¿™ä¸ª map ä¸­æ˜¯å¦å­˜åœ¨è¿™ä¸ª key(id)ï¼Œå¦‚æœä¸å­˜åœ¨å°±åœ¨é˜Ÿåˆ—ä¸­æ·»åŠ ä¸€ä¸ª idï¼Œæ·»åŠ å®Œä¹‹åå°† newDeltas èµ‹å€¼ç»™ items[id]ï¼Œå¹¶ä¸”è°ƒç”¨ cond.Broadcast() é€šçŸ¥æ‰€æœ‰æ¶ˆè´¹è€…å¹¶ä¸”è§£é™¤é˜»å¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// path: staging/src/k8s.io/client-go/tools/cache/delta_fifo.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//è¿™é‡Œ queue è´Ÿè´£å­˜æ”¾çš„æ˜¯ idï¼ˆè¿™é‡Œä¸»è¦æ˜¯è´Ÿè´£å…ˆè¿›å…ˆå‡ºï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//items å­˜æ”¾çš„æ˜¯å¯¹åº” id çš„ åŒä¸€ä¸ª obj çš„å¤šç§æ“ä½œå¦‚å›¾æ‰€ç¤º objkey1 ä¸­å¯¹åº” obj1 çš„å…ˆ added ç„¶å updated 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DeltaFIFO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;queueActionLocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;actionType&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;DeltaType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;queue&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;queue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newDeltas&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Broadcast&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;















&lt;figure  id=&#34;figure-infomer&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;infomer&#34; srcset=&#34;
               /blog/client-go-informer-arch/deltafifo-queue_hu128528131754076222.webp 400w,
               /blog/client-go-informer-arch/deltafifo-queue_hu18008080253013244527.webp 760w,
               /blog/client-go-informer-arch/deltafifo-queue_hu17106077338211082082.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/client-go-informer-arch/deltafifo-queue_hu128528131754076222.webp&#34;
               width=&#34;760&#34;
               height=&#34;396&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      infomer
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h4 id=&#34;3-æ¶ˆè´¹è€…&#34;&gt;(3) æ¶ˆè´¹è€…&lt;/h4&gt;
&lt;p&gt;è¿™é‡Œ cond.Wait() å¦‚æœé˜Ÿåˆ—ä¸­æ²¡æœ‰æ•°æ®é‚£ä¹ˆå°±ç­‰å¾…ï¼Œå½“é˜Ÿåˆ—ä¸­æœ‰äº†æ•°æ®ä¹‹åä» queue é‡Œé¢æ‹¿å‡ºæ¥ç¬¬ 0 ä¸ª idï¼Œå¹¶ä¸”ä»é˜Ÿåˆ—ï¼ˆqueueï¼‰ä¸­åˆ é™¤ç¬¬ 0 ä¸ªå…ƒç´ ï¼Œç„¶åä» items ä¸­åš key çš„æœ‰æ•ˆåˆ¤æ–­ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è·³è¿‡ï¼Œå­˜åœ¨çš„è¯é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ä» map ä¸­æŠŠè¿™ä¸ª key ç»™åˆ é™¤æ‰ã€‚è¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢æ¯”å¦‚ items ä¸­ obj1 æœ‰ added æœ‰ updated å¿½ç„¶ä»ç”Ÿäº§è€…åŠ äº†ä¸€ä¸ª deletedï¼Œè¿™é‡Œåˆ é™¤ä¹‹åå³ä½¿åŠ  deleted ä¹Ÿæ˜¯æ–°çš„ key ä¼šé‡æ–°ä»é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œè¿™æ˜¯å¯¹åº” objkey1 çš„[]delta ä¸­åªæœ‰ä¸€ä¸ª Deleted çš„æ“ä½œï¼Œç„¶åè°ƒç”¨ä¼ å…¥çš„å›è°ƒå‡½æ•° process åšæ“ä½œã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// path: staging/src/k8s.io/client-go/tools/cache/delta_fifo.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DeltaFIFO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Pop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;process&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PopProcessFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;//å¦‚æœé˜Ÿåˆ—é•¿åº¦ä¸º 0 ä¸”é˜Ÿåˆ—ä¸æ˜¯å…³é—­ é‚£ä¹ˆå°±ç­‰å¾…
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;queue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;IsClosed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ErrFIFOClosed&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;queue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;queue&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;queue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;initialPopulationCount&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;initialPopulationCount&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;--&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;//å–å‡ºé˜Ÿåˆ—å¤´éƒ¨ç¬¬ä¸€ä¸ªå…ƒç´ 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nb&#34;&gt;delete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;process&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ErrRequeue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;addIfNotPresent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;4-å›è°ƒå‡½æ•°-process&#34;&gt;(4) å›è°ƒå‡½æ•° process&lt;/h4&gt;
&lt;p&gt;handleDeltas å‡½æ•°ä½œä¸º proess å›è°ƒå‡½æ•°ï¼Œå½“èµ„æºå¯¹è±¡çš„æ“ä½œç±»å‹ä¸º Addedã€Updatedã€Deleted æ—¶ï¼Œå°†è¯¥èµ„æºå¯¹è±¡å­˜å‚¨å€¼ indexerï¼ˆå¹¶å‘å®‰å…¨çš„å­˜å‚¨ï¼‰ï¼Œå¹¶é€šè¿‡ distribute å‡½æ•°å°†èµ„æºå¯¹è±¡åˆ†å‘è‡³ Sharedinformerï¼Œdistribute å‡½æ•°å°†èµ„æºå¯¹è±¡åˆ†å‘åˆ°è¯¥äº‹ä»¶çš„å¤„ç†å‡½æ•°ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// path: staging/src/k8s.io/client-go/tools/cache/shared_informer.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sharedIndexInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;HandleDeltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;blockDeltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;blockDeltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//è¿™é‡Œå¾ªç¯çš„ç›®çš„æ˜¯å› ä¸ºæˆ‘ä»¬ä¼ å…¥çš„ obj æ˜¯ä¸€ä¸ª Deltas ä¹Ÿå°±æ˜¯ä¸€ä¸ª []Deltas é‚£ä¹ˆå°±æ˜¯ä¸€ä¸ª obj çš„å¤šä¸ªæ“ä½œ 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Deltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Added&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Updated&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;isSync&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Sync&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cacheMutationDetector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddObject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Update&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;distribute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;updateNotification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isSync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;distribute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;addNotification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;newObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isSync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Deleted&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Delete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;distribute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;deleteNotification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;5distribute-å‡½æ•°å¤„ç†&#34;&gt;(5)distribute å‡½æ•°å¤„ç†&lt;/h4&gt;
&lt;p&gt;è¿™æ®µä»£ç è¡¨ç¤ºäº†é€šè¿‡åŒºåˆ†æ˜¯å¦æ˜¯ sync æ“ä½œ  é€šè¿‡éå† listenerï¼Œå¹¶ä¸”è°ƒç”¨ add æ–¹æ³•æŠŠ obj å†™å…¥äº†ä¸€ä¸ª addch çš„ç®¡é“ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// path: staging/src/k8s.io/client-go/tools/cache/shared_informer.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sharedProcessor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;distribute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listenersLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listenersLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RUnlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;syncingListeners&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listeners&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sharedProcessor&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;listenersStarted&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;listenersLock&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RWMutex&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;listeners&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processorListener&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;syncingListeners&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processorListener&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;clock&lt;/span&gt;            &lt;span class=&#34;nx&#34;&gt;clock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Clock&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Group&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processorListener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;notification&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;addCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;notification&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;processor æ˜¯ sharedIndexInformer ä¸­ä¸€ä¸ªéå¸¸æœ‰è¶£çš„ç»„ä»¶ï¼ŒController Manager é€šè¿‡ä¸€ä¸ª Informer å•ä¾‹å·¥å‚æ¥ä¿è¯ä¸åŒçš„ Controller å…±äº«äº†åŒä¸€ä¸ª Informerï¼Œä½†æ˜¯ä¸åŒçš„ Controller å¯¹è¯¥å…±äº«çš„ Informer æ³¨å†Œçš„ Handler ä¸åŒ sharedProcessor çš„å·¥ä½œæ ¸å¿ƒæ˜¯å›´ç»•ç€ listeners è¿™ä¸ª Listener åˆ‡ç‰‡å±•å¼€çš„ã€‚&lt;/p&gt;
&lt;h4 id=&#34;6addch&#34;&gt;(6)addch&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// path: staging/src/k8s.io/client-go/tools/cache/shared_informer.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;processorListener&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;nextCh&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;addCh&lt;/span&gt;  &lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°†äº‹ä»¶æºæºä¸æ–­åœ° ä» addCh åˆ° nextChï¼Œå› ä¸ºæ— æ³•é¢„çŸ¥ç”Ÿäº§è€…çš„ç”Ÿäº§é€Ÿåº¦ï¼Œæ‰€ä»¥è¿™é‡Œ pendingNotifications æ‰¿æ‹…äº†ä¸€ä¸ª buffer çš„è§’è‰²ï¼Œé€šè¿‡ pendingNotifications æ¥æ§åˆ¶ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…ä¹‹é—´çš„å¹³è¡¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// path: staging/src/k8s.io/client-go/tools/cache/shared_informer.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processorListener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;pop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;utilruntime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HandleCrash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nextCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Tell .run() to stop
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nextCh&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;notification&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nextCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;notification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;c1&#34;&gt;// Notification dispatched
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;notification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pendingNotifications&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ReadOne&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Nothing to pop
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;				&lt;span class=&#34;nx&#34;&gt;nextCh&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Disable this select case
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;notificationToAdd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;addCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;notification&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// No notification to pop (and pendingNotifications is empty)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;				&lt;span class=&#34;c1&#34;&gt;// Optimize the case - skip adding to pendingNotifications
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;				&lt;span class=&#34;nx&#34;&gt;notification&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;notificationToAdd&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;nextCh&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nextCh&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// There is already a notification waiting to be dispatched
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;				&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pendingNotifications&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WriteOne&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;notificationToAdd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å› ä¸º listener åŒ…å«äº† Controller æ³¨å†Œè¿›æ¥çš„ Handler æ–¹æ³•ï¼Œå› æ­¤ listener æœ€é‡è¦çš„èŒèƒ½å°±æ˜¯å½“äº‹ä»¶å‘ç”Ÿæ—¶æ¥è§¦å‘è¿™äº›æ–¹æ³•ï¼Œè€Œ listener.run å°±æ˜¯ä¸åœçš„ä» nextCh è¿™ä¸ª channel ä¸­æ‹¿åˆ°äº‹ä»¶å¹¶æ‰§è¡Œå¯¹åº”çš„ handler å¯ä»¥çœ‹åˆ°ï¼Œlistener.run ä¸åœçš„ä» nextCh è¿™ä¸ª channel ä¸­æ‹¿åˆ°äº‹ä»¶ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// path: staging/src/k8s.io/client-go/tools/cache/shared_informer.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processorListener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Until&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ExponentialBackoff&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;retry&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DefaultRetry&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nextCh&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;notification&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;updateNotification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;OnUpdate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;notification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;notification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;newObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;addNotification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;OnAdd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;notification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;newObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;deleteNotification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;OnDelete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;notification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;utilruntime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HandleError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;unrecognized notification: %T&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;c1&#34;&gt;// the only way to get here is if the p.nextCh is empty and closed
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// the only way to get here is if the p.nextCh is empty and closed
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nb&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Minute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºå½“æœ‰ä¸€ä¸ªæ–°çš„ event è¿™é‡Œæ–°çš„ event æŒ‡çš„æ˜¯ä» delta é˜Ÿåˆ—ä¸­é€šè¿‡ distribute åˆ†å‘ç»™æ‰€æœ‰ Listener é€šè¿‡è°ƒç”¨ add æ¥å¯¹ addch æœ‰ä¸€ä¸ªå†™å…¥çš„æ“ä½œï¼Œç„¶åé€šè¿‡ç¼“å­˜åˆ¤å®šï¼ˆä¹Ÿå°±æ˜¯ä¸ºäº†é˜²æ­¢ listener.handler ç”Ÿäº§é€Ÿåº¦å¤§äºæ¶ˆè´¹é€Ÿåº¦ è¿™é‡ŒåŠ äº†ä¸€å±‚ç¼“å­˜å±‚ å¦‚æœæ²¡æœ‰ç¼“å­˜ç›´æ¥å†™å…¥ nextchï¼Œæœ‰ç¼“å­˜å°±å†™å…¥ç¼“å­˜è¿˜ä¼šå¯¹ç¼“å­˜çš„å‰©ä½™é‡åšåˆ¤æ–­ï¼‰ï¼Œå¹¶æ‰§è¡Œå¯¹åº”çš„ handlerã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-infomer&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;infomer&#34; srcset=&#34;
               /blog/client-go-informer-arch/addch_hu12743464803501204053.webp 400w,
               /blog/client-go-informer-arch/addch_hu14306623319331308095.webp 760w,
               /blog/client-go-informer-arch/addch_hu7226318229261011706.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/client-go-informer-arch/addch_hu12743464803501204053.webp&#34;
               width=&#34;634&#34;
               height=&#34;349&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      infomer
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-handler&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;handler&#34; srcset=&#34;
               /blog/client-go-informer-arch/deltafifo_hu1005362281456267541.webp 400w,
               /blog/client-go-informer-arch/deltafifo_hu17611353140034024025.webp 760w,
               /blog/client-go-informer-arch/deltafifo_hu9427251209181468893.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/client-go-informer-arch/deltafifo_hu1005362281456267541.webp&#34;
               width=&#34;672&#34;
               height=&#34;309&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      handler
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h4 id=&#34;7deltafifo-æ€»ç»“&#34;&gt;(7)DeltaFIFO æ€»ç»“&lt;/h4&gt;
&lt;p&gt;æ€»ä½“æ¥çœ‹ï¼ŒDeltaFIFO çš„å…¥é˜Ÿåˆ—æ–¹æ³•ï¼Œä¼šå…ˆåˆ¤æ–­è¯¥èµ„æºæ˜¯å¦å·²ç»åœ¨ items ä¸­ï¼Œå¦‚æœå·²ç»å­˜åœ¨ï¼Œè¯´æ˜è¯¥èµ„æºè¿˜æ²¡æœ‰è¢«æ¶ˆè´¹ï¼ˆè¿˜åœ¨ queue ä¸­æ’é˜Ÿï¼‰ï¼Œåˆ™ç›´æ¥å°†äº‹ä»¶ append åˆ° items[resource_id] ä¸­å³å¯ã€‚å¦‚æœå‘ç°ä¸åœ¨ items ä¸­ï¼Œä¾¿ä¼šåˆ›å»º items[resource_id]ï¼Œå¹¶å°†èµ„æº id append åˆ° queue ä¸­ã€‚è€Œ DeltaFIFO å‡ºé˜Ÿåˆ—æ–¹æ³•ï¼Œä¼šä» queue ä¸­æ‹¿åˆ°é˜Ÿåˆ—æœ€å‰é¢çš„èµ„æº idï¼Œç„¶åä» items ä¸­æ‹¿èµ°è¯¥èµ„æºæ‰€æœ‰çš„äº‹ä»¶ï¼Œæœ€åè°ƒç”¨ Pop æ–¹æ³•ä¼ å…¥çš„ PopProcessFunc ç±»å‹çš„å¤„ç†å‡½æ•°ã€‚å› æ­¤ï¼ŒDeltaFIFO çš„ç‰¹ç‚¹åœ¨äºï¼Œå…¥é˜Ÿåˆ—çš„æ˜¯ï¼ˆèµ„æºçš„ï¼‰äº‹ä»¶ï¼Œè€Œå‡ºé˜Ÿåˆ—æ—¶æ˜¯æ‹¿åˆ°çš„æ˜¯æœ€æ—©å…¥é˜Ÿåˆ—çš„èµ„æºçš„æ‰€æœ‰äº‹ä»¶ã€‚è¿™æ ·çš„è®¾è®¡ä¿è¯äº†ä¸ä¼šå› ä¸ºæœ‰æŸä¸ªèµ„æºç–¯ç‹‚çš„åˆ¶é€ äº‹ä»¶ï¼Œå¯¼è‡´å…¶ä»–èµ„æºæ²¡æœ‰æœºä¼šè¢«å¤„ç†è€Œäº§ç”Ÿé¥¥é¥¿&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-infomer&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;infomer&#34; srcset=&#34;
               /blog/client-go-informer-arch/deltafifo-3_hu4286734315831529635.webp 400w,
               /blog/client-go-informer-arch/deltafifo-3_hu8744188892223828170.webp 760w,
               /blog/client-go-informer-arch/deltafifo-3_hu10179224965206268266.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/client-go-informer-arch/deltafifo-3_hu4286734315831529635.webp&#34;
               width=&#34;760&#34;
               height=&#34;436&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      infomer
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;3indexer&#34;&gt;3.Indexer&lt;/h3&gt;
&lt;h4 id=&#34;1-ç®€ä»‹-2&#34;&gt;(1) ç®€ä»‹&lt;/h4&gt;
&lt;p&gt;indexer æ˜¯ client-go ç”¨æ¥å­˜å‚¨èµ„æºå¯¹è±¡å¹¶è‡ªå¸¦ç´¢å¼•åŠŸèƒ½çš„æœ¬åœ°å­˜å‚¨ï¼ŒReflector ä» DeltaFIFO ä¸­å°†æ¶ˆè´¹å‡ºæ¥çš„èµ„æºå¯¹è±¡å­˜å‚¨è‡³ indexerï¼Œindexer è¦ä¸ etcd ä¸­çš„æ•°æ®ä¿æŒä¸€è‡´ï¼Œè¿™æ ·æ— é¡»æ¯æ¬¡éƒ½èµ° etcd äº¤äº’å¼æ‹¿åˆ°æ•°æ®ï¼Œèƒ½å‡è½» api-server çš„å‹åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-infomer&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;infomer&#34; srcset=&#34;
               /blog/client-go-informer-arch/indexer_hu16810622741520391608.webp 400w,
               /blog/client-go-informer-arch/indexer_hu2633788823199136651.webp 760w,
               /blog/client-go-informer-arch/indexer_hu7458886993513930717.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/client-go-informer-arch/indexer_hu16810622741520391608.webp&#34;
               width=&#34;686&#34;
               height=&#34;398&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      infomer
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h4 id=&#34;2-ä¾‹å­&#34;&gt;(2) ä¾‹å­&lt;/h4&gt;
&lt;p&gt;è¿™é‡Œæ˜¯ä¸€ä¸ª indexer çš„ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//è¿™å°±æ˜¯ä¸€ä¸ª keyfunc çš„å®šä¹‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;testUsersIndexFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//æ‹¿åˆ°ä¸€ä¸ª pod obj å¹¶ä¸”ä» pod ä¸­æ‹¿åˆ° æ³¨é‡Š key æ˜¯ users çš„å€¼ 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;usersString&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;users&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//ä»¥ï¼Œä½œä¸ºåˆ†éš”ç¬¦ åšä¸€ä¸ªåˆ‡ç‰‡è¿”å›
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;usersString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;,&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;TestMultiIndexKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;testing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//æˆ‘ä»¬åˆå§‹åŒ–ä¸€ä¸ª indexer  MetaNamespaceKeyFunc æ˜¯ä¸€ä¸ªè·å– ns å’Œèµ„æºå¯¹è±¡çš„çš„ keyfunc 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//indexer çš„ key æ˜¯ byUser value æ˜¯ä¸€ä¸ª keyfunc(testUsersIndexFunc)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewIndexer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MetaNamespaceKeyFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Indexers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;byUser&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;testUsersIndexFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//åˆå§‹åŒ– 3 ä¸ª pod obj
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;pod1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ObjectMeta&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ObjectMeta&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;one&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;users&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;ernie,bert&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;pod2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ObjectMeta&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ObjectMeta&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;two&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;users&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;bert,oscar&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;pod3&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ObjectMeta&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ObjectMeta&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;tre&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;users&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;ernie,elmo&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//è°ƒç”¨ add æ’å…¥ç¼“å­˜
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//æˆ‘ä»¬é€šè¿‡ map ä¸­çš„ indexfuncï¼ˆè¿™ä¸ª func ä¸»è¦å°±æ˜¯ä» pod çš„æ³¨é‡Šå­—æ®µä¸­æ‹¿åˆ°æ³¨é‡Š key æ˜¯ users çš„å€¼ï¼Œkeyfunc è¿”å›çš„æ˜¯ä¸€ä¸ª []stringï¼‰é‚£ä¹ˆé€šè¿‡ indexfunc æˆ‘ä»¬è·å¾—äº†æ³¨é‡Š key æ˜¯ users çš„å€¼ ç„¶åé€šè¿‡æˆ‘ä»¬ç¬¬äºŒä¸ªå‚æ•°åˆ¤æ–­ users ä¸­å­˜ä¸å­˜åœ¨ ernie è¿™ä¸ª string 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;erniePods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ByIndex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;byUser&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;ernie&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;unexpected error: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;erniePods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Expected 1 pods but got %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;erniePods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//å¯èƒ½æœ‰å¤šä¸ª pod æ³¨é‡Šä¸­éƒ½æœ‰ users:ernie,xxx,xxx ç±»ä¼¼çš„åªè¦åŒ…å« ernie é€šè¿‡ä¸Šé¢çš„ byindex å°±å¯ä»¥æ‹¿å‡ºæ¥ ç„¶åéå† æ‰“å°
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;erniePod&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;erniePods&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;erniePod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;one&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Expected only &amp;#39;one&amp;#39; but got %s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;erniePod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç®€å•æ¥è¯´å°±æ˜¯ indefunc æˆ‘ä»¬è‡ªå·±å®šä¹‰ä¸€äº›é€»è¾‘  å®ç°å¯¹ä¸€ä¸ª obj åšä¸€äº›å–å€¼æˆ–è€…æ“ä½œï¼Œç„¶åé€šè¿‡ä¼ å…¥ä¸€ä¸ª indexfunc åˆå§‹åŒ–ä¸€ä¸ª indexerã€‚
è¿™é‡Œçš„ indexer æ˜¯ä¸€ä¸ª map[string]indexfunc æˆ‘çš„ç†è§£å°±æ˜¯å¯ä»¥è‡ªå®šä¹‰ indexfun ç„¶åæ·»åŠ  map é‡Œé¢ éœ€è¦åšä»€ä¹ˆæ“ä½œå°±è°ƒç”¨é‚£ä¸ª key å¯¹åº”çš„ func å°±æ¯”å¦‚ index.ByIndex(&amp;ldquo;byUser&amp;rdquo;, &amp;ldquo;ernie&amp;rdquo;)ã€‚
indefunc æ˜¯ä¸€ä¸ªå¯¹æ³¨é‡Š key æ˜¯ users å– value çš„æ“ä½œ é‚£ä¹ˆè°ƒç”¨è¿™ä¸ª indefunc å¹¶ä¸”æ¯”è¾ƒå–å‡ºæ¥çš„å€¼ä¸­æ˜¯å¦æœ‰ ernie è¿™ä¸ª stringã€‚&lt;/p&gt;
&lt;h4 id=&#34;3byindex-çš„æ ¸å¿ƒå®ç°&#34;&gt;(3)ByIndex çš„æ ¸å¿ƒå®ç°&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// path: staging/src/k8s.io/client-go/tools/cache/store.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//å‰é¢è¯´è¿‡äº† cache æ˜¯ä¸€ä¸ª store çš„å®ç° ç„¶åå®ƒæœ¬èº«æœ‰åµŒå¥—äº† ThreadSafeStore æ¥å£ 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//threadSafeMap æ˜¯ ThreadSafeStore æ¥å£çš„ä¸€ä¸ªå®ç°
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//æˆ‘ä»¬å¯ä»¥ä» newstroe çœ‹åˆ° å°±æ˜¯æŠŠ threadSafeMap èµ‹ç»™äº† store çš„ ThreadSafeStore å­—æ®µ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//go çš„ç‰¹æ€§å½“ä»–è¿™ä¸ªç»“æ„ä½“å®ç°äº†ä¸€ä¸ªæ¥å£çš„æ‰€æœ‰æ–¹æ³•é‚£ä¹ˆå°±å¯ä»¥æŠŠç»“æ„ä½“èµ‹ç»™æ¥å£ 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ByIndex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;indexKey&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cacheStorage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ByIndex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;indexKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// path: staging/src/k8s.io/client-go/tools/cache/thread_safe_store.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//æ¥æ”¶ 2 ä¸ªå‚æ•° indexname ç´¢å¼•å™¨åç§°   indexkey éœ€è¦æ£€ç´¢çš„ key
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;threadSafeMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ByIndex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;indexKey&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;//åŠ é”
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RUnlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//é€šè¿‡ indexname  æˆ‘ä»¬æ‹¿åˆ°å¯¹åº”çš„ indexfunc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;indexFunc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;indexFunc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Index with name %s does not exist&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;indexName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//ä» indeices ä¸­é€šè¿‡ indexname æˆ‘ä»¬æ‹¿åˆ° index  
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;//indices æ˜¯ä¸€ä¸ª map[string]index
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;//index æ˜¯ map[string]sets.String
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indices&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//sets æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ª map[string]Empty    
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;//empty æ˜¯ä¸€ä¸ª struct{}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;//ä» index ä¸­æˆ‘ä»¬å–åˆ° sets 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;set&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//é€šè¿‡éå† set æˆ‘ä»¬æ‹¿åˆ°æ‰€æœ‰çš„ key ç„¶åä» items é€šè¿‡ key æ‹¿å‡ºæ¥
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;//item æ˜¯ map[string]interface{}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;set&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//æŠŠæ‰€æœ‰ç¬¦åˆçš„ç»“æœè¿”å›
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;index ä¸­çš„ç¼“å­˜æ•°æ®ä¸º set é›†åˆæ•°æ®ç»“æ„ï¼Œset æœ¬è´¨ä¸ slice ç›¸åŒï¼Œä½†æ˜¯ set æ˜¯ä¸€ä¸ª map ä¸å­˜åœ¨ç›¸åŒå…ƒç´ ï¼Œkubernetes é€šè¿‡ map ç»“æ„ç±»å‹çš„ key ä½œä¸º set æ•°æ®ç»“æ„ï¼Œå®ç° set å»é‡ç‰¹æ€§&lt;/p&gt;
&lt;h3 id=&#34;4å·¥ä½œæµç¨‹&#34;&gt;4.å·¥ä½œæµç¨‹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;controller manager åœ¨å¯åŠ¨çš„æ—¶å€™ä¼šå¯åŠ¨ä¸€ä¸ª sharedInformerFactory è¿™æ˜¯ä¸€ä¸ª informer çš„é›†åˆï¼ˆinformers map[reflect.Type]cache.SharedIndexInformerï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;controller åœ¨ run çš„æ—¶å€™ä¼šè°ƒç”¨ reflector çš„ runï¼Œreflector åœ¨ run çš„æ—¶å€™ä¼š listen and watchï¼Œå½“æœ‰ event çš„æ—¶å€™æ’å…¥æœ¬åœ°ç¼“å­˜ DeltaFIFO ä¸­å¹¶æ›´æ–° ResouVersionã€‚&lt;/li&gt;
&lt;li&gt;controller manager ä¼š watch and listen api-server çš„ eventï¼Œå½“æœ‰äº‹ä»¶äº§ç”Ÿçš„æ—¶å€™ï¼Œä¼šé€šè¿‡ reflector æ’å…¥ deltafifoï¼Œ&lt;/li&gt;
&lt;li&gt;DeltaFIFO æ˜¯ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—ï¼Œé€šè¿‡ç”Ÿäº§è€…ï¼ˆadd ç­‰ç­‰ï¼‰æ¶ˆè´¹è€…ï¼ˆpopï¼‰ä¹‹åé€šè¿‡ sharedProcessor.distribute åˆ†å‘ç»™æ‰€æœ‰ listener ç„¶åé€šè¿‡ä¸åŒ controller æ³¨å†Œçš„ handler æ¥åšé€»è¾‘å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;æœ€å indexer å»åšæ“ä½œè°ƒç”¨ treadsafestore ä¹Ÿå°±æ˜¯åº•å±‚å­˜å‚¨çš„æ“ä½œé€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ä¸‰informer&#34;&gt;ä¸‰ã€informer&lt;/h2&gt;
&lt;h3 id=&#34;1èµ„æº-informer&#34;&gt;1.èµ„æº informer&lt;/h3&gt;
&lt;p&gt;æ¯ä¸€ä¸ª kubernetes èµ„æºéƒ½å®ç°äº† informer æœºåˆ¶ï¼Œæ¯ä¸€ä¸ª informer ä¸Šéƒ½ä¼šäº‹å…ˆ informer çš„ lister æ–¹æ³• ä¾‹å¦‚ pod informerã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//path: staging/src/k8s.io/client-go/informers/core/v1/pod.go 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PodInformer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nf&#34;&gt;Informer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SharedIndexInformer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nf&#34;&gt;Lister&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PodLister&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;2shared-informer&#34;&gt;2.shared informer&lt;/h3&gt;
&lt;h4 id=&#34;1ç®€ä»‹&#34;&gt;ï¼ˆ1ï¼‰ç®€ä»‹&lt;/h4&gt;
&lt;p&gt;informer ä¹Ÿè¢«ç§°ä¸º shared informerï¼Œä»–æ˜¯å¯ä»¥å…±äº«ä½¿ç”¨çš„ï¼Œå¦‚æœæ¯ä¸€ä¸ª informer ä½¿ç”¨ä¸€ä¸ª reflector é‚£ä¹ˆä¼šè¿è¡Œç›¸å½“å¤šçš„ listandwatch ä¼šå¢åŠ  api çš„å¤æ‚ã€‚shared informer å¯ä»¥ä½¿åŒä¸€ç±»èµ„æº informer å…±äº«ä¸€ä¸ª reflector å¯ä»¥èŠ‚çº¦èµ„æºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//path: staging/src/k8s.io/client-go/informers/factory.go 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sharedInformerFactory&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;           &lt;span class=&#34;nx&#34;&gt;kubernetes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Interface&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;namespace&lt;/span&gt;        &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;tweakListOptions&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;internalinterfaces&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TweakListOptionsFunc&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;             &lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Mutex&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;defaultResync&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Duration&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;customResync&lt;/span&gt;     &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Duration&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//é€šè¿‡ map æ¥å­˜å‚¨  èµ„æºç±»å‹ä¸ SharedIndexInformer çš„å¯¹åº”å…³ç³» 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;informers&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SharedIndexInformer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// startedInformers is used for tracking which informers have been started.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// This allows Start() to be called multiple times safely.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;startedInformers&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//é€šè¿‡ informer æ–¹æ³•æ·»åŠ ä¸åŒèµ„æºçš„ informer å¦‚æœå·²å­˜åœ¨åˆ™è¿”å›å½“å‰çš„ informer ä¸å†ç»§ç»­æ·»åŠ 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sharedInformerFactory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;InformerFor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newFunc&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;internalinterfaces&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NewInformerFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SharedIndexInformer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//æ‹¿åˆ° obj çš„ type 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;informerType&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TypeOf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//é€šè¿‡ obj type è·å– informer å¦‚æœå­˜åœ¨ç›´æ¥è¿”å›
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;informer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;informers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;informerType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;informer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;resyncPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;customResync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;informerType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;resyncPeriod&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;defaultResync&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;informer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resyncPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//åœ¨ map ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„ type è·Ÿ informer çš„æ˜ å°„å…³ç³»
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;informers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;informerType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;informer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;informer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;2å¯åŠ¨-informer&#34;&gt;ï¼ˆ2ï¼‰å¯åŠ¨ informer&lt;/h4&gt;
&lt;p&gt;è°ƒç”¨ informer çš„ start æ–¹æ³•è®© æ‰€æœ‰ informers ä¸­çš„ informer é€šè¿‡ goroutine æŒä¹…è¿è¡Œã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//path: staging/src/k8s.io/client-go/informers/factory.go 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sharedInformerFactory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;informerType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;informer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;informers&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;//éå† informers å¦‚æœä»–çš„çŠ¶æ€æ—¶ true é‚£ä¹ˆå®ƒå±äºå¯åŠ¨çŠ¶æ€ å¦‚æœä¸æ˜¯é‚£ä¹ˆ run èµ·æ¥å¹¶ä¸”ä¿®æ”¹ä»–çš„çŠ¶æ€
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;startedInformers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;informerType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;informer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;startedInformers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;informerType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//path: staging/src/k8s.io/client-go/tools/cache/shared_informer.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//è¿™é‡Œçš„ run è°ƒç”¨äº† shared informer çš„ run æ–¹æ³•
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sharedIndexInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;utilruntime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HandleCrash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;//åˆ›å»º fifo é˜Ÿåˆ—
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;fifo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewDeltaFIFO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MetaNamespaceKeyFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;//åˆå§‹åŒ– config
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;cfg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nx&#34;&gt;Queue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;            &lt;span class=&#34;nx&#34;&gt;fifo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nx&#34;&gt;ListerWatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listerWatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nx&#34;&gt;ObjectType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;objectType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nx&#34;&gt;FullResyncPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;resyncCheckPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nx&#34;&gt;RetryOnError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nx&#34;&gt;ShouldResync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;shouldResync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nx&#34;&gt;Process&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;HandleDeltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 	&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;//è°ƒç”¨ controller.run
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;controller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//path: staging/src/k8s.io/client-go/tools/cache/controller.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;controller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;utilruntime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HandleCrash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Queue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//åˆå§‹åŒ–ä¸€ä¸ª reflector
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewReflector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ListerWatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ObjectType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Queue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;FullResyncPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ShouldResync&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ShouldResync&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;clock&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;clock&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reflectorMutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reflector&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reflectorMutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Group&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//controller æœ€åä¹Ÿæ˜¯è°ƒç”¨çš„ reflector çš„ run
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;StartWithChannel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Until&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processLoop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//path: staging/src/k8s.io/client-go/tools/cache/reflector.go
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//controller run çš„æ—¶å€™ä¼šæŠŠ reflector run èµ·æ¥ï¼Œè°ƒç”¨ reflector çš„ listandwatch
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Reflector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Starting reflector %v (%s) from %s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;expectedType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;resyncPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Until&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ListAndWatch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;utilruntime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HandleError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;period&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å››é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥ç†è§£-informer-æœºåˆ¶&#34;&gt;å››ã€é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥ç†è§£ informer æœºåˆ¶&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;k8s.io/apimachinery/pkg/apis/meta/v1&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;k8s.io/client-go/informers&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;k8s.io/client-go/kubernetes&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;k8s.io/client-go/tools/clientcmd&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;time&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;s&#34;&gt;&amp;#34;k8s.io/client-go/tools/cache&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;clientcmd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;BuildConfigFromFlags&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;config&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nb&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//é€šè¿‡ config æ‹¿åˆ° client set å®¢æˆ·ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;clientset&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kubernetes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewForConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nb&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;stopch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//é€šè¿‡ client set å®¢æˆ·ç«¯ä»¥åŠä¸€ä¸ª rsyncï¼ˆå¤šä¹…è®¾ç½®ä¸€æ¬¡é‡æ–°åŒæ­¥ ä¹Ÿå°±æ˜¯åŒæ­¥é—´éš”æ—¶é—´ å¦‚æœæ˜¯ 0 é‚£ä¹ˆç¦ç”¨åŒæ­¥åŠŸèƒ½ï¼‰æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ª informer çš„é›†åˆ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;sharedinformers&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;informers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewSharedInformerFactory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;clientset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Minute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//é€šè¿‡ sharedinfomers æˆ‘ä»¬è·å–åˆ° pod çš„ informer
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;podinfomer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sharedinformers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Core&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;V1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Informer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//ä¸º pod informer æ·»åŠ  controller çš„ handlerfunc  è§¦å‘å›è°ƒå‡½æ•°ä¹‹å ä¼šé€šè¿‡ addch ä¼ ç»™ nextCh ç®¡é“ç„¶åè°ƒç”¨ controller çš„å¯¹åº”çš„ handler æ¥åšå¤„ç†
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;podinfomer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddEventHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResourceEventHandlerFuncs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//pod èµ„æºå¯¹è±¡åˆ›å»ºçš„æ—¶å€™å‡ºå‘çš„å›è°ƒæ–¹æ³•
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;AddFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;obja&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obja&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;//æ›´æ–°å›è°ƒ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;UpdateFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newObj&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;//åˆ é™¤å›è°ƒ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;DeleteFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;//è¿™é‡Œä¼šè°ƒç”¨ reflector çš„ run listandwatch ç„¶åä»¥ goroutine çš„æ–¹å¼è¿è¡Œ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;podinfomer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;äº”æ€»ç»“&#34;&gt;äº”ã€æ€»ç»“&lt;/h2&gt;
&lt;p&gt;é€šè¿‡å¯¹ informer çš„æ¶æ„çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å¼•å‡ºäº† reflectorã€deltafifoã€indexer å‡ ä¸ªæ ¸å¿ƒçš„çŸ¥è¯†ç‚¹ï¼Œå¯ä»¥è®©æˆ‘ä»¬æ›´åŠ æ·±å…¥çš„äº†è§£ informer çš„å·¥ä½œæµç¨‹ï¼Œä»¥æ­¤æ¥ç†Ÿæ‚‰ controllerï¼Œå¹¶ä¸”å¯¹äºæˆ‘ä»¬è‡ªå·±å¼€å‘ controller ä¹Ÿéå¸¸æœ‰å¸®åŠ©ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å‚è€ƒèµ„æ–™&#34;&gt;å‚è€ƒèµ„æ–™&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.ihypo.net/15763910382218.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://blog.ihypo.net/15763910382218.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.broadview.com.cn/book/6104&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://www.broadview.com.cn/book/6104&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes Informer æœºåˆ¶æºç è§£æ</title>
      <link>https://cloudnativecn.com/blog/informer-study/</link>
      <pubDate>Fri, 28 Aug 2020 16:55:00 +0000</pubDate>
      <guid>https://cloudnativecn.com/blog/informer-study/</guid>
      <description>&lt;h2 id=&#34;overview&#34;&gt;Overview&lt;/h2&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯å­¦ä¹  Informer æœºåˆ¶å¹¶ä¸”ç†è§£ Informer å„ä¸ªç»„ä»¶çš„è®¾è®¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆ Kubernetes éœ€è¦ Informer æœºåˆ¶ï¼Ÿæˆ‘ä»¬çŸ¥é“ Kubernetes å„ä¸ªç»„ä»¶éƒ½æ˜¯é€šè¿‡ REST API è·Ÿ API Server äº¤äº’é€šä¿¡çš„ï¼Œè€Œå¦‚æœæ¯æ¬¡æ¯ä¸€ä¸ªç»„ä»¶éƒ½ç›´æ¥è·Ÿ API Serveräº¤äº’å»è¯»å–/å†™å…¥åˆ°åç«¯çš„etcdçš„è¯ï¼Œä¼šå¯¹API Server ä»¥åŠ etcd é€ æˆéå¸¸å¤§çš„è´Ÿæ‹…ã€‚è€Œ Informer æœºåˆ¶æ˜¯ä¸ºäº†ä¿è¯å„ä¸ªç»„ä»¶ä¹‹é—´é€šä¿¡çš„å®æ—¶æ€§ã€å¯é æ€§ï¼Œå¹¶ä¸”å‡ç¼“å¯¹ API Server å’Œ etcd çš„è´Ÿæ‹…ã€‚&lt;/p&gt;
&lt;h2 id=&#34;informer-æµç¨‹&#34;&gt;Informer æµç¨‹&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªæµç¨‹ï¼Œå»ºè®®å…ˆçœ‹çœ‹&lt;a href=&#34;https://github.com/JaneLiuL/study-client-go/blob/master/fromcontrollerstudyinformer.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ã€ŠFrom Controller Study Informerã€‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæˆ‘ä»¬ä»¥ CoreV1. Pod èµ„æºä¸ºä¾‹å­ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç¬¬ä¸€æ¬¡å¯åŠ¨ Informer çš„æ—¶å€™ï¼ŒReflector ä¼šä½¿ç”¨&lt;code&gt;List&lt;/code&gt;ä» API Server ä¸»åŠ¨è·å– CoreV1. Pod çš„æ‰€æœ‰èµ„æºå¯¹è±¡ä¿¡æ¯ï¼Œé€šè¿‡&lt;code&gt;resync&lt;/code&gt;å°†èµ„æºå­˜æ”¾åœ¨&lt;code&gt;Store&lt;/code&gt;ä¸­&lt;/li&gt;
&lt;li&gt;æŒç»­ä½¿ç”¨&lt;code&gt;Reflector&lt;/code&gt;å»ºç«‹é•¿è¿æ¥ï¼Œå»&lt;code&gt;Watch&lt;/code&gt; API Server å‘æ¥çš„èµ„æºå˜æ›´äº‹ä»¶&lt;/li&gt;
&lt;li&gt;å½“ 2 ç›‘æ§åˆ° CoreV1.Pod çš„èµ„æºå¯¹è±¡æœ‰å¢åŠ /åˆ é™¤/ä¿®æ”¹ä¹‹åï¼Œå°±æŠŠèµ„æºå¯¹è±¡å­˜æ”¾åœ¨&lt;code&gt;DeltaFIFO&lt;/code&gt;ä¸­&lt;/li&gt;
&lt;li&gt;&lt;code&gt;DeltaFIFO&lt;/code&gt;æ˜¯ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼Œåªè¦è¿™ä¸ªé˜Ÿåˆ—æœ‰æ•°æ®ï¼Œå°±è¢« Pop åˆ° Controller ä¸­ï¼Œå°†è¿™ä¸ªèµ„æºå¯¹è±¡å­˜å‚¨è‡³&lt;code&gt;Indexer&lt;/code&gt;ä¸­ï¼Œå¹¶ä¸”å°†è¯¥èµ„æºå¯¹è±¡åˆ†å‘è‡³&lt;code&gt;ShareInformer&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Controller ä¼šè§¦å‘&lt;code&gt;Process&lt;/code&gt;å›è°ƒå‡½æ•°&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;æ‰“è„¸&#34;&gt;æ‰“è„¸&lt;/h3&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œæˆ‘è‡ªå·±ä¹‹å‰å†™ä»£ç çš„æ—¶å€™ï¼Œä¸€ç›´ä»¥ä¸ºæ˜¯&lt;code&gt;ShareInformer&lt;/code&gt;å»ä¸»åŠ¨ watch API Server, è€Œç°åœ¨æ­£æ­£æ‰“è„¸äº†ï¼Œæ˜¯&lt;code&gt;Reflector&lt;/code&gt;åšçš„ List&amp;amp;Watchã€‚&lt;/p&gt;
&lt;h3 id=&#34;listandwatch-æ€è€ƒ&#34;&gt;ListAndWatch æ€è€ƒ&lt;/h3&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆ Kubernetes é‡Œé¢æ˜¯ä½¿ç”¨ ListAndWatch å‘¢ï¼Ÿæˆ‘ä»¬æ‰€çŸ¥é“çš„å…¶ä»–åˆ†å¸ƒå¼ç³»ç»Ÿå¸¸å¸¸ä½¿ç”¨ RPC æ¥è§¦å‘è¡Œä¸ºã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ¥åˆ†æä¸‹å¦‚æœä¸è¿™æ ·åšï¼Œè€Œæ˜¯é‡‡ç”¨ API Server è½®è¯¢æ¨é€æ¶ˆæ¯ç»™å„ä¸ªç»„ä»¶ï¼Œæˆ–è€…å„ä¸ªç»„ä»¶è½®è¯¢å»è®¿é—® API Server çš„è¯ï¼Œé‚£ä¹ˆ&lt;strong&gt;å®æ—¶æ€§&lt;/strong&gt;å°±å¾—ä¸åˆ°ä¿è¯ï¼Œå¹¶ä¸”å¯¹ API Server é€ æˆå¾ˆå¤§çš„è´Ÿè½½ï¼Œå¾ˆæœ‰å¯èƒ½éœ€è¦å¼€å¯å¤§é‡çš„ç«¯å£é€ æˆç«¯å£æµªè´¹ã€‚&lt;/p&gt;
&lt;p&gt;ä»å®æ—¶æ€§å‡ºå‘çš„è¯ï¼š&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¸Œæœ›æ˜¯æœ‰ä»»ä½•èµ„æºçš„æ–°å¢/æ”¹åŠ¨/åˆ é™¤ï¼Œéƒ½éœ€è¦é©¬ä¸Šè·å–å¹¶ä¸”æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—ã€‚å¯ä»¥å¯¹åº”æˆ‘ä»¬Informerä¸­çš„&lt;code&gt;Reflector&lt;/code&gt;ç»„ä»¶ï¼Œå»ä¸»åŠ¨è·å–æ¶ˆæ¯ï¼Œå¹¶ä¸”æ”¾å…¥&lt;code&gt;DeltaFIFO&lt;/code&gt;é˜Ÿåˆ—è¢«æ¶ˆè´¹ã€‚&lt;/p&gt;
&lt;p&gt;ä»å‡è½»è´Ÿè½½å‡ºå‘çš„è¯ï¼š&lt;/p&gt;
&lt;p&gt;éœ€è¦ä¸Šç¼“å­˜ï¼Œè¿™é‡Œå¯ä»¥å¯¹åº”æˆ‘ä»¬çš„&lt;code&gt;Store&lt;/code&gt;ç»„ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;ä»è®¾è®¡æ‰©å±•æ€§å‡ºå‘çš„è¯ï¼š&lt;/p&gt;
&lt;p&gt;ä½œä¸ºä¸€ä¸ªâ€œèµ„æºç®¡ç†ç³»ç»Ÿâ€çš„ Kubernetesï¼Œæˆ‘ä»¬çš„å¯¹è±¡æ•°é‡å¯èƒ½ä¼šæ— é™æ‰©å¤§ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€ä¸ªé«˜æ•ˆæ‰©å±•çš„ç»„ä»¶ï¼Œå»åº”å¯¹å¯¹è±¡çš„ç§ç±»æ— é™æ‰©å¤§ï¼Œå¹¶ä¸”åŒä¸€ç§å¯¹è±¡å¯èƒ½ä¼šè¢«ç”¨æˆ·å®ä¾‹åŒ–éå¸¸å¤šæ¬¡çš„è¡Œä¸ºã€‚è¿™é‡Œå¯ä»¥å¯¹åº”æˆ‘ä»¬çš„&lt;code&gt;ShareInformer&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä»æ¶ˆæ¯çš„å¯é æ€§å‡ºå‘çš„è¯ï¼š&lt;/p&gt;
&lt;p&gt;åˆšåˆšè¯´äº†è¿™ä¹ˆå¤šï¼Œéƒ½æ˜¯è¿›è¡Œé•¿è¿æ¥å» Watch çš„ï¼Œä¸‡ä¸€ç½‘ç»œå‡ºé”™æ€ä¹ˆåŠï¼Ÿè¿™ä¸ªæ—¶å€™æˆ‘ä»¬çš„ List æœºåˆ¶å°±å¾ˆæ˜æ˜¾å‘æŒ¥ä½œç”¨ï¼Œä¸€æ—¦æ„ŸçŸ¥è·Ÿ API Server ä¸­æ–­ï¼Œæˆ–è€…ç¬¬ä¸€æ¬¡å¯åŠ¨ï¼Œéƒ½æ˜¯ä½¿ç”¨ List æœºåˆ¶çš„ï¼ŒList ä½œä¸ºä¸€ä¸ªçŸ­è¿æ¥å»è·å–èµ„æºä¿¡æ¯ï¼ŒWatch ä½œä¸ºé•¿è¿æ¥å»æŒç»­æ¥æ”¶èµ„æºçš„å˜æ›´å¹¶ä¸”å¤„ç†ã€‚ï¼ˆç”¨ List&amp;amp;Watch å¯ä»¥ä¿è¯ä¸ä¼šæ¼æ‰ä»»ä½•äº‹ä»¶ï¼‰&lt;/p&gt;
&lt;h4 id=&#34;watch-çš„å®ç°&#34;&gt;Watch çš„å®ç°&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;Watch&lt;/code&gt;æ˜¯é€šè¿‡ HTTP é•¿è¿æ¥æ¥æ”¶ API Server å‘é€çš„èµ„æºå˜æ›´äº‹ä»¶ï¼Œä½¿ç”¨çš„&lt;code&gt;Chunked transfer coding&lt;/code&gt;ï¼Œä»£ç ä½ç½®&lt;code&gt;./staging/src/k8s.io/apiserver/pkg/endpoints/handlers/watch.go&lt;/code&gt;ï¼Œæºç å¦‚ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;streaming&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewEncoder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;framer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Encoder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// ensure the connection times out
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;timeoutCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cleanup&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TimeoutFactory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TimeoutCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cleanup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// begin the stream
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Set&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Content-Type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MediaType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Set&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Transfer-Encoding&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;chunked&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WriteHeader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;StatusOK&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;flusher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬é€šè¿‡&lt;code&gt;curl&lt;/code&gt;æ¥çœ‹çœ‹ï¼Œåœ¨&lt;code&gt;response&lt;/code&gt;çš„&lt;code&gt;Header&lt;/code&gt;ä¸­è®¾ç½®&lt;code&gt;Transfer-Encoding&lt;/code&gt;çš„å€¼æ˜¯&lt;code&gt;chunked&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# curl -i http://127.0.0.1:8001/api/v1/watch/namespaces?watch=yes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Cache-Control: no-cache, private
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Content-Type: application/json
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Date: Sun, &lt;span class=&#34;m&#34;&gt;09&lt;/span&gt; Aug &lt;span class=&#34;m&#34;&gt;2020&lt;/span&gt; 02:44:07 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Transfer-Encoding: chunked
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;ADDED&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;object&amp;#34;&lt;/span&gt;:&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;kind&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;Namespace&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;apiVersion&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;v1&amp;#34;&lt;/span&gt;,&lt;span class=&#34;s2&#34;&gt;&amp;#34;metadata&amp;#34;&lt;/span&gt;:&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;:&lt;span class=&#34;s2&#34;&gt;&amp;#34;...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç›‘å¬äº‹ä»¶-reflector&#34;&gt;ç›‘å¬äº‹ä»¶ Reflector&lt;/h2&gt;
&lt;p&gt;æˆ‘çš„ç†è§£ï¼ŒReflector æ˜¯å®ç°å¯¹æŒ‡å®šçš„ç±»å‹å¯¹è±¡çš„ç›‘æ§ï¼Œæ—¢åŒ…æ‹¬ Kubernetes å†…ç½®èµ„æºï¼Œä¹Ÿå¯ä»¥æ˜¯ CRD è‡ªå®šä¹‰èµ„æºã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ•°æ®ç»“æ„&#34;&gt;æ•°æ®ç»“æ„&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬æ¥çœ‹çœ‹ Reflector çš„æ•°æ®ç»“æ„ï¼Œä»£ç å—&lt;code&gt;staging/src/k8s.io/client-go/tools/cache/reflector.go&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;listerWatcher å…¶å®å°±æ˜¯ä» API Server é‡Œé¢å»åš List è·Ÿ Watch çš„æ“ä½œå»è·å–å¯¹è±¡çš„å˜æ›´ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Reflector&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ç›‘æ§çš„å¯¹è±¡ç±»å‹ï¼Œæ¯”å¦‚ Pod
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;expectedType&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// å­˜å‚¨
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;store&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Store&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ListerWatcher æ˜¯é’ˆå¯¹æŸä¸€ç±»å¯¹è±¡ï¼Œæ¯”å¦‚ Pod
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;listerWatcher&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ListerWatcher&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;period&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Duration&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;resyncPeriod&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Duration&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;ShouldResync&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;run&#34;&gt;Run&lt;/h3&gt;
&lt;p&gt;Run æ˜¯å¾ªç¯ä¸€ç›´æŠŠæ•°æ®å­˜å‚¨åˆ°&lt;code&gt;DeltaFIFO&lt;/code&gt;ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Reflector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Starting reflector %v (%s) from %s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;expectedType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;resyncPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Until&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ListAndWatch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;utilruntime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HandleError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;period&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼ŒReflector æ˜¯ä¸€ç›´åœ¨æ‰§è¡Œ ListAndWatch, é™¤éæ”¶åˆ°æ¶ˆæ¯ stopCh è¦è¢«å…³é—­ï¼ŒRun æ‰ä¼šé€€å‡ºã€‚&lt;/p&gt;
&lt;h3 id=&#34;listandwatch&#34;&gt;ListAndWatch&lt;/h3&gt;
&lt;p&gt;ä¹¦ä¸ŠæŠŠè¿™ä¸€æ®µè®²å¾—å¾ˆè¯¦ç»†äº†ï¼Œæˆ‘è´´è¿™æ®µä»£ç ï¼Œæ˜¯ä¸ºäº†ç»™ä¸‹é¢çš„ Kubernetes å¹¶å‘çš„ç« èŠ‚ç”¨çš„ï¼Œè¿™é‡Œç”¨åˆ°äº†&lt;code&gt;GetResourceVersion&lt;/code&gt; &lt;code&gt;setLastSyncResourceVersion&lt;/code&gt;ç­‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Reflector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ListAndWatch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Listing and watching %v from %s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;expectedType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resourceVersion&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Explicitly set &amp;#34;0&amp;#34; as resource version - it&amp;#39;s fine for the List()
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// to be served from cache and potentially be delayed relative to
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// etcd contents. Reflector framework will catch up via Watch() eventually.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ListOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResourceVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;initTrace&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;trace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;New&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Reflector &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34; ListAndWatch&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;initTrace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;LogIfLong&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;listCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;panicCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;recover&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;panicCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;c1&#34;&gt;// å…ˆ List
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listerWatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;List&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nb&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;panicCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nb&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%s: Failed to list %v: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;expectedType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;initTrace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Step&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Objects listed&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;listMetaInterface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;meta&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ListAccessor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%s: Unable to understand list result %#v: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;resourceVersion&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;listMetaInterface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetResourceVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;initTrace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Step&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Resource version extracted&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;meta&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ExtractList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%s: Unable to understand list result %#v (%v)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;initTrace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Step&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Objects extracted&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;syncWith&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resourceVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%s: Unable to sync list result: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;initTrace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Step&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;SyncWith done&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;setLastSyncResourceVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;resourceVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;initTrace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Step&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Resource version updated&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}();&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;resyncerrc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;cancelCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cancelCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;resyncCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cleanup&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;resyncChan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nf&#34;&gt;cleanup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Call the last one written into cleanup
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;resyncCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cancelCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ShouldResync&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ShouldResync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%s: forcing resync&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;store&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Resync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;resyncerrc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nf&#34;&gt;cleanup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;resyncCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cleanup&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;resyncChan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// give the stopCh a chance to stop the loop, even in case of continue statements further down on errors
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;timeoutSeconds&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;minWatchTimeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Seconds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rand&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Float64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1.0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ListOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;ResourceVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resourceVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;c1&#34;&gt;// We want to avoid situations of hanging watchers. Stop any wachers that do not
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;c1&#34;&gt;// receive any events within the timeout window.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;TimeoutSeconds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;timeoutSeconds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listerWatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Watch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;io&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EOF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;c1&#34;&gt;// watch closed normally
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;io&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ErrUnexpectedEOF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%s: Watch for %v closed with unexpected EOF: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;expectedType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;utilruntime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HandleError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%s: Failed to watch %v: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;expectedType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;c1&#34;&gt;// If this is &amp;#34;connection refused&amp;#34; error, it means that most likely apiserver is not responsive.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;c1&#34;&gt;// It doesn&amp;#39;t make sense to re-list all objects because most likely we will be able to restart
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;c1&#34;&gt;// watch where we ended.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;c1&#34;&gt;// If that&amp;#39;s the case wait and resend watch request.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;urlError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;opError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;urlError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;OpError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;errno&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;opError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;syscall&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Errno&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;errno&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;syscall&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ECONNREFUSED&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;						&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;						&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;watchHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;resourceVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resyncerrc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;errorStopRequested&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Warningf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%s: watch of %v ended with: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;expectedType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;kubernetes-å¹¶å‘&#34;&gt;Kubernetes å¹¶å‘&lt;/h4&gt;
&lt;p&gt;ä» ListAndWatch çš„ä»£ç ï¼Œæœ‰ä¸€æ®µå…³äº&lt;code&gt;syncWith&lt;/code&gt;çš„æ–¹æ³•ï¼Œæ¯”è¾ƒé‡è¦ï¼ŒåŸæ¥ Kubernetes çš„å¹¶å‘æ˜¯é€šè¿‡&lt;code&gt;ResourceVersion&lt;/code&gt;æ¥å®ç°çš„ï¼Œæ¯æ¬¡å¯¹è¿™ä¸ªå¯¹è±¡çš„æ”¹åŠ¨ï¼Œéƒ½ä¼šæŠŠè¯¥å¯¹è±¡çš„&lt;code&gt;ResourceVersion&lt;/code&gt;åŠ ä¸€ã€‚&lt;/p&gt;
&lt;h2 id=&#34;äºŒçº§ç¼“å­˜-deltafifo-å’Œ-store&#34;&gt;äºŒçº§ç¼“å­˜ DeltaFIFO å’Œ Store&lt;/h2&gt;
&lt;h3 id=&#34;deltafifo&#34;&gt;DeltaFIFO&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬é€šè¿‡æ•°æ®ç»“æ„æ¥ç†è§£ DeltaFIFOï¼Œæˆ‘ä»¬å…ˆæ¥ç†è§£ä¸€ä¸‹ Deltaã€‚&lt;/p&gt;
&lt;p&gt;ä»£ç å—&lt;code&gt;staging/src/k8s.io/client-go/tools/cache/delta_fifo.go&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡ä¸‹é¢çš„ä»£ç å—ï¼Œæˆ‘ä»¬å¯ä»¥éå¸¸æ¸…æ™°çœ‹å¾—å‡ºï¼Œ&lt;code&gt;Delta&lt;/code&gt;å…¶å®æ˜¯ä¸€ä¸ªèµ„æºå¯¹è±¡å­˜å‚¨ï¼Œä¿å­˜ä¾‹å¦‚ Pod çš„ Added æ“ä½œç­‰ã€‚ç”¨ç™½è¯æ¥è¯´å…¶å®å°±æ˜¯è®°å½• Kubernetes æ¯ä¸€ä¸ªå¯¹è±¡çš„å˜åŒ–ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Delta&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt;   &lt;span class=&#34;nx&#34;&gt;DeltaType&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;DeltaType&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;Added&lt;/span&gt;   &lt;span class=&#34;nx&#34;&gt;DeltaType&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Added&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;Updated&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;DeltaType&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Updated&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;Deleted&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;DeltaType&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Deleted&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;Sync&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;DeltaType&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Sync&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;FIFO å°±æ¯”è¾ƒå®¹æ˜“ç†è§£äº†ï¼Œå°±æ˜¯ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—ã€‚ä¹Ÿå¯ä»¥çœ‹çœ‹ä»£ç å—&lt;code&gt;staging/src/k8s.io/client-go/tools/cache/fifo.go&lt;/code&gt;å»çœ‹ä»–çš„å®ç°ï¼Œå¦‚ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Queue&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;Store&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// å¯ä»¥çœ‹å‡ºæ¥ Queue æ˜¯åœ¨ Store çš„åŸºç¡€ä¸Šæ‰©å±•äº† Popï¼Œå¯ä»¥è®©å¯¹è±¡å¼¹å‡ºã€‚è¿™é‡Œå¦‚æœå¯¹æ¯”ä¸€ä¸‹ Indexer çš„æ•°æ®ç»“æ„å‘ç°å¾ˆæœ‰æ„æ€ï¼ŒIndexer æ˜¯åœ¨ Store çš„åŸºç¡€ä¸ŠåŠ äº†ç´¢å¼•ï¼Œå»å¿«é€Ÿæ£€ç´¢å¯¹è±¡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nf&#34;&gt;Pop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PopProcessFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nf&#34;&gt;AddIfNotPresent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nf&#34;&gt;HasSynced&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nf&#34;&gt;Close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“åˆèµ·æ¥ï¼ŒDeltaFIFO å…¶å®å°±æ˜¯ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„ Kubernetes å¯¹è±¡å˜åŒ–çš„é˜Ÿåˆ—ï¼Œè¿™ä¸ªé˜Ÿåˆ—ä¸­å­˜å‚¨ä¸åŒæ“ä½œç±»å‹çš„åŒä¸€ä¸ªèµ„æºå¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;DeltaFIFO ä¸­çš„ GET æ–¹æ³•æˆ–è€… GetByKey éƒ½æ¯”è¾ƒç®€å•ï¼Œæ¥ä¸‹æ¥å¯¹ queueActionLocked() å‡½æ•°é‡ç‚¹è¯´æ˜ã€‚&lt;/p&gt;
&lt;h4 id=&#34;queueactionlocked&#34;&gt;queueActionLocked&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DeltaFIFO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;queueActionLocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;actionType&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;DeltaType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// æ‹¿åˆ°å¯¹è±¡çš„ Key
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;KeyOf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;KeyError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// æŠŠåŒä¸€ä¸ªå¯¹è±¡çš„ä¸åŒçš„ actionTypeï¼Œéƒ½æ·»åŠ åˆ° newDeltas åˆ—è¡¨ä¸­
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;newDeltas&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Delta&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;actionType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// åˆå¹¶å»é‡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;newDeltas&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;dedupDeltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;newDeltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;c1&#34;&gt;// æˆ‘ä¸€å¼€å§‹ç†è§£ä¸äº†ï¼Œè§‰å¾—ä¸å¯èƒ½å­˜åœ¨&amp;lt;=0 çš„æƒ…å†µï¼Œæœ€æ–°çš„ Kubernetes çš„ä»£ç é‡Œé¢æ³¨é‡Šè¯´äº†ï¼Œæ­£å¸¸æƒ…å†µä¸‹ä¸ä¼šå‡ºç°&amp;lt;=0ï¼ŒåŠ è¿™ä¸ªåˆ¤æ–­å±äºå†—ä½™åˆ¤æ–­
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;newDeltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;queue&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;queue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newDeltas&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Broadcast&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nb&#34;&gt;delete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;çœ‹çœ‹&lt;strong&gt;å»é‡&lt;/strong&gt;çš„ä»£ç &lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;dedupDeltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;deltas&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Deltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Deltas&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;deltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// å°‘äº 2 ä¸ªä¹Ÿå°±æ˜¯å¾—ä¸€ä¸ªï¼Œä¸éœ€è¦åˆå¹¶äº†ï¼Œç›´æ¥è¿”å›
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;deltas&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;deltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;deltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// è¿™é‡Œï¼Œæœ€åè°ƒäº† isDeletionDupï¼Œè¿™ä¸ªæ˜¯åˆ¤æ–­ä¸€ä¸ªèµ„æºå¯¹è±¡çš„ä¸¤æ¬¡æ“ä½œæ˜¯å¦éƒ½æ˜¯åˆ é™¤ï¼Œå¦‚æœæ˜¯ï¼Œå°±å»é‡ï¼Œä¸éœ€è¦åˆ é™¤ä¸¤æ¬¡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;isDup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Deltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;deltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;deltas&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;isDup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Delta&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Delta&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;isDeletionDup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;out&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// TODO: Detect other duplicate situations? Are there any?
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¹‹å‰ç¾¤é‡Œæœ‰äººé—®ä¸ºä»€ä¹ˆ dedupDeltas åªæ˜¯å»è¿™ä¸ªåˆ—è¡¨çš„å€’æ•°ç¬¬ä¸€ä¸ªè·Ÿå€’æ•°ç¬¬äºŒä¸ªå»è¿›è¡Œåˆå¹¶å»é‡çš„æ“ä½œï¼Œè¿™é‡Œè¯´æ˜ä¸€ä¸‹ï¼ŒdedupDeltas æ˜¯è¢« queueActionLocked å‡½æ•°è°ƒç”¨çš„ï¼Œè€Œ queueActionLocked ä¸ºä»€ä¹ˆæˆ‘ä»¬æ‹¿å‡ºæ¥è®²ï¼Œæ˜¯å› ä¸ºåœ¨ Delete/Update/Add é‡Œé¢å»è°ƒç”¨äº† queueActionLockedï¼Œåˆå¹¶æ˜¯å¯¹æŸä¸€ä¸ª obj çš„ä¸€ç³»åˆ—æ“ä½œï¼Œè€Œå»é‡æ˜¯åªé’ˆå¯¹ deleteã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥æ‹¿ä¸€ä¸ªä¾‹å­æ¥çœ‹çœ‹ï¼Œå‡è®¾æ˜¯[obj1]: [add: delta1, update: delta2, delete: delta3,  delete: delta3] åœ¨ç»è¿‡ queueActionLocked ä¹‹åä¼šå˜æˆ[obj1]: [add: delta1, update: delta2, delete: delta3]&lt;/p&gt;
&lt;h4 id=&#34;æ¶ˆè´¹è€…æ–¹æ³•&#34;&gt;æ¶ˆè´¹è€…æ–¹æ³•&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DeltaFIFO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Pop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;process&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PopProcessFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;queue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;c1&#34;&gt;// ä»»ä½•æ—¶å€™åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦è¢«å…³é—­ä¹‹å‰ï¼Œéƒ½éœ€è¦å…ˆåˆ¤æ–­é˜Ÿåˆ—çš„é•¿åº¦ï¼Œçœ‹ä¸Šæ–¹çš„ len
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;IsClosed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;FIFOClosedError&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;queue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;queue&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;queue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;initialPopulationCount&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;initialPopulationCount&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;--&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;c1&#34;&gt;// Item may have been deleted subsequently.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// å–å‡ºç¬¬ä¸€ä¸ª f.queue[0] å¯¹è±¡ï¼Œä»é˜Ÿåˆ—åˆ é™¤ï¼Œå°†è¯¥å¯¹è±¡äº¤ç»™ process å¤„ç†å¯¹è±¡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nb&#34;&gt;delete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;process&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ErrRequeue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;c1&#34;&gt;// å¤„ç†å¤±è´¥ï¼Œå°±é‡æ–°å…¥é˜Ÿ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;addIfNotPresent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// Don&amp;#39;t need to copyDeltas here, because we&amp;#39;re transferring
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;c1&#34;&gt;// ownership to the caller.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;localstore&#34;&gt;LocalStore&lt;/h4&gt;
&lt;p&gt;ç¼“å­˜æœºåˆ¶ï¼Œä½† LocalStore æ˜¯è¢«&lt;code&gt;Lister&lt;/code&gt;çš„&lt;code&gt;List/Get&lt;/code&gt;æ–¹æ³•è®¿é—®&lt;/p&gt;
&lt;h2 id=&#34;share-informer-å…±äº«æœºåˆ¶&#34;&gt;Share Informer å…±äº«æœºåˆ¶&lt;/h2&gt;
&lt;p&gt;ä»æµç¨‹ä¸Šæˆ‘ä»¬è¯´äº†ï¼Œå› ä¸ºæ˜¯&lt;code&gt;DeltaFIFO&lt;/code&gt;æŠŠæ¶ˆæ¯åˆ†å‘è‡³&lt;code&gt;ShareInformer&lt;/code&gt;ä¸­ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨&lt;code&gt;Informer&lt;/code&gt;æ·»åŠ è‡ªå®šä¹‰çš„å›è°ƒå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç»å¸¸çœ‹åˆ°çš„&lt;code&gt;OnAdd&lt;/code&gt;  &lt;code&gt;OnUpdate&lt;/code&gt;å’Œ&lt;code&gt;OnDelete&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Kubernetes å†…éƒ¨çš„æ¯ä¸€ä¸ªèµ„æºéƒ½å®ç°äº† Informer æœºåˆ¶ï¼Œå¦‚ä¸‹æ˜¯ä¸€ä¸ª Namespace çš„ Informer çš„ä¾‹å­&lt;/p&gt;
&lt;p&gt;ä»£ç å—&lt;code&gt;staging/src/k8s.io/client-go/informers/core/v1/namespace.go&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NamespaceInformer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nf&#34;&gt;Informer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SharedIndexInformer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nf&#34;&gt;Lister&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NamespaceLister&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;indexer&#34;&gt;Indexer&lt;/h2&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯ Indexer çš„æ•°æ®ç»“æ„ï¼Œæ¸…æ™°çš„çœ‹è§ Indexer ç»§æ‰¿äº† Store æ¥å£ï¼Œè¿˜å¢åŠ äº†ç´¢å¼•çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Indexer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;Store&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nf&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexName&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;çœ‹çœ‹æˆ‘ä»¬æµç¨‹ç¬¬å››ä¸ªæ­¥éª¤ï¼š &lt;code&gt;DeltaFIFO&lt;/code&gt;æ˜¯ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼Œåªè¦è¿™ä¸ªé˜Ÿåˆ—æœ‰æ•°æ®ï¼Œå°±è¢« Pop åˆ° Controller ä¸­ï¼Œå°†è¿™ä¸ªèµ„æºå¯¹è±¡å­˜å‚¨è‡³&lt;code&gt;Indexer&lt;/code&gt;ä¸­ã€‚è¿™ä¸ªæ­¥éª¤è¯´æ˜äº† Indexer å­˜å‚¨çš„æ•°æ®æ¥æºã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çœ‹çœ‹ Indexer å…³é”®çš„å‡ ä¸ªç´¢å¼•å‡½æ•°&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ç´¢å¼•å‡½æ•°ï¼Œä¼ å…¥çš„æ˜¯å¯¹è±¡ï¼Œè¿”å›çš„æ˜¯æ£€ç´¢ç»“æœçš„åˆ—è¡¨ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ IndexFunc å»æŸ¥æŸä¸ª Annotation/label çš„ configmap
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;IndexFunc&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ç´¢å¼•å‡½æ•°ï¼Œkey æ˜¯ç´¢å¼•å™¨åè¯ï¼Œvalue æ˜¯ç´¢å¼•å™¨çš„å®ç°å‡½æ•°
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Indexers&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IndexFunc&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;c1&#34;&gt;// ç´¢å¼•å‡½æ•° name   å¯¹åº”å¤šä¸ªç´¢å¼•é”®   å¤šä¸ªå¯¹è±¡é”®   çœŸæ­£å¯¹è±¡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Indices&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Index&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ç´¢å¼•ç¼“å­˜ï¼Œmap ç±»å‹
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Index&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;String&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ€»ç»“ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;Indexers: ç´¢å¼•å‡½æ•° name &amp;ndash;&amp;gt; ç´¢å¼•å®ç°å‡½æ•°&amp;ndash;&amp;gt;ç´¢å¼• key å€¼
Indices: ç´¢å¼•å‡½æ•° name &amp;ndash;&amp;gt; å¯¹åº”å¤šä¸ªç´¢å¼• key å€¼ &amp;ndash;&amp;gt; æ¯ä¸ªç´¢å¼• key å€¼å¯¹åº”ä¸åŒçš„èµ„æº&lt;/p&gt;
&lt;p&gt;ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜çš„è¯ï¼šå¯¹è±¡ Pod æœ‰ä¸€ä¸ªæ ‡ç­¾ app=version1ï¼Œè¿™é‡Œæ ‡ç­¾å°±æ˜¯ç´¢å¼•é”®ï¼ŒIndexer ä¼šæŠŠç›¸åŒæ ‡ç­¾çš„æ‰€æœ‰ Pod æ”¾åœ¨ä¸€ä¸ªé›†åˆé‡Œé¢ï¼Œç„¶åæˆ‘ä»¬å®ç°å¯¹æ ‡ç­¾åˆ†ç±»å°±æ˜¯æˆ‘ä»¬ Indexer çš„æ ¸å¿ƒå†…å®¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;reference&#34;&gt;Reference&lt;/h2&gt;
&lt;p&gt;ã€ŠKubernetes æºç å‰–æã€‹ç¬¬äº”ç« &lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubebuilder ä¸­æ–‡ç¿»è¯‘æ€»ç»“</title>
      <link>https://cloudnativecn.com/blog/kubebuilder-summary/</link>
      <pubDate>Fri, 28 Aug 2020 21:09:42 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/kubebuilder-summary/</guid>
      <description>&lt;p&gt;ä¸ç®¡ä½ å…³æ³¨ä¸å…³æ³¨ï¼Œäº‘åŸç”Ÿå®ƒèµ°æ¥äº†ï¼Œå®ƒä¹˜ç€ä¸‡ä¸ˆå…‰èŠ’çš„ Kubernetes èµ°æ¥äº†ï¼›ä¸ç®¡ä½ æ‰¿è®¤ä¸æ‰¿è®¤ï¼ŒKubernetes å·²ç»æˆä¸ºäº†äº‘è®¡ç®—æ—¶ä»£çš„æ“ä½œç³»ç»Ÿã€‚å¯¹äº Kubernetesï¼Œæœ€ä¸ºå¤§å®¶æ‰€ç†ŸçŸ¥çš„å°±æ˜¯å®ƒå¼ºå¤§çš„å®¹å™¨ç¼–æ’èƒ½åŠ›ï¼ˆåŒä¸ºå®¹å™¨ç¼–æ’çš„è¿˜æœ‰ Mesosã€Docker Swarmï¼Œä½†æ˜¯ Kubernetes å·²æˆä¸€æç‹¬ç§€ï¼‰ï¼Œå…¶å® Kubernetes è¿˜æœ‰ä¸€ä¸ªæ›´å¼ºå¤§çš„èƒ½åŠ›â€”â€”æ‰©å±•èƒ½åŠ›ã€‚å¦‚æœåªæ˜¯åˆ©ç”¨ Kubernetes å†…ç½®çš„èµ„æºåŠ controller ç±»å‹ï¼Œä¹Ÿå°±åªèƒ½åšåˆ°å°†åº”ç”¨â€œæŒªâ€åˆ° Kubernetes ä¸Šï¼Œè€Œä¸æ˜¯çœŸæ­£çš„ Kubernetes åŸç”Ÿã€‚å¦‚æœåˆ©ç”¨ Kubernetes çš„æ‰©å±•èƒ½åŠ›ï¼Œå°±å¯ä»¥å°†åº”ç”¨å˜æˆ Kubernetes åŸç”Ÿçš„äº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;kubernetes-æ‰©å±•ä¹‹-operator&#34;&gt;Kubernetes æ‰©å±•ä¹‹ Operator&lt;/h2&gt;
&lt;p&gt;Kubernetes çš„æ‰©å±•å¯ä»¥é€šè¿‡ Operatorï¼ˆKubernetes API + CRDï¼‰æ¥å®ç°ã€‚åœ¨æ—©æœŸï¼Œä¸ºäº†å®ç°ä¸€ä¸ª Operatorï¼Œç”¨æˆ·éœ€è¦è‡ªå·±å®Œæˆå¾ˆå¤š Kubernetes åŠŸèƒ½çš„å®ç°ï¼Œæ¯”å¦‚ Kubernetes Client çš„åˆ›å»ºï¼ŒKubernetes API Server çš„ç›‘å¬ç­‰ï¼ˆè¿™ä¸€ç‚¹ä»˜ä¸šæˆè€å¸ˆåœ¨äº‘åŸç”Ÿç¤¾åŒºç›´æ’­åˆ†äº« TiDB Operator æ¶æ„ä¸å®ç°çš„æ—¶å€™æåˆ°äº†ï¼Œç”±äº TiDB Operator å¼€å‘åˆæœŸï¼Œæ²¡æœ‰åƒæœ¬æ–‡è¦è®²çš„ä¸»è§’â€”â€” Kubebuilder ç­‰ Operator æ¡†æ¶å‡ºç°çš„æ—¶å€™ï¼Œå¾ˆå¤šåŠŸèƒ½éƒ½æ˜¯ç”±ä»–ä»¬è‡ªå·±å¼€å‘å®ç°çš„ã€‚å…³äºä»˜ä¸šæˆè€å¸ˆçš„ç›´æ’­åˆ†äº«çš„ç›¸å…³æ–‡æ¡£ï¼Œå¯ä»¥ç‚¹å‡»&lt;a href=&#34;https://mp.weixin.qq.com/s?__biz=MzI1NTE2NDE2MA==&amp;amp;mid=2649382450&amp;amp;idx=1&amp;amp;sn=2821ebc10ee82bb96b2ea222c3c86eb2&amp;amp;chksm=f224d45dc5535d4bafbf92d680c2a3bdcdef418f2512b92a54d24de286300810b7080cd6b65a&amp;amp;mpshare=1&amp;amp;scene=1&amp;amp;srcid=0828H8AVRCOE1zF80mDmMyFs&amp;amp;sharer_sharetime=1598606753261&amp;amp;sharer_shareid=69a671b032908bc53da173d06860fd16&amp;amp;exportkey=AelvSvG61dltexVPDUE2ZqY%3D&amp;amp;pass_ticket=xADS2K%2Ba1S5aRSLCMvRl1FI8%2FZ36Aex4ndAjdveOi87TBUPfO8ezl8mwng3JW%2BBm&amp;amp;wx_header=0#rd&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™å„¿&lt;/a&gt;æŸ¥çœ‹ã€‚ç›´æ’­è§†é¢‘é“¾æ¥åœ¨æ–‡æ¡£åº•éƒ¨ï¼Œå¦‚ä¸‹å›¾ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ldquotidb-operatorrdquo&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&amp;ldquo;TiDB Operator&amp;rdquo;&#34; srcset=&#34;
               /blog/kubebuilder-summary/tidb_operator_hu14087280770958589185.webp 400w,
               /blog/kubebuilder-summary/tidb_operator_hu7535002056908909807.webp 760w,
               /blog/kubebuilder-summary/tidb_operator_hu7836527843358983276.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubebuilder-summary/tidb_operator_hu14087280770958589185.webp&#34;
               width=&#34;760&#34;
               height=&#34;453&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      &amp;ldquo;TiDB Operator&amp;rdquo;
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯åœ¨æ•´ä¸ªå¼€å‘è¿‡ç¨‹ä¸­ï¼Œæœ‰äº›é€»è¾‘æ˜¯æ‰€æœ‰ Operator å®ç°è¿‡ç¨‹æ‰€å¿…é¡»çš„ï¼Œå› æ­¤å°±æœ‰äº†å°†è¿™äº›æ‰€æœ‰ Operator å®ç°æ‰€å¿…é¡»çš„é€»è¾‘å°è£…å’ŒæŠ½è±¡æˆäº†å…¬å…±çš„åº“å’Œå·¥å…·ï¼Œä»è€Œå½¢æˆä¸€äº› Operator SDKï¼Œè¿™æ ·å¼€å‘äººå‘˜å°±å¯ä»¥å°†æ›´å¤šçš„ç²¾åŠ›æ”¾åœ¨ Operator ä¸­ä¸è‡ªå·±åº”ç”¨ç¨‹åºç›¸å…³çš„é€»è¾‘å®ç°ä¸Šï¼ŒåŠ é€Ÿäº†å¼€å‘æµç¨‹ã€‚è€Œ Kubebuilder æ­£æ˜¯è¿™äº› SDK ä¸­çš„å…¶ä¸­ä¸€ä¸ªï¼ˆå…¶ä»–çš„è¿˜æœ‰ Operator SDKï¼‰ã€‚Kubebuilder èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬ç”Ÿæˆä¸€äº› Scaffoldingï¼ˆè„šæ‰‹æ¶ï¼‰ä»£ç å¸®åŠ©åˆå§‹åŒ– CRD åŠŸèƒ½ï¼Œè‡ªåŠ¨ç”Ÿæˆç›¸åº”çš„é…ç½®ï¼Œè€Œä¸”è¿˜æä¾›äº†ä¸€äº›å°è£…å¥½çš„åº“ä¾›ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;kubebuilder-å®˜ç½‘ç¿»è¯‘&#34;&gt;Kubebuilder å®˜ç½‘ç¿»è¯‘&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†è®©å›½å†…ç”¨æˆ·å­¦ä¹  Kubebuilder å˜å¾—å¿«æ·ï¼ŒåŒæ—¶ç§‰æ‰¿äº‘åŸç”Ÿç¤¾åŒºç«‹ç¤¾çš„å®—æ—¨â€”â€”å‘ä¸­æ–‡ç”¨æˆ·æ¨å¹¿æ™®åŠäº‘åŸç”Ÿç›¸å…³çŸ¥è¯†ã€‚äº‘åŸç”Ÿç¤¾åŒºå°† Kubebuilder å®˜æ–¹æ–‡æ¡£è¿›è¡Œäº†æ±‰åŒ–ï¼Œæ•´ä¸ªç¿»è¯‘è¿‡ç¨‹å‰åå†æ—¶ä¸€ä¸ªå¤šæœˆï¼Œç”±æ¥è‡ªå¤šä¸ªåŸå¸‚ï¼Œå¤šå®¶å…¬å¸çš„å¿—æ„¿è€…å…±åŒå®Œæˆã€‚&lt;a href=&#34;https://cloudnative.to/kubebuilder&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubebuilder ä¸­æ–‡ç½‘ç«™&lt;/a&gt;ï¼Œå¯ç”±ä¸‹å›¾æŒ‡ç¤ºç›´è¾¾ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ldquocloudnative-kubebuilderrdquo&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&amp;ldquo;cloudnative kubebuilder&amp;rdquo;&#34; srcset=&#34;
               /blog/kubebuilder-summary/cloudnative_kubebuilder_url_hu354807658953244450.webp 400w,
               /blog/kubebuilder-summary/cloudnative_kubebuilder_url_hu611274748817325323.webp 760w,
               /blog/kubebuilder-summary/cloudnative_kubebuilder_url_hu7239843843977505257.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubebuilder-summary/cloudnative_kubebuilder_url_hu354807658953244450.webp&#34;
               width=&#34;760&#34;
               height=&#34;173&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      &amp;ldquo;cloudnative kubebuilder&amp;rdquo;
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç”±äºæ—¶é—´ã€äººå‘˜åˆ†å¸ƒåŠç¿»è¯‘ä¹ æƒ¯ç­‰å› ç´ ï¼ŒKubebuilder ä¸­æ–‡æ–‡æ¡£å¯èƒ½å­˜åœ¨ä¸€äº›ç¿»è¯‘é—®é¢˜ï¼Œæˆ‘ä»¬éå¸¸æ¬¢è¿å¤§å®¶èƒ½åœ¨é˜…è¯»çš„è¿‡ç¨‹ä¸­ç»™æˆ‘ä»¬å¤šææ„è§ï¼Œæˆ‘ä»¬ä¼šæŒç»­æ”¹è¿›ã€‚å¯ä»¥é€šè¿‡å¾®ä¿¡æ‰¾æˆ‘ä»¬åæ˜ ç¿»è¯‘é—®é¢˜ï¼Œä¹Ÿå¯ä»¥åœ¨ GitHub ä¸Šæ Issueï¼Œæ Issue çš„æ–¹å¼å’Œæ¨¡ç‰ˆåœ¨ä¸­æ–‡æ–‡æ¡£é¡µé¦–ï¼Œç‚¹å‡»ç›¸åº”çš„é“¾æ¥å³å¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ldquokubebuilder-zhrdquo&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&amp;ldquo;kubebuilder zh&amp;rdquo;&#34; srcset=&#34;
               /blog/kubebuilder-summary/kubebuilder_zh_url_hu10892533688940331285.webp 400w,
               /blog/kubebuilder-summary/kubebuilder_zh_url_hu15657666155469204239.webp 760w,
               /blog/kubebuilder-summary/kubebuilder_zh_url_hu1446977786839469038.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubebuilder-summary/kubebuilder_zh_url_hu10892533688940331285.webp&#34;
               width=&#34;760&#34;
               height=&#34;138&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      &amp;ldquo;kubebuilder zh&amp;rdquo;
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨æ­¤ï¼Œéå¸¸æ„Ÿè°¢åå¤šä½å¿—æ„¿è€…çš„æ— ç§å¥‰çŒ®ï¼ŒåŒæ—¶ï¼Œä¸ºäº†å“åº”ç¤¾åŒºå¤§ä¼—æƒ³è¯» Envoy ä¸­æ–‡ç‰ˆçš„è¦æ±‚ï¼ˆæœ‰&lt;a href=&#34;https://www.servicemesher.com/envoy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;1.7 ä¸­æ–‡ç‰ˆ&lt;/a&gt;ï¼Œä½†è·ç¦»æœ€æ–°ç‰ˆï¼Œå·®å¤šä¸ªç‰ˆæœ¬ï¼‰ï¼Œäº‘åŸç”Ÿç¤¾åŒºå†³å®šå¼€å¯ Enovy æœ€æ–°ç‰ˆçš„ä¸­æ–‡ç¿»è¯‘å·¥ä½œï¼Œæˆ‘ä»¬çƒ­å¿±æ¬¢è¿å¯¹äº‘åŸç”Ÿæ„Ÿå…´è¶£çš„å¿—æ„¿è€…åŠ å…¥æˆ‘ä»¬ï¼Œæˆ‘ä»¬ä¸€èµ·æäº‹æƒ…ï¼ˆå¯åŠ å¾®ä¿¡ &amp;ldquo;jimmysongio&amp;quot;æˆ–è€…&amp;quot;majinghe11&amp;quot;å¹¶æ³¨æ˜â€œEnovy ç¿»è¯‘â€ï¼Œæˆ‘ä»¬æ‹‰ä½ è¿›ç¾¤)ã€‚&lt;/p&gt;
&lt;p&gt;åŠ å…¥äº‘åŸç”Ÿç¤¾åŒºï¼Œä¸€èµ·æäº‹æƒ…ï¼Œæˆ‘ä»¬ç­‰ä½ ï¼ï¼ï¼&lt;/p&gt;
&lt;h2 id=&#34;ç‰¹åˆ«æ„Ÿè°¢&#34;&gt;ç‰¹åˆ«æ„Ÿè°¢&lt;/h2&gt;
&lt;p&gt;å†æ¬¡æ„Ÿè°¢ä»¥ä¸‹å‚ä¸ Kubebuilder ç¿»è¯‘çš„å¿—æ„¿è€… (æ’åä¸åˆ†å…ˆåï¼ŒæŒ‰å­—æ¯æ’åº)&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;å§“å&lt;/th&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;GitHub è´¦å·&lt;/th&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;å§“å&lt;/th&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;GitHub è´¦å·&lt;/th&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;å§“å&lt;/th&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;GitHub è´¦å·&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;å®˜ä½™æ£š&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;3ks&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;å‰è¾‰&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;Miss-you&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;æ¢æ–Œ&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;hzliangbin&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;åˆ˜æ™“æ•&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;dk-lockdown&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;é©¬æ™¯è´º&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;lhb008&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;å°šå¤&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;skyshang1&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ç”³çº¢ç£Š&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;shenhonglei&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;å®‹å‡€è¶…&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;rootsongjc&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;æ–‡å½¦&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;vsxen&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;å¾é¾™&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;long0419&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;è®¸æŒ¯æ–‡&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;helight&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;å§šæ²ˆç»“&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;Luffy110&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æ›¾ç¥¥é¾™&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;alandtsang&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;å¼ æµ©&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;zhangguanzhang&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
</description>
    </item>
    
    <item>
      <title>æ·±å…¥äº†è§£ Kubernetes Informer</title>
      <link>https://cloudnativecn.com/blog/client-go-informer-source-code/</link>
      <pubDate>Fri, 28 Aug 2020 08:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/client-go-informer-source-code/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸»è¦æ ¹æ®ä¹¦ç±ã€ŠKubernetes æºç å‰–æã€‹çš„åŸºç¡€ä¸Šï¼Œå¯¹ Client-go éƒ¨åˆ†çš„ Informer æœºåˆ¶è¿›è¡Œäº†è§£ä¸å­¦ä¹ ã€‚&lt;/p&gt;
&lt;h2 id=&#34;informer-æœºåˆ¶&#34;&gt;Informer æœºåˆ¶&lt;/h2&gt;
&lt;p&gt;Kubernetes ä¸­ä½¿ç”¨ http è¿›è¡Œé€šä¿¡ï¼Œ&lt;strong&gt;å¦‚ä½•ä¸ä¾èµ–ä¸­é—´ä»¶çš„æƒ…å†µä¸‹ä¿è¯æ¶ˆæ¯çš„å®æ—¶æ€§ï¼Œå¯é æ€§å’Œé¡ºåºæ€§ç­‰å‘¢&lt;/strong&gt;ï¼Ÿç­”æ¡ˆå°±æ˜¯åˆ©ç”¨äº† Informer æœºåˆ¶ã€‚Informer çš„æœºåˆ¶ï¼Œé™ä½äº†äº† Kubernetes å„ä¸ªç»„ä»¶è·Ÿ Etcd ä¸ Kubernetes API Server çš„é€šä¿¡å‹åŠ›ã€‚&lt;/p&gt;
&lt;h3 id=&#34;informer-æœºåˆ¶æ¶æ„è®¾è®¡&#34;&gt;Informer æœºåˆ¶æ¶æ„è®¾è®¡&lt;/h3&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/client-go-informer-source-code/01_hu5556131565810703425.webp 400w,
               /blog/client-go-informer-source-code/01_hu3933764859357915646.webp 760w,
               /blog/client-go-informer-source-code/01_hu9073193044974231247.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/client-go-informer-source-code/01_hu5556131565810703425.webp&#34;
               width=&#34;760&#34;
               height=&#34;570&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›¾ç‰‡æºè‡ª &lt;a href=&#34;https://github.com/kubernetes/sample-controller/blob/master/docs/controller-client-go.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Client-go under the hood&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;âš ï¸  è¿™å¼ å›¾åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œé»„è‰²å›¾æ ‡æ˜¯å¼€å‘è€…éœ€è¦è‡ªè¡Œå¼€å‘çš„éƒ¨åˆ†ï¼Œè€Œå…¶å®ƒçš„éƒ¨åˆ†æ˜¯ client-go å·²ç»æä¾›çš„ï¼Œç›´æ¥ä½¿ç”¨å³å¯ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Reflector&lt;/strong&gt;ï¼šç”¨äº Watch æŒ‡å®šçš„ Kubernetes èµ„æºï¼Œå½“ watch çš„èµ„æºå‘ç”Ÿå˜åŒ–æ—¶ï¼Œè§¦å‘å˜æ›´çš„äº‹ä»¶ï¼Œæ¯”å¦‚ Addedï¼ŒUpdated å’Œ Deleted äº‹ä»¶ï¼Œå¹¶å°†èµ„æºå¯¹è±¡å­˜æ”¾åˆ°æœ¬åœ°ç¼“å­˜ DeltaFIFOï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;DeltaFIFO&lt;/strong&gt;ï¼šæ‹†å¼€ç†è§£ï¼ŒFIFO å°±æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ‹¥æœ‰é˜Ÿåˆ—åŸºæœ¬æ–¹æ³•ï¼ˆADDï¼ŒUPDATEï¼ŒDELETEï¼ŒLISTï¼ŒPOPï¼ŒCLOSE ç­‰ï¼‰ï¼ŒDelta æ˜¯ä¸€ä¸ªèµ„æºå¯¹è±¡å­˜å‚¨ï¼Œä¿å­˜å­˜å‚¨å¯¹è±¡çš„æ¶ˆè´¹ç±»å‹ï¼Œæ¯”å¦‚ Addedï¼ŒUpdatedï¼ŒDeletedï¼ŒSync ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Indexer&lt;/strong&gt;ï¼šClient-go ç”¨æ¥å­˜å‚¨èµ„æºå¯¹è±¡å¹¶è‡ªå¸¦ç´¢å¼•åŠŸèƒ½çš„æœ¬åœ°å­˜å‚¨ï¼ŒReflector ä» DeltaFIFO ä¸­å°†æ¶ˆè´¹å‡ºæ¥çš„èµ„æºå¯¹è±¡å­˜å‚¨åˆ° Indexerï¼ŒIndexer ä¸ Etcd é›†ç¾¤ä¸­çš„æ•°æ®å®Œå…¨ä¿æŒä¸€è‡´ã€‚ä»è€Œ client-go å¯ä»¥æœ¬åœ°è¯»å–ï¼Œå‡å°‘ Kubernetes API å’Œ Etcd é›†ç¾¤çš„å‹åŠ›ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;çœ‹ä¹¦æœ¬ä¸Šçš„ä¸€ä¸ªä¾‹å­ï¼Œæƒ³ä½¿ç”¨ Informer çš„å…³é”®æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;clientset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kubernetes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewForConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;sharedInformers&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;informers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewSharedInformerFactory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;clientset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Minute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;informer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sharedInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Core&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;V1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Informer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;informer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddEventHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResourceEventHandlerFuncs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;AddFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;UpdateFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;DeleteFunc&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;informer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;Informer éœ€è¦é€šè¿‡ ClientSet ä¸ Kubernetes API Server äº¤äº’ï¼›&lt;/li&gt;
&lt;li&gt;åˆ›å»º stopCh æ˜¯ç”¨äºåœ¨ç¨‹åºè¿›ç¨‹é€€å‡ºå‰é€šçŸ¥ Informer æå‰é€€å‡ºï¼ŒInformer æ˜¯ä¸€ä¸ªæŒä¹…è¿è¡Œçš„ goroutineï¼›&lt;/li&gt;
&lt;li&gt;NewSharedInformerFactory å®ä¾‹åŒ–äº†ä¸€ä¸ª SharedInformer å¯¹è±¡ï¼Œç”¨äºè¿›è¡Œæœ¬åœ°èµ„æºå­˜å‚¨ï¼›&lt;/li&gt;
&lt;li&gt;sharedInformer.Core().V1().Pods().Informer() å¾—åˆ°äº†å…·ä½“ Pod èµ„æºçš„ informer å¯¹è±¡ï¼›&lt;/li&gt;
&lt;li&gt;AddEventHandler å³å›¾ä¸­çš„ç¬¬ 6 æ­¥ï¼Œè¿™æ˜¯ä¸€ä¸ªèµ„æºäº‹ä»¶å›è°ƒæ–¹æ³•ï¼Œä¸Šä¾‹ä¸­å³ä¸ºå½“åˆ›å»º/æ›´æ–°/åˆ é™¤ Pod æ—¶è§¦å‘äº‹ä»¶å›è°ƒæ–¹æ³•ï¼›&lt;/li&gt;
&lt;li&gt;ä¸€èˆ¬è€Œè¨€ï¼Œå…¶ä»–ç»„ä»¶ä½¿ç”¨ Informer æœºåˆ¶è§¦å‘èµ„æºå›è°ƒæ–¹æ³•ä¼šå°†èµ„æºå¯¹è±¡æ¨é€åˆ° WorkQueue æˆ–å…¶ä»–é˜Ÿåˆ—ä¸­ï¼Œå…·ä½“æ¨é€çš„ä½ç½®è¦å»å›è°ƒæ–¹æ³•é‡Œè‡ªè¡Œå®ç°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸Šé¢è¿™ä¸ªç¤ºä¾‹ï¼Œå½“è§¦å‘äº† Addï¼ŒUpdate æˆ–è€… Delete äº‹ä»¶ï¼Œå°±é€šçŸ¥ Client-goï¼Œå‘ŠçŸ¥ Kubernetes èµ„æºäº‹ä»¶å‘ç”Ÿå˜æ›´å¹¶ä¸”éœ€è¦è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;èµ„æº Informer&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ¯ä¸€ä¸ª k8s Resource éƒ½å®ç°äº† Informer æœºåˆ¶ï¼Œ&lt;strong&gt;å‡æœ‰ Informer å’Œ Lister æ–¹æ³•&lt;/strong&gt;ï¼Œä»¥ PodInformer ä¸ºä¾‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PodInformer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nf&#34;&gt;Informer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SharedIndexInformer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nf&#34;&gt;Lister&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PodLister&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;Shared Informer å…±äº«æœºåˆ¶&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Informer åˆç§°ä¸º Shared Informerï¼Œè¡¨æ˜æ˜¯å¯ä»¥å…±äº«ä½¿ç”¨çš„ï¼Œåœ¨ä½¿ç”¨ client-go å†™ä»£ç æ—¶ï¼Œè‹¥åŒä¸€èµ„æºçš„ Informer è¢«å®ä¾‹åŒ–å¤ªå¤šæ¬¡ï¼Œæ¯ä¸ª Informer ä½¿ç”¨ä¸€ä¸ª Reflectorï¼Œä¼šè¿è¡Œè¿‡å¤šçš„ç›¸åŒ ListAndWatchï¼ˆ&lt;strong&gt;å³å›¾ä¸­çš„ç¬¬ä¸€æ­¥&lt;/strong&gt;ï¼‰ï¼Œå¤ªå¤šé‡å¤çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¼šå¯¼è‡´ k8s API Server è´Ÿè½½è¿‡é‡ã€‚&lt;/p&gt;
&lt;p&gt;è€Œ Shared Informer é€šè¿‡å¯¹åŒä¸€ç±»èµ„æº Informer å…±äº«ä¸€ä¸ª Reflector å¯ä»¥èŠ‚çº¦å¾ˆå¤šèµ„æºï¼Œè¿™&lt;strong&gt;é€šè¿‡ map æ•°æ®ç»“æ„&lt;/strong&gt;å³å¯å®ç°è¿™æ ·ä¸€ä¸ªå…±äº« Informer æœºåˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;vendor/k8s.io/client-go/informers/factory.go&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sharedInformerFactory&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// map æ•°æ®ç»“æ„
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;informers&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SharedIndexInformer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// InternalInformerFor returns the SharedIndexInformer for obj using an internal client.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// å½“ç¤ºä¾‹ä¸­è°ƒç”¨ xxx.Informer() æ—¶ï¼Œå†…éƒ¨è°ƒç”¨äº†è¯¥æ–¹æ³•
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sharedInformerFactory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;InformerFor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newFunc&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;internalinterfaces&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NewInformerFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SharedIndexInformer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;informerType&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TypeOf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;informer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;informers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;informerType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;informer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;resyncPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;customResync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;informerType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;resyncPeriod&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;defaultResync&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;informer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resyncPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;informers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;informerType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;informer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;informer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;reflector&#34;&gt;Reflector&lt;/h3&gt;
&lt;p&gt;Reflector ç”¨äº Watch æŒ‡å®šçš„ Kubernetes èµ„æºï¼Œå½“ watch çš„èµ„æºå‘ç”Ÿå˜åŒ–æ—¶ï¼Œè§¦å‘å˜æ›´çš„äº‹ä»¶ï¼Œå¹¶å°†èµ„æºå¯¹è±¡å­˜æ”¾åˆ°æœ¬åœ°ç¼“å­˜ DeltaFIFOã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡ NewReflector å®ä¾‹åŒ– Reflector å¯¹è±¡ï¼Œå®ä¾‹åŒ–è¿‡ç¨‹å¿…é¡»ä¼ å…¥ ListerWatcher æ•°æ®æ¥å£å¯¹è±¡ï¼Œå®ƒæ‹¥æœ‰ List å’Œ Watch æ–¹æ³•ã€‚Reflector å¯¹è±¡é€šè¿‡ Run è¡Œæ•°å¯åŠ¨ç›‘æ§å¹¶å¤„ç†ç›‘æ§äº‹ä»¶ï¼Œåœ¨å®ç°ä¸­ï¼Œå…¶æ ¸å¿ƒä¸º ListAndWatch å‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ Example çš„ä»£ç ä¸ºä¾‹ï¼Œæˆ‘ä»¬åœ¨æœ€åä¸€æ­¥æ‰§è¡Œäº† &lt;code&gt;informer.Run(stopCh)&lt;/code&gt;ï¼Œå†…éƒ¨ä¼šæ‰§è¡Œä¸€ä¸ª ListAndWatch æ–¹æ³•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;vendor/k8s.io/client-go/tools/cache/reflector.go&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Run æ‰§è¡Œä¸€ä¸ª watch å¹¶ä¸”æŠŠæ¡æ‰€æœ‰çš„ watch eventsï¼Œwatch å…³é—­åä¼šé‡å¯
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// stopCh å…³é—­æ—¶ Run é€€å‡º
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Reflector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Starting reflector %v (%s) from %s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;expectedType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;resyncPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Until&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ListAndWatch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;utilruntime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HandleError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;period&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è·å–èµ„æºæ•°æ®åˆ—è¡¨&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä»¥ä¹‹å‰æè¿‡çš„ Example çš„ä»£ç ä¸ºä¾‹ï¼Œé€šè¿‡ &lt;code&gt;Run&lt;/code&gt; è·å–äº†æ‰€æœ‰ Pod çš„èµ„æºæ•°æ®ï¼ŒList æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;r.ListWatcher.List&lt;/code&gt; è·å–èµ„æºæ•°æ®ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;listMetaInterface.GetResourceVersion&lt;/code&gt; è·å–èµ„æºç‰ˆæœ¬å·ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;meta.ExtractList&lt;/code&gt; å°†èµ„æºæ•°æ®è½¬æ¢ä¸ºèµ„æºå¯¹è±¡åˆ—è¡¨ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;r.SyncWith&lt;/code&gt; å°†èµ„æºå¯¹è±¡åˆ—è¡¨çš„èµ„æºå¯¹è±¡å’Œèµ„æºç‰ˆæœ¬å·å­˜å‚¨åˆ° DeltaFIFO ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;r.setLastSyncResourceVersion&lt;/code&gt; è®¾ç½®æœ€æ–°çš„èµ„æºç‰ˆæœ¬å·ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å…·ä½“çš„ï¼Œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;r.ListWatcher.List&lt;/code&gt; æ ¹æ® ResourceVersion è·å–èµ„æºä¸‹çš„æ‰€æœ‰å¯¹è±¡æ•°æ®ã€‚ä»¥ Example ä¸ºä¾‹ï¼Œè¯¥æ–¹æ³•è°ƒç”¨çš„å°±æ˜¯ Pod Informer ä¸‹çš„ &lt;code&gt;ListFunc&lt;/code&gt; å‡½æ•°ï¼Œé€šè¿‡ ClientSet å®¢æˆ·ç«¯ä¸ Kubernetes API Server äº¤äº’å¹¶è·å– Pod èµ„æºåˆ—è¡¨æ•°æ®ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;listMetaInterface.GetResourceVersion&lt;/code&gt; è·å– ResourceVersionï¼Œå³èµ„æºç‰ˆæœ¬å·ï¼Œæ³¨æ„è¿™é‡Œçš„èµ„æºç‰ˆæœ¬å·å¹¶ä¸æ˜¯æŒ‡å‰é¢å„ä¸ªå®¢æˆ·ç«¯çš„ä¸åŒ kind çš„ä¸åŒ Versionï¼Œæ‰€æœ‰èµ„æºéƒ½æ‹¥æœ‰ ResourceVersionï¼Œæ ‡è¯†å½“å‰èµ„æºå¯¹è±¡çš„ç‰ˆæœ¬å·ã€‚æ¯æ¬¡ä¿®æ”¹ etcd é›†ç¾¤ä¸­å­˜å‚¨çš„å¯¹è±¡æ—¶ï¼ŒKubernetes API Server éƒ½ä¼šæ›´æ”¹ ResourceVersionï¼Œä½¿å¾— client-go æ‰§è¡Œ watch æ—¶å¯ä»¥æ ¹æ® ResourceVersion åˆ¤æ–­å½“å‰èµ„æºå¯¹è±¡æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;meta.ExtractList&lt;/code&gt; å°† runtime.Object å¯¹è±¡è½¬æ¢ä¸º []runtime.Object å¯¹è±¡ã€‚å› ä¸º &lt;code&gt;r.ListWatcher.List&lt;/code&gt; è·å–çš„æ˜¯èµ„æºä¸‹æ‰€æœ‰å¯¹è±¡çš„æ•°æ®ï¼Œå› æ­¤åº”å½“æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;r.SyncWith &lt;/code&gt;å°†ç»“æœåŒæ­¥åˆ° DeltaFIFO ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;r.setLastSyncResourceVersion&lt;/code&gt; è®¾ç½®æœ€æ–°çš„èµ„æºç‰ˆæœ¬å·ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;&lt;strong&gt;ç›‘æ§èµ„æºå¯¹è±¡&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Watch é€šè¿‡ HTTP åè®®ä¸ Kubernetes API Server å»ºç«‹é•¿è¿æ¥ï¼Œæ¥æ”¶ Kubernetes API Server å‘æ¥çš„èµ„æºå˜æ›´äº‹ä»¶ã€‚Watch æ“ä½œçš„å®ç°æœºåˆ¶ä½¿ç”¨ HTTP åè®®çš„åˆ†å—ä¼ è¾“ç¼–ç â€”â€”å½“ client-go è°ƒç”¨ Kubernetes API Server æ—¶ï¼ŒKubernetes API Server åœ¨ Response çš„ HTTP Header ä¸­è®¾ç½® Transfer-Encoding çš„å€¼ä¸º chunkedï¼Œè¡¨ç¤ºé‡‡ç”¨åˆ†å—ä¼ è¾“ç¼–ç ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°æ¶ˆæ¯åï¼Œä¸æœåŠ¡ç«¯è¿›è¡Œè¿æ¥ï¼Œå¹¶ç­‰å¾…ä¸‹ä¸€ä¸ªæ•°æ®å—ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åœ¨æºç ä¸­å…³é”®ä¸º watch å’Œ watchHandler å‡½æ•°&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;staging/src/k8s.io/client-go/tools/cache/reflector.go&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Reflector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ListAndWatch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// å‰é¢æåˆ°çš„ list éƒ¨åˆ†ä»£ç 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// watch part
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// æ”¶åˆ° stopCh åœæ­¢å¾ªç¯
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ListOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;ResourceVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resourceVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;c1&#34;&gt;// è®¾ç½®è¶…æ—¶æ—¶é—´é¿å…å°† watchers æŒ‚èµ·
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;TimeoutSeconds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;timeoutSeconds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listerWatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Watch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// error handling éƒ¨åˆ†
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// å¦ä¸€ä¸ªæ ¸å¿ƒå‡½æ•° watchHandlerï¼Œåæ–‡ä»‹ç»
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;watchHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;resourceVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resyncerrc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;errorStopRequested&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Warningf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%s: watch of %v ended with: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;expectedType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»¥ä¹‹å‰çš„ Example ä¸ºä¾‹å­ï¼Œ&lt;code&gt;r.listerWatcher.Watch&lt;/code&gt; å®é™…è°ƒç”¨äº† Pod Informer ä¸‹çš„ Watch å‡½æ•°ï¼Œé€šè¿‡ ClientSet å®¢æˆ·ç«¯ä¸ Kubernetes API Server å»ºç«‹é•¿é“¾æ¥ï¼Œç›‘æ§æŒ‡å®šèµ„æºçš„å˜æ›´äº‹ä»¶ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;staging/src/k8s.io/client-go/informers/core/v1/pod.go&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewFilteredPodInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SharedIndexInformer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewSharedIndexInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		  &lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;WatchFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ListOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;watch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tweakListOptions&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nf&#34;&gt;tweakListOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;CoreV1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Watch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;r.watchHandler&lt;/code&gt; å¤„ç†èµ„æºçš„å˜æ›´äº‹ä»¶ï¼Œå°†å¯¹åº”èµ„æºæ›´æ–°åˆ°æœ¬åœ°ç¼“å­˜ DeltaFIFO å¹¶æ›´æ–° ResourceVersion èµ„æºç‰ˆæœ¬å·ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// watchHandler watches w and keeps *resourceVersion up to date.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Reflector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;watchHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;watch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resourceVersion&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;errc&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;start&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;clock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Now&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;eventCount&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Stop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// å¾ªç¯åµŒå¥—å¾ªç¯æ—¶ï¼Œåœ¨ break åæŒ‡å®šæ ‡ç­¾ã€‚ç”¨æ ‡ç­¾å†³å®šå“ªä¸ªå¾ªç¯è¢«ç»ˆæ­¢
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;loop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;errorStopRequested&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;errc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;event&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ResultChan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;():&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// ç›´æ¥è·³å‡º for å¾ªç¯
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;				&lt;span class=&#34;k&#34;&gt;break&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;loop&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;nx&#34;&gt;newResourceVersion&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;meta&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetResourceVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;event&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;watch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Added&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;store&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;event&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;watch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Modified&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;store&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Update&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;event&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;watch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Deleted&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;store&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Delete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;event&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;resourceVersion&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newResourceVersion&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;setLastSyncResourceVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;newResourceVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;eventCount&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;deltafifo&#34;&gt;DeltaFIFO&lt;/h3&gt;
&lt;p&gt;DeltaFIFO æ‹†å¼€ç†è§£ï¼ŒFIFO å°±æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ‹¥æœ‰é˜Ÿåˆ—åŸºæœ¬æ–¹æ³•ï¼ˆADDï¼ŒUPDATEï¼ŒDELETEï¼ŒLISTï¼ŒPOPï¼ŒCLOSE ç­‰ï¼‰ï¼ŒDelta æ˜¯ä¸€ä¸ªèµ„æºå¯¹è±¡å­˜å‚¨ï¼Œä¿å­˜å­˜å‚¨å¯¹è±¡çš„æ¶ˆè´¹ç±»å‹ï¼Œæ¯”å¦‚ Addedï¼ŒUpdatedï¼ŒDeletedï¼ŒSync ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;çœ‹ DeltaFIFO çš„æ•°æ®ç»“æ„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;vendor/k8s.io/client-go/tools/cache/delta_fifo.go&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;DeltaFIFO&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// lock/cond protects access to &amp;#39;items&amp;#39; and &amp;#39;queue&amp;#39;.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RWMutex&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;cond&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cond&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// We depend on the property that items in the set are in
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// the queue and vice versa, and that all Deltas in this
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// map have at least one Delta.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Deltas&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;queue&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä¸­ï¼ŒDeltas éƒ¨åˆ†çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;staging/src/k8s.io/client-go/tools/cache/delta_fifo.go&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// DeltaType is the type of a change (addition, deletion, etc)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;DeltaType&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Delta is the type stored by a DeltaFIFO. It tells you what change
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// happened, and the object&amp;#39;s state after* that change.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Delta&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt;   &lt;span class=&#34;nx&#34;&gt;DeltaType&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Deltas is a list of one or more &amp;#39;Delta&amp;#39;s to an individual object.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// The oldest delta is at index 0, the newest delta is the last one.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Deltas&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Delta&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;DeltaFIFO ä¼šä¿ç•™æ‰€æœ‰å…³äºèµ„æºå¯¹è±¡ï¼ˆobjï¼‰çš„æ“ä½œç±»å‹ï¼Œé˜Ÿåˆ—ä¸­ä¼šå­˜åœ¨æ‹¥æœ‰ä¸åŒæ“ä½œç±»å‹çš„åŒä¸€èµ„æºå¯¹è±¡ï¼Œ&lt;strong&gt;ä½¿å¾—æ¶ˆè´¹è€…åœ¨å¤„ç†è¯¥èµ„æºå¯¹è±¡æ—¶èƒ½å¤Ÿäº†è§£èµ„æºå¯¹è±¡æ‰€å‘ç”Ÿçš„äº‹æƒ…&lt;/strong&gt;ã€‚queue å­—æ®µå­˜å‚¨èµ„æºå¯¹è±¡çš„ keyï¼Œè¿™ä¸ª key é€šè¿‡ KeyOf å‡½æ•°è®¡ç®—å¾—åˆ°ï¼Œitems å­—æ®µé€šè¿‡ map æ•°æ®ç»“æ„çš„æ–¹å¼å­˜å‚¨ï¼Œvalue å­˜å‚¨çš„æ˜¯å¯¹è±¡ Deltas æ•°ç»„ï¼Œä¸€ä¸ªç»“æ„ç¤ºä¾‹å›¾å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;        â”Œâ”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”
queue   â”‚ObjKey1â”‚â”‚ObjKey2â”‚â”‚ObjKey3â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”˜

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
itmes   â”‚ObjKey1: [{&amp;#34;Added&amp;#34;,Obj1} {&amp;#34;Updated&amp;#34;,Obj1}]                   â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ObjKey2: [{&amp;#34;Added&amp;#34;,Obj2},{&amp;#34;Deleted&amp;#34;,Obj2},{&amp;#34;Sync&amp;#34;,Obj2}]     â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ObjKey3: [{&amp;#34;Added&amp;#34;,Obj3},{&amp;#34;Updated&amp;#34;,Obj3},{&amp;#34;Deleted&amp;#34;,Obj3}]  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä½œä¸ºä¸€ä¸ª FIFO çš„é˜Ÿåˆ—ï¼Œæœ‰æ•°æ®çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œå…¶ä¸­ç”Ÿäº§è€…æ˜¯ Reflector è°ƒç”¨çš„ Add æ–¹æ³•ï¼Œæ¶ˆè´¹è€…æ˜¯ Controller è°ƒç”¨çš„ Pop æ–¹æ³•ã€‚ä¸‰ä¸ªæ ¸å¿ƒæ–¹æ³•ä¸º&lt;strong&gt;ç”Ÿäº§è€…æ–¹æ³•ï¼Œæ¶ˆè´¹è€…æ–¹æ³•å’Œ Resync æœºåˆ¶&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&#34;ç”Ÿäº§è€…æ–¹æ³•&#34;&gt;ç”Ÿäº§è€…æ–¹æ³•&lt;/h4&gt;
&lt;p&gt;DeltaFIFO é˜Ÿåˆ—ä¸­çš„èµ„æºå¯¹è±¡åœ¨è°ƒç”¨ Addedï¼ŒUpdatedï¼ŒDeleted ç­‰äº‹ä»¶æ—¶éƒ½è°ƒç”¨äº† queueActionLocked å‡½æ•°ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/client-go-informer-source-code/02_hu1259231558035050875.webp 400w,
               /blog/client-go-informer-source-code/02_hu6464671204175950458.webp 760w,
               /blog/client-go-informer-source-code/02_hu5758165487247190240.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/client-go-informer-source-code/02_hu1259231558035050875.webp&#34;
               width=&#34;760&#34;
               height=&#34;368&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å®ƒæ˜¯ DeltaFIFO å®ç°çš„å…³é”®ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;vendor/k8s.io/client-go/tools/cache/delta_fifo.go&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// queueActionLocked ä¸ºä¸€ä¸ª delta list æ·»åŠ ä¸€ä¸ª object
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// è°ƒç”¨æ–¹å¿…é¡»å…ˆä¸Šé”
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DeltaFIFO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;queueActionLocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;actionType&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;DeltaType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// é€šè¿‡ KeyOf å‡½æ•°è®¡ç®—å‡ºå¯¹è±¡çš„ key
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;KeyOf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;KeyError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// å°† actionType ä»¥åŠå¯¹åº”çš„ id æ·»åŠ åˆ° items ä¸­ï¼Œå¹¶é€šè¿‡ dedupDeltas å¯¹æ•°ç»„ä¸­æœ€æ–°çš„ä¸¤æ¬¡æ·»åŠ è¿›è¡Œå»é‡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;newDeltas&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Delta&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;actionType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;newDeltas&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;dedupDeltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;newDeltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ä¸€èˆ¬ä¸ä¼šå‡ºç° &amp;lt;= 0ï¼Œå±å†—ä½™åˆ¤æ–­
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;newDeltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;queue&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;queue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newDeltas&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// å¹¿æ’­æ‰€æœ‰æ¶ˆè´¹è€…è§£é™¤é˜»å¡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Broadcast&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nb&#34;&gt;delete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;é€šè¿‡ KeyOf å‡½æ•°è®¡ç®—å‡ºå¯¹è±¡çš„ keyï¼›&lt;/li&gt;
&lt;li&gt;å°† actionType ä»¥åŠå¯¹åº”çš„ id æ·»åŠ åˆ° items ä¸­ï¼Œå¹¶é€šè¿‡ dedupDeltas å¯¹æ•°ç»„ä¸­æœ€æ–°çš„ä¸¤æ¬¡æ·»åŠ è¿›è¡Œå»é‡ï¼›&lt;/li&gt;
&lt;li&gt;æ›´æ–°æ„é€ åçš„ Deleta å¹¶é€šè¿‡ cond.Broadcast() å¹¿æ’­æ‰€æœ‰æ¶ˆè´¹è€…è§£é™¤é˜»å¡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;æ¶ˆè´¹è€…æ–¹æ³•&#34;&gt;æ¶ˆè´¹è€…æ–¹æ³•&lt;/h4&gt;
&lt;p&gt;Pop å‡½æ•°ä½œä¸ºæ¶ˆè´¹è€…ä½¿ç”¨æ–¹æ³•ï¼Œä» DeltaFIFO çš„å¤´éƒ¨å–å‡ºæœ€æ—©è¿›å…¥é˜Ÿåˆ—ä¸­çš„èµ„æºå¯¹è±¡æ•°æ®ã€‚Pop æ–¹æ³•å¿…é¡»ä¼ å…¥ process å‡½æ•°ï¼Œç”¨äºæ¥æ”¶å¹¶å¤„ç†å¯¹è±¡çš„å›è°ƒæ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;vendor/k8s.io/client-go/tools/cache/delta_fifo.go&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DeltaFIFO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Pop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;process&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PopProcessFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;queue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;c1&#34;&gt;// ç©ºé˜Ÿåˆ—æ—¶é˜»å¡ Pop æ–¹æ³•
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;IsClosed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;FIFOClosedError&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;queue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;queue&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;queue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;initialPopulationCount&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;initialPopulationCount&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;--&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;c1&#34;&gt;// Item may have been deleted subsequently.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// æ³¨æ„è¿™é‡Œåœ¨æ‰§è¡Œä¹‹å‰ä¼šæŠŠè¯¥ obj æ—§çš„ delta æ•°æ®æ¸…ç©º
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nb&#34;&gt;delete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;process&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ErrRequeue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;addIfNotPresent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é¦–å…ˆï¼Œä½¿ç”¨ &lt;code&gt;f.lock.Lock()&lt;/code&gt; ç¡®ä¿äº†æ•°æ®çš„åŒæ­¥ï¼Œå½“é˜Ÿåˆ—ä¸ä¸ºç©ºæ—¶ï¼Œå–å‡º &lt;code&gt;f.queue&lt;/code&gt; çš„å¤´éƒ¨æ•°æ®ï¼Œå°†å¯¹è±¡ä¼ å…¥ process å›è°ƒå‡½æ•°ï¼Œç”±ä¸Šå±‚æ¶ˆè´¹è€…è¿›è¡Œå¤„ç†ï¼Œå¦‚æœ process å›è°ƒæ–¹æ³•å¤„ç†å‡ºé”™ï¼Œå°†è¯¥å¯¹è±¡é‡æ–°å­˜å…¥é˜Ÿåˆ—ã€‚&lt;/p&gt;
&lt;p&gt;Controller çš„ &lt;code&gt;processLoop&lt;/code&gt; æ–¹æ³•è´Ÿè´£ä» DeltaFIFO é˜Ÿåˆ—ä¸­å–å‡ºæ•°æ®ä¼ é€’ç»™ process å›è°ƒå‡½æ•°ï¼Œprocess å‡½æ•°çš„ç±»å‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PopProcessFunc&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸€ä¸ª process å›è°ƒå‡½æ•°ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;vendor/k8s.io/client-go/tools/cache/shared_informer.go&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sharedIndexInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;HandleDeltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;blockDeltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;blockDeltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// from oldest to newest
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Deltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Added&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Updated&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;isSync&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Sync&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cacheMutationDetector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddObject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Update&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;distribute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;updateNotification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isSync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;distribute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;addNotification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;newObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isSync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Deleted&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Delete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;distribute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;deleteNotification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒHandleDeltas ä½œä¸º process çš„ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“èµ„æºå¯¹è±¡æ“ä½œç±»å‹ä¸º Addedï¼ŒUpdated å’Œ Delted æ—¶ï¼Œè¯¥èµ„æºå¯¹è±¡å­˜å‚¨è‡³ Indexerï¼ˆå®ƒæ˜¯å¹¶å‘å®‰å…¨çš„ï¼‰ï¼Œå¹¶é€šè¿‡ distribute å‡½æ•°å°†èµ„æºå¯¹è±¡åˆ†å‘åˆ° SharedInformerï¼Œåœ¨ä¹‹å‰ &lt;a href=&#34;#informer-%e6%9c%ba%e5%88%b6%e6%9e%b6%e6%9e%84%e8%ae%be%e8%ae%a1&#34;&gt;Informer æœºåˆ¶æ¶æ„è®¾è®¡&lt;/a&gt;çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œé€šè¿‡ &lt;code&gt;informer.AddEventHandler&lt;/code&gt; å‡½æ•°æ·»åŠ äº†å¯¹èµ„æºäº‹ä»¶è¿›è¡Œå¤„ç†çš„å‡½æ•°ï¼Œdistribute å‡½æ•°å°†èµ„æºå¯¹è±¡åˆ†å‘åˆ°è¯¥äº‹ä»¶å¤„ç†å‡½æ•°ã€‚&lt;/p&gt;
&lt;h4 id=&#34;resync-æœºåˆ¶&#34;&gt;Resync æœºåˆ¶&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;æœ¬èŠ‚å†…å®¹ä¸»è¦å‚è€ƒè‡ª &lt;a href=&#34;https://github.com/cloudnativeto/sig-k8s-source-code/issues/11&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ã€æé—®ã€‘Informer ä¸­ä¸ºä»€ä¹ˆéœ€è¦å¼•å…¥ Resync æœºåˆ¶ï¼Ÿ&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Resync æœºåˆ¶ä¼šå°† Indexer æœ¬åœ°å­˜å‚¨ä¸­çš„èµ„æºå¯¹è±¡åŒæ­¥åˆ° DeltaFIFO ä¸­ï¼Œå¹¶å°†è¿™äº›èµ„æºå¯¹è±¡è®¾ç½®ä¸º Sync çš„æ“ä½œç±»å‹ï¼Œ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// é‡æ–°åŒæ­¥ä¸€æ¬¡ Indexer ç¼“å­˜æ•°æ®åˆ° Delta FIFO
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DeltaFIFO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Resync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;knownObjects&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// éå† indexer ä¸­çš„ keyï¼Œä¼ å…¥ syncKeyLocked ä¸­å¤„ç†
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;keys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;knownObjects&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ListKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;k&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;keys&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;syncKeyLocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DeltaFIFO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;syncKeyLocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;knownObjects&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetByKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unexpected error %v during lookup of key %v, unable to queue object for sync&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Key %v does not exist in known objects store, unable to queue object for sync&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// è‹¥ FIFO é˜Ÿåˆ—ä¸­å·²ç»æœ‰ç›¸åŒ key çš„ event è¿›æ¥äº†ï¼Œè¯´æ˜è¯¥èµ„æºå¯¹è±¡æœ‰äº†æ–°çš„ eventï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// Indexer ä¸­æ—§çš„ç¼“å­˜å¤±æ•ˆï¼Œç›´æ¥è¿”å› nil
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;KeyOf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;KeyError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// é‡æ–°æ”¾å…¥ FIFO é˜Ÿåˆ—ä¸­
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;queueActionLocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;couldn&amp;#39;t queue object: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸ºä»€ä¹ˆéœ€è¦ Resync æœºåˆ¶å‘¢ï¼Ÿå› ä¸ºåœ¨å¤„ç† SharedInformer äº‹ä»¶å›è°ƒæ—¶ï¼Œå¯èƒ½å­˜åœ¨å¤„ç†å¤±è´¥çš„æƒ…å†µï¼Œå®šæ—¶çš„ Resync è®©è¿™äº›å¤„ç†å¤±è´¥çš„äº‹ä»¶æœ‰äº†é‡æ–° onUpdate å¤„ç†çš„æœºä¼šã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆç»è¿‡ Resync é‡æ–°æ”¾å…¥ Delta FIFO é˜Ÿåˆ—çš„äº‹ä»¶ï¼Œå’Œç›´æ¥ä» apiserver ä¸­ watch å¾—åˆ°çš„äº‹ä»¶å¤„ç†èµ·æ¥æœ‰ä»€ä¹ˆä¸ä¸€æ ·å‘¢ï¼Ÿåœ¨æ¶ˆè´¹è€…æ–¹æ³•ä¸­æœ‰ä»‹ç»è¿‡ &lt;code&gt;HandleDeltas&lt;/code&gt;ï¼Œå…¶ä¸­å°±æœ‰å…³äº Resync çš„éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sharedIndexInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;HandleDeltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// ä¸Šé”
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Deltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// åˆ¤æ–­äº‹ä»¶ç±»å‹
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Replaced&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Added&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Updated&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cacheMutationDetector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddObject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Update&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;isSync&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;c1&#34;&gt;// å¦‚æœæ˜¯é€šè¿‡ Resync é‡æ–°åŒæ­¥å¾—åˆ°çš„äº‹ä»¶åˆ™åšä¸ªæ ‡è®°
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;					&lt;span class=&#34;nx&#34;&gt;isSync&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Replaced&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;c1&#34;&gt;// å¦‚æœæ˜¯é€šè¿‡ Resync é‡æ–°åŒæ­¥å¾—åˆ°çš„äº‹ä»¶ï¼Œåˆ™è§¦å‘ onUpdate å›è°ƒ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;				&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;distribute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;updateNotification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isSync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;distribute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;addNotification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;newObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Deleted&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Delete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;distribute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;deleteNotification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»ä¸Šé¢å¯¹ Delta FIFO çš„é˜Ÿåˆ—å¤„ç†æºç å¯çœ‹å‡ºï¼Œå½“ä» Resync é‡æ–°åŒæ­¥åˆ° Delta FIFO é˜Ÿåˆ—çš„äº‹ä»¶ï¼Œä¼šåˆ†å‘åˆ° updateNotification ä¸­è§¦å‘ onUpdate çš„å›è°ƒã€‚Resync æœºåˆ¶çš„å¼•å…¥ï¼Œå®šæ—¶å°† Indexer ç¼“å­˜äº‹ä»¶é‡æ–°åŒæ­¥åˆ° Delta FIFO é˜Ÿåˆ—ä¸­ï¼Œåœ¨å¤„ç† SharedInformer äº‹ä»¶å›è°ƒæ—¶ï¼Œè®©å¤„ç†å¤±è´¥çš„äº‹ä»¶å¾—åˆ°é‡æ–°å¤„ç†ã€‚å¹¶ä¸”é€šè¿‡å…¥é˜Ÿå‰åˆ¤æ–­ FIFO é˜Ÿåˆ—ä¸­æ˜¯å¦å·²ç»æœ‰äº†æ›´æ–°ç‰ˆæœ¬çš„ eventï¼Œæ¥å†³å®šæ˜¯å¦ä¸¢å¼ƒ Indexer ç¼“å­˜ä¸è¿›è¡Œ Resync å…¥é˜Ÿã€‚åœ¨å¤„ç† Delta FIFO é˜Ÿåˆ—ä¸­çš„ Resync çš„äº‹ä»¶æ•°æ®æ—¶ï¼Œè§¦å‘ onUpdate å›è°ƒæ¥è®©äº‹ä»¶é‡æ–°å¤„ç†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;indexer&#34;&gt;Indexer&lt;/h3&gt;
&lt;p&gt;Client-go ç”¨æ¥å­˜å‚¨èµ„æºå¯¹è±¡å¹¶è‡ªå¸¦ç´¢å¼•åŠŸèƒ½çš„æœ¬åœ°å­˜å‚¨ï¼ŒReflector ä» DeltaFIFO ä¸­å°†æ¶ˆè´¹å‡ºæ¥çš„èµ„æºå¯¹è±¡å­˜å‚¨åˆ° Indexerï¼ŒIndexer ä¸ Etcd é›†ç¾¤ä¸­çš„æ•°æ®å®Œå…¨ä¿æŒä¸€è‡´ã€‚ä»è€Œ client-go å¯ä»¥æœ¬åœ°è¯»å–ï¼Œå‡å°‘ Kubernetes API å’Œ Etcd é›†ç¾¤çš„å‹åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;äº†è§£ Indexer ä¹‹å‰ï¼Œå…ˆäº†è§£ ThreadSafeMapï¼ŒThreadSafeMap æ˜¯å®ç°å¹¶å‘å®‰å…¨å­˜å‚¨ï¼Œå°±åƒ Go 1.9 åæ¨å‡º &lt;code&gt;sync.Map&lt;/code&gt; ä¸€æ ·ã€‚Kubernetes å¼€å§‹ç¼–å†™çš„æ—¶å€™è¿˜æ²¡æœ‰ &lt;code&gt;sync.Map&lt;/code&gt;ã€‚Indexer åœ¨ ThreadSafeMap çš„åŸºç¡€ä¸Šè¿›è¡Œäº†å°è£…ï¼Œç»§æ‰¿äº† ThreadSafeMap çš„å­˜å‚¨ç›¸å…³çš„å¢åˆ æ”¹æŸ¥ç›¸å…³æ“ä½œæ–¹æ³•ï¼Œå®ç°äº† Indexer Func ç­‰åŠŸèƒ½ï¼Œä¾‹å¦‚ Indexï¼ŒIndexKeysï¼ŒGetIndexers ç­‰æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¸º ThreadSafeMap æä¾›äº†ç´¢å¼•åŠŸèƒ½ã€‚å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Indeices    â”‚---&amp;gt;â”‚    Index     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Indexers    â”‚---&amp;gt;â”‚  IndexFun    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚          ThreadSafeStore          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;threadsafestore&#34;&gt;ThreadSafeStore&lt;/h4&gt;
&lt;p&gt;ThreadSafeStore æ˜¯ä¸€ä¸ª&lt;strong&gt;å†…å­˜ä¸­å­˜å‚¨&lt;/strong&gt;ï¼Œæ•°æ®ä¸ä¼šå†™å…¥æœ¬åœ°ç£ç›˜ï¼Œå¢åˆ æ”¹æŸ¥éƒ½ä¼šåŠ é”ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;vendor/k8s.io/client-go/tools/cache/store.go&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// threadSafeMap implements ThreadSafeStore
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;threadSafeMap&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;  &lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RWMutex&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// indexers maps a name to an IndexFunc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;indexers&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Indexers&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// indices maps a name to an Index
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;indices&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Indices&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;items å­—æ®µå­˜å‚¨èµ„æºå¯¹è±¡æ•°æ®ï¼Œå…¶ä¸­ items çš„ key é€šè¿‡ keyFunc å‡½æ•°è®¡ç®—å¾—åˆ°ï¼Œè®¡ç®—é»˜è®¤ä½¿ç”¨ MetaNamespaceKeyFunc å‡½æ•°ï¼Œè¯¥å‡½æ•°æ ¹æ®èµ„æºå¯¹è±¡è®¡ç®—å‡º &lt;code&gt;&amp;lt;namespace&amp;gt;/&amp;lt;name&amp;gt;&lt;/code&gt; æ ¼å¼çš„ keyï¼Œvalue ç”¨äºå­˜å‚¨èµ„æºå¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;è€Œåé¢ä¸¤ä¸ªå­—æ®µçš„å®šä¹‰ç±»å‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;vendor/k8s.io/client-go/tools/cache/index.go&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Index maps the indexed value to a set of keys in the store that match on that value
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Index&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;String&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Indexers maps a name to a IndexFunc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Indexers&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IndexFunc&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Indices maps a name to an Index
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Indices&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Index&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;indexer-ç´¢å¼•å™¨&#34;&gt;Indexer ç´¢å¼•å™¨&lt;/h4&gt;
&lt;p&gt;æ¯æ¬¡å¢åˆ æ”¹ ThreadSafeStore çš„æ•°æ®æ—¶ï¼Œéƒ½ä¼šé€šè¿‡ updateIndices æˆ– deleteFormIndices å‡½æ•°å˜æ›´ Indexerã€‚Indexer è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªå®šä¹‰ç´¢å¼•å‡½æ•°ï¼Œä»–æœ‰é‡è¦çš„å››ä¸ªæ•°æ®ç»“æ„ï¼Œ&lt;strong&gt;Indexers&lt;/strong&gt;ï¼Œ&lt;strong&gt;IndexFunc&lt;/strong&gt;ï¼Œ&lt;strong&gt;Indices&lt;/strong&gt; å’Œ &lt;strong&gt;Index&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­çš„å…³é”®æµç¨‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;UsersIndexFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;interfaces&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;usersString&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;users&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;userString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;,&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewIndexer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MetaNamespaceKeyFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Indexers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;byUser&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;UsersIndexFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;pod1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ObjectMeta&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ObjectMeta&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;one&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;users&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;ernie,bert&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// Initialize pod2 and pod3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// Add pod2 and pod3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nx&#34;&gt;erniePods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;omdex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ByIndex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;byUser&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;ernie&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªç´¢å¼•å™¨å‡½æ•°ï¼ˆIndexFuncï¼‰ï¼ŒUsersIndexFuncã€‚è¯¥å‡½æ•°å®šä¹‰æŸ¥è¯¢æ‰€æœ‰ Pod èµ„æºä¸‹ Annotations å­—æ®µçš„ key ä¸º users çš„ Podï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;UsersIndexFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;interfaces&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;usersString&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;users&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;userString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;,&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Main å‡½æ•°ä¸­ &lt;code&gt;cache.NewIndexer&lt;/code&gt; å®ä¾‹åŒ–äº†ä¸€ä¸ª Indexer å¯¹è±¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewIndexer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MetaNamespaceKeyFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Indexers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;byUser&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;UsersIndexFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¬¬ä¸€ä¸ªå‚æ•°è®¡ç®—èµ„æºå¯¹è±¡çš„ keyï¼Œé»˜è®¤å°±æ˜¯ MetaNamespaceKeyFuncï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ª Indexers å¯¹è±¡ï¼Œå¦‚ä¸Šä¸€èŠ‚å±•ç¤ºçš„å®šä¹‰é‚£æ ·ï¼Œkey ä¸ºç´¢å¼•å™¨ï¼ˆIndexFuncï¼‰çš„åç§°ï¼Œvalue ä¸ºç´¢å¼•å™¨å‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡ index.Add æ·»åŠ äº†ä¸‰ä¸ª Podï¼Œå†é€šè¿‡ index.ByIndex å‡½æ•°æŸ¥è¯¢ä½¿ç”¨ byUser ç´¢å¼•å™¨ä¸‹åŒ¹é… ernie å­—æ®µçš„ Pod åˆ—è¡¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;erniePods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ByIndex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;byUser&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;ernie&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å›çœ‹è¿™å››ä¸ªç±»å‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Indexers maps a name to a IndexFunc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Indexers&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IndexFunc&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// IndexFunc knows how to provide an indexed value for an object.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;IndexFunc&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Indices maps a name to an Index
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Indices&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Index&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Index maps the indexed value to a set of keys in the store that match on that value
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Index&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;String&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;Indexersï¼šå­˜å‚¨ç´¢å¼•å™¨ï¼Œkey ä¸º ç´¢å¼•å™¨åç§°ï¼Œvalue ä¸ºç´¢å¼•å™¨å®ç°å‡½æ•°ï¼›&lt;/li&gt;
&lt;li&gt;IndexFuncï¼šç´¢å¼•å™¨å‡½æ•°ï¼Œå®šä¹‰ä¸ºæ¥æ”¶ä¸€ä¸ªèµ„æºå¯¹è±¡ï¼Œè¿”å›æ£€ç´¢ç»“æœåˆ—è¡¨ï¼›&lt;/li&gt;
&lt;li&gt;Indicesï¼šå­˜å‚¨ç¼“å­˜å™¨ï¼Œkey ä¸ºç¼“å­˜å™¨åç§°ï¼Œvalue ä¸ºç¼“å­˜æ•°æ®ï¼›&lt;/li&gt;
&lt;li&gt;Indexï¼šå­˜å‚¨ç¼“å­˜æ•°æ®ï¼Œç»“æ„ä¸º K/Vã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;indexer-ç´¢å¼•å™¨æ ¸å¿ƒå®ç°&#34;&gt;Indexer ç´¢å¼•å™¨æ ¸å¿ƒå®ç°&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;vendor/k8s.io/client-go/tools/cache/thread_safe_store.go&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ByIndex returns a list of items that match an exact value on the index function
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;threadSafeMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ByIndex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;indexKey&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RUnlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;indexFunc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;indexFunc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Index with name %s does not exist&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;indexName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indices&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;set&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;List&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ByIndex æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šindexNameï¼ˆç´¢å¼•å™¨åå­—ï¼‰ä»¥åŠ indexKeyï¼ˆéœ€è¦æ£€ç´¢çš„ keyï¼‰ï¼Œé¦–å…ˆä» c.indexers æŸ¥æ‰¾åˆ¶å®šçš„ç´¢å¼•å™¨å‡½æ•°ï¼Œç„¶åä» c.indices æŸ¥æ‰¾è¿”å›çš„ç¼“å­˜å™¨å‡½æ•°ï¼Œæœ€åæ ¹æ®éœ€è¦ç´¢å¼•çš„ indexKey ä»ç¼“å­˜æ•°æ®ä¸­æŸ¥åˆ°å¹¶è¿”å›ã€‚&lt;/p&gt;
&lt;p&gt;âš ï¸ K8s å°† map ç»“æ„ç±»å‹çš„ key ä½œä¸º Set æ•°æ®ç»“æ„ï¼Œå®ç° Set å»é‡ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡ä» Informer çš„æ•´ä½“æ¶æ„å¼€å§‹è¯´èµ·ï¼Œä»‹ç»äº†å„ä¸ªæ ¸å¿ƒç»„ä»¶çš„åŠŸèƒ½å’Œä½œç”¨ï¼ŒKubernetes ä¹‹æ‰€ä»¥è®¾è®¡è¿™æ ·ä¸€ä¸ªæœºåˆ¶æ¶æ„ï¼Œæ ¸å¿ƒæ˜¯ä¸ºäº†å‡å°‘ Ectd å’Œ Kubernetes API Server çš„å‹åŠ›ï¼Œå¢å¼ºé›†ç¾¤çš„ç¨³å®šæ€§ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes client-go informer åŸç†</title>
      <link>https://cloudnativecn.com/blog/client-go-informer/</link>
      <pubDate>Fri, 28 Aug 2020 07:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/client-go-informer/</guid>
      <description>&lt;h2 id=&#34;informer-åŸç†å›¾&#34;&gt;Informer åŸç†å›¾&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†ä¾¿äºç†è§£ï¼Œå…ˆä¸Šä¸¤å¼ å›¾ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æºç çš„è°ƒç”¨æµç¨‹å›¾&#34;&gt;æºç çš„è°ƒç”¨æµç¨‹å›¾&lt;/h3&gt;
&lt;p&gt;å¯ä»¥å¯¹ç…§ç€å›¾ä¸­çš„ä»£ç æ–‡ä»¶åŠä»£ç è¡Œæ•°è·Ÿä¸‹ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨ï¼šå›¾ä¸­çš„ä»£ç è¡Œæ•°åŸºäº&lt;code&gt;1.15&lt;/code&gt;ç‰ˆã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-informer&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;informer&#34; srcset=&#34;
               /blog/client-go-informer/informer_hu6932523915327698508.webp 400w,
               /blog/client-go-informer/informer_hu624736244365599492.webp 760w,
               /blog/client-go-informer/informer_hu8001738689120064020.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/client-go-informer/informer_hu6932523915327698508.webp&#34;
               width=&#34;760&#34;
               height=&#34;371&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      informer
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;æ•°æ®ç»“æ„å›¾&#34;&gt;æ•°æ®ç»“æ„å›¾&lt;/h3&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-informer-data-structure&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;informer-data-structure&#34; srcset=&#34;
               /blog/client-go-informer/informer-data-structure_hu564113103253271966.webp 400w,
               /blog/client-go-informer/informer-data-structure_hu14447723149765886419.webp 760w,
               /blog/client-go-informer/informer-data-structure_hu13670628296491342540.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/client-go-informer/informer-data-structure_hu564113103253271966.webp&#34;
               width=&#34;760&#34;
               height=&#34;459&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      informer-data-structure
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;informer-å·¥å‚&#34;&gt;Informer å·¥å‚&lt;/h2&gt;
&lt;p&gt;å…ˆæ¥çœ‹ä¸‹&lt;code&gt;cmd/kube-controller-manager/app/controllermanager.go:162&lt;/code&gt;çš„&lt;code&gt;Run&lt;/code&gt;æ–¹æ³•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CompletedConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;run&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;rootClientBuilder&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;controller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SimpleControllerClientBuilder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;ClientConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Kubeconfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;clientBuilder&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;controller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ControllerClientBuilder&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ComponentConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;KubeCloudShared&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;UseServiceAccountCredentials&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ComponentConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SAController&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ServiceAccountKeyFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;c1&#34;&gt;// It&amp;#39;s possible another controller process is creating the tokens for us.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;				&lt;span class=&#34;c1&#34;&gt;// If one isn&amp;#39;t, we&amp;#39;ll timeout and exit when our client builder is unable to create the tokens.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;				&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Warningf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;--use-service-account-credentials was specified without providing a --service-account-private-key-file&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;shouldTurnOnDynamicClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;using dynamic client builder&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;c1&#34;&gt;//Dynamic builder will use TokenRequest feature and refresh service account token periodically
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;				&lt;span class=&#34;nx&#34;&gt;clientBuilder&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;controller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewDynamicClientBuilder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;restclient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AnonymousClientConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Kubeconfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;CoreV1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;s&#34;&gt;&amp;#34;kube-system&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;using legacy client builder&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;clientBuilder&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;controller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SAControllerClientBuilder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;ClientConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;         &lt;span class=&#34;nx&#34;&gt;restclient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AnonymousClientConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Kubeconfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;CoreClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;           &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;CoreV1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;AuthenticationClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AuthenticationV1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;Namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;            &lt;span class=&#34;s&#34;&gt;&amp;#34;kube-system&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;clientBuilder&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rootClientBuilder&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;controllerContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;CreateControllerContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rootClientBuilder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;clientBuilder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Done&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fatalf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;error building controller context: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;saTokenControllerInitFunc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;serviceAccountTokenControllerStarter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootClientBuilder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rootClientBuilder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;startServiceAccountTokenController&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;StartControllers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;controllerContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;saTokenControllerInitFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewControllerInitializers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;controllerContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LoopMode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsecuredMux&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fatalf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;error starting controllers: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;controllerContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InformerFactory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;controllerContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Stop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;controllerContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GenericInformerFactory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;controllerContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Stop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nb&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;controllerContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InformersStarted&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢ä»£ç ä¸­æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªæ–¹æ³•&lt;code&gt;CreateControllerContext&lt;/code&gt;, &lt;code&gt;StartControllers&lt;/code&gt;, &lt;code&gt;controllerContext.InformerFactory.Start&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åˆ›å»º-controllercontext&#34;&gt;åˆ›å»º ControllerContext&lt;/h3&gt;
&lt;p&gt;å†æ¬¡è¿›å…¥&lt;code&gt;CreateControllerContext&lt;/code&gt;æ–¹æ³•ä¸­ï¼Œä¸€ç›´è·Ÿä¸‹å»ï¼Œæœ€ç»ˆä¼šè°ƒç”¨åˆ°&lt;code&gt;vendor/k8s.io/client-go/informers/factory.go:108&lt;/code&gt;çš„&lt;code&gt;NewSharedInformerFactoryWithOptions&lt;/code&gt;æ–¹æ³•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewSharedInformerFactoryWithOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kubernetes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;defaultResync&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Duration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SharedInformerOption&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;SharedInformerFactory&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;factory&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sharedInformerFactory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;           &lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NamespaceAll&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;defaultResync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;defaultResync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;informers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;        &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SharedIndexInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;startedInformers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;customResync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Duration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Apply all options
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;opt&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;options&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;factory&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;opt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;factory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;factory&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ&lt;code&gt;sharedInformerFactory&lt;/code&gt;ç»“æ„ä½“ä¸­ï¼Œæœ‰ä¸€ä¸ª&lt;code&gt;informers&lt;/code&gt;çš„&lt;code&gt;map&lt;/code&gt;ï¼Œè¿™ä¸ª map çš„ key ä¸ºèµ„æºç±»å‹ï¼Œvalue ä¸ºå…³æ³¨è¯¥èµ„æºç±»å‹çš„ Informerã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¯åŠ¨æ‰€æœ‰å†…ç½®çš„-controller&#34;&gt;å¯åŠ¨æ‰€æœ‰å†…ç½®çš„ Controller&lt;/h3&gt;
&lt;p&gt;å†æ¥çœ‹&lt;code&gt;StartControllers&lt;/code&gt;æ–¹æ³•ï¼Œè°ƒç”¨&lt;code&gt;StartControllers&lt;/code&gt;ä¹‹å‰ï¼Œä¼šå…ˆè°ƒç”¨&lt;code&gt;NewControllerInitializers&lt;/code&gt;æ–¹æ³•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewControllerInitializers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;loopMode&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ControllerLoopMode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InitFunc&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;controllers&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InitFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;controllers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;deployment&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;startDeploymentController&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;controllers&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥è¿”å›æ‰€æœ‰çš„å†…ç½® controller, è¿™é‡Œ map ä¸­çš„ value å­˜çš„åªæ˜¯ç›¸åº”çš„å›è°ƒå‡½æ•°ï¼Œæ­¤æ—¶è¿˜æ²¡è°ƒç”¨ï¼Œåœ¨&lt;code&gt;StartControllers&lt;/code&gt;æ–¹æ³•ä¸­ä¼šå®é™…è°ƒç”¨ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥è°ƒç”¨ StartControllers æ–¹æ³•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;StartControllers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ControllerContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;startSATokenController&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;InitFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;controllers&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InitFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsecuredMux&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mux&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PathRecorderMux&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;controllerName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;initFn&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;controllers&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;debugHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;started&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;initFn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œå¾ªç¯&lt;code&gt;NewControllerInitializers&lt;/code&gt;æ–¹æ³•è¿”å›çš„æ‰€æœ‰ controller, å–åˆ° map çš„ value, ç„¶åè°ƒç”¨ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å¯åŠ¨å„ä¸ª-controller&#34;&gt;å¯åŠ¨å„ä¸ª Controller&lt;/h4&gt;
&lt;p&gt;å†æ¥çœ‹ä¸Šä¸€æ­¥çš„&lt;code&gt;initFn&lt;/code&gt;, ä¹Ÿå°±æ˜¯å„ä¸ª&lt;code&gt;startXXXController&lt;/code&gt;æ–¹æ³•ï¼Œæˆ‘ä»¬ä»¥&lt;code&gt;startDeploymentController&lt;/code&gt;ä¸ºä¾‹ï¼Œ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;startDeploymentController&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ControllerContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;AvailableResources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;schema&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;GroupVersionResource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;apps&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;v1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Resource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;deployments&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;dc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;deployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewDeploymentController&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InformerFactory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Apps&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;V1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Deployments&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InformerFactory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Apps&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;V1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ReplicaSets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InformerFactory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Core&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;V1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ClientBuilder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ClientOrDie&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;deployment-controller&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;error creating Deployment controller: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;dc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ComponentConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DeploymentController&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ConcurrentDeploymentSyncs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Stop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;deployment.NewDeploymentController&lt;/code&gt;å‡½æ•°åˆ›å»ºäº†&lt;code&gt;Deployment Controller&lt;/code&gt;ï¼Œè€Œè¯¥åˆ›å»ºå‡½æ•°çš„å‰ä¸‰ä¸ªå‚æ•°åˆ†åˆ«ä¸º Deploymentã€ReplicaSetã€Pod çš„ Informer. å¯ä»¥çœ‹åˆ°ï¼ŒInformer çš„å•ä¾‹å·¥å‚ä»¥ ApiGroup ä¸ºè·¯å¾„æä¾›äº†ä¸åŒèµ„æºçš„ Informer.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;.Apps().V1().Deployments()&lt;/code&gt;æ–¹æ³•è¿”å›çš„è™½ç„¶å«&lt;code&gt;DeploymentInformer&lt;/code&gt;, ä½†è¿™ä¸æ˜¯çœŸæ­£çš„ Informer&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Deployments&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;DeploymentInformer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;deploymentInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;factory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;factory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tweakListOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tweakListOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;çœŸæ­£çš„&lt;code&gt;Informer&lt;/code&gt;æ˜¯åœ¨è°ƒç”¨&lt;code&gt;NewDeploymentController&lt;/code&gt; -&amp;gt; &lt;code&gt;dInformer.Informer()&lt;/code&gt; -&amp;gt; &lt;code&gt;f.factory.InformerFor&lt;/code&gt;æ–¹æ³•åˆ›å»ºçš„&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewDeploymentController&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;dInformer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;appsinformers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DeploymentInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rsInformer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;appsinformers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ReplicaSetInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;podInformer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;coreinformers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PodInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;clientset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DeploymentController&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;eventBroadcaster&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;record&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewBroadcaster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;eventBroadcaster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;StartLogging&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;eventBroadcaster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;StartRecordingToSink&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1core&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EventSinkImpl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;CoreV1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Events&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;CoreV1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RESTClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetRateLimiter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metrics&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RegisterMetricAndTrackRateLimiterUsage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;deployment_controller&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;CoreV1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RESTClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetRateLimiter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;dc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DeploymentController&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;eventRecorder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;eventBroadcaster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewRecorder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;scheme&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Scheme&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EventSource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Component&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;deployment-controller&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;queue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;         &lt;span class=&#34;nx&#34;&gt;workqueue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewNamedRateLimitingQueue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;workqueue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;DefaultControllerRateLimiter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;deployment&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;dc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rsControl&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;controller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RealRSControl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;KubeClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;Recorder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;   &lt;span class=&#34;nx&#34;&gt;dc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;eventRecorder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;dInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Informer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddEventHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResourceEventHandlerFuncs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;AddFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;dc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;addDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;UpdateFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;dc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;updateDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// This will enter the sync loop and no-op, because the deployment has been deleted from the store.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;DeleteFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;dc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;deleteDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;rsInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Informer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddEventHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResourceEventHandlerFuncs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;AddFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;dc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;addReplicaSet&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;UpdateFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;dc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;updateReplicaSet&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;DeleteFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;dc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;deleteReplicaSet&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;podInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Informer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddEventHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResourceEventHandlerFuncs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;DeleteFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;dc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;deletePod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;dc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;syncHandler&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;dc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;syncDeployment&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;dc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;enqueueDeployment&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;dc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;enqueue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;dc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;dLister&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;dInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lister&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;dc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rsLister&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rsInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lister&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;dc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;podLister&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;podInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lister&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;dc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;dListerSynced&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;dInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Informer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;HasSynced&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;dc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rsListerSynced&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rsInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Informer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;HasSynced&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;dc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;podListerSynced&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;podInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Informer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;HasSynced&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;dc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;staging&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;src&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;k8s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;io&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;informers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;apps&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;deployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;83&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;deploymentInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Informer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SharedIndexInformer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;factory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;InformerFor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;appsv1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;defaultInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;staging&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;src&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;k8s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;io&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;informers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;apps&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;deployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;79&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;deploymentInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;defaultInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kubernetes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resyncPeriod&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Duration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SharedIndexInformer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewFilteredDeploymentInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resyncPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Indexers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NamespaceIndex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MetaNamespaceIndexFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tweakListOptions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;staging&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;src&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;k8s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;io&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;informers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;factory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;163&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sharedInformerFactory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;InformerFor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newFunc&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;internalinterfaces&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NewInformerFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SharedIndexInformer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;informerType&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TypeOf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;informer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;informers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;informerType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;informer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;resyncPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;customResync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;informerType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;resyncPeriod&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;defaultResync&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;informer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resyncPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;informers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;informerType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;informer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;informer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»ä¸Šé¢çš„&lt;code&gt;InformerFor&lt;/code&gt;æ–¹æ³•å¯ä»¥çœ‹åˆ°ï¼Œ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœ Informer å·¥å‚é‡Œå·²ç»å­˜åœ¨ informer, å°±ç›´æ¥è¿”å›äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ç§èµ„æºå§‹ç»ˆåªæœ‰ä¸€ä¸ª informer&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è°ƒç”¨ä¼ è¿›æ¥çš„å‚æ•°&lt;code&gt;newFunc&lt;/code&gt;å®ä¾‹åŒ– informer(æ³¨ï¼š&lt;code&gt;newFunc&lt;/code&gt;å³ä¸º&lt;code&gt;defaultInformer&lt;/code&gt;, è¿”å›çš„ç±»å‹ä¸º&lt;code&gt;cache.SharedIndexInformer&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è‡³æ­¤ï¼ŒDeploymentInformer è¢«å®ä¾‹åŒ–ï¼Œå¹¶çœŸæ­£çš„æ‰¿æ‹… Informer çš„èŒè´£ï¼ŒåŒæ—¶æ·»åŠ åˆ° Informer å·¥å‚çš„ map ä¸­ã€‚&lt;/p&gt;
&lt;h3 id=&#34;informerfactory-å¯åŠ¨&#34;&gt;InformerFactory å¯åŠ¨&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sharedInformerFactory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;informerType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;informer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;informers&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;startedInformers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;informerType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;informer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;startedInformers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;informerType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;staging&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;src&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;k8s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;io&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tools&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;shared_informer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;242&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sharedIndexInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;utilruntime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HandleCrash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;fifo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewDeltaFIFO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MetaNamespaceKeyFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;cfg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;Queue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;            &lt;span class=&#34;nx&#34;&gt;fifo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;ListerWatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listerWatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;ObjectType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;objectType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;FullResyncPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;resyncCheckPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;RetryOnError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;ShouldResync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;shouldResync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;Process&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;HandleDeltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;startedLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;startedLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;controller&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;New&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cfg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;controller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;controller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;clock&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;clock&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;started&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Separate stop channel because Processor should be stopped strictly after controller
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;processorStopCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Group&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;              &lt;span class=&#34;c1&#34;&gt;// Wait for Processor to stop
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processorStopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Tell Processor to stop
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;StartWithChannel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processorStopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cacheMutationDetector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;StartWithChannel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processorStopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;startedLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;startedLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopped&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Don&amp;#39;t want any new listeners
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;controller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;sharedIndexInformer&lt;/code&gt;çš„&lt;code&gt;Run&lt;/code&gt;æ–¹æ³•ä»£ç ä¸å¤šï¼Œä½†æ˜¯å¾ˆé‡è¦ï¼Œè¿™å—é€»è¾‘å³ä¸ºç¬¬ä¸€å¼ å›¾ä¸­ç²‰çº¢è‰²çš„åœ°æ–¹ï¼Œä¸»è¦åšäº†ä¸‹é¢å‡ ä»¶äº‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆå§‹åŒ– fifo é˜Ÿåˆ—&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ– controller&lt;/li&gt;
&lt;li&gt;å¯åŠ¨ cacheMutationDetector&lt;/li&gt;
&lt;li&gt;å¯åŠ¨ processor&lt;/li&gt;
&lt;li&gt;è¿è¡Œ controller(æ­¤ controller é XXXController)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œçœ‹ä¸‹è¿™å‡ ä»¶äº‹æƒ…çš„è¯¦ç»†è¿‡ç¨‹&lt;/p&gt;
&lt;h4 id=&#34;sharedindexinformer&#34;&gt;sharedIndexInformer&lt;/h4&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆæŠŠè§†çº¿æ‹‰å›åˆ°ä¸Šé¢ç¬¬ä¸€å¼ å›¾ç‰‡çš„æœ€å³ä¾§ï¼Œå› ä¸ºè¿™å—åšäº†ä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œï¼Œä»¥ä¾¿åé¢çš„é€»è¾‘ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewSharedIndexInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lw&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ListerWatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;objType&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;defaultEventHandlerResyncPeriod&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Duration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;indexers&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Indexers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;SharedIndexInformer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;realClock&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;clock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RealClock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;sharedIndexInformer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sharedIndexInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;processor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;                       &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sharedProcessor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;clock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;realClock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;indexer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;                         &lt;span class=&#34;nf&#34;&gt;NewIndexer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DeletionHandlingMetaNamespaceKeyFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;indexers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;listerWatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;                   &lt;span class=&#34;nx&#34;&gt;lw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;objectType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;                      &lt;span class=&#34;nx&#34;&gt;objType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;resyncCheckPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;defaultEventHandlerResyncPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;defaultEventHandlerResyncPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;defaultEventHandlerResyncPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;cacheMutationDetector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;           &lt;span class=&#34;nf&#34;&gt;NewCacheMutationDetector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sprintf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%T&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;objType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;clock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;                           &lt;span class=&#34;nx&#34;&gt;realClock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sharedIndexInformer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨&lt;code&gt;sharedIndexInformer&lt;/code&gt;çš„åˆå§‹åŒ–é€»è¾‘ä¸­ï¼Œåˆå§‹åŒ–äº†&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;processor: æä¾›äº† EventHandler æ³¨å†Œå’Œäº‹ä»¶åˆ†å‘çš„åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;indexer: æä¾›äº†èµ„æºç¼“å­˜çš„åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;listerWatcher: ç”±æ¨¡æ¿ç±»æä¾›ï¼ŒåŒ…å«ç‰¹å®šèµ„æºçš„ List å’Œ Watch æ–¹æ³•&lt;/li&gt;
&lt;li&gt;objectType: ç”¨æ¥æ ‡è®°å…³æ³¨å“ªç§ç‰¹å®šèµ„æºç±»å‹&lt;/li&gt;
&lt;li&gt;cacheMutationDetector: ç›‘æ§ Informer çš„ç¼“å­˜&lt;/li&gt;
&lt;/ol&gt;
&lt;h5 id=&#34;sharedprocessor&#34;&gt;sharedProcessor&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sharedProcessor&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;listenersStarted&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;listenersLock&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RWMutex&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;listeners&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processorListener&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;syncingListeners&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processorListener&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;clock&lt;/span&gt;            &lt;span class=&#34;nx&#34;&gt;clock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Clock&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Group&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;processorListener&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;nextCh&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;addCh&lt;/span&gt;  &lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ResourceEventHandler&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// pendingNotifications is an unbounded ring buffer that holds all notifications not yet distributed.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// There is one per listener, but a failing/stalled listener will have infinite pendingNotifications
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// added until we OOM.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// TODO: This is no worse than before, since reflectors were backed by unbounded DeltaFIFOs, but
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// we should try to do something better.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;pendingNotifications&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RingGrowing&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// requestedResyncPeriod is how frequently the listener wants a full resync from the shared informer
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;requestedResyncPeriod&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Duration&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// resyncPeriod is how frequently the listener wants a full resync from the shared informer. This
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// value may differ from requestedResyncPeriod if the shared informer adjusts it to align with the
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// informer&amp;#39;s overall resync check period.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;resyncPeriod&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Duration&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// nextResync is the earliest time the listener should get a full resync
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;nextResync&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Time&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// resyncLock guards access to resyncPeriod and nextResync
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;resyncLock&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Mutex&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨&lt;code&gt;sharedProcessor&lt;/code&gt;ç»“æ„ä½“ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ª&lt;code&gt;processorListener&lt;/code&gt;çš„åˆ‡ç‰‡&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä»¬æ³¨å†Œä¸€ä¸ª Handler åˆ° Informer æ—¶ï¼Œæœ€ç»ˆä¼šè¢«è½¬æ¢ä¸ºä¸€ä¸ªåä¸º &lt;code&gt;processorListener&lt;/code&gt; ç»“æ„ä½“çš„å®ä¾‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newProcessListener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ResourceEventHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;requestedResyncPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;resyncPeriod&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Duration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;now&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bufferSize&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processorListener&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;ret&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processorListener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;nextCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;                &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;addCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;                 &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;pendingNotifications&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewRingGrowing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bufferSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;requestedResyncPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;requestedResyncPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;resyncPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;          &lt;span class=&#34;nx&#34;&gt;resyncPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;ret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;determineNextResync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;now&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ret&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥å®ä¾‹ä¸»è¦åŒ…å«ä¸¤ä¸ª channel å’Œå¤–é¢æ³¨å†Œçš„ Handler æ–¹æ³•ã€‚è€Œæ­¤å¤„è¢«å®ä¾‹åŒ–çš„ &lt;code&gt;processorListener&lt;/code&gt; å¯¹è±¡æœ€ç»ˆä¼šè¢«æ·»åŠ åˆ° &lt;code&gt;sharedProcessor.listeners&lt;/code&gt; åˆ—è¡¨ä¸­&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sharedProcessor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;addListener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processorListener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listenersLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listenersLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;addListenerLocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listenersStarted&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;åˆå§‹åŒ–-deltafifo&#34;&gt;åˆå§‹åŒ– DeltaFIFO&lt;/h4&gt;
&lt;p&gt;æœ‰äº†å‰é¢åˆå§‹åŒ–çš„&lt;code&gt;sharedIndexInformer&lt;/code&gt;, ç°åœ¨å¼€å§‹è§£æ&lt;code&gt;sharedIndexInformer&lt;/code&gt;çš„&lt;code&gt;Run&lt;/code&gt;æ–¹æ³•&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;fifo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewDeltaFIFO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MetaNamespaceKeyFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// s.indexer å†å‰é¢å·²ç»åˆå§‹åŒ–å¥½
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewDeltaFIFO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;keyFunc&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;KeyFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;knownObjects&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;KeyListerGetter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DeltaFIFO&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DeltaFIFO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;        &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Deltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;queue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;keyFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;keyFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;knownObjects&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;knownObjects&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;L&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;åˆå§‹åŒ–-controlleræ³¨æ„æ­¤å¤„çš„-process-å­—æ®µè¢«èµ‹å€¼ä¸º-shandledeltas&#34;&gt;åˆå§‹åŒ– controller(æ³¨æ„æ­¤å¤„çš„ Process å­—æ®µè¢«èµ‹å€¼ä¸º s.HandleDeltas)&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;cfg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;Queue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;            &lt;span class=&#34;nx&#34;&gt;fifo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;ListerWatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listerWatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;ObjectType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;objectType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;FullResyncPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;resyncCheckPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;RetryOnError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;ShouldResync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;shouldResync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;Process&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;HandleDeltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;startedLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;startedLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;controller&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;New&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cfg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;controller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;controller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;clock&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;clock&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;started&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;New&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Controller&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;ctlr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;controller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;clock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;clock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RealClock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ctlr&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;å¯åŠ¨-processor&#34;&gt;å¯åŠ¨ processor&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sharedProcessor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listenersLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listenersLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RUnlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listeners&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listenersStarted&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listenersLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listenersLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RUnlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listeners&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nb&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;addCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Tell .pop() to stop. .pop() will tell .run() to stop
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Wait for all .pop() and .run() to stop
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œä¸»è¦æ˜¯å¾ªç¯&lt;code&gt;sharedProcessor&lt;/code&gt;é‡Œæ‰€æœ‰çš„ listener, ç„¶åè°ƒç”¨äº†&lt;code&gt;listener.run&lt;/code&gt;å’Œ&lt;code&gt;listener.pop&lt;/code&gt;&lt;/p&gt;
&lt;h5 id=&#34;listenerrun&#34;&gt;listener.run&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processorListener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// this call blocks until the channel is closed.  When a panic happens during the notification
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// we will catch it, **the offending item will be skipped!**, and after a short delay (one second)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// the next notification will be attempted.  This is usually better than the alternative of never
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// delivering again.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Until&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// this gives us a few quick retries before a long pause and then a few more quick retries
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ExponentialBackoff&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;retry&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DefaultRetry&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nextCh&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;notification&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;updateNotification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;OnUpdate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;notification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;notification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;newObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;addNotification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;OnAdd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;notification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;newObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;deleteNotification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;OnDelete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;notification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;nx&#34;&gt;utilruntime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HandleError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;unrecognized notification: %T&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;c1&#34;&gt;// the only way to get here is if the p.nextCh is empty and closed
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// the only way to get here is if the p.nextCh is empty and closed
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nb&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Minute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;listener åŒ…å«äº† Controller æ³¨å†Œè¿›æ¥çš„ Handler æ–¹æ³•ï¼Œå› æ­¤ listener æœ€é‡è¦çš„èŒèƒ½å°±æ˜¯å½“äº‹ä»¶å‘ç”Ÿæ—¶æ¥è§¦å‘è¿™äº›æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œ&lt;code&gt;listener.run&lt;/code&gt; ä¸åœçš„ä» &lt;code&gt;nextCh&lt;/code&gt; è¿™ä¸ª channel ä¸­æ‹¿åˆ°äº‹ä»¶ï¼Œä½†æ˜¯ &lt;code&gt;nextCh&lt;/code&gt; è¿™ä¸ª channel é‡Œçš„äº‹ä»¶åˆæ˜¯ä»å“ªæ¥çš„å‘¢ï¼Ÿ&lt;code&gt;listener.pop&lt;/code&gt; çš„èŒè´£ä¾¿æ˜¯å°†äº‹ä»¶æ”¾å…¥ &lt;code&gt;nextCh&lt;/code&gt; ä¸­ã€‚&lt;/p&gt;
&lt;h5 id=&#34;listenerpop&#34;&gt;listener.pop&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processorListener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;pop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;utilruntime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HandleCrash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nextCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Tell .run() to stop
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nextCh&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;notification&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nextCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;notification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;c1&#34;&gt;// Notification dispatched
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;notification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pendingNotifications&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ReadOne&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Nothing to pop
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;				&lt;span class=&#34;nx&#34;&gt;nextCh&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Disable this select case
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;notificationToAdd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;addCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;notification&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// No notification to pop (and pendingNotifications is empty)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;				&lt;span class=&#34;c1&#34;&gt;// Optimize the case - skip adding to pendingNotifications
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;				&lt;span class=&#34;nx&#34;&gt;notification&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;notificationToAdd&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;nextCh&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nextCh&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// There is already a notification waiting to be dispatched
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;				&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pendingNotifications&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;WriteOne&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;notificationToAdd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;listener&lt;/code&gt; ä¹‹æ‰€ä»¥åŒ…å«äº†ä¸¤ä¸ª channelï¼š&lt;code&gt;addCh&lt;/code&gt; å’Œ &lt;code&gt;nextCh&lt;/code&gt;ï¼Œæ˜¯å› ä¸º Informer æ— æ³•é¢„çŸ¥ &lt;code&gt;listener.handler&lt;/code&gt; çš„äº‹ä»¶æ¶ˆè´¹çš„é€Ÿåº¦æ˜¯å¦å¤§äºäº‹ä»¶ç”Ÿäº§çš„é€Ÿåº¦ï¼Œå› æ­¤æ·»åŠ äº†ä¸€ä¸ªåä¸º &lt;code&gt;pendingNotifications&lt;/code&gt; çš„ç¼“å†²é˜Ÿåˆ—æ¥ä¿å­˜æœªæ¥å¾—åŠæ¶ˆè´¹çš„äº‹ä»¶&lt;/p&gt;
&lt;p&gt;&lt;code&gt;pop&lt;/code&gt; æ–¹æ³•ä¸€æ–¹é¢ä¼šä¸åœçš„ä» &lt;code&gt;addCh&lt;/code&gt; ä¸­è·å¾—æœ€æ–°äº‹ä»¶ï¼Œä»¥ä¿è¯ä¸ä¼šè®©ç”Ÿäº§æ–¹é˜»å¡ã€‚ç„¶ååˆ¤æ–­æ˜¯å¦å­˜åœ¨ bufferï¼Œå¦‚æœå­˜åœ¨åˆ™æŠŠäº‹ä»¶æ·»åŠ åˆ° buffer ä¸­ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™å°è¯•æ¨ç»™ &lt;code&gt;nextCh&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è€Œå¦ä¸€æ–¹é¢ï¼Œä¼šåˆ¤æ–­ buffer ä¸­æ˜¯å¦è¿˜æœ‰äº‹ä»¶ï¼Œå¦‚æœè¿˜æœ‰å­˜é‡ï¼Œåˆ™ä¸åœçš„ä¼ é€’ç»™ &lt;code&gt;nextCh&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;pop&lt;/code&gt; æ–¹æ³•å®ç°äº†ä¸€ä¸ªå¸¦ buffer çš„åˆ†å‘æœºåˆ¶ï¼Œä½¿å¾—äº‹ä»¶å¯ä»¥æºæºä¸æ–­çš„ä» &lt;code&gt;addCh&lt;/code&gt; åˆ° &lt;code&gt;nextCh&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&#34;è¿è¡Œ-controller&#34;&gt;è¿è¡Œ controller&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;controller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;utilruntime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HandleCrash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Queue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewReflector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ListerWatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ObjectType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Queue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;FullResyncPeriod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ShouldResync&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ShouldResync&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;clock&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;clock&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reflectorMutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reflector&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reflectorMutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Group&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;StartWithChannel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Until&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processLoop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Second&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;stopCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id=&#34;åˆå§‹åŒ–-reflector-å¹¶å¯åŠ¨&#34;&gt;åˆå§‹åŒ– Reflector å¹¶å¯åŠ¨&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;Reflector&lt;/code&gt;é€šè¿‡ sharedIndexInformer é‡Œå®šä¹‰çš„ &lt;code&gt;listerWatcher&lt;/code&gt; è¿›è¡Œ List-Watchï¼Œå¹¶å°†è·å¾—çš„äº‹ä»¶æ¨å…¥ DeltaFIFO ä¸­ï¼Œ&lt;code&gt;controller&lt;/code&gt; å¯åŠ¨ä¹‹åä¼šå…ˆå°† &lt;code&gt;Reflector&lt;/code&gt; å¯åŠ¨ã€‚&lt;/p&gt;
&lt;h5 id=&#34;æ‰§è¡Œ-cprocessloop&#34;&gt;æ‰§è¡Œ c.processLoop&lt;/h5&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;controller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;processLoop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Queue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;PopProcessFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Process&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;FIFOClosedError&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RetryOnError&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;c1&#34;&gt;// This is the safe way to re-enqueue.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;				&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Queue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddIfNotPresent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡ä¸€ä¸ªæ­»å¾ªç¯ï¼Œä¸åœçš„å°†ä» DeltaFIFO è¯»å‡ºéœ€è¦å¤„ç†çš„èµ„æºäº‹ä»¶ï¼Œç„¶åäº¤ç»™&lt;code&gt;c.config.Process&lt;/code&gt;å‡½æ•°å¤„ç†ï¼Œåœ¨å‰é¢åˆå§‹åŒ– controller æ—¶ï¼Œ&lt;code&gt;c.config.Process&lt;/code&gt;è¢«èµ‹å€¼ä¸º&lt;code&gt;s.HandleDeltas&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sharedIndexInformer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;HandleDeltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;blockDeltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;blockDeltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// from oldest to newest
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Deltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Added&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Updated&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;isSync&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Sync&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cacheMutationDetector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddObject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Update&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;distribute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;updateNotification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isSync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;distribute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;addNotification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;newObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isSync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Deleted&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Delete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;distribute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;deleteNotification&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œè°ƒç”¨äº†&lt;code&gt;s.indexer.Add&lt;/code&gt; &lt;code&gt;s.indexer.Update&lt;/code&gt; &lt;code&gt;s.indexer.Delete&lt;/code&gt;ä»¥åŠ&lt;code&gt;s.processor.distribute&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;s.indexer.Add&lt;/code&gt; &lt;code&gt;s.indexer.Update&lt;/code&gt; &lt;code&gt;s.indexer.Delete&lt;/code&gt;æœ€åéƒ½è°ƒç”¨äº†&lt;code&gt;queueActionLocked&lt;/code&gt;æ–¹æ³•&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;DeltaFIFO&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;queueActionLocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;actionType&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;DeltaType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;KeyOf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;KeyError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;newDeltas&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Delta&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;actionType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;newDeltas&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;dedupDeltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;newDeltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;newDeltas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;queue&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;queue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newDeltas&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Broadcast&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;c1&#34;&gt;// We need to remove this from our map (extra items in the queue are
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;c1&#34;&gt;// ignored if they are not in the map).
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nb&#34;&gt;delete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è€Œ&lt;code&gt;s.processor.distribute&lt;/code&gt;æ˜¯æŠŠäº‹ä»¶åˆ†å‘åˆ° listener&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sharedProcessor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;distribute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listenersLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listenersLock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;RUnlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;syncingListeners&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;listeners&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;listener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;processorListener&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;notification&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;addCh&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;notification&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œ&lt;code&gt;distribute&lt;/code&gt;æ–¹æ³•è°ƒç”¨&lt;code&gt;listener.add&lt;/code&gt;, &lt;code&gt;listener.add&lt;/code&gt;ä¼šå°†äº‹ä»¶å‘é€åˆ°&lt;code&gt;addCh&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è‡³æ­¤ï¼Œæ•´ä¸ªäº‹ä»¶æµå°±æ‰“é€šäº†ï¼Œå¦‚ä¸‹å›¾ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-informer-event-stream&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;informer-event-stream&#34; srcset=&#34;
               /blog/client-go-informer/informer-event-stream_hu12799600889506455831.webp 400w,
               /blog/client-go-informer/informer-event-stream_hu14100441741365506259.webp 760w,
               /blog/client-go-informer/informer-event-stream_hu13725616485066567356.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/client-go-informer/informer-event-stream_hu12799600889506455831.webp&#34;
               width=&#34;760&#34;
               height=&#34;459&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      informer-event-stream
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;Informer æœºåˆ¶æ˜¯ kubernetes çš„æ ¸å¿ƒï¼Œäº†è§£æ¸…æ¥šè¿™ä¸ªæœºåˆ¶ï¼Œåç»­ç†è§£ controller manager å°±å®¹æ˜“å¤šäº†ï¼Œè€Œä¸”ä¹Ÿèƒ½æ›´å¾—å¿ƒåº”æ‰‹çš„ç¼–å†™è‡ªå®šä¹‰çš„ controllerã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒèµ„æ–™&#34;&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/client-go&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;client-go æºç &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>client-go æºç å­¦ä¹ æ€»ç»“</title>
      <link>https://cloudnativecn.com/blog/client-go-study/</link>
      <pubDate>Fri, 07 Aug 2020 21:28:37 +0000</pubDate>
      <guid>https://cloudnativecn.com/blog/client-go-study/</guid>
      <description>&lt;p&gt;ç›®å‰åœ¨äº‘åŸç”Ÿç¤¾åŒºçš„ Kubernetes æºç ç ”ä¹ ç¤¾ä¸­å’Œå¹¿å¤§å­¦å‹ä»¬å…±åŒå­¦ä¹ éƒ‘ä¸œæ—­å¤§ä½¬çš„ &lt;a href=&#34;https://item.jd.com/12665791.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes æºç å‰–æ&lt;/a&gt;è¿™æœ¬ä¹¦ã€‚å½“å‰æ­£åœ¨å¼€å±•ç¬¬ä¸€æœŸå­¦ä¹ æ´»åŠ¨ï¼Œç¬¬äº”ç« èŠ‚ client-go çš„å­¦ä¹ ã€‚ä¹‹æ‰€ä»¥ä»è¿™ä¸€ç« èŠ‚å¼€å§‹å­¦ä¹ ï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ° client-go åœ¨æºç ä¸­ç›¸å¯¹æ¯”è¾ƒç‹¬ç«‹ï¼Œå¯ä»¥å•ç‹¬é˜…è¯»ã€‚æ›´ä¸»è¦çš„æ˜¯å®ƒæ˜¯ Kubernetes çš„æ ¸å¿ƒå¤„ç†æ¡†æ¶ï¼ŒåŸºæœ¬ä¸Šè¿ç”¨åœ¨ Kubernetes å„ä¸ªç»„ä»¶ä¸­ï¼Œå› æ­¤ï¼Œå¦‚æœä½ å­¦å¥½äº†è¿™ä¸€ç« èŠ‚ï¼Œå¯¹äºåé¢ Kubernetes æºç çš„é˜…è¯»ï¼Œå°†ä¼šæœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚æ­¤å¤–éšç€ Operator çš„ç››è¡Œï¼Œä¸€äº›å¼€æºçš„ç”Ÿæˆæ¡†æ¶ä¹Ÿå—åˆ°å¹¿å¤§ Operator å¼€å‘è€…ä»¬çš„é’çã€‚ä¾‹å¦‚ kubebuilder å’Œ operator-SDK ç­‰ã€‚è€Œç²¾é€šäº† client-goï¼Œå°†å¯¹ä½ ç†è§£è¿™äº›ç”Ÿæˆæ¡†æ¶åŠç¼–å†™ Operator ä¹Ÿæ˜¯æœ‰å¾ˆå¥½çš„å¸®åŠ©ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢å†…å®¹æ˜¯åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­æ€»ç»“çš„ç›¸å…³ç¬”è®°åŠä¸ªäººè§è§£ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¦‚æ‹¬&#34;&gt;æ¦‚æ‹¬&lt;/h2&gt;
&lt;p&gt;client-go æ˜¯ç”¨ Golang è¯­è¨€ç¼–å†™çš„å®˜æ–¹ç¼–ç¨‹å¼äº¤äº’å®¢æˆ·ç«¯åº“ï¼Œæä¾›å¯¹ Kubernetes API server æœåŠ¡çš„äº¤äº’è®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;å…¶æºç ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;discovery&lt;/strong&gt;: æä¾› DiscoveryClient å‘ç°å®¢æˆ·ç«¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;dynamic&lt;/strong&gt;: æä¾› DynamicClient åŠ¨æ€å®¢æˆ·ç«¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;informers&lt;/strong&gt;: æ¯ç§ K8S èµ„æºçš„ Informer å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;kubernetes&lt;/strong&gt;: æä¾› ClientSet å®¢æˆ·ç«¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;listers&lt;/strong&gt;: ä¸ºæ¯ä¸€ä¸ª K8S èµ„æºæä¾› Lister åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½å¯¹ Get å’Œ List è¯·æ±‚æä¾›åªè¯»çš„ç¼“å­˜æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;plugin&lt;/strong&gt;: æä¾› OpenStackï¼ŒGCP å’Œ Azure ç­‰äº‘æœåŠ¡å•†æˆæƒæ’ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;rest&lt;/strong&gt;: æä¾› RESTClient å®¢æˆ·ç«¯ï¼Œå¯¹ K8S API Server æ‰§è¡Œ RESTful æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;scale&lt;/strong&gt;: æä¾› ScaleClient å®¢æˆ·ç«¯ï¼Œç”¨äºæ‰©å®¹æˆ–ç¼©å®¹ Deployment, Replicaset, Replication Controller ç­‰èµ„æºå¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;tools&lt;/strong&gt;: æä¾›å¸¸ç”¨å·¥å…·ï¼Œä¾‹å¦‚ SharedInformer, Reflector, DeltaFIFO åŠ Indexersã€‚æä¾› Client æŸ¥è¯¢å’Œç¼“å­˜æœºåˆ¶ï¼Œä»¥å‡å°‘å‘ kube-apiserver å‘èµ·çš„è¯·æ±‚æ•°ç­‰ã€‚ä¸»è¦å­ç›®å½•ä¸º/tools/cacheã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;transport&lt;/strong&gt;: æä¾›å®‰å…¨çš„ TCP è¿æ¥ï¼Œæ”¯æŒ HTTP Streamï¼ŒæŸäº›æ“ä½œéœ€è¦åœ¨å®¢æˆ·ç«¯å’Œå®¹å™¨ä¹‹é—´ä¼ è¾“äºŒè¿›åˆ¶æµï¼Œä¾‹å¦‚ execï¼Œattach ç­‰æ“ä½œã€‚è¯¥åŠŸèƒ½ç”±å†…éƒ¨çš„ SPDY åŒ…æä¾›æ”¯æŒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;util&lt;/strong&gt;: æä¾›å¸¸ç”¨æ–¹æ³•ã€‚ä¾‹å¦‚ WorkQueue å·¥ä½œé˜Ÿåˆ—ï¼ŒCertificate è¯ä¹¦ç®¡ç†ç­‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;restclient-å®¢æˆ·ç«¯&#34;&gt;RESTClient å®¢æˆ·ç«¯&lt;/h2&gt;
&lt;p&gt;RESTful Client æ˜¯æœ€åŸºç¡€çš„å®¢æˆ·ç«¯ï¼Œå®ƒä¸»è¦æ˜¯å¯¹ HTTP è¯·æ±‚è¿›è¡Œäº†å°è£…ï¼Œå¹¶ä¸”æ”¯æŒ JSON å’Œ Protobuf æ ¼å¼æ•°æ®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;dynamicclient-å®¢æˆ·ç«¯&#34;&gt;DynamicClient å®¢æˆ·ç«¯&lt;/h2&gt;
&lt;p&gt;DynamicClient æ˜¯ä¸€ç§åŠ¨æ€å®¢æˆ·ç«¯ï¼Œå®ƒå¯ä»¥åŠ¨æ€çš„æŒ‡å®šèµ„æºçš„ç»„ï¼Œç‰ˆæœ¬å’Œèµ„æºã€‚å› æ­¤å®ƒå¯ä»¥å¯¹ä»»æ„ K8S èµ„æºè¿›è¡Œ RESTful æ“ä½œï¼ŒåŒ…æ‹¬ CRD è‡ªå®šä¹‰èµ„æºã€‚å®ƒå°è£…äº† RESTClientã€‚æ‰€ä»¥åŒæ ·æä¾› RESTClient çš„å„ç§æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“ä½¿ç”¨æ–¹æ³•ï¼Œå¯å‚è€ƒå®˜æ–¹ç¤ºä¾‹ï¼š&lt;a href=&#34;https://github.com/kubernetes/client-go/tree/master/examples/dynamic-create-update-delete-deployment&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;dynamic-create-update-delete-deployment&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;: è¯¥å®˜æ–¹ç¤ºä¾‹æ˜¯åŸºäºé›†ç¾¤å¤–çš„ç¯å¢ƒï¼Œå¦‚æœä½ éœ€è¦åœ¨é›†ç¾¤å†…éƒ¨ä½¿ç”¨ï¼ˆä¾‹å¦‚ä½ éœ€è¦åœ¨ container ä¸­è®¿é—®ï¼‰ï¼Œä½ å°†éœ€è¦è°ƒç”¨ &lt;code&gt;rest.InClusterConfig()&lt;/code&gt; ç”Ÿæˆä¸€ä¸ª configurationã€‚å…·ä½“çš„ç¤ºä¾‹è¯·å‚è€ƒ &lt;a href=&#34;https://github.com/kubernetes/client-go/tree/master/examples/in-cluster-client-configuration&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;in-cluster-client-configuration&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;clientset-å®¢æˆ·ç«¯&#34;&gt;ClientSet å®¢æˆ·ç«¯&lt;/h2&gt;
&lt;p&gt;ClientSet å®¢æˆ·ç«¯åœ¨ RESTClient çš„åŸºç¡€ä¸Šå°è£…äº†å¯¹èµ„æºå’Œç‰ˆæœ¬çš„ç®¡ç†æ–¹æ³•ã€‚æ¯ä¸ªèµ„æºå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œè€Œ ClientSet åˆ™æ˜¯å¤šä¸ªå®¢æˆ·ç«¯çš„é›†åˆï¼Œæ¯ä¸€ä¸ªèµ„æºå’Œç‰ˆæœ¬éƒ½ä»¥å‡½æ•°çš„æ–¹å¼æš´éœ²ç»™å¼€å‘è€…ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“ä½¿ç”¨æ–¹æ³•ï¼Œå¯å‚è€ƒå®˜æ–¹ç¤ºä¾‹ï¼š&lt;a href=&#34;https://github.com/kubernetes/client-go/tree/master/examples/create-update-delete-deployment&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;create-update-delete-deployment&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;discoveryclient-å®¢æˆ·ç«¯&#34;&gt;DiscoveryClient å®¢æˆ·ç«¯&lt;/h2&gt;
&lt;p&gt;DiscoveryClient æ˜¯ä¸€ä¸ªå‘ç°å®¢æˆ·ç«¯ï¼Œå®ƒä¸»è¦ç”¨äºå‘ç° K8S API Server æ”¯æŒçš„èµ„æºç»„ï¼Œèµ„æºç‰ˆæœ¬å’Œèµ„æºä¿¡æ¯ã€‚æ‰€ä»¥å¼€å‘è€…å¯ä»¥é€šè¿‡ä½¿ç”¨ DiscoveryClient å®¢æˆ·ç«¯æŸ¥çœ‹æ‰€æ”¯æŒçš„èµ„æºç»„ï¼Œèµ„æºç‰ˆæœ¬å’Œèµ„æºä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;clientset-vs-dynamicclient&#34;&gt;ClientSet VS DynamicClient&lt;/h2&gt;
&lt;p&gt;ç±»å‹åŒ– &lt;code&gt;ClientSets&lt;/code&gt; ä½¿å¾—ä½¿ç”¨é¢„å…ˆç”Ÿæˆçš„æœ¬åœ° API å¯¹è±¡ä¸ API æœåŠ¡å™¨é€šä¿¡å˜å¾—ç®€å•ï¼Œä»è€Œè·å¾—ç±»ä¼¼ &lt;code&gt;RPC&lt;/code&gt; çš„ç¼–ç¨‹ä½“éªŒã€‚ç±»å‹åŒ–å®¢æˆ·ç«¯ä½¿ç”¨ç¨‹åºç¼–è¯‘æ¥å¼ºåˆ¶æ‰§è¡Œæ•°æ®å®‰å…¨æ€§å’Œä¸€äº›éªŒè¯ã€‚ç„¶è€Œï¼Œåœ¨ä½¿ç”¨ç±»å‹åŒ–å®¢æˆ·ç«¯æ—¶ï¼Œç¨‹åºè¢«è¿«ä¸æ‰€ä½¿ç”¨çš„ç‰ˆæœ¬å’Œç±»å‹ç´§å¯†è€¦åˆã€‚&lt;/p&gt;
&lt;p&gt;è€Œ &lt;code&gt;DynamicClient&lt;/code&gt; åˆ™ä½¿ç”¨ &lt;code&gt;unstructured.Unstructured&lt;/code&gt; è¡¨ç¤ºæ¥è‡ª API Server çš„æ‰€æœ‰å¯¹è±¡å€¼ã€‚&lt;code&gt;Unstructured&lt;/code&gt; ç±»å‹æ˜¯ä¸€ä¸ªåµŒå¥—çš„ &lt;code&gt;map[string]inferface{}&lt;/code&gt; å€¼çš„é›†åˆæ¥åˆ›å»ºä¸€ä¸ªå†…éƒ¨ç»“æ„ï¼Œè¯¥ç»“æ„å’ŒæœåŠ¡ç«¯çš„ REST è´Ÿè½½éå¸¸ç›¸ä¼¼ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;DynamicClient&lt;/code&gt; å°†æ‰€æœ‰æ•°æ®ç»‘å®šæ¨è¿Ÿåˆ°è¿è¡Œæ—¶ï¼Œè¿™æ„å‘³ç€ç¨‹åºè¿è¡Œä¹‹å‰ï¼Œä½¿ç”¨ &lt;code&gt;DynamicClient&lt;/code&gt; çš„çš„ç¨‹åºå°†ä¸ä¼šè·å–åˆ°ç±»å‹éªŒè¯çš„ä»»ä½•å¥½å¤„ã€‚å¯¹äºæŸäº›éœ€è¦å¼ºæ•°æ®ç±»å‹æ£€æŸ¥å’ŒéªŒè¯çš„åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œæ¾è€¦åˆæ„å‘³ç€å½“å®¢æˆ·ç«¯ API å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä½¿ç”¨ &lt;code&gt;DynamicClient&lt;/code&gt; çš„ç¨‹åºä¸éœ€è¦é‡æ–°ç¼–è¯‘ã€‚å®¢æˆ·ç«¯ç¨‹åºåœ¨å¤„ç† API è¡¨é¢æ›´æ–°æ—¶å…·æœ‰æ›´å¤§çš„çµæ´»æ€§ï¼Œè€Œæ— éœ€æå‰çŸ¥é“è¿™äº›æ›´æ”¹æ˜¯ä»€ä¹ˆã€‚&lt;/p&gt;
&lt;h2 id=&#34;informer-åˆ†æ&#34;&gt;Informer åˆ†æ&lt;/h2&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªå®˜æ–¹å›¾å½¢è¡¨ç¤ºï¼Œå±•ç¤ºäº† client-go åº“ä¸­çš„å„ç§ç»„ä»¶å¦‚ä½•å·¥ä½œï¼Œä»¥åŠå®ƒä»¬ä¸å°†è¦ç¼–å†™çš„è‡ªå®šä¹‰æ§åˆ¶å™¨ä»£ç çš„äº¤äº’ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ldquocustom-controllerrdquo&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&amp;ldquo;custom controller&amp;rdquo;&#34; srcset=&#34;
               /blog/client-go-study/informer_hu8106387590596319033.webp 400w,
               /blog/client-go-study/informer_hu951792774307255356.webp 760w,
               /blog/client-go-study/informer_hu15833439809673982721.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/client-go-study/informer_hu8106387590596319033.webp&#34;
               width=&#34;760&#34;
               height=&#34;570&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      &amp;ldquo;custom controller&amp;rdquo;
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸‹é¢å¯¹å›¾ä¸­æ¯ä¸ªç»„ä»¶è¿›è¡Œç®€å•ä»‹ç»ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;client-go ç»„ä»¶&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Reflector&lt;/strong&gt;: å®šä¹‰åœ¨ &lt;a href=&#34;https://github.com/kubernetes/client-go/blob/master/tools/cache/reflector.go&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/tools/cache åŒ…å†…çš„ Reflector ç±»å‹&lt;/a&gt; ä¸­çš„ reflector ç›‘è§† Kubernetes API ä»¥è·å–æŒ‡å®šçš„èµ„æºç±»å‹ (Kind)ã€‚å®Œæˆæ­¤æ“ä½œçš„å‡½æ•°æ˜¯ ListAndWatchã€‚ç›‘è§†å¯ä»¥ç”¨äºå†…å»ºèµ„æºï¼Œä¹Ÿå¯ä»¥ç”¨äºè‡ªå®šä¹‰èµ„æºã€‚å½“ reflector é€šè¿‡ç›‘è§† API çš„æ”¶åˆ°å…³äºæ–°èµ„æºå®ä¾‹å­˜åœ¨çš„é€šçŸ¥æ—¶ï¼Œå®ƒä½¿ç”¨ç›¸åº”çš„ listing API è·å–æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œå¹¶å°†å…¶æ”¾å…¥ watchHandler å‡½æ•°å†…çš„ Delta Fifo é˜Ÿåˆ—ä¸­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Informer&lt;/strong&gt;: åœ¨ &lt;a href=&#34;https://github.com/kubernetes/client-go/blob/master/tools/cache/controller.go&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/tools/cache åŒ…å†…çš„åŸºç¡€ controller&lt;/a&gt; ä¸­å®šä¹‰çš„ä¸€ä¸ª informer ä» Delta FIFO é˜Ÿåˆ—ä¸­å¼¹å‡ºå¯¹è±¡ã€‚å®Œæˆæ­¤æ“ä½œçš„å‡½æ•°æ˜¯ processLoopã€‚è¿™ä¸ªåŸºç¡€ controller çš„ä»»åŠ¡æ˜¯ä¿å­˜å¯¹è±¡ä»¥ä¾›ä»¥åæ£€ç´¢ï¼Œå¹¶è°ƒç”¨ controller å°†å¯¹è±¡ä¼ é€’ç»™å®ƒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Indexer&lt;/strong&gt;: indexer ä¸ºå¯¹è±¡æä¾›ç´¢å¼•åŠŸèƒ½ã€‚å®ƒå®šä¹‰åœ¨ &lt;a href=&#34;https://github.com/kubernetes/client-go/blob/master/tools/cache/index.go&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/tools/cache åŒ…å†…çš„ Indexer ç±»å‹&lt;/a&gt;ã€‚ä¸€ä¸ªå…¸å‹çš„ç´¢å¼•ç”¨ä¾‹æ˜¯åŸºäºå¯¹è±¡æ ‡ç­¾åˆ›å»ºç´¢å¼•ã€‚Indexer å¯ä»¥åŸºäºå¤šä¸ªç´¢å¼•å‡½æ•°ç»´æŠ¤ç´¢å¼•ã€‚Indexer ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„æ•°æ®å­˜å‚¨æ¥å­˜å‚¨å¯¹è±¡åŠå…¶é”®å€¼ã€‚åœ¨ &lt;a href=&#34;https://github.com/kubernetes/client-go/blob/master/tools/cache/store.go&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/tools/cache åŒ…å†…çš„ Store ç±»å‹&lt;/a&gt; å®šä¹‰äº†ä¸€ä¸ªåä¸º&lt;code&gt;MetaNamespaceKeyFunc&lt;/code&gt;çš„é»˜è®¤å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¸ºè¯¥å¯¹è±¡ç”Ÿæˆä¸€ä¸ªåä¸º &lt;code&gt;&amp;lt;namespace&amp;gt;/&amp;lt;name&amp;gt;&lt;/code&gt; ç»„åˆçš„å¯¹è±¡é”®å€¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;Custom Controller ç»„ä»¶&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Informer reference&lt;/strong&gt;: è¿™æ˜¯ä¸€ä¸ªçŸ¥é“å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰èµ„æºå¯¹è±¡çš„ Informer å®ä¾‹çš„å¼•ç”¨ã€‚æ‚¨çš„è‡ªå®šä¹‰æ§åˆ¶å™¨ä»£ç éœ€è¦åˆ›å»ºé€‚å½“çš„ Informerã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Indexer reference&lt;/strong&gt;: è¿™æ˜¯ä¸€ä¸ªçŸ¥é“å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰èµ„æºå¯¹è±¡çš„ Indexer å®ä¾‹çš„å¼•ç”¨ã€‚æ‚¨çš„è‡ªå®šä¹‰æ§åˆ¶å™¨ä»£ç éœ€è¦åˆ›å»ºè¿™ä¸ªã€‚æ‚¨å°†ä½¿ç”¨æ­¤å¼•ç”¨æ£€ç´¢å¯¹è±¡ï¼Œä»¥ä¾¿ç¨åå¤„ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Resource Event Handlers&lt;/strong&gt;: å½“ Informer æƒ³è¦åˆ†å‘ä¸€ä¸ªå¯¹è±¡ç»™ä½ çš„æ§åˆ¶å™¨æ—¶ï¼Œä¼šè°ƒç”¨è¿™äº›å›è°ƒå‡½æ•°ã€‚ç¼–å†™è¿™äº›å‡½æ•°çš„å…¸å‹æ¨¡å¼æ˜¯è·å–å·²åˆ†é…å¯¹è±¡çš„é”®å€¼ï¼Œå¹¶å°†è¯¥é”®å€¼æ”¾å…¥ä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—ä¸­è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Work queue&lt;/strong&gt;: è¿™æ˜¯åœ¨æ§åˆ¶å™¨ä»£ç ä¸­åˆ›å»ºçš„é˜Ÿåˆ—ï¼Œç”¨äºå°†å¯¹è±¡çš„åˆ†å‘ä¸å¤„ç†è§£è€¦ã€‚ç¼–å†™ Resource Event Handler å‡½æ•°æ¥æå–æ‰€åˆ†å‘å¯¹è±¡çš„é”®å€¼å¹¶å°†å…¶æ·»åŠ åˆ°å·¥ä½œé˜Ÿåˆ—ä¸­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Process Item&lt;/strong&gt;: è¿™æ˜¯åœ¨ä»£ç ä¸­åˆ›å»ºçš„å¤„ç† work queue ä¸­çš„ items çš„å‡½æ•°ã€‚å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå…¶ä»–å‡½æ•°æ¥æ‰§è¡Œå®é™…çš„å¤„ç†ã€‚è¿™äº›å‡½æ•°é€šå¸¸ä½¿ç”¨ &lt;a href=&#34;https://github.com/kubernetes/client-go/blob/master/examples/workqueue/main.go#L73&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Indexer å¼•ç”¨&lt;/a&gt; æˆ– Listing wrapper æ¥è·å–ä¸é”®å€¼å¯¹åº”çš„å¯¹è±¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;informer-æºç ç±»å›¾&#34;&gt;Informer æºç ç±»å›¾&lt;/h3&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ldquoinformer-class-diagramrdquo&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&amp;ldquo;Informer class diagram&amp;rdquo;&#34; srcset=&#34;
               /blog/client-go-study/clientgo_hu11412934179616496601.webp 400w,
               /blog/client-go-study/clientgo_hu218198765252053343.webp 760w,
               /blog/client-go-study/clientgo_hu14354877451566142623.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/client-go-study/clientgo_hu11412934179616496601.webp&#34;
               width=&#34;760&#34;
               height=&#34;664&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      &amp;ldquo;Informer class diagram&amp;rdquo;
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¯¥ç±»å›¾ä¸»è¦æè¿°äº† Informer ä¸­ä¸»è¦çš„æ¥å£å’Œç±»ä¹‹å‰çš„è°ƒç”¨å…³ç³»ã€‚å¤§å®¶å¯ä»¥å‚è€ƒè¿™ä¸ªç±»å›¾å»é˜…è¯»æºç ã€‚å…¶ä¸­æ¯ä¸ªç±»æˆ–æ¥å£å…·ä½“åŠŸèƒ½ï¼Œè¯·å‚è€ƒ &lt;a href=&#34;https://item.jd.com/12665791.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes æºç å‰–æ&lt;/a&gt;ç¬¬äº”ç« èŠ‚ client-goã€‚&lt;/p&gt;
&lt;h3 id=&#34;indexer-åˆ†æ&#34;&gt;Indexer åˆ†æ&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Store&lt;/strong&gt; : æ˜¯ä¸€ä¸ªé€šç”¨å¯¹è±¡å­˜å‚¨å’Œå¤„ç†æ¥å£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Indexer&lt;/strong&gt; : Indexer æ‰©å±•äº†å¤šä¸ªç´¢å¼•çš„ Storeï¼Œå¹¶é™åˆ¶æ¯ä¸ªç´¯åŠ å™¨åªä¿å­˜å½“å‰å¯¹è±¡ï¼ˆåˆ é™¤åä¸ºç©ºï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;cache&lt;/strong&gt; : æ ¹æ® ThreadSafeStore å’Œå…³è”çš„ KeyFunc å®ç°çš„ Indexerã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ThreadSafeStore&lt;/strong&gt; : æ˜¯ä¸€ä¸ªå…è®¸å¯¹å­˜å‚¨åç«¯è¿›è¡Œå¹¶å‘ç´¢å¼•è®¿é—®çš„æ¥å£ã€‚å®ƒç±»ä¼¼äº Indexerï¼Œä½†ä¸ï¼ˆå¿…é¡»ï¼‰çŸ¥é“å¦‚ä½•ä»ç»™å®šå¯¹è±¡ä¸­æå–å­˜å‚¨é”®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;threadSafeMap&lt;/strong&gt; : å®ç°äº† ThreadSafeStoreã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸‹é¢ä¸ºå…·ä½“çš„ç±»å›¾å±•ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ldquoindexerrdquo&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&amp;ldquo;indexer&amp;rdquo;&#34; srcset=&#34;
               /blog/client-go-study/indexer_hu5735890999096622281.webp 400w,
               /blog/client-go-study/indexer_hu7757065081145967985.webp 760w,
               /blog/client-go-study/indexer_hu2906336001637684108.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/client-go-study/indexer_hu5735890999096622281.webp&#34;
               width=&#34;740&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      &amp;ldquo;indexer&amp;rdquo;
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;threadsafemap-åˆ†æ&#34;&gt;threadSafeMap åˆ†æ&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;threadSafeMap&lt;/strong&gt; ç±»ä¸­åŒ…å«ä¸‹é¢ä¸‰ä¸ªå±æ€§ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;items map[string]interface{}&lt;/code&gt; ä¿å­˜æ‰€æœ‰æ•°æ®çš„ map ç»“æ„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;indexers Indexers&lt;/code&gt; é€šè¿‡ä¸€ä¸ªåå­—æ˜ å°„ä¸€ä¸ª IndexFunc ç´¢å¼•å¤„ç†å‡½æ•°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;indices Indices&lt;/code&gt; é€šè¿‡ä¸€ä¸ªåå­—æ˜ å°„ä¸€ä¸ª Indexã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ threadSafeMap ç»“æ„çš„æºç å®šä¹‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// threadSafeMap implements ThreadSafeStore
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;threadSafeMap&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;  &lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RWMutex&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// indexers maps a name to an IndexFunc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;indexers&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Indexers&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// indices maps a name to an Index
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;indices&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Indices&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹é¢æ˜¯ Indexers, Indices and Index çš„æºç å®šä¹‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// IndexFunc knows how to compute the set of indexed values for an object.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;IndexFunc&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Index maps the indexed value to a set of keys in the store that match on that value
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Index&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;String&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Indexers maps a name to a IndexFunc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Indexers&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IndexFunc&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Indices maps a name to an Index
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Indices&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Index&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ˜¯ä¸€ä¸ª threadSafeMap å­˜å‚¨ç»“æ„çš„ç¤ºä¾‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ldquothreadsafemapstoragestructurerdquo&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&amp;ldquo;threadSafeMapStorageStructure&amp;rdquo;&#34; srcset=&#34;
               /blog/client-go-study/threadSafeMapStorageStructure_hu9820354424330142350.webp 400w,
               /blog/client-go-study/threadSafeMapStorageStructure_hu9449063545762364000.webp 760w,
               /blog/client-go-study/threadSafeMapStorageStructure_hu1158134071677348470.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/client-go-study/threadSafeMapStorageStructure_hu9820354424330142350.webp&#34;
               width=&#34;760&#34;
               height=&#34;387&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      &amp;ldquo;threadSafeMapStorageStructure&amp;rdquo;
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœ€åä»¥æ·»åŠ ä¸€ä¸ªæ–°çš„å¯¹è±¡åˆ° threadSafeMap ä¸ºä¾‹ï¼Œåˆ†æå…·ä½“éœ€è¦å“ªäº›æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆåˆ—å‡ºæºç ä»¥ä¾›å‚è€ƒï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;threadSafeMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;oldObject&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;updateIndices&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldObject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// updateIndices modifies the objects location in the managed indexes, if this is an update, you must provide an oldObj
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// updateIndices must be called from a function that already has a lock on the cache
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;threadSafeMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;updateIndices&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldObj&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newObj&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// if we got an old object, we need to remove it before we add it again
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;oldObj&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;deleteFromIndices&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;indexFunc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexers&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;indexValues&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;indexFunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;newObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nb&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;unable to calculate an index entry for key %q on index %q: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indices&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indices&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;indexValue&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;indexValues&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;set&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;set&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nx&#34;&gt;set&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;set&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»ä¸Šé¢ä»£ç å¯ä»¥æ€»ç»“å‡ºä¸‹é¢å‡ ä¸ªæ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä» items ä¸­è·å–æ—§çš„å¯¹è±¡å€¼ï¼Œå¹¶å°†æ–°çš„å¯¹è±¡æ·»åŠ åˆ° items ä¸­æŒ‡å®šé”®å€¼çš„ä½ç½®ã€‚&lt;/li&gt;
&lt;li&gt;å°†æ–°åŠ å…¥å¯¹è±¡çš„é”®å€¼æ›´æ–°åˆ°ç´¢å¼•ä¸­ã€‚
&lt;ol&gt;
&lt;li&gt;å¦‚æœæ—§çš„å¯¹è±¡å­˜åœ¨ï¼Œåˆ™å°†å…¶ä»ç´¢å¼•ä¸­åˆ é™¤ï¼Œå¦åˆ™è¿›è¡Œä¸‹ä¸€æ­¥ã€‚&lt;/li&gt;
&lt;li&gt;è¿­ä»£ indexers è¿›è¡Œæ–°å¯¹è±¡çš„ç´¢å¼•å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ indexers ä¸­çš„ indexFunc å¤„ç†æ–°å¯¹è±¡ï¼Œæ‰¾åˆ°ç›¸åº”çš„ indexValuesã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ indexer çš„ name ä» indices ä¸­æ‰¾åˆ°å¯¹åº”çš„ indexã€‚å¦‚æœå¯¹åº”çš„ index æ˜¯ç©ºï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ indexã€‚&lt;/li&gt;
&lt;li&gt;è¿­ä»£ indexValues è¿›è¡Œ index å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ indexValue åœ¨ index ä¸­æ‰¾åˆ°å¯¹åº”çš„ setï¼Œå¦‚æœ set ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ setã€‚å¹¶æ·»åŠ åˆ° index ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;æ·»åŠ æ–°å¯¹è±¡çš„é”®å€¼åˆ° set ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;è¿”å›ç¬¬ 5 æ­¥ï¼Œç›´åˆ°è¿­ä»£å®Œæˆã€‚&lt;/li&gt;
&lt;li&gt;è¿”å›ç¬¬ 2 æ­¥ï¼Œç›´åˆ°è¿­ä»£å®Œæˆã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;workqueue-åˆ†æ&#34;&gt;WorkQueue åˆ†æ&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Interface&lt;/strong&gt; : FIFO é˜Ÿåˆ—æ¥å£ï¼Œå¹¶æ”¯æŒå»é‡å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;DelayingInterface&lt;/strong&gt;: å»¶è¿Ÿé˜Ÿåˆ—æ¥å£ï¼ŒåŸºäº &lt;strong&gt;Interface&lt;/strong&gt; æ¥å£å°è£…ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;RateLimitingInterface&lt;/strong&gt;: é€Ÿç‡é™åˆ¶æ¥å£ï¼ŒåŸºäº &lt;strong&gt;DelayingInterface&lt;/strong&gt; æ¥å£å°è£…ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ç›¸å…³ç±»å›¾ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-ldquoworkqueuerdquo&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&amp;ldquo;workqueue&amp;rdquo;&#34; srcset=&#34;
               /blog/client-go-study/workqueue_hu13263401567674469010.webp 400w,
               /blog/client-go-study/workqueue_hu4668064115896736177.webp 760w,
               /blog/client-go-study/workqueue_hu4007318847814125603.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/client-go-study/workqueue_hu13263401567674469010.webp&#34;
               width=&#34;760&#34;
               height=&#34;517&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      &amp;ldquo;workqueue&amp;rdquo;
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;ç¤ºä¾‹å‚è€ƒ&#34;&gt;ç¤ºä¾‹å‚è€ƒ&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å‚è€ƒ K8S å®˜æ–¹ç¤ºä¾‹ &lt;a href=&#34;https://github.com/kubernetes/sample-controller&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes/sample-controller&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å‚è€ƒ client-go å®˜æ–¹ç¤ºä¾‹ &lt;a href=&#34;https://github.com/kubernetes/client-go/tree/master/examples/workqueue&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;workqueue&lt;/a&gt;ã€‚è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ä½¿ç”¨ client-go informer çš„ä¾‹å­ï¼Œå®ƒå®Œå…¨åŸºäº client-go informer çš„æ¡†æ¶ã€‚å‡ ä¹æ‰€æœ‰çš„ K8S æ§åˆ¶å™¨éƒ½æ˜¯åŸºäºè¿™ä¸ªæ¡†æ¶å®ç°çš„ã€‚æ‰€ä»¥ä¸ªäººè®¤ä¸º client-go çš„ informer æœºåˆ¶æ˜¯ k8S controller å®ç°çš„åŸºçŸ³ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;å¯ä»¥è¯´ Kubernetes æ˜¯å½“å‰äº‘åŸç”Ÿçš„åŸºçŸ³ã€‚æ‰€ä»¥æƒ³è¦è¿›å†›äº‘åŸç”Ÿé¢†åŸŸï¼Œkubernetes çš„å­¦ä¹ å¿…ä¸å¯å°‘ã€‚kubernetes çš„è®¾è®¡ç†å¿µå°±æ˜¯é€šè¿‡å„ç§æ§åˆ¶å™¨å°†ç³»ç»Ÿçš„å®é™…è¿è¡ŒçŠ¶æ€åè°ƒåˆ°å£°æ˜ API ä¸­çš„æœŸå¾…çŠ¶æ€ã€‚è€Œè¿™ç§åè°ƒæœºåˆ¶å°±æ˜¯åŸºäº client-go å®ç°çš„ã€‚åŒæ ·ï¼Œkubernetes å¯¹äº ETCD å­˜å‚¨çš„ç¼“å­˜å¤„ç†ä¹Ÿä½¿ç”¨åˆ°äº† client-go ä¸­çš„ Reflector æœºåˆ¶ã€‚æ‰€ä»¥å­¦å¥½ client-goï¼Œç­‰äºè¿ˆå…¥äº† Kubernetes çš„å¤§é—¨ã€‚&lt;/p&gt;
&lt;p&gt;å­¦ä¹  Kubernetes åŠæ›´å¤šäº‘åŸç”Ÿç›¸å…³æŠ€æœ¯æ˜¯ä¸€ä¸ªæ¼«é•¿çš„è¿‡ç¨‹ã€‚æ‰€ä»¥éœ€è¦ä¸€ä¸ªäººæœ‰æå¼ºçš„æ„å¿—åŠ›å’Œå­¦ä¹ åŠ¨åŠ›ã€‚å¦‚æœä½ è§‰å¾—è‡ªå·±ç¼ºä¹è¿™äº›èƒ½åŠ›ï¼Œå¯ä»¥åŠ å…¥æˆ‘ä»¬ &lt;a href=&#34;https://cloudnative.to/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äº‘åŸç”Ÿç¤¾åŒº&lt;/a&gt;ã€‚å¤§å®¶ä¸€èµ·å­¦ä¹ ï¼Œç›¸äº’ç£ä¿ƒï¼Œç›¸äº’åˆ†äº«ï¼Œç›¸äº’å­¦ä¹ ï¼Œç›¸äº’æˆé•¿ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åé€è‡ªå·±å’Œæ­£åœ¨å­¦ä¹ åŠå°†è¦å­¦ä¹  Kubernetes æºç çš„åŒå­¦ä»¬ä¸€å¥è¯ï¼š&lt;strong&gt;ä¸ç§¯è·¬æ­¥ï¼Œæ— ä»¥è‡³åƒé‡Œï¼›ä¸ç§¯å°æµï¼Œæ— ä»¥æˆæ±Ÿæµ·ï¼&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒæ–‡ç« &#34;&gt;å‚è€ƒæ–‡ç« &lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/client-go&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Source code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/opsnull/kubernetes-dev-docs/tree/master/client-go&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes client-go åº“ä»‹ç»å’Œæºç è§£æ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://tangxusc.github.io/blog/2019/05/client-go-informer%E6%9C%BA%E5%88%B6/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Client-Go informer æœºåˆ¶&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.jianshu.com/p/76e7b1a57d2c&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;informer ä¹‹ store å’Œ index&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://xigang.github.io/2019/09/21/client-go/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes Client-Go Informer å®ç°æºç å‰–æ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.programmersought.com/article/6135240470/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;client-go package Informer source code analysis&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.huweihuang.com/kubernetes-notes/code-analysis/kube-controller-manager/sharedIndexInformer.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kube-controller-manager æºç åˆ†æï¼ˆä¸‰ï¼‰ä¹‹ Informer æœºåˆ¶&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/sample-controller/blob/master/docs/controller-client-go.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Sample-controller&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://studygolang.com/articles/20402&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Indexer&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes ç¼–ç¨‹åŸºç¡€çŸ¥è¯†</title>
      <link>https://cloudnativecn.com/blog/kubernetes-programming-base/</link>
      <pubDate>Wed, 05 Aug 2020 20:16:40 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/kubernetes-programming-base/</guid>
      <description>&lt;p&gt;Kubernetes è¯ç”Ÿè‡³ä»Šå·²ç» 5 å¹´äº†ï¼Œç«çˆ†æ•´ä¸ªç¤¾åŒºï¼Œå¤§å®¶å¯¹ Kubernetes è¶Šæ¥è¶Šç†Ÿæ‚‰ï¼Œè¶Šæ¥è¶Šäº†è§£ã€‚ä½†ç°é˜¶æ®µå¾ˆå¤šäººéƒ½æ˜¯ç†Ÿç»ƒä½¿ç”¨ Kubernetesï¼Œç”šè‡³æˆ‘ä»¬ä¼šè‡ªå˜²ä¸ºâ€œYAML å·¥ç¨‹å¸ˆâ€ã€‚&lt;/p&gt;
&lt;p&gt;å¯æ˜¯éšç€å„ç±»äº‘åŸç”Ÿåº”ç”¨çš„å‡ºç°ã€Operator ç†å¿µçš„æ¨å¹¿ã€æ·±å…¥ç»´æŠ¤ Kubernetes çš„éœ€æ±‚ä¸‹ï¼Œä»…ä»…åšä¸€ä¸ª &amp;ldquo;YAML å·¥ç¨‹å¸ˆ&amp;rdquo; å·²ç»ä¸èƒ½æ»¡è¶³è€æ¿çš„è¦æ±‚äº†ã€‚éœ€è¦æˆ‘ä»¬è¿›ä¸€æ­¥äº†è§£ Kubernetes æ˜¯å¦‚ä½•å®ç°çš„ï¼Œè¯¥æ€ä¹ˆæ‰©å±• Kubernetesã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘åœ¨è¿™æ ·çš„åœºæ™¯ä¸‹ï¼Œå¼€å§‹å­¦ä¹  Kubernetes ç¼–ç¨‹ï¼Œåœ¨è¿™é‡Œæ€»ç»“äº†æˆ‘å­¦ä¹ åˆ°çš„ Kubernetes ç¼–ç¨‹çš„åŸºç¡€çŸ¥è¯†ï¼Œè®©å¤§å®¶å¯¹ Kubernetes ç¼–ç¨‹æœ‰ä¸ªå¤§è‡´çš„äº†è§£ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åŸºäº-kubernetes-ç¼–ç¨‹&#34;&gt;åŸºäº Kubernetes ç¼–ç¨‹&lt;/h2&gt;
&lt;p&gt;ä»€ä¹ˆå«åšåŸºäº Kubernetes ç¼–ç¨‹å‘¢ï¼Ÿå›æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä»¥å‰å¬è¿‡åŸºäº Linux ç¼–ç¨‹ï¼ŒåŸºäº Windows ç¼–ç¨‹ï¼Œå¯ä»¥æ”¾åœ¨â€˜åŸºäºâ€™åé¢çš„éƒ½æ˜¯é€šç”¨æ ‡å‡†çš„å¹³å°ã€‚åŸºäº Kubernetes ç¼–ç¨‹æœ‰ç€ç›¸åŒçš„æ¦‚å¿µï¼ŒKubernetes ç»è¿‡ 5 å¹´çš„é«˜é€Ÿå‘å±•ï¼Œå·²ç»æˆä¸ºäº†å®¹å™¨ç¼–æ’è°ƒåº¦æ¡†æ¶çš„æ ‡å‡†ï¼Œç›´æ¥å°†ä¹‹å®šä¹‰ä¸ºâ€œäº‘åŸç”Ÿæ“ä½œç³»ç»Ÿâ€ä¹Ÿä¸ä¸ºè¿‡ã€‚&lt;/p&gt;
&lt;p&gt;åŸºäº Kubernetes ç¼–ç¨‹å¯ä»¥å®šä¹‰ä¸ºï¼Œå¼€å‘ä¸€ä¸ª Kubernetes-native åº”ç”¨ï¼Œå®ƒç›´æ¥ä¸ K8S API Serverï¼ˆK8S çš„ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œåé¢ä¼šä»‹ç»ï¼‰äº¤äº’ï¼ŒæŸ¥è¯¢èµ„æºçš„çŠ¶æ€æˆ–æ›´æ–°çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆè¦åŸºäº Kubernetes ç¼–ç¨‹å‘¢ï¼Ÿå¤§å¤šæ•°åŸºäº Kubernetes ç¼–ç¨‹çš„æœåŠ¡éƒ½å±äº PaaS å±‚çš„èƒ½åŠ›ï¼ŒPaaS å°†æœåŠ¡æŠ½è±¡æˆåº”ç”¨è¿›è¡Œåˆ†å‘éƒ¨ç½²ç®¡ç†ï¼Œå¹¶ä¸”å¯¹åº”ç”¨å±è”½ä¸‹å±‚ IaaS çš„å¤æ‚åº¦ã€‚PaaS å±‚æ˜¯åœ¨ Kubernetes è¯ç”Ÿä¹‹å‰å°±å­˜åœ¨çš„ï¼Œåœ¨ Kubernetes ç¯å¢ƒä¸‹ä»¥å‰å¾ˆå¤š PaaS å±‚çš„åº”ç”¨éƒ½éœ€è¦è¿›è¡Œæ”¹é€ è¿ç§»ï¼Œæˆ–è€…è¢«äº‘åŸç”Ÿæ—¶ä»£çš„æ–°åº”ç”¨ä»£æ›¿ï¼Œéšä¹‹è¯ç”Ÿäº†æœåŠ¡ç½‘æ ¼ã€Operator ç­‰äº‘åŸç”Ÿäº§ç‰©ã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›éœ€æ±‚éƒ½æ˜¯è¦åŸºäº Kubernetes ç¼–ç¨‹æ¥å®ç°çš„ï¼Œå› æ­¤æŒæ¡ Kubernetes ç¼–ç¨‹æ˜¯åšäº‘åŸç”Ÿå¼€å‘ï¼ŒPaaS å¹³å°çš„å¿…å¤‡åŸºç¡€ã€‚&lt;/p&gt;
&lt;p&gt;å­¦ä¹  Kubernetes ç¼–ç¨‹åä¼šå¯¹ Kubernetes çš„å„ä¸ªç»„ä»¶æœ‰æ›´åŠ æ·±åˆ»çš„è®¤çŸ¥ã€‚æ¯”å¦‚ä½ äº†è§£äº† &lt;code&gt;controller æ¶æ„æ¨¡å¼ &lt;/code&gt; åå°±ä¼šçŸ¥é“ï¼ˆä»¥ä¸‹è¯´æ³•å¹¶ä¸ä¸¥è°¨ï¼Œåªåˆ—å‡ºç»„ä»¶ä¸­çš„éƒ¨åˆ†åŠŸèƒ½ï¼‰:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;kube-proxy æ˜¯ Service èµ„æºå’ŒæœåŠ¡å‘ç°è´Ÿè½½ä¹‹é—´çš„åè°ƒæ§åˆ¶å™¨ã€‚&lt;/li&gt;
&lt;li&gt;kubelet æ˜¯ Pod èµ„æºå’Œå®¹å™¨è¿è¡Œæ—¶ä¹‹é—´çš„åè°ƒæ§åˆ¶å™¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;äº†è§£ API Server çš„æ¶æ„åå°±çŸ¥é“ï¼Œkubectl å…¶å®æ˜¯é«˜çº§å®šåˆ¶ç‰ˆçš„ curl å·¥å…·ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ‰©å±•æ¨¡å¼&#34;&gt;æ‰©å±•æ¨¡å¼&lt;/h2&gt;
&lt;p&gt;Kubernetes æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¹¶ä¸”å†…èšçš„å¯æ‰©å±•ç³»ç»Ÿã€‚
å¸¸ç”¨çš„æœ‰å¦‚ä¸‹æ‰©å±•ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;äºŒè¿›åˆ¶ &lt;code&gt;kubelet&lt;/code&gt; æ’ä»¶ï¼Œå¦‚ &lt;a href=&#34;https://github.com/containernetworking/cni&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç½‘ç»œ (CNI)&lt;/a&gt;ã€&lt;a href=&#34;https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/device-plugins/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è®¾å¤‡&lt;/a&gt;ã€&lt;a href=&#34;https://github.com/container-storage-interface/spec/blob/master/spec.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å­˜å‚¨ (CSI)&lt;/a&gt;ã€&lt;a href=&#34;https://github.com/kubernetes/community/blob/master/contributors/devel/sig-node/container-runtime-interface.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®¹å™¨è¿è¡Œæ—¶ (CRI)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;äºŒè¿›åˆ¶ &lt;code&gt;kubectl&lt;/code&gt; &lt;a href=&#34;https://kubernetes.io/docs/tasks/extend-kubectl/kubectl-plugins/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ’ä»¶&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;API server ä¸­çš„è®¿é—®æ‰©å±•ï¼Œä¾‹å¦‚ webhooks çš„åŠ¨æ€å‡†å…¥æ§åˆ¶&lt;/li&gt;
&lt;li&gt;è‡ªå®šä¹‰èµ„æºï¼ˆCRDï¼‰å’Œè‡ªå®šä¹‰ controller&lt;/li&gt;
&lt;li&gt;è‡ªå®šä¹‰ API servers&lt;/li&gt;
&lt;li&gt;è°ƒåº¦å™¨æ‰©å±•ï¼Œä¾‹å¦‚ä½¿ç”¨ &lt;a href=&#34;https://github.com/kubernetes/community/blob/master/contributors/design-proposals/scheduling/scheduler_extender.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;webhook&lt;/a&gt; æ¥å®ç°è‡ªå·±çš„è°ƒåº¦å†³ç­–&lt;/li&gt;
&lt;li&gt;é€šè¿‡ webhook è¿›è¡Œ &lt;a href=&#34;https://kubernetes.io/docs/reference/access-authn-authz/authentication/#webhook-token-authentication&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;èº«ä»½éªŒè¯&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Kubernetes æä¾›äº†å¾ˆå¼ºçš„æ‰©å±•èƒ½åŠ›ï¼Œå…¶æœ¬èº«çš„å¾ˆå¤šç»„ä»¶ä¹Ÿæ˜¯ä½¿ç”¨äº†è¿™ç§æ‰©å±•èƒ½åŠ›æ¥å®ç°çš„ã€‚&lt;code&gt;controller&lt;/code&gt; æ¨¡å¼æ˜¯ Kubernetes ç¼–ç¨‹ä¸­é€šç”¨æ€§æœ€å¼ºï¼Œä½¿ç”¨æœ€å¤šçš„æ‰©å±•èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;Controller å®ç°æ§åˆ¶å¾ªç¯ï¼Œé€šè¿‡ API Server ç›‘å¬é›†ç¾¤çš„å…±äº«çŠ¶æ€ï¼Œæ ¹æ®èµ„æºçš„å½“å‰çŠ¶æ€åšå‡ºååº”æ›´æ”¹çœŸå®ä¸–ç•Œï¼Œä½¿å°†èµ„æºæ›´æ¥è¿‘æœŸæœ›çŠ¶æ€ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ§åˆ¶å¾ªç¯-the-control-loop&#34;&gt;æ§åˆ¶å¾ªç¯ The Control Loop&lt;/h3&gt;
&lt;p&gt;æ‰€æœ‰çš„æ§åˆ¶å™¨éƒ½æŒ‰ç…§ä»¥ä¸‹é€»è¾‘è¿è¡Œï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”±äº‹ä»¶é©±åŠ¨æ¥è¯»å–èµ„æº (resources) çš„çŠ¶æ€ (state)ã€‚&lt;/li&gt;
&lt;li&gt;æ›´æ”¹é›†ç¾¤å†…æˆ–é›†ç¾¤å¤–å¯¹è±¡çš„çŠ¶æ€ (state)ã€‚æ¯”å¦‚ï¼Œå¯åŠ¨ä¸€ä¸ª Podï¼Œåˆ›å»º Endpointã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ API server æ›´æ–°æ­¥éª¤ 1 ä¸­çš„èµ„æºçŠ¶æ€ï¼ˆstatusï¼‰ï¼Œå­˜å‚¨åˆ° etcd ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;é‡å¤å¾ªç¯ï¼Œè¿”å›æ­¥éª¤ 1ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å¼•ç”¨è‡ªprogramming-kubernetes&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å¼•ç”¨è‡ªã€ŠProgramming Kubernetesã€‹&#34; srcset=&#34;
               /blog/kubernetes-programming-base/1_hu16434265426771730771.webp 400w,
               /blog/kubernetes-programming-base/1_hu5954303393109589791.webp 760w,
               /blog/kubernetes-programming-base/1_hu469685171183145541.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-programming-base/1_hu16434265426771730771.webp&#34;
               width=&#34;600&#34;
               height=&#34;255&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å¼•ç”¨è‡ªã€ŠProgramming Kubernetesã€‹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;br&gt;
â€‚â€‚â€‚â€‚å¼•ç”¨è‡ªã€ŠProgramming Kubernetesã€‹&lt;/p&gt;
&lt;h3 id=&#34;æ§åˆ¶å™¨ç»„ä»¶&#34;&gt;æ§åˆ¶å™¨ç»„ä»¶&lt;/h3&gt;
&lt;p&gt;ä»æ¶æ„çš„è§’åº¦æ¥çœ‹ï¼ŒController é€šå¸¸ä½¿ç”¨ä»¥ä¸‹æ•°æ®ç»“æ„ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å¼•ç”¨è‡ªæ·±å…¥å‰–æ-kubernetes&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å¼•ç”¨è‡ªâ€œæ·±å…¥å‰–æ Kubernetesâ€&#34; srcset=&#34;
               /blog/kubernetes-programming-base/2_hu10647780470353652045.webp 400w,
               /blog/kubernetes-programming-base/2_hu14351918134831509768.webp 760w,
               /blog/kubernetes-programming-base/2_hu2222903158575557444.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-programming-base/2_hu10647780470353652045.webp&#34;
               width=&#34;760&#34;
               height=&#34;353&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å¼•ç”¨è‡ªâ€œæ·±å…¥å‰–æ Kubernetesâ€
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;br&gt;
â€‚â€‚â€‚â€‚å¼•ç”¨è‡ªâ€œæ·±å…¥å‰–æ Kubernetesâ€&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Informers
ä» Kubernetes API Server é‡Œç›‘å¬å®ƒæ‰€å…³å¿ƒçš„å¯¹è±¡çŠ¶æ€ï¼ŒInformer ä¸ API å¯¹è±¡æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚&lt;/li&gt;
&lt;li&gt;Reflector
è¿æ¥ APIServerï¼Œä½¿ç”¨ ListAndWatch æ–¹æ³•ï¼Œè·å–å¹¶ç›‘å¬ API å¯¹è±¡å®ä¾‹çš„å˜åŒ–ã€‚å˜åŒ–äº‹ä»¶åŠå¯¹åº”çš„ API å¯¹è±¡ï¼Œè¢«ç§°ä¸ºå¢é‡ï¼Œæ”¾è¿› Delta FIFO Queueã€‚&lt;/li&gt;
&lt;li&gt;Delta FIFO Queue
å­˜æ”¾äº‹ä»¶æ•°æ®&lt;/li&gt;
&lt;li&gt;Store
å¯¹è±¡åœ¨æœ¬åœ°çš„ç¼“å­˜&lt;/li&gt;
&lt;li&gt;Indexer
æŸ¥è¯¢ä¸ç´¢å¼•æœ¬åœ°ç¼“å­˜çš„æ•°æ®ç»“æ„&lt;/li&gt;
&lt;li&gt;ResourceEventHandler
åœ¨åˆå§‹åŒ–æ—¶å°†äº‹ä»¶ç±»å‹å¯¹åº”çš„å¤„ç†å‡½æ•°æ³¨å†Œåˆ° Informerï¼Œå½“äº‹ä»¶è§¦å‘æ—¶ï¼Œç”± Informer è°ƒç”¨ Handler&lt;/li&gt;
&lt;li&gt;Work queues
åœ¨æ‰§è¡Œå‘¨æœŸé‡Œ (processNextWorkItem)ï¼Œä»å·¥ä½œé˜Ÿåˆ— (workqueue) ä¸­è·å–ä¸€ä¸ªå¯¹è±¡æ¥å¤„ç†ã€‚event handler å¯ä»¥é€šè¿‡å®ƒæ¥æ’é˜Ÿæˆ–é‡è¯•çŠ¶æ€å˜åŒ–å¤„ç†ä»»åŠ¡ã€‚
èµ„æºåœ¨å¤„ç†ä¸­é‡åˆ°é”™è¯¯æ—¶å¯ä»¥è¢«é‡æ–°å…¥é˜Ÿ (requeued)ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;äº‹ä»¶-event&#34;&gt;äº‹ä»¶ Event&lt;/h3&gt;
&lt;p&gt;Kubernetes æ§åˆ¶å¹³é¢å¤§é‡ä½¿ç”¨äº‹ä»¶å’Œæ¾æ•£è€¦åˆçš„ç»„ä»¶ã€‚å…¶ä»–åˆ†å¸ƒå¼ç³»ç»Ÿå¸¸ä½¿ç”¨è¿œç¨‹è°ƒç”¨ï¼ˆRPCï¼‰æ¥è§¦å‘è¡Œä¸ºã€‚ä½† Kubernetes å¹¶æ²¡æœ‰è¿™ä¹ˆåšã€‚Kubernetes controller ç›‘å¬ API server ä¸­ Kubernetes å¯¹è±¡çš„æ“ä½œï¼šæ·»åŠ ï¼Œæ›´æ–°å’Œåˆ é™¤ã€‚å½“å‘ç”Ÿæ­¤ç±»äº‹ä»¶æ—¶ï¼Œcontroller å°†æ‰§è¡Œå…¶ä¸šåŠ¡é€»è¾‘ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œä¸ºäº†é€šè¿‡ deployment æ¥å¯åŠ¨ podï¼Œå°±æ¶‰åŠåˆ°è®¸å¤š controller å’Œå…¶ä»–æ§åˆ¶å¹³é¢ç»„ä»¶ååŒå·¥ä½œï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Deployment controllerï¼ˆåœ¨ kube-controller-manager å†…éƒ¨ï¼‰æ„ŸçŸ¥åˆ°ï¼ˆé€šè¿‡ deployment informerï¼‰ç”¨æˆ·åˆ›å»ºäº†ä¸€ä¸ª deploymentã€‚æ ¹æ®å…¶ä¸šåŠ¡é€»è¾‘ï¼Œå®ƒå°†åˆ›å»ºä¸€ä¸ª replica setã€‚&lt;/li&gt;
&lt;li&gt;Replica set controllerï¼ˆåŒæ ·åœ¨ kube-controller-manager å†…éƒ¨ï¼‰æ„ŸçŸ¥åˆ°ï¼ˆé€šè¿‡ replica set informerï¼‰æ–°çš„ replica set è¢«åˆ›å»ºäº†ã€‚å¹¶éšåè¿è¡Œå…¶ä¸šåŠ¡é€»è¾‘ï¼Œå®ƒå°†åˆ›å»ºä¸€ä¸ª pod å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;Schedulerï¼ˆåœ¨ kube-scheduler äºŒè¿›åˆ¶æ–‡ä»¶å†…éƒ¨ï¼‰â€”â€”åŒæ ·æ˜¯ä¸€ä¸ª controllerï¼Œæ„ŸçŸ¥åˆ°ï¼ˆé€šè¿‡ pod informerï¼‰pod è®¾ç½®äº†ä¸€ä¸ªç©ºçš„ spec.nodeName å­—æ®µã€‚æ ¹æ®å…¶ä¸šåŠ¡é€»è¾‘ï¼Œå®ƒå°†è¯¥ pod æ”¾å…¥å…¶è°ƒåº¦é˜Ÿåˆ—ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;ä¸æ­¤åŒæ—¶ï¼Œå¦ä¸€ä¸ª controller kubeletï¼ˆé€šè¿‡å…¶ pod informerï¼‰æ„ŸçŸ¥åˆ°æœ‰æ–°çš„ pod å‡ºç°ï¼Œä½†æ˜¯æ–° pod çš„ spec.nodeName å­—æ®µä¸ºç©ºï¼Œå› æ­¤ä¸ kubelet çš„ node name ä¸åŒ¹é…ã€‚å®ƒä¼šå¿½è§†è¯¥ pod å¹¶è¿”å›ä¼‘çœ çŠ¶æ€ï¼ˆç›´åˆ°ä¸‹ä¸€ä¸ªäº‹ä»¶ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;Scheduler æ›´æ–° pod ä¸­çš„ spec.nodeName å­—æ®µï¼Œå¹¶å°†è¯¥å­—æ®µå†™å…¥ API serverï¼Œç”±æ­¤å°† pod ä»å·¥ä½œé˜Ÿåˆ—ä¸­ç§»å‡ºï¼Œå¹¶è°ƒåº¦åˆ°å…·æœ‰è¶³å¤Ÿå¯ç”¨èµ„æºçš„ node ä¸Šã€‚&lt;/li&gt;
&lt;li&gt;ç”±äº pod çš„æ›´æ–°äº‹ä»¶ï¼Œkubelet å°†è¢«å†æ¬¡å”¤é†’ï¼Œè¿™æ¬¡å†å°† pod çš„ spec.nodeName ä¸è‡ªå·±çš„ node name è¿›è¡Œæ¯”è¾ƒï¼Œä¼šå‘ç°æ˜¯åŒ¹é…çš„ï¼Œæ¥ç€ kubelet å°†å¯åŠ¨ pod ä¸­çš„å®¹å™¨ï¼Œå¹¶å°†å®¹å™¨å·²å¯åŠ¨çš„ä¿¡æ¯å†™å…¥ pod status ä¸­ï¼Œç”±æ­¤ä¸ŠæŠ¥ç»™ API serverã€‚&lt;/li&gt;
&lt;li&gt;Replica set controller ä¼šæ„ŸçŸ¥åˆ°å·²æ›´æ–°çš„ podï¼Œä½†å¹¶ä¸ä¼šåšä»€ä¹ˆã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœ pod ç»ˆæ­¢ï¼Œkubelet å°†æ„ŸçŸ¥åˆ°è¯¥äº‹ä»¶ï¼Œè¿›è€Œä» API server è·å– pod å¯¹è±¡ï¼Œå¹¶æŠŠ pod status è®¾ç½®ä¸ºâ€œterminatedâ€ï¼Œç„¶åå°†å…¶å†™å›åˆ° API serverã€‚&lt;/li&gt;
&lt;li&gt;Replica set controller ä¼šæ„ŸçŸ¥åˆ°ç»ˆæ­¢çš„ podï¼Œå¹¶å†³å®šå¿…é¡»æ›´æ¢æ­¤ podã€‚å®ƒå°†åœ¨ API server ä¸Šåˆ é™¤ç»ˆæ­¢äº†çš„ podï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„ podã€‚&lt;/li&gt;
&lt;li&gt;ä¾æ­¤ç±»æ¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è®¸å¤šç‹¬ç«‹çš„æ§åˆ¶å¾ªç¯åªé€šè¿‡ API server ä¸Šå¯¹è±¡çš„å˜åŒ–è¿›è¡Œé€šä¿¡ï¼Œè¿™äº›å˜åŒ–é€šè¿‡ informer è§¦å‘äº‹ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;ä¹¦ä¸­ç¬¬ä¸€ç« åé¢è¿˜ä»‹ç»äº†äº‹ä»¶é©±åŠ¨å¯¹åº” I/O æ¨¡å‹é€‰æ‹©ï¼Œå¦‚ä½•å¤„ç†å¹¶å‘ï¼ŒOperator ç­‰è¯é¢˜ï¼Œå‚è€ƒåé¢ç»™å‡ºçš„ [æ¨èé˜…è¯»](# æ¨èé˜…è¯») ç»§ç»­é˜…è¯»ã€‚&lt;/p&gt;
&lt;p&gt;I/O æ¨¡å‹çš„ç›¸å…³çŸ¥è¯†å¯ä»¥é¢å¤–é˜…è¯»ã€ŠLinux/UNIX ç³»ç»Ÿç¼–ç¨‹æ‰‹å†Œã€‹ç¬¬ 63 ç« ã€‚&lt;/p&gt;
&lt;h2 id=&#34;the-api-server&#34;&gt;The API Server&lt;/h2&gt;
&lt;p&gt;Kubernetes ç”±ä¸€å †ä¸åŒè§’è‰²çš„èŠ‚ç‚¹ï¼ˆé›†ç¾¤ä¸­æœºå™¨ï¼‰ç»„æˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šä¸»èŠ‚ç‚¹çš„æ§åˆ¶é¢ç”± API Serverï¼Œcontroller manager å’Œ scheduler ç»„æˆã€‚API Server æ˜¯ç³»ç»Ÿçš„ä¸­å¤®ç®¡ç†å®ä½“ï¼ˆcentral management entityï¼‰ï¼Œå®ƒæ˜¯ç³»ç»Ÿä¸­å”¯ä¸€ä¸ªä¸åˆ†å¸ƒå¼å­˜å‚¨ç»„ä»¶ etcd è¿›è¡Œç›´æ¥äº¤äº’çš„ç»„ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;ä¸»è¦å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä¸º Kubernetes API æä¾›æœåŠ¡&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯»å–çŠ¶æ€ (state)&lt;/li&gt;
&lt;li&gt;æ“ä½œçŠ¶æ€ (state)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä»£ç†è½¬å‘é›†ç¾¤ç»„ä»¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Kubernetes dashboard&lt;/li&gt;
&lt;li&gt;ä»£ç† kubectl exec ä¼šè¯&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å¼•ç”¨è‡ªprogramming-kubernetes&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å¼•ç”¨è‡ªã€ŠProgramming Kubernetesã€‹&#34; srcset=&#34;
               /blog/kubernetes-programming-base/3_hu17174790491533024469.webp 400w,
               /blog/kubernetes-programming-base/3_hu16273647482999771601.webp 760w,
               /blog/kubernetes-programming-base/3_hu12051544405656984769.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-programming-base/3_hu17174790491533024469.webp&#34;
               width=&#34;600&#34;
               height=&#34;390&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å¼•ç”¨è‡ªã€ŠProgramming Kubernetesã€‹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;br&gt;
â€‚â€‚â€‚â€‚å¼•ç”¨è‡ªã€ŠProgramming Kubernetesã€‹&lt;/p&gt;
&lt;h3 id=&#34;api-server-http-åè®®æ¥å£&#34;&gt;API Server HTTP åè®®æ¥å£&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;API server ä½¿ç”¨ RESTful HTTP API&lt;/li&gt;
&lt;li&gt;å¤–éƒ¨è¯·æ±‚æ­£å¸¸ä½¿ç”¨ json æ ¼å¼&lt;/li&gt;
&lt;li&gt;å†…éƒ¨è°ƒç”¨ä½¿ç”¨ protocol bufferï¼Œä¸ºäº†æ›´é«˜çš„æ€§èƒ½&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ API è·¯å¾„å‚æ•°ï¼Œå¦‚ &lt;code&gt;GET /api/v1/namespaces/{namespace}/pods&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨ kubectl æŒ‡ä»¤åˆ—å‡ºå½“å‰å‘½åç©ºé—´ä¸‹çš„ podsï¼Œ&lt;code&gt;kubectl -n *THENAMESPACE* get pods&lt;/code&gt;ã€‚å®é™…ä¸Šä¼šå‘å‡º GET /api/v1/namespaces/&lt;em&gt;THENAMESPACE&lt;/em&gt;/pods çš„ HTTP è¯·æ±‚ï¼Œé€šè¿‡ -v 6 å‚æ•°èƒ½çœ‹åˆ° HTTP è¯·æ±‚çš„ logã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-log&#34; data-lang=&#34;log&#34;&gt;I0804 10:55:47.463928   23997 loader.go:375] Config loaded from file:  /root/.kube/config
...
...
I0804 10:55:51.689482   23997 round_trippers.go:443] GET https://172.24.28.3:6443/api/v1/namespaces/default/pods?limit=500 200 OK in 36 milliseconds
NAME                          READY   STATUS    RESTARTS   AGE
busybox                       1/1     Running   119        4d23h
redis-cli                     1/1     Running   303        12d
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;api-æœ¯è¯­&#34;&gt;API æœ¯è¯­&lt;/h3&gt;
&lt;p&gt;å¼„æ¸…æ¥šä»€ä¹ˆæ˜¯ &lt;a href=&#34;https://www.ruanyifeng.com/blog/2011/09/restful.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RESTful æ¶æ„&lt;/a&gt; å°±å¾ˆå®¹æ˜“ç†è§£å’ŒåŒºåˆ† Kubernetes API Server é‡Œé¢è¿™äº›æ¦‚å¿µã€‚
å¦‚æœä¸€ä¸ªæ¶æ„ç¬¦åˆ REST åŸåˆ™ï¼Œå°±ç§°å®ƒä¸º RESTful æ¶æ„ï¼ŒREST æ˜¯ Representational State Transfer çš„ç¼©å†™ï¼Œå¯ä»¥ç¿»è¯‘ä¸º &amp;ldquo;è¡¨ç°å±‚çŠ¶æ€è½¬åŒ–&amp;rdquo;ï¼Œè¿™é‡Œçœç•¥äº†ä¸»è¯­â€œèµ„æºâ€ï¼ˆResources)ã€‚ &lt;strong&gt;æ ¸å¿ƒåœ¨äºâ€œèµ„æºâ€ï¼Œå®ƒæ˜¯ä¸€ç§ä¿¡æ¯å®ä½“ï¼Œå¯ä»¥æœ‰å¾ˆå¤šç§å¤–åœ¨è¡¨ç°å½¢å¼ï¼Œæˆ‘ä»¬æŠŠâ€œèµ„æºâ€å…·ä½“å‘ˆç°å‡ºæ¥çš„å½¢å¼ï¼Œå«åšå®ƒçš„â€œè¡¨ç°å±‚â€ï¼ˆRepresentationï¼‰ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;RESTful API æ˜¯åŸºäº HTTP åè®®ä¸”ç¬¦åˆ REST åŸåˆ™çš„è½¯ä»¶æ¶æ„ï¼Œcontroller æ¶æ„ä¹Ÿç¬¦åˆ REST åŸåˆ™ã€‚åœ¨ Kubernetes ä¸­åŒæ—¶ä½¿ç”¨äº†è¿™ä¸¤ç§æ¶æ„ï¼Œæ‰€ä»¥å¼„å‡ºæ¥äº†ä¸€äº›æœ¯è¯­æ¥åŒºåˆ†æŒ‡ä»£å®ä½“ï¼Œå…¶å®éƒ½æ˜¯â€œèµ„æºâ€è¿™ä¸€ä¿¡æ¯å®ä½“åœ¨ä¸åŒä¸Šä¸‹æ–‡ä¸­çš„ä¸åŒè¡¨ç¤ºå½¢æ€ã€‚&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;&lt;/th&gt;
          &lt;th&gt;RESTful API&lt;/th&gt;
          &lt;th&gt;controller æ¶æ„&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;å®ä½“ç±»å‹&lt;/td&gt;
          &lt;td&gt;Resource&lt;/td&gt;
          &lt;td&gt;Kind&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;å®ç°æ–¹å¼&lt;/td&gt;
          &lt;td&gt;http&lt;/td&gt;
          &lt;td&gt;controller&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;èµ„æºå®šä½&lt;/td&gt;
          &lt;td&gt;URL Path&lt;/td&gt;
          &lt;td&gt;GroupVersionKind&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;kind&#34;&gt;Kind&lt;/h4&gt;
&lt;p&gt;è¡¨ç¤ºå®ä½“çš„ç±»å‹ã€‚æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå­—æ®µ Kindï¼ˆJSON ä¸­çš„å°å†™ kindï¼ŒGolang ä¸­çš„é¦–å­—æ¯å¤§å†™ Kindï¼‰ï¼Œè¯¥å­—æ®µå‘Šè¯‰å¦‚ kubectl ä¹‹ç±»çš„å®¢æˆ·ç«¯å®ƒè¡¨ç¤ºä»€ä¹ˆç±»å‹ã€‚&lt;/p&gt;
&lt;h4 id=&#34;api-group&#34;&gt;API group&lt;/h4&gt;
&lt;p&gt;åœ¨é€»è¾‘ä¸Šç›¸å…³çš„ä¸€ç»„ Kind é›†åˆã€‚
å¦‚ &lt;code&gt;Job&lt;/code&gt; å’Œ &lt;code&gt;ScheduledJob&lt;/code&gt; éƒ½åœ¨ &lt;code&gt;batch API group&lt;/code&gt; é‡Œã€‚&lt;/p&gt;
&lt;h4 id=&#34;version&#34;&gt;Version&lt;/h4&gt;
&lt;p&gt;æ ‡ç¤º API group çš„ç‰ˆæœ¬æ›´æ–°ï¼ŒAPI group ä¼šæœ‰å¤šä¸ªç‰ˆæœ¬ (version)ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;v1alpha1: åˆæ¬¡å¼•å…¥&lt;/li&gt;
&lt;li&gt;v1beta1: å‡çº§æ”¹è¿›&lt;/li&gt;
&lt;li&gt;v1: å¼€å‘å®Œæˆæ¯•ä¸š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨æŒç»­å¼€å‘ä¸­ï¼Œå¯¹è±¡ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä¾¿ç”¨ Version æ¥æ ‡ç¤ºç‰ˆæœ¬å˜åŒ–ã€‚
å¯¹è±¡ä¼šå­˜å‚¨æ‰€æœ‰ç‰ˆæœ¬çš„å¯¹è±¡å±æ€§çš„å¹¶é›†ã€‚ä½†æ˜¯åœ¨å–å‡ºæ—¶æŒ‡å®šç‰ˆæœ¬ï¼Œå³åªä¼šå–å‡ºè¿™ä¸ªç‰ˆæœ¬æ‰€éœ€è¦çš„å¯¹è±¡å®šä¹‰ã€‚&lt;/p&gt;
&lt;h4 id=&#34;resource&#34;&gt;Resource&lt;/h4&gt;
&lt;p&gt;é€šå¸¸æ˜¯å°å†™çš„å¤æ•°è¯ï¼ˆä¾‹å¦‚ï¼Œpodï¼‰ï¼Œç”¨äºæ ‡è¯†ä¸€ç»„ HTTP ç«¯ç‚¹ï¼ˆè·¯å¾„ï¼‰ï¼Œæ¥å¯¹å¤–æš´éœ² CURD æ“ä½œã€‚&lt;/p&gt;
&lt;h4 id=&#34;gvr&#34;&gt;GVR&lt;/h4&gt;
&lt;p&gt;Resource å’Œ API groupã€Version ä¸€èµ·ç§°ä¸º GroupVersionResourceï¼ˆGVRï¼‰ï¼Œæ¥å”¯ä¸€æ ‡ç¤ºä¸€ä¸ª HTTP è·¯å¾„ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å¼•ç”¨è‡ªprogramming-kubernetes&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å¼•ç”¨è‡ªã€ŠProgramming Kubernetesã€‹&#34; srcset=&#34;
               /blog/kubernetes-programming-base/4_hu3352545856113764549.webp 400w,
               /blog/kubernetes-programming-base/4_hu13773436064419976920.webp 760w,
               /blog/kubernetes-programming-base/4_hu13898301541463097724.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-programming-base/4_hu3352545856113764549.webp&#34;
               width=&#34;600&#34;
               height=&#34;143&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å¼•ç”¨è‡ªã€ŠProgramming Kubernetesã€‹
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;br&gt;
â€‚â€‚â€‚â€‚å¼•ç”¨è‡ªã€ŠProgramming Kubernetesã€‹&lt;/p&gt;
&lt;h3 id=&#34;å£°æ˜å¼çŠ¶æ€ç®¡ç†&#34;&gt;å£°æ˜å¼çŠ¶æ€ç®¡ç†&lt;/h3&gt;
&lt;p&gt;controller æ¨¡å¼èƒ½è¿ä½œçš„å¦ä¸€å¤§åŸå› æ˜¯å£°æ˜å¼çŠ¶æ€ç®¡ç†ï¼Œå®ƒè§„å®šèµ„æºå¿…é¡»è¦æœ‰åœ¨ spec ä¸­å®šä¹‰çš„æœŸæœ›çŠ¶æ€ï¼ˆdesired stateï¼‰, å’Œç”± controller è¡¥å……çš„å½“å‰çŠ¶æ€ï¼ˆcurrent statusï¼‰ï¼Œå¡«å†™åœ¨ status ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;spec å®šä¹‰çš„æœŸæœ›çŠ¶æ€æä¾›äº†å®ç° &amp;ldquo;infrastructure-as-code&amp;rdquo; çš„åŸºç¡€ï¼Œè®© controller å¯ä»¥åœ¨ event è§¦å‘ã€æ°´å¹³è·å–ã€å®šæ—¶åŒæ­¥çš„æ—¶å€™éƒ½å¯ä»¥è·å–åˆ°èµ„æºçš„æœŸæœ›çŠ¶æ€ã€‚å¦ä¸€æ–¹é¢ status çš„è®¾è®¡è®© controller äº†è§£åˆ°èµ„æºå½“å‰çŠ¶æ€ï¼Œè¿›è€Œä½œå‡ºæ“ä½œæ¥è°ƒåèµ„æºçš„å½“å‰çŠ¶æ€ä¸æœŸæœ›çŠ¶æ€ï¼Œå†å°†è°ƒååçš„å½“å‰çŠ¶æ€å†™å…¥ statusã€‚è¿™ç§è®¾è®¡å®Œå…¨å¯ä»¥ä»å—å› ç½‘ç»œåˆ†åŒºç­‰åŸå› é€ æˆçš„æ•°æ®çŸ­æš‚ä¸ä¸€è‡´é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨ä¸€ä¸ª deployment é‡Œä½ å¯èƒ½æŒ‡å®šæƒ³è¦ 20 ä¸ªåº”ç”¨ç¨‹åºçš„å‰¯æœ¬ï¼ˆreplicasï¼‰æŒç»­è¿è¡Œã€‚deployment controller ä½œä¸ºæ§åˆ¶é¢ä¸­ controller manager çš„ä¸€éƒ¨åˆ†ï¼Œå°†è¯»å–ä½ æä¾›çš„ deployment specï¼Œå¹¶åˆ›å»ºä¸€ä¸ª replica set ç”¨äºç®¡ç†è¿™äº›å‰¯æœ¬ï¼Œå†ç”± replicat set æ¥è´Ÿè´£åˆ›å»ºå¯¹åº”æ•°é‡çš„ podsï¼Œæœ€ç»ˆç»“æœæ˜¯åœ¨å·¥ä½œèŠ‚ç‚¹ä¸Šå¯åŠ¨å®¹å™¨ã€‚å¦‚æœä»»ä½•çš„å‰¯æœ¬æŒ‚äº†ï¼Œdeployment controller è®©ä½ é€šè¿‡ status å¯ä»¥æ„ŸçŸ¥åˆ°ã€‚è¿™å°±æ˜¯æˆ‘ä»¬è¯´çš„å£°æ˜å¼çŠ¶æ€ç®¡ç†ï¼ˆdeclarative state managementï¼‰ï¼Œç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯å£°æ˜æœŸæœ›çš„çŠ¶æ€ï¼Œå‰©ä¸‹çš„äº¤ç»™ Kubernetesã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¨èé˜…è¯»&#34;&gt;æ¨èé˜…è¯»&lt;/h2&gt;
&lt;h3 id=&#34;programming-kuberneteshttpswwwamazoncomprogramming-kubernetes-developing-cloud-native-applicationsdp1492047104refsr_1_1dchild1keywordsprogrammingkubernetesqid1595852427sr8-1&#34;&gt;&lt;a href=&#34;https://www.amazon.com/Programming-Kubernetes-Developing-Cloud-Native-Applications/dp/1492047104/ref=sr_1_1?dchild=1&amp;amp;keywords=Programming&amp;#43;Kubernetes&amp;amp;qid=1595852427&amp;amp;sr=8-1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Programming Kubernetes&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-programming-kubernetes&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Programming Kubernetes&#34; srcset=&#34;
               /blog/kubernetes-programming-base/5_hu7251469504483444305.webp 400w,
               /blog/kubernetes-programming-base/5_hu10987556275780206700.webp 760w,
               /blog/kubernetes-programming-base/5_hu15719254361756576967.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-programming-base/5_hu7251469504483444305.webp&#34;
               width=&#34;381&#34;
               height=&#34;499&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Programming Kubernetes
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æ˜¯é˜…è¯»ã€ŠProgramming Kubernetesã€‹ä¹¦ç±å‰ä¸¤ç« æ—¶åšçš„ç¬”è®°ä¸æ€»ç»“ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æœ¬ä¹¦æ˜¯ç”±æ¥è‡ª AWS å’Œ Red Hat çš„ä¸¤ä½é«˜çº§å·¥ç¨‹å¸ˆå†™ä½œçš„ï¼Œä»–ä»¬è‡ª 2015 å¹´ä»¥æ¥å°±ä¸€ç›´è‡´åŠ›äº Kubernetes çš„å¼€å‘ï¼Œå†™ä½œï¼Œæ•™å­¦ã€‚&lt;/p&gt;
&lt;p&gt;ä¹¦ä¸­ä¸»è¦å›´ç»•ç€â€œKubernetes æ‰©å±•ç¼–ç¨‹â€œä¸»é¢˜è®²äº† Kubernetes ç¼–ç¨‹åŸºç¡€ï¼Œclient-goï¼Œè‡ªå®šä¹‰èµ„æºï¼ˆCRDï¼‰ï¼ŒOperatorï¼ŒAPI Servers æ‰©å±•ç­‰å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºæ¥è§¦è¿‡äº‘åŸç”Ÿä½†ä¸æƒ³ä»…ä»…åœç•™åœ¨ä½¿ç”¨é˜¶æ®µçš„æœ‹å‹ï¼Œè¿™æœ¬ä¹¦å€¼å¾—ä¸€è¯»ï¼Œé€šè¿‡å­¦ä¹ å¦‚ä½•åœ¨ Kubernetes åŸºç¡€ä¸Šåšå¼€å‘ï¼Œèƒ½è®©ä½ æ›´åŠ äº†è§£ Kubernetesï¼Œåç»­å¯ä»¥æ·±å…¥é˜…è¯» Kubernetes æºç ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æœ¬ä¹¦ç›®å‰å›½å†…è¿˜æœªå‡ºç‰ˆï¼Œå¯ä»¥å»è´­ä¹° ACM ä¼šå‘˜ï¼Œåœ¨ &lt;a href=&#34;https://learning.oreilly.com/library/view/programming-kubernetes/9781492047094/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Oreilly å®˜ç½‘&lt;/a&gt; ä¸Šé˜…è¯»ã€‚
æˆ–è€…åŠ å…¥ &lt;a href=&#34;https://cloudnative.to/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äº‘åŸç”Ÿç¤¾åŒº&lt;/a&gt;ï¼Œç¤¾åŒºå†…åˆ†äº«äº† Programming Kubernetes ä¸­æ–‡ç‰ˆï¼ˆè…¾è®¯å†…éƒ¨ç¿»è¯‘ï¼‰ã€‚åœ¨ &lt;a href=&#34;https://github.com/cloudnativeto/community/issues/37&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¤¾åŒº Github ä»“åº“ Issue&lt;/a&gt; ä¸‹å›å¤å³å¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;kubernetes-æºç å‰–æ&#34;&gt;Kubernetes æºç å‰–æ&lt;/h3&gt;
&lt;p&gt;å¯¹ Kubernetes ç¼–ç¨‹æœ‰äº†åŸºç¡€çš„äº†è§£åï¼Œæ¨èå¤§å®¶é˜…è¯» &lt;a href=&#34;https://item.jd.com/12665791.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ã€ŠKubernetes æºç å‰–æã€‹&lt;/a&gt;ï¼Œç”±æ¥è‡ªç™¾åº¦ BFE å›¢é˜Ÿçš„éƒ‘ä¸œæ—­å¤§ä½¬å†™çš„ã€‚
å‰æ–‡è¯´äº†ï¼ŒKubernetes æœ¬èº«çš„å¾ˆå¤šç»„ä»¶æ˜¯é€šè¿‡ controller æ¨¡å¼æ¥å†™çš„ï¼Œå¯¹äºæˆ‘ä»¬ç¼–å†™ Kubernetes æ‰©å±•åº”ç”¨æ¥è¯´ï¼Œæ˜¯æå¥½çš„æ ·ä¾‹ä»£ç ã€‚
ä¹¦ä¸­ç¬¬ 3 ç« åˆ†æäº† Kubernetes æ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œç¬¬ 5 ç« è¯¦ç»†çš„åˆ†æäº†åœ¨æ‰©å±•ç¼–ç¨‹æ—¶å¿…ä¸å¯å°‘çš„ä¾èµ–åº“ client-goï¼Œæœ‰éœ€æ±‚çš„åŒå­¦è¿˜å¯ä»¥æ ¹æ®ç¬¬ 2 ç« çš„è¯´æ˜è‡ªå·±æ„å»º Kubernetes ç»„ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰ï¼ˆ2020-08ï¼‰äº‘åŸç”Ÿç¤¾åŒºæ­£åœ¨ç»„ç»‡ Kubernetes æºç å‰–æç²¾è¯»æ´»åŠ¨ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥åŠ å…¥ä¸€èµ·å­¦ä¹ ï¼Œå…·ä½“ä¿¡æ¯æŸ¥çœ‹ &lt;a href=&#34;https://github.com/cloudnativeto/community/issues/34&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç¤¾åŒº Issue&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ·±å…¥å‰–æ-kubernetes&#34;&gt;æ·±å…¥å‰–æ Kubernetes&lt;/h3&gt;
&lt;p&gt;è¿™æ˜¯æå®¢æ—¶é—´çš„è¯¾ç¨‹ï¼Œå…¶ä¸­çš„ç¬¬ 23ã€24ã€25 èŠ‚ç®€çŸ­çš„è¿‡äº†ä¸€ä¸‹ Kubernetes ç¼–ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://www.ruanyifeng.com/blog/2011/09/restful.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç†è§£ RESTful æ¶æ„&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://yangxikun.com/kubernetes/2020/01/30/kubernetes-apiserver-concurrent-safe.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes ApiServer å¹¶å‘å®‰å…¨æœºåˆ¶&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://time.geekbang.org/column/article/42076&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ·±å…¥å‰–æ Kubernetes&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>Zookeeper operator å®æˆ˜</title>
      <link>https://cloudnativecn.com/blog/zookeeper-operator/</link>
      <pubDate>Mon, 08 Jun 2020 11:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/zookeeper-operator/</guid>
      <description>&lt;h2 id=&#34;å¯¼è¨€&#34;&gt;å¯¼è¨€&lt;/h2&gt;
&lt;p&gt;2018 å¹´ kubecon å¤§ä¼šä¸Šï¼Œé˜¿é‡Œçš„é™ˆä¿Šå¤§ä½¬åˆ†äº« Node-operator çš„ä¸»é¢˜è®©æˆ‘å°è±¡æ·±åˆ»ï¼Œå›æ¥ä¹‹åå¼€å§‹ç€æ‰‹ç ”ç©¶ Operatorã€‚æ­£å¥½å½“æ—¶è€æ¿å¸Œæœ›èƒ½å¤Ÿå°†å…¬å¸æ­£åœ¨ä½¿ç”¨çš„ Nosql ç»„ä»¶å®¹å™¨åŒ–ï¼Œé¡ºåŠ¿ç»™è€æ¿å®‰åˆ©ä¸€æ³¢ Operator çš„æ€æƒ³ã€‚éšåä»¥ opentsdb çš„å®¹å™¨ä¸ºå¼€ç«¯ï¼Œåç»­å®Œæˆä¸€ç³»åˆ—ç»„ä»¶å®¹å™¨åŒ–ï¼Œä¸€è·¯èµ°æ¥ä¸æ–­å­¦ä¹ å’Œå€Ÿé‰´å…¶ä»– operator çš„å…ˆè¿›ç»éªŒã€‚Zookeeper ä½œä¸ºæœ€æ–°å®Œæˆ operator åŒ–çš„ç»„ä»¶ï¼Œé™¤äº†å¯ä»¥å¿«é€Ÿéƒ¨ç½²ä»¥å¤–ï¼Œè¿˜å®ç°äº† Operator å¯¹ scale up/down çš„è¿›åº¦å¹²é¢„ï¼Œæ§åˆ¶ rolling çš„é‡å¯é¡ºåºï¼Œæ„ŸçŸ¥ç»„ä»¶å®é™…è¿è¡ŒçŠ¶æ€ç­‰ï¼Œå…·ä½“å®ç°è¯·é˜…è¯»å¯¹äºç›¸å…³ç« èŠ‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åŠŸèƒ½éœ€æ±‚&#34;&gt;åŠŸèƒ½éœ€æ±‚&lt;/h2&gt;
&lt;p&gt;ç›®å‰ operator ä¸»è¦å®ç°å¦‚ä¸‹åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¿«é€Ÿéƒ¨ç½²&lt;/li&gt;
&lt;li&gt;å®‰å…¨ä¼¸ç¼©å®¹&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨åŒ–ç›‘æ§&lt;/li&gt;
&lt;li&gt;æ•…éšœè‡ªæ„ˆ&lt;/li&gt;
&lt;li&gt;å¯è§†åŒ–æ“ä½œ&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;crd&#34;&gt;CRD&lt;/h2&gt;
&lt;p&gt;Operator è®¾è®¡ç¬¬ä¸€æ­¥æ˜¯å®šä¹‰å£°æ˜å¼æ¥å£çš„ Itemï¼Œspec ä¸»è¦åŒ…å«èŠ‚ç‚¹èµ„æºã€ç›‘æ§ç»„ä»¶ã€å‰¯æœ¬æ•°ã€æŒä¹…åŒ–å­˜å‚¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;database.ymm-inc.com/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ZooKeeper&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;zookeeper-sample&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v3.5.6&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;requests&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cpu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;1000m&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;2Gi&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;limits&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cpu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;2000m&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;2Gi&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exporter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exporter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exporterImage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;harbor.ymmoa.com/monitoring/zookeeper_exporter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;exporterVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v3.5.6&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;disableExporterProbes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;nodeCount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;100Gi&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ¶æ„å›¾&#34;&gt;æ¶æ„å›¾&lt;/h2&gt;
&lt;p&gt;Operator ä¸»è¦åŒ…å«ï¼šDeployã€Monitorã€Scale ä¸‰ä¸ªå¤§æ¨¡å—ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Deployï¼šä¸»è¦ç”¨äºç”Ÿæˆå’Œåˆ›å»º Statefulsetã€Serviceã€ConfigMapã€PV ç­‰åŸç”Ÿèµ„æºï¼Œç”¨äºå¿«é€Ÿéƒ¨ç½² zookeeper é›†ç¾¤ã€‚&lt;/li&gt;
&lt;li&gt;Monitorï¼šä¸»è¦ç”¨äºç”Ÿæˆå’Œåˆ›å»º ServiceMonitorã€PrometheusRule èµ„æºï¼Œç”¨äºè‡ªåŠ¨åŒ–æ³¨å†Œ targetã€æ·»åŠ å‘Šè­¦ç­–ç•¥ï¼Œå®ç°å¯¹é›†ç¾¤çš„ç›‘æ§å’Œå‘Šè­¦ã€‚&lt;/li&gt;
&lt;li&gt;Scaleï¼šä¸»è¦ç”¨äºæŠŠæ§æ‰©ç¼©å®¹ä»¥åŠæ»šåŠ¨å‡çº§çš„è¿›åº¦ï¼Œç¡®ä¿ä»¥æœ€å°‘çš„ä¸»ä»åˆ‡æ¢å®Œæˆé‡å¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å…·ä½“æ–¹æ¡ˆ&#34;&gt;å…·ä½“æ–¹æ¡ˆ&lt;/h2&gt;
&lt;h3 id=&#34;å¿«é€Ÿéƒ¨ç½²&#34;&gt;å¿«é€Ÿéƒ¨ç½²&lt;/h3&gt;
&lt;h4 id=&#34;åŸºæœ¬çŸ¥è¯†&#34;&gt;åŸºæœ¬çŸ¥è¯†&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Kubernetes Labels&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Labelsï¼šæ˜¯ä¸€å¯¹ key/valueï¼Œè¢«å…³è”åˆ°ç‰¹å®šå¯¹è±¡ä¸Šï¼Œæ ‡ç­¾ä¸€èˆ¬ç”¨æ¥è¡¨ç¤ºåŒä¸€ç±»èµ„æºï¼Œç”¨æ¥åˆ’åˆ†ç‰¹å®šçš„å¯¹è±¡ï¼Œä¸€ä¸ªå¯¹è±¡å¯ä»¥æœ‰å¤šä¸ªæ ‡ç­¾ï¼Œä½†æ˜¯ï¼Œkey å€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚è¿™é‡Œæˆ‘ä»¬å°†åœ¨ list-watch çš„æ—¶å€™ç”¨è¿™ä¸ª labels è¿›è¡Œè¿‡æ»¤ï¼Œä»æ‰€æœ‰çš„ Kubernetes event ä¸­è¿‡æ»¤å‡ºç¬¦åˆç‰¹å®š label çš„ eventï¼Œç”¨æ¥è§¦å‘ operator çš„ä¸»æµç¨‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Kubernetes Informer&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;watchï¼šå¯ä»¥æ˜¯ Kubernetes å†…å»ºçš„èµ„æºæˆ–è€…æ˜¯è‡ªå®šä¹‰çš„èµ„æºã€‚å½“ reflector é€šè¿‡ watch API æ¥æ”¶åˆ°æœ‰å…³æ–°èµ„æºå®ä¾‹å­˜åœ¨çš„é€šçŸ¥æ—¶ï¼Œå®ƒä½¿ç”¨ç›¸åº”çš„åˆ—è¡¨ API è·å–æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œå¹¶å°†å…¶æ”¾å…¥ watchHandler å‡½æ•°å†…çš„ Delta Fifo é˜Ÿåˆ—ä¸­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Informerï¼šinformer ä» Delta Fifo é˜Ÿåˆ—ä¸­å¼¹å‡ºå¯¹è±¡ã€‚æ‰§è¡Œæ­¤æ“ä½œçš„åŠŸèƒ½æ˜¯ processLoopã€‚Base controller çš„ä½œç”¨æ˜¯ä¿å­˜å¯¹è±¡ä»¥ä¾›ä»¥åæ£€ç´¢ï¼Œå¹¶è°ƒç”¨æˆ‘ä»¬çš„æ§åˆ¶å™¨å°†å¯¹è±¡ä¼ é€’ç»™å®ƒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Indexerï¼šç´¢å¼•å™¨æä¾›å¯¹è±¡çš„ç´¢å¼•åŠŸèƒ½ã€‚å…¸å‹çš„ç´¢å¼•ç”¨ä¾‹æ˜¯åŸºäºå¯¹è±¡æ ‡ç­¾åˆ›å»ºç´¢å¼•ã€‚Indexer å¯ä»¥æ ¹æ®å¤šä¸ªç´¢å¼•å‡½æ•°ç»´æŠ¤ç´¢å¼•ã€‚Indexer ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„æ•°æ®å­˜å‚¨æ¥å­˜å‚¨å¯¹è±¡åŠå…¶é”®ã€‚åœ¨ Store ä¸­å®šä¹‰äº†ä¸€ä¸ªåä¸º MetaNamespaceKeyFunc çš„é»˜è®¤å‡½æ•°ï¼Œè¯¥å‡½æ•°ç”Ÿæˆå¯¹è±¡çš„é”®ä½œä¸ºè¯¥å¯¹è±¡çš„ &lt;namespace&gt; / &lt;name&gt; ç»„åˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;labels&#34;&gt;Labels&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;zookeeper&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app.kubernetes.io/instance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;zookeeper-sample&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app.kubernetes.io/managed-by&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;zookeeper-operator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app.kubernetes.io/name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;zookeeper&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app.kubernetes.io/part-of&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;zookeeper&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;component&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;zookeeper&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;zookeeper&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;zookeeper-sample&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;èŠ‚ç‚¹éƒ¨ç½²&#34;&gt;èŠ‚ç‚¹éƒ¨ç½²&lt;/h4&gt;
&lt;h5 id=&#34;å®¹å™¨åˆ†ç±»&#34;&gt;å®¹å™¨åˆ†ç±»&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;InitContainer
&lt;ul&gt;
&lt;li&gt;é…ç½®æ–‡ä»¶åˆå§‹åŒ–å®¹å™¨ï¼Œä¸»è¦ç”¨äº zk config æ–‡ä»¶å¤åˆ¶åˆ°å·¥ä½œåŒºåŸŸã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Container
&lt;ul&gt;
&lt;li&gt;ä¸»è¿›ç¨‹å®¹å™¨&lt;/li&gt;
&lt;li&gt;ç›‘æ§å®¹å™¨&lt;/li&gt;
&lt;li&gt;Agent&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;åˆå§‹åŒ–å®¹å™¨&#34;&gt;åˆå§‹åŒ–å®¹å™¨&lt;/h5&gt;
&lt;blockquote&gt;
&lt;p&gt;zoo.cfg.dynamicï¼Œè¿™ä¸ªæ–‡ä»¶åŒæ ·ä»¥ configmap æ–¹å¼æŒ‚å…¥ä¸»å®¹å™¨ï¼Œä¸»è¦ç”¨äº zk èŠ‚ç‚¹å‘ç°å’Œæ³¨å†Œï¼Œä¸‹é¢å°†è¯¦ç»†ä»‹ç»ä¸‹è¿™ä¸ª zk 3.5 ä¹‹åçš„ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;å…·ä½“å¯ä»¥å‚è€ƒ ZooKeeper åŠ¨æ€é‡æ–°é…ç½®&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server.1&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;zookeeper-sample-0.zookeeper-sample.default.svc.cluster.local:2888:3888:participant&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;0.0.0.0:2181
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server.2&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;zookeeper-sample-1.zookeeper-sample.default.svc.cluster.local:2888:3888:participant&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;0.0.0.0:2181
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server.3&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;zookeeper-sample-2.zookeeper-sample.default.svc.cluster.local:2888:3888:participant&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;0.0.0.0:2181
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server.4&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;zookeeper-sample-3.zookeeper-sample.default.svc.cluster.local:2888:3888:participant&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;0.0.0.0:2181
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;server.5&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;zookeeper-sample-4.zookeeper-sample.default.svc.cluster.local:2888:3888:participant&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;0.0.0.0:2181
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;æ›´æ–°ç›®å½•æƒé™&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;è®¾ç½® data å’Œ logs ç›®å½•çš„æƒé™ï¼Œç¡®ä¿ zk èƒ½å¤Ÿæ­£å¸¸å¯åŠ¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;chowning /data to zookeeper:zookeeper&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chown -v zookeeper:zookeeper /data
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;chowning /logs to zookeeper:zookeeper&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;chown -v zookeeper:zookeeper /logs
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id=&#34;ä¸»è¿›ç¨‹å®¹å™¨&#34;&gt;ä¸»è¿›ç¨‹å®¹å™¨&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;ç¯å¢ƒå˜é‡&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;POD_IPã€POD_NAMEï¼Œä¸»è¦å°† node çš„ pod ip å’Œåç§°ä¼ åˆ° pod å†…éƒ¨ï¼Œæ–¹ä¾¿å®¹å™¨å†…éƒ¨è°ƒç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ZK_SERVER_HEAPï¼Œè¿™å˜é‡ä¸ºé™åˆ¶ zk å¯åŠ¨ heapsize å¤§å°ï¼Œç”± operator æ ¹æ® request å†…éƒ¨å¤§å°è®¾ç½®ï¼Œzk å¯åŠ¨ä¼šè¯»å–è¿™ä¸ªå˜é‡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;POD_IP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;valueFrom&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fieldRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fieldPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;status.podIP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;POD_NAME&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;valueFrom&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fieldRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fieldPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;metadata.name&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ZK_SERVER_HEAP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2048&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ZK_CLIENT_HEAP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;512&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;Readiness æ¢é’ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸»è¦é€šè¿‡ zk å®¢æˆ·ç«¯ç«¯å£ä¼ å…¥ ruok å‘½ä»¤ï¼Œæ£€æŸ¥è¿”å›ç ï¼Œè¿”å› imok è®¤ä¸º zk node å·²ç»å‡†å¤‡å®Œæ¯•ï¼Œzk node å°†ä¼šè¢«æ›´æ–°åˆ°ä¸Šé¢è¯´åˆ°çš„ zoo.cfg.dynamic æ–‡ä»¶ï¼Œzk cluster å°†ä¼šè‡ªåŠ¨å‘ç°è¯¥èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;ZK_CLIENT_PORT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;ZK_CLIENT_PORT&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;:-&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;2181&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;OK&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; ruok &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; nc 127.0.0.1 &lt;span class=&#34;nv&#34;&gt;$ZK_CLIENT_PORT&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$OK&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;imok&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;exit&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;exit&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;fi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id=&#34;ç›‘æ§å®¹å™¨&#34;&gt;ç›‘æ§å®¹å™¨&lt;/h5&gt;
&lt;blockquote&gt;
&lt;p&gt;github é¡¹ç›®ï¼ˆhttps://github.com/dabealu/zookeeper-exporterï¼‰
exporter è·Ÿéšä¸»è¿›ç¨‹ä¸€åŒå¯åŠ¨ï¼Œåç»­ä¼šä»‹ç»å¦‚ä½•æ³¨å†Œåˆ° prometheus target ä»¥åŠå‘Šè­¦ç­–ç•¥ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h5 id=&#34;è®¿é—®æ§åˆ¶&#34;&gt;è®¿é—®æ§åˆ¶&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;æš´éœ²ç«¯å£&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;9114ï¼šè¯¥ç«¯å£ä¸º exporter æœåŠ¡ç«¯å£ï¼Œé€šè¿‡ servicemonitor æ³¨å†Œ prometheus target æ—¶å°†é€šè¿‡ labels åŒ¹é…è¯¥ç«¯å£ã€‚&lt;/p&gt;
&lt;p&gt;1988ï¼šè¯¥ç«¯å£ä¸º zk-agent æœåŠ¡ç«¯å£ï¼Œé€šè¿‡è¯¥æ¥å£ operator å¯ä»¥æŸ¥è¯¢åˆ°å½“å‰èŠ‚ç‚¹è¿è¡ŒçŠ¶æ€ï¼Œåé¢ä¼šè¯¦è§£ä»‹ç»ã€‚&lt;/p&gt;
&lt;p&gt;2181ï¼šè¯¥ç«¯å£ä¸º zk å®¢æˆ·ç«¯ç«¯å£ï¼Œè¯¥ç«¯å£åˆ›å»º Kubernetes headless æ¨¡å¼ svcï¼Œæ–¹ä¾¿å®¢æˆ·ç«¯ä¸€æ¬¡è·å–æ‰€æœ‰èŠ‚ç‚¹ ipã€‚&lt;/p&gt;
&lt;p&gt;3888ï¼šé€‰ä¸¾ leader ä½¿ç”¨&lt;/p&gt;
&lt;p&gt;2888ï¼šé›†ç¾¤å†…æœºå™¨é€šè®¯ä½¿ç”¨ï¼ˆLeader ç›‘å¬æ­¤ç«¯å£ï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2181&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2181&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2888&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2888&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;leader-election&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3888&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3888&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http-metrics&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9114&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9114&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http-agent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1988&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1988&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;æš´éœ²æ–¹å¼&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿™é‡Œä¸»è¦ kubernetes service çš„ä¸¤ç§æ¨¡å¼ï¼šHeadless å’Œ Cluster&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Headless Servicesï¼šç®€å•è€Œè¨€å°±æ˜¯ï¼Œæ¯æ¬¡è®¿é—® headless serviceï¼Œkube-dns å°†è¿”å›åç«¯ä¸€ç»„ ipï¼Œåœ¨æˆ‘ä»¬è¿™ç§åœºæ™¯ä¸‹ï¼Œå³ä¼šè¿”å› es æ‰€æœ‰èŠ‚ç‚¹ ip ç»™å®¢æˆ·ç«¯ï¼Œå†ç”±å®¢æˆ·ç«¯è‡ªå·±åˆ¤æ–­é€šè¿‡å“ªä¸ª ip è®¿é—® es é›†ç¾¤ã€‚&lt;/p&gt;
&lt;p&gt;Clusterï¼šè¿™ç§æ¨¡å¼æ˜¯é»˜è®¤é…ç½®ï¼Œåˆ›å»ºæ­¤ç±» service ä¹‹åï¼Œå°†åˆ†é…ä¸€ä¸ª cluster ipï¼Œè¿™ä¸ª ip ç±»ä¼¼ vipï¼Œæ¯æ¬¡è®¿é—®è¿™ä¸ª service nameï¼Œkube-dns å°†ä¼šéšæœºè¿”å›ä¸€ä¸ªèŠ‚ç‚¹ ipã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;operator åœ¨åˆ›å»º service çš„æ—¶å€™ï¼Œä¸Šé¢ä¸¤ç§éƒ½ä¼šåˆ›å»ºï¼Œheadless ç±»å‹ä¸»è¦ç»™ kubernetes å†…éƒ¨åº”ç”¨è®¿é—®ï¼Œcluster ç±»å‹ä¸»è¦é€šè¿‡ NodePort æš´éœ²ç»™å¤–éƒ¨åº”ç”¨è®¿é—®ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h5 id=&#34;é…ç½®ä¿¡æ¯&#34;&gt;é…ç½®ä¿¡æ¯&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;é…ç½®æ–‡ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-textmate&#34; data-lang=&#34;textmate&#34;&gt;autopurge.purgeInterval=24
autopurge.snapRetainCount=20
initLimit=10
syncLimit=5
skipACL=yes
maxClientCnxns=300
4lw.commands.whitelist=cons, envi, conf, crst, srvr, stat, mntr, ruok
tickTime=2000
dataDir=/data
dataLogDir=/logs
reconfigEnabled=true
standaloneEnabled=false
dynamicConfigFile=/conf/zoo.cfg.dynamic.c00000002
&lt;/code&gt;&lt;/pre&gt;&lt;h5 id=&#34;æ•°æ®å­˜å‚¨&#34;&gt;æ•°æ®å­˜å‚¨&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;PersistentVolume&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;StorageClass PROVISIONER: diskplugin.csi.alibabacloud.comï¼Œé˜¿é‡Œäº‘ CSI æ’ä»¶å®ç°äº† Kubernetes å¹³å°ä½¿ç”¨é˜¿é‡Œäº‘äº‘å­˜å‚¨å·çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œæ”¯æŒåŠ¨æ€åˆ›å»ºã€æŒ‚è½½ã€ä½¿ç”¨äº‘æ•°æ®å·ã€‚å½“å‰çš„ CSI å®ç°åŸºäº kubernetes 1.14 ä»¥ä¸Šçš„ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;äº‘ç›˜ CSI æ’ä»¶æ”¯æŒåŠ¨æ€åˆ›å»ºäº‘ç›˜æ•°æ®å·ã€æŒ‚è½½æ•°æ®å·ã€‚äº‘ç›˜æ˜¯ä¸€ç§å—å­˜å‚¨ç±»å‹ï¼Œåªèƒ½åŒæ—¶è¢«ä¸€ä¸ªè´Ÿè½½ä½¿ç”¨ (ReadWriteOnce)ã€‚&lt;/p&gt;
&lt;p&gt;operator ä¼šå°† CRD ä¸­é…ç½®çš„ pvc ä¿¡æ¯ï¼Œé€ä¼ åˆ° sts ä¸­å»ï¼Œå¹¶æŒ‚è½½åˆ° zk data ç›®å½•ä¸‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;è‡ªåŠ¨åŒ–ç›‘æ§&#34;&gt;è‡ªåŠ¨åŒ–ç›‘æ§&lt;/h3&gt;
&lt;h4 id=&#34;ç›‘æ§æ³¨å†Œ&#34;&gt;ç›‘æ§æ³¨å†Œ&lt;/h4&gt;
&lt;h5 id=&#34;servicemonitor&#34;&gt;ServiceMonitor&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;selector.matchLabels&lt;/code&gt;ï¼šè¿™é‡Œé€šè¿‡ zookeeper: zookeeper-sample æ¥åŒ¹é… serviceã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;port: http-metrics&lt;/code&gt;ï¼šè¿™é‡Œé€šè¿‡åŒ¹é… service ä¸­åˆ° port name æ¥æ³¨å†Œåˆ° prometheus targetã€‚&lt;/p&gt;
&lt;p&gt;operator è°ƒç”¨ prometheus-operator client å®Œæˆ ServiceMonitor èµ„æºçš„åˆ›å»ºï¼Œå®ç°æ–°å»º zk é›†ç¾¤è‡ªåŠ¨æ³¨å†Œåˆ° prometheus çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;monitoring.coreos.com/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ServiceMonitor&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;zookeeper&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app.kubernetes.io/instance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;zookeeper-sample&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app.kubernetes.io/managed-by&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;zookeeper-operator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app.kubernetes.io/name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;zookeeper&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app.kubernetes.io/part-of&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;zookeeper&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;component&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;zookeeper&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;zookeeper&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;zookeeper-sample&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;zookeeper-sample&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;endpoints&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;interval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;30s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http-metrics&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespaceSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;zookeeper&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;zookeeper-sample&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id=&#34;prometheusrule&#34;&gt;PrometheusRule&lt;/h5&gt;
&lt;p&gt;operator è°ƒç”¨ prometheus-operator client å®Œæˆ PrometheusRule èµ„æºçš„åˆ›å»ºï¼Œå®ç°å°†å‘Šè­¦ç­–ç•¥è‡ªåŠ¨æ³¨å†Œåˆ° prometheusã€‚&lt;/p&gt;
&lt;p&gt;å‘Šè­¦ç­–ç•¥ä¸­çš„ dingtalkRobot æ ‡ç­¾ï¼Œä¸»è¦ç”¨æ¥é‡å®šå‘å‘Šè­¦ä¿¡æ¯åˆ°æŒ‡å®šé’‰é’‰ç¾¤ä¸­ï¼Œè¿™é‡Œå¯ä»¥æ·»åŠ å¤šä¸ªé’‰é’‰ç¾¤æœºå™¨äººã€‚&lt;/p&gt;
&lt;h3 id=&#34;å®‰å…¨ä¼¸ç¼©å®¹&#34;&gt;å®‰å…¨ä¼¸ç¼©å®¹&lt;/h3&gt;
&lt;h4 id=&#34;æ‰©ç¼©èŠ‚ç‚¹&#34;&gt;æ‰©ç¼©èŠ‚ç‚¹&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ›´æ–° Zookeeper CR ä¸­ spec.cluster.nodeCount é…ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è§¦å‘ operator ä¸»æµç¨‹ï¼Œåˆ¤æ–­æœŸæœ›å‰¯æœ¬æ•°å¤§äºå®é™…å‰¯æœ¬æ•°ç»§ç»­æµç¨‹ï¼Œå¦åˆ™é€€å‡ºä¸»æµç¨‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ›´æ–° zk é›†ç¾¤ recordsï¼Œæäº¤ä¸¤ç§ recordï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Zookeeper upscale from 3 to 4.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Zookeeper Statefulset %s already update.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ›´æ–° zk é›†ç¾¤ StatefulSet èµ„æºï¼ŒStatefulSet æ§åˆ¶å™¨å°†ä¼šæ–°å»ºèŠ‚ç‚¹ï¼Œzk å°†æ–°å»ºèŠ‚ç‚¹åŠ å…¥é›†ç¾¤ä¸­ï¼Œæ•°æ®å°†ä¼šè‡ªåŠ¨åšåŒæ­¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Reconfig æ¨¡å—å°†ä»é›†ç¾¤ä¸­æ·»åŠ æˆ–è€…å‰”é™¤èŠ‚ç‚¹&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;æ‰©èµ„æº&#34;&gt;æ‰©èµ„æº&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ›´æ–° Zookeeper CR ä¸­ spec.node.resources é…ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœ zk èŠ‚ç‚¹æ•°ä¸æœŸæœ›èŠ‚ç‚¹æ•°ä¸ä¸€è‡´ï¼Œé€€å‡ºä¸»æµç¨‹ï¼Œç›´åˆ°èŠ‚ç‚¹æ•°ä¸€è‡´ï¼Œæ‰€æœ‰ pod å…¨éƒ¨ readyã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é€šè¿‡èŠ‚ç‚¹æ•°é‡æ£€æŸ¥ä¹‹åï¼Œæ›´æ–° StatefulSet èµ„æºï¼Œç”±äºæˆ‘ä»¬è¿™è¾¹ StatefulSet è®¾ç½®çš„ RollingUpdate ç­–ç•¥ä¸º OnDeleteï¼Œå³æ›´æ–° StatefulSet é…ç½®ä¹‹åï¼ŒStatefulSet å°†ä¸ä¼šä¸»åŠ¨é‡å¯èŠ‚ç‚¹ä»¥å®Œæˆå‡çº§ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨å»é‡å¯èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è·å–å½“å‰é›†ç¾¤ä¸­èŠ‚ç‚¹è§’è‰²ï¼Œå°† leader èŠ‚ç‚¹æ”¾åˆ°æœ€åé‡å¯ï¼Œå°½é‡å‡å°‘é›†ç¾¤ä¸å¯ç”¨æ—¶é—´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;operator æ¯”å¯¹ StatefulSet å’Œ pod resourceVersion å€¼ï¼Œå¦‚æœä¸ä¸€è‡´å°†èŠ‚ç‚¹åŠ å…¥åˆ°éœ€è¦é‡å¯èŠ‚ç‚¹åˆ—è¡¨ä¸­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;operator æ‰§è¡Œå¯¹èŠ‚ç‚¹å¦‚ä¸‹æ£€æŸ¥é¡¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å½“å‰é‡å¯ä¸­å¯¹èŠ‚ç‚¹æ˜¯å¦è¶…è¿‡ MaxUnavailable å€¼ï¼Œç›®å‰ MaxUnavailable å€¼é»˜è®¤ä¸º 1.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è·³è¿‡èŠ‚ç‚¹çŠ¶æ€ä¸º Terminating çš„èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä»é‡å¯èŠ‚ç‚¹ä¸­å–ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè°ƒç”¨ kubernetes æ¥å£ï¼Œæ‰§è¡Œé‡å¯æ“ä½œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªèŠ‚ç‚¹é‡å¯å®Œæˆä¹‹åï¼Œå°† requeue ä¸»æµç¨‹ï¼Œç»§ç»­å…¶ä»–èŠ‚ç‚¹é‡å¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ‰€æœ‰èŠ‚ç‚¹å…¨éƒ¨é‡å¯å®Œæˆï¼Œæ»šåŠ¨å‡çº§æˆåŠŸã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ•…éšœè‡ªæ„ˆ&#34;&gt;æ•…éšœè‡ªæ„ˆ&lt;/h3&gt;
&lt;h4 id=&#34;observer&#34;&gt;Observer&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;operator ä¼šä¸ºæ¯ä¸€ä¸ªåˆ›å»ºçš„ zk é›†ç¾¤å¯åŠ¨ä¸€ä¸ª observerï¼Œæ¯ä¸ª observer å°†ä¼šå¯åŠ¨ä¸¤ä¸ª goroutineï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;GetClusterStatusï¼Œè·å– zk-agent /status æ¥å£æ•°æ®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;GetClusterUpï¼Œè·å– /runok æ¥å£æ•°æ®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;operator å°†æ¯ 10 ç§’è·å–é›†ç¾¤æœ€æ–°çŠ¶æ€ï¼ŒåŒ…æ‹¬é›†ç¾¤çŠ¶æ€ã€node èŠ‚ç‚¹æ•°ã€leader èŠ‚ç‚¹ç­‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;operator è·å–åˆ°æœ€æ–°é›†ç¾¤çŠ¶æ€ä¹‹åï¼Œå°†æ›´æ–° CR çš„ status ä¸­ï¼Œè¾¾åˆ°å®æ—¶æ›´æ–° CR ä¸­ zk é›†ç¾¤çŠ¶æ€çš„åŠŸèƒ½ï¼Œæ•ˆæœå¦‚ä¸‹å›¾ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;availableNodes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;leaderNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;zookeeper-sample-1.zookeeper-sample.default.svc.cluster.local&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;å¦‚æœ zk é›†ç¾¤è¢«é”€æ¯ï¼Œoperator å°†è°ƒç”¨ finalizers æ–¹æ³•åœæ­¢ observer åç¨‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;è§¦å‘ä¸»æµç¨‹&#34;&gt;è§¦å‘ä¸»æµç¨‹&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;operator æ§åˆ¶å™¨åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå°† watch ä¸€ä¸ªè‡ªå®šä¹‰çš„ event channelï¼Œç­‰å¾… event é€šè¿‡ channel ä¼ é€’è¿‡æ¥ï¼Œè§¦å‘ä¸»æ§æµç¨‹æ‰§è¡Œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;observer åˆå§‹åŒ–çš„æ—¶å€™ï¼Œåˆ›å»ºä¸€ä¸ª listeners å‡½æ•°æ•°ç»„ï¼Œç”¨äº observer çŠ¶æ€åˆ·æ–°æ—¶å€™è°ƒç”¨ï¼Œæ¯æ–°å»ºä¸€ä¸ª zk é›†ç¾¤å°†åŠ å…¥ä¸€ä¸ª listenerã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;observer æ‰§è¡Œä¸€æ¬¡ï¼Œlisteners æ•°ç»„ä¸­çš„å‡½æ•°å°†ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œè·å–æœ€æ–°å„ä¸ª zk é›†ç¾¤çš„ health çŠ¶æ€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;listeners æ•°ç»„çš„å‡½æ•°å°†åˆ¤æ–­ï¼Œé›†ç¾¤æ–°çŠ¶æ€ä¸è€çŠ¶æ€æ˜¯å¦ä¸€è‡´ï¼Œä¸€è‡´åˆ™è¿”å› nilï¼Œå¦åˆ™è¿›ä¸€æ­¥å¤„ç†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœçŠ¶æ€ä¸ä¸€è‡´å°†ä¼ å€¼åˆ° event channelï¼Œç”± watch æ¶ˆè´¹ä»¥è§¦å‘ operator ä¸»æ§æµç¨‹æ‰§è¡Œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å¯è§†åŒ–æ“ä½œ&#34;&gt;å¯è§†åŒ–æ“ä½œ&lt;/h3&gt;
&lt;p&gt;å¯è§†åŒ–æ“ä½œï¼Œä¸»è¦å®ç°ä¸€ä¸‹åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;zk é›†ç¾¤çš„æŸ¥è¯¢ã€åˆ›å»ºã€ä¼¸ç¼©ã€èµ„æºè°ƒæ•´&lt;/li&gt;
&lt;li&gt;æ”¯æŒå¤š kubernetes ç¯å¢ƒ&lt;/li&gt;
&lt;li&gt;æ”¯æŒé›†ç¾¤ç›‘æ§å±•ç¤º&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;å¤š-kubernetes-ç¯å¢ƒ&#34;&gt;å¤š kubernetes ç¯å¢ƒ&lt;/h4&gt;
&lt;p&gt;å¯¹äºå¤š kubernetes ç¯å¢ƒçš„æ”¯æŒï¼Œä¸»è¦é€šè¿‡åœ¨æ¯ä¸ªç¯å¢ƒéƒ¨ç½² agent ç»„ä»¶ï¼Œç»„ä»¶é€šè¿‡ rbac è¿›è¡Œæˆæƒï¼Œç¡®ä¿ agent ç»„ä»¶åªèƒ½æ“ä½œæŒ‡å®šèµ„æºã€‚å°† agent æ³¨å†Œåˆ°ç®¡ç†å¹³å°ï¼Œç®¡ç†å¹³å°æŒ‰ç…§ç¯å¢ƒè¯·æ±‚ä¸åŒç¯å¢ƒæ¥å£å³å¯ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ¥å£åˆ—è¡¨&#34;&gt;æ¥å£åˆ—è¡¨&lt;/h4&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;æ¨¡å¼&lt;/th&gt;
          &lt;th&gt;æ¥å£&lt;/th&gt;
          &lt;th&gt;è¯´æ˜&lt;/th&gt;
          &lt;th&gt;å¤‡æ³¨&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;GET&lt;/td&gt;
          &lt;td&gt;/zookeeper/list&lt;/td&gt;
          &lt;td&gt;æŸ¥è¯¢æ‰€æœ‰ zookeeper é›†ç¾¤ä¿¡æ¯&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;POST&lt;/td&gt;
          &lt;td&gt;/zookeeper/info&lt;/td&gt;
          &lt;td&gt;æŸ¥è¯¢å•ä¸ª zookeeper é›†ç¾¤ä¿¡æ¯&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;POST&lt;/td&gt;
          &lt;td&gt;/zookeeper/create&lt;/td&gt;
          &lt;td&gt;åˆ›å»ºå•ä¸ª zookeeper é›†ç¾¤&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;POST&lt;/td&gt;
          &lt;td&gt;/zookeeper/update&lt;/td&gt;
          &lt;td&gt;æ›´æ–°å•ä¸ª zookeeper é›†ç¾¤&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;POST&lt;/td&gt;
          &lt;td&gt;/zookeeper/delete&lt;/td&gt;
          &lt;td&gt;é”€æ¯å•ä¸ª zookeeper é›†ç¾¤&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;å‚æ•°æ ¡éªŒ&#34;&gt;å‚æ•°æ ¡éªŒ&lt;/h3&gt;
&lt;h4 id=&#34;admission-webhooks&#34;&gt;Admission Webhooks&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;ValidatingWebhookï¼šä¸»è¦å®ç°éªŒè¯æ£€æµ‹ï¼Œå³æ£€æŸ¥é€šè¿‡ kubernetes API client æäº¤åˆ° CR å‚æ•°æ˜¯å¦åˆæ³•ï¼Œå¦‚æœä¸ç¬¦åˆè¦æ±‚ç›´æ¥æ‹’ç»èµ„æºåˆ›å»ºã€‚æ£€æŸ¥é¡¹å¦‚ä¸‹ï¼š
&lt;ul&gt;
&lt;li&gt;æ£€æŸ¥èŠ‚ç‚¹èµ„æºï¼Œrequest CPU/mem æ˜¯å¦å°äº limit CPU/mem&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;MutatingWebhookï¼šä¸»è¦å®ç°æ³¨å…¥é»˜è®¤å‚æ•°ï¼Œå³æ£€æŸ¥åˆ°æäº¤å‚æ•°ç¼ºå°‘ä¸€äº›å…³é”®æ€§å‚æ•°ï¼Œå°†ç”± webhook è¡¥é½å¹¶æ³¨å…¥åˆ°åˆ›å»ºèµ„æºä¸­ã€‚è¡¥å…¨é¡¹å¦‚ä¸‹ï¼š
&lt;ul&gt;
&lt;li&gt;èŠ‚ç‚¹èµ„æºé™åˆ¶ï¼Œæ¯”å¦‚ request cpu/memå’Œlimit cpu/memã€‚&lt;/li&gt;
&lt;li&gt;exporter é…ç½®ï¼Œé»˜è®¤å¼€å¯ exporterï¼Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;Exporter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ExporterImage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;harbor.ymmoa.com/monitoring/zookeeper_exporter&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ExporterVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;1.1.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;DisableExporterProbes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å‡çº§ç­–ç•¥&#34;&gt;å‡çº§ç­–ç•¥&lt;/h3&gt;
&lt;p&gt;StatefulSets æä¾›äº†å¤šç§å‡çº§ç­–ç•¥ï¼šOnDeleteï¼ŒRollingUpdateï¼ŒRollingUpdate with partitionã€‚&lt;/p&gt;
&lt;h4 id=&#34;ondelete-çš„ä¸€èˆ¬æ–¹æ³•&#34;&gt;OnDelete çš„ä¸€èˆ¬æ–¹æ³•&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨ OnDeleteï¼Œé™¤é Pod çš„æ•°é‡é«˜äºé¢„æœŸçš„å‰¯æœ¬æ•°ï¼Œå¦åˆ™ StatefulSet æ§åˆ¶å™¨ä¸ä¼šä» StatefulSet ä¸­åˆ é™¤ Podã€‚&lt;/p&gt;
&lt;p&gt;Operator å†³å®šä½•æ—¶è¦åˆ é™¤ Podã€‚ä¸€æ—¦åˆ é™¤ï¼Œä¾¿ä¼šç”± StatefulSet æ§åˆ¶å™¨è‡ªåŠ¨é‡æ–°åˆ›å»ºä¸€ä¸ª Podï¼Œè¯¥ Pod å…·æœ‰ç›¸åŒçš„åç§°ï¼Œä½†æ˜¯æœ€æ–°çš„è§„èŒƒã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çš„æ“ä½œå‘˜æ°¸è¿œä¸ä¼šåˆ›å»º Podï¼Œä½†æ˜¯å½“æˆ‘ä»¬å†³å®šå‡†å¤‡åˆ é™¤ Pod æ—¶ï¼Œå®ƒå°†è´Ÿè´£ Pod çš„åˆ é™¤ã€‚&lt;/p&gt;
&lt;p&gt;å½“å¯¹ StatefulSet è¿›è¡Œä¿®æ”¹æ—¶ï¼ˆä¾‹å¦‚ï¼Œæ›´æ”¹ Pod èµ„æºé™åˆ¶ï¼‰ï¼Œæˆ‘ä»¬æœ€ç»ˆå¾—åˆ°ä¸€ä¸ªæ–°çš„ revisionï¼ˆåŸºäºæ¨¡æ¿è§„èŒƒçš„å“ˆå¸Œå€¼ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹ StatefulSet çŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—å½“å‰çš„ä¿®è®¢ç‰ˆï¼ˆcurrentRevision: zookeeper-sample-7b889dd5b4ï¼‰ï¼Œä½¿ç”¨è¯¥ä¿®è®¢ç‰ˆçš„å®¹å™¨çš„æ•°é‡ä»¥åŠä»åœ¨ä½¿ç”¨æ—§ä¿®è®¢ç‰ˆçš„å®¹å™¨çš„æ•°é‡ï¼ˆupdateRevision: zookeeper-sample-74597f9b9dï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡åˆ—å‡ºè¯¥ StatefulSet ä¸­çš„ Podï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥æ¯ä¸ª Podï¼ˆmetadata.labels[&amp;ldquo;controller-revision-hash&amp;rdquo;]: &amp;ldquo;zookeeper-sample-7b889dd5b4&amp;rdquo;ï¼‰çš„å½“å‰ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;h4 id=&#34;rollingupdatepartition-æ–¹æ³•&#34;&gt;RollingUpdate.Partition æ–¹æ³•&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨æ­¤ç­–ç•¥ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª partition ç´¢å¼•ï¼šè¿™å…è®¸ä½¿ç”¨ StatefulSet æ§åˆ¶å™¨æ›¿æ¢åºæ•°é«˜äºæ­¤ç´¢å¼•çš„ Podã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªå¸¦æœ‰ 5 ä¸ªå‰¯æœ¬çš„ StatefulSetï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;zookeeper-sample-0&lt;/li&gt;
&lt;li&gt;zookeeper-sample-1&lt;/li&gt;
&lt;li&gt;zookeeper-sample-2&lt;/li&gt;
&lt;li&gt;zookeeper-sample-3&lt;/li&gt;
&lt;li&gt;zookeeper-sample-4&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœåˆ†åŒºç´¢å¼•ä¸º 3ï¼Œåˆ™å…è®¸ StatefulSet æ§åˆ¶å™¨è‡ªåŠ¨åˆ é™¤ç„¶åé‡æ–°åˆ›å»º Pod zookeeper-sample-3 å’Œ zookeeper-sample-4ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œæ“ä½œå‘˜æ°¸è¿œä¸ä¼šåˆ é™¤ Podã€‚å®ƒæ‰€åšçš„å°±æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“åº”æ·»åŠ æ–°å®¹å™¨æˆ–åº”é™¤å»å®¹å™¨æ—¶ï¼Œæ›´æ–° StatefulSets å‰¯æœ¬&lt;/li&gt;
&lt;li&gt;å½“åº”æ›´æ¢æŸäº› Pod æ—¶æ›´æ–°åˆ†åŒºç´¢å¼•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¦å¯¹ä¸Šé¢çš„ StatefulSet è¿›è¡Œæ»šåŠ¨å‡çº§ï¼Œæˆ‘ä»¬å°†ä»ç´¢å¼•å¼€å§‹ 5ï¼Œç¡®ä¿ 4 å¯ä»¥å®‰å…¨åœ°æ›¿æ¢ Podï¼Œç„¶åå°†ç´¢å¼•æ›´æ–°ä¸º 4ã€‚è¿™å°†è§¦å‘æ›´æ¢ Podã€‚&lt;/p&gt;
&lt;p&gt;OnDelete é™¤äº†ä¸æ˜¾å¼åˆ é™¤ Pod è€Œæ˜¯ç®¡ç†ç´¢å¼•å¤–ï¼Œå…¶ä»–é€»è¾‘ä¸é€‚ç”¨ç›¸åŒã€‚&lt;/p&gt;
&lt;h3 id=&#34;agent&#34;&gt;Agent&lt;/h3&gt;
&lt;p&gt;zk agent ä½œä¸º sidecar ä¼´éšä¸»å®¹å™¨ä¸€å¹¶å¯åŠ¨ï¼Œæä¾›å¦‚ä¸‹æ¥å£ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;statusï¼šè¿”å›å®¿ä¸» zk èŠ‚ç‚¹å½“å‰è¿è¡ŒçŠ¶æ€ï¼Œå‚è€ƒ zk srvr å‘½ä»¤ã€‚&lt;/li&gt;
&lt;li&gt;runokï¼šè¿”å›å®¿ä¸» zk èŠ‚ç‚¹æ˜¯å¦æ­£å¸¸è¿è¡Œä¸”æ— é”™è¯¯ï¼Œå‚è€ƒ zk ruok å‘½ä»¤ã€‚&lt;/li&gt;
&lt;li&gt;healthï¼šè¿”å› agent è¿è¡ŒçŠ¶æ€ï¼Œç”¨äº agent çš„å¿ƒè·³æ£€æµ‹ã€‚&lt;/li&gt;
&lt;li&gt;getï¼šè¿”å› zk é›†ç¾¤èŠ‚ç‚¹åˆ—è¡¨ï¼ŒæŸ¥è¯¢ /zookeeper/config æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;addï¼šå¢åŠ èŠ‚ç‚¹åˆ° zk é›†ç¾¤ä¸­ï¼Œä¸»è¦ä¾èµ– zk reconfigure ç‰¹æ€§ï¼Œé›†ç¾¤æ‰©å®¹æ—¶ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;delï¼šä»ç°æœ‰ zk é›†ç¾¤ä¸­åˆ é™¤æŸä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœåˆ é™¤èŠ‚ç‚¹æ˜¯ä¸»èŠ‚ç‚¹ï¼Œä¼šå…ˆåšä¸»èŠ‚ç‚¹åˆ‡æ¢ï¼Œä¹‹åæ‰ä¼šç§»é™¤èŠ‚ç‚¹ï¼Œé›†ç¾¤ç¼©å®¹æ—¶ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;æ¥å£åˆ—è¡¨-1&#34;&gt;æ¥å£åˆ—è¡¨&lt;/h4&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;æ¨¡å¼&lt;/th&gt;
          &lt;th&gt;æ¥å£&lt;/th&gt;
          &lt;th&gt;è¯´æ˜&lt;/th&gt;
          &lt;th&gt;å¤‡æ³¨&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;GET&lt;/td&gt;
          &lt;td&gt;/status&lt;/td&gt;
          &lt;td&gt;getZkStatus&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;GET&lt;/td&gt;
          &lt;td&gt;/runok&lt;/td&gt;
          &lt;td&gt;getZkRunok&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;GET&lt;/td&gt;
          &lt;td&gt;/health&lt;/td&gt;
          &lt;td&gt;Health&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;GET&lt;/td&gt;
          &lt;td&gt;/get&lt;/td&gt;
          &lt;td&gt;getMember&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;POST&lt;/td&gt;
          &lt;td&gt;/add&lt;/td&gt;
          &lt;td&gt;addMember&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;POST&lt;/td&gt;
          &lt;td&gt;/del&lt;/td&gt;
          &lt;td&gt;delMember&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;get&#34;&gt;GET&lt;/h4&gt;
&lt;p&gt;/status, è·å–å½“å‰ zk èŠ‚ç‚¹è¿è¡ŒçŠ¶æ€ï¼Œå­—æ®µå«ä¹‰å¯¹ç…§ &lt;code&gt;mntr&lt;/code&gt; æŸ¥çœ‹ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¦‚ä¸‹å­—æ®µï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;Sent&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1617&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;Received&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1618&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;NodeCount&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;MinLatency&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;AvgLatency&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;MaxLatency&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;Connections&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;Outstanding&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;Epoch&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;Counter&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;82&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;BuildTime&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2019-10-08T20:18:00Z&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;Mode&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;                      &lt;span class=&#34;c1&#34;&gt;//0 è¡¨ç¤º Unknownï¼Œ1 ä»£è¡¨ Leaderï¼Œ2 ä»£è¡¨ follower
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;Version&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;3.5.6-c11b7e26bc554b8523dc929761dd28808913f091&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;Error&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;/runokï¼Œè·å–å½“å‰èŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å¯åŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;/healthï¼Œè·å– zk-agent æ˜¯å¦æ­£å¸¸å¯åŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;/getï¼Œè·å–å½“å‰ Reconfig åŠ¨æ€é…ç½®èŠ‚ç‚¹ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;record&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;server.1=zookeeper-sample-0.zookeeper-sample.default.svc.cluster.local:2888:3888:participant;0.0.0.0:2181\nserver.2=zookeeper-sample-1.zookeeper-sample.default.svc.cluster.local:2888:3888:participant;0.0.0.0:2181\nserver.3=zookeeper-sample-2.zookeeper-sample.default.svc.cluster.local:2888:3888:participant;0.0.0.0:2181\nversion=c00000002&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;post&#34;&gt;POST&lt;/h4&gt;
&lt;p&gt;/addï¼Œè·å–å®¢æˆ·ç«¯ä¼ å…¥éœ€è¦æ–°å¢çš„èŠ‚ç‚¹ä¿¡æ¯ï¼Œå¹¶æ›´æ–°åˆ°åŠ¨æ€èŠ‚ç‚¹é…ç½®ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;/delï¼Œè·å–å®¢æˆ·ç«¯ä¼ å…¥éœ€è¦åˆ é™¤åˆ°èŠ‚ç‚¹ä¿¡æ¯ï¼Œå¹¶æ›´æ–°åˆ°åŠ¨æ€èŠ‚ç‚¹é…ç½®ä¸­ã€‚ä¼ å…¥å€¼å‚è€ƒ add æ¥å£æ ¼å¼ã€‚&lt;/p&gt;
&lt;h2 id=&#34;oam-å¯¹æ¥&#34;&gt;OAM å¯¹æ¥&lt;/h2&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-è½¬è‡ª-å­™å¥æ³¢-oam-æ·±å…¥è§£è¯»oam-ä¸ºäº‘åŸç”Ÿåº”ç”¨å¸¦æ¥å“ªäº›ä»·å€¼&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://cloudnativecn.com/images/blog/oam.jpeg&#34; alt=&#34;è½¬è‡ª å­™å¥æ³¢ OAM æ·±å…¥è§£è¯»ï¼šOAM ä¸ºäº‘åŸç”Ÿåº”ç”¨å¸¦æ¥å“ªäº›ä»·å€¼ï¼Ÿ&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      è½¬è‡ª å­™å¥æ³¢ OAM æ·±å…¥è§£è¯»ï¼šOAM ä¸ºäº‘åŸç”Ÿåº”ç”¨å¸¦æ¥å“ªäº›ä»·å€¼ï¼Ÿ
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;OAM æ˜¯ä¸€ä¸ªä¸“æ³¨äºæè¿°åº”ç”¨çš„æ ‡å‡†è§„èŒƒã€‚æœ‰äº†è¿™ä¸ªè§„èŒƒï¼Œåº”ç”¨æè¿°å°±å¯ä»¥å½»åº•ä¸åŸºç¡€è®¾æ–½éƒ¨ç½²å’Œç®¡ç†åº”ç”¨çš„ç»†èŠ‚åˆ†å¼€ã€‚è¿™ç§å…³æ³¨ç‚¹åˆ†ç¦»ï¼ˆSeperation of Conernsï¼‰çš„è®¾è®¡å¥½å¤„æ˜¯éå¸¸æ˜æ˜¾çš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;åº”ç”¨ç»„ä»¶components&#34;&gt;åº”ç”¨ç»„ä»¶ï¼ˆComponentsï¼‰&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;ç»„ä»¶ï¼ˆComponentsï¼‰ï¼šæ¦‚å¿µè®©å¹³å°æ¶æ„å¸ˆç­‰èƒ½å¤Ÿå°†åº”ç”¨åˆ†è§£æˆæˆä¸€ä¸ªä¸ªå¯è¢«å¤ç”¨çš„æ¨¡å—ï¼Œè¿™ç§æ¨¡å—åŒ–å°è£…åº”ç”¨ç»„æˆéƒ¨åˆ†çš„æ€æƒ³ï¼Œä»£è¡¨äº†ä¸€ç§æ„å»ºå®‰å…¨ã€é«˜å¯æ‰©å±•æ€§åº”ç”¨çš„æœ€ä½³å®è·µï¼šé€šè¿‡ä¸€ä¸ªå®Œå…¨åˆ†å¸ƒå¼çš„æ¶æ„æ¨¡å‹ï¼Œå®ç°äº†åº”ç”¨ç»„ä»¶æè¿°å’Œå®ç°çš„è§£è€¦ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æŒ‰ç…§åº”ç”¨ç»„ä»¶çš„å®šä¹‰ï¼Œå¯¹åº”åˆ°ç›®å‰ zk operator çš„å¿«é€Ÿéƒ¨ç½²æ¨¡å—ä¸Šï¼Œéƒ¨ç½²æ¨¡å—ä¸»è¦ç”Ÿæˆå’Œåˆ›å»ºåŸç”Ÿèµ„æºï¼Œå®Œæˆå®¹å™¨åŒ– zk é›†ç¾¤æ­å»ºï¼Œå¹¶æŒç»­ç»´æŒå£°æ˜å¼å®šä¹‰çš„é›†ç¾¤ç»ˆæ€ã€‚éƒ¨ç½²æ¨¡å—å¯ä»¥å•ç‹¬å®šä¹‰ CRD, æ¯”å¦‚ &lt;code&gt;workload.zookeeper.example.com&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åº”ç”¨è¿ç»´ç‰¹å¾traits&#34;&gt;åº”ç”¨è¿ç»´ç‰¹å¾ï¼ˆTraitsï¼‰&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿ç»´ç‰¹å¾ï¼ˆTraitsï¼‰ï¼šå®ƒä»¬æè¿°äº†åº”ç”¨åœ¨å…·ä½“éƒ¨ç½²ç¯å¢ƒä¸­çš„è¿ç»´ç‰¹å¾ï¼Œæ¯”å¦‚åº”ç”¨çš„æ°´å¹³æ‰©å±•çš„ç­–ç•¥å’Œ Ingress è§„åˆ™ï¼Œè¿™äº›ç‰¹å¾å¯¹äºåº”ç”¨çš„è¿ç»´æ¥è¯´éå¸¸é‡è¦ï¼Œä½†å®ƒä»¬åœ¨ä¸åŒçš„éƒ¨ç½²ç¯å¢ƒé‡Œå´å¾€å¾€æœ‰ç€æˆªç„¶ä¸åŒçš„å®ç°æ–¹å¼ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Traits åˆ™å¯¹åº” zk operator æ¨¡å—ä¸­çš„ ä¼¸ç¼©ã€æ»šåŠ¨å‡çº§ä¸¤ä¸ªæ¨¡å—ï¼Œè¿™ä¸¤ä¸ªæ¨¡å—å¯ä»¥æŠ½å‡ºæ¥å®šä¹‰ä¸ºå•ç‹¬ CRDï¼Œæ¯”å¦‚ &lt;code&gt;scale.zookeeper.example.com&lt;/code&gt; å’Œ &lt;code&gt;rolling.zookeeper.example.com&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å°ç»“&#34;&gt;å°ç»“&lt;/h2&gt;
&lt;p&gt;ç›®å‰ zk operator çš„å®ç°èƒ½åŠ›ä¹Ÿä»…ä»…å®ç° éƒ¨ç½²ã€ä¼¸ç¼©ã€æ»šåŠ¨å‡çº§ã€ç›‘æ§ç­‰èƒ½åŠ›ï¼Œè¿˜æœ‰å¾ˆå¤šæ¨¡å—å¯ä»¥åšï¼Œæ¯”å¦‚ï¼šå¤‡ä»½ã€é‡ç½®ã€è¿ç§»ã€è°ƒåº¦ç­–ç•¥ã€æš‚åœç­‰ç­‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒæ–‡æ¡£&#34;&gt;å‚è€ƒæ–‡æ¡£&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Â &lt;a href=&#34;https://mp.weixin.qq.com/s/O94sUDPlEcNKvfbQyrb8-w&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é˜¿é‡Œäº‘æºæ‰‹å¾®è½¯ä¸ Crossplane ç¤¾åŒºå‘å¸ƒ OAM Kubernetes æ ‡å‡†å®ç°ä¸æ ¸å¿ƒä¾èµ–åº“&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.infoq.cn/article/gizNAvObXREqfvWMTvYt&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OAM æ­£å¼å¼€æºï¼šå…¨çƒé¦–ä¸ªäº‘åŸç”Ÿåº”ç”¨æ ‡å‡†å®šä¹‰ä¸æ¶æ„æ¨¡å‹&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes v1.17&#43; é›†ç¾¤ä¸‹ CNI ä½¿ç”¨ VXLAN æ¨¡å¼ SVC æœ‰ 63 ç§’å»¶è¿Ÿçš„è§¦å‘åŸå› å®šä½</title>
      <link>https://cloudnativecn.com/blog/kubernetes-1-17-vxlan-63s-delay/</link>
      <pubDate>Thu, 28 May 2020 15:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/kubernetes-1-17-vxlan-63s-delay/</guid>
      <description>&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªé—®é¢˜ flannel å’Œ calico çš„ VXLAN æ¨¡å¼ä¸‹éƒ½ä¼šå‘ç”Ÿï¼Œéƒ¨åˆ†äººçš„é›†ç¾¤çš„ A è®°å½• UDP ä¸‹æŸ¥è¯¢å¯èƒ½æœ‰é—®é¢˜ã€‚åŸå› æ˜¯ &lt;code&gt;v1.17+&lt;/code&gt; çš„ kubernetes æŸéƒ¨åˆ†ä¼šå¼•èµ·å†…æ ¸çš„æŸä¸ª UDP ç›¸å…³çš„ BUG è€Œä¸æ˜¯ CNI çš„è½¯ä»¶å±‚é¢ï¼ŒWEAVE æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼ŒåŸå› åé¢ä¼šè¯´åˆ°ã€‚å†™è¿™ç¯‡æ–‡ç« çš„æ—¥æœŸæ˜¯ &lt;code&gt;05/28&lt;/code&gt;ï¼Œæœ€å¼€å§‹å‘ç°æ˜¯ä¸Šå‘¨äº”ä¹Ÿå°±æ˜¯ &lt;code&gt;05/23&lt;/code&gt; å·ï¼Œæ–‡ç« ä»æ—¶é—´çº¿å†™èµ·ï¼Œå› ä¸ºå¾ˆå¤šæ—¶å€™æƒ³å‘æ–‡ç« ä½†æ˜¯æ²¡ç©ºã€‚&lt;/p&gt;
&lt;p&gt;2020-07-19 å®˜æ–¹ç‰ˆæœ¬ v1.18.6, v1.16.13, v1.17.9+ å·²ç»ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åŒç‰ˆæœ¬å†…å‡çº§ï¼Œæˆ–è€…åªåˆ‡ kube-proxy ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç”±æ¥&#34;&gt;ç”±æ¥&lt;/h2&gt;
&lt;p&gt;ä¸Šå‘¨äº”æˆ‘ç»è¿‡åŒäº‹çš„å·¥ä½çœ‹åˆ°åŒäº‹çš„æ¡Œé¢æ˜¯ &lt;code&gt;kubectl get po&lt;/code&gt; çš„è¾“å‡ºï¼Œé—®ä»–å’‹å¼€å§‹å­¦ Kubernetes äº†ï¼Œä»–è¯´è·Ÿç€è§†é¢‘å­¦ä¸‹ã€‚çœ‹äº†ä¸‹ç”¨çš„ kubeadm éƒ¨ç½²äº†ä¸€å¥— &lt;code&gt;1.18.2&lt;/code&gt; çš„é›†ç¾¤ã€‚1.18 çš„ kube-proxy çš„ ipvs åŒ…çš„ parseIP æœ‰ bugï¼Œæˆ‘æ¨èä»–æ¢ &lt;code&gt;v1.17.5&lt;/code&gt;ã€‚ä»–å½“æ—¶åœ¨éƒ¨ç½²ä¸€ä¸ªå…¥é—¨çš„ SVC å®éªŒï¼Œæ— æ³•è§£æåŸŸåã€‚ä½¿ç”¨ dig å‘½ä»¤æ’æŸ¥äº†ä¸‹ï¼Œä¸‹é¢æ˜¯å¯¹ç…§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;dig @&amp;lt;podIP&amp;gt; +short kubernetes.default.svc.cluster.local&lt;/code&gt; èƒ½è§£æ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;dig @10.96.0.10 +short kubernetes.default.svc.cluster.local&lt;/code&gt; è¶…æ—¶&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¾ˆå¤šå¸‚é¢ä¸Šçš„ kubeadm éƒ¨ç½²æ•™ç¨‹éƒ½æ˜¯ç›´æ¥å‘½ä»¤ &lt;code&gt;kubeadm init&lt;/code&gt; çš„ï¼Œæ‰€ä»¥æˆ‘æ¨èåŒäº‹å»æŒ‰ç…§æˆ‘æ–‡ç« çš„ &lt;a href=&#34;https://zhangguanzhang.github.io/2019/11/24/kubeadm-base-use/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubeadm éƒ¨ç½²&lt;/a&gt; ä¸€å¥—åå†è¯•è¯•ï¼Œå«ä»–ç”¨&lt;code&gt;v1.17&lt;/code&gt;çš„æœ€æ–°ç‰ˆæœ¬&lt;code&gt;v1.17.5&lt;/code&gt;ï¼Œç»“æœè¿˜æ˜¯ä¸Šé¢ä¸€æ ·ã€‚coredns å®é™…ä¸Šè¿˜æœ‰ metrics çš„ http æ¥å£ï¼Œä» http å±‚æµ‹äº†ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;curl -I 10.96.0.10:9153/metrics&lt;/code&gt; è¶…æ—¶ï¼Œå¾ˆä¹…ä¹‹åæ‰æœ‰è¿”å›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;curl -I &amp;lt;podIP&amp;gt;:9153/metrics&lt;/code&gt; èƒ½ç›´æ¥è¿”å›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¶‰åŠåˆ°æœ¬æ¬¡æ’æŸ¥çš„ä¿¡æ¯ä¸ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get node -o wide
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME     STATUS   ROLES    AGE    VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION          CONTAINER-RUNTIME
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;master   Ready    master   7d8h   v1.18.2   10.0.100.3    &amp;lt;none&amp;gt;        CentOS Linux &lt;span class=&#34;m&#34;&gt;7&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Core&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;   3.10.0-957.el7.x86_64   docker://19.3.8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;node1    Ready    &amp;lt;none&amp;gt;   7d7h   v1.18.2   10.0.100.4    &amp;lt;none&amp;gt;        CentOS Linux &lt;span class=&#34;m&#34;&gt;7&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Core&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;   3.10.0-957.el7.x86_64   docker://19.3.8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;node2    Ready    &amp;lt;none&amp;gt;   7d7h   v1.18.2   10.0.100.15   &amp;lt;none&amp;gt;        CentOS Linux &lt;span class=&#34;m&#34;&gt;7&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Core&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;   3.10.0-957.el7.x86_64   docker://19.3.8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get po -o wide -n kube-system -l k8s-app&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;kube-dns
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                       READY   STATUS    RESTARTS   AGE   IP            NODE    NOMINATED NODE   READINESS GATES
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;coredns-546565776c-v5wwg   1/1     Running   &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;          25h   10.244.2.73   node2   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¤šæ¬¡å°è¯•å‘ç°å¾ˆä¹…çš„æ—¶é—´éƒ½æ˜¯ä¸€æ ·ï¼Œç”¨ time å‘½ä»¤è§‚å¯Ÿäº†ä¸‹ä¸€ç›´æ˜¯ 63 ç§’è¿”å›ã€‚åŒ…æ‹¬å…¶ä»–ä»»ä½• SVC éƒ½æ˜¯è¿™æ ·ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt;    curl -I 10.96.0.10:9153/metrics
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Content-Type: text/plain&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0.0.4&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;charset&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;utf-8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Date: Wed, &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt; May &lt;span class=&#34;m&#34;&gt;2020&lt;/span&gt; 08:39:35 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;real	1m3.091s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;user	0m0.002s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sys	0m0.007s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;proxyMode æ˜¯ ipvsï¼Œç”¨ ipvsadm çœ‹ä¸‹è¶…æ—¶çš„æ—¶å€™çš„çŠ¶æ€ï¼Œä¸€ç›´æ˜¯ &lt;code&gt;SYN_RECV&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯å‘é€äº† SYNï¼Œæ²¡æ”¶åˆ°å›åŒ…ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ipvsadm -lnc &lt;span class=&#34;p&#34;&gt;|&amp;amp;&lt;/span&gt; grep &lt;span class=&#34;m&#34;&gt;9153&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TCP 00:59  SYN_RECV    10.96.0.10:41282   10.96.0.10:9153    10.244.2.73:9153
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æŠ“åŒ…&#34;&gt;æŠ“åŒ…&lt;/h3&gt;
&lt;p&gt;å› ä¸º CNI ä½¿ç”¨çš„ flannelï¼Œç”¨çš„ VXLAN æ¨¡å¼ã€‚master ä¸ŠæŠ“ 9153 å’Œ &lt;code&gt;flannel.1&lt;/code&gt; çš„ 8472 ç«¯å£ï¼Œcoredns çš„ POD æ‰€åœ¨ node ä¸ŠæŠ“ flannel çš„ VXLAN åŒ…ï¼Œä¸‹é¢ä¸‰ä¸ªæ˜¯å¯¹åº”çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-txt&#34; data-lang=&#34;txt&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[root@master /root]# tcpdump -nn -i flannel.1 port 9153
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;listening on flannel.1, link-type EN10MB (Ethernet), capture size 262144 bytes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:30:56.705696 IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [S], seq 911217171, win 43690, options [mss 65495,sackOK,TS val 17148909 ecr 0,nop,wscale 7], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:30:57.708489 IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [S], seq 911217171, win 43690, options [mss 65495,sackOK,TS val 17149912 ecr 0,nop,wscale 7], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:30:59.712458 IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [S], seq 911217171, win 43690, options [mss 65495,sackOK,TS val 17151916 ecr 0,nop,wscale 7], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:03.716441 IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [S], seq 911217171, win 43690, options [mss 65495,sackOK,TS val 17155920 ecr 0,nop,wscale 7], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:11.732562 IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [S], seq 911217171, win 43690, options [mss 65495,sackOK,TS val 17163936 ecr 0,nop,wscale 7], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:27.764498 IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [S], seq 911217171, win 43690, options [mss 65495,sackOK,TS val 17179968 ecr 0,nop,wscale 7], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.828493 IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [S], seq 911217171, win 43690, options [mss 65495,sackOK,TS val 17212032 ecr 0,nop,wscale 7], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.829565 IP 10.244.2.73.9153 &amp;gt; 10.244.0.0.2201: Flags [S.], seq 435819916, ack 911217172, win 27960, options [mss 1410,sackOK,TS val 17212067 ecr 17212032,nop,wscale 7], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.829611 IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [.], ack 1, win 342, options [nop,nop,TS val 17212033 ecr 17212067], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.829714 IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [P.], seq 1:88, ack 1, win 342, options [nop,nop,TS val 17212033 ecr 17212067], length 87
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.829897 IP 10.244.2.73.9153 &amp;gt; 10.244.0.0.2201: Flags [.], ack 88, win 219, options [nop,nop,TS val 17212067 ecr 17212033], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.831300 IP 10.244.2.73.9153 &amp;gt; 10.244.0.0.2201: Flags [P.], seq 1:113, ack 88, win 219, options [nop,nop,TS val 17212069 ecr 17212033], length 112
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.831322 IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [.], ack 113, win 342, options [nop,nop,TS val 17212034 ecr 17212069], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.831435 IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [F.], seq 88, ack 113, win 342, options [nop,nop,TS val 17212035 ecr 17212069], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.831633 IP 10.244.2.73.9153 &amp;gt; 10.244.0.0.2201: Flags [F.], seq 113, ack 89, win 219, options [nop,nop,TS val 17212069 ecr 17212035], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.831660 IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [.], ack 114, win 342, options [nop,nop,TS val 17212035 ecr 17212069], length 0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-txt&#34; data-lang=&#34;txt&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[root@master /root]# tcpdump -nn -i eth0 port 8472
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:30:56.705718 IP 10.0.100.3.48683 &amp;gt; 10.0.100.15.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [S], seq 911217171, win 43690, options [mss 65495,sackOK,TS val 17148909 ecr 0,nop,wscale 7], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:30:57.708523 IP 10.0.100.3.48683 &amp;gt; 10.0.100.15.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [S], seq 911217171, win 43690, options [mss 65495,sackOK,TS val 17149912 ecr 0,nop,wscale 7], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:30:59.712478 IP 10.0.100.3.48683 &amp;gt; 10.0.100.15.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [S], seq 911217171, win 43690, options [mss 65495,sackOK,TS val 17151916 ecr 0,nop,wscale 7], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:03.716452 IP 10.0.100.3.48683 &amp;gt; 10.0.100.15.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [S], seq 911217171, win 43690, options [mss 65495,sackOK,TS val 17155920 ecr 0,nop,wscale 7], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:11.732590 IP 10.0.100.3.48683 &amp;gt; 10.0.100.15.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [S], seq 911217171, win 43690, options [mss 65495,sackOK,TS val 17163936 ecr 0,nop,wscale 7], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:27.764513 IP 10.0.100.3.48683 &amp;gt; 10.0.100.15.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [S], seq 911217171, win 43690, options [mss 65495,sackOK,TS val 17179968 ecr 0,nop,wscale 7], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.828541 IP 10.0.100.3.56618 &amp;gt; 10.0.100.15.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [S], seq 911217171, win 43690, options [mss 65495,sackOK,TS val 17212032 ecr 0,nop,wscale 7], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.829521 IP 10.0.100.15.56771 &amp;gt; 10.0.100.3.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.2.73.9153 &amp;gt; 10.244.0.0.2201: Flags [S.], seq 435819916, ack 911217172, win 27960, options [mss 1410,sackOK,TS val 17212067 ecr 17212032,nop,wscale 7], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.829617 IP 10.0.100.3.56618 &amp;gt; 10.0.100.15.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [.], ack 1, win 342, options [nop,nop,TS val 17212033 ecr 17212067], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.829729 IP 10.0.100.3.56618 &amp;gt; 10.0.100.15.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [P.], seq 1:88, ack 1, win 342, options [nop,nop,TS val 17212033 ecr 17212067], length 87
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.829883 IP 10.0.100.15.34571 &amp;gt; 10.0.100.3.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.2.73.9153 &amp;gt; 10.244.0.0.2201: Flags [.], ack 88, win 219, options [nop,nop,TS val 17212067 ecr 17212033], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.831292 IP 10.0.100.15.34571 &amp;gt; 10.0.100.3.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.2.73.9153 &amp;gt; 10.244.0.0.2201: Flags [P.], seq 1:113, ack 88, win 219, options [nop,nop,TS val 17212069 ecr 17212033], length 112
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.831327 IP 10.0.100.3.56618 &amp;gt; 10.0.100.15.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [.], ack 113, win 342, options [nop,nop,TS val 17212034 ecr 17212069], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.831448 IP 10.0.100.3.56618 &amp;gt; 10.0.100.15.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [F.], seq 88, ack 113, win 342, options [nop,nop,TS val 17212035 ecr 17212069], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.831612 IP 10.0.100.15.34571 &amp;gt; 10.0.100.3.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.2.73.9153 &amp;gt; 10.244.0.0.2201: Flags [F.], seq 113, ack 89, win 219, options [nop,nop,TS val 17212069 ecr 17212035], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.831665 IP 10.0.100.3.56618 &amp;gt; 10.0.100.15.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [.], ack 114, win 342, options [nop,nop,TS val 17212035 ecr 17212069], length 0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-txt&#34; data-lang=&#34;txt&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[root@node2 /root]# tcpdump -nn  -i eth0 port 8472
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.836137 IP 10.0.100.3.56618 &amp;gt; 10.0.100.15.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [S], seq 911217171, win 43690, options [mss 65495,sackOK,TS val 17212032 ecr 0,nop,wscale 7], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.836328 IP 10.0.100.15.56771 &amp;gt; 10.0.100.3.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.2.73.9153 &amp;gt; 10.244.0.0.2201: Flags [S.], seq 435819916, ack 911217172, win 27960, options [mss 1410,sackOK,TS val 17212067 ecr 17212032,nop,wscale 7], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.836811 IP 10.0.100.3.56618 &amp;gt; 10.0.100.15.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [.], ack 1, win 342, options [nop,nop,TS val 17212033 ecr 17212067], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.836910 IP 10.0.100.3.56618 &amp;gt; 10.0.100.15.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [P.], seq 1:88, ack 1, win 342, options [nop,nop,TS val 17212033 ecr 17212067], length 87
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.836951 IP 10.0.100.15.34571 &amp;gt; 10.0.100.3.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.2.73.9153 &amp;gt; 10.244.0.0.2201: Flags [.], ack 88, win 219, options [nop,nop,TS val 17212067 ecr 17212033], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.838385 IP 10.0.100.15.34571 &amp;gt; 10.0.100.3.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.2.73.9153 &amp;gt; 10.244.0.0.2201: Flags [P.], seq 1:113, ack 88, win 219, options [nop,nop,TS val 17212069 ecr 17212033], length 112
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.838522 IP 10.0.100.3.56618 &amp;gt; 10.0.100.15.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [.], ack 113, win 342, options [nop,nop,TS val 17212034 ecr 17212069], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.838621 IP 10.0.100.3.56618 &amp;gt; 10.0.100.15.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [F.], seq 88, ack 113, win 342, options [nop,nop,TS val 17212035 ecr 17212069], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.838703 IP 10.0.100.15.34571 &amp;gt; 10.0.100.3.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.2.73.9153 &amp;gt; 10.244.0.0.2201: Flags [F.], seq 113, ack 89, win 219, options [nop,nop,TS val 17212069 ecr 17212035], length 0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;16:31:59.838836 IP 10.0.100.3.56618 &amp;gt; 10.0.100.15.8472: OTV, flags [I] (0x08), overlay 0, instance 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IP 10.244.0.0.2201 &amp;gt; 10.244.2.73.9153: Flags [.], ack 114, win 342, options [nop,nop,TS val 17212035 ecr 17212069], length 0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…ˆçœ‹ä¸Šé¢çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œæœäº†ä¸‹èµ„æ–™ï¼Œå¾—çŸ¥ TCP é»˜è®¤ SYN æŠ¥æ–‡æœ€å¤§ retry 5 æ¬¡ï¼Œæ¯æ¬¡è¶…æ—¶äº†ç¿»å€ï¼Œ&lt;code&gt;1s -&amp;gt; 3s -&amp;gt; 7s -&amp;gt; 15s -&amp;gt; 31s -&amp;gt; 63s&lt;/code&gt;ã€‚åªæœ‰ 63 ç§’çš„æ—¶å€™ node çš„æœºå™¨ä¸Šæ‰æ”¶åˆ°äº† VXLAN çš„æŠ¥æ–‡ã€‚è¯´æ˜ POD æ‰€åœ¨  node å‹æ ¹æ²¡æ”¶åˆ° 63 ç§’ä¹‹å‰çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬ LVS çš„ dr æ¨¡å¼ä¸‹ TCP çš„æ—¶é—´æˆ³æ··ä¹±æˆ–è€…å…¶ä»–å‡ ä¸ª ARP çš„å†…æ ¸å‚æ•°ä¸å¯¹ä¸‹ &lt;code&gt;SYN&lt;/code&gt; æ˜¯ä¸€ç›´æ”¶ä¸åˆ°çš„è€Œä¸æ˜¯ 63 ç§’åæœ‰ç»“æœï¼Œæ‰€ä»¥å’Œå†…æ ¸ç›¸å…³å‚æ•°æ— å…³ã€‚äºæ˜¯åŒæ ·ä¸Šé¢çš„æ­¥éª¤ tcpdump æŠ“åŒ…ï¼ŒåŠ ä¸Š&lt;code&gt;-w filename.pcap&lt;/code&gt;é€‰é¡¹æŠŠæŠ“çš„åŒ…å¯¼å‡ºä¸‹æ¥å¯¼å…¥åˆ° wireshark é‡Œå‡†å¤‡çœ‹çœ‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æŠ¥æ–‡åˆ†æ&#34;&gt;æŠ¥æ–‡åˆ†æ&lt;/h3&gt;
&lt;p&gt;9153 çš„åŒ… wireshark é‡Œçœ‹ 63 ç§’å‰é¢éƒ½æ˜¯ TCP çš„ SYN é‡ä¼ ï¼Œçœ‹åˆ°äº† master ä¸Šå‘å¤–å‘é€çš„ VXLAN æŠ¥æ–‡çš„æ—¶å€™æœ‰äº†å‘ç°ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ° UDP çš„ checksum æ˜¯&lt;code&gt;0xffff&lt;/code&gt;ï¼Œæˆ‘å¯¹ UDP æŠ¥æ–‡ä¸å¤ªç†Ÿæ‚‰ï¼ŒUDP çš„ header çš„ Checksum æ²¡è®°é”™çš„è¯ &lt;code&gt;CRC32&lt;/code&gt; æ ¡éªŒçš„ï¼Œä¸å¯èƒ½æ˜¯è¿™ç§ä¸¤ä¸ªå­—èŠ‚éƒ½ç½® 1 çš„ &lt;code&gt;0xffff&lt;/code&gt; ï¼Œæ˜æ˜¾å°±æ˜¯ UDP çš„ header çš„æ ¡éªŒå‡ºé”™äº†ã€‚åé¢å‡ ä¸ªæ­£å¸¸åŒ…çš„ Checksum éƒ½æ˜¯ missing çš„ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-vxlan1&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;vxlan1&#34; srcset=&#34;
               /blog/kubernetes-1-17-vxlan-63s-delay/vxlan-udp-csum1_hu1696093041531501480.webp 400w,
               /blog/kubernetes-1-17-vxlan-63s-delay/vxlan-udp-csum1_hu13040082139202888654.webp 760w,
               /blog/kubernetes-1-17-vxlan-63s-delay/vxlan-udp-csum1_hu9330407072857251378.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-1-17-vxlan-63s-delay/vxlan-udp-csum1_hu1696093041531501480.webp&#34;
               width=&#34;760&#34;
               height=&#34;629&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      vxlan1
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;wireshark çš„&lt;code&gt;ç¼–è¾‘&lt;/code&gt;-&amp;gt;&lt;code&gt;é¦–é€‰é¡¹&lt;/code&gt;-&amp;gt;&lt;code&gt;Protocols&lt;/code&gt;-&amp;gt;&lt;code&gt;UDP&lt;/code&gt;-&amp;gt;&lt;code&gt;Validate the UDP checksum if possible&lt;/code&gt; å‹¾ä¸Šæ›´ç›´è§‚çœ‹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-vxlan1&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;vxlan1&#34; srcset=&#34;
               /blog/kubernetes-1-17-vxlan-63s-delay/vxlan-udp-csum2_hu2921005566474293197.webp 400w,
               /blog/kubernetes-1-17-vxlan-63s-delay/vxlan-udp-csum2_hu13399594073064468691.webp 760w,
               /blog/kubernetes-1-17-vxlan-63s-delay/vxlan-udp-csum2_hu15988736545352610368.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-1-17-vxlan-63s-delay/vxlan-udp-csum2_hu2921005566474293197.webp&#34;
               width=&#34;760&#34;
               height=&#34;591&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      vxlan1
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;ä¸æ˜¯æ ¹æœ¬çš„è§£å†³æ–¹æ³•&#34;&gt;ä¸æ˜¯æ ¹æœ¬çš„è§£å†³æ–¹æ³•&lt;/h3&gt;
&lt;p&gt;æœäº†ä¸‹ &lt;code&gt;wireshark linux udp checksum incorrect&lt;/code&gt;ï¼Œéƒ½æ˜¯æ¨èæŠŠ &lt;code&gt;Checksum Offload&lt;/code&gt; disable æ‰å°±è¡Œäº†ï¼Œä¾‹å¦‚æˆ‘è¿™é‡Œæ˜¯ flannelï¼Œåˆ™æ˜¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ /sbin/ethtool -K flannel.1 tx-checksum-ip-generic off
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Actual changes:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tx-checksumming: off
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	tx-checksum-ip-generic: off
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcp-segmentation-offload: off
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	tx-tcp-segmentation: off &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;requested on&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	tx-tcp-ecn-segmentation: off &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;requested on&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	tx-tcp6-segmentation: off &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;requested on&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	tx-tcp-mangleid-segmentation: off &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;requested on&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;udp-fragmentation-offload: off &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;requested on&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†æµ‹ä¸‹æ­£å¸¸ï¼Œè€Œ WEAVE ä»–ä»¬ä¹Ÿç”¨çš„ VXLAN æ¨¡å¼ï¼Œä½†æ˜¯ä»–ä»¬åœ¨åˆ›å»ºç½‘å¡çš„æ—¶å€™æŠŠè¿™ä¸ªå·²ç» off æ‰äº†ï¼Œæ‰€ä»¥ WEAVE çš„ VXLAN æ¨¡å¼åœ¨ &lt;code&gt;v1.17+&lt;/code&gt; é›†ç¾¤æ²¡å‡ºç°è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; curl -I 10.96.0.10:9153
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;404&lt;/span&gt; Not Found
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Content-Type: text/plain&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;charset&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;utf-8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;X-Content-Type-Options: nosniff
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Date: Wed, &lt;span class=&#34;m&#34;&gt;27&lt;/span&gt; May &lt;span class=&#34;m&#34;&gt;2020&lt;/span&gt; 02:14:04 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Content-Length: &lt;span class=&#34;m&#34;&gt;19&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;real	0m0.009s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;user	0m0.005s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sys	0m0.003s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ ä»¥ä¸ºè¿™æ ·å°±å®Œäº†ï¼Ÿå…¶å®å¹¶æ²¡æœ‰ï¼Œå› ä¸ºæˆ‘è‡ªå·±ç»´æŠ¤äº†ä¸€å¥— &lt;a href=&#34;https://github.com/zhangguanzhang/Kubernetes-ansible&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ansible éƒ¨ç½² kubernetes&lt;/a&gt; çš„æ–¹æ¡ˆï¼Œæ¯æ¬¡æ–°ç‰ˆæœ¬å‘å¸ƒæˆ‘éƒ½ä¼šå®é™…æµ‹ä¸‹ã€‚å¹¶ä¸”åŒäº‹åæ˜ äº†ä»–åŒæ ·äº‘ä¸»æœºå¼€å‡ºæ¥ç”¨æˆ‘ ansible éƒ¨ç½² &lt;code&gt;v1.17.5&lt;/code&gt; æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚è¿™å°±å¾ˆå¥‡æ€ªäº†ï¼ŒåŸå› åé¢è¯´ï¼Œè¯·æ¥ç€ç»§ç»­çœ‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä»€ä¹ˆæ˜¯-checksum-offload&#34;&gt;ä»€ä¹ˆæ˜¯ checksum offload&lt;/h3&gt;
&lt;p&gt;Checksum Offload æ˜¯ç½‘å¡çš„ä¸€ä¸ªåŠŸèƒ½é€‰é¡¹ã€‚å¦‚æœè¯¥é€‰é¡¹å¼€å¯ï¼Œåˆ™ç½‘å¡å±‚é¢ä¼šè®¡ç®—éœ€è¦å‘é€æˆ–è€…æ¥æ”¶åˆ°çš„æ¶ˆæ¯çš„æ ¡éªŒå’Œï¼Œä»è€ŒèŠ‚çœ CPU çš„è®¡ç®—å¼€é”€ã€‚æ­¤æ—¶ï¼Œåœ¨éœ€è¦å‘é€çš„æ¶ˆæ¯åˆ°è¾¾ç½‘å¡å‰ï¼Œç³»ç»Ÿä¼šåœ¨æŠ¥å¤´çš„æ ¡éªŒå’Œå­—æ®µå¡«å……ä¸€ä¸ªéšæœºå€¼ã€‚ä½†æ˜¯ï¼Œå°½ç®¡æ ¡éªŒå’Œå¸è½½èƒ½å¤Ÿé™ä½ CPU çš„è®¡ç®—å¼€é”€ï¼Œä½†å—åˆ°è®¡ç®—èƒ½åŠ›çš„é™åˆ¶ï¼ŒæŸäº›ç¯å¢ƒä¸‹çš„ä¸€äº›ç½‘ç»œå¡è®¡ç®—é€Ÿåº¦ä¸å¦‚ä¸»é¢‘è¶…è¿‡ 400MHz çš„ CPU å¿«ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ­£æ–‡&#34;&gt;æ­£æ–‡&lt;/h2&gt;
&lt;h3 id=&#34;å¯¹ç…§ç»„&#34;&gt;å¯¹ç…§ç»„&lt;/h3&gt;
&lt;p&gt;å¾ˆå¥‡æ€ªçš„å°±æ˜¯ä¸ºå•¥å°±æ˜¯æˆ‘çš„ ansible éƒ¨ç½²çš„äºŒè¿›åˆ¶å°±æ­£å¸¸æ²¡è¿™ä¸ªé—®é¢˜ï¼Œè€Œ kubeadm éƒ¨ç½²çš„å°±ä¸æ­£å¸¸ï¼Œåé¢æˆ‘èŠ±æ—¶é—´æ•´äº†ä»¥ä¸‹å‡ ä¸ªå¯¹ç…§ç»„ (æœŸé—´åŒäº‹ä¹Ÿå¸®æˆ‘åšäº†å‡ ä¸ªæ¡ä»¶ä¸‹çš„æµ‹è¯•ï¼Œä½†æ˜¯ä¸æ˜¯ç³»ç»Ÿç”¨é”™äº†å°±æ˜¯ç‰ˆæœ¬æ•´é”™äº†ã€‚ã€‚ã€‚)ï¼Œç»ˆäºæ‰¾åˆ°äº†é—®é¢˜çš„èŒƒå›´ï¼Œä¸‹é¢æ˜¯æˆ‘è‡ªå·±ç»Ÿè®¡çš„å¯¹ç…§ç»„ä¿¡æ¯ï¼Œkubeadm å’Œ ansible ç‰ˆæœ¬å‡ä¸º&lt;code&gt;1.17.5&lt;/code&gt;æµ‹è¯•ã€‚os ä¸é‡è¦ï¼Œå› ä¸ºæœ€ç»ˆæ’æŸ¥å‡ºå’Œ os æ— å…³ï¼š&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;os&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;type(kubeadm or ansible)&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;flannel version&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;flannel is running in pod?&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;will 63 sec delay?&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;7.6&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;kubeadm&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;v0.11.0&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;yes&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;yes&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;7.6&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;kubeadm&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;v0.12.0&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;yes&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;yes&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;7.6&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;kubeadm&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;v0.11.0&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;no&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;yes&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;7.6&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;kubeadm&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;v0.12.0&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;no&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;yes&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;7.6&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;ansible&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;v0.11.0&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;yes&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;no&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;7.6&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;ansible&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;v0.12.0&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;yes&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;no&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;7.6&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;ansible&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;v0.11.0&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;no&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;no&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;7.6&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;ansible&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;v0.12.0&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;no&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;no&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¿™å°±çœ‹èµ·æ¥å¾ˆè¿·äº†ã€‚ä½†æ˜¯æ’æŸ¥å‡ºå’Œ flannel æ— å…³ï¼Œæ„Ÿè§‰ kube-proxy æœ‰å…³ç³»ï¼Œç„¶åä»Šå¤© &lt;code&gt;05/28&lt;/code&gt; é’ˆå¯¹ kube-proxy åšäº†ä¸ªå¯¹ç…§ç»„ï¼š&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;os&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;type(kubeadm or ansible)&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;kube-proxy version&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;kube-proxy is running in pod?&lt;/th&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;will 63 sec delay?&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;7.6&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;kubeadm&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;v1.17.5&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;yes&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;yes&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;7.6&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;kubeadm&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;v1.17.5&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;no&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;no&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;7.6&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;kubeadm&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;v1.16.9&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;yes&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;no&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;7.6&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;kubeadm&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;v1.16.9&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;no&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;no&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;7.6&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;ansible&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;v1.17.5&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;yes&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;yes&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;7.6&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;ansible&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;v1.17.5&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;no&lt;/td&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;no&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºå°±æ˜¯ 1.17 ä»¥ä¸Šçš„ kube-proxy å¦‚æœä½¿ç”¨ POD åˆ™ä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼Œè€Œé POD åˆ™ä¸ä¼šï¼Œåœ¨ github ä¸Š &lt;a href=&#34;https://github.com/kubernetes/kubernetes/compare/v1.16.3...v1.17.0&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;compare äº†ä¸‹ v1.17.0 å’Œ v1.16.3 &lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å‘ç°äº† &lt;a href=&#34;https://github.com/kubernetes/kubernetes/commit/fed582333f639dc22e879f4bbb258e403c210c30&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Dockerfile çš„æ”¹åŠ¨&lt;/a&gt;ï¼Œ&lt;code&gt;1.17.0&lt;/code&gt; é‡Œçš„ Dockerfile çš„ BASEIMAGE æ˜¯ç”¨  &lt;a href=&#34;https://github.com/coreos/flannel/pull/1282#issuecomment-635273081&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æŒ‡å®šäº†ä¸€ä¸ªæºå®‰è£…äº†æœ€æ–°çš„ iptables&lt;/a&gt;ï¼Œç„¶ååˆ©ç”¨ &lt;code&gt;update-alternatives&lt;/code&gt; æŠŠè„šæœ¬ &lt;code&gt;/usr/sbin/iptables-wrapper&lt;/code&gt; å»æ›¿ä»£ &lt;code&gt;iptables&lt;/code&gt; æ¥æ£€æµ‹åº”è¯¥ä½¿ç”¨ &lt;code&gt;nft&lt;/code&gt; è¿˜æ˜¯ &lt;code&gt;legacy&lt;/code&gt;ï¼Œhack ä¸‹é•œåƒå›è‡ªå¸¦æºé‡Œçš„ iptables éªŒè¯ä¸‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-Dockerfile&#34; data-lang=&#34;Dockerfile&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; registry.aliyuncs.com/google_containers/kube-proxy:v1.17.5&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RUN&lt;/span&gt; rm -f /usr/sbin/iptables &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;    clean-install iptables&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ„å»ºçš„é•œåƒæ¨é€åˆ°äº† dockerhub ä¸Š &lt;code&gt;zhangguanzhang/hack-kube-proxy:v1.17.5&lt;/code&gt;ï¼Œæ›´æ”¹ä¸‹é›†ç¾¤ kube-proxy ds çš„é•œåƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n kube-system get ds kube-proxy -o yaml &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep image:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        image: zhangguanzhang/hack-kube-proxy:v1.17.5
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æµ‹è¯•è®¿é—®æˆåŠŸã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; curl -I 10.96.0.10:9153
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;404&lt;/span&gt; Not Found
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Content-Type: text/plain&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;charset&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;utf-8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;X-Content-Type-Options: nosniff
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Date: Thu, &lt;span class=&#34;m&#34;&gt;28&lt;/span&gt; May &lt;span class=&#34;m&#34;&gt;2020&lt;/span&gt; 04:47:21 GMT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Content-Length: &lt;span class=&#34;m&#34;&gt;19&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;real	0m0.008s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;user	0m0.003s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sys	0m0.003s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯¹äºè¿™ä¸ªé—®é¢˜æˆ‘åœ¨ &lt;a href=&#34;https://github.com/coreos/flannel/pull/1282&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;flannel çš„ pr&lt;/a&gt; ä¸‹é¢ä¹Ÿå‚ä¸äº†å›å¤ï¼ŒåŒæ—¶åœ¨å®˜æ–¹ github ä¸Šæäº†ä¸€ä¸ª &lt;a href=&#34;https://github.com/kubernetes/kubernetes/issues/91519&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;issue&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªé—®é¢˜çš„è§¦å‘æ˜¯ç”±äº&lt;code&gt;v1.17+&lt;/code&gt;çš„ kube-proxy çš„ docker é•œåƒé‡Œå®‰è£…äº†æœ€æ–°çš„ iptablesï¼Œ &lt;code&gt;--random-fully&lt;/code&gt; é€‰é¡¹&lt;a href=&#34;https://github.com/kubernetes/kubernetes/issues/88986#issuecomment-635640143&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¼šè§¦å‘å†…æ ¸ vxlan çš„ bug&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;ç›®å‰è§£å†³é—®é¢˜ä¸‰ç§åŠæ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…³é—­ CNI çš„ VXLAN ç½‘å¡çš„ &lt;code&gt;checksum offload&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ›´æ”¹ Docker é•œåƒ&lt;/li&gt;
&lt;li&gt;å‡çº§åˆ°æ–°å†…æ ¸ï¼Œå…·ä½“ç‰ˆæœ¬å°±ä¸çŸ¥é“äº†ï¼Œåªè¦åœ¨è¿™ä¸ª &lt;a href=&#34;https://github.com/torvalds/linux/commit/ea64d8d6c675c0bb712689b13810301de9d8f77a&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å†…æ ¸ pr&lt;/a&gt; åˆå¹¶åå‡ºçš„å†…æ ¸ç‰ˆæœ¬éƒ½è¡Œï¼Œæœ‰äººè¯´è¿™äº›å¯ä»¥ &lt;code&gt;Stable kernels 5.6.13, 5.4.41, 4.19.123, 4.14.181 and later have the checksum patch included.&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å‚è€ƒé“¾æ¥&#34;&gt;å‚è€ƒé“¾æ¥&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.csdn.net/u010039418/article/details/78234570&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TCP è¶…æ—¶é‡ä¼ å®šæ—¶å™¨æ¢³ç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://wiki.wireshark.org/CaptureSetup/Offloading&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;wireshark æ–‡æ¡£&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/TCP%E6%A0%A1%E9%AA%8C%E5%92%8C%E5%8D%B8%E8%BD%BD&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;offloading&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>ä¸€æ–‡å¸¦ä½ å½»åº•å˜æ¸… Kubernetes ä¸­çš„è¯ä¹¦å·¥ä½œæœºåˆ¶</title>
      <link>https://cloudnativecn.com/blog/k8s-certificate/</link>
      <pubDate>Thu, 21 May 2020 06:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/k8s-certificate/</guid>
      <description>&lt;p&gt;æ¥è§¦ Kubernetes ä»¥æ¥ï¼Œæˆ‘ç»å¸¸çœ‹åˆ° Kubernetes åœ¨ä¸åŒçš„åœ°æ–¹ä½¿ç”¨äº†è¯ä¹¦ï¼ˆCertificateï¼‰ï¼Œåœ¨ Kubernetes å®‰è£…å’Œç»„ä»¶å¯åŠ¨å‚æ•°ä¸­ä¹Ÿéœ€è¦é…ç½®å¤§é‡è¯ä¹¦ç›¸å…³çš„å‚æ•°ã€‚ä½†æ˜¯ Kubernetes çš„æ–‡æ¡£åœ¨è§£é‡Šè¿™äº›è¯ä¹¦çš„å·¥ä½œæœºåˆ¶æ–¹é¢åšå¾—å¹¶ä¸æ˜¯å¤ªå¥½ã€‚ç»è¿‡å¤§é‡çš„ç›¸å…³é˜…è¯»å’Œåˆ†æå·¥ä½œåï¼Œæˆ‘åŸºæœ¬å¼„æ¸…æ¥šäº† Kubernetes ä¸­è¯ä¹¦çš„ä½¿ç”¨æ–¹å¼ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è¯•å›¾ä»¥ä¸€ç§æ¯”å®˜æ–¹æ–‡æ¡£æ›´å®¹æ˜“ç†è§£çš„æ–¹å¼æ¥è¯´æ˜ Kubernetes è¯ä¹¦ç›¸å…³çš„å·¥ä½œæœºåˆ¶ï¼Œå¦‚æœä½ ä¹Ÿå­˜åœ¨è¿™æ–¹é¢çš„ç–‘æƒ‘ï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚&lt;/p&gt;
&lt;h2 id=&#34;kubernetes-ç»„ä»¶çš„è®¤è¯æ–¹å¼&#34;&gt;Kubernetes ç»„ä»¶çš„è®¤è¯æ–¹å¼&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ Kubernetes ä¸­çš„ç»„ä»¶ï¼šåœ¨ Kubernetes ä¸­åŒ…å«å¤šä¸ªä»¥ç‹¬ç«‹è¿›ç¨‹å½¢å¼è¿è¡Œçš„ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶ä¹‹é—´é€šè¿‡ HTTP/gRPC ç›¸äº’é€šä¿¡ï¼Œä»¥ååŒå®Œæˆé›†ç¾¤ä¸­åº”ç”¨çš„éƒ¨ç½²å’Œç®¡ç†å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhaohuabing.com/img/2020-05-19-k8s-certificate/components-of-kubernetes.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

kubernetes ç»„ä»¶ï¼Œå›¾ç‰‡æ¥æº&lt;a href=&#34;https://kubernetes.io/zh/docs/concepts/overview/components/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes.io&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒKubernetes æ§åˆ¶å¹³é¢ä¸­åŒ…å«äº† etcdï¼Œkube-api-serverï¼Œkube-schedulerï¼Œkube-controller-manager ç­‰ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶ä¼šç›¸äº’è¿›è¡Œè¿œç¨‹è°ƒç”¨ï¼Œä¾‹å¦‚ kube-api-server ä¼šè°ƒç”¨ etcd æ¥å£å­˜å‚¨æ•°æ®ï¼Œkube-controller-manager ä¼šè°ƒç”¨ kube-api-server æ¥å£æŸ¥è¯¢é›†ç¾¤ä¸­çš„å¯¹è±¡çŠ¶æ€ï¼›åŒæ—¶ï¼Œkube-api-server ä¹Ÿä¼šå’Œåœ¨å·¥ä½œèŠ‚ç‚¹ä¸Šçš„ kubelet å’Œ kube-proxy è¿›è¡Œé€šä¿¡ï¼Œä»¥åœ¨å·¥ä½œèŠ‚ç‚¹ä¸Šéƒ¨ç½²å’Œç®¡ç†åº”ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šè¿™äº›ç»„ä»¶ä¹‹é—´çš„ç›¸äº’è°ƒç”¨éƒ½æ˜¯é€šè¿‡ç½‘ç»œè¿›è¡Œçš„ã€‚åœ¨è¿›è¡Œç½‘ç»œé€šä¿¡æ—¶ï¼Œé€šä¿¡åŒæ–¹éœ€è¦éªŒè¯å¯¹æ–¹çš„èº«ä»½ï¼Œä»¥é¿å…æ¶æ„ç¬¬ä¸‰æ–¹ä¼ªé€ èº«ä»½çªƒå–ä¿¡æ¯æˆ–è€…å¯¹ç³»ç»Ÿè¿›è¡Œæ”»å‡»ã€‚ä¸ºäº†ç›¸äº’éªŒè¯å¯¹æ–¹çš„èº«ä»½ï¼Œé€šä¿¡åŒæ–¹ä¸­çš„ä»»ä½•ä¸€æ–¹éƒ½éœ€è¦åšä¸‹é¢ä¸¤ä»¶äº‹æƒ…ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‘å¯¹æ–¹æä¾›æ ‡æ˜è‡ªå·±èº«ä»½çš„ä¸€ä¸ªè¯ä¹¦&lt;/li&gt;
&lt;li&gt;éªŒè¯å¯¹æ–¹æä¾›çš„èº«ä»½è¯ä¹¦æ˜¯å¦åˆæ³•ï¼Œæ˜¯å¦ä¼ªé€ çš„ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨ Kubernetes ä¸­ä½¿ç”¨äº†æ•°å­—è¯ä¹¦æ¥æä¾›èº«ä»½è¯æ˜ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ•°å­—è¯ä¹¦ç®€å•ç†è§£ä¸ºæˆ‘ä»¬åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ä½¿ç”¨çš„â€œèº«ä»½è¯â€ï¼Œä¸Šé¢æ ‡æ³¨äº†è¯ä¹¦æ‹¥æœ‰è€…çš„èº«ä»½ä¿¡æ¯ï¼Œä¾‹å¦‚åç§°ï¼Œæ‰€å±ç»„ç»‡æœºæ„ç­‰ã€‚ä¸ºäº†ä¿è¯è¯ä¹¦çš„æƒå¨æ€§ï¼Œä¼šé‡‡ç”¨ä¸€ä¸ªé€šä¿¡åŒæ–¹éƒ½ä¿¡ä»»çš„ CAï¼ˆè¯ä¹¦æœºæ„ï¼ŒCertificate Authorityï¼‰æ¥é¢å‘è¯ä¹¦ã€‚è¿™å°±ç±»ä¼¼äºç°å®ç”Ÿæ´»ä¸­é¢å‘â€œèº«ä»½è¯â€çš„æ”¿åºœæœºæ„ã€‚æ•°å­—è¯ä¹¦ä¸­æœ€é‡è¦çš„å†…å®¹å®é™…ä¸Šæ˜¯è¯ä¹¦æ‹¥æœ‰è€…çš„å…¬é’¥ï¼Œè¯¥å…¬é’¥ä»£è¡¨äº†ç”¨æˆ·çš„èº«ä»½ã€‚æœ¬æ–‡å‡è®¾è¯»è€…å·²ç»äº†è§£æ•°å­—è¯ä¹¦å’Œ CA çš„åŸºæœ¬åŸç†ï¼Œå¦‚æœä½ å¯¹æ­¤ä¸å¤ªæ¸…æ¥šï¼Œæˆ–è€…å¸Œæœ›é‡æ–°æ¸©ä¹ ä¸€ä¸‹ç›¸å…³çŸ¥è¯†ï¼Œå¯ä»¥å…ˆé˜…è¯»ä¸€ä¸‹è¿™ç¯‡æ–‡ç« &lt;a href=&#34;https://zhaohuabing.com/post/2020-03-19-pki&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ã€Šæ•°å­—è¯ä¹¦åŸç†ã€‹&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhaohuabing.com/img/2020-05-19-k8s-certificate/ca.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;br&gt;
CAï¼ˆè¯ä¹¦æœºæ„ï¼‰ï¼Œå›¾ç‰‡æ¥æº&lt;a href=&#34;https://www.trustauth.cn/ca-question/1791.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;www.trustauth.cn&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ Kubernetes çš„ç»„ä»¶ä¹‹é—´è¿›è¡Œé€šä¿¡æ—¶ï¼Œæ•°å­—è¯ä¹¦çš„éªŒè¯æ˜¯åœ¨åè®®å±‚é¢é€šè¿‡ TLS å®Œæˆçš„ï¼Œé™¤äº†éœ€è¦åœ¨å»ºç«‹é€šä¿¡æ—¶æä¾›ç›¸å…³çš„è¯ä¹¦å’Œå¯†é’¥å¤–ï¼Œåœ¨åº”ç”¨å±‚é¢å¹¶ä¸éœ€è¦è¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚é‡‡ç”¨ TLS è¿›è¡ŒéªŒè¯æœ‰ä¸¤ç§æ–¹å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœåŠ¡å™¨å•å‘è®¤è¯ï¼šåªéœ€è¦æœåŠ¡å™¨ç«¯æä¾›è¯ä¹¦ï¼Œå®¢æˆ·ç«¯é€šè¿‡æœåŠ¡å™¨ç«¯è¯ä¹¦éªŒè¯æœåŠ¡çš„èº«ä»½ï¼Œä½†æœåŠ¡å™¨å¹¶ä¸éªŒè¯å®¢æˆ·ç«¯çš„èº«ä»½ã€‚è¿™ç§æƒ…å†µä¸€èˆ¬é€‚ç”¨äºå¯¹ Internet å¼€æ”¾çš„æœåŠ¡ï¼Œä¾‹å¦‚æœç´¢å¼•æ“ç½‘ç«™ï¼Œä»»ä½•å®¢æˆ·ç«¯éƒ½å¯ä»¥è¿æ¥åˆ°æœåŠ¡å™¨ä¸Šè¿›è¡Œè®¿é—®ï¼Œä½†å®¢æˆ·ç«¯éœ€è¦éªŒè¯æœåŠ¡å™¨çš„èº«ä»½ï¼Œä»¥é¿å…è¿æ¥åˆ°ä¼ªé€ çš„æ¶æ„æœåŠ¡å™¨ã€‚&lt;/li&gt;
&lt;li&gt;åŒå‘ TLS è®¤è¯ï¼šé™¤äº†å®¢æˆ·ç«¯éœ€è¦éªŒè¯æœåŠ¡å™¨çš„è¯ä¹¦ï¼ŒæœåŠ¡å™¨ä¹Ÿè¦é€šè¿‡å®¢æˆ·ç«¯è¯ä¹¦éªŒè¯å®¢æˆ·ç«¯çš„èº«ä»½ã€‚è¿™ç§æƒ…å†µä¸‹æœåŠ¡å™¨æä¾›çš„æ˜¯æ•æ„Ÿä¿¡æ¯ï¼Œåªå…è®¸ç‰¹å®šèº«ä»½çš„å®¢æˆ·ç«¯è®¿é—®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨ Kubernetes ä¸­ï¼Œå„ä¸ªç»„ä»¶æä¾›çš„æ¥å£ä¸­åŒ…å«äº†é›†ç¾¤çš„å†…éƒ¨ä¿¡æ¯ã€‚å¦‚æœè¿™äº›æ¥å£è¢«éæ³•è®¿é—®ï¼Œå°†å½±å“é›†ç¾¤çš„å®‰å…¨ï¼Œå› æ­¤ç»„ä»¶ä¹‹é—´çš„é€šä¿¡éœ€è¦é‡‡ç”¨åŒå‘ TLS è®¤è¯ã€‚å³å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½éœ€è¦éªŒè¯å¯¹æ–¹çš„èº«ä»½ä¿¡æ¯ã€‚åœ¨ä¸¤ä¸ªç»„ä»¶è¿›è¡ŒåŒå‘è®¤è¯æ—¶ï¼Œä¼šæ¶‰åŠåˆ°ä¸‹é¢è¿™äº›è¯ä¹¦ç›¸å…³çš„æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœåŠ¡å™¨ç«¯è¯ä¹¦ï¼šæœåŠ¡å™¨ç”¨äºè¯æ˜è‡ªèº«èº«ä»½çš„æ•°å­—è¯ä¹¦ï¼Œé‡Œé¢ä¸»è¦åŒ…å«äº†æœåŠ¡å™¨ç«¯çš„å…¬é’¥ä»¥åŠæœåŠ¡å™¨çš„èº«ä»½ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨ç«¯ç§é’¥ï¼šæœåŠ¡å™¨ç«¯è¯ä¹¦ä¸­åŒ…å«çš„å…¬é’¥æ‰€å¯¹åº”çš„ç§é’¥ã€‚å…¬é’¥å’Œç§é’¥æ˜¯æˆå¯¹ä½¿ç”¨çš„ï¼Œåœ¨è¿›è¡Œ TLS éªŒè¯æ—¶ï¼ŒæœåŠ¡å™¨ä½¿ç”¨è¯¥ç§é’¥æ¥å‘å®¢æˆ·ç«¯è¯æ˜è‡ªå·±æ˜¯æœåŠ¡å™¨ç«¯è¯ä¹¦çš„æ‹¥æœ‰è€…ã€‚&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯è¯ä¹¦ï¼šå®¢æˆ·ç«¯ç”¨äºè¯æ˜è‡ªèº«èº«ä»½çš„æ•°å­—è¯ä¹¦ï¼Œé‡Œé¢ä¸»è¦åŒ…å«äº†å®¢æˆ·ç«¯çš„å…¬é’¥ä»¥åŠå®¢æˆ·ç«¯çš„èº«ä»½ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯ç§é’¥ï¼šå®¢æˆ·ç«¯è¯ä¹¦ä¸­åŒ…å«çš„å…¬é’¥æ‰€å¯¹åº”çš„ç§é’¥ï¼ŒåŒç†ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨è¯¥ç§é’¥æ¥å‘æœåŠ¡å™¨ç«¯è¯æ˜è‡ªå·±æ˜¯å®¢æˆ·ç«¯è¯ä¹¦çš„æ‹¥æœ‰è€…ã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨ç«¯ CA æ ¹è¯ä¹¦ï¼šç­¾å‘æœåŠ¡å™¨ç«¯è¯ä¹¦çš„ CA æ ¹è¯ä¹¦ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨è¯¥ CA æ ¹è¯ä¹¦æ¥éªŒè¯æœåŠ¡å™¨ç«¯è¯ä¹¦çš„åˆæ³•æ€§ã€‚&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯ CA æ ¹è¯ä¹¦ï¼šç­¾å‘å®¢æˆ·ç«¯è¯ä¹¦çš„ CA æ ¹è¯ä¹¦ï¼ŒæœåŠ¡å™¨ç«¯ä½¿ç”¨è¯¥ CA æ ¹è¯ä¹¦æ¥éªŒè¯å®¢æˆ·ç«¯è¯ä¹¦çš„åˆæ³•æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢è¿™å¼ æ¥è‡ª&lt;a href=&#34;https://medium.com/sitewards/the-magic-of-tls-x509-and-mutual-authentication-explained-b2162dec4401&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The magic of TLS, X509 and mutual authentication explained&lt;/a&gt; æ–‡ç« ä¸­çš„å›¾å½¢è±¡åœ°è§£é‡Šäº†åŒå‘ TLS è®¤è¯çš„åŸç†ã€‚å¦‚æœä½ éœ€è¦äº†è§£æ›´å¤šå…³äº TLS è®¤è¯çš„åŸç†ï¼Œå¯ä»¥é˜…è¯»ä¸€ä¸‹ medium ä¸Šçš„åŸæ–‡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhaohuabing.com/img/2020-05-19-k8s-certificate/mutual-tls.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å›¾ç‰‡æ¥æº&lt;a href=&#34;https://medium.com/sitewards/the-magic-of-tls-x509-and-mutual-authentication-explained-b2162dec4401&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The magic of TLS, X509 and mutual authentication explained&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;kubernetes-ä¸­ä½¿ç”¨åˆ°çš„-ca-å’Œè¯ä¹¦&#34;&gt;Kubernetes ä¸­ä½¿ç”¨åˆ°çš„ CA å’Œè¯ä¹¦&lt;/h2&gt;
&lt;p&gt;Kubernetes ä¸­ä½¿ç”¨äº†å¤§é‡çš„è¯ä¹¦ï¼Œæœ¬æ–‡ä¸ä¼šè¯•å›¾è¦†ç›–åˆ°æ‰€æœ‰å¯èƒ½ä½¿ç”¨åˆ°çš„è¯ä¹¦ï¼Œä½†ä¼šè®¨è®ºåˆ°ä¸»è¦çš„è¯ä¹¦ã€‚ç†è§£äº†è¿™äº›è¯ä¹¦çš„ä½¿ç”¨æ–¹æ³•å’ŒåŸç†åï¼Œä¹Ÿèƒ½å¾ˆå¿«ç†è§£å…¶ä»–å¯èƒ½é‡åˆ°çš„è¯ä¹¦æ–‡ä»¶ã€‚ä¸‹å›¾æ ‡è¯†å‡ºäº†åœ¨ kubernetes ä¸­ä¸»è¦ä½¿ç”¨åˆ°çš„è¯ä¹¦å’Œå…¶ä½¿ç”¨çš„ä½ç½®ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhaohuabing.com/img/2020-05-19-k8s-certificate/kubernetes-certificate-usage.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Kubernetes ä¸­ä½¿ç”¨åˆ°çš„ä¸»è¦è¯ä¹¦&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾ä¸­ä½¿ç”¨åºå·å¯¹è¯ä¹¦è¿›è¡Œäº†æ ‡æ³¨ã€‚å›¾ä¸­çš„ç®­å¤´è¡¨æ˜äº†ç»„ä»¶çš„è°ƒç”¨æ–¹å‘ï¼Œç®­å¤´æ‰€æŒ‡æ–¹å‘ä¸ºæœåŠ¡æä¾›æ–¹ï¼Œå¦ä¸€å¤´ä¸ºæœåŠ¡è°ƒç”¨æ–¹ã€‚ä¸ºäº†å®ç° TLS åŒå‘è®¤è¯ï¼ŒæœåŠ¡æä¾›æ–¹éœ€è¦ä½¿ç”¨ä¸€ä¸ªæœåŠ¡å™¨è¯ä¹¦ï¼ŒæœåŠ¡è°ƒç”¨æ–¹åˆ™éœ€è¦æä¾›ä¸€ä¸ªå®¢æˆ·ç«¯è¯ä¹¦ï¼Œå¹¶ä¸”åŒæ–¹éƒ½éœ€è¦ä½¿ç”¨ä¸€ä¸ª CA è¯ä¹¦æ¥éªŒè¯å¯¹æ–¹æä¾›çš„è¯ä¹¦ã€‚ä¸ºäº†ç®€æ˜èµ·è§ï¼Œä¸Šå›¾ä¸­åªæ ‡æ³¨äº†è¯ä¹¦ä½¿ç”¨æ–¹æä¾›çš„è¯ä¹¦ï¼Œå¹¶æ²¡æœ‰æ ‡æ³¨è¯ä¹¦çš„éªŒè¯æ–¹éªŒè¯ä½¿ç”¨çš„ CA è¯ä¹¦ã€‚å›¾ä¸­æ ‡æ³¨çš„è¿™äº›è¯ä¹¦çš„ä½œç”¨åˆ†åˆ«å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;etcd é›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹ä¹‹é—´ç›¸äº’é€šä¿¡ä½¿ç”¨çš„è¯ä¹¦ã€‚ç”±äºä¸€ä¸ª etcd èŠ‚ç‚¹æ—¢ä¸ºå…¶ä»–èŠ‚ç‚¹æä¾›æœåŠ¡ï¼Œåˆéœ€è¦ä½œä¸ºå®¢æˆ·ç«¯è®¿é—®å…¶ä»–èŠ‚ç‚¹ï¼Œå› æ­¤è¯¥è¯ä¹¦åŒæ—¶ç”¨ä½œæœåŠ¡å™¨è¯ä¹¦å’Œå®¢æˆ·ç«¯è¯ä¹¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;etcd é›†ç¾¤å‘å¤–æä¾›æœåŠ¡ä½¿ç”¨çš„è¯ä¹¦ã€‚è¯¥è¯ä¹¦æ˜¯æœåŠ¡å™¨è¯ä¹¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;kube-apiserver ä½œä¸ºå®¢æˆ·ç«¯è®¿é—® etcd ä½¿ç”¨çš„è¯ä¹¦ã€‚è¯¥è¯ä¹¦æ˜¯å®¢æˆ·ç«¯è¯ä¹¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;kube-apiserver å¯¹å¤–æä¾›æœåŠ¡ä½¿ç”¨çš„è¯ä¹¦ã€‚è¯¥è¯ä¹¦æ˜¯æœåŠ¡å™¨è¯ä¹¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;kube-controller-manager ä½œä¸ºå®¢æˆ·ç«¯è®¿é—® kube-apiserver ä½¿ç”¨çš„è¯ä¹¦ï¼Œè¯¥è¯ä¹¦æ˜¯å®¢æˆ·ç«¯è¯ä¹¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;kube-scheduler ä½œä¸ºå®¢æˆ·ç«¯è®¿é—® kube-apiserver ä½¿ç”¨çš„è¯ä¹¦ï¼Œè¯¥è¯ä¹¦æ˜¯å®¢æˆ·ç«¯è¯ä¹¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;kube-proxy ä½œä¸ºå®¢æˆ·ç«¯è®¿é—® kube-apiserver ä½¿ç”¨çš„è¯ä¹¦ï¼Œè¯¥è¯ä¹¦æ˜¯å®¢æˆ·ç«¯è¯ä¹¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;kubelet ä½œä¸ºå®¢æˆ·ç«¯è®¿é—® kube-apiserver ä½¿ç”¨çš„è¯ä¹¦ï¼Œè¯¥è¯ä¹¦æ˜¯å®¢æˆ·ç«¯è¯ä¹¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç®¡ç†å‘˜ç”¨æˆ·é€šè¿‡ kubectl è®¿é—® kube-apiserver ä½¿ç”¨çš„è¯ä¹¦ï¼Œè¯¥è¯ä¹¦æ˜¯å®¢æˆ·ç«¯è¯ä¹¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;kubelet å¯¹å¤–æä¾›æœåŠ¡ä½¿ç”¨çš„è¯ä¹¦ã€‚è¯¥è¯ä¹¦æ˜¯æœåŠ¡å™¨è¯ä¹¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;kube-apiserver ä½œä¸ºå®¢æˆ·ç«¯è®¿é—® kubelet é‡‡ç”¨çš„è¯ä¹¦ã€‚è¯¥è¯ä¹¦æ˜¯å®¢æˆ·ç«¯è¯ä¹¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;kube-controller-manager ç”¨äºç”Ÿæˆå’ŒéªŒè¯ service-account token çš„è¯ä¹¦ã€‚è¯¥è¯ä¹¦å¹¶ä¸ä¼šåƒå…¶ä»–è¯ä¹¦ä¸€æ ·ç”¨äºèº«ä»½è®¤è¯ï¼Œè€Œæ˜¯å°†è¯ä¹¦ä¸­çš„å…¬é’¥/ç§é’¥å¯¹ç”¨äº service account token çš„ç”Ÿæˆå’ŒéªŒè¯ã€‚kube-controller-manager  ä¼šç”¨è¯¥è¯ä¹¦çš„ç§é’¥æ¥ç”Ÿæˆ service account tokenï¼Œç„¶åä»¥ secret çš„æ–¹å¼åŠ è½½åˆ° pod ä¸­ã€‚pod ä¸­çš„åº”ç”¨å¯ä»¥ä½¿ç”¨è¯¥ token æ¥è®¿é—® kube-apiserverï¼Œkube-apiserver ä¼šä½¿ç”¨è¯¥è¯ä¹¦ä¸­çš„å…¬é’¥æ¥éªŒè¯è¯·æ±‚ä¸­çš„ tokenã€‚æˆ‘ä»¬å°†åœ¨æ–‡ä¸­ç¨åéƒ¨åˆ†è¯¦ç»†ä»‹ç»è¯¥è¯ä¹¦çš„ä½¿ç”¨æ–¹æ³•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é€šè¿‡è¿™å¼ å›¾ï¼Œå¯¹è¯ä¹¦æœºåˆ¶æ¯”è¾ƒäº†è§£çš„è¯»è€…å¯èƒ½å·²ç»çœ‹å‡ºï¼Œæˆ‘ä»¬å…¶å®å¯ä»¥ä½¿ç”¨å¤šä¸ªä¸åŒçš„ CA æ¥é¢å‘è¿™äº›è¯ä¹¦ã€‚åªè¦åœ¨é€šä¿¡çš„ç»„ä»¶ä¸­æ­£ç¡®é…ç½®ç”¨äºéªŒè¯å¯¹æ–¹è¯ä¹¦çš„ CA æ ¹è¯ä¹¦ï¼Œå°±å¯ä»¥ä½¿ç”¨ä¸åŒçš„ CA æ¥é¢å‘ä¸åŒç”¨é€”çš„è¯ä¹¦ã€‚ä½†æˆ‘ä»¬ä¸€èˆ¬å»ºè®®é‡‡ç”¨ç»Ÿä¸€çš„ CA æ¥é¢å‘ kubernetes é›†ç¾¤ä¸­çš„æ‰€æœ‰è¯ä¹¦ï¼Œè¿™æ˜¯å› ä¸ºé‡‡ç”¨ä¸€ä¸ªé›†ç¾¤æ ¹ CA çš„æ–¹å¼æ¯”é‡‡ç”¨å¤šä¸ª CA çš„æ–¹å¼æ›´å®¹æ˜“ç®¡ç†ï¼Œå¯ä»¥é¿å…å¤šä¸ª CA å¯¼è‡´çš„å¤æ‚çš„è¯ä¹¦é…ç½®ã€æ›´æ–°ç­‰é—®é¢˜ï¼Œå‡å°‘ç”±äºè¯ä¹¦é…ç½®é”™è¯¯å¯¼è‡´çš„é›†ç¾¤æ•…éšœã€‚&lt;/p&gt;
&lt;h2 id=&#34;kubernetes-ä¸­çš„è¯ä¹¦é…ç½®&#34;&gt;Kubernetes ä¸­çš„è¯ä¹¦é…ç½®&lt;/h2&gt;
&lt;p&gt;å‰é¢æˆ‘ä»¬ä»‹ç»äº† Kubernetes é›†ç¾¤ä¸­ä¸»è¦ä½¿ç”¨åˆ°çš„è¯ä¹¦ã€‚ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«çœ‹ä¸€ä¸‹å¦‚ä½•å°†è¿™äº›è¯ä¹¦åŠå…¶å¯¹åº”çš„ç§é’¥å’Œ CA æ ¹è¯ä¹¦éœ€è¦é…ç½®åˆ° Kubernetes ä¸­å„ä¸ªç»„ä»¶ä¸­ï¼Œä»¥ä¾›å„ä¸ªç»„ä»¶è¿›è¡Œä½¿ç”¨ã€‚è¿™é‡Œå‡è®¾ä½¿ç”¨ä¸€ä¸ªé›†ç¾¤æ ¹ CA æ¥é¢å‘æ‰€æœ‰ç›¸å…³è¯ä¹¦ï¼Œå› æ­¤æ¶‰åŠåˆ° CA çš„é…ç½®å¯¹åº”çš„è¯ä¹¦æ–‡ä»¶åéƒ½æ˜¯ç›¸åŒçš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;etcd-è¯ä¹¦é…ç½®&#34;&gt;etcd è¯ä¹¦é…ç½®&lt;/h3&gt;
&lt;p&gt;éœ€è¦åœ¨ etcd çš„å¯åŠ¨å‘½ä»¤è¡Œä¸­é…ç½®ä»¥ä¸‹è¯ä¹¦ç›¸å…³å‚æ•°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;etcd å¯¹å¤–æä¾›æœåŠ¡çš„æœåŠ¡å™¨è¯ä¹¦åŠç§é’¥ã€‚&lt;/li&gt;
&lt;li&gt;etcd èŠ‚ç‚¹ä¹‹é—´ç›¸äº’è¿›è¡Œè®¤è¯çš„ peer è¯ä¹¦ã€ç§é’¥ä»¥åŠéªŒè¯ peer çš„ CAã€‚&lt;/li&gt;
&lt;li&gt;etcd éªŒè¯è®¿é—®å…¶æœåŠ¡çš„å®¢æˆ·ç«¯çš„ CAã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/local/bin/etcd &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --cert-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/etc/etcd/kube-etcd.pem &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;                   &lt;span class=&#34;c1&#34;&gt;# å¯¹å¤–æä¾›æœåŠ¡çš„æœåŠ¡å™¨è¯ä¹¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --key-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/etc/etcd/kube-etcd-key.pem &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;                &lt;span class=&#34;c1&#34;&gt;# æœåŠ¡å™¨è¯ä¹¦å¯¹åº”çš„ç§é’¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --peer-cert-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/etc/etcd/kube-etcd-peer.pem &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;         &lt;span class=&#34;c1&#34;&gt;# peer è¯ä¹¦ï¼Œç”¨äº etcd èŠ‚ç‚¹ä¹‹é—´çš„ç›¸äº’è®¿é—®&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --peer-key-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/etc/etcd/kube-etcd-peer-key.pem &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;      &lt;span class=&#34;c1&#34;&gt;# peer è¯ä¹¦å¯¹åº”çš„ç§é’¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --trusted-ca-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/etc/etcd/cluster-root-ca.pem &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;# ç”¨äºéªŒè¯è®¿é—® etcd æœåŠ¡å™¨çš„å®¢æˆ·ç«¯è¯ä¹¦çš„ CA æ ¹è¯ä¹¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --peer-trusted-ca-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/etc/etcd/cluster-root-ca.pem&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;# ç”¨äºéªŒè¯ peer è¯ä¹¦çš„ CA æ ¹è¯ä¹¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;kube-apiserver-è¯ä¹¦é…ç½®&#34;&gt;kube-apiserver è¯ä¹¦é…ç½®&lt;/h3&gt;
&lt;p&gt;éœ€è¦åœ¨ kube-apiserver ä¸­é…ç½®ä»¥ä¸‹è¯ä¹¦ç›¸å…³å‚æ•°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;kube-apiserver å¯¹å¤–æä¾›æœåŠ¡çš„æœåŠ¡å™¨è¯ä¹¦åŠç§é’¥ã€‚&lt;/li&gt;
&lt;li&gt;kube-apiserver è®¿é—® etcd æ‰€éœ€çš„å®¢æˆ·ç«¯è¯ä¹¦åŠç§é’¥ã€‚&lt;/li&gt;
&lt;li&gt;kube-apiserver è®¿é—® kubelet æ‰€éœ€çš„å®¢æˆ·ç«¯è¯ä¹¦åŠç§é’¥ã€‚&lt;/li&gt;
&lt;li&gt;éªŒè¯è®¿é—®å…¶æœåŠ¡çš„å®¢æˆ·ç«¯çš„ CAã€‚&lt;/li&gt;
&lt;li&gt;éªŒè¯ etcd æœåŠ¡å™¨è¯ä¹¦çš„ CA æ ¹è¯ä¹¦ã€‚&lt;/li&gt;
&lt;li&gt;éªŒè¯ service account token çš„å…¬é’¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/local/bin/kube-apiserver &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --tls-cert-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/var/lib/kubernetes/kube-apiserver.pem &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;                             &lt;span class=&#34;c1&#34;&gt;# ç”¨äºå¯¹å¤–æä¾›æœåŠ¡çš„æœåŠ¡å™¨è¯ä¹¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --tls-private-key-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/var/lib/kubernetes/kube-apiserver-key.pem &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;                  &lt;span class=&#34;c1&#34;&gt;# æœåŠ¡å™¨è¯ä¹¦å¯¹åº”çš„ç§é’¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --etcd-certfile&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/var/lib/kubernetes/kube-apiserver-etcd-client.pem &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;                 &lt;span class=&#34;c1&#34;&gt;# ç”¨äºè®¿é—® etcd çš„å®¢æˆ·ç«¯è¯ä¹¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --etcd-keyfile&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/var/lib/kubernetes/kube-apiserver-etcd-client-key.pem &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;              &lt;span class=&#34;c1&#34;&gt;# ç”¨äºè®¿é—® etcd çš„å®¢æˆ·ç«¯è¯ä¹¦çš„ç§é’¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --kubelet-client-certificate&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/var/lib/kubernetes/kube-apiserver-kubelet-client.pem &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# ç”¨äºè®¿é—® kubelet çš„å®¢æˆ·ç«¯è¯ä¹¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --kubelet-client-key&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/var/lib/kubernetes/kube-apiserver-kubelet-client-key.pem &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;     &lt;span class=&#34;c1&#34;&gt;# ç”¨äºè®¿é—® kubelet çš„å®¢æˆ·ç«¯è¯ä¹¦çš„ç§é’¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --client-ca-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/var/lib/kubernetes/cluster-root-ca.pem &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;                           &lt;span class=&#34;c1&#34;&gt;# ç”¨äºéªŒè¯è®¿é—® kube-apiserver çš„å®¢æˆ·ç«¯çš„è¯ä¹¦çš„ CA æ ¹è¯ä¹¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --etcd-cafile&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/var/lib/kubernetes/cluster-root-ca.pem &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;                              &lt;span class=&#34;c1&#34;&gt;# ç”¨äºéªŒè¯ etcd æœåŠ¡å™¨è¯ä¹¦çš„ CA æ ¹è¯ä¹¦  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --kubelet-certificate-authority&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/var/lib/kubernetes/cluster-root-ca.pem &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;            &lt;span class=&#34;c1&#34;&gt;# ç”¨äºéªŒè¯ kubelet æœåŠ¡å™¨è¯ä¹¦çš„ CA æ ¹è¯ä¹¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --service-account-key-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/var/lib/kubernetes/service-account.pem &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;                 &lt;span class=&#34;c1&#34;&gt;# ç”¨äºéªŒè¯ service account token çš„å…¬é’¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;é‡‡ç”¨-kubeconfig-è®¿é—®-kube-apiserver&#34;&gt;é‡‡ç”¨ kubeconfig è®¿é—® kube-apiserver&lt;/h3&gt;
&lt;p&gt;Kubernetes ä¸­çš„å„ä¸ªç»„ä»¶ï¼ŒåŒ…æ‹¬ kube-controller-manangerã€kube-schedulerã€kube-proxyã€kubelet ç­‰ï¼Œé‡‡ç”¨ä¸€ä¸ª kubeconfig æ–‡ä»¶ä¸­é…ç½®çš„ä¿¡æ¯æ¥è®¿é—® kube-apiserverã€‚è¯¥æ–‡ä»¶ä¸­åŒ…å«äº† kube-apiserver çš„åœ°å€ï¼ŒéªŒè¯ kube-apiserver æœåŠ¡å™¨è¯ä¹¦çš„ CA è¯ä¹¦ï¼Œè‡ªå·±çš„å®¢æˆ·ç«¯è¯ä¹¦å’Œç§é’¥ç­‰è®¿é—®ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¸€ä¸ªä½¿ç”¨ minikube å®‰è£…çš„é›†ç¾¤ä¸­ï¼Œç”Ÿæˆçš„ kubeconfig é…ç½®æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼Œè¿™å››ä¸ªæ–‡ä»¶åˆ†åˆ«ä¸º admin ç”¨æˆ·ï¼Œkube-controller-manangerã€kubelet å’Œ kube-scheduler çš„ kubeconfig é…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ls /etc/kubernetes/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;admin.conf  controller-manager.conf  kubelet.conf  scheduler.conf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬æ‰“å¼€ controller-manager.conf æ¥çœ‹ä¸€ä¸‹ï¼Œä¸ºäº†èŠ‚çº¦ç¯‡å¹…ï¼Œè¿™é‡Œæ²¡æœ‰å†™å‡ºè¯ä¹¦å’Œç§é’¥çš„å®Œæ•´å†…å®¹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# ç”¨äºéªŒè¯ kube-apiserver æœåŠ¡å™¨è¯ä¹¦çš„ CA æ ¹è¯ä¹¦ &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;certificate-authority-data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;LS0tLS1CRUdJTiBDRVJUSUZJQXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX0tLS0tCg==&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https://localhost:8443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubernetes&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;contexts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubernetes&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;system:kube-controller-manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;system:kube-controller-manager@kubernetes&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;current-context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;system:kube-controller-manager@kubernetes&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Config&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;preferences&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;system:kube-controller-manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# ç”¨äºè®¿é—® kube-apiserver çš„å®¢æˆ·ç«¯è¯ä¹¦&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;client-certificate-data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;LS0tLS1CRUdJTiXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXQ0FURS0tLS0tCg==&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# å®¢æˆ·ç«¯è¯ä¹¦å¯¹åº”çš„ç§é’¥&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;client-key-data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;LS0tLS1CRUdXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXtFWS0tLS0tCg==&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œè®¿é—® kube-apiserver æ‰€éœ€è¦çš„ç›¸å…³è¯ä¹¦å†…å®¹å·²ç»è¢«é‡‡ç”¨ base64 ç¼–ç å†™å…¥äº†æ–‡ä»¶ä¸­ã€‚å…¶ä»–å‡ ä¸ªæ–‡ä»¶ä¸­çš„å†…å®¹ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œåªæ˜¯é…ç½®çš„ç”¨æˆ·åå’Œå®¢æˆ·ç«¯è¯ä¹¦æœ‰æ‰€ä¸åŒã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å¯åŠ¨è¿™äº›ç»„ä»¶æ—¶ï¼Œéœ€è¦åœ¨å‚æ•°ä¸­æŒ‡å‡º kubeconfig æ–‡ä»¶çš„è·¯å¾„ï¼Œä¾‹å¦‚ kube-controller-manager çš„å¯åŠ¨å‘½ä»¤å¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; /usr/local/bin/kube-controller-manager &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; --kubeconfig&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/etc/kubernetes/controller-manager.conf 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;c1&#34;&gt;# ä¸‹é¢å‡ ä¸ªè¯ä¹¦å’Œè®¿é—® kube-apiserver æ— å…³ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢ä»‹ç»åˆ°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; --cluster-signing-cert-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/var/lib/kubernetes/cluster-root-ca.pem             &lt;span class=&#34;c1&#34;&gt;# ç”¨äºç­¾å‘è¯ä¹¦çš„ CA æ ¹è¯ä¹¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; --cluster-signing-key-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/var/lib/kubernetes/cluster-root-ca-key.pem          &lt;span class=&#34;c1&#34;&gt;# ç”¨äºç­¾å‘è¯ä¹¦çš„ CA æ ¹è¯ä¹¦çš„ç§é’¥  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; --service-account-private-key-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/var/lib/kubernetes/service-account-key.pem  &lt;span class=&#34;c1&#34;&gt;# ç”¨äºå¯¹ service account token è¿›è¡Œç­¾åçš„ç§é’¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; ... 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;service-account--è¯ä¹¦&#34;&gt;Service Account  è¯ä¹¦&lt;/h3&gt;
&lt;p&gt;Kubernetes ä¸­æœ‰ä¸¤ç±»ç”¨æˆ·ï¼Œä¸€ç±»ä¸º user accountï¼Œä¸€ç±»ä¸º service accountã€‚service account ä¸»è¦è¢« pod ç”¨äºè®¿é—® kube-apiserverã€‚åœ¨ä¸ºä¸€ä¸ª pod æŒ‡å®šäº† service account  åï¼Œkubernetes ä¼šä¸ºè¯¥ service account ç”Ÿæˆä¸€ä¸ª JWT tokenï¼Œå¹¶ä½¿ç”¨ secret å°†è¯¥ service account token åŠ è½½åˆ° pod ä¸Šã€‚pod ä¸­çš„åº”ç”¨å¯ä»¥ä½¿ç”¨ service account token æ¥è®¿é—® api serverã€‚service account è¯ä¹¦è¢«ç”¨äºç”Ÿæˆå’ŒéªŒè¯ service account tokenã€‚è¯¥è¯ä¹¦çš„ç”¨æ³•å’Œå‰é¢ä»‹ç»çš„å…¶ä»–è¯ä¹¦ä¸åŒï¼Œå› ä¸ºå®é™…ä¸Šä½¿ç”¨çš„æ˜¯å…¶å…¬é’¥å’Œç§é’¥ï¼Œè€Œå¹¶ä¸éœ€è¦å¯¹è¯ä¹¦è¿›è¡ŒéªŒè¯ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ° service account è¯ä¹¦çš„å…¬é’¥å’Œç§é’¥åˆ†åˆ«è¢«é…ç½®åˆ°äº† kube-apiserver å’Œ kube-controller-manager çš„å‘½ä»¤è¡Œå‚æ•°ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/local/bin/kube-apiserver &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --service-account-key-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/var/lib/kubernetes/service-account.pem &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;          &lt;span class=&#34;c1&#34;&gt;# ç”¨äºéªŒè¯ service account token çš„å…¬é’¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; /usr/local/bin/kube-controller-manager &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; --service-account-private-key-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/var/lib/kubernetes/service-account-key.pem  &lt;span class=&#34;c1&#34;&gt;# ç”¨äºå¯¹ service account token è¿›è¡Œç­¾åçš„ç§é’¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; ... 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº† kubernetes ä¸­ç”Ÿæˆã€ä½¿ç”¨å’ŒéªŒè¯ service account token  çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://zhaohuabing.com/img/2020-05-19-k8s-certificate/service-account-token.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h4 id=&#34;è®¤è¯æ–¹æ³•å®¢æˆ·ç«¯è¯ä¹¦è¿˜æ˜¯-token&#34;&gt;è®¤è¯æ–¹æ³•ï¼šå®¢æˆ·ç«¯è¯ä¹¦è¿˜æ˜¯ tokenï¼Ÿ&lt;/h4&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒKubernetes æä¾›äº†ä¸¤ç§å®¢æˆ·ç«¯è®¤è¯çš„æ–¹æ³•ï¼Œæ§åˆ¶é¢ç»„ä»¶é‡‡ç”¨çš„æ˜¯å®¢æˆ·ç«¯æ•°å­—è¯ä¹¦;è€Œåœ¨é›†ç¾¤ä¸­éƒ¨ç½²çš„åº”ç”¨åˆ™é‡‡ç”¨äº† service account token çš„æ–¹å¼ã€‚ä¸ºä»€ä¹ˆ Kubernetes ä¸ä¸º service account ä¹Ÿç”Ÿæˆä¸€ä¸ªè¯ä¹¦ï¼Œå¹¶é‡‡ç”¨è¯¥è¯ä¹¦è¿›è¡Œèº«ä»½è®¤è¯å‘¢ï¼Ÿå®é™…ä¸Š Istio å°±æ˜¯è¿™æ ·åšçš„ï¼ŒIstio ä¼šè‡ªåŠ¨ä¸ºæ¯ä¸ª service account ç”Ÿæˆä¸€ä¸ªè¯ä¹¦ï¼Œå¹¶ä½¿ç”¨è¯¥è¯ä¹¦æ¥åœ¨ pod ä¸­çš„åº”ç”¨ä¹‹é—´å»ºç«‹åŒå‘ tls è®¤è¯ã€‚æˆ‘æ²¡æœ‰æ‰¾åˆ° Kubernetes è¿™ä¸ªè®¾è®¡å†³ç­–çš„ç›¸å…³è¯´æ˜ï¼Œå¦‚æœä½ çŸ¥é“åŸå› æˆ–å¯¹æ­¤æœ‰è‡ªå·±çš„è§è§£ï¼Œæ¬¢è¿è”ç³»æˆ‘è¿›è¡Œæ¢è®¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;kubernetes-è¯ä¹¦ç­¾å‘&#34;&gt;Kubernetes è¯ä¹¦ç­¾å‘&lt;/h3&gt;
&lt;p&gt;Kubernetes æä¾›äº†ä¸€ä¸ª  &lt;code&gt;certificates.k8s.io&lt;/code&gt;  APIï¼Œå¯ä»¥ä½¿ç”¨é…ç½®çš„ CA æ ¹è¯ä¹¦æ¥ç­¾å‘ç”¨æˆ·è¯ä¹¦ã€‚è¯¥ API ç”± kube-controller-manager å®ç°ï¼Œå…¶ç­¾å‘è¯ä¹¦ä½¿ç”¨çš„æ ¹è¯ä¹¦åœ¨ä¸‹é¢çš„å‘½ä»¤è¡Œä¸­è¿›è¡Œé…ç½®ã€‚æˆ‘ä»¬å¸Œæœ› Kubernetes é‡‡ç”¨é›†ç¾¤æ ¹ CA æ¥ç­¾å‘ç”¨æˆ·è¯ä¹¦ï¼Œå› æ­¤åœ¨  kube-controller-manager  çš„å‘½ä»¤è¡Œå‚æ•°ä¸­å°†ç›¸å…³å‚æ•°é…ç½®ä¸ºäº†é›†ç¾¤æ ¹ CAã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; /usr/local/bin/kube-controller-manager &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; --cluster-signing-cert-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/var/lib/kubernetes/cluster-root-ca.pem             &lt;span class=&#34;c1&#34;&gt;# ç”¨äºç­¾å‘è¯ä¹¦çš„ CA æ ¹è¯ä¹¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; --cluster-signing-key-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/var/lib/kubernetes/cluster-root-ca-key.pem          &lt;span class=&#34;c1&#34;&gt;# ç”¨äºç­¾å‘è¯ä¹¦çš„ CA æ ¹è¯ä¹¦çš„ç§é’¥  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; ... 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…³äºæ›´å¤š Kubernetes è¯ä¹¦ç­¾å‘ API çš„å†…å®¹ï¼Œå¯ä»¥å‚è§ &lt;a href=&#34;https://kubernetes.io/zh/docs/tasks/tls/managing-tls-in-a-cluster/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç®¡ç†é›†ç¾¤ä¸­çš„ TLS è®¤è¯&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨-tls-bootstrapping-ç®€åŒ–-kubelet-è¯ä¹¦åˆ¶ä½œ&#34;&gt;ä½¿ç”¨ TLS bootstrapping ç®€åŒ– Kubelet è¯ä¹¦åˆ¶ä½œ&lt;/h3&gt;
&lt;p&gt;åœ¨å®‰è£… Kubernetes æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šçš„ Kubelet åˆ†åˆ«ç”Ÿæˆä¸€ä¸ªè¯ä¹¦ã€‚ç”±äºå·¥ä½œèŠ‚ç‚¹å¯èƒ½å¾ˆå¤šï¼Œæ‰‹åŠ¨ç”Ÿæˆ Kubelet è¯ä¹¦çš„è¿‡ç¨‹ä¼šæ¯”è¾ƒç¹çã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒKubernetes æä¾›äº† &lt;a href=&#34;https://kubernetes.io/zh/docs/reference/command-line-tools-reference/kubelet-tls-bootstrapping/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TLS bootstrapping &lt;/a&gt; çš„æ–¹å¼æ¥ç®€åŒ–   Kubelet è¯ä¹¦çš„ç”Ÿæˆè¿‡ç¨‹ã€‚å…¶åŸç†æ˜¯é¢„å…ˆæä¾›ä¸€ä¸ª bootstrapping tokenï¼Œkubelet é€šè¿‡è¯¥ kubelet è°ƒç”¨ kube-apiserver çš„è¯ä¹¦ç­¾å‘ API æ¥ç”Ÿæˆ è‡ªå·±éœ€è¦çš„è¯ä¹¦ã€‚è¦å¯ç”¨è¯¥åŠŸèƒ½ï¼Œéœ€è¦åœ¨ kube-apiserver ä¸­å¯ç”¨ &lt;code&gt;--enable-bootstrap-token-auth&lt;/code&gt; ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª kubelet è®¿é—® kube-apiserver ä½¿ç”¨çš„ bootstrap token secretã€‚å¦‚æœä½¿ç”¨ kubeadmin å®‰è£…ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code&gt;kubeadm token create&lt;/code&gt;å‘½ä»¤æ¥åˆ›å»º tokenã€‚&lt;/p&gt;
&lt;p&gt;é‡‡ç”¨ TLS bootstrapping ç”Ÿæˆè¯ä¹¦çš„æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è°ƒç”¨ kube-apiserver ç”Ÿæˆä¸€ä¸ª bootstrap tokenã€‚&lt;/li&gt;
&lt;li&gt;å°†è¯¥ bootstrap token å†™å…¥åˆ°ä¸€ä¸ª kubeconfig æ–‡ä»¶ä¸­ï¼Œä½œä¸º kubelet è°ƒç”¨ kube-apiserver çš„å®¢æˆ·ç«¯éªŒè¯æ–¹å¼ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡  &lt;code&gt;--bootstrap-kubeconfig&lt;/code&gt; å¯åŠ¨å‚æ•°å°† bootstrap token ä¼ é€’ç»™ kubelet è¿›ç¨‹ã€‚&lt;/li&gt;
&lt;li&gt;Kubelet é‡‡ç”¨ bootstrap token è°ƒç”¨ kube-apiserver APIï¼Œç”Ÿæˆè‡ªå·±æ‰€éœ€çš„æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯è¯ä¹¦ã€‚&lt;/li&gt;
&lt;li&gt;è¯ä¹¦ç”Ÿæˆåï¼ŒKubelet é‡‡ç”¨ç”Ÿæˆçš„è¯ä¹¦å’Œ kube-apiserver è¿›è¡Œé€šä¿¡ï¼Œå¹¶åˆ é™¤æœ¬åœ°çš„ kubeconfig æ–‡ä»¶ï¼Œä»¥é¿å… bootstrap token æ³„æ¼é£é™©ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å°ç»“&#34;&gt;å°ç»“&lt;/h2&gt;
&lt;p&gt;Kubernetes ä¸­ä½¿ç”¨äº†å¤§é‡çš„è¯ä¹¦æ¥ç¡®ä¿é›†ç¾¤çš„å®‰å…¨ï¼Œå¼„æ¸…æ¥šè¿™äº›è¯ä¹¦çš„ç”¨é€”å’Œé…ç½®æ–¹æ³•å°†æœ‰åŠ©äºæˆ‘ä»¬æ·±å…¥ç†è§£ kubernetes çš„å®‰è£…è¿‡ç¨‹å’Œç»„ä»¶çš„é…ç½®ã€‚æœ¬æ–‡æ˜¯ç¬”è€…åœ¨å­¦ä¹  è¿‡ç¨‹ä¸­æ•´ç†çš„ Kubernetes é›†ç¾¤ä¸­ä¸»è¦ä½¿ç”¨åˆ°çš„è¯ä¹¦ï¼Œç”±äºç¬”è€…å¯¹ Kubernetes çš„ç†è§£æœ‰é™ï¼Œæ–‡ç« ä¸­éš¾å…å­˜åœ¨éƒ¨åˆ†é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒæ–‡æ¡£&#34;&gt;å‚è€ƒæ–‡æ¡£&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/zh/docs/setup/best-practices/certificates/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes PKI è¯ä¹¦å’Œè¦æ±‚&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kelseyhightower/kubernetes-the-hard-wa&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes the hard way&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.51cto.com/13210651/2361208&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes ä¹‹ äºŒè¿›åˆ¶å®‰è£… (äºŒ) è¯ä¹¦è¯¦è§£&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/zh/docs/reference/command-line-tools-reference/kubelet-tls-bootstrapping/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TLS bootstrapping&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhaohuabing.com/post/2020-03-19-pki/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ•°å­—è¯ä¹¦åŸç†&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>æµ…è°ˆ Kubernetes Scheduling-Framework æ’ä»¶çš„å®ç°</title>
      <link>https://cloudnativecn.com/blog/202003-k8s-scheduling-framework/</link>
      <pubDate>Mon, 16 Mar 2020 07:16:13 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/202003-k8s-scheduling-framework/</guid>
      <description>&lt;p&gt;æœ€è¿‘å‡ ä¸ªæœˆä¸€ç›´åœ¨ç ”ç©¶ kubernetes çš„ scheduling-framework è°ƒåº¦æ¡†æ¶ï¼Œå‘ç°è¿˜æ˜¯ååˆ†æœ‰æ„æ€çš„ï¼Œæˆ‘è‡ªå·±ä¹Ÿå®ç°äº†ä¸€ä¸ªåŸºäº scheduling-framework è°ƒåº¦æ¡†æ¶çš„è‡ªå®šä¹‰è°ƒåº¦å™¨ï¼Œå¸Œæœ›æ„Ÿå…´è¶£çš„åŒå­¦ä¸€èµ·å­¦ä¹ ï¼šhttps://github.com/NJUPT-ISL/Yoda-Scheduler&lt;/p&gt;
&lt;h2 id=&#34;scheduling-framework-è°ƒåº¦æ¡†æ¶&#34;&gt;Scheduling-framework è°ƒåº¦æ¡†æ¶&lt;/h2&gt;
&lt;p&gt;Kubernetes çš„ scheduling-framework è°ƒåº¦æ¡†æ¶ï¼ˆä»¥ä¸‹ç®€ç§°è°ƒåº¦æ¡†æ¶ï¼‰æ˜¯é’ˆå¯¹å½“å‰ kubernetes è°ƒåº¦å™¨çš„å¢å¼ºï¼Œå®ƒä¸åŒäºä¹‹å‰çš„ scheduler-extenderï¼Œç”¨æˆ·å¯ä»¥ç¼–å†™å¤šä¸ªæ’ä»¶ï¼Œè¿™äº›æ’ä»¶å¯ä»¥åœ¨è°ƒåº¦çš„ä¸åŒé˜¶æ®µä½œä¸ºåŸæœ‰è°ƒåº¦å™¨çš„æ‰©å±•ï¼Œå¹¶ä¸”è¿™äº›æ’ä»¶ä¼šå’Œ kubernetes åŸæœ‰çš„è°ƒåº¦å™¨æºä»£ç ä¼šä¸€èµ·ç¼–è¯‘åˆ°è°ƒåº¦ç¨‹åºä¸­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è°ƒåº¦æ¡†æ¶è®¾è®¡ç›®æ ‡&#34;&gt;è°ƒåº¦æ¡†æ¶è®¾è®¡ç›®æ ‡&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å¢å¼º kubernetes åŸæœ‰è°ƒåº¦å™¨çš„å¯æ‰©å±•æ€§ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡å°†è°ƒåº¦ç¨‹åºçš„æŸäº›åŠŸèƒ½ç§»è‡³æ’ä»¶ï¼Œå¯ä»¥ç®€åŒ–è°ƒåº¦ç¨‹åºæ ¸å¿ƒã€‚&lt;/li&gt;
&lt;li&gt;è°ƒåº¦æ¡†æ¶ä¸­å¯è®¾ç½®å¤šä¸ªæ‰©å±•ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;è°ƒåº¦æ¡†æ¶é€šè¿‡æ’ä»¶æœºåˆ¶æ¥æ¥æ”¶æ’ä»¶ç»“æœï¼Œå¹¶æ ¹æ®æ¥æ”¶åˆ°çš„ç»“æœç»§ç»­æˆ–ä¸­æ­¢ã€‚&lt;/li&gt;
&lt;li&gt;æå‡ºä¸€ç§å¤„ç†é”™è¯¯å¹¶å°†å…¶ä¸æ’ä»¶è¿›è¡Œé€šä¿¡çš„æœºåˆ¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;proposal&#34;&gt;Proposal&lt;/h2&gt;
&lt;p&gt;è°ƒåº¦æ¡†æ¶åœ¨ kubernetes è°ƒåº¦å™¨ä¸­å®šä¹‰äº†å¾ˆå¤š Go çš„æ¥å£å’Œ Go APIï¼Œç”¨äºç”¨æˆ·è®¾è®¡æ’ä»¶ä½¿ç”¨ã€‚è¿™äº›ç”¨æˆ·è®¾è®¡çš„æ’ä»¶å°†ä¼šè¢«æ·»åŠ åˆ°è°ƒåº¦ç¨‹åºä¸­ï¼Œå¹¶åœ¨ç¼–è¯‘æ—¶åŒ…å«åœ¨å†…ã€‚å¯ä»¥é€šè¿‡é…ç½®è°ƒåº¦ç¨‹åºçš„ &lt;code&gt;ComponentConfig&lt;/code&gt; å°†å…è®¸å¯ç”¨ã€ç¦ç”¨å’Œé‡æ–°æ’åºæ’ä»¶ã€‚è‡ªå®šä¹‰è°ƒåº¦ç¨‹åºå¯ä»¥â€œ &lt;a href=&#34;https://github.com/kubernetes/enhancements/blob/master/keps/sig-scheduling/20180409-scheduling-framework.md#custom-scheduler-plugins-out-of-tree&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨æ ‘å¤–&lt;/a&gt; â€ç¼–å†™å…¶æ’ä»¶å¹¶ç¼–è¯‘åŒ…å«å…¶è‡ªå·±çš„æ’ä»¶çš„è°ƒåº¦ç¨‹åºäºŒè¿›åˆ¶æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è°ƒåº¦å‘¨æœŸå’Œç»‘å®šå‘¨æœŸ&#34;&gt;è°ƒåº¦å‘¨æœŸå’Œç»‘å®šå‘¨æœŸ&lt;/h2&gt;
&lt;p&gt;è°ƒåº¦å™¨è°ƒåº¦ä¸€ä¸ª Pod çš„è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š&lt;strong&gt;è°ƒåº¦å‘¨æœŸ&lt;/strong&gt;å’Œ&lt;strong&gt;ç»‘å®šå‘¨æœŸ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è°ƒåº¦å‘¨æœŸä¸­ï¼Œè°ƒåº¦å™¨ä¼šä¸º Pod é€‰æ‹©ä¸€ä¸ªæœ€åˆé€‚å®ƒè¿è¡Œçš„èŠ‚ç‚¹ï¼Œç„¶åè°ƒåº¦è¿‡ç¨‹å°†è¿›å…¥ç»‘å®šå‘¨æœŸã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç»‘å®šå‘¨æœŸä¸­ï¼Œè°ƒåº¦å™¨ä¼šæ£€æµ‹è°ƒåº¦å‘¨æœŸä¸­é€‰ä¸­çš„é‚£ä¸ªâ€œæœ€åˆé€‚çš„èŠ‚ç‚¹â€æ˜¯ä¸æ˜¯çœŸçš„å¯ä»¥è®©è¿™ä¸ª Pod ç¨³å®šçš„è¿è¡Œï¼ˆæ¯”å¦‚æ£€æµ‹ PVã€æ£€æµ‹æ˜¯å¦æœ‰ç«¯å£å†²çªç­‰ï¼‰ï¼Œæˆ–è€…éœ€ä¸éœ€è¦åšä¸€äº›åˆå§‹åŒ–æ“ä½œï¼ˆæ¯”å¦‚è®¾ç½®è¿™ä¸ªèŠ‚ç‚¹ä¸Šçš„ FPGA æ¿å­çš„çŠ¶æ€ã€è®¾ç½® GPU æ˜¾å¡çš„é©±åŠ¨ç‰ˆæœ¬ã€CUDA çš„ç‰ˆæœ¬ç­‰ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ‰©å±•ç‚¹&#34;&gt;æ‰©å±•ç‚¹&lt;/h2&gt;
&lt;p&gt;kubernetes è°ƒåº¦æ¡†æ¶åœ¨è°ƒåº¦å‘¨æœŸå’Œç»‘å®šå‘¨æœŸéƒ½ä¸ºæˆ‘ä»¬æä¾›äº†ä¸°å¯Œçš„æ‰©å±•ç‚¹ï¼Œè¿™äº›æ‰©å±•ç‚¹å¯ä»¥â€œæ’ä¸Šâ€æˆ‘ä»¬è‡ªå·±è®¾è®¡çš„è°ƒåº¦æ’ä»¶ï¼Œä¸€ä¸ªæ’ä»¶å¯ä»¥åœ¨å¤šä¸ªæ‰©å±•ç‚¹æ³¨å†Œä»¥æ‰§è¡Œæ›´å¤æ‚æˆ–æœ‰çŠ¶æ€çš„ä»»åŠ¡ï¼Œå®ç°æˆ‘ä»¬æƒ³è¦çš„è°ƒåº¦åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-20200125-scheduling-framework-extensions&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;20200125-scheduling-framework-extensions&#34; srcset=&#34;
               /blog/202003-k8s-scheduling-framework/sche_hu15373290438688126382.webp 400w,
               /blog/202003-k8s-scheduling-framework/sche_hu13761939461238558506.webp 760w,
               /blog/202003-k8s-scheduling-framework/sche_hu4394054418943009060.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/202003-k8s-scheduling-framework/sche_hu15373290438688126382.webp&#34;
               width=&#34;760&#34;
               height=&#34;293&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      20200125-scheduling-framework-extensions
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸‹é¢é˜è¿°ä¸‹å„ä¸ªæ‰©å±•ç‚¹å¯ä»¥å®ç°çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;sort-æ’åº&#34;&gt;Sort æ’åº&lt;/h3&gt;
&lt;p&gt;æ’åºæ‰©å±•ç‚¹ï¼Œç”±äºè°ƒåº¦å™¨æ˜¯æŒ‰ç…§ &lt;code&gt;FIFO&lt;/code&gt; çš„é¡ºåºè°ƒåº¦ Pod çš„ï¼Œå› æ­¤å½“é˜Ÿåˆ—é‡Œå‡ºç°å¤šä¸ªç­‰å¾…è°ƒåº¦çš„ Pod æ—¶ï¼Œå¯ä»¥å¯¹è¿™äº› Pod çš„å…ˆåé¡ºåºè¿›è¡Œæ’åºï¼ŒæŠŠæˆ‘ä»¬æƒ³è¦çš„ Podï¼ˆå¯èƒ½ä¼˜å…ˆçº§æ¯”è¾ƒé«˜ï¼‰å¾€å‡ºé˜Ÿæ–¹å‘ç§»åŠ¨ï¼Œè®©å®ƒå¯ä»¥æ›´å¿«åœ°è¢«è°ƒåº¦ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰çš„ Sort æ‰©å±•ç‚¹åªèƒ½å¯ç”¨ä¸€ä¸ªï¼Œä¸å¯ä»¥å¯ç”¨å¤šä¸ª Sort æ‰©å±•æ’ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹ Sort çš„æ¥å£ï¼Œä»£ç ä½äº kubernetes é¡¹ç›®çš„ &lt;code&gt;/pkg/scheduler/framework/interface.go&lt;/code&gt; ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;QueueSortPlugin&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;Plugin&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Less are used to sort pods in the scheduling queue.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nf&#34;&gt;Less&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PodInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PodInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¹Ÿå°±æ˜¯åªéœ€è¦å®ç° Less æ–¹æ³•å³å¯ï¼Œæ¯”å¦‚å¦‚ä¸‹çš„å®ç°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Less&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;podInfo1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;podInfo2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PodInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;GetPodPriority&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;podInfo1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;GetPodPriority&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;podInfo2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;pre-filter-é¢„è¿‡æ»¤&#34;&gt;Pre-filter é¢„è¿‡æ»¤&lt;/h3&gt;
&lt;p&gt;è¯¥æ‰©å±•ç‚¹ç”¨äºé¢„å¤„ç†æœ‰å…³ Pod çš„ä¿¡æ¯ï¼Œæˆ–æ£€æŸ¥é›†ç¾¤æˆ– Pod å¿…é¡»æ»¡è¶³çš„æŸäº›æ¡ä»¶ã€‚é¢„è¿‡æ»¤å™¨æ’ä»¶åº”å®ç° PreFilter å‡½æ•°ï¼Œå¦‚æœ PreFilter è¿”å›é”™è¯¯ï¼Œåˆ™è°ƒåº¦å‘¨æœŸå°†ä¸­æ­¢ã€‚æ³¨æ„ï¼Œåœ¨æ¯ä¸ªè°ƒåº¦å‘¨æœŸä¸­ï¼Œåªä¼šè°ƒç”¨ä¸€æ¬¡ PreFilterã€‚&lt;/p&gt;
&lt;p&gt;Pre-filter æ’ä»¶å¯ä»¥é€‰æ‹©å®ç° &lt;code&gt;PreFilterExtensions&lt;/code&gt; æ¥å£ï¼Œè¿™ä¸ªæ¥å£å®šä¹‰äº† &lt;strong&gt;AddPod&lt;/strong&gt; å’Œ &lt;strong&gt;RemovePod&lt;/strong&gt; æ–¹æ³•ä»¥å¢é‡æ–¹å¼ä¿®æ”¹å…¶é¢„å¤„ç†ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PreFilterPlugin&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;Plugin&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nf&#34;&gt;PreFilter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CycleState&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Status&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nf&#34;&gt;PreFilterExtensions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PreFilterExtensions&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œçš„ CycleStateï¼Œè¡¨ç¤ºè°ƒåº¦çš„ä¸Šä¸‹æ–‡ï¼Œå…¶å®æ˜¯ä¸€ä¸ª map çš„å°è£…ï¼Œç»“æ„ä½“å†…éƒ¨é€šè¿‡è¯»å†™é”å®ç°äº†å¹¶å‘å®‰å…¨ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡ CycleState æ¥å®ç°å¤šä¸ªè°ƒåº¦æ’ä»¶ç›´æ¥çš„æ•°æ®ä¼ é€’ï¼Œä¹Ÿå°±æ˜¯å¤šä¸ªæ’ä»¶å¯ä»¥å…±äº«çŠ¶æ€æˆ–é€šè¿‡æ­¤æœºåˆ¶è¿›è¡Œé€šä¿¡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CycleState&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;mx&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RWMutex&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;storage&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;StateKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;StateData&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;recordFrameworkMetrics&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// è¯¥å€¼ä¸º true, åˆ™è°ƒåº¦æ¡†æ¶ä¼šè®°å½•æ­¤æ¬¡è°ƒåº¦å‘¨æœŸçš„æ•°æ®
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œçš„ StateKey æ˜¯ string ç±»å‹ï¼ŒStateData æ˜¯ä¸€ä¸ªæ¥å£ç±»å‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;StateData&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Clone is an interface to make a copy of StateData. For performance reasons,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// clone should make shallow copies for members (e.g., slices or maps) that are not
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// impacted by PreFilter&amp;#39;s optional AddPod/RemovePod methods.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nf&#34;&gt;Clone&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;StateData&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥åšä¸€ä¸ªç®€å•çš„æ¥å£å®ç°ï¼Œæ¥å®ç° StateDataï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Data&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;Value&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Clone&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;StateData&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‚£ä¹ˆå½“æ’ä»¶åœ¨è¯¥æ‰©å±•ç‚¹æƒ³ä¼ é€’æ•°æ®æ—¶å°±å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ç±»ä¼¼çš„ä»£ç å®ç°æ•°æ®çš„ä¼ é€’ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;Max&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;StateKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Max&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Max&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;filter-è¿‡æ»¤&#34;&gt;Filter è¿‡æ»¤&lt;/h3&gt;
&lt;p&gt;ç”¨äºè¿‡æ»¤ä¸èƒ½æ»¡è¶³å½“å‰è¢«è°ƒåº¦ Pod è¿è¡Œéœ€æ±‚çš„èŠ‚ç‚¹ã€‚å¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œè°ƒåº¦ç¨‹åºå°†æŒ‰é…ç½®çš„é¡ºåºè°ƒç”¨è¯¥ç±»æ’ä»¶ã€‚å¦‚æœæœ‰ä»»ä½•è¿‡æ»¤å™¨æ’ä»¶å°†èŠ‚ç‚¹æ ‡è®°ä¸ºä¸å¯è¡Œï¼Œåˆ™ä¸ä¼šä¸ºè¯¥èŠ‚ç‚¹è°ƒç”¨å…¶ä½™æ’ä»¶ã€‚å¯ä»¥åŒæ—¶è¯„ä¼°èŠ‚ç‚¹ï¼Œå¹¶ä¸”åœ¨åŒä¸€è°ƒåº¦å‘¨æœŸä¸­å¯ä»¥å¤šæ¬¡è°ƒç”¨ Filter æ’ä»¶ã€‚è¿™å—å…¶å®æ˜¯è°ƒåº¦å™¨ä¼šå¯åŠ¨å¤šä¸ª go åç¨‹ä»¥å®ç°å¯¹å¤šä¸ªèŠ‚ç‚¹å¹¶å‘è°ƒç”¨ filterï¼Œæ¥æé«˜è¿‡æ»¤æ•ˆç‡ã€‚è¿‡æ»¤æ’ä»¶å…¶å®ç±»ä¼¼äºä¸Šä¸€ä»£ Kubernetes è°ƒåº¦å™¨ä¸­çš„é¢„é€‰ç¯èŠ‚ï¼Œå³ Predicatesã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çœ‹ä¸‹æ¥å£å®šä¹‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;FilterPlugin&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;Plugin&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nf&#34;&gt;Filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CycleState&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nodeInfo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;schedulernodeinfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NodeInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Status&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥å¯¹åº”çš„å®ç°ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œéœ€è¦åš GPU çš„è°ƒåº¦ï¼Œæˆ‘éœ€è¦æ£€æŸ¥æ¯ä¸ªèŠ‚ç‚¹çš„ GPU æ˜¯å¦æ»¡è¶³ Pod çš„è¿è¡Œè¦æ±‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;y&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Yoda&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CycleState&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nodeinfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NodeInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Status&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;filter pod: %v, node: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// æ£€æŸ¥èŠ‚ç‚¹ GPU çš„å¥åº·çŠ¶æ€
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;msg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;CheckGPUHealth&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ok&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// èŠ‚ç‚¹çš„ GPU æ˜¯å¦ç¬¦åˆ Pod è¿è¡Œç­‰çº§
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;PodFitsLevel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewStatus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Unschedulable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Node:&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34; GPU Level Not Fit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// èŠ‚ç‚¹çš„ GPU æ˜¾å­˜æ˜¯å¦ç¬¦åˆ Pod è¿è¡Œ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;PodFitsMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewStatus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Unschedulable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Node:&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34; GPU Memory Not Fit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// èŠ‚ç‚¹çš„ GPU æ•°é‡æ˜¯å¦ç¬¦åˆ Pod è¿è¡Œ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;PodFitsNumber&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewStatus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Unschedulable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Node:&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34; GPU Number Not Fit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewStatus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Success&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewStatus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Unschedulable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Node:&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;pre-score-é¢„æ‰“åˆ†-v1alpha1-ç‰ˆæœ¬ç§°ä¸º-post-filter&#34;&gt;Pre-Score é¢„æ‰“åˆ† (v1alpha1 ç‰ˆæœ¬ç§°ä¸º Post-Filter)&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„ï¼š&lt;code&gt;Pre-Score&lt;/code&gt; ä» v1alpha2 å¼€å§‹å¯ç”¨ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¯¥æ‰©å±•ç‚¹å°†ä½¿ç”¨&lt;strong&gt;é€šè¿‡ Filter é˜¶æ®µçš„èŠ‚ç‚¹åˆ—è¡¨&lt;/strong&gt;æ¥è°ƒç”¨æ’ä»¶ã€‚æ’ä»¶å¯ä»¥ä½¿ç”¨æ­¤æ•°æ®æ¥æ›´æ–°å†…éƒ¨çŠ¶æ€æˆ–ç”Ÿæˆæ—¥å¿—ã€æŒ‡æ ‡ã€‚æ¯”å¦‚å¯ä»¥é€šè¿‡è¯¥æ‰©å±•ç‚¹æ”¶é›†å„ä¸ªèŠ‚ç‚¹ä¸­æ€§èƒ½æŒ‡æ ‡ï¼Œæ‰€æœ‰èŠ‚ç‚¹ä¸­æœ€å¤§çš„å†…å­˜çš„èŠ‚ç‚¹ï¼Œæ€§èƒ½æœ€å¥½çš„ CPU èŠ‚ç‚¹ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ç»§ç»­æ¥çœ‹æ¥å£é‡Œé•¿ä»€ä¹ˆæ ·å­ï¼ˆæˆ‘è¿™é‡Œæ˜¯ v1alpha1ï¼‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PostFilterPlugin&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;Plugin&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nf&#34;&gt;PostFilter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CycleState&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nodes&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;filteredNodesStatuses&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NodeToStatusMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Status&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é’ˆå¯¹è¿™ä¸ªæ‰©å±•ç‚¹ï¼Œé€šè¿‡ä¼ é€’çš„å‚æ•°å¯ä»¥çœ‹å‡ºï¼Œæ¥å£ä¼ å…¥äº†èŠ‚ç‚¹çš„åˆ‡ç‰‡ï¼Œå› æ­¤å¼€å‘è€…å¯ä»¥é€šè¿‡å¯åŠ¨å¤šä¸ªå¹¶å‘åç¨‹æ¥è·å–æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥æŠŠè¿™äº›æ•°æ®å­˜åœ¨ CycleState ä¸­ï¼Œç»™ä¹‹åçš„æ’ä»¶æ‰©å±•ç‚¹ä½¿ç”¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;y&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Yoda&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;PostFilter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CycleState&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nodes&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;filteredNodesStatuses&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NodeToStatusMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Status&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;collect info for scheduling  pod: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;collection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ParallelCollection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;collection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Workers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nodes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;filteredNodesStatuses&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¹¶å‘è¿™å—æˆ‘ä»¬ä¹Ÿå¯ä»¥å‚è€ƒ 1.13 è°ƒåº¦å™¨ä¸­ç»å¸¸ä½¿ç”¨çš„ç»å…¸å¹¶å‘æ¨¡å‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ParallelCollection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;workers&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CycleState&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nodes&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;filteredNodesStatuses&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NodeToStatusMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Status&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;stop&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;mx&lt;/span&gt;   &lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RWMutex&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;msg&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// æ•°æ®å­˜å…¥ç®¡é“
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;pieces&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;toProcess&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pieces&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Sum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;toProcess&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nb&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;toProcess&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// å¹¶å‘åç¨‹æ•°é™åˆ¶
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pieces&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;workers&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;workers&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pieces&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;WaitGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;workers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;workers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;c1&#34;&gt;// åç¨‹æ¶ˆè´¹ç®¡é“æ•°æ®
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;			&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;toProcess&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;c1&#34;&gt;// state å¹¶å‘å®‰å…¨ï¼Œè°ƒç”¨çš„æ—¶å€™å¯ä»¥ä¸ç”¨åŠ é”
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;					&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;re&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;CollectMaxValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nodes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;filteredNodesStatuses&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;re&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;IsSuccess&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;						&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;re&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Message&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;						&lt;span class=&#34;nx&#34;&gt;mx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;c1&#34;&gt;// message éå¹¶å‘å®‰å…¨ï¼ŒåŠ é”
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;						&lt;span class=&#34;nx&#34;&gt;msg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;re&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Message&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;						&lt;span class=&#34;nx&#34;&gt;mx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Done&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;}()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;msg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewStatus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewStatus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Success&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;score-æ‰“åˆ†&#34;&gt;Score æ‰“åˆ†&lt;/h3&gt;
&lt;p&gt;Score æ‰©å±•ç‚¹å’Œä¸Šä¸€ä»£çš„è°ƒåº¦å™¨çš„ä¼˜é€‰æµç¨‹å¾ˆåƒï¼Œå®ƒåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç¬¬ä¸€é˜¶æ®µç§°ä¸ºâ€œæ‰“åˆ†â€ï¼Œç”¨äºå¯¹å·²é€šè¿‡è¿‡æ»¤é˜¶æ®µçš„èŠ‚ç‚¹è¿›è¡Œæ’åã€‚è°ƒåº¦ç¨‹åºå°†ä¸º &lt;code&gt;Score&lt;/code&gt; æ¯ä¸ªèŠ‚ç‚¹è°ƒç”¨æ¯ä¸ªè®¡åˆ†æ’ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒé˜¶æ®µæ˜¯â€œå½’ä¸€åŒ–â€ï¼Œç”¨äºåœ¨è°ƒåº¦ç¨‹åºè®¡ç®—èŠ‚ç‚¹çš„æœ€ç»ˆæ’åä¹‹å‰ä¿®æ”¹åˆ†æ•°ï¼Œå¯ä»¥ä¸å®ç°ï¼Œä½†æ˜¯éœ€è¦ä¿è¯ Score æ’ä»¶çš„è¾“å‡ºå¿…é¡»æ˜¯ &lt;strong&gt;[MinNodeScoreï¼ŒMaxNodeScore]&lt;/strong&gt;ï¼ˆ&lt;code&gt;[0-100]&lt;/code&gt;ï¼‰èŒƒå›´å†…çš„æ•´æ•°ã€‚å¦‚æœä¸æ˜¯ï¼Œåˆ™è°ƒåº¦å™¨ä¼šæŠ¥é”™ï¼Œä½ éœ€è¦å®ç° NormalizeScore æ¥ä¿è¯æœ€åçš„å¾—åˆ†èŒƒå›´ã€‚å¦‚æœä¸å®ç° NormalizeScoreï¼Œåˆ™ Score çš„è¾“å‡ºå¿…é¡»åœ¨æ­¤èŒƒå›´å†…ã€‚è°ƒåº¦ç¨‹åºå°†æ ¹æ®é…ç½®çš„æ’ä»¶æƒé‡åˆå¹¶æ‰€æœ‰æ’ä»¶çš„èŠ‚ç‚¹åˆ†æ•°ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;çœ‹çœ‹æ¥å£çš„å®šä¹‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ScorePlugin&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;Plugin&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Score is called on each filtered node. It must return success and an integer
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// indicating the rank of the node. All scoring plugins must return success or
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// the pod will be rejected.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nf&#34;&gt;Score&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CycleState&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nodeName&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// ScoreExtensions returns a ScoreExtensions interface if it implements one, or nil if does not.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nf&#34;&gt;ScoreExtensions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ScoreExtensions&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬ä¹Ÿå¯ä»¥åšå¦‚ä¸‹ç®€å•çš„å®ç°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;y&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Yoda&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Score&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CycleState&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nodeName&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;nodeInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;SnapshotSharedLister&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NodeInfos&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nodeName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewStatus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sprintf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;getting node %q from Snapshot: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nodeName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;score&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Score&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nodeInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewStatus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sprintf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Score Node Error: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;node : %v yoda-score: %v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nodeName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewStatus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Success&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæœ€åçš„åˆ†æ•°ä¸åœ¨èŒƒå›´å†…ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å®ç° NormalizeScore å‡½æ•°åšè¿›ä¸€æ­¥å¤„ç†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;y&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Yoda&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NormalizeScore&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CycleState&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scores&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NodeScoreList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Status&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;highest&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// å½’ä¸€åŒ– 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nodeScore&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scores&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;scores&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Score&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nodeScore&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Score&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MaxNodeScore&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;highest&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewStatus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Success&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;reserve-ä¿ç•™&#34;&gt;Reserve ä¿ç•™&lt;/h3&gt;
&lt;p&gt;ä¸ºç»™å®šçš„ Pod ä¿ç•™èŠ‚ç‚¹ä¸Šçš„èµ„æºæ—¶ï¼Œç»´æŠ¤è¿è¡Œæ—¶çŠ¶æ€çš„æ’ä»¶å¯ä»¥åº”å®ç°æ­¤æ‰©å±•ç‚¹ï¼Œä»¥ç”±è°ƒåº¦ç¨‹åºé€šçŸ¥ã€‚è¿™æ˜¯åœ¨è°ƒåº¦ç¨‹åºå®é™…å°† Pod ç»‘å®šåˆ° Node ä¹‹å‰å‘ç”Ÿçš„ï¼Œå®ƒçš„å­˜åœ¨æ˜¯ä¸ºäº†é˜²æ­¢åœ¨è°ƒåº¦ç¨‹åºç­‰å¾…ç»‘å®šæˆåŠŸæ—¶å‘ç”Ÿäº‰ç”¨æƒ…å†µã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ReservePlugin&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;Plugin&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Reserve is called by the scheduling framework when the scheduler cache is
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// updated.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nf&#34;&gt;Reserve&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CycleState&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nodeName&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Status&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œå’Œä¸Šé¢çš„ Score ç±»ä¼¼ï¼Œå‡½æ•°å¹¶æ²¡æœ‰æä¾› nodeInfo æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨ &lt;code&gt;handle.SnapshotSharedLister&lt;/code&gt; æ¥è·å–èŠ‚ç‚¹çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;nodeInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;SnapshotSharedLister&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NodeInfos&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nodeName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‚£ä¹ˆä»¥ä¸Šå°±æ˜¯è°ƒåº¦å‘¨æœŸçš„æ’ä»¶ä¸å®ç°ï¼Œå…¶å®ç»‘å®šå‘¨æœŸçš„æ’ä»¶å®ç°å’Œä¸Šè¿°çš„æ–¹æ³•ä¹Ÿéƒ½ç±»ä¼¼ï¼Œå®ç°ç›¸å…³çš„å‡½æ•°å³å¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ’ä»¶æ³¨å†Œ&#34;&gt;æ’ä»¶æ³¨å†Œ&lt;/h2&gt;
&lt;p&gt;æ¯ä¸ªæ’ä»¶å¿…é¡»å®šä¹‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°ç¡¬ç¼–ç çš„æ³¨å†Œè¡¨ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PluginFactory&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Unknown&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;FrameworkHandle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Plugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Registry&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PluginFactory&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewRegistry&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Registry&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Registry&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;fooplugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fooplugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;New&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;barplugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;barplugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;New&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;c1&#34;&gt;// New plugins are registered here.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‚£ä¹ˆåœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ä¼šå°†æˆ‘ä»¬çš„æ’ä»¶å’Œè°ƒåº¦æºç ä¸€èµ·ç¼–è¯‘æˆæˆ‘ä»¬çš„è‡ªå®šä¹‰è°ƒåº¦å™¨ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å£°æ˜æ’ä»¶çš„æ—¶å€™ä¹Ÿéœ€è¦å®ç°æ„é€ å‡½æ•°å’Œå¯¹åº”çš„æ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Yoda&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;args&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Args&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;handle&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;FrameworkHandle&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;y&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Yoda&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;New&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;configuration&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Unknown&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;FrameworkHandle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Plugin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;args&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;DecodeInto&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;configuration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;klog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Infof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;get plugin config args: %+v&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Yoda&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;   &lt;span class=&#34;nx&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¼–è¯‘å°æŠ€å·§&#34;&gt;ç¼–è¯‘å°æŠ€å·§&lt;/h2&gt;
&lt;p&gt;ç”±äºæœ€ç»ˆçš„è°ƒåº¦å™¨è¿˜æ˜¯ä»¥å®¹å™¨çš„æ–¹å¼è¿è¡Œçš„ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ª &lt;code&gt;Makefile&lt;/code&gt; æ¥ç®€åŒ–ç¼–è¯‘æµç¨‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-makefile&#34; data-lang=&#34;makefile&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;all&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;local&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;local&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nv&#34;&gt;GOOS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;linux &lt;span class=&#34;nv&#34;&gt;GOARCH&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;amd64 go build  -o&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;my-scheduler ./cmd/scheduler
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;build&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	sudo docker build --no-cache . -t registry.cn-hangzhou.aliyuncs.com/my/scheduler
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;push&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	sudo docker push registry.cn-hangzhou.aliyuncs.com/my/scheduler
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;format&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	sudo gofmt -l -w .
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;clean&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	sudo rm -f my-scheduler
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¼–å†™è°ƒåº¦å™¨çš„ Dockerfileï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;FROM&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;debian&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stretch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;slim&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;WORKDIR&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;COPY&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;my&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;scheduler&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;usr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;local&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bin&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;CMD&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;my-scheduler&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‚£ä¹ˆç¼–è¯‘ -&amp;gt; æ„å»ºå°±å¯ä»¥ä¸‰æ­¥èµ°äº†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¼–è¯‘&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;make &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;æ„å»ºé•œåƒ&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;make build
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;ä¸Šä¼ é•œåƒ&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;make push
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;è‡ªå®šä¹‰è°ƒåº¦å™¨çš„é…ç½®&#34;&gt;è‡ªå®šä¹‰è°ƒåº¦å™¨çš„é…ç½®&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆéœ€è¦è®¾ç½®ä¸€ä¸ª ConfigMapï¼Œç”¨äºå­˜æ”¾è°ƒåº¦å™¨çš„é…ç½®æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ConfigMap&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scheduler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kube&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;system&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;scheduler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;yaml&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kubescheduler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;k8s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;io&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1alpha1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;KubeSchedulerConfiguration&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;schedulerName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;yoda&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;scheduler&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;leaderElection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;leaderElect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;lockObjectName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;yoda&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;scheduler&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;lockObjectNamespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kube&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;system&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;plugins&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;queueSort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;enabled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;yoda&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;enabled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;yoda&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;score&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;enabled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;yoda&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;postFilter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;enabled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;yoda&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;pluginConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;yoda&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;master&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;master&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;kubeconfig&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;kubeconfig&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œä¸»è¦éœ€è¦ä¿®æ”¹çš„å°±æ˜¯ schedulerName å­—æ®µçš„è°ƒåº¦å™¨åç§°å’Œ plugins å­—æ®µä¸­å„ä¸ªæ‰©å±•ç‚¹çš„æ’ä»¶åç§°ï¼Œenable æ‰èƒ½ä¿è¯è¯¥æ‰©å±•ç‚¹è¿è¡Œäº†ä½ çš„æ’ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ç€ä¸ºè°ƒåº¦å™¨åˆ›å»º RBACï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ClusterRole&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbac&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;authorization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;k8s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;io&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;yoda&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;endpoints&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;events&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;create&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;get&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;update&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;resourceNames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;yoda&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;scheduler&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;endpoints&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;delete&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;get&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;patch&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;update&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nodes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;get&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;watch&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pods&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;delete&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;get&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;watch&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;update&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bindings&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pods&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;binding&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;create&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pods&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;status&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;patch&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;update&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;replicationcontrollers&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;services&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;get&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;watch&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;apps&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;extensions&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;replicasets&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;get&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;watch&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;apps&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statefulsets&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;get&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;watch&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;policy&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;poddisruptionbudgets&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;get&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;watch&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;persistentvolumeclaims&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;persistentvolumes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;get&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;watch&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;configmaps&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;get&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;watch&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;storage.k8s.io&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;storageclasses&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;csinodes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;watch&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;get&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;coordination.k8s.io&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;leases&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;create&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;get&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;update&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;events.k8s.io&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;events&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;create&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;patch&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;update&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ServiceAccount&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;yoda&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sa&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kube&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;system&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ClusterRoleBinding&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbac&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;authorization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;k8s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;io&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;yoda&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;crb&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kube&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;system&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;roleRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;apiGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rbac&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;authorization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;k8s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;io&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ClusterRole&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;yoda&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;subjects&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ServiceAccount&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;yoda&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sa&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kube&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;system&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€åé…ç½®è°ƒåº¦å™¨çš„ Deploymentï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;apps&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Deployment&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;yoda&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;scheduler&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;kube&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;system&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;component&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;yoda&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;scheduler&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;component&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;yoda&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;scheduler&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;component&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;yoda&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;scheduler&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;serviceAccount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;yoda&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;sa&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;priorityClassName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;system&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;critical&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scheduler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nx&#34;&gt;configMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scheduler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nx&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;yoda&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;scheduler&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nx&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;registry&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cn&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hangzhou&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;aliyuncs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;geekcloud&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;yoda&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;scheduler&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nx&#34;&gt;imagePullPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Always&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nx&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;yoda&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;scheduler&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;--&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;scheduler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;scheduler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;yaml&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;--&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nx&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;requests&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nx&#34;&gt;cpu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;50m&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nx&#34;&gt;volumeMounts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;scheduler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;config&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;nx&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;scheduler&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éšç€äº‘è®¡ç®—æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼Œkubernetes scheduler ä¹Ÿåœ¨æ ¹æ®å„ç§å¤æ‚çš„éœ€æ±‚ä¸æ–­è¿›åŒ–ï¼Œæœªæ¥ä¹Ÿä¼šæ¶Œç°æ›´å¤šå„ç§å„æ ·çš„ä¸°å¯Œçš„ã€æ”¯æŒä¸åŒåŠŸèƒ½çš„è°ƒåº¦å™¨åœ¨ä¸åŒçš„ç”Ÿäº§ç¯å¢ƒä¸­å‘æŒ¥ç€æ›´å¤šå¼ºåŠ²çš„ä½œç”¨ï¼Œä¸€èµ·æœŸå¾…å§ï¼&lt;/p&gt;
&lt;h2 id=&#34;ä½œè€…ä»‹ç»&#34;&gt;ä½œè€…ä»‹ç»&lt;/h2&gt;
&lt;p&gt;æä¿Šæ±Ÿ&lt;/p&gt;
&lt;p&gt;kubernetes &amp;amp; istio member&lt;/p&gt;
&lt;p&gt;å—äº¬é‚®ç”µå¤§å­¦ç‰©è”ç½‘å­¦é™¢ç ”ç©¶ç”Ÿï¼Œçƒ­è¡·äº Kubernetes ä¸äº‘åŸç”Ÿç›¸å…³æŠ€æœ¯ã€‚&lt;/p&gt;
&lt;p&gt;å¾®ä¿¡ï¼šFUNKY-STARS æ¬¢è¿äº¤æµï¼&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/enhancements/blob/master/keps/sig-scheduling/20180409-scheduling-framework.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Scheduling Framework&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/enhancements/issues/624&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;enhancements/624&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/angao/scheduler-framework-sample&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;scheduler-framework-sample&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/daniel-hutao/k8s-source-code-analysis&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes 1.13 æºç åˆ†æ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;è‡´è°¢&#34;&gt;è‡´è°¢&lt;/h3&gt;
&lt;p&gt;æ„Ÿè°¢ Scheduler-SIG Leader HuangWei å¤§ä½¬åœ¨ kubecon 2018 çš„ Q&amp;amp;A å’ŒæŒ‡å¯¼ï¼&lt;/p&gt;
&lt;p&gt;æ„Ÿè°¢å¼ ç£Šã€è½¦æ¼¾å¤§ä½¬åœ¨ kubecon 2018 çš„åˆ†äº«å’Œè®¨è®ºï¼&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes å‚ç›´è‡ªåŠ¨ä¼¸ç¼©èµ°å‘ä½•æ–¹ï¼Ÿ</title>
      <link>https://cloudnativecn.com/blog/kubernetes-vertical-pod-autoscaler/</link>
      <pubDate>Sun, 10 Nov 2019 15:15:43 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/kubernetes-vertical-pod-autoscaler/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://github.com/kubernetes/community/blob/master/contributors/design-proposals/autoscaling/vertical-pod-autoscaler.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¼–è€…æŒ‰&#34;&gt;ç¼–è€…æŒ‰&lt;/h2&gt;
&lt;p&gt;ç›®å‰ Kubernetes çš„ Pod æ°´å¹³è‡ªåŠ¨ä¼¸ç¼©ï¼ˆHPAï¼ŒHorizontal Pod Autoscalerï¼‰å·²åœ¨ä¸šç•Œå¹¿æ³›åº”ç”¨ã€‚ä½†å¯¹ä¸€äº›ç‰¹æ®Šçš„ Podï¼ˆå¦‚ä¸€äº›æœ‰çŠ¶æ€çš„ Podï¼‰ï¼ŒHPA å¹¶ä¸èƒ½å¾ˆå¥½åœ°è§£å†³èµ„æºä¸è¶³çš„é—®é¢˜ã€‚è¿™å°±å¼•å‡º Pod å‚ç›´è‡ªåŠ¨ä¼¸ç¼©ï¼ˆVPAï¼ŒVertical Pod Autoscalerï¼‰ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç» Kubernetes ç¤¾åŒºå¯¹ Pod å‚ç›´è‡ªåŠ¨ä¼¸ç¼©ç»„ä»¶çš„å¼€å‘è§„åˆ’ã€‚&lt;/p&gt;
&lt;h2 id=&#34;vpa-å®šä¹‰&#34;&gt;VPA å®šä¹‰&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;å‚ç›´è‡ªåŠ¨ä¼¸ç¼©ï¼ˆVPAï¼ŒVertical Pod Autoscalerï¼‰&lt;/strong&gt; æ˜¯ä¸€ä¸ªåŸºäºå†å²æ•°æ®ã€é›†ç¾¤å¯ä½¿ç”¨èµ„æºæ•°é‡å’Œå®æ—¶çš„äº‹ä»¶ï¼ˆå¦‚ OMMï¼Œå³ out of memoryï¼‰æ¥è‡ªåŠ¨è®¾ç½® Pod æ‰€éœ€èµ„æºå¹¶ä¸”èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶è‡ªåŠ¨è°ƒæ•´èµ„æºåŸºç¡€æœåŠ¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»‹ç»&#34;&gt;ä»‹ç»&lt;/h2&gt;
&lt;h3 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è®¡ç®—èµ„æº&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/community/blob/master/contributors/design-proposals/node/resource-qos.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;èµ„æºæœåŠ¡è´¨é‡&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å‡†å…¥æ§åˆ¶å™¨&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#external-admission-webhooks&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å¤–éƒ¨å‡†å…¥ webhooks&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç›®æ ‡&#34;&gt;ç›®æ ‡&lt;/h3&gt;
&lt;p&gt;VPA æœ‰ä¸¤ä¸ªç›®æ ‡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡è‡ªåŠ¨é…ç½®èµ„æºè¯·æ±‚æ¥å‡å°‘è¿ç»´æˆæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨æé«˜é›†ç¾¤èµ„æºåˆ©ç”¨ç‡çš„åŒæ—¶æœ€å°åŒ–å®¹å™¨å‡ºç°å†…å­˜æº¢å‡ºæˆ– CPU é¥¥é¥¿çš„é£é™©ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç›¸å…³ç‰¹æ€§&#34;&gt;ç›¸å…³ç‰¹æ€§&lt;/h3&gt;
&lt;h4 id=&#34;æ°´å¹³è‡ªåŠ¨ä¼¸ç¼©horizontal-pod-autoscalerhpa&#34;&gt;æ°´å¹³è‡ªåŠ¨ä¼¸ç¼©ï¼ˆHorizontal Pod Autoscalerï¼ŒHPAï¼‰&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HPA&lt;/a&gt; æ˜¯åŸºäºå®æ—¶çš„ CPU åˆ©ç”¨ç‡æˆ–è€…å…¶ä»–çš„ä¸€äº›ç‰¹å®šä¿¡å·åŠ¨æ€è°ƒæ•´ Replication controller ä¸­ Pod æ•°é‡çš„åŸºç¡€æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;é€šå¸¸ç”¨æˆ·åœ¨æ— çŠ¶æ€çš„å·¥ä½œè´Ÿè½½æ—¶é€‰ç”¨ HPAï¼Œåœ¨æœ‰çŠ¶æ€çš„å·¥ä½œè´Ÿè½½æ—¶é€‰ç”¨ VPAã€‚ä¹Ÿæœ‰ä¸€äº›åœºæ™¯ä¸‹ä¼šæ··åˆä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h4 id=&#34;é›†ç¾¤è‡ªåŠ¨ä¼¸ç¼©cluster-autoscaler&#34;&gt;é›†ç¾¤è‡ªåŠ¨ä¼¸ç¼©ï¼ˆCluster Autoscalerï¼‰&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é›†ç¾¤è‡ªåŠ¨ä¼¸ç¼©&lt;/a&gt;åŸºäºé›†ç¾¤æ•´ä½“çš„èµ„æºåˆ©ç”¨ç‡åŠ¨æ€è°ƒæ•´ Kubernetes é›†ç¾¤çš„å¤§å°ã€‚&lt;/p&gt;
&lt;p&gt;é›†ç¾¤è‡ªåŠ¨ä¼¸ç¼©ã€HPA å’Œ VPA æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„è‡ªåŠ¨ä¼¸ç¼©è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h4 id=&#34;åˆå§‹èµ„æºinitial-resources&#34;&gt;åˆå§‹èµ„æºï¼ˆInitial resourcesï¼‰&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/kgrygiel/community/blob/master/contributors/design-proposals/initial-resources.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åˆå§‹èµ„æº&lt;/a&gt;åŸºäºå†å²èµ„æºåˆ©ç”¨ç‡æä¾›åˆå§‹èµ„æºè¯·æ±‚ï¼Œå®ƒä»…ä»…åœ¨ Pod åˆ›å»ºæ—¶è§¦å‘ï¼ŒVPA æ‰“ç®—ç»§æ‰¿ä½¿ç”¨è¿™ä¸ªç‰¹æ€§ã€‚&lt;/p&gt;
&lt;h4 id=&#34;åŸåœ°å‡çº§in-place-updates&#34;&gt;åŸåœ°å‡çº§ï¼ˆIn-place updatesï¼‰&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/kubernetes/kubernetes/issues/5774&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŸåœ°å‡çº§&lt;/a&gt;æ˜¯ä¸€ä¸ªè®¡åˆ’ä¸­çš„åŠŸèƒ½ï¼Œåœ¨èŠ‚ç‚¹ä¸Šæœ‰è¶³å¤Ÿèµ„æºçš„æƒ…å†µä¸‹ï¼ŒåŸåœ°å‡çº§æ— éœ€æ€æ­»å®¹å™¨å°±èƒ½å¤Ÿè°ƒæ•´å·²å­˜åœ¨å®¹å™¨çš„èµ„æºçš„è¯·æ±‚å’Œé™åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;VPA å°†ä»è¿™ç§èƒ½åŠ›ä¸­å—ç›ŠåŒªæµ…ï¼Œä½†å®ƒä¸è¢«è§†ä¸ºæœ€å°å¯è¡Œäº§å“ ( Minimum Viable Product, MVP) çš„é˜»æŒ¡è€…ã€‚&lt;/p&gt;
&lt;h4 id=&#34;èµ„æºä¼°è®¡resource-estimation&#34;&gt;èµ„æºä¼°è®¡ï¼ˆResource estimationï¼‰&lt;/h4&gt;
&lt;p&gt;èµ„æºä¼°è®¡æ˜¯å¦å¤–ä¸€ä¸ªè®¡åˆ’ä¸­çš„åŠŸèƒ½ï¼Œå®ƒå¯ä»¥é€šè¿‡æš‚æ—¶å›æ”¶è¿è¡Œä¸­å®¹å™¨çš„æš‚æœªä½¿ç”¨çš„èµ„æºæ¥æé«˜èµ„æºåˆ©ç”¨ç‡ã€‚&lt;/p&gt;
&lt;p&gt;èµ„æºä¼°è®¡ä¸ VPA çš„ä¸åŒåœ¨äºå®ƒåŸºäºçš„æ—¶é—´è¡¨æ¯”è¾ƒçŸ­ï¼ˆä»…åŸºäºæœ¬åœ°çš„çŸ­æœŸçš„å†å²æ•°æ®ï¼‰ï¼Œå›æ”¶ä»¥åå†æä¾›çš„è´¨é‡ä½ï¼Œä¸æä¾›åˆå§‹èµ„æºé¢„æµ‹ã€‚VPA å’Œèµ„æºä¼°è®¡æ˜¯äº’è¡¥çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;éœ€æ±‚&#34;&gt;éœ€æ±‚&lt;/h2&gt;
&lt;h3 id=&#34;åŠŸèƒ½&#34;&gt;åŠŸèƒ½&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;VPA èƒ½å¤Ÿåœ¨ Pod æäº¤æ—¶è®¾ç½®å®¹å™¨çš„èµ„æºï¼ˆCPU å’Œå†…å­˜çš„è¯·æ±‚å’Œé™åˆ¶ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;VPA èƒ½å¤Ÿè°ƒæ•´å·²å­˜åœ¨çš„ Pod çš„å®¹å™¨èµ„æºï¼Œç‰¹åˆ«æ˜¯èƒ½å¤Ÿå¯¹ CPU é¥¥é¥¿å’Œå†…å­˜æº¢å‡ºç­‰äº‹ä»¶ä½œå‡ºå“åº”ã€‚&lt;/li&gt;
&lt;li&gt;å½“ VPA é‡å¯ Pod æ—¶ï¼Œå®ƒå¿…é¡»è€ƒè™‘ä¸­æ–­æœåŠ¡çš„æˆæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·èƒ½å¤Ÿé…ç½® VPA çš„åœ¨èµ„æºä¸Šçš„å›ºå®šé™åˆ¶ï¼Œç‰¹åˆ«æ˜¯æœ€å°å’Œæœ€å¤§èµ„æºè¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;VPA è¦ä¸ Pod æ§åˆ¶å™¨å…¼å®¹ï¼Œæœ€èµ·ç è¦ä¸ &lt;code&gt;Deployment&lt;/code&gt; å…¼å®¹ã€‚ç‰¹åˆ«åœ°ï¼š
&lt;ul&gt;
&lt;li&gt;èµ„æºæ›´æ–°çš„æ—¶å€™ä¸èƒ½å¹²æ‰° &lt;code&gt;spec&lt;/code&gt; æ›´æ–°æˆ–å’Œ &lt;code&gt;spec&lt;/code&gt; æ›´æ–°å†²çªã€‚&lt;/li&gt;
&lt;li&gt;åœ¨å·²æœ‰çš„éƒ¨ç½²ä¸­ï¼Œèƒ½å¤Ÿæ»šåŠ¨æ›´æ–° VPA çš„ç­–ç•¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åœ¨åˆ›å»º Pod æ—¶èƒ½å¤Ÿå°½å¿«å¼€å§‹éµå¾ª VPA ç­–ç•¥ï¼Œç‰¹åˆ«æ˜¯å¯¹äºä¸€äº›åªæœ‰ VPA ç­–ç•¥åº”ç”¨ä»¥åæ‰èƒ½è¢«è°ƒåº¦çš„ Podã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å¯ç”¨æ€§&#34;&gt;å¯ç”¨æ€§&lt;/h3&gt;
&lt;p&gt;é‡é‡çº§çš„ç»„ä»¶ï¼ˆæ•°æ®åº“æˆ–æ¨èå™¨ï¼‰å‡ºæ•…éšœä¸ä¼šé˜»å¡é‡æ–°åˆ›å»ºå·²å­˜åœ¨çš„ Podã€‚Pod åˆ›å»ºè·¯å¾„éå¸¸å…³é”®çš„ç»„ä»¶å¿…é¡»è®¾è®¡æˆé«˜å¯ç”¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¯æ‰©å±•æ€§&#34;&gt;å¯æ‰©å±•æ€§&lt;/h3&gt;
&lt;p&gt;åœ¨åŸåœ°å‡çº§ç»„ä»¶å¼€å‘å¥½åï¼ŒVPA èƒ½å¤Ÿä½¿ç”¨å®ƒã€‚&lt;/p&gt;
&lt;h2 id=&#34;è®¾è®¡&#34;&gt;è®¾è®¡&lt;/h2&gt;
&lt;h3 id=&#34;ç»¼è¿°&#34;&gt;ç»¼è¿°&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æå‡ºæ–°çš„ API èµ„æºï¼š&lt;code&gt;VerticalPodAutoscaler&lt;/code&gt; ã€‚å®ƒåŒ…æ‹¬ä¸€ä¸ªæ ‡ç­¾è¯†åˆ«å™¨ &lt;code&gt;label selector&lt;/code&gt;ï¼ˆåŒ¹é… Podï¼‰ã€èµ„æºç­–ç•¥ &lt;code&gt;resources policy&lt;/code&gt;ï¼ˆæ§åˆ¶ VPA å¦‚ä½•è®¡ç®—èµ„æºï¼‰ã€æ›´æ–°ç­–ç•¥ &lt;code&gt;update policy&lt;/code&gt;ï¼ˆæ§åˆ¶èµ„æºå˜åŒ–åº”ç”¨åˆ° Podï¼‰å’Œæ¨èèµ„æºä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;VPA &lt;code&gt;Recommender&lt;/code&gt; æ˜¯ä¸€ä¸ªæ–°çš„ç»„ä»¶ï¼Œå®ƒè€ƒè™‘é›†ç¾¤ä¸­æ¥è‡ª &lt;code&gt;Metrics Server&lt;/code&gt; çš„æ‰€æœ‰ Pod çš„èµ„æºåˆ©ç”¨ç‡ä¿¡å·å’Œå†…å­˜æº¢å‡ºäº‹ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;VPA &lt;code&gt;Recommender&lt;/code&gt; ä¼šç›‘æ§æ‰€æœ‰ Podï¼Œä¸ºæ¯ä¸ª Pod æŒç»­è®¡ç®—æ–°çš„æ¨èèµ„æºï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åˆ° VPA Object ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;VPA &lt;code&gt;Recommender&lt;/code&gt; ä¼šæš´éœ²ä¸€ä¸ªåŒæ­¥ API è·å– Pod è¯¦ç»†ä¿¡æ¯å¹¶è¿”å›æ¨èä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰çš„ Pod åˆ›å»ºè¯·æ±‚éƒ½ä¼šé€šè¿‡ &lt;code&gt;VPA Admission Controller&lt;/code&gt;ã€‚å¦‚æœ Pod ä¸ä»»ä½•ä¸€ä¸ª VPA å¯¹è±¡åŒ¹é…ï¼Œé‚£ä¹ˆ &lt;code&gt;Admission controller&lt;/code&gt; ä¼šä¾æ® VPA &lt;code&gt;Recommender&lt;/code&gt; æ¨èçš„å€¼é‡å†™å®¹å™¨çš„èµ„æºã€‚å¦‚æœ &lt;code&gt;Recommender&lt;/code&gt; è¿æ¥ä¸ä¸Šï¼Œå®ƒå°†ä¼šè¿”å› VPA Object ä¸­ç¼“å­˜çš„æ¨èä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;VPA &lt;code&gt;Updater&lt;/code&gt; æ˜¯è´Ÿè´£å®æ—¶æ›´æ–° Pod çš„ç»„ä»¶ã€‚å¦‚æœä¸€ä¸ª Pod ä½¿ç”¨ VPA çš„è‡ªåŠ¨æ¨¡å¼ï¼Œé‚£ä¹ˆ &lt;code&gt;Updater&lt;/code&gt; ä¼šä¾æ®æ¨èèµ„æºæ¥å†³å®šå¦‚ä½•æ›´æ–°ã€‚åœ¨ MVP æ¨¡å¼ä¸­ï¼Œè¿™éœ€è¦é€šè¿‡åˆ é™¤ Pod ç„¶åä¾æ®æ–°çš„èµ„æºé‡å»º Pod æ¥å®ç°ï¼Œè¿™ç§æ–¹æ³•éœ€è¦ Pod å±äºä¸€ä¸ª &lt;code&gt;Replica Set&lt;/code&gt;ï¼ˆæˆ–è€…å…¶ä»–èƒ½å¤Ÿé‡æ–°åˆ›å»ºå®ƒçš„ç»„ä»¶ï¼‰ã€‚åœ¨æœªæ¥ï¼Œ&lt;code&gt;Updater&lt;/code&gt; ä¼šåˆ©ç”¨åŸåœ°å‡çº§ï¼Œå› ä¸ºé‡æ–°åˆ›å»ºæˆ–è€…é‡æ–°åˆ†é… Pod å¯¹æœåŠ¡æ˜¯å¾ˆæœ‰ç ´åæ€§çš„ï¼Œå¿…é¡»å°½é‡å‡å°‘è¿™ç§æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;VPA ä»…ä»…æ§åˆ¶å®¹å™¨çš„èµ„æºè¯·æ±‚ï¼Œå®ƒæŠŠèµ„æºé™åˆ¶è®¾ç½®ä¸ºæ— é™ï¼Œèµ„æºè¯·æ±‚çš„è®¡ç®—åŸºäºå¯¹å½“å‰å’Œè¿‡å»è¿è¡ŒçŠ¶å†µçš„åˆ†æã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;History Storage&lt;/code&gt; æ˜¯ä» &lt;code&gt;API Server&lt;/code&gt; ä¸­è·å–èµ„æºåˆ©ç”¨ç‡ä¿¡å·å’Œå†…å­˜æº¢å‡ºå¹¶å°†å®ƒä»¬æ°¸ä¹…ä¿å­˜çš„ç»„ä»¶ã€‚&lt;code&gt;Recommender&lt;/code&gt; åœ¨ä¸€å¼€å§‹ç”¨è¿™äº›å†å²æ•°æ®æ¥åˆå§‹åŒ–çŠ¶æ€ã€‚&lt;code&gt;History Storage&lt;/code&gt; åŸºç¡€çš„å®ç°æ˜¯ä½¿ç”¨ Prometheusã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ä½“ç³»æ¶æ„&#34;&gt;ä½“ç³»æ¶æ„&lt;/h3&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-vpa-architecture-diagram&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;images/vpa-architecture.png&#34; alt=&#34;VPA Architecture Diagram&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      VPA Architecture Diagram
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;api&#34;&gt;API&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªæ–°çš„ç±»å‹çš„ API å¯¹è±¡ &lt;code&gt;VertialPodAutoscaler&lt;/code&gt;ï¼Œå®ƒåŒ…å«äº†æ‰©å®¹çš„ç›®æ ‡ï¼Œä¹Ÿå°±æ˜¯ç”¨äºåŒ¹é… Pod çš„ &lt;code&gt;label seletctor&lt;/code&gt; å’Œä¸¤ä¸ªç­–ç•¥æ¨¡å—ï¼šæ›´æ–°ç­–ç•¥ &lt;code&gt;update policy&lt;/code&gt; å’Œèµ„æºç­–ç•¥ &lt;code&gt;resources policy&lt;/code&gt;ã€‚æ­¤å¤–ä»–è¿˜æŒæœ‰ VPA è®¡ç®—çš„æœ€æ–°çš„æ¨èä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h4 id=&#34;vpa-api-å¯¹è±¡ç»¼è¿°&#34;&gt;VPA API å¯¹è±¡ç»¼è¿°&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// VerticalPodAutoscaler is the configuration for a vertical pod
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// autoscaler, which automatically manages pod resources based on historical and
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// real time resource utilization.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;VerticalPodAutoscaler&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TypeMeta&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Standard object metadata.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// +optional
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ObjectMeta&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Specification of the behavior of the autoscaler.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#spec-and-status.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// +optional
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;Spec&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;VerticalPodAutoscalerSpec&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Current information about the autoscaler.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// +optional
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;Status&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;VerticalPodAutoscalerStatus&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// VerticalPodAutoscalerSpec is the specification of the behavior of the autoscaler.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;VerticalPodAutoscalerSpec&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// A label query that determines the set of pods controlled by the Autoscaler.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#label-selectors
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;Selector&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LabelSelector&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Describes the rules on how changes are applied to the pods.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// +optional
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;UpdatePolicy&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PodUpdatePolicy&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Controls how the autoscaler computes recommended resources.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// +optional
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;ResourcePolicy&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PodResourcePolicy&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// VerticalPodAutoscalerStatus describes the runtime state of the autoscaler.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;VerticalPodAutoscalerStatus&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// The time when the status was last refreshed.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;LastUpdateTime&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Time&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// The most recently computed amount of resources recommended by the
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// autoscaler for the controlled pods.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// +optional
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;Recommendation&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;RecommendedPodResources&lt;/span&gt;	
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// A free-form human readable message describing the status of the autoscaler.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;StatusMessage&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;æ ‡ç­¾é€‰æ‹©label-selector&#34;&gt;æ ‡ç­¾é€‰æ‹©ï¼ˆLabel Selectorï¼‰&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;Label Selector&lt;/code&gt; ä¾æ®ç»™å®šçš„ VPA ç­–ç•¥å†³å®šå“ªäº› Pod éœ€è¦ä¼¸ç¼©ã€‚&lt;code&gt;Recommender&lt;/code&gt; ä¼šæ±‡èšåŒ¹é…ç»™å®š VPA çš„æ‰€æœ‰ä¿¡å·ï¼Œå› æ­¤ç”¨æˆ·è®¾ç½®æ ‡ç­¾æ¥å°†è¡Œä¸ºç±»ä¼¼çš„ pod åˆ†ç»„åˆ°ä¸€ä¸ª VPA ä¸‹æ˜¯éå¸¸é‡è¦çš„ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨è¿˜æ²¡æœ‰å†³å®šå¦‚ä½•å¤„ç†å†²çªï¼Œä¾‹å¦‚ä¸€ä¸ª pod åŒæ—¶è¢«å¤šä¸ª VPA ç­–ç•¥åŒ¹é…ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ›´æ–°ç­–ç•¥update-policy&#34;&gt;æ›´æ–°ç­–ç•¥ï¼ˆUpdate Policyï¼‰&lt;/h4&gt;
&lt;p&gt;æ›´æ–°ç­–ç•¥æ§åˆ¶äº† VPA å¦‚ä½•åº”ç”¨æ›´æ”¹ã€‚åœ¨ MVP ä¸­ï¼Œå®ƒåªåŒ…å«ä¸€ä¸ªå•ä¸ªå­—æ®µï¼š&lt;code&gt;mode&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;updatePolicy&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nt&#34;&gt;&amp;#34;mode&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;mode&lt;/code&gt; å¯ä»¥è®¾ç½®ä¸ºä¸‰ç§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Intitial&lt;/code&gt;: VPA åªåœ¨åˆ›å»º Pod æ—¶åˆ†é…èµ„æºï¼Œåœ¨ Pod çš„å…¶ä»–ç”Ÿå‘½å‘¨æœŸä¸æ”¹å˜ Pod çš„èµ„æºã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Auto&lt;/code&gt;(é»˜è®¤)ï¼šVPA åœ¨ Pod åˆ›å»ºæ—¶åˆ†é…èµ„æºï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨ Pod çš„å…¶ä»–ç”Ÿå‘½å‘¨æœŸæ›´æ–°å®ƒä»¬ï¼ŒåŒ…æ‹¬æ·˜æ±°å’Œé‡æ–°è°ƒåº¦ Podã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Off&lt;/code&gt;ï¼šVPA ä»ä¸æ”¹å˜ Pod èµ„æºã€‚&lt;code&gt;Recommender&lt;/code&gt; è€Œä¾æ—§ä¼šåœ¨ VPA å¯¹è±¡ä¸­ç”Ÿæˆæ¨èä¿¡æ¯ï¼Œä»–ä»¬å¯ä»¥è¢«ç”¨åœ¨æ¼”ä¹ ä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸‹ä»»æ„ä¸€ä¸ªæ“ä½œéƒ½å¯ä»¥å…³æ‰ VPAï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æŠŠæ›´æ–°ç­–ç•¥æ”¹ä¸º &lt;code&gt;Off&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;åˆ é™¤ VPA ç»„ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;æ”¹å˜ Pod çš„æ ‡ç­¾è®©å®ƒä¸åœ¨äº VPA &lt;code&gt;Label Selector&lt;/code&gt; åŒ¹é…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ³¨æ„ï¼šå…³é—­ VPA ä¼šè®© Pod ä¸å†è¿›è¡Œè¿›ä¸€æ­¥çš„æ”¹å˜ï¼Œä½†å®ƒä¸ä¼šæ¢å¤åˆ°æ­£åœ¨ Pod çš„æœ€åˆèµ„æºçŠ¶æ€ï¼Œç›´åˆ°ç”¨æˆ·æ‰‹åŠ¨å¯¹å®ƒè¿›è¡Œæ›´æ–°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// VerticalPodAutoscalerStatus describes the runtime state of the autoscaler.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;VerticalPodAutoscalerStatus&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// The time when the status was last refreshed.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;LastUpdateTime&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Time&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// The most recently computed amount of resources recommended by the
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// autoscaler for the controlled pods.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// +optional
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;Recommendation&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;RecommendedPodResources&lt;/span&gt;	
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// A free-form human readable message describing the status of the autoscaler.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;StatusMessage&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// UpdateMode controls when autoscaler applies changes to the pod resources.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;UpdateMode&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// UpdateModeOff means that autoscaler never changes Pod resources.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// The recommender still sets the recommended resources in the
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// VerticalPodAutoscaler object. This can be used for a &amp;#34;dry run&amp;#34;.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;UpdateModeOff&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;UpdateMode&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Off&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// UpdateModeInitial means that autoscaler only assigns resources on pod
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// creation and does not change them during the lifetime of the pod.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;UpdateModeInitial&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;UpdateMode&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Initial&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// UpdateModeAuto means that autoscaler assigns resources on pod creation
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// and additionally can update them during the lifetime of the pod,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// including evicting / rescheduling the pod.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;UpdateModeAuto&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;UpdateMode&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Auto&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// PodUpdatePolicy describes the rules on how changes are applied to the pods.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PodUpdatePolicy&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Controls when autoscaler applies changes to the pod resources.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// +optional
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;UpdateMode&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;UpdateMode&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;èµ„æºç­–ç•¥resource-policy&#34;&gt;èµ„æºç­–ç•¥ï¼ˆResource Policyï¼‰&lt;/h4&gt;
&lt;p&gt;èµ„æºç­–ç•¥æ§åˆ¶ VPA å¦‚ä½•è®¡ç®—æ¨èèµ„æºã€‚åœ¨ MVP ä¸­ï¼Œå®ƒåŒ…å«æ¯ä¸ªå®¹å™¨è¯·æ±‚ä¸­å¯é€‰çš„ä¸Šé™å’Œä¸‹é™ã€‚èµ„æºç­–ç•¥åœ¨åé¢å¯ä»¥è¢«æ‰©å±•ä¸ºé¢å¤–çš„å¼€å…³å¯ä»¥è®©ç”¨æˆ·æ ¹æ®ä»–ä»¬ç‰¹å®šçš„åœºæ™¯è°ƒæ•´æ¨èç®—æ³•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// DefaultContainerResourcePolicy can be passed as
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// ContainerResourcePolicy.Name to specify the default policy.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;DefaultContainerResourcePolicy&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ContainerResourcePolicy controls how autoscaler computes the recommended
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// resources for a specific container.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ContainerResourcePolicy&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Name of the container or DefaultContainerResourcePolicy, in which
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// case the policy is used by the containers that don&amp;#39;t have their own
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// policy specified.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Whether autoscaler is enabled for the container. Defaults to &amp;#34;On&amp;#34;.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// +optional
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;Mode&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ContainerScalingMode&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Specifies the minimal amount of resources that will be recommended
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// for the container.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// +optional
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;MinAllowed&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;api&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResourceRequirements&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Specifies the maximum amount of resources that will be recommended
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// for the container.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// +optional
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;MaxAllowed&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;api&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResourceRequirements&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// PodResourcePolicy controls how autoscaler computes the recommended resources
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// for containers belonging to the pod.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PodResourcePolicy&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Per-container resource policies.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;ContainerPolicies&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ContainerResourcePolicy&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ContainerScalingMode controls whether autoscaler is enabled for a speciifc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// container.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ContainerScalingMode&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// ContainerScalingModeOn means autoscaling is enabled for a container.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;ContainerScalingModeOn&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ContainerScalingMode&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;On&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// ContainerScalingModeOff means autoscaling is disabled for a container.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;ContainerScalingModeOff&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ContainerScalingMode&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Off&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;æ¨èrecommendation&#34;&gt;æ¨èï¼ˆRecommendationï¼‰&lt;/h4&gt;
&lt;p&gt;VPA èµ„æºæœ‰ä¸€ä¸ªä»…è¾“å‡ºçš„å­—æ®µç”¨æ¥ä¿å­˜ä¸€ä¸ªç”± &lt;code&gt;Recommender&lt;/code&gt; ç”Ÿæˆçš„æœ€è¿‘çš„ä¸€æ¬¡æ¨èã€‚è¿™ä¸ªå­—æ®µå¯ä»¥åœ¨ &lt;code&gt;Recommender&lt;/code&gt; æš‚æ—¶æ— æ³•è®¿é—®æ—¶è¢«ç”¨æ¥è·å–æœ€è¿‘çš„ä¸€æ¬¡æ¨èã€‚è¿™ä¸ªæ¨èåŒ…å«æ¨èç›®æ ‡èµ„æºæ•°é‡ä»¥åŠèŒƒå›´ (æœ€å¤§ï¼Œæœ€å°),å¯ä»¥è¢« &lt;code&gt;Updater&lt;/code&gt; ç”¨æ¥å†³å®šåœ¨ä½•æ—¶æ›´æ–° Podã€‚åœ¨èµ„æºç´§ç¼ºçš„æƒ…å†µä¸‹ï¼Œ&lt;code&gt;Updater&lt;/code&gt; å¯èƒ½å†³å®šå°† Pod èµ„æºå‹ç¼©åˆ°æ¨èçš„æœ€å°å€¼ã€‚èŒƒå›´çš„å®½åº¦åŒæ ·ä¹Ÿå½±å“äº†æ¨èçš„ç½®ä¿¡åŒºé—´ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// RecommendedPodResources is the recommendation of resources computed by
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// autoscaler.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;RecommendedPodResources&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Resources recommended by the autoscaler for each container.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;ContainerRecommendations&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RecommendedContainerResources&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// RecommendedContainerResources is the recommendation of resources computed by
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// autoscaler for a specific container. Respects the container resource policy
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// if present in the spec.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;RecommendedContainerResources&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Name of the container.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Recommended amount of resources.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;Target&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;api&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResourceRequirements&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Minimum recommended amount of resources.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// Running the application with less resources is likely to have
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// significant impact on performance/availability.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// +optional
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;MinRecommended&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;api&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResourceRequirements&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Maximum recommended amount of resources.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// Any resources allocated beyond this value are likely wasted.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// +optional
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;MaxRecommended&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;api&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ResourceRequirements&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å‡†å…¥æ§åˆ¶å™¨admission-controller&#34;&gt;å‡†å…¥æ§åˆ¶å™¨ï¼ˆAdmission Controllerï¼‰&lt;/h3&gt;
&lt;p&gt;VPA Admission Controller æ‹¦æˆª Pod åˆ›å»ºè¯·æ±‚ã€‚å¦‚æœ Pod ä¸ VPA é…ç½®åŒ¹é…ä¸”æ¨¡å¼æœªè®¾ç½®ä¸º &lt;code&gt;off&lt;/code&gt;ï¼Œåˆ™æ§åˆ¶å™¨é€šè¿‡å°†å»ºè®®çš„èµ„æºåº”ç”¨äº Pod &lt;code&gt;spec&lt;/code&gt; æ¥é‡å†™èµ„æºè¯·æ±‚ã€‚å¦åˆ™å®ƒä¼šä½¿ Pod &lt;code&gt;spec&lt;/code&gt; ä¿æŒä¸å˜ã€‚&lt;/p&gt;
&lt;p&gt;æ§åˆ¶å™¨é€šè¿‡ä» &lt;code&gt;Recommender&lt;/code&gt; ä¸­çš„ &lt;code&gt;/recommendedPodResources&lt;/code&gt; æ¥è·å–æ¨èçš„èµ„æºã€‚å¦‚æœå‘¼å«è¶…æ—¶æˆ–å¤±è´¥ï¼Œæ§åˆ¶å™¨å°†å›é€€åˆ° VPA object ä¸­ç¼“å­˜çš„å»ºè®®ã€‚å¦‚æœè¿™ä¹Ÿä¸å¯ç”¨ï¼Œåˆ™æ§åˆ¶å™¨å…è®¸èµ„æºè¯·æ±‚ä¼ é€’æœ€åˆæŒ‡å®šçš„èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šå°†æ¥å¯ä»¥é€šè¿‡å°† Pod æ ‡è®°ä¸º &lt;code&gt;requiring VPA&lt;/code&gt; æ¥ï¼ˆå¯é€‰ï¼‰å¼ºåˆ¶ä½¿ç”¨ VPAã€‚è¿™å°†ç¦æ­¢åœ¨åˆ›å»ºç›¸åº”çš„ VPA é…ç½®ä¹‹å‰è°ƒåº¦ Podã€‚å¦‚æœæ‰¾ä¸åˆ°åŒ¹é…çš„ VPA é…ç½®ï¼Œåˆ™å‡†å…¥æ§åˆ¶å™¨å°†æ‹’ç»æ­¤ç±» Podã€‚å¯¹äºæƒ³è¦åˆ›å»º VPA é…ç½®å¹¶æäº¤ Pod çš„ç”¨æˆ·æ¥è¯´ï¼Œæ­¤åŠŸèƒ½å°†éå¸¸æ–¹ä¾¿ã€‚&lt;/p&gt;
&lt;p&gt;VPA å‡†å…¥æ§åˆ¶å™¨å°†ä½œä¸ºå¤–éƒ¨å…¥åœºé’©å­ï¼ˆ&lt;a href=&#34;https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#external-admission-webhooks&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;External Admission Hook&lt;/a&gt;ï¼‰å®æ–½ã€‚ä½†è¯·æ³¨æ„ï¼Œè¿™å–å†³äºå˜å¼‚ webhook å‡†å…¥æ§åˆ¶å™¨ï¼ˆ&lt;a href=&#34;https://github.com/kubernetes/community/blob/master/contributors/design-proposals/api-machinery/admission_control_extension.md#future-work&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Mutating Webhook Admission Controllers&lt;/a&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ¨èå™¨recommender&#34;&gt;æ¨èå™¨ï¼ˆRecommenderï¼‰&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Recommender&lt;/code&gt; æ˜¯ VPA çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ã€‚å®ƒè´Ÿè´£è®¡ç®—æ¨èçš„èµ„æºã€‚åœ¨å¯åŠ¨æ—¶ï¼Œ&lt;code&gt;Recommender&lt;/code&gt; è·å–æ‰€æœ‰ Pod çš„å†å²èµ„æºåˆ©ç”¨ç‡ï¼ˆæ— è®ºå®ƒä»¬æ˜¯å¦ä½¿ç”¨ VPAï¼‰ä»¥åŠå†å²å­˜å‚¨ä¸­çš„ Pod OOM äº‹ä»¶çš„å†å²è®°å½•ã€‚å®ƒèšåˆè¿™äº›æ•°æ®å¹¶å°†å…¶ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ­£å¸¸æ“ä½œæœŸé—´ï¼Œ&lt;code&gt;Recommender&lt;/code&gt; é€šè¿‡ &lt;code&gt;Metrics API&lt;/code&gt; ä» &lt;code&gt;Metrics Server&lt;/code&gt; è·å–èµ„æºåˆ©ç”¨ç‡å’Œæ–°äº‹ä»¶çš„å®æ—¶æ›´æ–°ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜å¯ä»¥ç›‘è§†ç¾¤é›†ä¸­çš„æ‰€æœ‰ Pod å’Œæ‰€æœ‰ &lt;code&gt;VPA object&lt;/code&gt; ã€‚å¯¹äºç”±æŸä¸ª VPA é€‰æ‹©å™¨åŒ¹é…çš„æ¯ä¸ª Podï¼Œ&lt;code&gt;Recommender&lt;/code&gt; è®¡ç®—æ¨èçš„èµ„æºå¹¶åœ¨ &lt;code&gt;VPA object&lt;/code&gt; ä¸Šè®¾ç½®æ¨èã€‚&lt;/p&gt;
&lt;p&gt;æ„è¯†åˆ°æ¯ä¸ª VPA object æœ‰ä¸€ä¸ªæ¨èæ˜¯éå¸¸é‡è¦çš„ã€‚ç”¨æˆ·åº”ä½¿ç”¨ä¸€ä¸ª VPA æ¥æ§åˆ¶å…·æœ‰ç±»ä¼¼èµ„æºä½¿ç”¨æ¨¡å¼çš„ Podï¼Œé€šå¸¸æ˜¯ä¸€ç»„å‰¯æœ¬æˆ–å•ä¸ªå·¥ä½œè´Ÿè½½çš„åˆ†ç‰‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Recommender&lt;/code&gt; å……å½“äº†ä¸€ä¸ª &lt;code&gt;extension-apiserver&lt;/code&gt;ï¼Œæš´éœ²äº†ä¸€ä¸ªåŒæ­¥æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è·å– Pod &lt;code&gt;spec&lt;/code&gt; å’Œ Pod å…ƒæ•°æ®å¹¶è¿”å›æ¨èçš„èµ„æºã€‚&lt;/p&gt;
&lt;h4 id=&#34;recommender-api&#34;&gt;Recommender API&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;POST /recommendationQuery&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è¯·æ±‚ä½“ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// RecommendationQuery obtains resource recommendation for a pod.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;RecommendationQuery&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TypeMeta&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// +optional
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;metav1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ObjectMeta&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Spec is filled in by the caller to request a recommendation.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;Spec&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;RecommendationQuerySpec&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Status is filled in by the server with the recommended pod resources.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// +optional
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;Status&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;RecommendationQueryStatus&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// RecommendationQuerySpec is a request of recommendation for a pod.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;RecommendationQuerySpec&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Pod for which to compute the recommendation. Does not need to exist.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;core&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// RecommendationQueryStatus is a response to the recommendation request.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;RecommendationQueryStatus&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Recommendation holds recommended resources for the pod.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// +optional
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;Recommendation&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;autoscaler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RecommendedPodResources&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;c1&#34;&gt;// Error indicates that the recommendation was not available. Either
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// Recommendation or Error must be present.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// +optional
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;Error&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ³¨æ„ï¼Œç°æœ‰ Pod ä»¥åŠå°šæœªåˆ›å»ºçš„ Pod éƒ½å¯ä»¥è°ƒç”¨æ­¤ APIã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ›´æ–°å™¨updater&#34;&gt;æ›´æ–°å™¨ï¼ˆUpdaterï¼‰&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;VPA Updater&lt;/code&gt; æ˜¯ä¸€ä¸ªè´Ÿè´£å°†æ¨èèµ„æºåº”ç”¨äºç°æœ‰ Pod çš„ç»„ä»¶ã€‚å®ƒç›‘è§†é›†ç¾¤ä¸­çš„æ‰€æœ‰ VPA object å’Œ Podï¼Œé€šè¿‡è°ƒç”¨ &lt;code&gt;Recommender API&lt;/code&gt; å®šæœŸè·å–ç”± VPA æ§åˆ¶çš„ Pod çš„å»ºè®®ã€‚å½“æ¨èçš„èµ„æºä¸å®é™…é…ç½®çš„èµ„æºæ˜æ˜¾ä¸åŒæ—¶ï¼Œ&lt;code&gt;Updater&lt;/code&gt; å¯èƒ½ä¼šå†³å®šæ›´æ–° Podã€‚åœ¨ MVP ä¸­ï¼ˆç›´åˆ° Pod èµ„æºçš„åŸåœ°å‡çº§å¯ç”¨ï¼‰ï¼Œè¿™æ„å‘³ç€éœ€è¦é©±é€ç°æœ‰çš„ Pod ç„¶åä½¿ç”¨æ¨èçš„èµ„æºé‡æ–°åˆ›å»ºå®ƒä»¬ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Updater&lt;/code&gt; ä¾èµ–äºå…¶ä»–æœºåˆ¶ï¼ˆä¾‹å¦‚å‰¯æœ¬é›†ï¼‰æ¥é‡æ–°åˆ›å»ºå·²åˆ é™¤çš„ Podã€‚ä½†æ˜¯ï¼Œå®ƒä¸éªŒè¯æ˜¯å¦å®é™…ä¸º Pod é…ç½®äº†æ­¤ç±»æœºåˆ¶ã€‚è¿™æ ·çš„æ£€æŸ¥å¯ä»¥åœ¨ CLI ä¸­å®ç°ï¼Œå¹¶åœ¨ VPA åŒ¹é… Pod æ—¶è­¦å‘Šç”¨æˆ·ï¼Œä½† Pod ä¸ä¼šè‡ªåŠ¨é‡å¯ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶ç»ˆæ­¢ Pod æ˜¯ç ´åæ€§çš„å¹¶ä¸”é€šå¸¸æ˜¯ä¸æœŸæœ›çš„ï¼Œä½†æœ‰æ—¶ä¹Ÿæ˜¯åˆç†çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¿å… CPU é¥¥é¥¿ã€‚&lt;/li&gt;
&lt;li&gt;éšæœºé™ä½è·¨å¤šä¸ª Pod çš„ç›¸å…³ OOM çš„é£é™©ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨é•¿æ—¶é—´å†…èŠ‚çœèµ„æºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;Updater&lt;/code&gt; ä»…åœ¨ &lt;code&gt;updatePolicy.mod&lt;/code&gt; è®¾ç½®ä¸º &lt;code&gt;Auto&lt;/code&gt; æ—¶æ‰ä¼šé…ç½® Podã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ®ç¾¤é›†çš„å½“å‰çŠ¶æ€ï¼ˆä¾‹å¦‚ï¼Œé…é¢ï¼ŒèŠ‚ç‚¹ä¸Šå¯ç”¨çš„ç©ºé—´æˆ–å…¶ä»–è°ƒåº¦çº¦æŸï¼‰ï¼Œ&lt;strong&gt;&lt;code&gt;Updater&lt;/code&gt; è¿˜éœ€è¦äº†è§£å¦‚ä½•åœ¨å°†æ¨èåº”ç”¨äº Pod ä¹‹å‰è°ƒæ•´æ¨è&lt;/strong&gt;ã€‚å¦åˆ™å®ƒå¯èƒ½ä¼šæ°¸ä¹…æ€§åœ°å–æ¶ˆä¸€ä¸ª Podã€‚è¿™ç§æœºåˆ¶å°šæœªè®¾è®¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ¨èè®¡ç®—æ¨¡å‹recommendation-model&#34;&gt;æ¨èè®¡ç®—æ¨¡å‹ï¼ˆRecommendation modelï¼‰&lt;/h3&gt;
&lt;p&gt;VPA æ§åˆ¶å®¹å™¨çš„èµ„æºè¯·æ±‚ï¼ˆå†…å­˜å’Œ CPUï¼‰ã€‚åœ¨ MVP ä¸­ï¼Œå®ƒæ€»æ˜¯å°†èµ„æºé™åˆ¶è®¾ç½®ä¸ºæ— ç©·å¤§ã€‚ç›®å‰å°šä¸æ¸…æ¥šæ˜¯å¦å­˜åœ¨ VPA è®¾å®šèµ„æºé™åˆ¶çš„ç”¨ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;èµ„æºè¯·æ±‚æ˜¯åŸºäºå¯¹å®¹å™¨çš„å½“å‰å’Œå…ˆå‰è¿è¡Œä»¥åŠå…·æœ‰ç±»ä¼¼å±æ€§çš„å…¶ä»–å®¹å™¨ï¼ˆåç§°ï¼Œå›¾åƒï¼Œå‘½ä»¤ï¼Œargsï¼‰çš„åˆ†ææ¥è®¡ç®—çš„ã€‚æ¨èçš„æ¨¡å‹ï¼ˆMVPï¼‰å‡è®¾å†…å­˜å’Œ CPU æ¶ˆè€—æ˜¯ç‹¬ç«‹çš„éšæœºå˜é‡ï¼Œå…¶åˆ†å¸ƒç­‰äºåœ¨è¿‡å» N å¤©ä¸­è§‚å¯Ÿåˆ°çš„åˆ†å¸ƒï¼ˆ&lt;strong&gt;æ¨è N å€¼å–ä¸º N =8 ä»¥æ•è·æ¯å‘¨å³°å€¼&lt;/strong&gt;ï¼‰ã€‚æœªæ¥æ›´å…ˆè¿›çš„æ¨¡å‹å¯èƒ½ä¼šå°è¯•æ£€æµ‹è¶‹åŠ¿ï¼Œå‘¨æœŸæ€§å’Œå…¶ä»–ä¸æ—¶é—´ç›¸å…³çš„æ¨¡å¼ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äº CPUï¼Œç›®æ ‡æ˜¯ä¿è¯å®¹å™¨ä½¿ç”¨çš„ CPU è¶…è¿‡å®¹å™¨è¯·æ±‚çš„ CPU èµ„æºçš„é«˜ç™¾åˆ†æ¯”ï¼ˆå¦‚ 95%ï¼‰æ—¶é—´ä½äºæŸä¸ªç‰¹å®šçš„é˜ˆå€¼ï¼ˆå¦‚ä¿è¯åªæœ‰ 1% çš„æ—¶é—´å†…å®¹å™¨çš„ CPU ä½¿ç”¨é«˜äºè¯·æ±‚çš„ CPU èµ„æºçš„ 95%ï¼‰åœ¨æ­¤æ¨¡å‹ä¸­ï¼Œâ€œCPU ä½¿ç”¨â€å®šä¹‰ä¸ºåœ¨çŸ­æ—¶é—´é—´éš”å†…æµ‹é‡çš„å¹³å‡å€¼ã€‚æµ‹é‡é—´éš”è¶ŠçŸ­ï¼Œå¯¹å°–å³°ï¼Œå»¶è¿Ÿæ•æ„Ÿçš„å·¥ä½œè´Ÿè½½çš„å»ºè®®è´¨é‡è¶Šå¥½ã€‚æœ€ä½åˆç†é—´éš”ä¸º 1/minï¼Œå»ºè®®ä¸º 1/secã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºå†…å­˜ï¼Œç›®æ ‡æ˜¯ä¿è¯åœ¨ç‰¹å®šæ—¶é—´çª—å£å†…å®¹å™¨ä½¿ç”¨çš„å†…å­˜è¶…è¿‡å®¹å™¨è¯·æ±‚çš„å†…å­˜èµ„æºçš„æ¦‚ç‡ä½äºæŸä¸ªé˜ˆå€¼ï¼ˆä¾‹å¦‚ï¼Œåœ¨ 24 å°æ—¶å†…ä½äº 1ï¼…ï¼‰ã€‚çª—å£å¿…é¡»å¾ˆé•¿ï¼ˆ â‰¥24hï¼‰ï¼Œä»¥ç¡®ä¿ OOM å¼•èµ·çš„é©±é€ä¸ä¼šæ˜æ˜¾å½±å“æœåŠ¡åº”ç”¨ç¨‹åºçš„å¯ç”¨æ€§å’Œæ‰¹é‡è®¡ç®—çš„è¿›åº¦ï¼ˆæ›´é«˜çº§çš„æ¨¡å‹å¯ä»¥å…è®¸ç”¨æˆ·æŒ‡å®š SLO æ¥æ§åˆ¶å®ƒï¼‰ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å†…å­˜æº¢å‡ºå¤„ç†handling-ooms&#34;&gt;å†…å­˜æº¢å‡ºå¤„ç†ï¼ˆHandling OOMsï¼‰&lt;/h4&gt;
&lt;p&gt;å½“å®¹å™¨ç”±äºè¶…å‡ºå¯ç”¨å†…å­˜è€Œè¢«é€å‡ºæ—¶ï¼Œå…¶å®é™…å†…å­˜è¦æ±‚æ˜¯æœªçŸ¥çš„ï¼ˆæ¶ˆè€—çš„é‡æ˜¾ç„¶ç»™å‡ºäº†ä¸‹é™ï¼‰ã€‚è¿™æ˜¯é€šè¿‡å°† OOM äº‹ä»¶è½¬æ¢ä¸ºäººå·¥å†…å­˜ä½¿ç”¨æ ·æœ¬æ¥å»ºæ¨¡çš„ï¼Œæ–¹æ³•æ˜¯å°†â€œå®‰å…¨è¾¹é™…â€ä¹˜æ•° (&amp;ldquo;safety margin&amp;rdquo; multiplier ) åº”ç”¨äºæœ€åä¸€æ¬¡è§‚å¯Ÿåˆ°çš„ä½¿ç”¨æƒ…å†µã€‚&lt;/p&gt;
&lt;h3 id=&#34;å†å²å­˜å‚¨history-storage&#34;&gt;å†å²å­˜å‚¨ï¼ˆHistory Storageï¼‰&lt;/h3&gt;
&lt;p&gt;VPA ä¸ºå†å²äº‹ä»¶å’Œèµ„æºåˆ©ç”¨çš„æä¾›è€…å®šä¹‰æ•°æ®è®¿é—® APIã€‚ä¸€å¼€å§‹ï¼Œè‡³å°‘åœ¨èµ„æºåˆ©ç”¨éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Prometheus ä½œä¸ºæ­¤ API çš„å‚è€ƒå®ç°ï¼Œå†å²äº‹ä»¶å¯ä»¥ç”±å¦ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ”¯æŒï¼Œä¾‹å¦‚ï¼ŒInfrastoreã€‚ç”¨æˆ·å°†èƒ½å¤Ÿæ’å…¥è‡ªå·±çš„å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;History Storage&lt;/code&gt; è¢«ä¸æ–­å¡«å……å®æ—¶æ›´æ–°çš„èµ„æºåˆ©ç”¨ç‡å’Œäº‹ä»¶ï¼Œç±»ä¼¼äº &lt;code&gt;Recommender&lt;/code&gt;ã€‚å®ƒè‡³å°‘ä¿ç•™ 8 å¤©çš„æ•°æ®ã€‚æ­¤æ•°æ®ä»…ç”¨äºåœ¨å¯åŠ¨æ—¶åˆå§‹åŒ– &lt;code&gt;Recommender&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¼€æ”¾é—®é¢˜&#34;&gt;å¼€æ”¾é—®é¢˜&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœå¤šä¸ª VPA å¯¹è±¡ä¸ä¸€ä¸ª Pod åŒ¹é…ï¼Œå¦‚ä½•è§£å†³å†²çªã€‚&lt;/li&gt;
&lt;li&gt;å¦‚ä½•åœ¨å°†æ¨èåº”ç”¨äºç‰¹å®šå®¹å™¨ä¹‹å‰æ ¹æ®é›†ç¾¤çš„å½“å‰çŠ¶æ€è°ƒæ•´æ¨èï¼ˆä¾‹å¦‚ï¼Œé…é¢ï¼ŒèŠ‚ç‚¹ä¸Šå¯ç”¨çš„ç©ºé—´æˆ–å…¶ä»–è°ƒåº¦çº¦æŸï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æœªæ¥çš„å·¥ä½œ&#34;&gt;æœªæ¥çš„å·¥ä½œ&lt;/h2&gt;
&lt;h3 id=&#34;pod-å¯åŠ¨æ—¶èå…¥-vpa&#34;&gt;Pod å¯åŠ¨æ—¶èå…¥ VPA&lt;/h3&gt;
&lt;p&gt;åœ¨å½“å‰ææ¡ˆä¸­ï¼Œå¦‚æœåœ¨ Pod æ¥çº³æ—¶é—´ (Admission Time) å†… Pod æ²¡æœ‰åŒ¹é…çš„ VPA é…ç½®ï¼Œåˆ™å°†ä½¿ç”¨æœ€åˆé…ç½®çš„èµ„æºè°ƒåº¦ Podã€‚è¿™å¯èƒ½å¹¶ä¸æ˜¯ç”¨æˆ·å¸Œæœ›çš„è¡Œä¸ºã€‚ç‰¹åˆ«åœ°ï¼Œç”¨æˆ·å¯èƒ½æƒ³è¦åˆ›å»º VPA é…ç½®åŒæ—¶æäº¤åˆ° Podï¼Œè¿™ä¼šå¯¼è‡´ç«äº‰æ¡ä»¶ï¼šç»“æœå–å†³äºé¦–å…ˆå¤„ç†å“ªä¸ªèµ„æºï¼ˆVPA æˆ– Podï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å»ºè®®å…è®¸ä½¿ç”¨ç‰¹æ®Šæ³¨é‡Šï¼ˆ&lt;code&gt;requires VPA&lt;/code&gt;ï¼‰æ ‡è®° Podï¼Œå¦‚æœç›¸åº”çš„ VPA ä¸å¯ç”¨ï¼Œåˆ™é˜»æ­¢æ¥çº³æ§åˆ¶å™¨ (Admission Controlle) æ¥çº³ Podã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€ç§æ–¹æ³•æ˜¯å¼•å…¥ç”¨äºç›¸åŒç›®çš„çš„ VPA åˆå§‹åŒ–å™¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç»“åˆå‚ç›´å’Œæ°´å¹³ç¼©æ”¾&#34;&gt;ç»“åˆå‚ç›´å’Œæ°´å¹³ç¼©æ”¾&lt;/h3&gt;
&lt;p&gt;åŸåˆ™ä¸Šï¼Œåªè¦ä¸¤ä¸ªæœºåˆ¶åœ¨ä¸åŒçš„èµ„æºä¸Šè¿è¡Œï¼Œå°±å¯ä»¥å¯¹å•ä¸ªå·¥ä½œè´Ÿè½½ï¼ˆPod ç»„ï¼‰ä½¿ç”¨å‚ç›´å’Œæ°´å¹³ç¼©æ”¾ã€‚æ­£ç¡®çš„æ–¹æ³•æ˜¯è®© HPA åŸºäºç“¶é¢ˆèµ„æºæ‰©å±•ç»„ã€‚VPA å¯ä»¥æ§åˆ¶å…¶ä»–èµ„æºã€‚ä¾‹å­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CPU ç»‘å®šçš„å·¥ä½œè´Ÿè½½å¯ä»¥æ ¹æ® CPU åˆ©ç”¨ç‡æ°´å¹³ä¼¸ç¼©ï¼ŒåŒæ—¶ä½¿ç”¨å‚ç›´ä¼¸ç¼©æ¥è°ƒæ•´å†…å­˜ã€‚&lt;/li&gt;
&lt;li&gt;IO ç»‘å®šå·¥ä½œè´Ÿè½½å¯ä»¥åŸºäº IO ååé‡æ°´å¹³ä¼¸ç¼©ï¼ŒåŒæ—¶ä½¿ç”¨å‚ç›´ä¼¸ç¼©æ¥è°ƒæ•´å†…å­˜å’Œ CPUã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç„¶è€Œï¼Œè¿™æ˜¯ä¸€ç§æ›´é«˜çº§çš„è‡ªåŠ¨ç¼©æ”¾å½¢å¼ï¼Œå¹¶ä¸” MVP ç‰ˆæœ¬çš„ Vertical Pod Autoscaler ä¸èƒ½å¾ˆå¥½åœ°æ”¯æŒå®ƒã€‚å®ç°çš„éš¾åº¦åœ¨äºæ”¹å˜å®ä¾‹æ•°ä¸ä»…ä¼šå½±å“ç“¶é¢ˆèµ„æºçš„åˆ©ç”¨ç‡ï¼ˆè¿™æ˜¯æ°´å¹³æ‰©å±•çš„åŸåˆ™ï¼‰ï¼Œè€Œä¸”å¯èƒ½ä¹Ÿä¼šå½±å“ç”± VPA æ§åˆ¶çš„éç“¶é¢ˆèµ„æºã€‚åœ¨æ±‡æ€»å†å²èµ„æºåˆ©ç”¨ç‡å’Œç”Ÿæˆå»ºè®®æ—¶ï¼Œå¿…é¡»æ‰©å±• VPA æ¨¡å‹ä»è€Œèƒ½å¤Ÿå°†ç»„çš„å¤§å°è€ƒè™‘åœ¨å†…ï¼Œä»¥ä¾¿å°†å…¶ä¸ HPA ç›¸ç»“åˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ‰¹é‡å·¥ä½œè´Ÿè½½&#34;&gt;æ‰¹é‡å·¥ä½œè´Ÿè½½&lt;/h3&gt;
&lt;p&gt;æ‰¹å¤„ç†å·¥ä½œè´Ÿè½½å…·æœ‰ä¸å»¶è¿Ÿæ•æ„Ÿå·¥ä½œè´Ÿè½½æœ‰ä¸åŒçš„ CPU è¦æ±‚ã€‚ä»–ä»¬å…³å¿ƒååé‡è€Œä¸æ˜¯è¯·æ±‚å»¶è¿Ÿï¼Œè¿™æ„å‘³ç€ VPA åº”è¯¥å°† CPU éœ€æ±‚åŸºäºå¹³å‡ CPU æ¶ˆè€—è€Œä¸æ˜¯é«˜ç™¾åˆ†ä½çš„ CPU åˆ†å¸ƒã€‚&lt;/p&gt;
&lt;p&gt;TODOï¼šæè¿°æ‰¹å¤„ç†å·¥ä½œè´Ÿè½½çš„æ¨èæ¨¡å‹ä»¥åŠ VPA å¦‚ä½•åŒºåˆ†æ‰¹å¤„ç†å’ŒæœåŠ¡ã€‚ä¸€ç§å¯èƒ½çš„æ–¹æ³•æ˜¯æŸ¥çœ‹ &lt;code&gt;PodSpec.restartPolicy&lt;/code&gt;ã€‚å¦ä¸€ç§æ–¹æ³•æ˜¯è®©ç”¨æˆ·åœ¨ &lt;code&gt;PodResourcePolicy&lt;/code&gt; ä¸­æŒ‡å®šå·¥ä½œè´Ÿè½½çš„å»¶è¿Ÿè¦æ±‚ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;è½¬è½½è‡ªï¼šhttps://github.com/kubernetes/community/blob/master/contributors/design-proposals/autoscaling/vertical-pod-autoscaler.md&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä½ å¿…çŸ¥çš„ Kubernetes è‡ªåŠ¨ç¼©æ”¾</title>
      <link>https://cloudnativecn.com/blog/k8s-autoscaling-all-you-need-to-know/</link>
      <pubDate>Wed, 25 Sep 2019 10:01:15 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/k8s-autoscaling-all-you-need-to-know/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://caylent.com/kubernetes-autoscaling&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¼–è€…æŒ‰&#34;&gt;ç¼–è€…æŒ‰&lt;/h2&gt;
&lt;p&gt;è®¸å¤š Kubernetes ç”¨æˆ·ï¼Œç‰¹åˆ«æ˜¯é‚£äº›ä¼ä¸šçº§ç”¨æˆ·ï¼Œå¾ˆå¿«å°±é‡åˆ°äº†å¯¹ç¯å¢ƒè‡ªåŠ¨ç¼©æ”¾çš„éœ€æ±‚ã€‚å¹¸è¿çš„æ˜¯ï¼ŒKubernetes Horizontal Pod Autoscalerï¼ˆHPAï¼‰å…è®¸æ‚¨å°†éƒ¨ç½²é…ç½®ä¸ºä»¥å¤šç§æ–¹å¼æ°´å¹³æ‰©å±•ã€‚ä½¿ç”¨ Kubernetes Autoscaling çš„æœ€å¤§ä¼˜åŠ¿ä¹‹ä¸€æ˜¯æ‚¨çš„é›†ç¾¤å¯ä»¥è·Ÿè¸ªç°æœ‰ Pod çš„è´Ÿè½½èƒ½åŠ›ï¼Œå¹¶è®¡ç®—æ˜¯å¦éœ€è¦æ›´å¤šçš„ Podã€‚&lt;/p&gt;
&lt;h2 id=&#34;kubernetes-autoscaling&#34;&gt;Kubernetes Autoscaling&lt;/h2&gt;
&lt;p&gt;é€šè¿‡åè°ƒå†…ç½®çš„ä¸¤å±‚å¯æ‰©å±•æ€§ï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨é«˜æ•ˆçš„ Kubernetes Autoscalingï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Pod çº§åˆ«çš„è‡ªåŠ¨ç¼©æ”¾ï¼šåŒ…æ‹¬ Horizontal Pod Autoscalerï¼ˆHPAï¼‰å’Œ Vertical Pod Autoscalerï¼ˆVPAï¼‰; ä¸¤è€…éƒ½å¯ä»¥æ‰©å±•å®¹å™¨çš„å¯ç”¨èµ„æºã€‚&lt;/li&gt;
&lt;li&gt;é›†ç¾¤çº§åˆ«çš„è‡ªåŠ¨ç¼©æ”¾ï¼šé›†ç¾¤è‡ªåŠ¨è°ƒèŠ‚å™¨ï¼ˆCAï¼‰é€šè¿‡åœ¨å¿…è¦æ—¶å‘ä¸Šæˆ–å‘ä¸‹æ‰©å±•é›†ç¾¤å†…çš„èŠ‚ç‚¹æ•°æ¥ç®¡ç†è¿™ç§å¯æ‰©å±•æ€§å¹³é¢ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;kubernetes-autoscaling-è¯¦æƒ…&#34;&gt;Kubernetes Autoscaling è¯¦æƒ…&lt;/h2&gt;
&lt;h3 id=&#34;horizontal-pod-autoscaler-hpa&#34;&gt;Horizontal Pod Autoscaler (HPA)&lt;/h3&gt;
&lt;p&gt;HPA ä¼šåœ¨é›†ç¾¤ä¸­ç¼©æ”¾ Pod å‰¯æœ¬çš„æ•°é‡ã€‚è¯¥æ“ä½œç”± CPU æˆ–å†…å­˜è§¦å‘ï¼Œä»¥æ ¹æ®éœ€è¦å‘ä¸Šæˆ–å‘ä¸‹æ‰©å±•ã€‚ä½†æ˜¯ï¼Œä¹Ÿå¯ä»¥æ ¹æ®å„ç§å¤–éƒ¨çš„å’Œè‡ªå®šä¹‰æŒ‡æ ‡ï¼ˆmetrics.k8s.ioï¼Œexternal.metrics.k8s.io å’Œ custom.metrics.k8s.ioï¼‰æ¥é…ç½® HPA ä»¥æ‰©å±• Podã€‚&lt;/p&gt;
&lt;h3 id=&#34;vertical-pod-autoscaler-vpa&#34;&gt;Vertical Pod Autoscaler (VPA)&lt;/h3&gt;
&lt;p&gt;VPA ä¸»è¦ç”¨äºæœ‰çŠ¶æ€æœåŠ¡ï¼Œå®ƒå¯æ ¹æ®éœ€è¦ä¸º Pod æ·»åŠ  CPU æˆ–å†…å­˜â€”â€”å®ƒä¹Ÿé€‚ç”¨äºæ— çŠ¶æ€çš„ Podã€‚ä¸ºäº†åº”ç”¨è¿™äº›æ›´æ”¹ï¼ŒVPA é‡æ–°å¯åŠ¨ Pod ä»¥æ›´æ–°æ–°çš„ CPU å’Œå†…å­˜èµ„æºï¼Œè¿™äº›èµ„æºå¯ä»¥é…ç½®ä¸ºå“åº” OOMï¼ˆå†…å­˜ä¸è¶³ï¼‰äº‹ä»¶è€Œå¯åŠ¨ã€‚é‡æ–°å¯åŠ¨ Pod çš„æ—¶å€™ï¼ŒVPA å§‹ç»ˆç¡®ä¿æ ¹æ® Pod åˆ†é…é¢„ç®—ï¼ˆPDBï¼‰ç¡®å®šæœ€å°æ•°é‡ï¼Œæ‚¨å¯ä»¥è®¾ç½®è¯¥èµ„æºåˆ†é…æœ€å¤§å’Œæœ€å°é€Ÿç‡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;cluster-autoscaler-ca&#34;&gt;Cluster Autoscaler (CA)&lt;/h3&gt;
&lt;p&gt;ç¬¬äºŒå±‚çš„è‡ªåŠ¨ç¼©æ”¾æ¶‰åŠ CAï¼Œå®ƒåœ¨ä»¥ä¸‹æƒ…å†µä¸‹è‡ªåŠ¨è°ƒæ•´é›†ç¾¤çš„å¤§å°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”±äºé›†ç¾¤ä¸­çš„å®¹é‡ä¸è¶³ï¼Œä»»ä½• Pod/s éƒ½æ— æ³•è¿è¡Œå¹¶è¿›å…¥æŒ‚èµ·çŠ¶æ€ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒCA å°†å‘ä¸Šæ‰©å±•ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é›†ç¾¤ä¸­çš„èŠ‚ç‚¹åœ¨ä¸€æ®µæ—¶é—´å†…æœªå¾—åˆ°å……åˆ†åˆ©ç”¨ï¼Œå¹¶ä¸”æœ‰å¯èƒ½è¿ç§»èŠ‚ç‚¹ä¸Šçš„ Podï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒCA å°†ç¼©å°ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;CA è¿›è¡Œä¾‹è¡Œæ£€æŸ¥ä»¥ç¡®å®šæ˜¯å¦æœ‰ä»»ä½• pod å› ç­‰å¾…é¢å¤–èµ„æºå¤„äºå¾…å®šçŠ¶æ€ï¼Œæˆ–è€…é›†ç¾¤èŠ‚ç‚¹æ˜¯å¦æœªå¾—åˆ°å……åˆ†åˆ©ç”¨ã€‚å¦‚æœéœ€è¦æ›´å¤šèµ„æºï¼Œä¼šç›¸åº”åœ°è°ƒæ•´ Cluster èŠ‚ç‚¹çš„æ•°é‡ã€‚CA ä¸äº‘æä¾›å•†äº¤äº’ä»¥è¯·æ±‚å…¶ä»–èŠ‚ç‚¹æˆ–å…³é—­ç©ºé—²èŠ‚ç‚¹ï¼Œå¹¶ç¡®ä¿æŒ‰æ¯”ä¾‹æ”¾å¤§çš„é›†ç¾¤ä¿æŒåœ¨ç”¨æˆ·è®¾ç½®çš„é™åˆ¶èŒƒå›´å†…ã€‚å®ƒé€‚ç”¨äº AWSï¼ŒAzure å’Œ GCPã€‚&lt;/p&gt;
&lt;h2 id=&#34;å°†-hpa-å’Œ-ca-ä¸-amazon-eks-é…åˆä½¿ç”¨çš„-5-ä¸ªæ­¥éª¤&#34;&gt;å°† HPA å’Œ CA ä¸ Amazon EKS é…åˆä½¿ç”¨çš„ 5 ä¸ªæ­¥éª¤&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡æä¾›äº†é€šè¿‡é€‚ç”¨äº Kubernetesï¼ˆAmazon EKSï¼‰é›†ç¾¤çš„ Amazon Elastic å®¹å™¨æœåŠ¡ï¼Œé€šè¿‡ HPA å’Œ CA å®‰è£…å’Œè‡ªåŠ¨æ‰©å±•çš„åˆ†æ­¥æŒ‡å—ã€‚ä»¥ä¸‹æŒ‡å—æ˜¯ä¸¤ä¸ªæµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;h3 id=&#34;é›†ç¾¤è¦æ±‚&#34;&gt;é›†ç¾¤è¦æ±‚&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ»¡è¶³ EKS é›†ç¾¤è¦æ±‚çš„ Amazon VPC å’Œ ä¸€ä¸ªå®‰å…¨ç»„ã€‚&lt;/li&gt;
&lt;li&gt;æˆ–è€…ï¼Œä¸ºå…æ‰‹åŠ¨åˆ›å»º VPCï¼ŒAWS æä¾›äº†åˆ›å»ºäº† VPC å’Œ EKS çš„&lt;a href=&#34;https://docs.aws.amazon.com/eks/latest/userguide/getting-started.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CloudFormation æ¨¡æ¿&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://amazon-eks.s3-us-west-2.amazonaws.com/cloudformation/2018-08-30/amazon-eks-vpc-sample.yaml&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CloudFormation YAML æ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;åº”ç”¨åˆ°é›†ç¾¤çš„&lt;a href=&#34;https://docs.aws.amazon.com/eks/latest/userguide/service_IAM_role.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;EKS è§’è‰²&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;1.&lt;/strong&gt; æ ¹æ®&lt;a href=&#34;https://docs.aws.amazon.com/eks/latest/userguide/create-cluster.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹æŒ‡å—&lt;/a&gt;åˆ›å»ºä¸€ä¸ª AWS EKS é›†ç¾¤ (æ§åˆ¶é¢æ¿å’Œå’Œå·¥ä½œèŠ‚ç‚¹). ä¸€æ—¦ä½ æŠŠå·¥ä½œèŠ‚ç‚¹ä»¥ auto scaling group çš„å½¢å¼å¯åŠ¨äº†ï¼Œå®ƒä»¬ä¼šè‡ªåŠ¨å‘ EKS é›†ç¾¤æ³¨å†Œï¼Œä½ å°±å¯ä»¥å¼€å§‹éƒ¨ç½² k8s åº”ç”¨äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2.&lt;/strong&gt; éƒ¨ç½²åº¦é‡æœåŠ¡å™¨ä»¥ä¾¿HPAèƒ½å¤Ÿæ ¹æ®APIæä¾›çš„CPU/å†…å­˜æ•°æ®è‡ªåŠ¨ç¼©æ”¾PODå‰¯æœ¬çš„æ•°é‡ã€‚metrics.k8s.io api é€šå¸¸ç”± metrics-serverï¼ˆè´Ÿè´£ä» summary api æ”¶é›† cpu å’Œå†…å­˜åº¦é‡ï¼‰æä¾›ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3.&lt;/strong&gt; æŠŠä»¥ä¸‹ç­–ç•¥åº”ç”¨åˆ° EKS åˆ›å»ºçš„ worker èŠ‚ç‚¹çš„ Role ä¸Š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;Version&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2012-10-17&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nt&#34;&gt;&amp;#34;Statement&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;Effect&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Allow&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;Action&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;s2&#34;&gt;&amp;#34;autoscaling:DescribeAutoScalingGroups&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;s2&#34;&gt;&amp;#34;autoscaling:DescribeAutoScalingInstances&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;s2&#34;&gt;&amp;#34;autoscaling:DescribeLaunchConfigurations&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;s2&#34;&gt;&amp;#34;autoscaling:DescribeTags&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;s2&#34;&gt;&amp;#34;autoscaling:SetDesiredCapacity&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;s2&#34;&gt;&amp;#34;autoscaling:TerminateInstanceInAutoScalingGroup&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;nt&#34;&gt;&amp;#34;Resource&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;4.&lt;/strong&gt; &lt;a href=&#34;https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/cloudprovider/aws/examples/cluster-autoscaler-autodiscover.yaml&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éƒ¨ç½² k8s CA ç‰¹æ€§&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ ¹æ®ä½ ä½¿ç”¨çš„ linux å‘è¡Œç‰ˆï¼Œä½ å¯èƒ½éœ€è¦æ›´æ–°éƒ¨ç½²æ–‡ä»¶å’Œè¯ä¹¦è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½¿ç”¨ AMI Linuxï¼Œéœ€è¦ç”¨/etc/ssl/certs/ca-bundle.crt æ›¿æ¢/etc/ssl/certs/ca-certificates.crt&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;5.&lt;/strong&gt; æ›´æ–° CA çš„éƒ¨ç½² YAML æ–‡ä»¶ï¼Œæ‰¾åˆ°æŒ‡å®šçš„ AWS AGï¼ˆk8s.io/cluster-autoscaler/&amp;lt;&lt;code&gt;CLUSTER NAME&lt;/code&gt;&amp;gt;åº”è¯¥åŒ…å«çœŸå®çš„é›†ç¾¤åç§°ï¼‰æ ‡ç­¾ã€‚
åŒæ—¶æ›´æ–°&lt;code&gt;AWS_REGION&lt;/code&gt;ç¯å¢ƒå˜é‡ã€‚&lt;/p&gt;
&lt;p&gt;æŠŠä»¥ä¸‹ tag æ·»åŠ åˆ° AWS AGï¼Œä»¥ä¾¿ k8s çš„ cluster autoscaler èƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ« AWS AGï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;k8s.io/cluster-autoscaler/enabled
k8s.io/cluster-autoscaler/&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;kubernetes-autoscaling-æµ‹è¯•ç”¨ä¾‹-1&#34;&gt;Kubernetes Autoscaling æµ‹è¯•ç”¨ä¾‹ #1&lt;/h3&gt;
&lt;p&gt;æµ‹è¯• k8s hpa ç‰¹æ€§å’Œ k8s ca ç‰¹æ€§åŒæ—¶ä½¿ç”¨&lt;/p&gt;
&lt;p&gt;è¦æ±‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªè¿è¡Œä¸­çš„ eks é›†ç¾¤&lt;/li&gt;
&lt;li&gt;å®‰è£…å¥½ metric server&lt;/li&gt;
&lt;li&gt;å®‰è£…äº† k8s cluster autoscaler ç‰¹æ€§&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;1.&lt;/strong&gt; éƒ¨ç½²ä¸€ä¸ªæµ‹è¯• appï¼Œä¸º app éƒ¨ç½²åˆ›å»º HPA èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2.&lt;/strong&gt; ä»ä¸åŒçš„åœ°ç†ä½ç½®å‘èµ·è¯·æ±‚ä»¥å¢åŠ è´Ÿè½½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3.&lt;/strong&gt; HPA åº”è¯¥ä¼šéšç€è´Ÿè½½çš„å¢åŠ å¼€å§‹ç¼©æ”¾ pod çš„æ•°é‡ã€‚å®ƒä¼šæ ¹æ® hpa èµ„æºæŒ‡å®šçš„è¿›è¡Œç¼©æ”¾çš„ã€‚åœ¨æŸä¸€æ—¶åˆ»ï¼Œæ–°çš„ POD åœ¨ç­‰å¾…å…¶ä»–èµ„æºçš„æ—¶å€™ä¼šæ˜¯ç­‰å¾…çŠ¶æ€ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get nodes -w
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                             STATUS    ROLES     AGE       VERSION
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ip-192-168-189-29.ec2.internal   Ready         1h        v1.10.3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ip-192-168-200-20.ec2.internal   Ready         1h        v1.10.3
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get Pods -o wide -w
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME READY STATUS RESTARTS AGE IP NODE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ip-192-168-200-20.ec2.internal
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;php-apache-8699449574-4mg7w 0/1 Pending &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 17m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;php-apache-8699449574-64zkm 1/1 Running &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 1h 192.168.210.90 ip-192-168-200-20
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;php-apache-8699449574-8nqwk 0/1 Pending &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 17m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;php-apache-8699449574-cl8lj 1/1 Running &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 27m 192.168.172.71 ip-192-168-189-29
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;php-apache-8699449574-cpzdn 1/1 Running &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 17m 192.168.219.71 ip-192-168-200-20
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;php-apache-8699449574-dn9tb 0/1 Pending &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 17m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;4.&lt;/strong&gt; CA æ£€æµ‹åˆ°å› ä¸ºå®¹é‡ä¸è¶³è€Œè¿›å…¥ç­‰å¾…çŠ¶æ€çš„ podsï¼Œè°ƒæ•´ AWS è‡ªåŠ¨ç¼©æ”¾ç»„çš„å¤§å°ã€‚ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹åŠ å…¥äº†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get nodes -w
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                       STATUS    ROLES     AGE       VERSION
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ip-192-168-189-29.ec2.internal   Ready         2h        v1.10.3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ip-192-168-200-20.ec2.internal   Ready         2h        v1.10.3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ip-192-168-92-187.ec2.internal   Ready         34s       v1.10.3
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;5.&lt;/strong&gt; HPA èƒ½å¤ŸæŠŠç­‰å¾…çŠ¶æ€çš„ POD è°ƒåº¦åˆ°æ–°çš„èŠ‚ç‚¹ä¸Šäº†ã€‚å¹³å‡ cpu ä½¿ç”¨ç‡ä½äºæŒ‡å®šçš„ç›®æ ‡ï¼Œæ²¡æœ‰å¿…è¦å†è°ƒåº¦æ–°çš„ pod äº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get hpa
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME         REFERENCE                    TARGETS   MINPODS   MAXPODS   REPLICAS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;php-apache   Deployment/php-apache   40%/50%   &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;                  &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt;                 &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt;               1h $ kubectl get Pods -o wide -w
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get Pods -o wide -w
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME READY STATUS RESTARTS AGE IP NODE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;php-apache-8699449574-4mg7w 1/1 Running &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 25m 192.168.74.4 ip-192-168-92-187
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;php-apache-8699449574-64zkm 1/1 Running &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 1h 192.168.210.90 ip-192-168-200-20
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;php-apache-8699449574-8nqwk 1/1 Running &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 25m 192.168.127.85 ip-192-168-92-187
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;php-apache-8699449574-cl8lj 1/1 Running &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 35m 192.168.172.71 ip-192-168-189-29
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;6.&lt;/strong&gt; å…³é—­å‡ ä¸ª terminalï¼Œåœæ‰ä¸€äº›è´Ÿè½½&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;7.&lt;/strong&gt; CPU å¹³å‡åˆ©ç”¨ç‡å‡å°äº†ï¼Œæ‰€ä»¥ HPA å¼€å§‹æ›´æ”¹éƒ¨ç½²é‡Œçš„ pod å‰¯æœ¬æ•°é‡å¹¶æ€æ‰ä¸€äº› pods&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get hpa
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME         REFERENCE                     TARGETS   MINPODS   MAXPODS   REPLICAS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;php-apache   Deployment/php-apache   47%/50%     &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;                &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt;                 &lt;span class=&#34;m&#34;&gt;7&lt;/span&gt;                   1h 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get Pods -o wide -w
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME READY STATUS RESTARTS AGE IP NODE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;php-apache-8699449574-v5kwf 1/1 Running &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 36m 192.168.250.0 ip-192-168-200-20
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;php-apache-8699449574-vl4zj 1/1 Running &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 36m 192.168.242.153 ip-192-168-200-20
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;php-apache-8699449574-8nqwk 1/1 Terminating &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 26m 192.168.127.85 ip-192-168-92-187
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;php-apache-8699449574-dn9tb 1/1 Terminating &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 26m 192.168.124.108 ip-192-168-92-187
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;php-apache-8699449574-k5ngv 1/1 Terminating &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 26m 192.168.108.58 ip-192-168-92-187
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;8.&lt;/strong&gt; CA æ£€æµ‹åˆ°ä¸€ä¸ªèŠ‚ç‚¹æœªå……åˆ†ä½¿ç”¨ï¼Œæ­£åœ¨è¿è¡Œçš„ pod èƒ½å¤Ÿè°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get nodes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                             STATUS    ROLES     AGE       VERSION
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ip-192-168-189-29.ec2.internal   Ready         2h        v1.10.3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ip-192-168-200-20.ec2.internal   Ready         2h        v1.10.3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ip-192-168-92-187.ec2.internal   NotReady       23m       v1.10.3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get nodes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                             STATUS    ROLES     AGE       VERSION
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ip-192-168-189-29.ec2.internal   Ready         2h        v1.10.3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ip-192-168-200-20.ec2.internal   Ready         2h        v1.10.3
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;9.&lt;/strong&gt; åœ¨å‘ä¸‹ç¼©æ”¾çš„æ—¶å€™ï¼Œterminal ä¸­åº”è¯¥æ²¡æœ‰æ˜æ˜¾çš„ timeout&lt;/p&gt;
&lt;h3 id=&#34;kubernetes-autoscaling-æµ‹è¯•ç”¨ä¾‹-2&#34;&gt;Kubernetes Autoscaling æµ‹è¯•ç”¨ä¾‹ #2&lt;/h3&gt;
&lt;p&gt;æµ‹è¯•åœ¨å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„ CPU å®¹é‡è°ƒåº¦ pod ä¸‹ï¼ŒCA æ˜¯å¦èƒ½å¤Ÿè‡ªåŠ¨è°ƒæ•´é›†ç¾¤çš„å¤§å°&lt;/p&gt;
&lt;p&gt;è¦æ±‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªè¿è¡Œä¸­çš„ aws eks é›†ç¾¤&lt;/li&gt;
&lt;li&gt;Kubernetes ca ç‰¹æ€§å·²å®‰è£…&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;1.&lt;/strong&gt; åˆ›å»º 2 ä¸ªè¯·æ±‚å°äº 1vcpu çš„ deployment&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl run nginx --image&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;nginx:latest --requests&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;cpu&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;200m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl run nginx2 --image&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;nginx:latest --requests&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;cpu&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;200m
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;2.&lt;/strong&gt; åˆ›å»ºä¸€ä¸ªæ–°çš„ deploymentï¼Œè¯·æ±‚æ¯”å‰©ä½™çš„ cpu æ›´å¤šçš„èµ„æº&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl run nginx3 --image&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;nginx:latest --requests&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;cpu&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;3.&lt;/strong&gt; æ–°çš„ POD ä¼šå¤„äºç­‰å¾…çŠ¶æ€ï¼Œå› ä¸ºæ²¡æœ‰å¯ç”¨çš„èµ„æºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get Pods -w
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                      READY     STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nginx-5fcb54784c-lcfht    1/1       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          13m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nginx2-66667bf959-2fmlr   1/1       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          3m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nginx3-564b575974-xcm5t   0/1       Pending   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          41s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æè¿° pod çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šçœ‹åˆ°æ²¡æœ‰è¶³å¤Ÿçš„ cpu çš„äº‹ä»¶&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl describe Pod nginx3-564b575974-xcm5t
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â€¦..
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â€¦..
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Events:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Type     Reason            Age               From               Message
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;----     ------            ----              ----               -------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Warning  FailedScheduling  32s &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;x7 over 1m&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;  default-scheduler  0/1 nodes are available: &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; Insufficient cpu
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;4.&lt;/strong&gt; CA è‡ªåŠ¨è°ƒæ•´é›†ç¾¤çš„å¤§å°ï¼Œæ–°åŠ äº†ä¸€ä¸ªèŠ‚ç‚¹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get nodes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                              STATUS    ROLES     AGE       VERSION
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ip-192-168-142-179.ec2.internal   Ready         1m        v1.10.3  &lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;ip-192-168-82-136.ec2.i&lt;/span&gt;nternal     Ready         1h        v1.10.3
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;5.&lt;/strong&gt; é›†ç¾¤ç°åœ¨æœ‰äº†è¶³å¤Ÿçš„èµ„æºä»¥è¿è¡Œ pod&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get Pods
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                      READY     STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nginx-5fcb54784c-lcfht    1/1       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          48m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nginx2-66667bf959-2fmlr   1/1       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          37m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nginx3-564b575974-xcm5t   1/1       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          35m
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;6.&lt;/strong&gt; ä¸¤ä¸ªéƒ¨ç½²åˆ é™¤äº†ã€‚ä¸€æ®µæ—¶é—´åï¼ŒCA æ£€æµ‹åˆ°é›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹æœªè¢«å……åˆ†åˆ©ç”¨ï¼Œè¿è¡Œçš„ pod å¯ä»¥å®‰ç½®åˆ°å…¶ä»–å­˜åœ¨çš„èŠ‚ç‚¹ä¸Šã€‚AWS AG æ›´æ–°ï¼ŒèŠ‚ç‚¹æ•°é‡å‡ 1ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get nodes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                      STATUS    ROLES     AGE       VERSION
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ip-192-168-82-136.ec2.internal   Ready         1h          v1.10.3 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get Pods -o wide
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                        READY     STATUS    RESTARTS   AGE       IP                       NODE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nginx-5fcb54784c-lcfht   1/1       Running     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;                   1h       192.168.98.139   ip-192-168-82-136
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¸…é™¤ç¯å¢ƒçš„æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ é™¤æ·»åŠ åˆ° eks worker èŠ‚ç‚¹ä¸Š Role çš„è‡ªå®šä¹‰ç­–ç•¥&lt;/li&gt;
&lt;li&gt;æŒ‰ç…§è¿™ä¸ª&lt;a href=&#34;https://docs.aws.amazon.com/eks/latest/userguide/delete-cluster.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æŒ‡å—&lt;/a&gt;åˆ é™¤è¿™ä¸ªé›†ç¾¤&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;p&gt;å…¶ä»–çš„å…³äº kubernetes autoscalingï¼Œå¯ä»¥é˜…è¯» Stefan Prodan çš„æ–‡ç«  &lt;a href=&#34;https://github.com/stefanprodan/k8s-prom-hpa&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes Horizontal Pod Autoscaler with Prometheus Custom Metrics&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰è¿™äº›é“¾æ¥ä¹Ÿå¯ä»¥çœ‹çœ‹ &lt;a href=&#34;https://caylent.com/spotlight-on-kubernetes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;link1&lt;/a&gt;, &lt;a href=&#34;https://caylent.com/50-useful-kubernetes-tools/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;link2&lt;/a&gt;, &lt;a href=&#34;https://caylent.com/best-practices-kubernetes-pods/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;link3&lt;/a&gt;ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>æ„å»º Kubernetes é›†ç¾¤ â€”â€” é€‰æ‹©å·¥ä½œèŠ‚ç‚¹æ•°é‡å’Œå¤§å°</title>
      <link>https://cloudnativecn.com/blog/architecting-kubernetes-clusters-choosing-a-worker-node-size/</link>
      <pubDate>Sun, 08 Sep 2019 18:00:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/architecting-kubernetes-clusters-choosing-a-worker-node-size/</guid>
      <description>&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/architecting-kubernetes-clusters-choosing-a-worker-node-size/architecting-kubernetes-clusters-choosing-a-worker-node-size_hu2530184939915455458.webp 400w,
               /blog/architecting-kubernetes-clusters-choosing-a-worker-node-size/architecting-kubernetes-clusters-choosing-a-worker-node-size_hu11618683195009907381.webp 760w,
               /blog/architecting-kubernetes-clusters-choosing-a-worker-node-size/architecting-kubernetes-clusters-choosing-a-worker-node-size_hu3532375676152660881.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/architecting-kubernetes-clusters-choosing-a-worker-node-size/architecting-kubernetes-clusters-choosing-a-worker-node-size_hu2530184939915455458.webp&#34;
               width=&#34;760&#34;
               height=&#34;570&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;ç¼–è€…æŒ‰&#34;&gt;ç¼–è€…æŒ‰&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡ä»å¤šä¸ªç»´åº¦é˜è¿°äº†ä½¿ç”¨æ›´å°‘çš„å¤§èŠ‚ç‚¹ä¸æ›´å¤šçš„å°èŠ‚ç‚¹æ¥ç»„å»º Kubernetes é›†ç¾¤å„è‡ªçš„ä¼˜åŠ¿ä¸åŠ£åŠ¿ï¼Œå¹¶ç»“åˆå®è·µç»éªŒç»™å‡ºäº†é€‰æ‹©å·¥ä½œèŠ‚ç‚¹æ•°é‡å’Œå¤§å°çš„ä¸€èˆ¬æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¼•è¨€&#34;&gt;å¼•è¨€&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;æ¬¢è¿æ¥åˆ° Kubernetes å­¦ä¹ å›­åœ°&lt;/strong&gt;ï¼Œè¿™æ˜¯ä¸€ä¸ªå¸¸è§„ä¸“æ ï¼Œæ”¶é›†æ•´ç†äº†æˆ‘ä»¬åœ¨çº¿ä¸Šä»¥åŠçº¿ä¸‹ç ”è®¨ä¼šä¸Šç”± Kubernetes ä¸“å®¶å›ç­”çš„æœ€æœ‰æ„æ€çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»Šå¤©é—®é¢˜çš„ç­”æ¡ˆç”± &lt;a href=&#34;https://medium.com/@weibeld&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Daniel Weibel&lt;/a&gt; ç»™å‡ºã€‚Daniel æ˜¯ä¸€åè½¯ä»¶å·¥ç¨‹å¸ˆï¼ŒåŒæ—¶ä¹Ÿæ˜¯ Learnk8s çš„è®²å¸ˆã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦‚æœæ‚¨å¸Œæœ›åœ¨ä¸‹ä¸€æœŸä¸­å±•ç¤ºæ‚¨çš„é—®é¢˜ï¼Œè¯·&lt;a href=&#34;hello@learnk8s.io&#34;&gt;é€šè¿‡é‚®ä»¶è”ç³»æˆ‘ä»¬&lt;/a&gt;æˆ–è€…&lt;a href=&#34;https://twitter.com/learnk8s&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨ tweet ä¸Š @learnk8s&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é”™è¿‡äº†å‰å‡ æœŸï¼Ÿ&lt;a href=&#34;https://learnk8s.io/bite-sized&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹å¾€æœŸå†…å®¹&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åœ¨åˆ›å»º Kubernetes é›†ç¾¤æ—¶ï¼Œæ‚¨é¦–å…ˆä¼šæƒ³åˆ°çš„é—®é¢˜ä¹‹ä¸€å°±æ˜¯ï¼šâ€œæˆ‘åº”è¯¥åˆ›å»ºä½•ç§ç±»å‹çš„å·¥ä½œèŠ‚ç‚¹ï¼Œä»¥åŠåº”è¯¥åˆ›å»ºå¤šå°‘ä¸ªï¼Ÿâ€ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‚¨æ­£åœ¨æ­å»ºå†…éƒ¨é›†ç¾¤ï¼Œæ˜¯åº”è¯¥è´­ä¹°æœ€æ–°ä¸€ä»£çš„è¶…çº§æœåŠ¡å™¨ï¼Œè¿˜æ˜¯ä½¿ç”¨æ•°æ®ä¸­å¿ƒé‡Œçš„åå‡ å°æ—§æœºå™¨å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æˆ–è€…æ‚¨ä½¿ç”¨çš„æ˜¯æ‰˜ç®¡ Kubernetes æœåŠ¡ï¼Œä¾‹å¦‚ &lt;a href=&#34;https://cloud.google.com/kubernetes-engine/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google Kubernetes Engine (GKE)&lt;/a&gt;ï¼Œæ˜¯åº”è¯¥ä½¿ç”¨ 8 ä¸ª &lt;code&gt;n1-standard-1&lt;/code&gt; å®ä¾‹ï¼Œè¿˜æ˜¯åº”è¯¥ä½¿ç”¨ 2 ä¸ª &lt;code&gt;n1-standard-4&lt;/code&gt; å®ä¾‹æ¥å®ç°æ‚¨æƒ³è¦çš„è®¡ç®—èƒ½åŠ›å‘¢ï¼Ÿ&lt;/p&gt;
&lt;h2 id=&#34;é›†ç¾¤å®¹é‡&#34;&gt;é›†ç¾¤å®¹é‡&lt;/h2&gt;
&lt;p&gt;ä¸€èˆ¬æ¥è¯´ï¼ŒKubernetes é›†ç¾¤å¯ä»¥è¢«è§†ä¸ºæ˜¯å°†ä¸€ç»„å•ä¸ªèŠ‚ç‚¹æŠ½è±¡ä¸ºä¸€ä¸ªå¤§çš„â€œè¶…çº§èŠ‚ç‚¹â€ã€‚è¿™ä¸ªè¶…çº§èŠ‚ç‚¹çš„æ€»è®¡ç®—å®¹é‡ï¼ˆå°± CPU å’Œå†…å­˜è€Œè¨€ï¼‰æ˜¯æ‰€æœ‰ç»„æˆèŠ‚ç‚¹èµ„æºå®¹é‡çš„æ€»å’Œã€‚æ‚¨å¯ä»¥é‡‡ç”¨å¤šç§ä¸åŒçš„èµ„æºé…ç½®æ–¹å¼å®ç°é›†ç¾¤æ‰€éœ€çš„ç›®æ ‡å®¹é‡ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œå‡å¦‚æ‚¨éœ€è¦ä¸€ä¸ªæ€»å®¹é‡ä¸º 8 ä¸ª CPU å’Œ 32GB å†…å­˜çš„é›†ç¾¤ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œå› ä¸ºè¦åœ¨é›†ç¾¤ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºéœ€è¦æ­¤æ•°é‡çš„èµ„æºã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯å®ç°é›†ç¾¤çš„ä¸¤ç§å¯èƒ½æ–¹æ³•ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34;
           src=&#34;https://cloudnativecn.com/blog/architecting-kubernetes-clusters-choosing-a-worker-node-size/cluster-design.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é€šè¿‡è¿™ä¸¤ç§æ–¹å¼æ„å»ºçš„é›†ç¾¤æ‹¥æœ‰ç›¸åŒçš„èµ„æºå®¹é‡ï¼Œä½†æ˜¯ä¸€ç§æ˜¯ä½¿ç”¨ 4 ä¸ªè¾ƒå°çš„èŠ‚ç‚¹ï¼Œè€Œå¦ä¸€ç§æ˜¯ä½¿ç”¨ 2 ä¸ªè¾ƒå¤§çš„èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç©¶ç«Ÿå“ªç§é…ç½®æ–¹å¼æ›´å¥½å‘¢ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè®©æˆ‘ä»¬å¯¹æ¯”ä¸‹äºŒè€…ï¼ˆå³æ›´å°‘çš„å¤§èŠ‚ç‚¹ä¸æ›´å¤šçš„å°èŠ‚ç‚¹ï¼‰å„è‡ªçš„ä¼˜ç¼ºç‚¹ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼Œæœ¬æ–‡ä¸­çš„â€œèŠ‚ç‚¹â€å§‹ç»ˆä»£æŒ‡å·¥ä½œèŠ‚ç‚¹ã€‚ä¸»èŠ‚ç‚¹æ•°é‡å’Œå¤§å°çš„é€‰æ‹©æ˜¯å®Œå…¨ä¸åŒçš„ä¸»é¢˜ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;æ›´å°‘çš„å¤§èŠ‚ç‚¹&#34;&gt;æ›´å°‘çš„å¤§èŠ‚ç‚¹&lt;/h2&gt;
&lt;p&gt;è¿™æ–¹é¢æœ€æç«¯çš„ä¸€ä¸ªä¾‹å­å°±æ˜¯ç”±å•ä¸ªå·¥ä½œèŠ‚ç‚¹æä¾›æ•´ä¸ªé›†ç¾¤çš„è®¡ç®—å®¹é‡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œè¿™å°†æ˜¯ä¸€ä¸ªå…·æœ‰ 16 ä¸ª CPU å’Œ 16GB å†…å­˜çš„å•ä¸ªå·¥ä½œèŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨å¤§èŠ‚ç‚¹çš„ä¼˜åŠ¿&#34;&gt;ä½¿ç”¨å¤§èŠ‚ç‚¹çš„ä¼˜åŠ¿&lt;/h3&gt;
&lt;p&gt;&lt;em&gt;è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ç§æ–¹æ³•å¯èƒ½å…·æœ‰çš„ä¼˜åŠ¿ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;h4 id=&#34;æ›´å°‘çš„ç®¡ç†å¼€é”€&#34;&gt;æ›´å°‘çš„ç®¡ç†å¼€é”€&lt;/h4&gt;
&lt;p&gt;ç®€å•æ¥è¯´ï¼Œç®¡ç†å°‘é‡æœºå™¨ç›¸æ¯”ç®¡ç†å¤§é‡æœºå™¨ä¼šæ›´çœåŠ›ã€‚å¯¹èŠ‚ç‚¹è¿›è¡Œå‡çº§å’Œæ‰“è¡¥ä¸çš„æ“ä½œèƒ½å¾ˆè¿…é€Ÿåœ°å®Œæˆï¼ŒèŠ‚ç‚¹é—´çš„åŒæ­¥ä¿æŒä¹Ÿæ›´å®¹æ˜“ã€‚æ­¤å¤–ï¼Œå¯¹äºå¾ˆå°‘çš„æœºå™¨è€Œè¨€ï¼Œé¢„æœŸæ•…éšœçš„ç»å¯¹æ•°é‡ä¹Ÿä¼šå°äºä½¿ç”¨å¤§é‡æœºå™¨çš„åœºæ™¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;ä½†è¯·æ³¨æ„ï¼Œè¿™ä¸»è¦é€‚ç”¨äºè£¸æœºæœåŠ¡å™¨è€Œä¸é€‚ç”¨äºäº‘å®ä¾‹ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‚¨ä½¿ç”¨äº‘å®ä¾‹ï¼ˆä½œä¸ºæ‰˜ç®¡ Kubernetes æœåŠ¡çš„ä¸€éƒ¨åˆ†æˆ–åœ¨äº‘åŸºç¡€æ¶æ„ä¸Šå®‰è£…çš„ Kubernetesï¼‰ï¼Œåˆ™å®é™…ä¸Šæ˜¯å°†åº•å±‚æœºå™¨çš„ç®¡ç†å¤–åŒ…ç»™äº†äº‘æä¾›å•†ã€‚å› æ­¤ï¼Œç®¡ç†äº‘ä¸­çš„ 10 ä¸ªèŠ‚ç‚¹å¯èƒ½å¹¶ä¸æ¯”ç®¡ç†äº‘ä¸­çš„å•ä¸ªèŠ‚ç‚¹è€—è´¹æ›´å¤šç®¡ç†æˆæœ¬ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ›´ä½çš„å•èŠ‚ç‚¹æˆæœ¬&#34;&gt;æ›´ä½çš„å•èŠ‚ç‚¹æˆæœ¬&lt;/h4&gt;
&lt;p&gt;è™½ç„¶é«˜ç«¯æœºå™¨æ¯”ä½ç«¯æœºå™¨æ›´æ˜‚è´µï¼Œä½†ä»·æ ¼ä¸Šæ¶¨ä¸ä¸€å®šæ˜¯çº¿æ€§çš„ã€‚æ¢å¥è¯è¯´ï¼Œå…·æœ‰ 10 ä¸ª CPU å’Œ 10GB å†…å­˜çš„å•å°æœºå™¨å¯èƒ½æ¯”å…·æœ‰ 1 ä¸ª CPU å’Œ 1GB å†…å­˜çš„ 10 å°æœºå™¨ä¾¿å®œã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;ä½†è¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨ä½¿ç”¨äº‘å®ä¾‹ï¼Œè¿™ä¸ªåŸåˆ™å¯èƒ½å¹¶ä¸é€‚ç”¨ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ä¸»è¦çš„äº‘æä¾›å•† &lt;a href=&#34;https://aws.amazon.com/ec2/pricing/on-demand/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Amazon Web Services&lt;/a&gt;ã€&lt;a href=&#34;https://cloud.google.com/compute/vm-instance-pricing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google Cloud Platform&lt;/a&gt; å’Œ &lt;a href=&#34;https://azure.microsoft.com/en-us/pricing/calculator/#virtual-machines&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Microsoft Azure&lt;/a&gt; çš„å½“å‰å®šä»·æ–¹æ¡ˆä¸­ï¼Œå®ä¾‹ä»·æ ¼ä¼šéšå®¹é‡çº¿æ€§å¢åŠ ã€‚ä¾‹å¦‚ï¼Œåœ¨ Google Cloud Platform ä¸Šï¼Œ64 ä¸ª &lt;code&gt;n1-standard-1&lt;/code&gt; å®ä¾‹çš„æˆæœ¬ä¸å•ä¸ª &lt;code&gt;n1-standard-64&lt;/code&gt; å®ä¾‹å®Œå…¨ç›¸åŒâ€”â€”è¿™ä¸¤ç§æ–¹å¼éƒ½ä¸ºæ‚¨æä¾› 64 ä¸ª CPU å’Œ 240GB å†…å­˜ã€‚å› æ­¤ï¼Œåœ¨äº‘ä¸Šï¼Œæ‚¨é€šå¸¸æ— æ³•é€šè¿‡ä½¿ç”¨æ›´å¤§çš„æœºå™¨æ¥èŠ‚çœèµ„é‡‘æŠ•å…¥ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å…è®¸è¿è¡Œèµ„æºé¥¥é¥¿å‹åº”ç”¨&#34;&gt;å…è®¸è¿è¡Œèµ„æºé¥¥é¥¿å‹åº”ç”¨&lt;/h4&gt;
&lt;p&gt;å…·å¤‡å¤§å‹èŠ‚ç‚¹å¯èƒ½åªæ˜¯æ‚¨è¦åœ¨é›†ç¾¤ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºç±»å‹çš„éœ€æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ªéœ€è¦ 8GB å†…å­˜çš„æœºå™¨å­¦ä¹ åº”ç”¨ç¨‹åºï¼Œåˆ™æ— æ³•åœ¨ä»…å…·æœ‰ 1GB å†…å­˜çš„èŠ‚ç‚¹çš„é›†ç¾¤ä¸Šè¿è¡Œå®ƒã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥åœ¨å…·æœ‰ 10GB å†…å­˜èŠ‚ç‚¹çš„é›†ç¾¤ä¸Šè¿è¡Œå®ƒã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨å¤§èŠ‚ç‚¹çš„åŠ£åŠ¿&#34;&gt;ä½¿ç”¨å¤§èŠ‚ç‚¹çš„åŠ£åŠ¿&lt;/h3&gt;
&lt;p&gt;&lt;em&gt;çœ‹å®Œäº†ä¼˜åŠ¿ï¼Œè®©æˆ‘ä»¬å†æ¥çœ‹çœ‹åŠ£åŠ¿ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;h4 id=&#34;æ¯ä¸ªèŠ‚ç‚¹ä¼šè¿è¡Œå¤§é‡-pod&#34;&gt;æ¯ä¸ªèŠ‚ç‚¹ä¼šè¿è¡Œå¤§é‡ Pod&lt;/h4&gt;
&lt;p&gt;åœ¨è¾ƒå°‘çš„èŠ‚ç‚¹ä¸Šè¿è¡Œç›¸åŒçš„å·¥ä½œè´Ÿè½½è‡ªç„¶æ„å‘³ç€åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œæ›´å¤šçš„ Podã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;è¿™å¯èƒ½ä¼šæˆä¸ºä¸€ä¸ªé—®é¢˜ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;åŸå› æ˜¯æ¯ä¸ª Pod éƒ½ä¼šä¸ºåœ¨èŠ‚ç‚¹ä¸Šè¿è¡Œçš„ Kubernetes ä»£ç†ç¨‹åºå¼•å…¥ä¸€äº›å¼€é”€â€”â€”ä¾‹å¦‚å®¹å™¨è¿è¡Œæ—¶ï¼ˆå¦‚ Dockerï¼‰ã€kubelet å’Œ cAdvisorã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œkubelet å¯¹èŠ‚ç‚¹ä¸Šçš„æ¯ä¸ªå®¹å™¨æ‰§è¡Œå‘¨æœŸæ€§çš„ liveness å’Œ readiness æ¢æµ‹â€”â€”æ›´å¤šå®¹å™¨æ„å‘³ç€åœ¨æ¯è½®è¿­ä»£ä¸­ kubelet å°†æ‰§è¡Œæ›´å¤šå·¥ä½œã€‚cAdvisor æ”¶é›†èŠ‚ç‚¹ä¸Šæ‰€æœ‰å®¹å™¨çš„èµ„æºä½¿ç”¨ç»Ÿè®¡ä¿¡æ¯ï¼Œå¹¶ä¸” kubelet å®šæœŸæŸ¥è¯¢æ­¤ä¿¡æ¯å¹¶åœ¨å…¶ API ä¸Šå…¬å¼€å®ƒâ€”â€”å†æ¬¡ï¼Œè¿™æ„å‘³ç€æ¯è½®è¿­ä»£ä¸­ cAdvisor å’Œ kubelet çš„å·¥ä½œé‡éƒ½ä¼šå¢åŠ ã€‚&lt;/p&gt;
&lt;p&gt;éšç€ Pod æ•°é‡çš„å¢é•¿ï¼Œè¿™äº›é—®é¢˜çš„èšç§¯å¯èƒ½ä¼šå¼€å§‹å‡æ…¢ç³»ç»Ÿé€Ÿåº¦ï¼Œç”šè‡³ä½¿é›†ç¾¤ç³»ç»Ÿå˜å¾—ä¸å¯é ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34;
           src=&#34;https://cloudnativecn.com/blog/architecting-kubernetes-clusters-choosing-a-worker-node-size/node-overload.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœ‰æŠ¥å‘Šç§°ï¼Œ&lt;a href=&#34;https://github.com/kubernetes/kubernetes/issues/45419&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;èŠ‚ç‚¹è¢«æŠ¥å‘Šä¸ºæœªå°±ç»ª&lt;/a&gt;ï¼Œæ˜¯å› ä¸ºå‘¨æœŸæ€§çš„çš„ kubelet è¿è¡ŒçŠ¶å†µæ£€æŸ¥èŠ±è´¹äº†å¤ªé•¿æ—¶é—´æ¥è¿­ä»£èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰å®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;å‡ºäºè¿™äº›åŸå› ï¼ŒKubernetes å®˜æ–¹&lt;a href=&#34;https://kubernetes.io/docs/setup/best-practices/cluster-large/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å»ºè®®æ¯ä¸ªèŠ‚ç‚¹æœ€å¤š 110 ä¸ª Pod&lt;/a&gt;ã€‚å¯¹äºè¿™ä¸ªæ•°å­—ï¼ŒKubernetes å·²ç»è¿›è¡Œè¿‡ç›¸å…³æµ‹è¯•ï¼Œå¯ä»¥åœ¨ä¸€èˆ¬ç±»å‹çš„èŠ‚ç‚¹ä¸Šå¯é åœ°å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ï¼Œå¦‚æœèŠ‚ç‚¹çš„æ€§èƒ½è¶³å¤Ÿå¥½ï¼Œæ‚¨å¯èƒ½ä¹Ÿèƒ½å¤ŸæˆåŠŸåœ°è®©æ¯ä¸ªèŠ‚ç‚¹è¿è¡Œæ›´å¤šçš„ Pod â€”â€”ä½†å¾ˆéš¾é¢„æµ‹è¿™æ˜¯å¦èƒ½å¤Ÿé¡ºåˆ©è¿›è¡Œï¼Œä¹Ÿè®¸ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;å¤§å¤šæ•°æ‰˜ç®¡ Kubernetes æœåŠ¡ç”šè‡³å¯¹æ¯ä¸ªèŠ‚ç‚¹çš„ Pod æ•°é‡æ–½åŠ äº†ä¸¥æ ¼çš„é™åˆ¶ï¼š&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ &lt;a href=&#34;https://github.com/awslabs/amazon-eks-ami/blob/master/files/eni-max-pods.txt&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Amazon Elastic Kubernetes Serviceï¼ˆEKSï¼‰&lt;/a&gt;ä¸Šï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„æœ€å¤§ Pod æ•°å–å†³äºèŠ‚ç‚¹ç±»å‹ï¼ŒèŒƒå›´ä» 4 åˆ° 737ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ &lt;a href=&#34;https://cloud.google.com/kubernetes-engine/quotas&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google Kubernetes Engineï¼ˆGKEï¼‰&lt;/a&gt;ä¸Šï¼Œæ— è®ºèŠ‚ç‚¹ç±»å‹å¦‚ä½•ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„é™åˆ¶ä¸º 100 ä¸ª Podã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ &lt;a href=&#34;https://docs.microsoft.com/bs-latn-ba/azure/aks/configure-azure-cni#maximum-pods-per-node&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Azure Kubernetes Serviceï¼ˆAKSï¼‰&lt;/a&gt;ä¸Šï¼Œé»˜è®¤é™åˆ¶æ˜¯æ¯ä¸ªèŠ‚ç‚¹ 30 ä¸ª Podï¼Œä½†æœ€å¤šå¯ä»¥å¢åŠ åˆ° 250 ä¸ªã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å› æ­¤ï¼Œå¦‚æœæ‚¨è®¡åˆ’ä¸ºæ¯ä¸ªèŠ‚ç‚¹è¿è¡Œå¤§é‡ Podï¼Œåˆ™åº”è¯¥äº‹å…ˆè¿›è¡Œæµ‹è¯•ï¼Œçœ‹èƒ½å¦æŒ‰é¢„æœŸé‚£æ ·å·¥ä½œã€‚&lt;/p&gt;
&lt;h4 id=&#34;æœ‰é™çš„å‰¯æœ¬æ•°é‡&#34;&gt;æœ‰é™çš„å‰¯æœ¬æ•°é‡&lt;/h4&gt;
&lt;p&gt;è¾ƒå°‘çš„èŠ‚ç‚¹å¯èƒ½ä¼šé™åˆ¶åº”ç”¨ç¨‹åºçš„å‰¯æœ¬æ•°é‡ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ªç”± 5 ä¸ªå‰¯æœ¬ç»„æˆçš„é«˜å¯ç”¨åº”ç”¨ç¨‹åºï¼Œä½†æ‚¨åªæœ‰ 2 ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºçš„æœ‰æ•ˆå‰¯æœ¬æ•°é‡å°†å‡å°‘åˆ° 2ã€‚è¿™æ˜¯å› ä¸º 5 ä¸ªå‰¯æœ¬åªèƒ½åˆ†å¸ƒåœ¨ 2 ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹å¤±è´¥ï¼Œå®ƒå¯èƒ½ä¼šåŒæ—¶æŒ‚æ‰è¯¥èŠ‚ç‚¹ä¸Šçš„å¤šä¸ªå‰¯æœ¬ã€‚ç›¸åï¼Œå¦‚æœæ‚¨æœ‰è‡³å°‘ 5 ä¸ªèŠ‚ç‚¹ï¼Œåˆ™æ¯ä¸ªå‰¯æœ¬å¯ä»¥åœ¨å•ç‹¬çš„èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œå¹¶ä¸”å•ä¸ªèŠ‚ç‚¹çš„æ•…éšœæœ€å¤šåªä¼šæŒ‚æ‰å…¶ä¸­ä¸€ä¸ªå‰¯æœ¬ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œå¦‚æœæ‚¨æœ‰é«˜å¯ç”¨è¦æ±‚ï¼Œåˆ™å¯èƒ½éœ€è¦é›†ç¾¤èŠ‚ç‚¹æ•°å¤§äºæŸä¸ªä¸‹é™å€¼ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ›´å¤§çš„ç ´åèŒƒå›´&#34;&gt;æ›´å¤§çš„ç ´åèŒƒå›´&lt;/h4&gt;
&lt;p&gt;å¦‚æœæ‚¨åªæœ‰å‡ ä¸ªå·¥ä½œèŠ‚ç‚¹ï¼Œé‚£ä¹ˆèŠ‚ç‚¹å¤±è´¥é€ æˆçš„å½±å“æ¯”ä½¿ç”¨å¤§é‡èŠ‚ç‚¹æ—¶çš„å½±å“è¦å¤§ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åªæœ‰ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œé‚£å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œå°±æ„å‘³ç€ä¸€åŠçš„èŠ‚ç‚¹ä¼šæ¶ˆå¤±ã€‚Kubernetes å¯ä»¥å°†å¤±è´¥èŠ‚ç‚¹çš„å·¥ä½œè´Ÿè½½é‡æ–°å®‰æ’åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨åªæœ‰å‡ ä¸ªèŠ‚ç‚¹ï¼Œé‚£é£é™©ä¹Ÿä¼šå¢åŠ ï¼Œå› ä¸ºå‰©ä½™èŠ‚ç‚¹ä¸Šå¯èƒ½æ²¡æœ‰è¶³å¤Ÿçš„å¤‡ç”¨èµ„æºå®¹é‡æ¥å®¹çº³æ•…éšœèŠ‚ç‚¹çš„æ‰€æœ‰å·¥ä½œè´Ÿè½½ã€‚ç»“æœæ˜¯ï¼Œéƒ¨åˆ†åº”ç”¨ç¨‹åºå°†æ°¸ä¹…åœæœºï¼Œç›´åˆ°å†æ¬¡å¯åŠ¨æ•…éšœèŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œå¦‚æœæ‚¨æƒ³å‡å°‘ç¡¬ä»¶æ•…éšœçš„å½±å“ï¼Œåˆ™åº”è¯¥é€‰æ‹©æ›´å¤šçš„èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;h4 id=&#34;è¾ƒå¤§çš„èµ„æºä¼¸ç¼©å¢é‡&#34;&gt;è¾ƒå¤§çš„èµ„æºä¼¸ç¼©å¢é‡&lt;/h4&gt;
&lt;p&gt;Kubernetes ä¸ºäº‘åŸºç¡€æ¶æ„æä¾›äº† Cluster Autoscalerï¼Œå…è®¸æ ¹æ®å½“å‰éœ€æ±‚è‡ªåŠ¨æ·»åŠ æˆ–åˆ é™¤èŠ‚ç‚¹ã€‚å¦‚æœä½¿ç”¨å¤§å‹èŠ‚ç‚¹ï¼Œåˆ™ä¼šæœ‰è¾ƒå¤§çš„èµ„æºä¼¸ç¼©å¢é‡ï¼Œè¿™ä¼šä½¿èµ„æºæ‰©ç¼©å®¹æ›´åŠ ç¬¨é‡ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åªæœ‰ 2 ä¸ªèŠ‚ç‚¹ï¼Œåˆ™æ·»åŠ èŠ‚ç‚¹æ„å‘³ç€å°†ç¾¤é›†å®¹é‡å¢åŠ  50%ã€‚è¿™å¯èƒ½æ¯”æ‚¨å®é™…éœ€è¦çš„èµ„æºå¤šå¾—å¤šï¼Œå°±æ„å‘³ç€æ‚¨éœ€è¦ä¸ºæœªä½¿ç”¨çš„èµ„æºä»˜è´¹ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œå¦‚æœæ‚¨è®¡åˆ’ä½¿ç”¨é›†ç¾¤çš„è‡ªåŠ¨å¼¹æ€§ä¼¸ç¼©åŠŸèƒ½ï¼Œåˆ™è¾ƒå°çš„èŠ‚ç‚¹å…è®¸æ‚¨è¿›è¡Œæ›´è½»é‡ä¸”ç»æµé«˜æ•ˆçš„èµ„æºæ‰©ç¼©å®¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;åœ¨è®¨è®ºäº†æ›´å°‘å¤§èŠ‚ç‚¹çš„ä¼˜ç¼ºç‚¹ä¹‹åï¼Œè®©æˆ‘ä»¬è½¬å‘æ›´å¤šå°èŠ‚ç‚¹çš„åœºæ™¯ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ›´å¤šçš„å°èŠ‚ç‚¹&#34;&gt;æ›´å¤šçš„å°èŠ‚ç‚¹&lt;/h2&gt;
&lt;p&gt;è¿™ç§æ–¹æ³•é€šè¿‡è®¸å¤šå°èŠ‚ç‚¹æ„å»ºé›†ç¾¤ï¼Œè€Œä¸ä½¿ç”¨æ›´å°‘çš„å¤§èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;é‚£å®ƒçš„ä¼˜ç¼ºç‚¹åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨å°èŠ‚ç‚¹çš„ä¼˜åŠ¿&#34;&gt;ä½¿ç”¨å°èŠ‚ç‚¹çš„ä¼˜åŠ¿&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨æ›´å¤šå°èŠ‚ç‚¹çš„ä¼˜ç‚¹æ­£å¯¹åº”äºä½¿ç”¨æ›´å°‘å¤§èŠ‚ç‚¹çš„ç¼ºç‚¹ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å‡å°ç ´åèŒƒå›´&#34;&gt;å‡å°ç ´åèŒƒå›´&lt;/h4&gt;
&lt;p&gt;å¦‚æœæ‚¨æœ‰æ›´å¤šèŠ‚ç‚¹ï¼Œåˆ™æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„ Pod è‡ªç„¶ä¼šæ›´å°‘ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœ‰ 100 ä¸ª Pod å’Œ 10 ä¸ªèŠ‚ç‚¹ï¼Œåˆ™æ¯ä¸ªèŠ‚ç‚¹å¹³å‡åªåŒ…å« 10 ä¸ª Podã€‚è¿™æ ·ï¼Œå³ä¾¿å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œå®ƒçš„å½±å“ä¹Ÿä»…é™äºæ€»å·¥ä½œè´Ÿè½½çš„è¾ƒå°çš„ä¸€éƒ¨åˆ†ã€‚æœ‰å¯èƒ½åªæœ‰éƒ¨åˆ†åº”ç”¨ç¨‹åºå—åˆ°å½±å“ï¼Œå¹¶ä¸”å¯èƒ½åªæœ‰å°‘é‡å‰¯æœ¬æŒ‚æ‰ï¼Œå› æ­¤æ•´ä¸ªåº”ç”¨ç¨‹åºä¼šä»ç„¶ä¿æŒè¿è¡ŒçŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œå‰©ä½™èŠ‚ç‚¹ä¸Šçš„å¤‡ç”¨èµ„æºå¾ˆå¯èƒ½è¶³ä»¥å®¹çº³æ•…éšœèŠ‚ç‚¹çš„å·¥ä½œè´Ÿè½½ï¼Œå› æ­¤ Kubernetes å¯ä»¥é‡æ–°å®‰æ’æ‰€æœ‰ Podï¼Œå¹¶ä¸”æ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥ç›¸å¯¹å¿«é€Ÿåœ°æ¢å¤åˆ°å®Œå…¨æ­£å¸¸çš„è¿è¡ŒçŠ¶æ€ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å…è®¸æ›´å¤šå‰¯æœ¬æ•°é‡&#34;&gt;å…è®¸æ›´å¤šå‰¯æœ¬æ•°é‡&lt;/h4&gt;
&lt;p&gt;å¦‚æœæ‚¨æœ‰ä¸€ä¸ªå¤šå‰¯æœ¬é«˜å¯ç”¨åº”ç”¨ç¨‹åºä»¥åŠè¶³å¤Ÿçš„å¯ç”¨èŠ‚ç‚¹ï¼ŒKubernetes è°ƒåº¦ç¨‹åºå¯ä»¥å°†æ¯ä¸ªå‰¯æœ¬åˆ†é…ç»™ä¸åŒçš„èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ‚¨å¯ä»¥é€šè¿‡&lt;a href=&#34;https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#node-affinity&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;èŠ‚ç‚¹äº²å’Œ&lt;/a&gt;ã€&lt;a href=&#34;https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#inter-pod-affinity-and-anti-affinity&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pod äº²å’Œ/åäº²å’Œ&lt;/a&gt;ä»¥åŠ&lt;a href=&#34;https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ±¡ç‚¹å’Œå®¹å¿&lt;/a&gt;æ¥å½±å“è°ƒåº¦ç¨‹åºå¯¹ Pod çš„è°ƒåº¦ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™æ„å‘³ç€å¦‚æœæŸä¸ªèŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œåˆ™æœ€å¤šåªæœ‰ä¸€ä¸ªå‰¯æœ¬å—å½±å“ï¼Œä¸”æ‚¨çš„åº”ç”¨ç¨‹åºä»ç„¶å¯ç”¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨å°èŠ‚ç‚¹çš„åŠ£åŠ¿&#34;&gt;ä½¿ç”¨å°èŠ‚ç‚¹çš„åŠ£åŠ¿&lt;/h3&gt;
&lt;p&gt;&lt;em&gt;çœ‹äº†ä½¿ç”¨æ›´å¤šå°èŠ‚ç‚¹çš„ä¼˜ç‚¹ï¼Œé‚£å®ƒæœ‰ä»€ä¹ˆç¼ºç‚¹å‘¢ï¼Ÿ&lt;/em&gt;&lt;/p&gt;
&lt;h4 id=&#34;è¾ƒå¤§çš„èŠ‚ç‚¹æ•°é‡&#34;&gt;è¾ƒå¤§çš„èŠ‚ç‚¹æ•°é‡&lt;/h4&gt;
&lt;p&gt;å¦‚æœä½¿ç”¨è¾ƒå°çš„èŠ‚ç‚¹ï¼Œåˆ™è‡ªç„¶éœ€è¦æ›´å¤šèŠ‚ç‚¹æ¥å®ç°ç»™å®šçš„é›†ç¾¤å®¹é‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;ä½†æ˜¯å¤§é‡èŠ‚ç‚¹å¯¹ Kubernetes æ§åˆ¶å¹³é¢æ¥è¯´å¯èƒ½æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦èƒ½å¤Ÿä¸å…¶ä»–èŠ‚ç‚¹é€šä¿¡ï¼Œè¿™ä½¿å¾—å¯èƒ½çš„é€šä¿¡è·¯å¾„æ•°é‡ä¼šæŒ‰ç…§èŠ‚ç‚¹æ•°é‡çš„å¹³æ–¹å¢é•¿â€”â€”æ‰€æœ‰èŠ‚ç‚¹éƒ½å¿…é¡»ç”±æ§åˆ¶å¹³é¢ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes controller manager ä¸­çš„èŠ‚ç‚¹æ§åˆ¶å™¨å®šæœŸéå†é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ä»¥è¿è¡ŒçŠ¶å†µæ£€æŸ¥â€”â€”æ›´å¤šèŠ‚ç‚¹æ„å‘³ç€èŠ‚ç‚¹æ§åˆ¶å™¨çš„è´Ÿè½½æ›´å¤šã€‚&lt;/p&gt;
&lt;p&gt;æ›´å¤šèŠ‚ç‚¹åŒæ—¶ä¹Ÿæ„å‘³ç€ etcd æ•°æ®åº“ä¸Šçš„è´Ÿè½½ä¹Ÿæ›´å¤šâ€”â€”æ¯ä¸ª kubelet å’Œ kube-proxy éƒ½ä¼šæˆä¸ºä¸€ä¸ª etcd çš„ &lt;a href=&#34;https://etcd.io/docs/v3.3.12/dev-guide/interacting_v3/#watch-key-changes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;watcher&lt;/a&gt; å®¢æˆ·ç«¯ï¼ˆé€šè¿‡ APIServerï¼‰ï¼Œetcd å¿…é¡»å¹¿æ’­å¯¹è±¡å˜åŒ–åˆ°è¿™äº›å®¢æˆ·ç«¯ã€‚&lt;/p&gt;
&lt;p&gt;é€šå¸¸ï¼Œæ¯ä¸ªå·¥ä½œèŠ‚ç‚¹éƒ½ä¼šå¯¹ä¸»èŠ‚ç‚¹ä¸Šçš„ç³»ç»Ÿç»„ä»¶æ–½åŠ ä¸€äº›å¼€é”€ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34;
           src=&#34;https://cloudnativecn.com/blog/architecting-kubernetes-clusters-choosing-a-worker-node-size/cluster-overload.svg&#34;
           loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ®å®˜æ–¹ç»Ÿè®¡ï¼ŒKubernetes å£°ç§°&lt;a href=&#34;https://kubernetes.io/docs/setup/best-practices/cluster-large/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ”¯æŒæœ€å¤š 5000 ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤&lt;/a&gt;ã€‚ç„¶è€Œï¼Œåœ¨å®è·µä¸­ï¼Œ500 ä¸ªèŠ‚ç‚¹å¯èƒ½å·²ç»å½¢æˆäº†&lt;a href=&#34;https://www.lfasiallc.com/wp-content/uploads/2017/11/BoF_-Not-One-Size-Fits-All-How-to-Size-Kubernetes-Clusters_Guang-Ya-Liu-_-Sahdev-Zala.pdf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å·¨å¤§çš„æŒ‘æˆ˜&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡ä½¿ç”¨æ€§èƒ½æ›´é«˜çš„ä¸»èŠ‚ç‚¹ï¼Œå¾€å¾€å¯ä»¥å‡è½»å¤§é‡å·¥ä½œèŠ‚ç‚¹å¸¦æ¥çš„å½±å“ã€‚è¿™ä¹Ÿæ­£æ˜¯ç›®å‰åœ¨å®è·µä¸­æ‰€åº”ç”¨çš„â€”â€”è¿™é‡Œæ˜¯ &lt;code&gt;kube-up&lt;/code&gt; åœ¨äº‘åŸºç¡€æ¶æ„ä¸Šä½¿ç”¨çš„&lt;a href=&#34;https://kubernetes.io/docs/setup/best-practices/cluster-large/#size-of-master-and-master-components&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸»èŠ‚ç‚¹å¤§å°&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://cloud.google.com/compute/docs/machine-types&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google Cloud Platform&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;5 ä¸ªå·¥ä½œèŠ‚ç‚¹ â†’ &lt;code&gt;n1-standard-1&lt;/code&gt; ä¸»èŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;500 ä¸ªå·¥ä½œèŠ‚ç‚¹ â†’ &lt;code&gt;n1-standard-32&lt;/code&gt; ä¸»èŠ‚ç‚¹&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://aws.amazon.com/ec2/instance-types/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Amazon Web Services&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;5 ä¸ªå·¥ä½œèŠ‚ç‚¹ â†’ &lt;code&gt;m3.medium&lt;/code&gt; ä¸»èŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;500 ä¸ªå·¥ä½œèŠ‚ç‚¹ â†’ &lt;code&gt;c4.8xlarge&lt;/code&gt; ä¸»èŠ‚ç‚¹&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æ‚¨æ‰€è§ï¼Œå¯¹äº 500 ä¸ªå·¥ä½œèŠ‚ç‚¹ï¼Œä½¿ç”¨çš„ä¸»èŠ‚ç‚¹åˆ†åˆ«å…·æœ‰ 32 å’Œ 36 ä¸ª CPU ä»¥åŠ 120GB å’Œ 60GB å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;è¿™äº›éƒ½æ˜¯ç›¸å½“å¤§çš„æœºå™¨ï¼&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œå¦‚æœæ‚¨æ‰“ç®—ä½¿ç”¨å¤§é‡å°èŠ‚ç‚¹ï¼Œåˆ™éœ€è¦è®°ä½ä¸¤ä»¶äº‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‚¨æ‹¥æœ‰çš„å·¥ä½œèŠ‚ç‚¹è¶Šå¤šï¼Œä¸»èŠ‚ç‚¹éœ€è¦çš„æ€§èƒ½å°±è¶Šé«˜&lt;/li&gt;
&lt;li&gt;å¦‚æœæ‚¨è®¡åˆ’ä½¿ç”¨è¶…è¿‡ 500 ä¸ªèŠ‚ç‚¹ï¼Œåˆ™å¯èƒ½ä¼šé‡åˆ°ä¸€äº›éœ€è¦ä»˜å‡ºä¸€äº›åŠªåŠ›æ‰èƒ½è§£å†³çš„æ€§èƒ½ç“¶é¢ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;åƒ &lt;a href=&#34;https://www.youtube.com/watch?v=v9cwYvuzROs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Virtual Kubelet&lt;/a&gt; è¿™æ ·çš„æ–°å¼€å‘äº§å“å…è®¸æ‚¨ç»•è¿‡è¿™äº›é™åˆ¶ï¼Œä»¥æ„å»ºå…·æœ‰å¤§é‡å·¥ä½œèŠ‚ç‚¹çš„é›†ç¾¤ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;æ›´å¤šçš„ç³»ç»Ÿå¼€é”€&#34;&gt;æ›´å¤šçš„ç³»ç»Ÿå¼€é”€&lt;/h4&gt;
&lt;p&gt;Kubernetes åœ¨æ¯ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šè¿è¡Œä¸€ç»„ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹â€”â€”åŒ…æ‹¬å®¹å™¨è¿è¡Œæ—¶ï¼ˆå¦‚ Dockerï¼‰ã€kube-proxy å’ŒåŒ…å« cAdvisor çš„ kubeletã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;cAdvisor åŒ…å«åœ¨ kubelet äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ‰€æœ‰è¿™äº›å®ˆæŠ¤è¿›ç¨‹ä¸€èµ·æ¶ˆè€—å›ºå®šæ•°é‡çš„èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½¿ç”¨è®¸å¤šå°èŠ‚ç‚¹ï¼Œåˆ™è¿™äº›ç³»ç»Ÿç»„ä»¶æ¶ˆè€—çš„èµ„æºå æ¯”ä¼šå¢å¤§ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œå‡è®¾å•ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰ç³»ç»Ÿå®ˆæŠ¤ç¨‹åºä¸€èµ·ä½¿ç”¨ 0.1 ä¸ª CPU å’Œ 0.1GB å†…å­˜ã€‚å¦‚æœæ‚¨æ‹¥æœ‰ 10 ä¸ª CPU å’Œ 10GB å†…å­˜çš„å•ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆå®ˆæŠ¤ç¨‹åºå°†å ç”¨é›†ç¾¤å®¹é‡çš„ 1%ã€‚è€Œå¦‚æœæ‚¨æœ‰ 1 ä¸ª CPU å’Œ 1GB å†…å­˜çš„ 10 ä¸ªèŠ‚ç‚¹ï¼Œåˆ™åå°ç¨‹åºå°†å ç”¨é›†ç¾¤å®¹é‡çš„ 10%ã€‚åœ¨ç¬¬äºŒç§æƒ…å†µä¸‹ï¼Œ10% çš„èµ„æºæ¶ˆè€—ç”¨äºè¿è¡Œç³»ç»Ÿï¼Œè€Œåœ¨ç¬¬ä¸€ç§æƒ…å†µä¸‹ï¼Œå®ƒåªå  1%ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œå¦‚æœæ‚¨å¸Œæœ›æœ€å¤§åŒ–åŸºç¡€æ¶æ„æ”¯å‡ºçš„å›æŠ¥ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½ä¼šå–œæ¬¢æ›´å°‘çš„èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ›´ä½çš„èµ„æºåˆ©ç”¨ç‡&#34;&gt;æ›´ä½çš„èµ„æºåˆ©ç”¨ç‡&lt;/h4&gt;
&lt;p&gt;å¦‚æœæ‚¨ä½¿ç”¨è¾ƒå°çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šäº§ç”Ÿå¤§é‡èµ„æºç¢ç‰‡å› èµ„æºå¤ªå°‘è€Œæ— æ³•åˆ†é…ç»™ä»»ä½•å·¥ä½œè´Ÿè½½ï¼Œæœ€ç»ˆä¿æŒæœªä½¿ç”¨çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨çš„æ‰€æœ‰ Pod éƒ½éœ€è¦ 0.75GB çš„å†…å­˜ã€‚å¦‚æœæ‚¨æœ‰ 10 ä¸ª 1GB å†…å­˜çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæœ€å¤šå¯ä»¥è¿è¡Œ 10 ä¸ªè¿™æ ·çš„ Podâ€”â€”æ‚¨æœ€ç»ˆä¼šåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šæœ‰ä¸€å— 0.25GB çš„å†…å­˜ä¸èƒ½ä½¿ç”¨ã€‚è¿™æ„å‘³ç€ï¼Œé›†ç¾¤æ€»å†…å­˜çš„ 25% è¢«æµªè´¹äº†ã€‚ç›¸åï¼Œå¦‚æœæ‚¨ä½¿ç”¨å…·æœ‰ 10GB å†…å­˜çš„å•ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥è¿è¡Œ 13 ä¸ª Pod â€”â€”æ‚¨æœ€ç»ˆä¼šåœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Šæœ‰ä¸€å— 0.25GB çš„å†…å­˜ä¸èƒ½ä½¿ç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨åªä¼šæµªè´¹ 2.5% çš„å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œå¦‚æœæ‚¨æƒ³æœ€å¤§é™åº¦åœ°å‡å°‘èµ„æºæµªè´¹ï¼Œä½¿ç”¨æ›´å¤§çš„èŠ‚ç‚¹å¯èƒ½ä¼šå¸¦æ¥æ›´å¥½çš„ç»“æœã€‚&lt;/p&gt;
&lt;h4 id=&#34;å°èŠ‚ç‚¹é™åˆ¶-pod-è¿è¡Œæ•°é‡&#34;&gt;å°èŠ‚ç‚¹é™åˆ¶ Pod è¿è¡Œæ•°é‡&lt;/h4&gt;
&lt;p&gt;åœ¨æŸäº›äº‘åŸºç¡€æ¶æ„ä¸Šï¼Œå°èŠ‚ç‚¹ä¸Šå…è®¸çš„æœ€å¤§ Pod æ•°é‡æ¯”æ‚¨é¢„æœŸçš„è¦é™åˆ¶å¾—æ›´å¤šã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://aws.amazon.com/eks/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Amazon Elastic Kubernetes Serviceï¼ˆEKSï¼‰&lt;/a&gt;å°±æ˜¯è¿™ç§æƒ…å†µï¼Œå…¶ä¸­&lt;a href=&#34;https://github.com/awslabs/amazon-eks-ami/blob/master/files/eni-max-pods.txt&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ¯ä¸ªèŠ‚ç‚¹çš„æœ€å¤§ Pod æ•°&lt;/a&gt;å–å†³äºå®ä¾‹ç±»å‹ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œå¯¹äº &lt;code&gt;t2.medium&lt;/code&gt; å®ä¾‹ï¼Œæœ€å¤§ Pod æ•°ä¸º 17ï¼Œ&lt;code&gt;t2.small&lt;/code&gt; ä¸º 11ï¼Œè€Œ &lt;code&gt;t2.micro&lt;/code&gt;ä¸º 4ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;è¿™äº›éƒ½æ˜¯éå¸¸å°çš„æ•°å­—ï¼&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;ä»»ä½•è¶…å‡ºè¿™äº›é™åˆ¶çš„ Pod éƒ½æ— æ³•ç”± Kubernetes è°ƒåº¦ï¼Œå¹¶è¢«æ— é™æœŸåœ°ä¿æŒåœ¨ Pending çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ‚¨ä¸äº†è§£è¿™äº›é™åˆ¶ï¼Œåˆ™å¯èƒ½å¯¼è‡´éš¾ä»¥å‘ç°çš„é”™è¯¯ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œå¦‚æœæ‚¨è®¡åˆ’åœ¨ Amazon EKS ä¸Šä½¿ç”¨å°èŠ‚ç‚¹ï¼Œè¯·&lt;a href=&#34;https://github.com/awslabs/amazon-eks-ami/blob/master/files/eni-max-pods.txt&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ£€æŸ¥ç›¸åº”çš„æ¯èŠ‚ç‚¹ Pod æ•°é‡é™åˆ¶&lt;/a&gt;ï¼Œå¹¶è®¡ç®—èŠ‚ç‚¹æ˜¯å¦å¯ä»¥å®¹çº³æ‰€æœ‰ Podã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;é‚£ä¹ˆï¼Œæ‚¨åº”è¯¥åœ¨é›†ç¾¤ä¸­ä½¿ç”¨æ›´å°‘çš„å¤§èŠ‚ç‚¹è¿˜æ˜¯æ›´å¤šçš„å°èŠ‚ç‚¹å‘¢ï¼Ÿ&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ²¡æœ‰æ˜ç¡®çš„ç­”æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;æ‚¨è¦éƒ¨ç½²åˆ°é›†ç¾¤çš„åº”ç”¨ç¨‹åºç±»å‹å¯èƒ½ä¼šå½±å“æ‚¨çš„å†³ç­–ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºéœ€è¦ 10GB å†…å­˜ï¼Œåˆ™å¯èƒ½ä¸åº”ä½¿ç”¨å°èŠ‚ç‚¹â€”â€”é›†ç¾¤ä¸­çš„èŠ‚ç‚¹åº”è‡³å°‘å…·æœ‰ 10GB å†…å­˜ã€‚æˆ–è€…ï¼Œå¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºéœ€è¦ 10 å‰¯æœ¬ä»¥å®ç°é«˜å¯ç”¨ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½ä¸åº”è¯¥åªä½¿ç”¨ 2 ä¸ªèŠ‚ç‚¹â€”â€”æ‚¨çš„é›†ç¾¤åº”è¯¥è‡³å°‘æœ‰ 10 ä¸ªèŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºä¸­é—´çš„æ‰€æœ‰åœºæ™¯ï¼Œå®ƒå–å†³äºæ‚¨çš„å…·ä½“éœ€æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;ä»¥ä¸Šå“ªé¡¹ä¼˜ç¼ºç‚¹ä¸æ‚¨ç›¸å…³ï¼Ÿå“ªé¡¹ä¸æ‚¨ä¸ç›¸å…³ï¼Ÿ&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;è¯è™½å¦‚æ­¤ï¼Œä½†æ²¡æœ‰è§„åˆ™è¯´æ‰€æœ‰èŠ‚ç‚¹å¿…é¡»å…·æœ‰ç›¸åŒçš„å¤§å°ã€‚æ²¡æœ‰ä»€ä¹ˆèƒ½é˜»æ­¢æ‚¨ä½¿ç”¨ä¸åŒå¤§å°çš„èŠ‚ç‚¹æ¥æ··åˆæ„å»ºé›†ç¾¤ã€‚Kubernetes é›†ç¾¤çš„å·¥ä½œèŠ‚ç‚¹å¯ä»¥æ˜¯å®Œå…¨å¼‚æ„çš„ã€‚è¿™å¯èƒ½ä¼šè®©æ‚¨æƒè¡¡ä¸¤ç§æ–¹æ³•çš„ä¼˜ç¼ºç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œå®è·µæ˜¯æ£€éªŒçœŸç†çš„å”¯ä¸€æ ‡å‡†â€”â€”æœ€å¥½çš„æ–¹æ³•æ˜¯åå¤è¯•éªŒå¹¶æ‰¾åˆ°æœ€é€‚åˆæ‚¨çš„èµ„æºé…ç½®ç»„åˆï¼&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å…¨é¢è¿›åŒ–ï¼šKubernetes CRD 1.16 GA å‰ç»</title>
      <link>https://cloudnativecn.com/blog/kubernetes-1.16-crd-ga-preview/</link>
      <pubDate>Thu, 29 Aug 2019 16:43:58 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/kubernetes-1.16-crd-ga-preview/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šMin Kim(yue9944882)ï¼ŒKubernetes ç¤¾åŒº CRD ç»´æŠ¤è€…ï¼Œèš‚èšé‡‘æœé«˜çº§ç ”å‘å·¥ç¨‹å¸ˆã€‚Kubernetes 1.16 æ‰©å±•æ€§ GA Sprint è¿­ä»£ç»„æˆå‘˜ï¼Œä¸»è¦è´Ÿè´£ CRD OpenAPI èšåˆå‘å¸ƒç›¸å…³ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;éšç€è¿‘æ®µæ—¶é—´ä»¥ CRDï¼ˆCustomResourceDefinitionï¼‰çš„å½¢å¼æ‰©å±• Kubernetes ç«çˆ†èµ·æ¥ï¼Œåœ¨å¼€æºç¤¾åŒºæ¶Œç°äº†è®¸è®¸å¤šå¤šç”¨ CRD ä½œä¸ºå¹³å°æ„å»ºåº”ç”¨çš„æˆåŠŸå¼€æºé¡¹ç›®ã€‚æ•´ä¸ªç¤¾åŒºå¯¹ CRD çš„ç§¯ææ‹¥æŠ±å…¶å®æ˜¯è¿œåœ¨ç»´æŠ¤è€…ä»¬çš„æœŸæœ›ä¹‹å¤–çš„ã€‚ç„¶è€Œç»è¿‡ 5 ä¸ª release çš„æ´—ç¤¼ï¼ŒCRD ä»æœ€å¼€å§‹çš„å®éªŒæ€§é¡¹ç›®æ¸æ¸å˜å¾—æ¸…æ™°äº†èµ·æ¥ï¼Œç¤¾åŒºå¯¹ CRD æ¨¡å‹æå‡ºçš„è®¸è®¸å¤šå¤šå»ºè®®æˆ–è€…æŒ‘æˆ˜ï¼Œå°†åœ¨æœ¬æ¬¡ 1.16 çš„ç‰ˆæœ¬å¾—åˆ°å®Œæ•´çš„è§£å†³å’Œå›åº”ã€‚CRD çš„ GA è®¡åˆ’ä» 1.14 ç‰ˆæœ¬å¼€å§‹æ–©éœ²èŒèŠ½åˆ° Kubenretes 1.16 å…¨åŠ›å†²åˆºçš„ç ”å‘å‘¨æœŸä¸­ï¼Œä¸»è¦è¿‡ç¨‹æ˜¯æ¥è‡ªè°·æ­Œå’Œçº¢å¸½çš„å·¥ç¨‹å¸ˆåœ¨æ‰§è¡Œï¼Œè¿˜æœ‰å°‘æ•°çš„ç¤¾åŒºå¿—æ„¿è€…ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡æœ¬ç¯‡æ–‡ç« ï¼Œä½œè€…å°†é€šè¿‡æ¢³ç† CRD çš„ GA è¿›åŒ–ä¸­çš„ä¸»è¦é©æ–°ç‚¹ï¼ŒåŒæ—¶ç»“åˆ CRD é¢ä¸´çš„é—®é¢˜/ç¼ºé™·è¿›è€Œæ¨å¯¼å‡ºå…¶ä¸­çš„è”ç³»/å› æœï¼Œåœ¨æœ€åè¿˜ä¼šå¯¹ CRD æœªæ¥é¢ä¸´çš„é—®é¢˜å’ŒæŒ‘æˆ˜è¿›è¡Œåˆ†æã€‚å¸Œæœ›è¯»è€…å¯ä»¥é€šè¿‡æœ¬ç¯‡æ–‡ç« å¯¹ CRD çš„æ­£è´Ÿé¢æœ‰ä¸ªç«‹ä½“çš„è®¤è¯†ï¼Œä¹Ÿå€Ÿæ­¤æŠ›ç –å¼•ç‰æå‡ºå¦‚ä½•åœ¨å¤æ‚åœºæ™¯ä¸‹å¼ºåŒ–ä½¿ç”¨ CRD çš„æœªæ¥è®®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ga-ç‰ˆæœ¬-crd-ä¸»è¦å¸¦æ¥çš„é©æ–°&#34;&gt;GA ç‰ˆæœ¬ CRD ä¸»è¦å¸¦æ¥çš„é©æ–°&lt;/h2&gt;
&lt;h3 id=&#34;æ€»è§ˆ&#34;&gt;æ€»è§ˆ&lt;/h3&gt;
&lt;p&gt;å¤§çš„æ–¹å‘ä¸Šï¼Œä¸€è¨€è”½ä¹‹ CRD æ¨¡å‹çš„è¿›åŒ–ä¹‹è·¯æ˜¯æ”¯æŒæ‰€æ‰¿è½½çš„ç”¨æˆ·èµ„æºï¼ˆCRï¼‰__å¯æŒç»­æ¼”è¿›å‘å±•__ä¹‹è·¯ï¼Œå…¶ä¸­åˆä¸»è¦åˆ†ä¸ºä¸¤ä¸ªè·¯çº¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»â€œæ— ç»“æ„åŒ–â€è¿›åŒ–åˆ°â€œå¼ºç»“æ„åŒ–â€&lt;/li&gt;
&lt;li&gt;ä»â€œæ— ç‰ˆæœ¬åŒ–â€è¿›åŒ–åˆ°â€œå¤šç‰ˆæœ¬åŒ–â€&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨ç»“æ„åŒ–çš„ CRD ä¸­ï¼Œä¸ºäº†åœ¨ç®€å•çš„ CRD çš„ Yaml ä¸­å®šä¹‰å‡ºä¸€å¥—ç»“æ„åŒ–çš„æ¨¡å‹ï¼Œæˆ‘ä»¬é¦–å…ˆå€ŸåŠ©äº† OpenAPI è¯­æ³•åŠ›é‡æ¥æè¿°æ¨¡å‹çš„ç»“æ„ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šå†æ¨åŠ¨ CRD å…¨é¢å‘å·²ç»æˆç†Ÿçš„å†…å»ºåŸç”Ÿ API æ¨¡å‹å¤šç‰ˆæœ¬æœºåˆ¶ï¼ˆåŒ…æ‹¬ Defaultingï¼ŒValidatingï¼Œå¤šç‰ˆæœ¬ Round-Trippingï¼‰é æ‹¢ã€‚æœ€ç›´è§‚æ¥çœ‹ï¼Œåœ¨ GA çš„æ¨¡å‹å®šä¹‰å±‚é¢ä¸Šï¼Œæœ€å¤§çš„å˜åŒ–æ˜¯åˆ é™¤äº† CRD çš„ Spec ä¸­é¡¶å±‚çš„æ¨¡å‹æè¿°ç›¸å…³å®šä¹‰ï¼Œä»¥æ­¤æ¨åŠ¨ç”¨æˆ·å…¨é¢ä½¿ç”¨å¤šç‰ˆæœ¬çš„ CRDï¼Œè¿™ä¹Ÿæ˜¯ä¸ Kubernetes åŸç”Ÿæ¨¡å‹å®ç°åŒæ­¥çš„ç¬¬ä¸€æ­¥ï¼ŒåŒæ—¶ GA ç‰ˆæœ¬å¸¦æ¥çš„å…¶ä»–ç‰¹æ€§å¤§å¤šæ˜¯ä¸ºäº†ç»™ç”¨æˆ·æ›´å¥½çš„ä½¿ç”¨å¤šç‰ˆæœ¬ CRD æä¾›é…å¥—çš„åŸºç¡€è®¾æ–½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;crd-defaultingpruning-æ”¯æŒ&#34;&gt;CRD Defaulting/Pruning æ”¯æŒ&lt;/h3&gt;
&lt;p&gt;åœ¨ CRD çš„ GA è®¡åˆ’ä¸­ï¼ŒæŠŠ Defaulting/Pruning ç»“å¯¹æ”¾åœ¨åŒä¸€ä¸ªæ¡ç›®ä¸­æ˜¯å› ä¸ºè¿™ä¸¤è€…å­ªç”Ÿå¯¹åº”å¯¹æ¨¡å‹å­—æ®µçš„å¢åŠ å’Œåˆ é™¤ä¸¤ç§å˜æ›´ã€‚æ·±å…¥ä¸€æ­¥è®²ï¼ŒDefaulting/Pruning çš„æ„ä¹‰æ˜¯ä¸ºäº†è®©ç”¨æˆ·å¯¹ CRD çš„æ¨¡å‹å˜æ›´åŠ å¹³æ»‘ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Defaulting&lt;/strong&gt;ï¼šä¸º CRD æ·»åŠ ä¸€ä¸ªæ–°å­—æ®µçš„æ—¶å€™ï¼Œç”±äºæ•°æ®é¢ï¼ˆå³ Etcd å­˜å‚¨ï¼‰ä¸­å­˜é‡çš„æ•°æ®å¹¶æ²¡æœ‰è¯¥å­—æ®µï¼Œä¼šä½¿å¾—ä» APIServer ä¸­è¯»å–åˆ°çš„å¯¹è±¡è¯¥å­—æ®µåˆå§‹å€¼ä¸º Go è¯­è¨€ä¸­çš„â€œé›¶å€¼â€ã€‚é™¤éåœ¨ç”¨æˆ·æ”¹åŠ¨ Controller çš„å¤„ç†é€»è¾‘åœ¨å…¶ä¸­æ·»åŠ å¯¹åº”â€œé›¶å€¼â€çš„å¤„ç†åˆ†æ”¯ï¼Œè¿™å¾€å¾€ä¼šå¯¼è‡´ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„æ§åˆ¶é¢ Controller å‡ºç°é—®é¢˜ã€‚Defaulting çš„æ”¯æŒå…è®¸ä½ åœ¨ CRD å®šä¹‰â€œå¦‚æœè¯¥å­—æ®µä»æ•°æ®é¢è¯»å‡ºæ—¶ä¸å­˜åœ¨ï¼Œé»˜è®¤è®¾ä¸ºä½•å€¼â€ï¼Œè¿™å¯¹äºæ¨¡å‹çš„æ–°å­—æ®µå˜æ›´æ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Pruning&lt;/strong&gt;ï¼šç”¨æˆ·åœ¨ä¸º CRD åˆ é™¤ä¸€ä¸ªå­—æ®µçš„æ—¶å€™ï¼Œç”±äºæ•°æ®é¢ä¸­å­˜é‡çš„æ•°æ®å·²ç»å­˜åœ¨äº†è¯¥å­—æ®µï¼Œä¼šä½¿å¾—ä» APIServer è¯»å‡ºçš„å®é™…å¯¹è±¡ä»ç„¶æ‹¥æœ‰è¯¥å€¼ã€‚è¿™å’Œç”¨æˆ·å¸Œæœ›å˜æ›´ CRD çš„æ¨¡å‹åˆ é™¤æŸä¸ªå­—æ®µçš„æ„å›¾æ˜¯ç›¸æ‚–çš„ã€‚é‚£ä¹ˆè®¾ç½® Pruning å¯ä»¥å¸®åŠ©ä½ åœ¨å­—æ®µåˆ é™¤åä¿æŒå­˜å‚¨æ•°æ®é¢å’Œ API å±‚é¢çš„ä¸€è‡´ã€‚é¡ºå¸¦ä¸€æçš„æ˜¯ï¼Œå¯¹äºåŸç”Ÿå†…ç½®çš„ Kubernetes æ¨¡å‹ï¼ŒAPIServer åœ¨ä» Etcd æ•°æ®é¢è¯»å–æ•°æ®åååºåˆ—åŒ–æˆå¯¹è±¡æ—¶ï¼Œä½¿ç”¨çš„æ˜¯â€œéä¸¥æ ¼â€çš„ Json/Yaml åºåˆ—åŒ–å™¨ï¼Œæ‰€ä»¥å¯ä»¥å¤©ç„¶å°†æ¨¡å‹ä¸­ä¸è®¤è¯†çš„å­—æ®µè¿‡æ»¤æ‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;crd-webhook-conversion-æ”¯æŒ&#34;&gt;CRD Webhook Conversion æ”¯æŒ&lt;/h3&gt;
&lt;p&gt;é™¤éä½ å¯ä»¥è¿«ä½¿ç”¨æˆ·åœ¨ç‰ˆæœ¬é—´è¿›è¡Œè¿ç§»ï¼Œå¤šç‰ˆæœ¬çš„ CRD å¾€å¾€è¢«è¦æ±‚å¯ä»¥åŒæ—¶æœåŠ¡å¤šä¸ªç‰ˆæœ¬çš„æ¨¡å‹ã€‚æ¯”å¦‚åœ¨åŒä¸€ä¸ªé›†ç¾¤ä¸­ï¼Œä¸€ä¸ªç”¨æˆ· 1 å¯èƒ½æ­£åœ¨ä½¿ç”¨ v1beta1 ç‰ˆæœ¬çš„æ¨¡å‹è¿è¡Œä»–çš„åº”ç”¨æ“ä½œèµ„æº Aï¼Œè€Œå¦ä¸€ä¸ªç”¨æˆ· 2 ä¹ŸåŒæ—¶æ­£åœ¨ä½¿ç”¨æœ€æ–° v1 çš„æ¨¡å‹è¿è¡Œä»–çš„åº”ç”¨æ“ä½œèµ„æº Aï¼Œå¦‚æœ v1 æ¨¡å‹æ¯” v1beta1 æ¨¡å‹æ–°å¢/è¿ç§»äº†ä¸€ä¸ªå­—æ®µï¼Œé‚£ä¹ˆç”¨æˆ· 1 çš„å†™æ“ä½œè‡ªç„¶ä¸ä¼šå­˜åœ¨è¯¥å­—æ®µï¼Œè€Œç”¨æˆ· 2 åœ¨é€šè¿‡å†™æ“ä½œä¸ºè¯¥å­—æ®µèµ‹å€¼æ—¶ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šè¢«ç”¨æˆ· 1 çš„å†™æ“ä½œå°†è¯¥å­—æ®µå†æ¬¡æŠ¹é™¤ã€‚è¿™ä¸ªå…¸å‹çš„é—®é¢˜åœºæ™¯ï¼Œæˆ‘ä»¬åœ¨ç¤¾åŒºå«åš Multi-Version Round-Trippingã€‚è§£å†³è¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯æ•´ä¸ª Kubernetes ç¤¾åŒº SIG API-Machinery å·¥ä½œç»„çš„æ ¸å¿ƒé—®é¢˜ä¹‹ä¸€ã€‚é‚£ä¹ˆå¦‚æœä¿è¯è¿™ä¸¤ä¸ªç”¨æˆ·å¯¹è¿™å¤šç‰ˆæœ¬çš„æ¨¡å‹è¿›è¡Œçš„è¯»å†™éƒ½æˆåŠŸå‘¢ï¼ŸKubernetes çš„è§£æ³•æ˜¯åœ¨èµ„æºçœŸæ­£è½å…¥æ•°æ®é¢ä¹‹å‰è¿›è¡Œç‰ˆæœ¬ä¹‹é—´çš„è½¬åŒ–ï¼ˆConversionï¼‰ï¼Œå¹¶ç¡®è®¤ç»Ÿä¸€å…¶ä¸­ä¸€ä¸ªç‰ˆæœ¬ä¸ºæ•°æ®é¢å­˜å‚¨ä½¿ç”¨çš„ç‰ˆæœ¬ã€‚å¯¹äºåŸç”Ÿçš„ Kubernetes èµ„æºï¼Œè½¬åŒ–çš„å®ç°æ˜¯ä¸€ç³»åˆ— Go è¯­è¨€çš„å‡½æ•°ï¼Œé‚£ä¹ˆå¯¹ CRD è€Œè¨€ï¼Œæˆ‘ä»¬è§£å†³å¤šç‰ˆæœ¬è½¬åŒ–çš„åŠæ³•æ˜¯é€šè¿‡ä¸ºè¯¥èµ„æºæ¤å…¥ä¸€ä¸ª Conversion Webhookï¼Œè¿™ä¸ª Conversion Webhook çš„åŠŸèƒ½åªæœ‰ä¸€ä¸ªï¼Œå°±æ˜¯å‘Šè¯‰ Kubernetes é›†ç¾¤å¦‚ä½•å°†è¿™ä¸ª CRD æ‰¿è½½çš„å¤šä¸ªç‰ˆæœ¬çš„æ¨¡å‹ä¹‹é—´è¿›è¡Œè½¬åŒ–ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¿›ä¸€æ­¥çš„-crd-openapi-schema-é›†æˆ&#34;&gt;è¿›ä¸€æ­¥çš„ CRD OpenAPI Schema é›†æˆ&lt;/h3&gt;
&lt;p&gt;ç›®å‰ OpenAPI çš„æ ‡å‡†è§„èŒƒä¸»è¦æ¶µç›– v2 å’Œ v3 ä¸¤ä¸ªç‰ˆæœ¬ï¼Œv2 æ ‡å‡†åªèƒ½ç”¨æ¥æè¿°éå¸¸ç®€å•æ¨¡å‹å®šä¹‰è¿œä¸èƒ½æ»¡è¶³ Kubernetes çš„æ¨¡å‹ï¼Œè€Œ v3 æ ‡å‡†è¿œè¿‡äºå¤æ‚é€‚é…æˆæœ¬æé«˜ï¼Œå¹¶ä¸”å’Œ v2 æ ‡å‡†ä¸å®Œå…¨å‘åå…¼å®¹ã€‚äº‹å®ä¸Šç›®å‰è¡Œä¸šå†…å‡ ä¹æ²¡æœ‰å¯¹ OpenAPIv3 çš„æ ‡å‡†çš„å®Œæ•´é€‚é…ï¼Œè¿™ä¹Ÿæ˜¯ OpenAPIv3 æœ€å¤§çš„ç—›ç‚¹ã€‚åˆç”±äºåœ¨ Go è¯­è¨€ç”Ÿæ€ä¸­æ²¡æœ‰ç†æƒ³çš„ OpenAPIv3 æ ‡å‡†åº“ï¼Œæ‰€ä»¥ç›®å‰ CRD å¯¹ OpenAPI è¯­æ³•çš„é€‚é…å…¶å®èµ°åˆ°äº†ä¸€ä¸ªéå¸¸å°´å°¬çš„é˜¶æ®µï¼Œä»–å®Œæ•´çš„é€‚é…äº† OpenAPIv2 æ ‡å‡†ï¼Œåˆåªå–äº† OpenAPIv3 æ ‡å‡†ä¸­å¤§æ¦‚ä¸åˆ° 30% çš„è¯­æ³•æ”¯æŒï¼Œè¿™ä¹Ÿæ˜¯ CRD åœ¨æœªæ¥å GA è¿­ä»£å‘¨æœŸä¸­ä¸»è¦éœ€è¦è§£å†³çš„é—®é¢˜ä¹‹ä¸€ã€‚æœ¬æ¬¡ CRD çš„ GA å‘å¸ƒä¸­ï¼ŒåŠ å¼ºäº†å¯¹ OpenAPIv3 è¯­æ³•çš„æ”¯æŒï¼ŒåŒ…æ‹¬ anyOf,oneOf,allOf ä»¥åŠ nullable å…³é”®å­—çš„é€‚é…ã€‚è¿™äº›å…³é”®å­—çš„æ”¯æŒå°†å¸®åŠ©ç”¨æˆ·è¡¨è¾¾å‡ºæ›´å¤æ‚çš„æ¨¡å‹å±‚æ¬¡ç»“æ„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;crd-å­èµ„æºæ”¯æŒæ­£å¼æ¯•ä¸š&#34;&gt;CRD å­èµ„æºæ”¯æŒæ­£å¼æ¯•ä¸š&lt;/h3&gt;
&lt;p&gt;å­èµ„æºç›¸å¯¹æ¥è®²æ˜¯æ˜¯ç›®å‰ CRD çš„æ¯”è¾ƒç¨³å®šçš„åŠŸèƒ½ä¹‹ä¸€ï¼Œå°½ç®¡åœ¨ 1.16 ç‰ˆæœ¬ä¸­å®£å¸ƒæ¯•ä¸šï¼Œä½†æ˜¯å…¶å®ä¹‹å‰çš„ç‰ˆæœ¬çš„å­èµ„æºä»¥åŠè¶‹äºç¨³å®šï¼Œé€šè¿‡æ”¯æŒ Status å­èµ„æºï¼Œç”¨æˆ·ç»“åˆèµ„æºçš„ Generation èµ„æºåœ¨è‡ªå®šä¹‰çš„æ§åˆ¶å™¨ Controller ä¸­æœ‰æ•ˆåˆ¤æ–­å‡ºå®šä¹‰ï¼ˆSpecï¼‰çš„å˜æ›´å’ŒçŠ¶æ€ï¼ˆStatusï¼‰çš„å˜æ›´ã€‚å¦‚æœç”¨æˆ·éœ€è¦ä½¿ç”¨æ›´åŠ è‡ªå®šä¹‰çš„å­èµ„æºæ¯”å¦‚ç±»ä¼¼ pod/logsï¼Œpod/execï¼Œç¤¾åŒºæ¨èä½¿ç”¨ APIServer Aggregation çš„æ–¹å¼è¿›è¡Œæ‰©å±•ï¼Œè¯¦è¯·å‚è€ƒè¿‘æœŸä»å­µåŒ–å™¨æ¯•ä¸šçš„ &lt;a href=&#34;https://github.com/kubernetes-sigs/apiserver-builder-alpha&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes-sigs/apiserver-builder-alpha&lt;/a&gt; é¡¹ç›®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ›´åŠ å¤æ‚åœºæ™¯ä¸‹çš„-crd-ä½¿ç”¨&#34;&gt;æ›´åŠ å¤æ‚åœºæ™¯ä¸‹çš„ CRD ä½¿ç”¨&lt;/h2&gt;
&lt;h3 id=&#34;å¦‚ä½•é€šè¿‡-crd-éƒ¨ç½²æ•°æ®å¯†é›†å‹èµ„æº&#34;&gt;å¦‚ä½•é€šè¿‡ CRD éƒ¨ç½²â€œæ•°æ®å¯†é›†å‹â€èµ„æºï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ä¼—æ‰€å‘¨çŸ¥ï¼ŒCRD çš„åç«¯ç›®å‰å­˜å‚¨æ˜¯ Etcdï¼ŒEtcd æœ‰å¯é çš„å¯ç”¨æ€§å’Œè¯»å†™æ€§èƒ½ï¼Œä½†æ˜¯ç›®å‰åœ¨æ•°æ®å®¹é‡ä¸Šå°šä¸èƒ½æ»¡è¶³å¤§å‹ä¼ä¸šå¯¹å­˜å‚¨å¤§é‡æ•°æ®çš„æ”¯æŒï¼Œç›®å‰ä¸»è¦è§£æ³•æœ‰ä¸¤ç§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å•ç‹¬ç¼–è¯‘ï¼ˆStand-aloneï¼‰å¹¶ä¸”éƒ¨ç½²æä¾› CRD æœåŠ¡çš„ &lt;a href=&#34;https://github.com/kubernetes/apiextensions-apiserver&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;apiextension-apiserver&lt;/a&gt;ï¼Œå†ä»¥ AAï¼ˆAPIServer Aggregation çš„æ–¹å¼ï¼‰æ¥å…¥é›†ç¾¤ï¼Œé€šè¿‡è¿™æ ·å¯ä»¥å°† CRD çš„å­˜å‚¨éš”ç¦»åˆ°ä¸€ä¸ªç‹¬ç«‹çš„ Etcd é›†ç¾¤ï¼Œä»è€Œéš”ç»å¯¹â€Kubernetes ä¸» APIServerâ€œçš„å½±å“ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ä½¿ç”¨ Rancher ç ”å‘çš„ Etcd-on-SQL é€‚é…åº“&lt;a href=&#34;https://github.com/ibuildthecloud/kine&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;KINE&lt;/a&gt;å°†è‡ªå®šä¹‰èµ„æºç›´æ¥è½¬ç§»åˆ° SQL å­˜å‚¨ä¸Šã€‚ç›®å‰ KINE å·²ç»å…·ä½“é«˜å¯ç”¨éƒ¨ç½²ä»¥åŠé€‚é… Etcd Watch/Txnæ¥å£çš„èƒ½åŠ›ï¼Œå¹¶ä¸”å·²åœ¨K3Sçš„é›†æˆæµ‹è¯•å¾—åˆ°äº†å®Œæ•´éªŒè¯ä¹Ÿé€šè¿‡CNCFä¸€è‡´æ€§æµ‹è¯•ã€‚ç›®å‰åœ¨Rancheræ­£åœ¨è€ƒè™‘å°†KINEæèµ ç»™Kubernetesç¤¾åŒºå‘å±•æœ‰æœ›æˆä¸ºè¡Œä¸šæ ‡å‡†ã€‚å¯¹Kubernetesé€‚é…MySQLæ„Ÿå…´è¶£çš„å¼€å‘è€…å¯ä»¥è€ƒè™‘é€šè¿‡&lt;a href=&#34;https://github.com/kubernetes-sigs/apiserver-builder-alpha#examples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹æä¾›çš„ Example&lt;/a&gt;è¿›è¡Œ PoC æ¼”ç»ƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å¦‚ä½•é€šè¿‡-crd-ç”Ÿæˆå…¶ä»–è¯­è¨€çš„å®¢æˆ·ç«¯&#34;&gt;å¦‚ä½•é€šè¿‡ CRD ç”Ÿæˆå…¶ä»–è¯­è¨€çš„å®¢æˆ·ç«¯ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;CRD çš„ GA æ¼”è¿›ä¸­é‡è¦çš„ä¸€ç¯æ˜¯ OpenAPI å‘å¸ƒèƒ½åŠ›çš„å¼ºåŒ–ï¼Œé€šè¿‡å¯¹é›†ç¾¤è®¿é—®&lt;code&gt;/openapi/v2&lt;/code&gt;æˆ–è€…&lt;code&gt;/openapi/v3ï¼ˆç ”å‘ä¸­ï¼‰&lt;/code&gt;çš„ API å¯ä»¥å®Œæ•´ä¸‹è½½åˆ°åŒ…æ‹¬ç”¨æˆ· CRD çš„å®Œæ•´ OpenAPI æ–‡æ¡£ã€‚é€šè¿‡ç»“åˆä½¿ç”¨ OpenAPI ä»£ç ç”Ÿæˆå™¨ &lt;a href=&#34;https://github.com/OpenAPITools/openapi-generator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OpenAPITools/openapi-generator&lt;/a&gt;ï¼Œæˆ‘ä»¬å¯ä»¥å®šåˆ¶åœ°ä¸ºè‡ªå·±çš„ CRD ç”Ÿæˆå„ç§è¯­è¨€å„å¼å„æ ·çš„å®¢æˆ·ç«¯ SDKï¼Œå€¼å¾—ä¸€æçš„æ˜¯å®˜æ–¹çš„å¼‚æ„è¯­è¨€ SDK éƒ½æ˜¯é€šè¿‡ OpenAPI æ–‡æ¡£ç”Ÿæˆå¾—åˆ°çš„ã€‚å¯¹äºç”Ÿæˆ Java å®¢æˆ·ç«¯æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å‚è€ƒ&lt;a href=&#34;https://github.com/kubernetes-client/java/blob/master/docs/generate-model-from-third-party-resources.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™ç¯‡æ–‡æ¡£&lt;/a&gt;ï¼Œè¿›è¡Œ PoC å®éªŒã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å®¹å™¨åŒ–åˆ°å®¹å™¨ç¼–æ’ä¹‹æ—…</title>
      <link>https://cloudnativecn.com/blog/journey-from-containerization-to-orchestration-and-beyond/</link>
      <pubDate>Wed, 28 Aug 2019 10:42:00 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/journey-from-containerization-to-orchestration-and-beyond/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://iximiuz.com/en/posts/journey-from-containerization-to-orchestration-and-beyond/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¼–è€…æŒ‰&#34;&gt;ç¼–è€…æŒ‰&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡æ˜¯ä¸€ç¯‡ä»‹ç»å®¹å™¨è¿è¡Œæ—¶å’Œç®¡ç†å·¥å…·çš„æ–‡ç« ã€‚æ–‡ä¸­å¯¹ä¸»è¦çš„å®¹å™¨ç®¡ç†é¡¹ç›®å’ŒæŠ€æœ¯åšäº†è¾ƒä¸ºè¯¦ç»†çš„ä»‹ç»å’Œæ¨ªå‘å¯¹æ¯”ï¼Œå¹¶ç»™å‡ºäº†é¡¹ç›®çš„ä»£ç åº“ä¾›è¯»è€…å‚è€ƒã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;å®¹å™¨å¸¦æ¥äº†æ›´é«˜çº§çš„æœåŠ¡ç«¯æ¶æ„å’Œæ›´å¤æ‚çš„éƒ¨ç½²æŠ€æœ¯ã€‚ç›®å‰å·²ç»æœ‰ä¸€å †ç±»ä¼¼æ ‡å‡†çš„è§„èŒƒï¼ˆ&lt;a href=&#34;https://github.com/opencontainers/runtime-spec&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;1&lt;/a&gt;, &lt;a href=&#34;https://github.com/opencontainers/image-spec&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2&lt;/a&gt;, &lt;a href=&#34;https://kubernetes.io/blog/2016/12/container-runtime-interface-cri-in-kubernetes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;3&lt;/a&gt;, &lt;a href=&#34;https://github.com/containernetworking/cni&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;4&lt;/a&gt;, â€¦â€¦ï¼‰æè¿°äº†å®¹å™¨é¢†åŸŸçš„æ–¹æ–¹é¢é¢ã€‚å½“ç„¶ï¼Œå®ƒçš„åº•å±‚æ˜¯ Linux çš„åŸºæœ¬å•å…ƒï¼Œå¦‚ namespace å’Œ cgroupsã€‚å®¹å™¨åŒ–è½¯ä»¶å·²ç»å˜å¾—éå¸¸çš„åºå¤§ï¼Œå¦‚æœæ²¡æœ‰å®ƒè‡ªå·±å…³æ³¨çš„åˆ†ç¦»å±‚ï¼Œå‡ ä¹æ˜¯ä¸å¯èƒ½å®ç°çš„ã€‚åœ¨è¿™ä¸ªæŒç»­åŠªåŠ›çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘å°è¯•å¼•å¯¼è‡ªå·±ä»æœ€åº•å±‚åˆ°æœ€é«˜å±‚å°½å¯èƒ½å¤šçš„å®è·µï¼ˆä»£ç ã€å®‰è£…ã€é…ç½®ã€é›†æˆç­‰ç­‰ï¼‰ï¼Œå½“ç„¶è¿˜æœ‰å°½å¯èƒ½å¤šçš„è·å¾—ä¹è¶£ã€‚æœ¬ç¯‡å†…å®¹ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œæ”¹å˜ï¼Œå¹¶åæ˜ å‡ºæˆ‘å¯¹è¿™ä¸€ä¸»é¢˜çš„ç†è§£ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®¹å™¨è¿è¡Œæ—¶&#34;&gt;å®¹å™¨è¿è¡Œæ—¶&lt;/h2&gt;
&lt;p&gt;æˆ‘æƒ³ä»æœ€åº•å±‚çš„éå†…æ ¸åŸè¯­è¯´èµ·â€”â€”&lt;strong&gt;å®¹å™¨è¿è¡Œæ—¶&lt;/strong&gt;ã€‚åœ¨å®¹å™¨æœåŠ¡é‡Œï¼Œè¿è¡Œæ—¶è¿™ä¸ªè¯æ˜¯æœ‰æ­§ä¹‰çš„ã€‚æ¯ä¸ªé¡¹ç›®ã€å…¬å¸æˆ–ç¤¾åŒºå¯¹æœ¯è¯­&lt;strong&gt;å®¹å™¨è¿è¡Œæ—¶&lt;/strong&gt;éƒ½æœ‰è‡ªå·±çš„ã€é€šå¸¸æ˜¯åŸºäºä¸Šä¸‹æ–‡çš„ç‰¹å®šç†è§£ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿è¡Œæ—¶çš„ç‰¹å¾æ˜¯ç”±ä¸€ç»„èŒè´£å®šä¹‰çš„ï¼Œä»æœ€åŸºæœ¬çš„èŒè´£ï¼ˆåˆ›å»º namespaceã€å¯åŠ¨&lt;em&gt;init&lt;/em&gt;è¿›ç¨‹ï¼‰åˆ°å¤æ‚çš„å®¹å™¨ç®¡ç†ï¼ŒåŒ…æ‹¬ï¼ˆä½†ä¸é™äºï¼‰é•œåƒæ“ä½œã€‚&lt;a href=&#34;https://www.ianlewis.org/en/container-runtimes-part-1-introduction-container-r&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™ç¯‡æ–‡ç« &lt;/a&gt;å¯¹è¿è¡Œæ—¶æœ‰ä¸€ä¸ªå¾ˆå¥½çš„æ¦‚è¿°ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://iximiuz.com/journey-from-containerization-to-orchestration-and-beyond/runtime-levels.png&#34; alt=&#34;img&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœ¬èŠ‚ä¸“é—¨è®¨è®ºä½é˜¶å®¹å™¨è¿è¡Œæ—¶ã€‚åœ¨&lt;a href=&#34;https://github.com/opencontainers/runtime-spec&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OCI è¿è¡Œæ—¶è§„èŒƒ&lt;/a&gt;ä¸­ï¼Œç»„æˆ&lt;a href=&#34;https://www.opencontainers.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Open Container Initiative&lt;/a&gt;çš„ä¸€äº›é‡è¦å‚ä¸è€…å¯¹åº•å±‚è¿è¡Œæ—¶è¿›è¡Œäº†æ ‡å‡†åŒ–ã€‚é•¿è¯çŸ­è¯´ï¼Œä½é˜¶å®¹å™¨è¿è¡Œæ—¶æ˜¯ä¸€ä¸ªè½¯ä»¶ï¼Œä½œä¸ºä¸€ä¸ªåŒ…å« rootfs å’Œé…ç½®çš„ç›®å½•è¾“å…¥ï¼Œæ¥æè¿°å®¹å™¨å‚æ•°ï¼ˆå¦‚èµ„æºé™åˆ¶ã€æŒ‚è½½ç‚¹ã€æµç¨‹å¼€å§‹ç­‰ï¼‰ï¼Œå¹¶ä½œä¸ºè¿è¡Œæ—¶å¯åŠ¨ä¸€ä¸ªç‹¬ç«‹è¿›ç¨‹ï¼Œå³å®¹å™¨ã€‚&lt;/p&gt;
&lt;p&gt;åˆ° 2019 å¹´ï¼Œä½¿ç”¨æœ€å¹¿æ³›çš„å®¹å™¨è¿è¡Œæ—¶æ˜¯&lt;a href=&#34;https://github.com/opencontainers/runc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;runc&lt;/a&gt;ã€‚è¿™ä¸ªé¡¹ç›®æœ€åˆæ˜¯ Docker çš„ä¸€éƒ¨åˆ†ï¼ˆå› æ­¤å®ƒæ˜¯ç”¨ Go ç¼–å†™çš„ï¼‰ï¼Œä½†æœ€ç»ˆè¢«æå–å¹¶è½¬æ¢ä¸ºä¸€ä¸ªç‹¬ç«‹çš„ CLI å·¥å…·ã€‚å¾ˆéš¾é«˜ä¼°è¿™ä¸ªç»„ä»¶çš„é‡è¦æ€§â€”â€”åŸºæœ¬ä¸Š runc æ˜¯ OCI è¿è¡Œæ—¶è§„èŒƒçš„ä¸€ä¸ªå‚è€ƒå®ç°ã€‚åœ¨æˆ‘ä»¬çš„å®è·µä¸­å°†å¤§é‡ä½¿ç”¨ runcï¼Œä¸‹é¢æ˜¯&lt;a href=&#34;https://iximiuz.com/en/posts/implementing-container-runtime-shim/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸€ç¯‡ä»‹ç»æ€§æ–‡ç« &lt;/a&gt;ï¼ˆç¼–è€…æ³¨ï¼šé¡µé¢æš‚æ— å†…å®¹ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://iximiuz.com/journey-from-containerization-to-orchestration-and-beyond/runc.png&#34; alt=&#34;img&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªæ›´å€¼å¾—æ³¨æ„çš„ OCI è¿è¡Œæ—¶å®ç°æ˜¯&lt;a href=&#34;https://github.com/containers/crun&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;crun&lt;/a&gt;ã€‚å®ƒç”¨ C è¯­è¨€ç¼–å†™ï¼Œæ—¢å¯ä»¥ä½œä¸ºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºåº“ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®¹å™¨ç®¡ç†&#34;&gt;å®¹å™¨ç®¡ç†&lt;/h2&gt;
&lt;p&gt;åœ¨å‘½ä»¤è¡Œä¸­å¯ä»¥ä½¿ç”¨ runc å¯åŠ¨ä»»æ„æ•°é‡çš„å®¹å™¨ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦è®©è¿™ä¸ªè¿‡ç¨‹è‡ªåŠ¨åŒ–å‘¢ï¼Ÿå‡è®¾æˆ‘ä»¬éœ€è¦å¯åŠ¨æ•°åä¸ªå®¹å™¨æ¥è·Ÿè¸ªå®ƒä»¬çš„çŠ¶æ€ï¼Œå…¶ä¸­ä¸€äº›åœ¨å¤±è´¥æ—¶éœ€è¦é‡å¯ï¼Œåœ¨ç»ˆæ­¢æ—¶éœ€è¦é‡Šæ”¾èµ„æºï¼Œå¿…é¡»ä»æ³¨å†Œä¸­å¿ƒæå–é•œåƒï¼Œéœ€è¦é…ç½®å®¹å™¨é—´ç½‘ç»œç­‰ç­‰ã€‚è¿™æ˜¯ä¸€ä¸ªç¨å¾®é«˜çº§çš„ä»»åŠ¡ï¼Œå¹¶ä¸”æ˜¯â€œå®¹å™¨ç®¡ç†å™¨â€çš„èŒè´£ã€‚è€å®è¯´ï¼Œæˆ‘ä¸çŸ¥é“è¿™ä¸ªè¯æ˜¯å¦å¸¸ç”¨ï¼Œä½†æˆ‘å‘ç°ç”¨å®ƒæ¥æè¿°å¾ˆåˆé€‚ã€‚æˆ‘å°†ä»¥ä¸‹é¡¹ç›®å½’ç±»ä¸ºâ€œå®¹å™¨ç®¡ç†å™¨â€ï¼š&lt;a href=&#34;https://iximiuz.com/en/posts/journey-from-containerization-to-orchestration-and-beyond/#containerd&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;containerd&lt;/a&gt;ï¼Œ &lt;a href=&#34;https://iximiuz.com/en/posts/journey-from-containerization-to-orchestration-and-beyond/#cri-o&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cri-o&lt;/a&gt;ï¼Œ &lt;a href=&#34;https://iximiuz.com/en/posts/journey-from-containerization-to-orchestration-and-beyond/#dockerd&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;dockerd&lt;/a&gt; å’Œ &lt;a href=&#34;https://iximiuz.com/en/posts/journey-from-containerization-to-orchestration-and-beyond/#podman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;podman&lt;/a&gt;.&lt;/p&gt;
&lt;h3 id=&#34;containerd&#34;&gt;containerd&lt;/h3&gt;
&lt;p&gt;ä¸ runc ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å†æ¬¡çœ‹åˆ° Docker çš„é—äº§â€”â€”&lt;a href=&#34;https://github.com/containerd/containerd&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;containerd&lt;/a&gt;æ›¾ç»æ˜¯ Docker é¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼Œç°åœ¨å®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è½¯ä»¶ï¼Œè‡ªç§°ä¸ºå®¹å™¨è¿è¡Œæ—¶ã€‚ä½†æ˜¾ç„¶ï¼Œå®ƒä¸è¿è¡Œæ—¶ runc ä¸æ˜¯åŒä¸€ç§ç±»å‹çš„è¿è¡Œæ—¶ã€‚ä¸ä»…å®ƒä»¬çš„èŒè´£ä¸åŒï¼Œå…¶ç»„ç»‡å½¢å¼ä¹Ÿä¸åŒã€‚runc åªæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œcontainerd æ˜¯ä¸€ä¸ªé•¿æ´»çš„å®ˆæŠ¤è¿›ç¨‹ã€‚ä¸€ä¸ª runc å®ä¾‹ä¸èƒ½æ¯”åº•å±‚å®¹å™¨è¿›ç¨‹æ´»å¾—æ›´ä¹…ã€‚é€šå¸¸ï¼Œå®ƒåœ¨&lt;code&gt;create&lt;/code&gt;è°ƒç”¨æ—¶å¯åŠ¨ï¼Œç„¶ååœ¨&lt;code&gt;start&lt;/code&gt;æ—¶ä»å®¹å™¨çš„ rootfs ä¸­&lt;a href=&#34;https://linux.die.net/man/3/exec&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;exec&lt;/code&gt;&lt;/a&gt;ç‰¹å®šæ–‡ä»¶ã€‚å¦ä¸€æ–¹é¢ï¼Œcontainerd å¯ä»¥è¿è¡Œçš„æ¯”æˆåƒä¸Šä¸‡ä¸ªå®¹å™¨æ›´é•¿ä¹…ã€‚å®ƒæ›´åƒæ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œä¾¦å¬ä¼ å…¥çš„è¯·æ±‚æ¥å¯åŠ¨ã€åœæ­¢æˆ–æŠ¥å‘Šå®¹å™¨çš„çŠ¶æ€ã€‚åœ¨å¹•åï¼Œcontainerd ä½¿ç”¨ runcã€‚å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªå®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨ï¼Œè¿˜è´Ÿè´£é•œåƒç®¡ç†ï¼ˆä»æ³¨å†Œè¡¨ä¸­æ‹‰å–å’Œæäº¤é•œåƒï¼Œæœ¬åœ°å­˜å‚¨é•œåƒç­‰ç­‰ï¼‰ï¼Œè·¨å®¹å™¨è”ç½‘ç®¡ç†å’Œå…¶ä»–ä¸€äº›åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://iximiuz.com/journey-from-containerization-to-orchestration-and-beyond/containerd.png&#34; alt=&#34;img&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;cri-o&#34;&gt;cri-o&lt;/h3&gt;
&lt;p&gt;å¦ä¸€ä¸ªå®¹å™¨ç®¡ç†å™¨æ˜¯&lt;a href=&#34;https://github.com/cri-o/cri-o&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cri-o&lt;/a&gt;ã€‚containerd æ˜¯ Docker é‡æ„åçš„ç»“æœï¼Œä½† cri-o å´æºäº Kubernetes é¢†åŸŸã€‚åœ¨è¿‡å»ï¼ŒKubernetes ä½¿ç”¨ Docker ç®¡ç†å®¹å™¨ã€‚ç„¶è€Œï¼Œéšç€&lt;a href=&#34;https://github.com/rkt/rkt&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rkt&lt;/a&gt;çš„å´›èµ·ï¼Œä¸€äº›äººå¢åŠ äº†åœ¨ Kubernetes ä¸­å¯äº’æ¢å®¹å™¨è¿è¡Œæ—¶çš„æ”¯æŒï¼Œå…è®¸ Docker å’Œ/æˆ– rkt å®Œæˆå®¹å™¨ç®¡ç†ã€‚è¿™ç§å˜åŒ–å¯¼è‡´ Kubernetes ä¸­æœ‰å¤§é‡çš„æ¡ä»¶åˆ¤æ–­ï¼Œæ²¡æœ‰äººå–œæ¬¢ä»£ç ä¸­æœ‰å¤ªå¤šçš„â€œifâ€ã€‚å› æ­¤ï¼Œ&lt;a href=&#34;https://kubernetes.io/blog/2016/12/container-runtime-interface-cri-in-kubernetes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®¹å™¨è¿è¡Œæ—¶æ¥å£ï¼ˆCRIï¼‰&lt;/a&gt;è¢«å¼•å…¥åˆ° Kubernetes ä¸­ï¼Œè¿™ä½¿å¾—ä»»ä½•å…¼å®¹ CRI çš„é«˜é˜¶è¿è¡Œæ—¶ï¼ˆä¾‹å¦‚å®¹å™¨ç®¡ç†å™¨ï¼‰éƒ½å¯ä»¥åœ¨ Kubernetes ä¸­ä½¿ç”¨ï¼Œè€Œæ— éœ€ä»»ä½•ä»£ç çš„æ›´æ”¹ã€‚cri-o æ˜¯ RedHat å®ç°çš„å…¼å®¹ CRI çš„è¿è¡Œæ—¶ï¼Œä¸ containerd ä¸€æ ·ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œé€šè¿‡å¼€æ”¾ä¸€ä¸ª gRPC æœåŠ¡æ¥å£æ¥åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ï¼ˆä»¥åŠè®¸å¤šå…¶ä»–æ“ä½œï¼‰å®¹å™¨ã€‚åœ¨åº•å±‚ï¼Œcri-o å¯ä»¥ä½¿ç”¨ä»»ä½•ç¬¦åˆ OCI æ ‡å‡†çš„ä½é˜¶è¿è¡Œæ—¶å’Œå®¹å™¨å·¥ä½œï¼Œé»˜è®¤çš„è¿è¡Œæ—¶ä»ç„¶æ˜¯ runcã€‚cri-o çš„ä¸»è¦ç›®æ ‡æ˜¯ä½œä¸º Kubernetes çš„å®¹å™¨è¿è¡Œæ—¶ï¼Œç‰ˆæœ¬æ§åˆ¶ä¹Ÿä¸ K8S ä¸€è‡´ï¼Œé¡¹ç›®çš„èŒƒå›´ç•Œå®šçš„å¾ˆå¥½ï¼Œå…¶ä»£ç åº“ä¹Ÿæ¯”æœŸæœ›çš„æ›´å°ï¼ˆæˆªæ­¢ 2019 å¹´ 7 æœˆå¤§çº¦æ˜¯ 20 ä¸ª CLOCï¼Œè¿‘ä¼¼äº containerd çš„ 5 å€ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://iximiuz.com/journey-from-containerization-to-orchestration-and-beyond/cri-o.png&#34; alt=&#34;img&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;cri-o æ¶æ„ (å›¾åƒæ¥è‡ª cri-o.io)&lt;/p&gt;
&lt;p&gt;è§„èŒƒçš„å¥½å¤„æ˜¯æ‰€æœ‰ç¬¦åˆè§„èŒƒçš„æŠ€æœ¯éƒ½å¯ä»¥äº’æ¢ä½¿ç”¨ã€‚ä¸€æ—¦ CRI è¢«å¼•å…¥ï¼Œä¸€ä¸ª containerd çš„æ’ä»¶å°±å¯ä»¥åœ¨å®ƒçš„åŠŸèƒ½ä¹‹ä¸Šå®ç° CRI çš„ gRPC æœåŠ¡ã€‚è¿™ä¸ªæƒ³æ³•æ˜¯å¯è¡Œçš„ï¼Œæ‰€ä»¥åæ¥ containerd è·å¾—äº†åŸç”Ÿçš„ CRI æ”¯æŒã€‚å› æ­¤ï¼ŒKubernetes å¯ä»¥åŒæ—¶ä½¿ç”¨ cri-o å’Œ containerd ä½œä¸ºè¿è¡Œæ—¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;dockerd&#34;&gt;dockerd&lt;/h3&gt;
&lt;p&gt;è¿˜æœ‰ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹æ˜¯&lt;a href=&#34;https://github.com/moby/moby/tree/master/cmd/dockerd&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;dockerd&lt;/a&gt;ï¼Œå®ƒæ˜¯ä¸ªå¤šé¢æ‰‹ã€‚ä¸€æ–¹é¢ï¼Œå®ƒä¸º&lt;a href=&#34;https://github.com/docker/cli&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Docker å‘½ä»¤è¡Œ&lt;/a&gt; å¼€æ”¾äº†ä¸€ä¸ª APIï¼Œä¸ºæˆ‘ä»¬æä¾›äº†æ‰€æœ‰è¿™äº›å¸¸ç”¨çš„ Docker å‘½ä»¤ï¼ˆ&lt;code&gt;Docker pull&lt;/code&gt;ã€&lt;code&gt;Docker push&lt;/code&gt;ã€&lt;code&gt;Docker run&lt;/code&gt;ã€&lt;code&gt;Docker stats&lt;/code&gt;ç­‰ï¼‰ã€‚ä½†æ˜¯æˆ‘ä»¬å·²ç»çŸ¥é“è¿™éƒ¨åˆ†åŠŸèƒ½è¢«æå–åˆ°äº† containerd ä¸­ï¼Œæ‰€ä»¥åœ¨åº•å±‚ dockerd ä¾èµ–äº containerd å°±ä¸è¶³ä¸ºå¥‡äº†ã€‚ä½†è¿™åŸºæœ¬ä¸Šæ„å‘³ç€ dockerd åªæ˜¯ä¸€ä¸ªå‰ç«¯é€‚é…å™¨ï¼Œå®ƒå°† containerd çš„ API è½¬æ¢ä¸ºå¹¿æ³›ä½¿ç”¨çš„ docker å¼•æ“çš„ APIã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/moby/moby&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;dockerd&lt;/a&gt;ï¼ˆç¼–è€…æ³¨ï¼šåŸæ–‡é“¾æ¥æ˜¯ moby é¡¹ç›®ï¼‰ä¹Ÿæä¾›äº†&lt;code&gt;compose&lt;/code&gt;å’Œ&lt;code&gt;swarm&lt;/code&gt;åŠŸèƒ½ï¼Œè¯•å›¾è§£å†³å®¹å™¨ç¼–é…é—®é¢˜ï¼ŒåŒ…æ‹¬å®¹å™¨çš„å¤šæœºå™¨é›†ç¾¤ã€‚æ­£å¦‚æˆ‘ä»¬åœ¨ Kubernetes ä¸Šçœ‹åˆ°çš„ï¼Œè¿™ä¸ªé—®é¢˜ç›¸å½“éš¾è§£å†³ã€‚å¯¹äºä¸€ä¸ªå• dockerd å®ˆæŠ¤è¿›ç¨‹æ¥è¯´ï¼ŒåŒæ—¶æ‰¿æ‹…ä¸¤å¤§èŒè´£å¹¶ä¸å¥½ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://iximiuz.com/journey-from-containerization-to-orchestration-and-beyond/dockerd.png&#34; alt=&#34;img&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;dockerd æ˜¯ containerd å‰ç«¯çš„ä¸€éƒ¨åˆ†ï¼ˆå›¾ç‰‡æ¥æºäº Docker Blogï¼‰&lt;/p&gt;
&lt;h3 id=&#34;podman&#34;&gt;podman&lt;/h3&gt;
&lt;p&gt;å®ˆæŠ¤è¿›ç¨‹ä¸­ä¸€ä¸ªæœ‰è¶£çš„ä¾‹å¤–æ˜¯&lt;a href=&#34;https://github.com/containers/libpod&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;podman&lt;/a&gt;ã€‚è¿™æ˜¯å¦ä¸€ä¸ª Red Hat é¡¹ç›®ï¼Œç›®çš„æ˜¯æä¾›ä¸€ä¸ªåä¸º&lt;code&gt;libpod&lt;/code&gt;çš„åº“ï¼ˆè€Œä¸æ˜¯å®ˆæŠ¤è¿›ç¨‹ï¼‰æ¥ç®¡ç†é•œåƒã€å®¹å™¨ç”Ÿå‘½å‘¨æœŸå’Œ podï¼ˆå®¹å™¨ç»„ï¼‰ã€‚&lt;code&gt;podman&lt;/code&gt;æ˜¯ä¸€ä¸ªæ„å»ºåœ¨è¿™ä¸ªåº“ä¹‹ä¸Šçš„å‘½ä»¤è¡Œç®¡ç†å·¥å…·ã€‚ä½œä¸ºä¸€ä¸ªä½é˜¶çš„å®¹å™¨è¿è¡Œæ—¶ï¼Œè¿™ä¸ªé¡¹ç›®ä¹Ÿä½¿ç”¨ runcã€‚ä»ä»£ç è§’åº¦æ¥çœ‹ï¼Œpodman å’Œ cri-oï¼ˆéƒ½æ˜¯ Red Hat é¡¹ç›®ï¼‰æœ‰å¾ˆå¤šå…±åŒç‚¹ã€‚ä¾‹å¦‚ï¼Œå®ƒä»¬éƒ½åœ¨å†…éƒ¨ä½¿ç”¨&lt;a href=&#34;https://github.com/containers/storage&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;storage&lt;/a&gt;å’Œ&lt;a href=&#34;https://github.com/containers/image&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;image&lt;/a&gt;åº“ã€‚å¦ä¸€é¡¹æ­£åœ¨è¿›è¡Œçš„å·¥ä½œæ˜¯åœ¨ cri-o ä¸­ç›´æ¥ä½¿ç”¨ libpod è€Œä¸æ˜¯ runcã€‚podman çš„å¦ä¸€ä¸ªæœ‰è¶£çš„ç‰¹æ€§æ˜¯ç”¨ drop-in æ›¿æ¢ä¸€äº›ï¼ˆæœ€æµè¡Œçš„ï¼Ÿï¼‰æ—¥å¸¸å·¥ä½œæµç¨‹ä¸­çš„&lt;code&gt;docker&lt;/code&gt;å‘½ä»¤ã€‚è¯¥é¡¹ç›®å£°ç§°å…¼å®¹ï¼ˆåœ¨ä¸€å®šç¨‹åº¦ä¸Šï¼‰docker CLI APIã€‚&lt;/p&gt;
&lt;p&gt;æ—¢ç„¶æˆ‘ä»¬å·²ç»æœ‰äº† dockerdã€containerd å’Œ cri-oï¼Œä¸ºä»€ä¹ˆè¿˜è¦å¼€å‘è¿™æ ·çš„é¡¹ç›®å‘¢ï¼Ÿå®ˆæŠ¤è¿›ç¨‹ä½œä¸ºå®¹å™¨ç®¡ç†å™¨çš„é—®é¢˜æ˜¯ï¼Œå®ƒä»¬å¤§å¤šæ•°æ—¶å€™å¿…é¡»ä½¿ç”¨ root æƒé™è¿è¡Œã€‚å°½ç®¡ç”±äºå®ˆæŠ¤è¿›ç¨‹çš„æ•´ä½“æ€§ï¼Œç³»ç»Ÿä¸­æ²¡æœ‰ root æƒé™ä¹Ÿå¯ä»¥å®Œæˆå…¶ 90% çš„åŠŸèƒ½ï¼Œä½†æ˜¯å‰©ä¸‹çš„ 10% éœ€è¦ä»¥ root å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹ã€‚ä½¿ç”¨ podmanï¼Œæœ€ç»ˆæœ‰å¯èƒ½ä½¿ Linux ç”¨æˆ·çš„ namespace æ‹¥æœ‰æ— æ ¹ï¼ˆrootlessï¼‰å®¹å™¨ã€‚è¿™å¯èƒ½æ˜¯ä¸€ä¸ªå¤§é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨å¹¿æ³›çš„ CI æˆ–å¤šç§Ÿæˆ·ç¯å¢ƒä¸­ï¼Œå› ä¸ºå³ä½¿æ˜¯æ²¡æœ‰æƒé™çš„ Docker å®¹å™¨å®é™…ä¸Šä¹Ÿåªæ˜¯ç³»ç»Ÿä¸Šçš„&lt;a href=&#34;https://brauner.github.io/2019/02/12/privileged.containes.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸€ä¸ªæ²¡æœ‰ root è®¿é—®æƒé™çš„å†…æ ¸é”™è¯¯&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºè¿™ä¸ªæœ‰è¶£é¡¹ç›®çš„æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨ &lt;a href=&#34;http://crunchtools.com/podman-and-cri-o-in-rhel-8-and-openshift-4&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt; å’Œ &lt;a href=&#34;https://www.redhat.com/en/blog/why-red-hat-investing-cri-o-and-podman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;æ‰¾åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://iximiuz.com/journey-from-containerization-to-orchestration-and-beyond/podman.png&#34; alt=&#34;img&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;conman&#34;&gt;conman&lt;/h3&gt;
&lt;p&gt;è¿™æ˜¯æˆ‘æ­£åœ¨åšçš„&lt;a href=&#34;https://github.com/iximiuz/conman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é¡¹ç›®&lt;/a&gt;ï¼Œç›®çš„æ˜¯å®ç°ä¸€ä¸ªå¾®å‹å®¹å™¨ç®¡ç†å™¨ã€‚å®ƒä¸»è¦ç”¨äºæ•™å­¦ç›®çš„ï¼Œä½†æ˜¯æœ€ç»ˆçš„ç›®æ ‡æ˜¯ä½¿å®ƒå…¼å®¹ CRIï¼Œå¹¶ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶è¿è¡Œåœ¨ Kubernetes é›†ç¾¤ä¸Šã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¿è¡Œæ—¶å«ç‰‡runtime-shims&#34;&gt;è¿è¡Œæ—¶å«ç‰‡ï¼ˆruntime shimsï¼‰&lt;/h3&gt;
&lt;p&gt;å¦‚æœä½ è‡ªå·±å°è¯•ä¸€ä¸‹å°±ä¼šå¾ˆå¿«å‘ç°ï¼Œä»¥ç¼–ç¨‹æ–¹å¼ä»å®¹å™¨ç®¡ç†å™¨ä½¿ç”¨ runc æ˜¯ä¸€é¡¹ç›¸å½“æ£˜æ‰‹çš„ä»»åŠ¡ã€‚ä»¥ä¸‹æ˜¯éœ€è¦è§£å†³çš„å›°éš¾æ¸…å•ã€‚&lt;/p&gt;
&lt;h4 id=&#34;åœ¨å®¹å™¨ç®¡ç†å™¨é‡å¯æ—¶ä¿è¯å®¹å™¨å­˜æ´»&#34;&gt;åœ¨å®¹å™¨ç®¡ç†å™¨é‡å¯æ—¶ä¿è¯å®¹å™¨å­˜æ´»&lt;/h4&gt;
&lt;p&gt;å®¹å™¨å¯ä»¥é•¿æ—¶é—´è¿è¡Œï¼Œè€Œå®¹å™¨ç®¡ç†å™¨å¯èƒ½ç”±äºå´©æºƒæˆ–æ›´æ–°ï¼ˆæˆ–æ— æ³•é¢„è§çš„åŸå› ï¼‰è€Œéœ€è¦é‡æ–°å¯åŠ¨ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦ä½¿æ¯ä¸ªå®¹å™¨å®ä¾‹ç‹¬ç«‹äºå¯åŠ¨å®ƒçš„å®¹å™¨ç®¡ç†å™¨è¿›ç¨‹ã€‚å¹¸è¿çš„æ˜¯ï¼Œrunc æä¾›äº†ä¸€ç§æ–¹å¼é€šè¿‡å‘½ä»¤&lt;code&gt;runc run --detach&lt;/code&gt;ä»æ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¸­åˆ†ç¦»ã€‚æˆ‘ä»¬ä¹Ÿå¯èƒ½éœ€è¦èƒ½å¤Ÿ&lt;a href=&#34;https://iximiuz.com/en/posts/linux-pty-what-powers-docker-attach-functionality/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é™„åŠ åˆ°ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¸Š&lt;/a&gt;ã€‚ä¸ºæ­¤ï¼Œrunc å¯ä»¥è¿è¡Œä¸€ä¸ªç”± Linux ä¼ªç»ˆç«¯æ§åˆ¶çš„å®¹å™¨ã€‚é€šè¿‡ Unix å¥—æ¥å­—ä¼ é€’ PTY ä¸»æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯ä»¥å°† PTY çš„ master ç«¯å›ä¼ åˆ°å¯åŠ¨è¿›ç¨‹ï¼ˆè¯·å‚é˜…&lt;code&gt;runc create --console-socket&lt;/code&gt;é€‰é¡¹ï¼‰ã€‚è¿™æ„å‘³ç€ï¼Œåªè¦åº•å±‚å®¹å™¨å®ä¾‹å­˜åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¿æŒå¯åŠ¨è¿›ç¨‹çš„æ´»åŠ¨çŠ¶æ€ï¼Œä»¥ä¿å­˜ PTY æ–‡ä»¶æè¿°ç¬¦ã€‚å¦‚æœæˆ‘ä»¬å†³å®šåœ¨å®¹å™¨ç®¡ç†å™¨è¿›ç¨‹ä¸­å­˜å‚¨ä¸» PTY æ–‡ä»¶æè¿°ç¬¦ï¼Œåˆ™é‡æ–°å¯åŠ¨è¯¥ç®¡ç†å™¨å°†å¯¼è‡´æ–‡ä»¶æè¿°ç¬¦çš„ä¸¢å¤±ï¼Œä»è€Œå¤±å»é‡æ–°é™„ç€åˆ°æ­£åœ¨è¿è¡Œçš„å®¹å™¨çš„èƒ½åŠ›ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸“ç”¨çš„ï¼ˆè½»é‡çº§çš„ï¼‰åŒ…è£…è¿›ç¨‹æ¥è´Ÿè´£è½¬åŒ–å’Œä¿æŒè¿è¡Œå®¹å™¨çš„é™„å±çŠ¶æ€ã€‚&lt;/p&gt;
&lt;h4 id=&#34;åŒæ­¥å®¹å™¨ç®¡ç†å™¨å’ŒåŒ…è£…çš„-runc-å®ä¾‹&#34;&gt;åŒæ­¥å®¹å™¨ç®¡ç†å™¨å’ŒåŒ…è£…çš„ runc å®ä¾‹&lt;/h4&gt;
&lt;p&gt;ç”±äºæˆ‘ä»¬é€šè¿‡æ·»åŠ åŒ…è£…å™¨è¿›ç¨‹å¯¹ runc è¿›è¡Œäº†è½¬åŒ–ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ª side-channelï¼ˆä¹Ÿå¯èƒ½æ˜¯ Unix å¥—æ¥å­—ï¼‰æ¥å°†å®¹å™¨çš„å¯åŠ¨ä¼ å›å®¹å™¨ç®¡ç†å™¨ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æŒç»­è¿½è¸ªå®¹å™¨é€€å‡ºç exit-code&#34;&gt;æŒç»­è¿½è¸ªå®¹å™¨é€€å‡ºç ï¼ˆexit codeï¼‰&lt;/h4&gt;
&lt;p&gt;åˆ†ç¦»å®¹å™¨ä¼šå¯¼è‡´ç¼ºå°‘å®¹å™¨çŠ¶æ€æ›´æ–°ã€‚æˆ‘ä»¬éœ€è¦æœ‰ä¸€ç§æ–¹å¼å°†çŠ¶æ€åé¦ˆç»™ç®¡ç†å™¨ã€‚å‡ºäºè¿™ä¸ªç›®çš„ï¼Œæ–‡ä»¶ç³»ç»Ÿå¬èµ·æ¥ä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚æˆ‘ä»¬å¯ä»¥è®©åŒ…è£…å™¨è¿›ç¨‹ç­‰å¾…å­ runc è¿›ç¨‹ç»ˆæ­¢ï¼Œç„¶åå°†å®ƒçš„é€€å‡ºç å†™åˆ°ç£ç›˜ä¸Šé¢„å®šä¹‰çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³æ‰€æœ‰è¿™äº›é—®é¢˜ï¼ˆå¯èƒ½è¿˜æœ‰å…¶ä»–ä¸€äº›é—®é¢˜ï¼‰ï¼Œé€šå¸¸ä½¿ç”¨æ‰€è°“çš„ runtime shimsã€‚shim æ˜¯ä¸€ä¸ªè½»é‡çº§å®ˆæŠ¤è¿›ç¨‹ï¼Œæ§åˆ¶ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨ã€‚shims çš„å®ç°æœ‰&lt;a href=&#34;https://github.com/containers/conmon&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;conmon&lt;/a&gt;å’Œ containerd çš„ &lt;a href=&#34;https://github.com/containerd/containerd/blob/master/runtime/v2/shim.go&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;runtime shim&lt;/a&gt;ã€‚æˆ‘èŠ±äº†ä¸€äº›æ—¶é—´å®ç°äº†è‡ªå·±çš„ shim ä½œä¸º&lt;a href=&#34;https://github.com/iximiuz/conman&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;conman&lt;/a&gt;é¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥åœ¨æ–‡ç« &lt;a href=&#34;https://iximiuz.com/en/posts/implementing-container-runtime-shim/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;â€œå®ç°å®¹å™¨è¿è¡Œæ—¶ shimâ€&lt;/a&gt;ä¸­æ‰¾åˆ°ï¼ˆç¼–è€…æ³¨ï¼šæ­¤æ–‡ç« è¿˜æœªæ’°å†™ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å®¹å™¨ç½‘ç»œæ¥å£-cni&#34;&gt;å®¹å™¨ç½‘ç»œæ¥å£ (CNI)&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬æœ‰å¤šä¸ªè´£ä»»é‡å çš„å®¹å™¨è¿è¡Œæ—¶ï¼ˆæˆ–ç®¡ç†å™¨ï¼‰ï¼Œå¾ˆæ˜æ˜¾éœ€è¦æå–ç½‘ç»œç›¸å…³çš„ä»£ç åˆ°ä¸€ä¸ªä¸“é—¨çš„é¡¹ç›®æ¥å¤ç”¨å®ƒï¼Œæˆ–è€…æ¯ä¸ªè¿è¡Œæ—¶éƒ½åº”è¯¥æœ‰è‡ªå·±çš„æ–¹å¼æ¥é…ç½® NIC è®¾å¤‡ï¼ŒIP è·¯ç”±ï¼Œé˜²ç«å¢™å’Œç½‘ç»œçš„å…¶ä»–æ–¹é¢ã€‚ä¾‹å¦‚ï¼Œcri-o å’Œ containerd éƒ½å¿…é¡»åˆ›å»º Linux ç½‘ç»œåç§°ç©ºé—´ï¼Œå¹¶è®¾ç½® Linux &lt;code&gt;bridge&lt;/code&gt;å’Œ&lt;code&gt;veth&lt;/code&gt;è®¾å¤‡æ¥ä¸º Kubernetes pods åˆ›å»ºæ²™ç®±ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼•å…¥äº†&lt;a href=&#34;https://github.com/containernetworking/cni&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®¹å™¨ç½‘ç»œæ¥å£&lt;/a&gt;é¡¹ç›®ã€‚&lt;/p&gt;
&lt;p&gt;CNI é¡¹ç›®æä¾›äº†ä¸€ä¸ªå®šä¹‰ CNI æ’ä»¶çš„&lt;a href=&#34;https://github.com/containernetworking/cni/blob/master/SPEC.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®¹å™¨ç½‘ç»œæ¥å£è§„èŒƒ&lt;/a&gt;ã€‚æ’ä»¶æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œçš„ sicï¼Œå®¹å™¨è¿è¡Œæ—¶ï¼ˆæˆ–ç®¡ç†å™¨ï¼‰ä¼šè°ƒç”¨å®ƒæ¥å®‰è£…ï¼ˆæˆ–é‡Šæ”¾ï¼‰ç½‘ç»œèµ„æºã€‚æ’ä»¶å¯ä»¥ç”¨æ¥åˆ›å»ºç½‘ç»œæ¥å£ï¼Œç®¡ç† IP åœ°å€åˆ†é…ï¼Œæˆ–è€…å¯¹ç³»ç»Ÿè¿›è¡Œä¸€äº›è‡ªå®šä¹‰é…ç½®ã€‚CNI é¡¹ç›®ä¸è¯­è¨€æ— å…³ï¼Œç”±äºæ’ä»¶è¢«å®šä¹‰ä¸ºå¯æ‰§è¡Œçš„ï¼Œå®ƒå¯ä»¥ç”¨äºä»»ä½•ç¼–ç¨‹è¯­è¨€å®ç°çš„è¿è¡Œæ—¶ç®¡ç†ç³»ç»Ÿã€‚CNI é¡¹ç›®è¿˜ä¸ºä½œä¸ºä¸€ä¸ªåä¸º&lt;a href=&#34;https://github.com/containernetworking/plugins&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;plugins&lt;/a&gt;çš„ç”¨äºå­˜æ”¾æœ€æµè¡Œçš„ç”¨ä¾‹çš„ç‹¬ç«‹çš„ä»£ç åº“æä¾›äº†ä¸€ç»„å‚è€ƒæ’ä»¶å®ç°ã€‚ä¾‹å¦‚&lt;a href=&#34;https://github.com/containernetworking/plugins/tree/master/plugins/main/bridge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bridge&lt;/a&gt;ã€&lt;a href=&#34;https://github.com/containernetworking/plugins/tree/master/plugins/main/loopback&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;loopback&lt;/a&gt;ã€&lt;a href=&#34;https://github.com/containernetworking/plugins/tree/master/plugins/meta/flannel&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;flannel&lt;/a&gt;ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€äº›ç¬¬ä¸‰æ–¹é¡¹ç›®å°†å…¶ç½‘ç»œç›¸å…³çš„åŠŸèƒ½å®ç°ä¸º CNI æ’ä»¶ã€‚ä¸€äº›æœ€è‘—åçš„é¡¹ç›®å¦‚&lt;a href=&#34;https://github.com/projectcalico/cni-plugin&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Project Calico&lt;/a&gt;å’Œ&lt;a href=&#34;https://github.com/weaveworks/weave&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Weave&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¼–æ’&#34;&gt;ç¼–æ’&lt;/h2&gt;
&lt;p&gt;å®¹å™¨çš„ç¼–æ’æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„ä¸»é¢˜ã€‚å®é™…ä¸Šï¼ŒKubernetes ä»£ç ä¸­æœ€å¤§çš„éƒ¨åˆ†å°±æ˜¯è§£å†³ç¼–æ’é—®é¢˜ï¼Œè€Œä¸æ˜¯å®¹å™¨åŒ–é—®é¢˜ã€‚å› æ­¤ï¼Œç¼–æ’åº”è¯¥æœ‰è‡ªå·±å•ç‹¬çš„æ–‡ç« ï¼ˆæˆ–å‡ ç¯‡ï¼‰è€Œä¸åœ¨æœ¬æ–‡æè¿°ã€‚å¸Œæœ›ä»–ä»¬èƒ½å¾ˆå¿«è·Ÿè¿›ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://iximiuz.com/journey-from-containerization-to-orchestration-and-beyond/orchestration.png&#34; alt=&#34;img&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;å€¼å¾—æ³¨æ„çš„é¡¹ç›®&#34;&gt;å€¼å¾—æ³¨æ„çš„é¡¹ç›®&lt;/h2&gt;
&lt;h3 id=&#34;buildahhttpsgithubcomcontainersbuildah&#34;&gt;&lt;a href=&#34;https://github.com/containers/buildah&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;buildah&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Buildah æ˜¯ä¸€ä¸ªå’Œ&lt;a href=&#34;https://github.com/opencontainers/image-spec&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OCI å®¹å™¨é•œåƒ&lt;/a&gt;ä¸€èµ·ä½¿ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ã€‚å®ƒæ˜¯ RedHat å‘èµ·çš„ä¸€ç»„é¡¹ç›®ï¼ˆpodmanã€skopeoã€buildahï¼‰çš„ä¸€éƒ¨åˆ†ï¼Œç›®çš„æ˜¯é‡æ–°è®¾è®¡ Docker å¤„ç†å®¹å™¨çš„æ–¹æ³•ï¼ˆä¸»è¦æ˜¯å°†å•ä½“å’ŒåŸºäºå®ˆæŠ¤è¿›ç¨‹çš„æ–¹æ³•è½¬æ¢ä¸ºæ›´ç»†ç²’åº¦çš„æ–¹æ³•ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;cnihttpsgithubcomcontainernetworkingcni&#34;&gt;&lt;a href=&#34;https://github.com/containernetworking/cni&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cni&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;CNI é¡¹ç›®å®šä¹‰äº†ä¸€ä¸ªå®¹å™¨ç½‘ç»œæ¥å£æ’ä»¶è§„èŒƒä»¥åŠä¸€äº› Go å·¥å…·ã€‚æœ‰å…³æ›´æ·±å…¥çš„è§£é‡Šï¼Œè¯·å‚è§è¿™ç¯‡&lt;a href=&#34;https://iximiuz.com/en/posts/journey-from-containerization-to-orchestration-and-beyond/#cni&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–‡ç« &lt;/a&gt;ç›¸åº”çš„éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;cni-pluginshttpsgithubcomcontainernetworkingplugins&#34;&gt;&lt;a href=&#34;https://github.com/containernetworking/plugins&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cni-plugins&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ä¸€ä¸ªæœ€æµè¡Œçš„ CNI æ’ä»¶ï¼ˆå¦‚ç½‘æ¡¥ã€ä¸»æœºè®¾å¤‡ã€ç¯å›ã€dhcpã€é˜²ç«å¢™ç­‰ï¼‰çš„ä¸»åº“ã€‚æœ‰å…³æ›´æ·±å…¥çš„è§£é‡Šï¼Œè¯·å‚è§&lt;a href=&#34;https://iximiuz.com/en/posts/journey-from-containerization-to-orchestration-and-beyond/#cni&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–‡ç« &lt;/a&gt;çš„ç›¸åº”éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;containerdhttpsgithubcomcontainerdcontainerd&#34;&gt;&lt;a href=&#34;https://github.com/containerd/containerd&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;containerd&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;é«˜çº§å®¹å™¨è¿è¡Œæ—¶ï¼ˆæˆ–å®¹å™¨ç®¡ç†å™¨ï¼‰ä½œä¸º Docker çš„ä¸€éƒ¨åˆ†å¯åŠ¨ï¼Œå¹¶æå–åˆ°äº†ç‹¬ç«‹çš„é¡¹ç›®ä¸­ã€‚æœ‰å…³æ›´æ·±å…¥çš„è§£é‡Šï¼Œè¯·å‚è§ç›¸åº”çš„&lt;a href=&#34;https://iximiuz.com/en/posts/journey-from-containerization-to-orchestration-and-beyond/#containerd&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éƒ¨åˆ†&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;conmonhttpsgithubcomcontainersconmon&#34;&gt;&lt;a href=&#34;https://github.com/containers/conmon&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;conmon&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ä¸€ä¸ªç”¨ C è¯­è¨€ç¼–å†™çš„å°å‹ OCI è¿è¡Œæ—¶ shimï¼Œä¸»è¦ç”±&lt;a href=&#34;https://github.com/cri-o/cri-o&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;crio&lt;/a&gt;ä½¿ç”¨ã€‚å®ƒæä¾›äº†çˆ¶è¿›ç¨‹ï¼ˆcrioï¼‰ä¸å¯åŠ¨å®¹å™¨ä¹‹é—´çš„åŒæ­¥ã€å®¹å™¨å¯åŠ¨ã€é€€å‡ºç è¿½è¸ªã€PTY è½¬å‘å’Œå…¶ä»–ä¸€äº›åŠŸèƒ½ã€‚æœ‰å…³æ›´æ·±å…¥çš„è§£é‡Šï¼Œè¯·å‚è§ç›¸åº”çš„&lt;a href=&#34;https://iximiuz.com/en/posts/journey-from-containerization-to-orchestration-and-beyond/#containerd&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éƒ¨åˆ†&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;cri-ohttpsgithubcomcri-ocri-o&#34;&gt;&lt;a href=&#34;https://github.com/cri-o/cri-o&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cri-o&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ä¸“æ³¨äº Kubernetes å®¹å™¨ç®¡ç†å™¨ï¼Œéµå¾ª Kubernetes å®¹å™¨è¿è¡Œæ—¶æ¥å£ï¼ˆCRIï¼‰è§„èŒƒã€‚ç‰ˆæœ¬æ§åˆ¶ä¸ k8s ç‰ˆæœ¬æ§åˆ¶ç›¸åŒã€‚æœ‰å…³æ›´æ·±å…¥çš„è§£é‡Šï¼Œè¯·å‚è§ç›¸åº”çš„&lt;a href=&#34;https://iximiuz.com/en/posts/journey-from-containerization-to-orchestration-and-beyond/#cri-o&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éƒ¨åˆ†&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;crunhttpsgithubcomcontainerscrun&#34;&gt;&lt;a href=&#34;https://github.com/containers/crun&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;crun&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;å¦ä¸€ä¸ª OCI è¿è¡Œæ—¶è§„èŒƒå®ç°ã€‚å®ƒå£°ç§°æ˜¯â€å¿«é€Ÿå’Œä½å†…å­˜å ç”¨çš„ OCI å®¹å™¨è¿è¡Œæ—¶ï¼Œå®Œå…¨ç”¨ C ç¼–å†™â€œã€‚ä½†æœ€é‡è¦çš„æ˜¯ï¼Œå®ƒå¯ä»¥ç”¨ä½œä»»ä½• C/C++ä»£ç ï¼ˆæˆ–æä¾›ç»‘å®šå…¶ä»–è¯­è¨€ï¼‰çš„åº“ã€‚å®ƒå…è®¸é¿å…ä¸€äº›ç”±å®ƒçš„å®ˆæŠ¤è¿›ç¨‹ç‰¹æ€§å¼•èµ·çš„ç‰¹å®šçš„â€œruncâ€ç¼ºé™·ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§&lt;a href=&#34;https://iximiuz.com/en/posts/journey-from-containerization-to-orchestration-and-beyond/#runtime-shims&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Runtime Shims&lt;/a&gt;ä¸€èŠ‚ã€‚&lt;/p&gt;
&lt;h3 id=&#34;imagehttpsgithubcomcontainersimage&#34;&gt;&lt;a href=&#34;https://github.com/containers/image&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;image&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ä¸€ä¸ªè¢«ä½ä¼°çš„ï¼ˆä¸»è§‚è¯„ä»·ï¼‰Go å·¥å…·åº“ï¼Œä¸º&lt;em&gt;crio&lt;/em&gt;ã€&lt;em&gt;podman&lt;/em&gt;å’Œ&lt;em&gt;skopeo&lt;/em&gt;ç­‰çŸ¥åé¡¹ç›®æä¾›äº†æ”¯æŒã€‚é€šè¿‡å®ƒçš„åå­—å°±å¾ˆå®¹æ˜“çŒœåˆ°â€”â€”å…¶ç›®çš„æ˜¯ç”¨å„ç§æ–¹å¼æ¥å¤„ç†å®¹å™¨é•œåƒå’Œé•œåƒæ³¨å†Œè¡¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;lxchttpsgithubcomlxclxc&#34;&gt;&lt;a href=&#34;https://github.com/lxc/lxc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;lxc&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ä¸€ä¸ªç”± C ç¼–å†™çš„å¯æ›¿æ¢çš„ä½çº§å®¹å™¨è¿è¡Œæ—¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;lxdhttpsgithubcomlxclxd&#34;&gt;&lt;a href=&#34;https://github.com/lxc/lxd&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;lxd&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ä¸€ä¸ªç”± Go ç¼–å†™çš„é«˜çº§å®¹å™¨è¿è¡Œæ—¶ï¼ˆæˆ–å®¹å™¨ç®¡ç†å™¨ï¼‰ã€‚åº•å±‚ä½¿ç”¨ lxc ä½œä¸ºä½çº§è¿è¡Œæ—¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;mobyhttpsgithubcommobymoby&#34;&gt;&lt;a href=&#34;https://github.com/moby/moby&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;moby&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;é«˜çº§å®¹å™¨è¿è¡Œæ—¶ï¼ˆæˆ–å®¹å™¨ç®¡ç†å™¨ï¼‰ï¼Œä»¥å‰ç§°ä¸º&lt;code&gt;docker/docker&lt;/code&gt;ã€‚æä¾›ä¸€ä¸ªè‘—åçš„åŸºäº&lt;em&gt;containerd&lt;/em&gt;åŠŸèƒ½çš„ Docker å¼•æ“ APIã€‚æœ‰å…³æ›´æ·±å…¥çš„è§£é‡Šï¼Œè¯·å‚è§ç›¸åº”çš„&lt;a href=&#34;https://iximiuz.com/en/posts/journey-from-containerization-to-orchestration-and-beyond/#dockerd&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éƒ¨åˆ†&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;oci-distribution-spechttpsgithubcomopencontainersdistribution-spec&#34;&gt;&lt;a href=&#34;https://github.com/opencontainers/distribution-spec&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OCI distribution spec&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ä¸€ä¸ªå®¹å™¨é•œåƒå‘å¸ƒè§„èŒƒï¼ˆå¼€å‘ä¸­ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;oci-image-spechttpsgithubcomopencontainersimage-spec&#34;&gt;&lt;a href=&#34;https://github.com/opencontainers/image-spec&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OCI image spec&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ä¸€ä¸ªå®¹å™¨é•œåƒè§„èŒƒã€‚&lt;/p&gt;
&lt;h3 id=&#34;oci-runtime-spechttpsgithubcomopencontainersruntime-spec&#34;&gt;&lt;a href=&#34;https://github.com/opencontainers/runtime-spec&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OCI runtime spec&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ä¸€ä¸ªä½é˜¶å®¹å™¨è¿è¡Œæ—¶è§„èŒƒã€‚&lt;/p&gt;
&lt;h3 id=&#34;podmanhttpsgithubcomcontainerslibpod&#34;&gt;&lt;a href=&#34;https://github.com/containers/libpod&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;podman&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ä¸€ä¸ªæ— å®ˆæŠ¤è¿›ç¨‹çš„ Docker æ›¿ä»£å“ã€‚Docker é‡æ–°è®¾è®¡çš„ frontman é¡¹ç›®ã€‚æ›´å¤šä¿¡æ¯å‚è§ &lt;a href=&#34;https://developers.redhat.com/blog/2019/02/21/podman-and-buildah-for-docker-users/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RedHat developers blog&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;rkthttpsgithubcomrktrkt&#34;&gt;&lt;a href=&#34;https://github.com/rkt/rkt&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rkt&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;å¦ä¸€ä¸ªå®¹å™¨ç®¡ç†ç³»ç»Ÿã€‚å®ƒæä¾›äº†ä¸€ä¸ªä½é˜¶è¿è¡Œæ—¶å’Œä¸€ä¸ªé«˜é˜¶ç®¡ç†æ¥å£ã€‚å®ƒå®£ç§°æ˜¯ Pod åŸç”Ÿçš„ã€‚å‘ Kubernetes æ·»åŠ &lt;em&gt;rkt&lt;/em&gt;æ”¯æŒçš„æƒ³æ³•å‚¬ç”Ÿäº† CRI è§„èŒƒã€‚è¯¥é¡¹ç›®ç”± CoreOS å›¢é˜Ÿäº 5 å¹´å‰å¯åŠ¨ï¼Œåœ¨è¢« RedHat æ”¶è´­åå´åœæ»ä¸å‰ã€‚æˆªæ­¢åˆ° 2019 å¹´ 8 æœˆï¼Œè¯¥é¡¹ç›®çš„æœ€åä¸€æ¬¡æäº¤å·²ç»æ˜¯å¤§çº¦ä¸¤ä¸ªæœˆå‰äº†ã€‚&lt;strong&gt;æ›´æ–°&lt;/strong&gt;ï¼š8 æœˆ 16 æ—¥ï¼ŒCNCF&lt;a href=&#34;https://www.cncf.io/blog/2019/08/16/cncf-archives-the-rkt-project/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®£å¸ƒ&lt;/a&gt;æŠ€æœ¯ç›‘ç£å§”å‘˜ä¼šï¼ˆTOCï¼‰æŠ•ç¥¨å†³å®šå°† rkt é¡¹ç›®å­˜æ¡£ã€‚&lt;/p&gt;
&lt;h3 id=&#34;runchttpsgithubcomopencontainersrunc&#34;&gt;&lt;a href=&#34;https://github.com/opencontainers/runc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;runc&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ä¸€ä¸ªä½é˜¶å®¹å™¨è¿è¡Œæ—¶å’Œ OCI è¿è¡Œæ—¶è§„èŒƒçš„å‚è€ƒå®ç°ã€‚ä¸€å¼€å§‹ä½œä¸º Docker çš„ä¸€éƒ¨åˆ†ç°åœ¨æå–åˆ°äº†ä¸€ä¸ªç‹¬ç«‹çš„é¡¹ç›®ä¸­ï¼Œæ™®åŠåº¦å¾ˆé«˜ã€‚æœ‰å…³æ›´æ·±å…¥çš„è§£é‡Šï¼Œè¯·å‚è§ç›¸åº”çš„&lt;a href=&#34;https://iximiuz.com/en/posts/journey-from-containerization-to-orchestration-and-beyond/#container-runtimes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;éƒ¨åˆ†&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;skopeohttpsgithubcomcontainersskopeo&#34;&gt;&lt;a href=&#34;https://github.com/containers/skopeo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;skopeo&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Skopeo æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·é›†ï¼Œå¯¹å®¹å™¨é•œåƒå’Œé•œåƒåº“æ‰§è¡Œå„ç§æ“ä½œã€‚è¿™æ˜¯ RedHat é‡æ–°è®¾è®¡ Dockerï¼ˆå‚è§ podman å’Œ buildahï¼‰å·¥ä½œçš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå°†è‡ªå·±çš„èŒè´£æŠ½å–ä¸ºä¸“ç”¨çš„å’Œç‹¬ç«‹çš„å·¥å…·ã€‚&lt;/p&gt;
&lt;h3 id=&#34;storagehttpsgithubcomcontainersstorage&#34;&gt;&lt;a href=&#34;https://github.com/containers/storage&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;storage&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ä¸€ä¸ªè¢«ä½ä¼°çš„ Go ç±»åº“ï¼Œä¸º crioã€podman å’Œ skopeo ç­‰çŸ¥åé¡¹ç›®æä¾›äº†æ”¯æŒã€‚å…¶ç›®çš„æ˜¯ä¸ºå­˜å‚¨æ–‡ä»¶ç³»ç»Ÿå±‚ã€å®¹å™¨é•œåƒå’Œå®¹å™¨ï¼ˆç£ç›˜ä¸Šçš„ï¼‰æä¾›æ–¹æ³•ã€‚å®ƒè¿˜ç®¡ç† bundle çš„åŠ è½½ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å®ç° Kubernetes Operator çš„æ–°æ–¹å¼ï¼šPython</title>
      <link>https://cloudnativecn.com/blog/kubernetes-operator-in-python/</link>
      <pubDate>Wed, 21 Aug 2019 11:23:19 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/kubernetes-operator-in-python/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://medium.com/flant-com/kubernetes-operator-in-python-451f2d2e33f3&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¼–è€…æŒ‰&#34;&gt;ç¼–è€…æŒ‰&lt;/h2&gt;
&lt;p&gt;äº‘åŸç”Ÿé¢†åŸŸï¼ŒGo å‡ ä¹æˆäº†å„æ–­ç¼–ç¨‹è¯­è¨€ã€‚æœ¬æ–‡ä½œè€…å›¢é˜Ÿå¦è¾Ÿè¹Šå¾„ï¼Œå‘è¯»è€…ä»¬å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨æœ€æµè¡Œçš„ç¼–ç¨‹è¯­è¨€ä¹‹ä¸€ Python åˆ›å»ºä¸€ä¸ªå¯é çš„ Kubernetes operatorã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;ç›®å‰ï¼Œäººä»¬åˆ›å»º Kubernetes operator æ—¶ï¼ŒGo ç¼–ç¨‹è¯­è¨€å‡ ä¹æˆäº†å”¯ä¸€é€‰æ‹©ã€‚ä»–ä»¬çš„åå¥½æ¥è‡ªå¦‚ä¸‹å®¢è§‚åŸå› ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æœ‰ä¸€ä¸ªå¼ºå¤§çš„æ¡†æ¶æ”¯æŒåŸºäº Go å¼€å‘ operator - &lt;a href=&#34;https://github.com/operator-framework/operator-sdk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Operator SDK&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è®¸å¤šåŸºäº Go çš„åº”ç”¨ç¨‹åºï¼Œå¦‚ Docker å’Œ Kubernetesï¼Œå·²ç»æˆä¸ºæ¸¸æˆçš„ä¸»å¯¼è€…ã€‚ç”¨ Go ç¼–å†™ operator å¯ä»¥è®©ä½ ç”¨åŒä¸€ç§è¯­è¨€ä¸ç”Ÿæ€ç³»ç»Ÿå¯¹è¯ã€‚&lt;/li&gt;
&lt;li&gt;åŸºäº Go çš„åº”ç”¨ç¨‹åºçš„é«˜æ€§èƒ½ä»¥åŠå¼€ç®±å³ç”¨çš„å¹¶å‘æœºåˆ¶ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œå¦‚æœç¼ºä¹æ—¶é—´æˆ–è€…ä»…ä»…æ˜¯æ²¡æœ‰åŠ¨åŠ›å»å­¦ä¹  Go è¯­è¨€å‘¢ï¼Ÿåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ä½¿ç”¨å‡ ä¹æ‰€æœ‰ DevOps å·¥ç¨‹å¸ˆéƒ½ç†Ÿæ‚‰çš„æœ€æµè¡Œçš„ç¼–ç¨‹è¯­è¨€ä¹‹ä¸€ Python åˆ›å»ºä¸€ä¸ªå¯é çš„ operatorã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¬¢è¿-copyrator--the-copy-operator&#34;&gt;æ¬¢è¿ Copyrator â€” the copy operator&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†ä½¿äº‹æƒ…å˜å¾—ç®€å•å®ç”¨ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„ operatorï¼šå½“å‡ºç°ä¸€ä¸ªæ–°çš„ namespaceï¼Œæˆ– ConfigMap ä¸ Secret ä¹‹ä¸€æ›´æ”¹å…¶çŠ¶æ€æ—¶ï¼Œå¤åˆ¶ ConfigMapã€‚ä»å®ç”¨çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬çš„æ–° operator å¯ä»¥ç”¨äºæ‰¹é‡æ›´æ–°åº”ç”¨ç¨‹åºçš„é…ç½®ï¼ˆé€šè¿‡æ›´æ–° ConfigMapï¼‰æˆ–é‡ç½® Secretï¼Œä¾‹å¦‚ç”¨äº Docker æ³¨å†Œä¸­å¿ƒçš„é”®ï¼ˆå½“ä¸€ä¸ª Secret æ·»åŠ åˆ° namespace æ—¶ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆï¼Œä¸€ä¸ªå¥½çš„ Kubernetes operator åº”è¯¥å…·å¤‡å“ªäº›ç‰¹å¾å‘¢ï¼Ÿè®©æˆ‘ä»¬åˆ—ä¸¾å‡ºæ¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸ operator çš„äº¤äº’é€šè¿‡&lt;a href=&#34;https://kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definitions/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Custom Resource Definitions&lt;/a&gt;ï¼ˆä»¥ä¸‹ç®€ç§° CRDï¼‰è¿›è¡Œã€‚&lt;/li&gt;
&lt;li&gt;Operator æ˜¯å¯é…ç½®çš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°å’Œç¯å¢ƒå˜é‡æ¥è®¾ç½®å®ƒã€‚&lt;/li&gt;
&lt;li&gt;Docker image å’Œ Helm chart åœ¨åˆ›å»ºæ—¶è€ƒè™‘åˆ°äº†ç®€å•æ€§ï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥æ¯«ä¸è´¹åŠ›åœ°å°†å…¶å®‰è£…åˆ° Kubernetes é›†ç¾¤ä¸­ï¼ˆåŸºæœ¬ä¸Šåªéœ€ä¸€ä¸ªå‘½ä»¤ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;crd&#34;&gt;CRD&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†è®© operator çŸ¥é“è¦æŸ¥æ‰¾å“ªäº›èµ„æºå’Œåœ¨å“ªé‡ŒæŸ¥æ‰¾ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€äº›è§„åˆ™ã€‚æ¯ä¸ªè§„åˆ™éƒ½å°†è¡¨ç¤ºä¸ºä¸€ä¸ªç‰¹å®šçš„ CRD å¯¹è±¡ã€‚é‚£ä¹ˆï¼Œè¿™ä¸ª CRD å¯¹è±¡åº”è¯¥æœ‰å“ªäº›å­—æ®µå‘¢ï¼Ÿ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æˆ‘ä»¬æ„Ÿå…´è¶£çš„&lt;strong&gt;èµ„æºçš„ç±»å‹&lt;/strong&gt; (ConfigMap or Secretï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å‚¨å­˜èµ„æºçš„&lt;strong&gt;namespace åˆ—è¡¨&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¸®åŠ©æˆ‘ä»¬æœç´¢ç‰¹å®š namespace ä¸­çš„èµ„æºçš„&lt;strong&gt;Selector&lt;/strong&gt; ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è®©æˆ‘ä»¬ä¸€èµ·æ¥å®šä¹‰ä¸€ä¸ª CRDï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apiextensions.k8s.io/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;CustomResourceDefinition&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;copyrator.flant.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;flant.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;versions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;served&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Namespaced&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;names&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;plural&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;copyrators&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;singular&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;copyrator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;CopyratorRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;shortNames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;copyr&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;validation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;openAPIV3Schema&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;object&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;properties&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ruleType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespaces&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;array&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&amp;hellip; ç„¶åç«‹å³æ·»åŠ ä¸€ä¸ª&lt;strong&gt;ç®€å•è§„åˆ™&lt;/strong&gt;æ¥é€‰æ‹© ConfigMapsï¼Œè¦æ±‚åœ¨é»˜è®¤ namespace ä¸­ä½¿ç”¨ä¸&lt;code&gt;copyrator: &amp;quot;true&amp;quot;&lt;/code&gt;åŒ¹é…çš„æ ‡ç­¾ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;flant.com/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;CopyratorRule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;main-rule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;module&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;copyrator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ruleType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;configmap&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;copyrator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åšå¾—å¥½ï¼æ¥ä¸‹æ¥æˆ‘ä»¬å¿…é¡»å¾—åˆ°è§„åˆ™çš„ç›¸å…³ä¿¡æ¯ã€‚ç°åœ¨å¯ä»¥è¯´ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä¸å»æ‰‹åŠ¨ç”Ÿæˆé›†ç¾¤ API çš„è¯·æ±‚ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªåä¸º&lt;a href=&#34;https://github.com/kubernets-client/python&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes-client&lt;/a&gt;çš„ Python åº“ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;kubernetes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;contextlib&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;suppress&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;CRD_GROUP&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;flant.com&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;CRD_VERSION&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;v1&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;CRD_PLURAL&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;copyrators&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;load_crd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;client&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;kubernetes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ApiClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;custom_api&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;kubernetes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CustomObjectsApi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;suppress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kubernetes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;api_client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ApiException&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;crd&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;custom_api&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get_namespaced_custom_object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;CRD_GROUP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;CRD_VERSION&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;CRD_PLURAL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;crd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;ruleType&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;selector&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;namespace&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œä»¥ä¸Šä»£ç ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä»¥ä¸‹ç»“æœï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;err&#34;&gt;&amp;#39;ruleType&amp;#39;:&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;&amp;#39;configmap&amp;#39;,&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;err&#34;&gt;&amp;#39;selector&amp;#39;:&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;{&amp;#39;copyrator&amp;#39;:&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;&amp;#39;true&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;,&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;err&#34;&gt;&amp;#39;namespace&amp;#39;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;&amp;#39;default&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¤ªæ£’äº†ï¼ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªç‰¹å®šäº operator çš„è§„åˆ™ã€‚é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬å·²ç»èƒ½å¤Ÿé€šè¿‡æ‰€è°“çš„ Kubernetes æ–¹å¼åšåˆ°è¿™ä¸€ç‚¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¯å¢ƒå˜é‡å‘½ä»¤è¡Œå‚æ•°&#34;&gt;ç¯å¢ƒå˜é‡&amp;amp;å‘½ä»¤è¡Œå‚æ•°&lt;/h2&gt;
&lt;p&gt;ç°åœ¨æ˜¯è¿›è¡ŒåŸºæœ¬ operator è®¾ç½®çš„æ—¶å€™äº†ã€‚é…ç½®åº”ç”¨ç¨‹åºæœ‰ä¸¤ç§ä¸»è¦æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡å‘½ä»¤è¡Œå‚æ•°ï¼Œ&lt;/li&gt;
&lt;li&gt;é€šè¿‡ç¯å¢ƒå˜é‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‚¨å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå‚æ•°è·å–è®¾ç½®ï¼Œå…¶å…·æœ‰æ›´å¤§çš„çµæ´»æ€§ï¼Œå¹¶æ”¯æŒ/éªŒè¯æ•°æ®ç±»å‹ã€‚æˆ‘ä»¬å°†ä½¿ç”¨æ ‡å‡† Python åº“ä¸­çš„&lt;code&gt;*argparser*&lt;/code&gt;æ¨¡å—ï¼Œä½¿ç”¨çš„è¯¦ç»†ä¿¡æ¯å’Œç¤ºä¾‹å¯ä»¥åœ¨&lt;a href=&#34;https://docs.python.org/3/library/argparse.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Python æ–‡æ¡£&lt;/a&gt;ä¸­æ‰¾åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä¸€ä¸ªé…ç½®å‘½ä»¤è¡Œå‚æ•°æ£€ç´¢çš„ä¾‹å­ï¼Œé€‚ç”¨äºæˆ‘ä»¬çš„æƒ…å†µï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;parser&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ArgumentParser&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;description&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Copyrator - copy operator.&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;prog&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;copyrator&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;parser&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;add_argument&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;--namespace&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;getenv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;NAMESPACE&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;default&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;help&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Operator Namespace&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;parser&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;add_argument&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;--rule-name&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;getenv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;RULE_NAME&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;main-rule&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;help&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;CRD Name&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;parser&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;parse_args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦ä¸€æ–¹é¢ï¼Œæ‚¨å¯ä»¥é€šè¿‡ Kubernetes ä¸­çš„ç¯å¢ƒå˜é‡è½»æ¾åœ°å°†æœ‰å…³ pod çš„æœåŠ¡ä¿¡æ¯ä¼ é€’åˆ°å®¹å™¨ä¸­ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹ç»“æ„è·å¾—æœ‰å…³ pod è¿è¡Œçš„&lt;strong&gt;namespace&lt;/strong&gt;çš„ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NAMESPACE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;valueFrom&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fieldRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fieldPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;metadata.namespace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;operator-çš„æ“ä½œé€»è¾‘&#34;&gt;operator çš„æ“ä½œé€»è¾‘&lt;/h2&gt;
&lt;p&gt;è®©æˆ‘ä»¬ä½¿ç”¨ç‰¹æ®Šçš„æ˜ å°„æ¥åˆ’åˆ†ä½¿ç”¨ ConfigMap å’Œ Secret çš„æ–¹æ³•ã€‚å®ƒä»¬å°†è®©æˆ‘ä»¬æ¸…æ¥šæˆ‘ä»¬éœ€è¦ä»€ä¹ˆæ–¹æ³•æ¥è·Ÿè¸ªå’Œåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;LIST_TYPES_MAP&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s1&#34;&gt;&amp;#39;configmap&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;list_namespaced_config_map&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s1&#34;&gt;&amp;#39;secret&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;list_namespaced_secret&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;CREATE_TYPES_MAP&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s1&#34;&gt;&amp;#39;configmap&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;create_namespaced_config_map&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s1&#34;&gt;&amp;#39;secret&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;create_namespaced_secret&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åå¿…é¡»ä» API æœåŠ¡å™¨æ¥æ”¶äº‹ä»¶ã€‚æˆ‘ä»¬å°†ä»¥ä»¥ä¸‹æ–¹å¼å®ç°è¯¥åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;specs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;kubernetes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;config&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;load_incluster_config&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;v1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;kubernetes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CoreV1Api&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# Get the method for tracking objects&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;method&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;getattr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LIST_TYPES_MAP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;specs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;ruleType&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]])&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;partial&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;method&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;specs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;namespace&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;w&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;kubernetes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;watch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Watch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;event&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stream&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_request_timeout&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;60&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;handle_event&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;specs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;event&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;äº‹ä»¶è¢«æ¥æ”¶åï¼Œæˆ‘ä»¬è¿›å…¥å¤„ç†äº‹ä»¶çš„åº•å±‚é€»è¾‘ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Types of events to which we will respond&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ALLOWED_EVENT_TYPES&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;ADDED&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;UPDATED&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;handle_event&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;specs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;event&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;event&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;type&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ALLOWED_EVENT_TYPES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;object_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;event&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;object&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;labels&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;object_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;metadata&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;labels&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{})&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;# Look for the matches using selector&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;specs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;selector&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;():&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# Get active namespaces&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;namespaces&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;lambda&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nb&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;lambda&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;phase&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;Active&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;list_namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;items&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;namespace&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;namespaces&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;# Clear the metadata, set the namespace&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;object_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;metadata&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;s1&#34;&gt;&amp;#39;labels&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;object_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;metadata&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;labels&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;s1&#34;&gt;&amp;#39;namespace&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;s1&#34;&gt;&amp;#39;name&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;object_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;metadata&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;name&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;# Call the method for creating/updating an object&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;methodcaller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;CREATE_TYPES_MAP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;specs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;ruleType&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;object_&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åŸºæœ¬é€»è¾‘æ˜¯å®Œæ•´çš„ï¼ç°åœ¨æˆ‘ä»¬éœ€è¦å°†å…¶æ‰“åŒ…åˆ°å•ä¸ª Python åŒ…ä¸­ã€‚è®©æˆ‘ä»¬åˆ›å»º&lt;code&gt;setup.py&lt;/code&gt; ï¼Œå¹¶å°†é¡¹ç›®çš„å…ƒæ•°æ®æ·»åŠ åˆ°å…¶ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;sys&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;version_infofrom&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;version_info&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;setuptools&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;find_packages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;setup&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;version_info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;raise&lt;/span&gt; &lt;span class=&#34;ne&#34;&gt;RuntimeError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;Unsupported python version &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;%s&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;.&amp;#39;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;join&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;version_info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;_NAME&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;copyrator&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;setup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_NAME&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;0.0.1&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;packages&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;find_packages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;classifiers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;Development Status :: 3 - Alpha&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;Programming Language :: Python&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;Programming Language :: Python :: 3&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;Programming Language :: Python :: 3.5&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;Programming Language :: Python :: 3.6&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;Programming Language :: Python :: 3.7&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;author&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Flant&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;author_email&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;maksim.nabokikh@flant.com&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;include_package_data&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;install_requires&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;kubernetes==9.0.0&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;entry_points&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;console_scripts&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;s1&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{0}&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt; = &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{0}&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;.cli:main&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;format&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_NAME&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;: ç”¨äº Kubernetes çš„ Python å®¢æˆ·ç«¯åº“æœ‰è‡ªå·±çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚å®¢æˆ·ç«¯å’Œ Kubernetes ç‰ˆæœ¬çš„å…¼å®¹æ€§æ¦‚è¿°åœ¨è¿™ä¸ª&lt;a href=&#34;https://github.com/kubernetes-client/python#compatibility-matrix&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;em&gt;matrix&lt;/em&gt;&lt;/a&gt;ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰ï¼Œæˆ‘ä»¬çš„é¡¹ç›®æœ‰å¦‚ä¸‹ç»“æ„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-scheme&#34; data-lang=&#34;scheme&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;copyrator&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;â”œâ”€â”€&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;copyrator&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;â”œâ”€â”€&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;cli&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;py&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;#&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Command&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;line&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;operating&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;logic&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;â”œâ”€â”€&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;constant&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;py&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;#&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Constants&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;that&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;we&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;described&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;above&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;â”œâ”€â”€&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;load_crd&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;py&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;#&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;CRD&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;loading&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;logic&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;â””â”€â”€&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;operator&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;pyĞº&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;#&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Basic&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;logic&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;of&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;operator&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;â””â”€â”€&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;setup&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;py&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;#&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Package&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;description&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;docker-ä¸-helm&#34;&gt;Docker ä¸ Helm&lt;/h2&gt;
&lt;p&gt;ç”Ÿæˆçš„ Dockerfile å°†éå¸¸ç®€å•ï¼šæˆ‘ä»¬å°†ä½¿ç”¨åŸºæœ¬çš„&lt;em&gt;python-alpine&lt;/em&gt;é•œåƒæ¥å®‰è£…æˆ‘ä»¬çš„åŒ…ï¼ˆè¯¥è¿‡ç¨‹è¿˜æœ‰å¾…åç»­ä¼˜åŒ–ï¼‰:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-dockerfile&#34; data-lang=&#34;dockerfile&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;s&#34;&gt; python:3.7.3-alpine3.9&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ADD&lt;/span&gt; . /app&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RUN&lt;/span&gt; pip3 install /app&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ENTRYPOINT&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;copyrator&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Copyrator çš„éƒ¨ç½²åŒæ ·å¾ˆç®€å•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;.Chart.Name }}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;.Chart.Name }}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;.Chart.Name }}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;.Chart.Name }}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;privaterepo.yourcompany.com/copyrator:latest&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;imagePullPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Always&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;--rule-type&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;main-rule&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;env&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NAMESPACE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;valueFrom&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fieldRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;fieldPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;metadata.namespace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceAccountName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;.Chart.Name }}-acc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€åï¼Œæˆ‘ä»¬å¿…é¡»ä¸º operator åˆ›å»ºä¸€ä¸ªå…·æœ‰å¿…è¦æƒé™çš„ç›¸å…³è§’è‰²ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ServiceAccount&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;.Chart.Name }}-acc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbac.authorization.k8s.io/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterRole&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;.Chart.Name }}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;namespaces&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;get&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;watch&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;list&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;secrets&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;configmaps&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbac.authorization.k8s.io/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterRoleBinding&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;.Chart.Name }}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;roleRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbac.authorization.k8s.io&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterRole&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;.Chart.Name }}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subjects&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ServiceAccount&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{{&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;.Chart.Name }}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h2&gt;
&lt;p&gt;åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å‘æ‚¨å±•ç¤ºäº†å¦‚ä½•ä¸º Kubernetes åˆ›å»ºè‡ªå·±çš„åŸºäº python çš„ operatorã€‚å½“ç„¶ï¼Œå®ƒä»ç„¶æœ‰æ”¹è¿›çš„ç©ºé—´ï¼šæ‚¨å¯ä»¥é€šè¿‡ä½¿å…¶å¤„ç†å¤šä¸ªè§„åˆ™ã€ç›‘è§†å…¶ CRDs ä¸­çš„æ›´æ”¹ã€ä»å¹¶å‘åŠŸèƒ½ä¸­è·ç›Šç­‰æ‰‹æ®µæ¥ä¸°å¯Œå®ƒâ€¦â€¦&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰ä»£ç éƒ½å¯ä»¥åœ¨æˆ‘ä»¬çš„&lt;a href=&#34;https://github.com/flant/examples/tree/master/2019/08-k8s-pythonoperator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;strong&gt;å…¬å…±ä»“åº“&lt;/strong&gt;&lt;/a&gt;ä¸­æ‰¾åˆ°ï¼Œä»¥ä¾¿äºæ‚¨å»ç†Ÿæ‚‰å®ƒã€‚å¦‚æœæ‚¨å¯¹åŸºäº python çš„å…¶ä»– operator ç¤ºä¾‹æ„Ÿå…´è¶£ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨å¯ä»¥æŸ¥çœ‹éƒ¨ç½² mongodb çš„ä¸¤ä¸ª operator(&lt;a href=&#34;https://github.com/Ultimaker/k8s-mongo-operator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é“¾æ¥ 1&lt;/a&gt;å’Œ&lt;a href=&#34;https://github.com/kbst/mongodb&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é“¾æ¥ 2&lt;/a&gt;)ã€‚&lt;/p&gt;
&lt;p&gt;P.S.å¦‚æœä½ ä¸å–œæ¬¢å¤„ç† Kubernetes äº‹ä»¶ï¼Œæˆ–è€…ä½ åªæ˜¯æ›´ä¹ æƒ¯äºä½¿ç”¨ Bashï¼Œä½ ä¹Ÿå¯ä»¥äº«å—æˆ‘ä»¬æ˜“äºä½¿ç”¨çš„è¢«ç§°ä¸º&lt;a href=&#34;https://github.com/flant/shell-operator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;shell-operator&lt;/a&gt; (æˆ‘ä»¬æœ‰åœ¨ 4 æœˆ&lt;a href=&#34;https://medium.com/flant-com/kubernetes-shell-operator-76c596b42f23&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®£å¸ƒ&lt;/a&gt;) çš„è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;P.P.S.è¿˜æœ‰ä¸€ç§ä½¿ç”¨ Python ç¼–å†™ K8s çš„æ›¿ä»£æ–¹æ³•â€”ä¸€ä¸ªåä¸º&lt;a href=&#34;https://github.com/zalando-incubator/kopf/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kopf&lt;/a&gt;(Kubernetes Operator Pythonic Framework) çš„ç‰¹å®šæ¡†æ¶ã€‚å¦‚æœæ‚¨æƒ³å°† Python ä»£ç é‡æœ€å°åŒ–ï¼Œè¿™ä¸ªæ¡†æ¶æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚æŸ¥çœ‹ kopf&lt;a href=&#34;https://kopf.readthedocs.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ–‡æ¡£&lt;/a&gt;ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>kubernetes dashboard åœ¨ ssl çš„å„ç§åœºæ™¯ä¸‹çš„æ‰‹åŠ¨éƒ¨ç½²</title>
      <link>https://cloudnativecn.com/blog/general-kubernetes-dashboard/</link>
      <pubDate>Wed, 17 Apr 2019 11:23:34 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/general-kubernetes-dashboard/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡è½¬è½½è‡ª&lt;a href=&#34;https://zhangguanzhang.github.io/2019/02/12/dashboard/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;zhangguanzhang çš„åšå®¢&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ—¨åœ¨é¢å‘æ–°æ‰‹è®²è§£æ‰‹åŠ¨éƒ¨ç½²è¿‡ç¨‹ï¼Œæœ¬æ–‡ dashboard çš„æš´éœ²ä¸ä¼šç”¨ nodePortï¼ˆä¸å–œæ¬¢ä½¿ç”¨å®ƒï¼‰å’Œ apiserver çš„ web proxy ä»£ç†ä¹Ÿå°±æ˜¯&lt;code&gt;/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/&lt;/code&gt;è¿™ç§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸»è¦è®²ä¸‹å››ç§åœºæ™¯æ–¹å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;çº¯ dashboard http å’Œ https ä¸æƒ¨åˆå¤–éƒ¨è¯ä¹¦&lt;/li&gt;
&lt;li&gt;openssl è¯ä¹¦ç»™ dashboard å½“ https&lt;/li&gt;
&lt;li&gt;ä¸ªäººå‘åŸŸåä½¿ç”¨ https å°ç»¿é”&lt;/li&gt;
&lt;li&gt;ingress tls ä»£ç† http[s]çš„ dashboard
ä»¥åŠæœ€åè®²è§£çš„å¦‚ä½•å®šä¹‰å¸¦æƒé™çš„ token å»åˆ©ç”¨ token ç™»é™† dashboardã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…ˆè¦ç†è§£çš„ä¸€ç‚¹å°±æ˜¯ JWTï¼ˆJSON Web Tokensï¼‰æ€æƒ³ï¼Œk8s çš„å¾ˆå¤š addon éƒ½æ˜¯ pod å½¢å¼è·‘çš„ï¼Œaddon çš„ pod éƒ½æ˜¯è¦è¿æ¥ kube-apiserver æ¥æ“ä½œé›†ç¾¤æ¥å‡å°‘è¿ç»´çš„å·¥ä½œé‡å’Œæä¾›æ–¹ä¾¿ã€‚addon éƒ½æ˜¯ podï¼Œpod æ“ä½œå’ŒæŸ¥çœ‹é›†ç¾¤ä¿¡æ¯éœ€è¦é‰´æƒã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºæ­¤ k8s ä½¿ç”¨äº† RBAC çš„æ€æƒ³ï¼ˆRBAC æ€æƒ³ä¸æ˜¯ k8s ç‹¬æœ‰çš„ï¼‰ï¼Œèµ„æºå¯¹è±¡å’Œå¯¹å£°æ˜çš„èµ„æºå¯¹è±¡çš„æ“ä½œæƒé™ç»„åˆæœ€ç»ˆè½å®åˆ°&lt;code&gt;ServiceAccount&lt;/code&gt;ä¸Šï¼Œè€Œæ¯ä¸ªåä¸º&lt;code&gt;name&lt;/code&gt;çš„ sa ä¼šå…³è”ç€ä¸€ä¸ªåä¸º&lt;code&gt;name-token-xxxxx&lt;/code&gt;çš„ secretã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥é€šè¿‡ kubectl describe å‘½ä»¤æˆ–è€… api çœ‹è¿™ä¸ª secret å®é™…ä¸Šå°±æ˜¯ä¸ª token å’Œä¸€ä¸ª ca.crtã€‚ä¸‹åˆ—å‘½ä»¤åˆ—å‡ºç¼ºçœ sa default çš„ token å’Œæ•´ä¸ªé›†ç¾¤çš„ ca.crtï¼ˆjsonpath æ‰“å°çš„æ—¶å€™æ•æ„Ÿä¿¡æ¯æ˜¯ base64 ç¼–ç éœ€è¦è‡ªå·±è§£ç ï¼‰:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl get secret -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{range .items[?(@.metadata.annotations.kubernetes\.io/service-account\.name==&amp;#34;default&amp;#34;)].data}{&amp;#34;token: &amp;#34;}{.token}{&amp;#34;\n\n&amp;#34;}{&amp;#34;ca.crt: &amp;#34;}{.ca\.crt}{&amp;#34;\n&amp;#34;}{end}&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token: ZXlKaGJHY2lPaUpGVXpVeE1pSXNJbXR................
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ca.crt: LS0tLS1CRUdJTiBDRVJUS..........................
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¯ä¸ª pod éƒ½ä¼šè¢« kubelet æŒ‚è½½ pod å£°æ˜çš„ ServiceAccount å…³è”çš„ secret çš„é‡Œçš„ ca.crt å’Œ token åˆ°å®¹å™¨é‡Œè·¯å¾„&lt;code&gt;/var/run/secrets/kubernetes.io/serviceaccount&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;éƒ¨ç½²çš„ yaml çš„è¯ä¸æ¨èç›´æ¥ä½¿ç”¨å®˜æ–¹çš„ yamlï¼Œæˆ‘ä»¬éœ€è¦çœ‹åœºæ™¯ä¿®æ”¹æˆ–è€…åˆ å‡ä¸€äº›ä¸œè¥¿ï¼Œè¿™é‡Œå…ˆæ”¾ä¸‹å®˜æ–¹çš„ yaml é“¾æ¥ï¼Œåé¢ä»¥æ–‡ä»¶è®²è§£ã€‚åŒæ—¶ä¹Ÿæ¨èæŠŠæœ¬æ–‡çœ‹å®Œäº†åå†å¼€å§‹éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/deploy/recommended/kubernetes-dashboard.yaml&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å…¨æ–‡æˆ‘åŸºæœ¬éƒ½æ˜¯ç”¨çš„&lt;code&gt;hostNetwork&lt;/code&gt;å’Œ&lt;code&gt;nodeName&lt;/code&gt;å›ºå®šåœ¨ä¸€å°ä¸Šï¼Œå¦‚æœå¯¹ k8s çš„å‡ ç§ svc å’Œ&lt;code&gt;hostNetwork&lt;/code&gt;ä»¥åŠ&lt;code&gt;hostPort&lt;/code&gt;ä»¥åŠ&lt;code&gt;Ingress&lt;/code&gt;ç†Ÿæ‚‰çš„è¯å¯ä»¥è‡ªå·±å†³å®šæš´éœ²æ–¹å¼ã€‚
è¿™é‡Œæˆ‘æ˜¯ä½¿ç”¨çš„ä¸‹é¢è¿™ç§æ–¹å¼æš´éœ²å‡ºå»ï¼Œä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬ä¸éœ€è¦ svc å¯ä»¥åˆ æ‰å®˜æ–¹ yaml é‡Œæœ€åé‚£æ®µ&lt;code&gt;Dashboard Service&lt;/code&gt;ï¼Œè®¿é—®çš„è¯ç”¨ node çš„ ip å¸¦ä¸Šç«¯å£è®¿é—®å³å¯ï¼Œæ”¹æˆå¤§æ¦‚ä¸‹é¢è¿™æ ·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hostNetwork&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;dnsPolicy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterFirstWithHostNet&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubernetes-dashboard&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;registry.cn-hangzhou.aliyuncs.com/google_containers/kubernetes-dashboard-amd64:v1.10.1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;nodeName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;k8s-m1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;çº¯-dashboard&#34;&gt;çº¯ dashboard&lt;/h2&gt;
&lt;p&gt;åˆ†ä¸ºä¸¤ç§ï¼šhttp å’Œå¼€ httpsï¼Œå…¶ä¸­å¼€ https åˆåˆ†ä¸ºä½¿ç”¨è‡ªå¸¦çš„ cert å’Œ openssl ç”Ÿæˆçš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é»˜è®¤è‡ªå¸¦çš„-https&#34;&gt;é»˜è®¤è‡ªå¸¦çš„ https&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆè¯´è¯´è‡ªå¸¦çš„ httpsï¼Œé•œåƒé»˜è®¤çš„&lt;code&gt;entrypoint&lt;/code&gt;æ˜¯è¿™æ ·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;Entrypoint&amp;#34;: &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/dashboard&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;--insecure-bind-address=0.0.0.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;--bind-address=0.0.0.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é»˜è®¤å®šä¹‰çš„å®¹å™¨å¯åŠ¨å‚æ•°ä¸ºä¸‹é¢è¿™æ ·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;auto-generate-certificates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œæˆ‘å®¿ä¸»æœºçš„ 8443 è¢«å ç”¨äº†ï¼Œæˆ‘ä¿®æ”¹äº†ä¸‹ dashboard çš„ç«¯å£ï¼Œåé¢åŒç†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;5443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;/dashboard&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;bind-address=0.0.0.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;auto-generate-certificates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;port=5443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;livenessProbe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;httpGet&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;scheme&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTPS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;5443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;--auto-generate-certificates&lt;/code&gt;ä»å­—é¢æ„æ€çœ‹æ˜¯ dashboard è‡ªå·±ç”Ÿæˆ https çš„è¯ä¹¦ï¼Œä½†æ˜¯å®é™…ä¸Šå¦‚ä¸‹é¢çš„å›¾è¿™ä¸ªè¯ä¹¦ chrome æµè§ˆå™¨æ˜¯ä¸è®¤çš„å…¶ä»–æµè§ˆå™¨ä¸æ¸…æ¥šï¼Œchrome æ‰“å¼€ååœ¨ç½‘é¡µä¸Šæ˜¯æ²¡æœ‰æ— è§†è­¦å‘Šç»§ç»­çš„é€‰é¡¹ï¼Œå¯ä»¥è‡ªè¡Œå»è¯•è¯•çœ‹ï¼Œç½‘ä¸Šä¹Ÿæ²¡æ‰¾åˆ°æ·»åŠ ä¾‹å¤–åªæ‰¾åˆ°äº†å…¨å±€å…³é—­éæƒå¨ SSL è­¦å‘Šã€‚ä¸æ¨èè¿™ç§ï¼ˆæˆ–è€…è¯´è¿™ç§å®Œå…¨è¡Œä¸é€šï¼Ÿï¼‰&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-browser-cannot-continue&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/general-kubernetes-dashboard/005BYqpggy1g22j058fljj30l30grjsz.jpg&#34; alt=&#34;browser-cannot-continue&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      browser-cannot-continue
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨-http&#34;&gt;ä½¿ç”¨ http&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ http æˆ‘ä»¬è¦å°å¿ƒæœ‰å‡ ä¸ªå‘ï¼
ä½¿ç”¨ http æˆ‘ä»¬åªè¦ä½¿ç”¨é€‰é¡¹&lt;code&gt;--insecure-port&lt;/code&gt;ä¿®æ”¹æˆä¸‹é¢å³å¯ç«¯å£ä¸ä¸€å®šéœ€è¦å’Œæˆ‘ä¸€æ ·ï¼Œpod çš„å¥åº·æ£€æŸ¥è®°å¾—æŠŠ``HTTPS&lt;code&gt;æ”¹æˆ&lt;/code&gt;HTTP`ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;5443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;/dashboard&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;insecure-bind-address=0.0.0.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;insecure-port=5443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;livenessProbe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;httpGet&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;scheme&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;HTTP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;5443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é»˜è®¤ http æ˜¯ä¸éœ€è¦ç™»é™†çš„ï¼Œæ‰€æœ‰äººè¿›å»éƒ½æ˜¯å¯ä»¥çš„ï¼Œæˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ° dashboard é»˜è®¤å¸¦äº†ä¸€ä¸ª sa ä»¥åŠä¸€ä¸ª Roleï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# ------------------- Dashboard Role &amp;amp; Role Binding ------------------- #&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Role&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubernetes-dashboard-minimal&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kube-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# Allow Dashboard to create &amp;#39;kubernetes-dashboard-key-holder&amp;#39; secret.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;secrets&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;create&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# Allow Dashboard to create &amp;#39;kubernetes-dashboard-settings&amp;#39; config map.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;configmaps&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;create&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# Allow Dashboard to get, update and delete Dashboard exclusive secrets.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;secrets&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resourceNames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;kubernetes-dashboard-key-holder&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;kubernetes-dashboard-certs&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;get&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;update&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;delete&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# Allow Dashboard to get and update &amp;#39;kubernetes-dashboard-settings&amp;#39; config map.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;configmaps&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resourceNames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;kubernetes-dashboard-settings&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;get&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;update&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# Allow Dashboard to get metrics from heapster.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;services&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resourceNames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;heapster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;proxy&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;services/proxy&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resourceNames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;heapster&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;http:heapster:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;https:heapster:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;get&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;RoleBinding&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubernetes-dashboard-minimal&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kube-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;roleRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbac.authorization.k8s.io&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Role&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubernetes-dashboard-minimal&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subjects&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ServiceAccount&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubernetes-dashboard&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kube-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ ·ç»•è¿‡ç™»é™†çš„è¯æ‰€æœ‰äººéƒ½æ˜¯ä¸Šé¢çš„æƒé™äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—ä½¿ç”¨é€‰é¡¹&lt;code&gt;--enable-insecure-login&lt;/code&gt;å¼€å¯ç™»é™†ç•Œé¢ï¼Œæœ€ç»ˆçš„ args ä¸ºä¸‹é¢ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;insecure-port=5443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;enable-insecure-login=true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ ·ä¸‹è¿›å»æ˜¯å¼ºåˆ¶è®©ç™»å½•äº†ï¼Œä½†æ˜¯ token çš„è¯ï¼ˆåé¢è¯´è¿™ä¸ª token å¦‚ä½•åˆ›å»ºå’Œè·å–ï¼‰æ˜¯æ— æ³•ç™»é™†çš„ï¼Œæ‰¾åˆ° issue è¯´é€šè¿‡ kubectl proxy å‡ºå»çš„ http å’Œç›´æ¥æš´éœ²çš„ http å°†æ— æ³•ç™»é™†ï¼ˆä½†æ˜¯å®é™…ä¸Šæˆ‘æµ‹äº†ä¸‹ç™¾åº¦æµè§ˆå™¨å¯ä»¥ç™»å½•ï¼‰ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/dashboard/issues/3216&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/kubernetes/dashboard/issues/3216&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/dashboard/issues/2735&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/kubernetes/dashboard/issues/2735&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½†æ˜¯ä¹Ÿä¸æ˜¯æ„å‘³ç€å®Œå…¨ä¸èƒ½ç”¨è¿™ç§æ–¹æ³•ï¼Œå¯ä»¥ sa kubernetes-dashboard ç»‘å®šåˆ°é›†ç¾¤è§’è‰² cluster-admin ç„¶åå¤–é¢å¥—å±‚ nginx çš„ auth åˆ°å®ƒï¼Œç„¶åé…ç½® iptables æˆ–è€…ç½‘ç»œè®¾å¤‡ ACL è®© dashboard åªæ”¶åˆ°æ¥æº ip æ˜¯ nginxã€‚&lt;/p&gt;
&lt;h2 id=&#34;openssl-ç”Ÿæˆè¯ä¹¦ç»™-dashboard-å½“-https-è¯ä¹¦&#34;&gt;openssl ç”Ÿæˆè¯ä¹¦ç»™ dashboard å½“ https è¯ä¹¦&lt;/h2&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬ä½¿ç”¨ openssl ç”Ÿæˆè¯ä¹¦ç»™ dashboard ä½¿ç”¨çš„è¯ï¼Œæµè§ˆå™¨ä¼šæœ‰è·³è¿‡ç»§ç»­å‰å¾€é¡µé¢çš„é€‰é¡¹ï¼Œèƒ½å¤Ÿåœ¨å†…ç½‘æ²¡åŸŸåä¸‹ä½¿ç”¨ï¼Œæˆ‘ä»¬å†…ç½‘ç»™ç ”å‘æ­å»º dashboard ç›®å‰å°±æ˜¯è¿™æ ·ä½¿ç”¨çš„ã€‚å…·ä½“å°±æ˜¯ openssl å‘½ä»¤ç”Ÿæˆè¯ä¹¦å¹¶æ ¹æ®è¯ä¹¦ç”Ÿæˆ tls ç±»å‹çš„ secretï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir certs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl req -nodes -newkey rsa:2048 -keyout certs/dashboard.key -out certs/dashboard.csr -subj &lt;span class=&#34;s2&#34;&gt;&amp;#34;/C=/ST=/L=/O=/OU=/CN=kubernetes-dashboard&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl x509 -req -sha256 -days &lt;span class=&#34;m&#34;&gt;10000&lt;/span&gt; -in certs/dashboard.csr -signkey certs/dashboard.key -out certs/dashboard.crt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create secret generic kubernetes-dashboard-certs --from-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;certs -n kube-system
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œç”Ÿæˆ secret åæˆ‘ä»¬å…ˆåˆ†æä¸‹å®˜æ–¹çš„ yamlï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å‘½ä»¤å¸®åŠ©&lt;code&gt;--help&lt;/code&gt;æŸ¥çœ‹åˆ° dashboard çš„é»˜è®¤ cert-dir æ˜¯&lt;code&gt;/certs&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ docker run --rm -ti --entrypoint /dashboard registry.cn-hangzhou.aliyuncs.com/google_containers/kubernetes-dashboard-amd64:v1.10.1 --help &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep cert-dir
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      --default-cert-dir string          Directory path containing &lt;span class=&#34;s1&#34;&gt;&amp;#39;--tls-cert-file&amp;#39;&lt;/span&gt; and &lt;span class=&#34;s1&#34;&gt;&amp;#39;--tls-key-file&amp;#39;&lt;/span&gt; files. Used also when auto-generating certificates flag is set. &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;default &lt;span class=&#34;s2&#34;&gt;&amp;#34;/certs&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è€Œä¸”å¯ä»¥æ³¨æ„åˆ°ä»–æœ‰ä¸ªæŒ‚è½½ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumeMounts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubernetes-dashboard-certs&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;mountPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/certs&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;volumes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubernetes-dashboard-certs&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secretName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubernetes-dashboard-certs&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢æŒ‚è½½çš„ secret ä¹Ÿæ˜¯æ¥æºäºå®˜æ–¹ yaml é‡Œçš„ secretï¼Œä¹Ÿå°±è¯´é»˜è®¤æƒ…å†µä¸‹è¿™ä¸ª secret æ˜¯ç»™é€‰é¡¹&lt;code&gt;--auto-generate-certificates&lt;/code&gt;ä½¿ç”¨çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Secret&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;k8s-app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubernetes-dashboard&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubernetes-dashboard-certs&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kube-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Opaque&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ openssl éƒ¨ç½² dashboard çš„æ­¥éª¤æ˜¯å…ˆä¸Šé¢ openssl ç”Ÿæˆè¯ä¹¦ç„¶åå¯¼å…¥ç”Ÿæˆ secretï¼Œç„¶å yaml é‡Œåˆ æ‰&lt;code&gt;Dashboard Secret&lt;/code&gt;ç„¶åä¿®æ”¹ dashboard çš„è¿è¡Œé€‰é¡¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;/dashboard&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;bind-address=0.0.0.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;auto-generate-certificates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;port=5443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢ä¸ºå•¥æˆ‘å¼€äº†è‡ªåŠ¨ç”Ÿæˆè¯ä¹¦çš„é€‰é¡¹å‘¢ï¼Œè¿™ä¸ªé€‰é¡¹å¼€å¯æ—¶ä¸ä¼šè¦†ç›–æˆ‘ä»¬çš„æŒ‚è½½çš„ certs æ–‡ä»¶çš„åŒæ—¶å®ƒè¿˜æ˜¯å…¨å±€ https çš„å¼€å…³ - -å‘äº†æˆ‘å¥½ä¹…ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸ªäººå‘åŸŸåä½¿ç”¨-https-å°ç»¿é”-æœ‰å•ç‚¹æ•…éšœé£é™©&#34;&gt;ä¸ªäººå‘åŸŸåä½¿ç”¨ https å°ç»¿é” (æœ‰å•ç‚¹æ•…éšœé£é™©)&lt;/h2&gt;
&lt;p&gt;è¿™é‡Œæ˜¯é€šè¿‡åŸŸå+https è®¿é—®ï¼Œè¯ä¹¦çš„è¯å¯ä»¥ä¹°çš„ä¹Ÿå¯ä»¥å…è´¹ç­¾ç½²çš„ SSL è¯ä¹¦éƒ½è¡Œã€‚
æˆ‘ä½¿ç”¨çš„æ˜¯&lt;code&gt;acme.sh + token&lt;/code&gt;ä½¿ç”¨&lt;code&gt;Letâ€™s Encrypt&lt;/code&gt;ç­¾ç½²å…è´¹çš„ SSL è¯ä¹¦ï¼Œä¹Ÿæ˜¯æˆ‘ä¸ªäººç”¨çš„ã€‚å¦å¤– acme ç”³è¯·è¯ä¹¦çš„æ—¶å€™ä¸ä¸€å®šéå¾—é€šé…ç¬¦åŸŸå
å®‰è£… acme.sh è„šæœ¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl  -s https://get.acme.sh &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; sh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# è®¾ç½®åˆ«åæ–¹ä¾¿ä½¿ç”¨å‘½ä»¤&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;alias&lt;/span&gt; acme.sh&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;~/.acme.sh/acme.sh
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;DNS APIï¼Œé˜¿é‡Œäº‘éœ€è¦è®¾ç½® RAM ç­–ç•¥å¯¹åº”ä¸º AliyunDNSFullAccessï¼Œç„¶ååœ¨æ§åˆ¶å°è·å– API çš„ tokenï¼Œè…¾è®¯çš„è¯ç¡®ä¿åŸŸåè§£ææ˜¯ dnspodï¼Œå…¶ä»–çš„åŸŸåæä¾›å•†è¯·æŸ¥çœ‹ &lt;a href=&#34;https://github.com/Neilpang/acme.sh/wiki/dnsapi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/Neilpang/acme.sh/wiki/dnsapi&lt;/a&gt;ã€‚
ä¾‹å¦‚é˜¿é‡Œçš„è¯å»é˜¿é‡Œäº‘ä¸Šç”Ÿæˆ token ç„¶åä¸‹é¢æ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Ali_Key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;yourkey&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;Ali_Secret&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;yoursecret&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ç”³è¯·è¯ä¹¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;acme.sh --issue --dns dns_ali -d *.k8s.youdomain.com
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åŸŸååœ¨è…¾è®¯äº‘çš„è¯ç¡®ä¿ nameserver è®¾ç½®çš„æ˜¯ dnspodï¼ˆå¥½åƒé»˜è®¤å°±æ˜¯è¿™ä¸ªï¼‰ï¼Œæˆ‘ä»¬å» dnspod çš„å®˜ç½‘ä¸Šä½¿ç”¨ç™»é™†è…¾è®¯äº‘çš„è´¦å·ï¼ˆä¾‹å¦‚æˆ‘æ˜¯ qq ç™»é™†ï¼‰ååœ¨å¼€å‘è€… api é‡Œå¼€å¯ dnspod çš„ api tokenã€‚
æ³¨æ„ token åœ¨åˆ›å»ºçš„æ—¶å€™åªæ˜¾ç¤ºä¸€æ¬¡ï¼Œè®°å¾—æˆªå›¾å‘ç»™è‡ªå·±çš„æ—¶å€™åˆ«ç‚¹é”™åœ°æ–¹å…³äº†ï¼Œä¸ç„¶å¾—å†åˆ›å»ºä¸ªã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-tx-dns-setting&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/general-kubernetes-dashboard/005BYqpgly1g22j058335j30js0c0t9g.jpg&#34; alt=&#34;tx-dns-setting&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      tx-dns-setting
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-dnspod-gettoken&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/general-kubernetes-dashboard/005BYqpggy1g22j0563f6j31060gcq33.jpg&#34; alt=&#34;dnspod-getToken&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      dnspod-getToken
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;DP_Id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;1234&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;DP_Key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;sADDsdasdgdsfsdfsdfasfdsfasfasfds&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;acme.sh --issue --dns dns_dp -d *.zhangguanzhang.com
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿è¡Œåä¼šçœ‹åˆ°æ–‡ä»¶è·¯å¾„ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-scriptoutput&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/general-kubernetes-dashboard/005BYqpgly1g22j0598m4j31hc0n3wfi.jpg&#34; alt=&#34;scriptOutput&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      scriptOutput
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å‰é¢è¯ä¹¦ç”Ÿæˆä»¥åï¼Œæ¥ä¸‹æ¥éœ€è¦æŠŠè¯ä¹¦ copy åˆ°çœŸæ­£éœ€è¦ç”¨å®ƒçš„åœ°æ–¹ã€‚
æ³¨æ„ï¼Œé»˜è®¤ç”Ÿæˆçš„è¯ä¹¦éƒ½æ”¾åœ¨å®‰è£…ç›®å½•ä¸‹ï¼š&lt;code&gt;~/.acme.sh/&lt;/code&gt;ï¼Œè¯·ä¸è¦ç›´æ¥ä½¿ç”¨æ­¤ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼šä¸è¦ç›´æ¥è®© nginx/apache çš„é…ç½®æ–‡ä»¶ä½¿ç”¨è¿™ä¸‹é¢çš„æ–‡ä»¶ã€‚è¿™é‡Œé¢çš„æ–‡ä»¶éƒ½æ˜¯å†…éƒ¨ä½¿ç”¨ï¼Œè€Œä¸”ç›®å½•ç»“æ„å¯èƒ½ä¼šå˜åŒ–ã€‚
æ­£ç¡®çš„ä½¿ç”¨æ–¹æ³•æ˜¯ä½¿ç”¨&lt;code&gt;--installcert&lt;/code&gt;å‘½ä»¤ï¼Œå¹¶æŒ‡å®šç›®æ ‡ä½ç½®ï¼Œç„¶åè¯ä¹¦æ–‡ä»¶ä¼šè¢« copy åˆ°ç›¸åº”çš„ä½ç½®ã€‚
COPY è¯ä¹¦ï¼Œå®‰è£…åˆ° &lt;code&gt;~/cert&lt;/code&gt; ç›®å½•ä¸­ï¼Œcert è¯ä¹¦ä½¿ç”¨çš„æ˜¯ fullchain certï¼Œkeyfile å’Œ fullchain çš„è¯ä¹¦åå­—éšæ„ï¼Œè‡ªå·±è®°ä½å°±è¡Œäº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir -p ~/cert
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;acme.sh  --installcert  -d  *.zhangguanzhang.com   &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;        --key-file           ~/cert/zhangguanzhang.com.key &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;        --fullchain-file     ~/cert/zhangguanzhang.com.crt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åä»è¯ä¹¦åˆ›å»º tls ç±»å‹çš„ secretï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n kube-system create secret tls kubernetes-dashboard-certs &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --key ~/cert/zhangguanzhang.com.key &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --cert ~/cert/zhangguanzhang.com.crt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆ æ‰å®˜æ–¹ yaml æ–‡ä»¶é‡Œçš„&lt;code&gt;Dashboard Secret&lt;/code&gt;ï¼Œæˆ‘ä»¬å‘ç° tls çš„ secret æ˜¯ä¸‹é¢ä¿©æ–‡ä»¶åï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n kube-system get secrets kubernetes-dashboard-certs -o yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apiVersion: v1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;data:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  tls.crt: ....
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  tls.key: ....
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kind: Secret
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  name: kubernetes-dashboard-certs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  namespace: kube-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;type: kubernetes.io/tls
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬ä¿®æ”¹è¿è¡Œå‚æ•°å…³é—­ insecure å’ŒæŒ‡å®šä½¿ç”¨è¯ä¹¦æ–‡ä»¶ï¼Œè¿™é‡Œç”¨ 5443 æ˜¯å› ä¸ºæˆ‘å…¬ç½‘ ip æ²¡å¤‡æ¡ˆï¼Œå¦‚æœ ip å¤‡æ¡ˆäº†å¯ä»¥ 5443 æ”¹æˆ 443ï¼ˆè®°å¾— yaml å…¶ä»–åœ°æ–¹ç«¯å£ä¹Ÿä¿®æ”¹ä¸‹ï¼‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;/dashboard&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;auto-generate-certificates&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;bind-address=0.0.0.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;port=5443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;tls-cert-file=tls.crt&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;tls-key-file=tls.key&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆ›å»º dashboard ååœ¨äº‘ä¸Šçš„åŸŸåæ§åˆ¶å°è®¾ç½®è§£æè¿‡æ¥ï¼Œé€šè¿‡ https çš„åŸŸåè®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-results&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://raw.githubusercontent.com/servicemesher/website/master/content/blog/general-kubernetes-dashboard/005BYqpgly1g22j05at9mj31560mf40n.jpg&#34; alt=&#34;results&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      results
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;ingress-controller-ä½¿ç”¨åŸŸåè¯ä¹¦ä»£ç†-dashboard&#34;&gt;Ingress Controller ä½¿ç”¨åŸŸåè¯ä¹¦ä»£ç† dashboard&lt;/h2&gt;
&lt;p&gt;ä¸Šé¢ç›´æ¥ dashboard ä½¿ç”¨åŸŸåè¯ä¹¦ä¼šæœ‰å•ç‚¹æ•…éšœï¼Œæ‰€ä»¥å®é™…åº”ç”¨æˆ‘ä»¬å¯ä»¥ç”¨é«˜å¯ç”¨çš„ ingress nginxï¼ˆè¯¦è§ä¹‹å‰çš„æ–‡ç« ï¼‰æ¥ä»£ç†é›†ç¾¤å†…éƒ¨çš„ dashboard
è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯&lt;code&gt;Ingress nginx&lt;/code&gt;ã€‚
å¦‚æœæ²¡åŸŸåçš„è¯å¯ä»¥ä½¿ç”¨ openssl ç”Ÿæˆè¯ä¹¦ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;openssl req -x509 -nodes -days &lt;span class=&#34;m&#34;&gt;10000&lt;/span&gt; -newkey rsa:2048 -keyout tls.key -out tls.crt -subj &lt;span class=&#34;s2&#34;&gt;&amp;#34;/CN=dashboard.example.com/O=dashboard.example.com&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»è¯ä¹¦åˆ›å»º tls ç±»å‹çš„ secretï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n kube-system create secret tls dashboard-tls &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --key ~/cert/zhangguanzhang.com.key &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --cert ~/cert/zhangguanzhang.com.crt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®˜æ–¹ yaml çš„ deploy æ•°é‡æ”¹å¤šä¸ªåç›´æ¥ä½¿ç”¨åˆ›å»ºå³å¯ï¼Œç„¶ååˆ›å»ºä¸‹é¢ ingressï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Ingress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dashboard-ingress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kube-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;nginx.ingress.kubernetes.io/ssl-redirect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;nginx.ingress.kubernetes.io/rewrite-target&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#nginx.ingress.kubernetes.io/secure-backends: &amp;#34;true&amp;#34;  è¯¥æ³¨é‡Šåœ¨0.18.0ä¸­è¢«å¼ƒç”¨ï¼Œå¹¶åœ¨0.20.0å‘å¸ƒåè¢«åˆ é™¤ï¼Œä½¿ç”¨ä¸‹é¢&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;nginx.ingress.kubernetes.io/backend-protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;HTTPS&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;hosts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;dashboard.example.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;secretName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dashboard-tls&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dashboard.example.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubernetes-dashboard&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servicePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœ ingress æ˜¯ tls çš„ï¼Œdashboard æ˜¯ http çš„å¯ä»¥å»æ‰ä¸Šé¢ä¸‰ä¸ª annotationsï¼ˆè¿™ç§æƒ…å†µæˆ‘æœªæµ‹è¯•ï¼Œæœ‰å…´è¶£å¯ä»¥è‡ªå·±è¯•è¯•ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;token&#34;&gt;token&lt;/h2&gt;
&lt;p&gt;dashboard ç™»é™†çš„è¯å¯ä»¥é€‰æ‹© kubeconfig å’Œ tokenï¼Œkubeconfig ä¸€èˆ¬æ˜¯é›†ç¾¤å¤–ä½¿ç”¨çš„ï¼Œä¾‹å¦‚ç®¡ç†ç»„ä»¶ä¹‹é—´æƒ³å’Œ apiserver tls ä¸‹é€šä¿¡éƒ½å¾—ä½¿ç”¨ kubeconfigï¼Œé‡Œé¢å®é™…ä¸Šå°±æ˜¯ ca ç­¾ç½²çš„å®¢æˆ·ç«¯è¯ä¹¦ + å„è‡ª CN å’Œ O ç­¾ç½²çš„è¯ä¹¦ã€‚è€Œ token é‡Œçš„ ca.crt ä¹Ÿæ˜¯å®¢æˆ·ç«¯è¯ä¹¦å’Œ kubeconfig é‡Œ&lt;code&gt;client-certificate-data&lt;/code&gt;çš„æ˜¯ä¸€æ ·çš„ï¼ŒRBAC è½å®åœ¨å®ƒé‚£ä¸ª token å­—æ®µã€‚
å¾ˆå¤š addon å¯ä»¥çœ‹åˆ°ä»–ä»¬çš„&lt;code&gt;--help&lt;/code&gt;é€‰é¡¹çœ‹åˆ°ä¹Ÿæ”¯æŒ kubeconfig çš„ï¼Œä»–ä»¬çš„é»˜è®¤é€»è¾‘æ˜¯æ²¡æœ‰ç”¨ kubeconfig é€‰é¡¹ä¸‹èµ·æ¥çš„æ—¶å€™ä¼šå»æŸ¥çœ‹ secret è·¯å¾„&lt;code&gt;/var/run/secrets/kubernetes.io/serviceaccount&lt;/code&gt;è·å– tokenï¼ˆä¹Ÿå°±æ˜¯åœ¨ pod é‡Œè¿è¡Œçš„è¯·æ±‚é€»è¾‘ï¼‰ï¼Œå½“ç„¶ä¹Ÿå¹¶ä¸æ„å‘³ç€ token ä¸€å®šåœ¨é›†ç¾¤å†…ç”¨å¯ä»¥æŠŠ secret çš„ token è·å–åˆ°ååˆ¶ä½œæˆ kubeconfigã€‚
dashboard ç™»é™†çš„ token å¦‚æœä½¿ç”¨ç®¡ç†å‘˜çš„è¯å¯ä»¥ç”¨ rbac ç»‘å®šé›†ç¾¤ç®¡ç†å‘˜è§’è‰²ï¼Œè¿™ä¹Ÿæ˜¯æœ€å¸¸è§çš„ä½¿ç”¨æ–¹æ³•ï¼Œåƒ kubectl æ‹¥æœ‰é›†ç¾¤ç®¡ç†å‘˜é‚£æ ·ã€‚å¦‚æœå¯¹ RBAC ç†Ÿæ‚‰å¯ä»¥å•ç‹¬ç»™ä¸ç”¨éƒ¨é—¨ç”Ÿæˆä¸åŒæƒé™çš„ RBAC å– token ç»™äººå‘˜ç™»é™†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ServiceAccount&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dashboard    &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# sa åå­—éšæ„&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kube-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;k8s-app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubernetes-dashboard&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterRoleBinding&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dashboard&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;roleRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbac.authorization.k8s.io&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterRole    &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# æƒé™æ¥æºäºé›†ç¾¤è§’è‰²&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cluster-admin  &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# è¿™ä¸ªæ˜¯é›†ç¾¤ç®¡ç†å‘˜è§’è‰²å&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subjects&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ServiceAccount&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dashboard   &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# å’Œä¸Šé¢åå­—ä¸€æ ·&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kube-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å–å®ƒ token ç”¨äºç™»é™† dashboardï¼Œä½ åœ¨ dashboard web ä¸Šæ“ä½œé›†ç¾¤çš„æ—¶å€™å®é™…ä¸Šæ˜¯æ‹¿ç€ä½ ç™»é™†çš„ token çš„å»ä»¥ api è°ƒç”¨ kube-apiserverã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä¸‹é¢å‘½ä»¤å–ä¸Šé¢åˆ›å»ºçš„ sa çš„ tokenï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n kube-system get secret -o &lt;span class=&#34;nv&#34;&gt;jsonpath&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;{range .items[?(@.metadata.annotations.kubernetes\.io/service-account\.name==&amp;#34;dashboard&amp;#34;)].data}{.token}{end}&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; base64 -d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xxxxxxxxxxxxxx
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€å&lt;code&gt;Letâ€™s Encrypt&lt;/code&gt;çš„è¯ä¹¦æ˜¯ä¸€æ¬¡ 3 ä¸ªæœˆï¼Œå¯ä»¥çœ‹è„šæœ¬å®˜æ–¹æ–‡æ¡£å»å®šæ—¶è·å–æ–°çš„è¯ä¹¦ç„¶åå¯¼å…¥ &lt;a href=&#34;https://github.com/Neilpang/acme.sh/wiki/%E8%AF%B4%E6%98%8E&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/Neilpang/acme.sh/wiki/%E8%AF%B4%E6%98%8E&lt;/a&gt; certmanager å’Œ acme.sh ä¸€æ ·çš„åŸç†å»è°ƒç”¨ api ç­¾ç½²åŸŸåè¯ä¹¦ï¼Œæœ‰å…´è¶£å¯ä»¥å»è¯•è¯•&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒï¼š&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/ingress-nginx/tree/master/docs/examples/tls-termination&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TLS termination - github.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/Neilpang/acme.sh/wiki/dnsapi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;acme.sh wiki - github.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/dashboard/wiki/Certificate-management#public-trusted-certificate-authority&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;certmanager trusted github.com&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes Ingress Controller çš„ä½¿ç”¨ä»‹ç»åŠé«˜å¯ç”¨è½åœ°</title>
      <link>https://cloudnativecn.com/blog/kubernetes-ingress-controller-deployment-and-ha/</link>
      <pubDate>Wed, 17 Apr 2019 11:23:34 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/kubernetes-ingress-controller-deployment-and-ha/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡è½¬è½½è‡ª&lt;a href=&#34;https://zhangguanzhang.github.io/2018/10/06/IngressController/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;zhangguanzhang çš„åšå®¢&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»ä¹‹å‰å¯¹ ingress controller åˆ°ç°åœ¨äº†è§£æ¶æ„å’Œä¸€äº›ç»éªŒæ€»ç»“ä¸‹ï¼Œé¡ºå¸¦ç»™äººç§‘æ™®å°‘èµ°å¼¯è·¯
éœ€è¦çœ‹æ‡‚æœ¬æ–‡è¦å…·å¤‡ä¸€ä¸‹çŸ¥è¯†ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Service å®ç°åŸç†å’Œä¼šåº”ç”¨&lt;/li&gt;
&lt;li&gt;çŸ¥é“åå‘ä»£ç†åŸç†ï¼Œäº†è§£ nginx å’Œ apache çš„ vhost æ¦‚å¿µ&lt;/li&gt;
&lt;li&gt;äº†è§£ service çš„å‡ ç§ç±»å‹ï¼ˆNodeportã€clusteripã€LBï¼‰&lt;/li&gt;
&lt;li&gt;å››å±‚å’Œä¸ƒå±‚åŒºåˆ«ï¼ˆä¸æ˜ç™½å°±è¿™æ ·å»ç†è§£ï¼Œä¸ƒå±‚æœ€å¸¸è§å°±æ˜¯åº”ç”¨å±‚çš„ httpï¼Œä¹Ÿå°±æ˜¯ urlï¼Œå››å±‚æ˜¯ä¼ è¾“å±‚ï¼Œä¸º tcp/udp ç«¯å£ï¼‰&lt;/li&gt;
&lt;li&gt;åŸŸåè§£æï¼Œ/etc/hosts ç­‰åŸºç¡€çŸ¥è¯†&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ingress-controller-ä»‹ç»&#34;&gt;Ingress Controller ä»‹ç»&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;Ingress Controller&lt;/code&gt;æ˜¯ä¸€ä¸ªç»Ÿç§°ï¼Œå¹¶ä¸æ˜¯åªæœ‰ä¸€ä¸ªï¼Œæœ‰å¦‚ä¸‹è¿™äº›ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/ingress-nginx&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ingress NGINX&lt;/a&gt;: Kubernetes å®˜æ–¹ç»´æŠ¤çš„æ–¹æ¡ˆï¼Œä¹Ÿæ˜¯æœ¬æ¬¡å®‰è£…ä½¿ç”¨çš„ Controllerã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://clouddocs.f5.com/products/connectors/k8s-bigip-ctlr/v1.5/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;F5 BIG-IP Controller&lt;/a&gt;: F5 æ‰€å¼€å‘çš„ Controllerï¼Œå®ƒèƒ½å¤Ÿè®©ç®¡ç†å‘˜é€šè¿‡ CLI æˆ– API è®© Kubernetes ä¸ OpenShift ç®¡ç† F5 BIG-IP è®¾å¤‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://konghq.com/blog/kubernetes-ingress-controller-for-kong/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ingress Kong&lt;/a&gt;: è‘—åçš„å¼€æº API Gateway æ–¹æ¡ˆæ‰€ç»´æŠ¤çš„ Kubernetes Ingress Controllerã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/containous/traefik&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Traefik&lt;/a&gt;: æ˜¯ä¸€å¥—å¼€æºçš„ HTTP åå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡å™¨ï¼Œè€Œå®ƒä¹Ÿæ”¯æ´äº† Ingressã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/appscode/voyager&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Voyager&lt;/a&gt;: ä¸€å¥—ä»¥ HAProxy ä¸ºåº•çš„ Ingress Controllerã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;Ingress Controller çš„å®ç°ä¸åªä¸Šé¢è¿™äº›æ–¹æ¡ˆï¼Œè¿˜æœ‰å¾ˆå¤šå¯ä»¥åœ¨ç½‘ç»œä¸Šæ‰¾åˆ°è¿™é‡Œä¸ä¸€ä¸€åˆ—å‡ºæ¥äº†ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æˆ‘ä»¬éƒ¨ç½²åœ¨é›†ç¾¤é‡Œçš„æœåŠ¡çš„ svc æƒ³æš´éœ²å‡ºæ¥çš„æ—¶å€™ï¼Œä»é•¿ä¹…çœ¼å…‰çœ‹å’Œæ˜“äºç®¡ç†ç»´æŠ¤éƒ½æ˜¯ç”¨çš„&lt;code&gt;Ingress Controller&lt;/code&gt;æ¥å¤„ç†ï¼Œclusterip éé›†ç¾¤ä¸»æœºæ— æ³•è®¿é—®ï¼ŒNodeport ä¸æ–¹ä¾¿é•¿ä¹…ç®¡ç†å’Œæ•ˆç‡ï¼ŒLB æœåŠ¡å¤šäº†ä¸æ–¹ä¾¿å› ä¸ºéœ€è¦èŠ±è´¹é¢å¤–çš„é’±ï¼ŒexternalIPS ä¸å¥½ç”¨ï¼ˆåé¢æœ‰ç©ºå†™æ–‡ç« ä¼šè¯´å®ƒï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è·‘çš„å¤§å¤šæœåŠ¡éƒ½æ˜¯åº”ç”¨å±‚ httpï¼ˆsï¼‰ï¼ŒIngress Controller ä½¿ç”¨ service æˆ–è€… pod çš„ç½‘ç»œå°†å®ƒæš´éœ²åœ¨é›†ç¾¤å¤–ï¼Œç„¶åå®ƒåå‘ä»£ç†é›†ç¾¤å†…çš„ä¸ƒå±‚æœåŠ¡ï¼Œé€šè¿‡ vhost å­åŸŸåé‚£æ ·è·¯ç”±åˆ°åç«¯çš„æœåŠ¡ï¼Œ&lt;code&gt;Ingress Controller&lt;/code&gt;å·¥ä½œæ¶æ„å¦‚ä¸‹ï¼Œå€Ÿç”¨ traefik å®˜æ–¹çš„å›¾ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-traefik&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;traefik&#34; srcset=&#34;
               /blog/kubernetes-ingress-controller-deployment-and-ha/006tNbRwly1fyl4kdlseyj30mg0dc405_hu1558874701911004108.webp 400w,
               /blog/kubernetes-ingress-controller-deployment-and-ha/006tNbRwly1fyl4kdlseyj30mg0dc405_hu13984553959135598573.webp 760w,
               /blog/kubernetes-ingress-controller-deployment-and-ha/006tNbRwly1fyl4kdlseyj30mg0dc405_hu13680446367717247544.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-ingress-controller-deployment-and-ha/006tNbRwly1fyl4kdlseyj30mg0dc405_hu1558874701911004108.webp&#34;
               width=&#34;760&#34;
               height=&#34;451&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      traefik
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥å°†&lt;code&gt;api.domain.com&lt;/code&gt;è¿›æ¥çš„æµé‡è·¯ç”±åˆ°é›†ç¾¤é‡Œ api çš„ podï¼Œä½ å¯ä»¥å°†&lt;code&gt;backoffice.domain.com&lt;/code&gt;æµé‡è·¯ç”±åˆ° backoffice çš„ä¸€ç»„ pod ä¸Šï¼Œè™½è¯´æˆ‘ä»¬å¯ä»¥è‡ªå·±æ­å»ºä¸€ä¸ª nginx æ¥ä»£æ›¿æ‰&lt;code&gt;Ingress Controller&lt;/code&gt;ï¼Œä½†æ˜¯è¦å¢åŠ ä»£ç†çš„ service é•¿æœŸæ¥çœ‹ç»´æŠ¤å¾ˆä¸æ–¹ä¾¿ï¼Œåœ¨ä½¿ç”¨ä¸Š&lt;code&gt;Ingress Controller&lt;/code&gt;åå¯ä»¥ç”¨ä¸€ç§æŠ½è±¡çš„å¯¹è±¡å‘Šè¯‰ controller æ·»åŠ å¯¹åº”çš„ä»£ç†ï¼Œä¹Ÿå°±æ˜¯&lt;code&gt;kind: Ingress&lt;/code&gt;ã€‚å®ƒé‡Œé¢æè¿°äº†ä» Ingress Controller è®¿é—®è¿›æ¥çš„ ServerName å’Œ web çš„ url è¦ä»£ç†åˆ°é›†ç¾¤é‡Œå“ªä¸ª serviceï¼ˆä»¥åŠ service çš„ portï¼‰ç­‰ç­‰å…·ä½“ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;è€Œå®˜æ–¹çš„&lt;code&gt;Ingress Nginx&lt;/code&gt;å¯ä»¥è§†ä¸ºä¸€ä¸ªé­”æ”¹çš„ nginxï¼Œæ‹¥æœ‰é›†ç¾¤èµ‹äºˆçš„ RBAC æƒé™åï¼Œèƒ½å¤Ÿæœ‰ç›‘å¬é›†ç¾¤ Ingress ç›¸å…³çš„å˜åŒ–èƒ½åŠ›ï¼Œç”¨æˆ·åˆ›å»ºäº†&lt;code&gt;kind: Ingress&lt;/code&gt;ï¼Œ
ä¾‹å¦‚ä¸Šé¢ trafik å›¾é‡Œçš„ Ingress å¤§è‡´å°±æ˜¯ä¸‹é¢è¿™æ ·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Ingress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-ingress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;annotations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;nginx.ingress.kubernetes.io/use-regex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;api.mydomain.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;api&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servicePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;domain.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/web/*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;web&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servicePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;backoffice.domain.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;backoffice&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servicePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åªè¦åˆ›å»ºäº†ä¸Šé¢çš„ Ingress åï¼Œingress controller é‡Œä¼šç›‘å¬åˆ°ä»è€Œç”Ÿæˆå¯¹åº”çš„é…ç½®æ®µååŠ¨æ€ reload é…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ingress-controller-éƒ¨ç½²&#34;&gt;Ingress Controller éƒ¨ç½²&lt;/h2&gt;
&lt;p&gt;éƒ¨ç½²éå¸¸ç®€å•ï¼Œä¸€æ¡å‘½ä»¤åˆ›å»ºå³å¯ï¼Œyml æ¥æºäº &lt;a href=&#34;https://github.com/kubernetes/ingress-nginx/tree/master/deploy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/kubernetes/ingress-nginx/tree/master/deploy&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/mandatory.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥ yaml ç¼ºå°‘å‘ç¾¤å¤–æš´éœ²çš„æ–¹å¼ï¼Œæˆ‘ä»¬å…ˆä½¿ç”¨ externalIPs æ–¹å¼åˆ›å»º svc æ¥è®©å®ƒèƒ½ä»é›†ç¾¤å¤–é¢è®¿é—®ï¼ˆæ­¤å¤„å…ˆå­¦å·¥ä½œåŸç†ï¼Œåé¢å†è®²é«˜å¯ç”¨ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;$INGRESS_VIP&lt;/code&gt;é€‰å–ä¸€ä¸ªå’Œå®¿ä¸»æœºåŒä¸€ä¸ªæ®µæ²¡ä½¿ç”¨è¿‡çš„ IP å³å¯ï¼ˆå®é™…ä¸Š Ingress Nginx bind çš„ç«¯å£ä¸æ­¢ 80 å’Œ 443ï¼Œè¿™é‡Œä¸è®¨è®ºï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥çœ‹å®¹å™¨é‡Œçš„é»˜è®¤é…ç½®æ–‡ä»¶ï¼‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingress-nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingress-nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingress-nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;LoadBalancer&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;externalIPs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;$INGRESS_VIP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingress-nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢çš„ yaml é‡Œåé¢è¯¦ç»†è§£é‡Šæˆ‘ä»¬éœ€è¦å…³æ³¨çš„é…ç½®é¡¹ï¼Œå…ˆæ¥åˆ›å»º ingress å¯¹è±¡è¯•è¯•ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æµ‹è¯•-http-7-å±‚è´Ÿè½½&#34;&gt;æµ‹è¯• http 7 å±‚è´Ÿè½½&lt;/h3&gt;
&lt;p&gt;éƒ¨ç½²äº†å®˜æ–¹çš„ ingress nginx åï¼Œæˆ‘éƒ¨ç½²äº†ä¸€ä¸ª nginx çš„ podï¼Œä¸ºå®ƒåˆ›å»ºäº†ä¸€ä¸ªåä¸º nginx çš„ serviceï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶ååˆ›å»ºå¯¹åº”çš„ä¸€ä¸ª ingress å¯¹è±¡æ¥æš´éœ²é›†ç¾¤é‡Œè¿™ä¸ª nginx çš„ http æœåŠ¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Ingress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx-ingress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx.testdomain.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servicePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰¾åˆ° ingress nginx çš„ pod åå­—åé€šè¿‡å‘½ä»¤æŸ¥çœ‹é‡Œé¢ nginx é…ç½®æ–‡ä»¶èƒ½æ‰¾åˆ°æœ‰å¯¹åº”çš„é…ç½®æ®µç”Ÿæˆï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;l&#34;&gt;$ kubectl -n ingress-nginx exec nginx-ingress-controller-6cdcfd8ff9-t5sxl -- cat /etc/nginx/nginx.conf&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;	&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;## start server nginx.testdomain.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;	&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;server {&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;		&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;server_name nginx.testdomain.com ;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;		
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;		&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;listen 80;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;		
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;		&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;set $proxy_upstream_name &amp;#34;-&amp;#34;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;		
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;		&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;location / {&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;			
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;			&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;set $namespace      &amp;#34;default&amp;#34;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;			&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;set $ingress_name   &amp;#34;nginx-ingress&amp;#34;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;			&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;set $service_name   &amp;#34;nginx&amp;#34;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;			&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;set $service_port   &amp;#34;80&amp;#34;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;			&lt;/span&gt;&lt;span class=&#34;l&#34;&gt;set $location_path  &amp;#34;/&amp;#34;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;........&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;	&lt;/span&gt;&lt;span class=&#34;c&#34;&gt;## end server nginx.testdomain.com      &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰¾ä¸€å°éé›†ç¾¤çš„ Windows æœºå™¨ï¼ˆä¹Ÿå¯ä»¥ macï¼Œä¸»è¦æ˜¯æœ‰å›¾å½¢ç•Œé¢ä¸”éé›†ç¾¤å†…æœºå™¨ï¼‰ï¼Œè®¾ç½® hosts æ–‡ä»¶æŠŠåŸŸå&lt;code&gt;nginx.testdomain.com&lt;/code&gt;è®¾ç½®åˆ°å¯¹ service çš„é‚£ä¸ª externalIPs çš„ ip ä¸Šï¼Œæ‰“å¼€æµè§ˆå™¨è®¿é—®&lt;code&gt;nginx.testdomain.com&lt;/code&gt;å³å¯å‘ç°é›†ç¾¤å†…çš„ nginx å·²ç»æš´éœ²åœ¨é›†ç¾¤å¤–ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šIngress Controller è™½ç„¶è°ƒç”¨çš„æ˜¯ serviceï¼Œçœ‹èµ·æ¥æŒ‰ç…§ nginx æ¥ç†è§£è½¬å‘æ˜¯ clientâ€“nginxâ€“svcâ€“pod; å®é™…ä¸Šè½¬å‘æ˜¯ clientâ€“nginxâ€“podï¼Œå› ä¸ºå·²ç»é­”æ”¹äº†ä¸èƒ½æŒ‰ç…§ nginx çš„æ¥ç†è§£ï¼Œæ˜¯ç›´æ¥è´Ÿè½½åˆ° svc çš„ endpoint ä¸Šé¢çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ä½ç‰ˆæœ¬çš„ ingress nginx çš„ args å‚æ•°&lt;code&gt;--default-backend-service=$(POD_NAMESPACE)/default-http-backend&lt;/code&gt;ï¼Œè¯¥å‚æ•°æŒ‡å®š ingress nginx çš„åŒ namespace ä¸‹åä¸º&lt;code&gt;default-http-backend&lt;/code&gt;çš„ service ä½œä¸ºé»˜è®¤è®¿é—®çš„æ—¶å€™é¡µé¢ï¼Œé€šå¸¸é‚£ä¸ªæ—¶å€™æ˜¯åˆ›å»ºä¸€ä¸ª 404 é¡µé¢çš„çš„ pod å’Œå¯¹åº” serviceï¼Œå¦‚æœ ingress nginx å¯åŠ¨çš„æ—¶å€™æ²¡æ‰¾åˆ°è¿™ä¸ª service ä¼šæ— æ³•å¯åŠ¨ï¼Œæ–°ç‰ˆæœ¬ä¸æ˜¯å¿…é¡»äº†ï¼Œå¥½åƒä¹Ÿè‡ªå¸¦ 404 é¡µé¢äº†ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤– ingress ä¹Ÿèƒ½å¤šè·¯å¾„ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;xxxx.xxxx.xxx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;service-index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servicePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;service-test-api&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servicePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;/api/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å¦‚ä½•æ¥-4-å±‚è´Ÿè½½&#34;&gt;å¦‚ä½•æ¥ 4 å±‚è´Ÿè½½&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ° ingress nginx çš„ args é‡Œæœ‰è¿™ä¸¤è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- --&lt;span class=&#34;l&#34;&gt;tcp-services-configmap=$(POD_NAMESPACE)/tcp-services&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- --&lt;span class=&#34;l&#34;&gt;udp-services-configmap=$(POD_NAMESPACE)/udp-services&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»é€‰é¡¹å’Œå€¼å¯ä»¥çŒœæµ‹å‡ºï¼Œè¦æƒ³ä»£ç†å››å±‚ï¼ˆtcp/udpï¼‰ï¼Œå¾—å†™åŒ namespace é‡Œä¸€ä¸ªåä¸º&lt;code&gt;tcp-service&lt;/code&gt;å’Œ&lt;code&gt;udp-service&lt;/code&gt;çš„ä¸¤ä¸ª configmap çš„æ•°æ®
å››å±‚çš„è¯è¿™è¾¹æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª mysql çš„ podï¼Œæ¥ä»£ç† 3306 ç«¯å£åˆ°é›†ç¾¤å¤–é¢ï¼Œåˆ™éœ€è¦å†™ tcp-services è¿™ä¸ª configmapï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ConfigMap&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;tcp-services&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingress-nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;3306&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;default/mysql:3306&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å››å±‚å†™è¿™ä¸¤ä¸ª ConfigMap çš„ data å³å¯ï¼ŒæŒ‰ç…§è¿™æ ·å»å†™å³å¯&lt;code&gt;out_port: namespaces/svc_name:port&lt;/code&gt;ï¼Œè¦ç»™æ¯ä¸ª ingress åŠ ä¸€äº› nginx é‡Œçš„é…ç½®å¯ä»¥æŸ¥çœ‹å®˜æ–¹çš„ annotation å­—æ®µä»¥åŠå€¼ï¼ˆtraefik åŒç†ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ingress-controller-é«˜å¯ç”¨&#34;&gt;Ingress Controller é«˜å¯ç”¨&lt;/h3&gt;
&lt;p&gt;è¿™é‡Œæ¥è®¨è®ºä¸‹&lt;code&gt;Ingress Controller&lt;/code&gt;çš„é«˜å¯ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;Ingress Controller åˆ°é›†ç¾¤å†…çš„è·¯å¾„è¿™éƒ¨åˆ†éƒ½æœ‰è´Ÿè½½å‡è¡¡äº†ï¼Œæˆ‘ä»¬æ¯”è¾ƒå…³æ³¨éƒ¨ç½²äº† Ingress Controller åï¼Œå¤–éƒ¨åˆ°å®ƒè¿™æ®µè·¯æ€ä¹ˆé«˜å¯ç”¨ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä¸Šé¢çš„ä¾‹å­é‡Œ service æˆ‘ä½¿ç”¨çš„ externalIPsï¼Œä½†æ˜¯ä»£ç†å››å±‚çš„æ—¶å€™ä¼šæ–°åŠ ç«¯å£ï¼Œéœ€è¦æ¯æ¬¡äººä¸ºå»ä»‹å…¥å¢åŠ æš´éœ²ç«¯å£ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æµé‡ä»å…¥å£åˆ°&lt;code&gt;Ingress Controller&lt;/code&gt;çš„ pod æœ‰ä¸‹é¢å‡ ç§æ–¹å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;type ä¸º&lt;code&gt;LoadBalancer&lt;/code&gt;çš„æ—¶å€™æ‰‹å†™&lt;code&gt;externalIPs&lt;/code&gt;å¾ˆé¸¡è‚‹ï¼Œåé¢ä¼šå†å†™æ–‡ç« å»è®²å®ƒ&lt;/li&gt;
&lt;li&gt;type ä¸º&lt;code&gt;LoadBalancer&lt;/code&gt;çš„æ—¶å€™åªæœ‰äº‘å‚å•†æ”¯æŒåˆ†é…å…¬ç½‘ ip æ¥è´Ÿè½½å‡è¡¡ï¼ŒLoadBalancer å…¬å¼€çš„æ¯é¡¹æœåŠ¡éƒ½å°†è·å¾—è‡ªå·±çš„ IP åœ°å€ï¼Œä½†æ˜¯éœ€è¦æ”¶è´¹ï¼Œä¸”è‡ªå·±å»ºç«‹é›†ç¾¤æ— æ³•ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;ä¸åˆ›å»º serviceï¼Œpod ç›´æ¥ç”¨ hostportï¼Œæ•ˆç‡ç­‰åŒäº&lt;code&gt;hostNetwork&lt;/code&gt;ï¼Œå¦‚æœä¸ä»£ç†å››å±‚ç«¯å£è¿˜å¥½ï¼Œä»£ç†äº†éœ€è¦ä¿®æ”¹ pod çš„ template æ¥æ»šåŠ¨æ›´æ–°æ¥è®© nginx bind çš„å››å±‚ç«¯å£èƒ½æ˜ å°„åˆ°å®¿ä¸»æœºä¸Š&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Nodeport&lt;/code&gt;ï¼Œç«¯å£ä¸æ˜¯ web ç«¯å£ï¼ˆä½†æ˜¯å¯ä»¥ä¿®æ”¹ Nodeport çš„èŒƒå›´æ”¹æˆ web ç«¯å£ï¼‰ï¼Œå¦‚æœè¿›æ¥æµé‡è´Ÿè½½åˆ° Nodeport ä¸Šå¯èƒ½æŸä¸ªæµé‡è·¯çº¿åˆ°æŸä¸ª node ä¸Šçš„æ—¶å€™å› ä¸º&lt;code&gt;Ingress Controller&lt;/code&gt;çš„ pod ä¸åœ¨è¿™ä¸ª node ä¸Šï¼Œä¼šèµ°è¿™ä¸ª node çš„ kube-proxy è½¬å‘åˆ° Ingress Controller çš„ pod ä¸Šï¼Œå¤šèµ°ä¸€è¶Ÿè·¯&lt;/li&gt;
&lt;li&gt;ä¸åˆ›å»º serviceï¼Œæ•ˆç‡æœ€é«˜ï¼Œä¹Ÿèƒ½å››å±‚è´Ÿè½½çš„æ—¶å€™ä¸ä¿®æ”¹ pod çš„ templateï¼Œå”¯ä¸€è¦æ³¨æ„çš„æ˜¯&lt;code&gt;hostNetwork&lt;/code&gt;ä¸‹ pod ä¼šç»§æ‰¿å®¿ä¸»æœºçš„ç½‘ç»œåè®®ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨äº†ä¸»æœºçš„ dnsï¼Œä¼šå¯¼è‡´ svc çš„è¯·æ±‚ç›´æ¥èµ°å®¿ä¸»æœºçš„ä¸Šåˆ°å…¬ç½‘çš„ dns æœåŠ¡å™¨è€Œéé›†ç¾¤é‡Œçš„ dns serverï¼Œéœ€è¦è®¾ç½® pod çš„&lt;code&gt;dnsPolicy: ClusterFirstWithHostNet&lt;/code&gt;å³å¯è§£å†³&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å†™åœ¨æœ€å&#34;&gt;å†™åœ¨æœ€å&lt;/h2&gt;
&lt;p&gt;éƒ¨ç½²æ–¹å¼æ²¡å¤šå¤§åŒºåˆ«å¼€å¿ƒå°±å¥½ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;DaemonSet + nodeSeletor&lt;/li&gt;
&lt;li&gt;deploy è®¾ç½® replicas æ•°é‡ + nodeSeletor + pod äº’æ–¥&lt;/li&gt;
&lt;li&gt;æ‰€ä»¥å¯ä»¥ä¸€ä¸ª vip é£˜åœ¨æ‹¥æœ‰å­˜æ´»çš„ controller çš„å®¿ä¸»æœºä¸Šï¼Œäº‘ä¸Šçš„è¯å°±ç”¨ slb æ¥è´Ÿè½½ä»£æ›¿ vip&lt;/li&gt;
&lt;li&gt;æœ€åè¯´è¯´åŸŸåè¯·æ±‚æŒ‡å‘å®ƒï¼Œå¦‚æœéƒ¨ç½²åœ¨å†…ç½‘æˆ–è€…åŠå…¬å®¤å•¥çš„ï¼Œå†…ç½‘æœ‰ dns server çš„è¯æŠŠ ing çš„åŸŸåå…¨éƒ¨è§£æåˆ° ingress controller çš„å®¿ä¸»æœº ip ä¸Šï¼Œå¦åˆ™è¦æœ‰äººè®¿é—®æ¯ä¸ªäººè®¾ç½®/etc/hosts æ‰èƒ½æŠŠåŸŸåè§£ææ¥è´¼éº»çƒ¦ï¼Œå¦‚æœæ²¡æœ‰ dns server å¯ä»¥è·‘ä¸€ä¸ª external-dnsï¼Œå®ƒçš„ä¸Šæ¸¸ dns æ˜¯å…¬ç½‘çš„ dns æœåŠ¡å™¨ï¼ŒåŠå…¬ç½‘å†…æœºå™¨çš„ dns server æŒ‡å‘å®ƒå³å¯ï¼Œäº‘ä¸Šçš„è¯æŠŠåŸŸåè¯·æ±‚è§£æåˆ°å¯¹åº” ip å³å¯&lt;/li&gt;
&lt;li&gt;traefik å’Œ ingress nginx ç±»ä¼¼ï¼Œä¸è¿‡å®ƒç”¨ go å®ç°çš„&lt;/li&gt;
&lt;li&gt;åœ¨ä¸€äº›è€ç‰ˆæœ¬çš„ ingress nginx çš„ log é‡Œä¼šä¸€ç›´åˆ·æ‰¾ä¸åˆ° ingress-nginx çš„ svcï¼Œä¸å¤„ç†çš„è¯ä¼šç‹‚åˆ· log å¯¼è‡´æœºå™¨ load è¿‡é«˜ï¼Œåˆ›å»ºä¸€ä¸ªåŒåçš„ svc å³å¯è§£å†³ï¼Œä¾‹å¦‚åˆ›å»ºä¸€ä¸ªä¸å¸¦é€‰æ‹©å™¨ clusterip ä¸º null çš„å³å¯ã€‚éè¦åˆ›å»º port çš„ svc çš„è¯å‚ç…§ä¸‹é¢ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingress-nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingress-nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app.kubernetes.io/name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingress-nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app.kubernetes.io/part-of&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingress-nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterIP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;metrics&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10254&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10254&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app.kubernetes.io/name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingress-nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app.kubernetes.io/part-of&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ingress-nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒï¼š&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/ingress-nginx/blob/master/docs/deploy/index.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ingress-nginx deploy - github.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.github.io/ingress-nginx/deploy/baremetal/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ingress-nginx deploy - kubernetes.github.io&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>é¢å‘ Kubernetes ç¼–ç¨‹ï¼šKubernetes æ˜¯ä¸‹ä¸€ä»£æ“ä½œç³»ç»Ÿ</title>
      <link>https://cloudnativecn.com/blog/the-data-center-os-kubernetes/</link>
      <pubDate>Wed, 20 Feb 2019 16:33:31 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/the-data-center-os-kubernetes/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;æ­¤æ–‡ç« é€‚åˆæ²¡æœ‰ä»»ä½• Kubernetes/å®¹å™¨/Docker ç»éªŒçš„åŒå­¦ â€” åœ¨ä¸ä¹…çš„å°†æ¥ï¼Œä½ ä¸æ‡‚å¦‚ä½•æ“ä½œ Kubernetes æ¥å£ï¼Œå°±ç­‰äºç°åœ¨çš„ä½ ä¸æ‡‚æœ€æ™®é€šçš„ Linux å‘½ä»¤ã€‚æ­¤æ–‡ç« é˜…è¯»è€—æ—¶å¤§æ¦‚ 15 åˆ†é’Ÿã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;èš‚èšé‡‘æœèµ„æºè°ƒåº¦ç»„è‡´åŠ›äºå°† Kubernetes è½åœ°åˆ°ä¸–ç•Œä¸Šæœ€æœ‰ä»·å€¼çš„é‡‘èç§‘æŠ€ç‹¬è§’å…½å…¬å¸ï¼Œæ¬¢è¿è”ç³»ä½œè€…å¾®ä¿¡ &lt;strong&gt;answer1991chen&lt;/strong&gt; å’¨è¯¢æ‹›è˜äº‹å®œã€‚&lt;/p&gt;
&lt;p&gt;æ–‡ç«  Markdown æºç ä½äº &lt;a href=&#34;https://github.com/answer1991/articles/blob/master/Kubernetes-is-the-next-generation-os.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/answer1991/articles/blob/master/Kubernetes-is-the-next-generation-os.md&lt;/a&gt;ï¼Œéµä» Apache License 2.0 å¼€æºåè®®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¯¼è¨€&#34;&gt;å¯¼è¨€&lt;/h2&gt;
&lt;p&gt;æ­¤æ–‡ç« ç€é‡ä»‹ç»å¦‚ä½•åœ¨å…¥é—¨é˜¶æ®µä½¿ç”¨ Kubernetesï¼Œä»¥åŠè¦é¢å‘ Kubernetes ç¼–ç¨‹å¸¦æ¥çš„ä¼˜åŠ¿ï¼Œä¸ä¼šä»‹ç»å¤æ‚çš„ Kubernetes æ¶æ„ã€å®ç°ã€‚å› æ­¤æ­¤æ–‡ç« é€‚åˆæ²¡æœ‰ä»»ä½• Kubernetes/å®¹å™¨/Docker ç»éªŒçš„åŒå­¦ï¼Œå¯¹ Kubernetes æœ‰äº†è§£çš„åŒå­¦ä¹Ÿå¯ä»¥ä»æ­¤æ–‡ç« é‡Œé¢è·å–ä¸€äº›çµæ„Ÿï¼Œå¯ä»¥æ›´åŠ é…·ç‚«çš„ç©è½¬ Kubernetesã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¸Œæœ›åœ¨é˜…è¯»å®Œæ­¤æ–‡ç« ä¹‹åï¼Œä½ å¯ä»¥ä»â€œæˆ‘éœ€è¦ä¸€ä¸ª Linux VM åšå¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²â€ï¼Œå˜æˆâ€œæˆ‘éœ€è¦ä¸€ä¸ª Kubernetes åšå¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²â€ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;kubernetes-æ˜¯ä¸‹ä¸€ä»£æ“ä½œç³»ç»Ÿ&#34;&gt;Kubernetes æ˜¯ä¸‹ä¸€ä»£æ“ä½œç³»ç»Ÿ&lt;/h2&gt;
&lt;p&gt;Kubernetes æ˜¯è¿™å‡ å¹´éå¸¸çƒ­é—¨çš„ä¸€ä¸ªè¯æ±‡ï¼Œå¤§æ¦‚æ‰€æœ‰çš„è½¯ä»¶å·¥ç¨‹å¸ˆéƒ½å·²ç»å¬è¯´è¿‡è¿™ä¸ªè¯ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆ Kubernetes åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¯èƒ½ Google ä¼šå‘Šè¯‰ä½ å¾ˆå¤šï¼Œä½†æ˜¯æˆ‘æƒ³å‘Šè¯‰ä½ çš„æ˜¯ï¼šKubernetes æ˜¯ä¸‹ä¸€ä»£æ“ä½œç³»ç»Ÿï¼›ä¸€ä¸ª Kubernetes é›†ç¾¤æ˜¯ä¸€ä¸ªèµ„æºæ— é™å¤§ (å¯æ‰©å®¹) çš„è™šæ‹Ÿæœºã€‚&lt;strong&gt;è€Œä¸”ï¼ŒKubernetes çš„æ¥å£æ˜¯æ˜¯å£°æ˜å¼çš„ï¼Œæ˜¯å¤©ç„¶é¢å‘åˆ†å¸ƒå¼ç³»ç»Ÿè€Œè®¾è®¡çš„ï¼ˆä¸‹é¢ä¼šè¯¦ç»†ä»‹ç»ï¼‰ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¯´åˆ°è¿™é‡Œï¼Œå¤§å®¶ä¼°è®¡ç«‹åˆ»å°±æœ‰ç–‘é—®äº†ã€‚æˆ‘æƒ³å¤§æ¦‚æ˜¯è¿™äº›ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Q: é‚£ä¹ˆï¼ŒLinuxã€Windows è¦è¢«æ·˜æ±°äº†ï¼Ÿ&lt;/p&gt;
&lt;p&gt;A: ä¸ä¼šè¢«æ·˜æ±°ï¼Œåªæ˜¯ Linuxã€Windows æ˜¯ä¸€ä¸ªåº•å±‚çš„å•æœºæ“ä½œç³»ç»Ÿã€‚è€Œæˆ‘ä»¬è¿™äº›æ™®é€šçš„åº”ç”¨è½¯ä»¶å·¥ç¨‹å¸ˆå°†æ¥éƒ½ä¸ä¼šè·Ÿ Linux æ‰“äº¤é“äº†ï¼Œéƒ½ä¼šä½¿ç”¨ Kubernetes è¿™ä¸ªæ›´ä¸Šå±‚ã€åŒæ—¶åŠŸèƒ½ä¹Ÿæ›´å¼ºå¤§çš„æ“ä½œç³»ç»Ÿã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Q: é‚£ä¹ˆï¼Œæˆ‘ä¸å­¦ Kubernetes å¯ä»¥å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;A: ä¸è¡Œï¼åœ¨æœªæ¥ä¸ä¹…çš„æŸä¸€å¤©ï¼Œä¹Ÿè®¸äº‘å‚å•†åªå– Kubernetesâ€œè™šæ‹Ÿæœºâ€äº†ï¼šé˜¿é‡Œäº‘ä¸å•ç‹¬å– ecs äº†ï¼Œäºšé©¬é€Š AWSï¼Œå¾®è½¯äº‘ï¼ŒGoogle äº‘ç­‰å„ç§äº‘å‚å•†éƒ½ä¸å– Linux è™šæ‹Ÿæœºäº†ã€‚å¦‚æœä½ æƒ³ä¹°å•æœºç‰ˆçš„ Linux è™šæ‹Ÿæœºï¼Œä»–ä»¬éƒ½ä¼šä¸€è„¸æƒŠè®¶çš„é—®ä½ ï¼Œä½ ä¹°é‚£ä¹ˆåº•å±‚çš„ã€åŠŸèƒ½é‚£ä¹ˆè–„å¼±çš„è®¡ç®—æœºå¹²ä»€ä¹ˆï¼Ÿå°±åƒä½ ç°åœ¨ä»äº‘å‚å•†é‚£é‡Œä¹°ä¸åˆ°ä¸€ä¸ªè¿˜æ²¡æœ‰å®‰è£… Linux çš„è™šæ‹Ÿæœºä¸€æ ·ã€‚ä»¥åï¼Œäº‘å‚å•†äº¤ä»˜çš„â€œè™šæ‹Ÿæœºâ€å¿…å®šæ˜¯â€œé›†ç¾¤çº§åˆ«çš„è™šæ‹Ÿæœºâ€ ï¼Œè€Œâ€œé›†ç¾¤çº§åˆ«çš„è™šæ‹Ÿæœºâ€çš„æ“ä½œç³»ç»Ÿå°±æ˜¯ Kubernetesã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åœ¨ä¸ä¹…çš„å°†æ¥ï¼Œä½ ä¸æ‡‚å¦‚ä½•æ“ä½œ Kubernetes æ¥å£ï¼Œå°±ç­‰äºç°åœ¨çš„ä½ ä¸æ‡‚æœ€æ™®é€šçš„ Linux å‘½ä»¤ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Q: é‚£è¿™æ ·çš„è¯ï¼Œæˆ‘ä¹°ä¸åˆ° Linux è™šæ‹Ÿæœºï¼Œæˆ‘è¿å­¦ä¹  Linux çš„æœºä¼šéƒ½æ²¡æœ‰äº†ï¼Ÿ&lt;/p&gt;
&lt;p&gt;A: å½“ç„¶ä¸æ˜¯ï¼Œæœ‰äº† Kubernetesï¼Œä½ å¯ä»¥åœ¨ 1 ç§’å†…è‡ªå·±æä¸€ä¸ªä»»ä½• Linux å‘è¡Œç‰ˆæœ¬çš„â€œå•æœºè™šæ‹Ÿæœºâ€å‡ºæ¥ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Q: Kubernetes çœŸçš„æ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼ŸShow me&amp;hellip;.&lt;/p&gt;
&lt;p&gt;A:&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;åŠŸèƒ½/åè¯&lt;/th&gt;
          &lt;th&gt;å•æœº Linux&lt;/th&gt;
          &lt;th&gt;Kubernetes&lt;/th&gt;
          &lt;th&gt;è¯´æ˜&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;Shell, CMD&lt;/td&gt;
          &lt;td&gt;sh, bash&lt;/td&gt;
          &lt;td&gt;kubectl&lt;/td&gt;
          &lt;td&gt;kubectl æ˜¯ Kubernetes çš„ shell å·¥å…·ï¼Œæœ‰äº† kubectl ä½ å°±å¯ä»¥è¿æ¥å¹¶ç®¡ç† Kubernetes è¿™ä¸ªè¶…çº§è™šæ‹Ÿæœºäº†ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ç”¨æˆ·ï¼Œç™»å½• Linux&lt;/td&gt;
          &lt;td&gt;User, Group, ssh ç™»å½•&lt;/td&gt;
          &lt;td&gt;kubeconfig æ–‡ä»¶ç±»ä¼¼ Linux ssh çš„ .key æ–‡ä»¶ï¼Œç”¨æˆ·ä½¿ç”¨ kubeconfig è®¿é—® Kubernetes å°±è‡ªå¸¦äº†ç”¨æˆ·ä¿¡æ¯ã€‚Kubernetes èƒ½æ ¹æ®ç”¨æˆ·é™åˆ¶æƒé™ï¼Œä¹Ÿèƒ½é™åˆ¶ç”¨æˆ·èƒ½ä½¿ç”¨çš„èµ„æºã€‚kubectl ä½¿ç”¨ kubeconfig è®¿é—® Kubernetes å°±å¥½æ¯”ä½¿ç”¨ .ssh key è®¿é—® Linux&lt;/td&gt;
          &lt;td&gt;Kubernetes é›†ç¾¤ç®¡ç†å‘˜ (æˆ–è€…è‡ªåŠ¨åŒ–çš„ç”³è¯·ç³»ç»Ÿ) ä¸ºç”¨æˆ·é¢å‘ kubeconfig æ–‡ä»¶ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;è¿›ç¨‹&lt;/td&gt;
          &lt;td&gt;è¿›ç¨‹&lt;/td&gt;
          &lt;td&gt;Pod&lt;/td&gt;
          &lt;td&gt;Pod å°±æ˜¯ Kubernetes è¿™ä¸ªâ€œè¶…çº§è™šæ‹Ÿæœºâ€çš„è¿›ç¨‹ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ç®¡ç†è¿›ç¨‹&lt;/td&gt;
          &lt;td&gt;ps, kill&lt;/td&gt;
          &lt;td&gt;kubectl get po, kubectl delete pod&lt;/td&gt;
          &lt;td&gt;å‘å¸ƒã€å‡çº§ã€ç®¡ç†â€œè¿›ç¨‹â€(æˆ–è€…è¯´åº”ç”¨)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;é…ç½®ç®¡ç†&lt;/td&gt;
          &lt;td&gt;ç™»å½•å„ä¸ª Linux VMï¼Œæ›¿æ¢æœºå™¨ä¸Šçš„æ–‡ä»¶ã€‚&lt;/td&gt;
          &lt;td&gt;kubectl apply -f ./cm.yaml&lt;/td&gt;
          &lt;td&gt;ä½¿ç”¨ ConfigMap ç®¡ç†åº”ç”¨çš„é…ç½®æ–‡ä»¶ï¼Œä¸€æ¬¡æäº¤ï¼Œè¿›ç¨‹çš„æ¯ä¸ªå®ä¾‹è‡ªåŠ¨ç”Ÿæ•ˆæ–°çš„é…ç½®ã€‚ç”±äºç¯‡å¹…ç®¡ç†ï¼Œä½¿ç”¨ ConfigMap é…ç½®åº”ç”¨ï¼ˆâ€œè¿›ç¨‹â€ï¼‰å¯åŠ¨å‚æ•°ä¸åœ¨æ­¤æ–‡ç« é‡Œé¢ä¸¾ä¾‹ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;å‘å¸ƒã€ç®¡ç†ã€å‡çº§åº”ç”¨&lt;/td&gt;
          &lt;td&gt;åœ¨ Linux ä¸Šé¢å‘å¸ƒä¸€ä¸ªåº”ç”¨ï¼Œéœ€è¦ä¸€é¡¿ç–¯ç‹‚çš„æ“ä½œï¼šå…ˆé˜…è¯»å¦‚ä½•å‘å¸ƒã€å‚æ•°æœ‰ä»€ä¹ˆã€ä¸‹è½½äºŒè¿›åˆ¶åŒ…ã€æå®šä¸€äº›é…ç½®æ–‡ä»¶ï¼Œç„¶åè¿è¡Œåº”ç”¨ã€‚&lt;/td&gt;
          &lt;td&gt;kubectl apply -f ./my-app.yaml&lt;/td&gt;
          &lt;td&gt;my-app.yaml å¯èƒ½æ˜¯åº”ç”¨æä¾›å•†æä¾›çš„ã€é¢å‘ Kubernetes å‘å¸ƒåº”ç”¨çš„â€œèœå•â€æ–‡ä»¶ (ä¸ºä»€ä¹ˆå«â€œèœå•â€æˆ‘åé¢ä¼šä»‹ç»)ã€‚åªè¦æäº¤è¿™ä¸ªâ€œèœå•â€ï¼Œåº”ç”¨å°±éƒ¨ç½²å¥½äº†ã€‚Kubernetes è®©ä¸€åˆ‡ç®€å•ï¼Œè€Œä¸”ï¼Œå®ƒæ˜¯åˆ†å¸ƒå¼ï¼Œæ˜¯å¤©ç„¶å®¹ç¾çš„ã€‚åªè¦å‘ Kubernetes æäº¤ Deployment è¿™æ ·çš„â€œèµ„æºâ€å³å¯ï¼Œä¸‹æ–‡æœ‰ä»‹ç»ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;é™åˆ¶åº”ç”¨èµ„æº&lt;/td&gt;
          &lt;td&gt;ä¸€é¡¿ç–¯ç‹‚çš„æ“ä½œï¼ŒæŠŠåº”ç”¨è¿›ç¨‹çš„ Cgroup é™åˆ¶å¥½ã€‚&lt;/td&gt;
          &lt;td&gt;å‘å¸ƒåº”ç”¨æ—¶å·²ç»åšäº†&lt;/td&gt;
          &lt;td&gt;Kubernetes è®©ä¸€åˆ‡ç®€å•ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;åˆ†å¸ƒå¼åº”ç”¨å‘å¸ƒ&lt;/td&gt;
          &lt;td&gt;åœ¨å„ä¸ª Linux è™šæ‹Ÿæœºä¸Šé¢å‘å¸ƒå¥½åº”ç”¨ï¼Œç„¶åæŠŠä»–ä»¬ç»„ç½‘ã€‚&lt;/td&gt;
          &lt;td&gt;å‘å¸ƒåº”ç”¨æ—¶å·²ç»åšäº†&lt;/td&gt;
          &lt;td&gt;è¿˜æ˜¯é‚£å¥è¯ï¼ŒKubernetes è®©ä¸€åˆ‡ç®€å•ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;åˆ†å¸ƒå¼åº”ç”¨å®¹ç¾&lt;/td&gt;
          &lt;td&gt;æä¸ªç›‘æ§ï¼Œç›‘æ§æˆ‘ä»¬å„ä¸ª Linux è™šæ‹Ÿæœºä¸Šé¢çš„åº”ç”¨æ˜¯ä¸æ˜¯ä¸å¥åº·äº†ã€‚ä¸å¥åº·äº†çš„è¯ï¼Œæˆ‘ä»¬èµ·åºŠï¼Œæ¥ä¸€æ¬¡â€œä¸€é¡¿æ“ä½œçŒ›å¦‚è™â€çš„æ•…éšœæ¢å¤æ“ä½œã€‚&lt;/td&gt;
          &lt;td&gt;/&lt;/td&gt;
          &lt;td&gt;å¤©ç„¶å®¹ç¾ï¼Œå®‰å¿ƒç¡ä½ çš„è§‰ã€‚&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æ•°æ®æŒä¹…åŒ–ï¼Œæ•…éšœæ—¶æ•°æ®è¿ç§»&lt;/td&gt;
          &lt;td&gt;â€œä¸€é¡¿æ“ä½œçŒ›å¦‚è™â€&lt;/td&gt;
          &lt;td&gt;ç”¨ PVï¼ˆæŒä¹…åŒ–å­˜å‚¨å·ï¼‰ï¼Œå®¹ç¾æŠŠåº”ç”¨çš„ä¸€ä¸ªåº”ç”¨å®ä¾‹ä»â€œèŠ‚ç‚¹ä¸€â€åˆ‡æ¢åˆ°äº†â€œèŠ‚ç‚¹äºŒâ€ï¼Œéƒ½ä¸ç”¨åšä»»ä½•æ•°æ®è¿ç§»ã€‚æ–°çš„åº”ç”¨å®ä¾‹èµ·æ¥å°±èƒ½ä½¿ç”¨è€æ•°æ®ã€‚&lt;/td&gt;
          &lt;td&gt;è¿˜æ˜¯é‚£å¥è¯ï¼ŒKubernetes è®©ä¸€åˆ‡ç®€å•ã€‚æˆ‘éƒ½ä¸ç”¨å…³å¿ƒè¿™ä¸ªäº‹æƒ…ã€‚ï¼ˆç”±äºç¯‡å¹…ç®¡ç†ï¼Œä¸‹æ–‡çš„ä¾‹å­ä¸­ä¹Ÿä¸ä¼šæ¶‰åŠ PV çš„ä¾‹å­ï¼‰&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;â€œä¸€é¡¿æ“ä½œçŒ›å¦‚è™â€å¬èµ·æ¥å¾ˆé…·ï¼Œä½†æ˜¯ä½ åœ¨åšä¸€äº›æ²¡å¿…è¦çš„äº‹æƒ…ï¼ŒåŒæ—¶ä½ åšäº†è¿™äº›äº‹æƒ…å¹¶ä¸è®¨å¥½ä½ çš„è€æ¿ï¼Œå¯èƒ½åœ¨å› ä¸ºä½ çš„å¤±è¯¯æ“ä½œå¼•èµ·æ›´å¤§çš„æ•…éšœå’Œé—®é¢˜ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é¢å‘ Kubernetes åšæœ€ç®€å•çš„æ“ä½œï¼Œè¾¾åˆ°æœ€ä½³çš„æ•ˆæœï¼Œæ‰æ˜¯æ›´é…·çš„äº‹æƒ…ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;A: è¡Œäº†è¡Œäº†ï¼Œåˆ«è¯´é‚£ä¹ˆå¤šäº†ï¼Œæˆ‘è¿˜æ˜¯éœ€è¦ä¸€ä¸ª Linux VMã€‚&lt;/p&gt;
&lt;p&gt;Q: å¥½çš„ï¼Œæˆ‘ç»™æ‚¨ä¸€ä¸ª Kubernetesï¼Œç„¶åç»™ä½ ä¸€ä¸ª åŸºç¡€ OS Podâ€œèœå•â€æ–‡ä»¶ï¼Œç„¶åæ‚¨è‡ªå·±å°±å¯ä»¥åˆ›å»ºä»»ä½•ä¸€ä¸ª Linux å‘è¡Œç‰ˆã€ä»»ä½•ä¸€ä¸ª Linux ç‰ˆæœ¬çš„çš„ Linux VM äº†ã€‚åœ¨æ–‡ç« çš„æœ€åä¼šæœ‰ä»‹ç»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å°è¯•ç‰›åˆ€&#34;&gt;å°è¯•ç‰›åˆ€&lt;/h2&gt;
&lt;p&gt;æ—¢ç„¶æ˜¯â€œå°è¯•â€ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥å°è¯•ä¸€ä¸ªæœ€ç®€å•çš„åº”ç”¨ï¼Œä¸€ä¸ª HTTP æœåŠ¡ï¼šnignxã€‚åŒæ—¶ï¼Œæˆ‘åº”è¯¥éƒ¨ç½²ä¸€ä¸ªé«˜å¯ç”¨ã€å¤šå‰¯æœ¬ (ä¾‹å­ä¸­ä¸º 3 å‰¯æœ¬) å¤©ç„¶å®¹ç¾çš„ nginxã€‚&lt;/p&gt;
&lt;p&gt;éƒ¨ç½²å®Œæˆçš„ç»“æ„å›¾å¤§æ¦‚å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/the-data-center-os-kubernetes/006tKfTcly1g0d0l7cowtj30zo0dedgy_hu934298408625699667.webp 400w,
               /blog/the-data-center-os-kubernetes/006tKfTcly1g0d0l7cowtj30zo0dedgy_hu12464261367597769629.webp 760w,
               /blog/the-data-center-os-kubernetes/006tKfTcly1g0d0l7cowtj30zo0dedgy_hu13757148908522226921.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/the-data-center-os-kubernetes/006tKfTcly1g0d0l7cowtj30zo0dedgy_hu934298408625699667.webp&#34;
               width=&#34;760&#34;
               height=&#34;285&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h5 id=&#34;æ²¡æœ‰-kubernetes-ä¹‹å‰çš„éƒ¨ç½²&#34;&gt;æ²¡æœ‰ Kubernetes ä¹‹å‰çš„éƒ¨ç½²&lt;/h5&gt;
&lt;p&gt;åœ¨æ²¡æœ‰ Kubernetes ä¹‹å‰ï¼Œæˆ‘ä»¬å¤§æ¦‚è¦åšè¿™ä¹ˆäº›æ“ä½œæ‰èƒ½äº¤ä»˜è¿™ä¸ª nginx æœåŠ¡ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ°ä¸‰ä¸ª Linux VM ä¸Šé¢ï¼Œåˆ†åˆ«æŠŠä¸‰ä¸ª nginx è¿›ç¨‹èµ·å¥½ã€‚è¿™é‡Œå¯èƒ½è¿˜éœ€è¦å…³å¿ƒ nginx è¿›ç¨‹æ€ä¹ˆèµ·ã€å¯åŠ¨å‘½ä»¤æ˜¯å•¥ã€é…ç½®æ€ä¹ˆé…ã€‚&lt;/li&gt;
&lt;li&gt;åˆ°è´Ÿè½½å‡è¡¡ç®¡ç†é¡µé¢ï¼Œç”³è¯·ä¸€ä¸ªè´Ÿè½½å‡è¡¡ï¼ŒæŠŠ 3 ä¸ª nignx è¿›ç¨‹çš„ IP å¡«å…¥ã€‚æ‹¿å›è´Ÿè½½å‡è¡¡çš„ IPã€‚&lt;/li&gt;
&lt;li&gt;åˆ° DNS ç®¡ç†é¡µé¢ç”³è¯·ä¸€ä¸ª DNS è®°å½•ï¼Œå†™å…¥æŠŠæ‹¿åˆ°çš„è´Ÿè½½å‡è¡¡çš„ IP å†™å…¥ A è®°å½•ã€‚&lt;/li&gt;
&lt;li&gt;æŠŠè¿™ä¸ª DNS è®°å½•ä½œä¸ºè¿™ä¸ª nginx æœåŠ¡çš„äº¤ä»˜æˆæœï¼Œäº¤ä»˜ç»™ç”¨æˆ·ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h5 id=&#34;æœ‰äº†-kubernetes-çš„éƒ¨ç½²&#34;&gt;æœ‰äº† Kubernetes çš„éƒ¨ç½²&lt;/h5&gt;
&lt;p&gt;æœ‰äº† Kubernetes ä¹‹åï¼Œæˆ‘ä»¬åªéœ€è¦å†™ä¸€ä¸ª nginx å¦‚ä½•éƒ¨ç½²çš„â€œèœå•â€ï¼Œç„¶åæäº¤è¿™ä¸ªâ€œèœå•â€ç»™ Kubernetesï¼Œæˆ‘ä»¬å°±å®Œæˆäº†éƒ¨ç½²ã€‚ â€œèœå•â€æ˜¯ä¸€ä¸ª yaml æ–‡ä»¶ (ä¾‹å­ä¸­æ–‡ä»¶å nginx.yaml)ï¼Œå¤§æ¦‚è¿™ä¸ªæ ·å­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app-name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app-name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app-name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterIP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æäº¤â€œèœå•â€åˆ° Kubernetes é›†ç¾¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f ./nginx.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®¿é—®åˆšéƒ¨ç½²çš„ HTTP æœåŠ¡ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/the-data-center-os-kubernetes/006tKfTcly1g0d0mmkficj311c0lyq69_hu9707316966660520902.webp 400w,
               /blog/the-data-center-os-kubernetes/006tKfTcly1g0d0mmkficj311c0lyq69_hu9464699941695909203.webp 760w,
               /blog/the-data-center-os-kubernetes/006tKfTcly1g0d0mmkficj311c0lyq69_hu7493184345872208061.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/the-data-center-os-kubernetes/006tKfTcly1g0d0mmkficj311c0lyq69_hu9707316966660520902.webp&#34;
               width=&#34;760&#34;
               height=&#34;447&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿè¿™é‡Œå¤§æ¦‚ç®€å•çš„ä»‹ç»ä¸€ä¸‹æˆ‘ä»¬çš„â€œèœå•â€ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æˆ‘ä»¬å‘ Kubernetes æäº¤äº†ä¸€ä¸ªå« nginx çš„ Deploymentã€‚Deployment æ˜¯ Kubernetes é‡Œçš„ä¸€ç§å‰¯æœ¬ä¿æŒâ€œèµ„æºå£°æ˜â€ï¼Œæˆ‘ä»¬åœ¨æˆ‘ä»¬çš„ Deployment å£°æ˜äº† éœ€è¦&lt;strong&gt;3&lt;/strong&gt;ä¸ªå‰¯æœ¬ (replica: 3)ï¼Œå‰¯æœ¬çš„å†…å®¹ (template: &amp;hellip; ) æ˜¯ç”¨ nginx é•œåƒå¯åŠ¨çš„ Pod(Pod å³ Linux é‡Œçš„è¿›ç¨‹ï¼Œå¦‚ä¸Šç« èŠ‚ä»‹ç»çš„)ã€‚å¦‚æœæ²¡æœ‰ç©è¿‡ docker çš„åŒå­¦ï¼Œå¯ä»¥æŠŠ nginx é•œåƒ è®¤ä¸ºæ˜¯ nginx äºŒè¿›åˆ¶åŒ…ï¼Œåªä¸è¿‡å®ƒæ˜¯ docker é•œåƒæ–¹å¼å­˜åœ¨çš„ï¼Œä¸åœ¨è¿™é‡Œè¯¦ç»†å±•å¼€ã€‚æˆ‘ä»¬çš„ nginx Pod æ‰“ä¸Šäº† my-app=nginx è¿™æ ·çš„ Label, Label å¯ä»¥ç†è§£æˆ åˆ†ç±»â€œæ ‡ç­¾â€ï¼Œåˆ«äºº (Service) æ¥å®šä½æˆ‘ä»¬ Pod  éœ€è¦ç”¨è¿™æ ·çš„â€œæ ‡ç­¾â€æ¥åŒ¹é…ã€‚&lt;/li&gt;
&lt;li&gt;æˆ‘ä»¬è¿˜å‘ Kubernetes æäº¤äº†ä¸€ä¸ª Serviceã€‚æäº¤ä¸€ä¸ª Service å°±æ˜¯å‘ Kubernetes ç”³è¯·ä¸€ä¸ª è´Ÿè½½å‡è¡¡ã€‚Service ä¾é  Label (selector: &amp;hellip;) å»æ‰¾åˆ°å®ƒçš„åç«¯çœŸå®è¿›ç¨‹ (Pod)ã€‚&lt;/li&gt;
&lt;li&gt;Service ä¼šæ ¹æ®è§„åˆ™è‡ªåŠ¨ç”ŸæˆåŸŸåã€‚è§„åˆ™ä¸åœ¨è¿™é‡Œè¯¦ç»†å±•å¼€ä»‹ç»ã€‚&lt;/li&gt;
&lt;li&gt;æˆ‘ä»¬å°±èƒ½ç”¨ Service è‡ªåŠ¨ç”Ÿæˆçš„åŸŸåä½œä¸ºäº¤ä»˜æˆæœï¼Œäº¤ä»˜ç»™ç”¨æˆ·äº†ï¼&lt;/li&gt;
&lt;/ol&gt;
&lt;h5 id=&#34;å®¹ç¾&#34;&gt;å®¹ç¾&lt;/h5&gt;
&lt;p&gt;Deployment èƒ½è‡ªåŠ¨å‰¯æœ¬ä¿æŒï¼Œå³æˆ‘ä»¬çš„ nginx Pod å°‘äº†ä¸€ä¸ªï¼ŒKubernetes èƒ½è‡ªåŠ¨å¸®æˆ‘ä»¬è¡¥é½ã€‚&lt;/p&gt;
&lt;h5 id=&#34;å˜æ›´å‘å¸ƒå‡çº§&#34;&gt;å˜æ›´ã€å‘å¸ƒã€å‡çº§&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚éœ€è¦è°ƒæ•´å‰¯æœ¬æ•°ç›®ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ Deployment.Spec.Replica å­—æ®µï¼Œå†æ¬¡ &lt;code&gt;kubectl apply -f ./nginx.yaml&lt;/code&gt; å³å¯ï¼Œå‰¯æœ¬è°ƒæ•´å®Œæˆã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæˆ‘ä»¬éœ€è¦å‡çº§é•œåƒï¼ˆnginx äºŒè¿›åˆ¶ç‰ˆæœ¬ï¼‰ï¼ŒåŒæ ·çš„ä¿®æ”¹ PodSpec.Containers[*].Image å³å¯ï¼Œç„¶å &lt;code&gt;kubectl apply -f ./nginx.yaml&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Deployment æ”¯æŒæ»šåŠ¨å‡çº§ï¼Œåœ¨å‡çº§æ—¶å¯ä»¥ä¸€ä¸ªä¸ªå‡çº§ä½ çš„ Podï¼ˆæ»šåŠ¨å‡çº§ï¼‰ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬çº¿ä¸Šå¯èƒ½æœ‰æ›´åŠ å¤æ‚çš„å‡çº§ç­–ç•¥ï¼Œèš‚èšé‡‘æœæä¾›çš„å¢å¼ºç‰ˆ Kubernetes æä¾›æ¯” Deployment æ›´åŠ å®ç”¨çš„å‡çº§ç­–ç•¥ï¼Œæ¯”å¦‚â€œç°åº¦å‡çº§â€ï¼Œ â€œåˆ†æ‰¹å‡çº§â€ç­‰æ›´åŠ ç¬¦åˆç”Ÿäº§ç¯å¢ƒå‘å¸ƒç­–ç•¥çš„å‡çº§æ–¹æ¡ˆã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å…³äºèœå•å’Œ-å£°æ˜å¼ç³»ç»Ÿ&#34;&gt;å…³äºâ€œèœå•â€å’Œ å£°æ˜å¼ç³»ç»Ÿ&lt;/h2&gt;
&lt;p&gt;Kubernetes æ˜¯å£°æ˜å¼çš„ç³»ç»Ÿã€‚å…³äºè¯¦ç»†çš„ä»‹ç»â€œä»€ä¹ˆæ˜¯å£°æ˜å¼ç³»ç»Ÿâ€ï¼Œæ‚¨å¯ä»¥å» Google æˆ–è€…å†…ç½‘ä¸Šé¢ä¹Ÿæœ‰è®¸å¤šå£°æ˜å¼ç³»ç»Ÿçš„ä»‹ç»ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘è¿™è¾¹æœ‰ä¸ªç®€å•çš„æ¯”å–»ï¼šå‡å¦‚ä½ éœ€è¦ä¸€æ¡Œèœï¼ˆè‡³äºä¸ºä»€ä¹ˆæ˜¯â€œèœâ€ï¼Œæ˜¯å› ä¸ºè¿™ä¸ªæ–‡ç« æ˜¯æˆ‘åœ¨åšé¥­çš„æ—¶å€™æ„æ€çš„ï¼‰ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªæ”¾èœçš„â€œæ¡Œå­â€ä¸å¤ªç¨³å®š (æˆ–è€…è¯´æœ‰è€é¼ æ¥å·åƒèœå“)ï¼Œä¸€ç›´å‘ç”Ÿä¸€äº›äº‹æ•…ï¼Œå°±åƒæˆ‘ä»¬çš„çº¿ä¸Šéƒ¨ç½²åº”ç”¨çš„ç¯å¢ƒä¸€æ ·ï¼ŒæœåŠ¡å™¨å¯èƒ½æ•…éšœã€‚å½“ä½ éœ€è¦åœ¨è¿™ä¸ªæ¡Œå­ä¸Šé¢æ‘†ä¸Šä¸€æ¡Œâ€œèœâ€çš„æ—¶å€™ï¼Œâ€œèœâ€å¯èƒ½ä¼šåæ‰ã€‚&lt;strong&gt;åˆ«æ‹…å¿ƒï¼Œåœ¨å£°æ˜å¼ç³»ç»Ÿé‡Œï¼Œâ€œå¨å¸ˆé•¿â€æ˜¯ä¸ªå°½èŒçš„å¥½åŒå¿—ï¼Œå½“ä½ æäº¤äº†ä¸€ä»½â€œèœå•â€ä¹‹åï¼Œæˆ‘ä»¬çš„â€œå¨å¸ˆé•¿â€ä¼šä¸€ç›´ä¿è¯ä½ æ¡Œå­ä¸Šçš„èœä¸€ç›´ä¼šå’Œä½ å†™çš„â€œèœå•â€é‡Œçš„èœä¸€æ¨¡ä¸€æ ·ã€‚å¦‚æœæŸé“â€œèœâ€åäº†ï¼Œâ€œå¨å¸ˆé•¿â€å°±å¸®ä½ å†åšä¸€ä»½ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ Kubernetes é‡Œé¢ï¼Œæœ‰å„ç§å„æ ·è¿™æ ·å°½èŒçš„å¨å¸ˆé•¿ï¼ˆæœ‰è´Ÿè´£ Deployment çš„å¨å¸ˆé•¿ï¼Œæœ‰è´Ÿè´£ Service çš„å¨å¸ˆé•¿ç­‰ç­‰ï¼‰ã€‚åªè¦å¤©æ²¡å¡Œä¸‹æ¥ï¼Œä½ æäº¤çš„â€œèœå•â€é‡Œçš„èœéƒ½ä¼šä¸€ç›´ç¾ç¾çš„åœ¨æ¡Œå­ä¸Šâ€œè¿å®¢â€ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆï¼Œæˆ‘ä»¬å›è¿‡å¤´æ¥çœ‹æˆ‘è¯´çš„â€œä¸ä¹…çš„æŸä¸€å¤©ï¼Œäº‘å‚å•†åªå– Kubernetes è™šæ‹Ÿæœºäº†ï¼Œè€Œä¸å•çº¯çš„å– Linux VMâ€ã€‚ä½ çœŸçš„è¦ä¹°å‡ ä¸ª Linux VM è‡ªå·±å»å¯åŠ¨è¿›ç¨‹ï¼ˆå‘½ä»¤å¼ï¼‰ï¼Œç„¶åè‡ªå·±å»æ­å»ºä¸€å¥—å£°æ˜å¼çš„ç³»ç»Ÿå»å®ˆæŠ¤ä½ çš„è½åœ¨å„ä¸ªæœºå™¨ä¸Šçš„åˆ†å¸ƒå¼åº”ç”¨è¿›ç¨‹ï¼Ÿè€Œä¸ä½¿ç”¨æ›´é«˜çº§ã€æ›´å¥½ç”¨çš„ Kubernetes æ“ä½œç³»ç»Ÿï¼Ÿ&lt;/p&gt;
&lt;h2 id=&#34;è°ˆè½¯ä»¶äº¤ä»˜&#34;&gt;è°ˆè½¯ä»¶äº¤ä»˜&lt;/h2&gt;
&lt;p&gt;è½¯ä»¶äº¤ä»˜å³æŠŠæˆ‘ä»¬å¼€å‘çš„ä¸€å¥—åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°å…¶å®ƒç¯å¢ƒã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è½¯ä»¶äº¤ä»˜å‡ ä¸ªé‡è¦å…³æ³¨çš„ç‚¹ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚ä½•å¿«é€Ÿçš„éƒ¨ç½²ä¸€å¥—æˆ‘ä»¬çš„â€œå…¨å®¶æ¡¶â€åº”ç”¨åˆ°å®¢æˆ·ç¯å¢ƒã€‚ä¸ºä»€ä¹ˆè¯´â€œå…¨å®¶æ¡¶â€ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬ä¸å¯èƒ½åªäº¤ä»˜ä¸€ä¸ª nginx æœåŠ¡ï¼Œæˆ‘ä»¬è‚¯å®šä¼šäº¤ä»˜ä¸€å¥—éå¸¸å¤æ‚çš„åº”ç”¨æˆ–è€…ä¸­é—´ä»¶ç³»ç»Ÿï¼Œæ¯”å¦‚äº¤ä»˜ä¸€å¥—â€œæ”¯ä»˜å®ç³»ç»Ÿâ€åˆ°æŸä¸ªå•†ä¸šé“¶è¡Œã€‚&lt;/li&gt;
&lt;li&gt;å¦‚ä½•åœ¨å®¢æˆ·ç°åœºåšè‡ªåŠ¨åŒ–å®¹ç¾ï¼Œé™ä½é©»åœºå’Œæ”¯æŒæˆæœ¬ï¼Œæˆ–è€…æ ¹æœ¬ä¸é©»åœºã€‚&lt;/li&gt;
&lt;li&gt;å¦‚ä½•ç®€å•ã€å¯é åœ°å‡çº§åç»­çš„ç‰ˆæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;ä¸Šè¿°çš„å‡ ç‚¹ï¼Œä¸ç®¡æ˜¯â€œéƒ¨ç½²â€ï¼Œâ€œå®¹ç¾â€ï¼Œâ€œå‡çº§â€éƒ½éœ€è¦å…³æ³¨å®¢æˆ·ç°åœºçš„è¿è¡Œç¯å¢ƒï¼Œæˆ‘ä»¬æœ‰æ²¡æœ‰åŠæ³•å±è”½è¿™ç§è¿è¡Œç¯å¢ƒå·®å¼‚ã€‚æ¯”å¦‚ï¼šæˆ‘ä»¬å¸¦è¿‡å»çš„å¯è¿è¡Œè½¯ä»¶ï¼Œåœ¨å®¢æˆ·çš„ OS ä¸Šæ˜¯ä¸æ˜¯èƒ½è¿è¡Œï¼›å®¢æˆ·ç°åœºçš„è´Ÿè½½å‡è¡¡æ–¹æ¡ˆéƒ½ä¸ä¸€æ ·ï¼Œå¦‚æœåˆ°äº†å®¢æˆ·ç°åœºæŸ¥çœ‹äº†ä»–ä»¬çš„è´Ÿè½½å‡è¡¡æ–¹æ¡ˆä¹‹åå†å†™ä¸€ä¸ªè´Ÿè´£å‡è¡¡éƒ¨ç½²æ–¹æ¡ˆè‚¯å®šå¤§å¤§é™ä½äº†äº¤ä»˜æ•ˆç‡ã€‚&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç°åœºçš„ç¯å¢ƒä¸ä¸€æ ·ï¼Œå¿…å®šå¸¦æ¥é…ç½®æ–‡ä»¶ä¸ä¸€æ ·ã€‚è®©ä¸€ä¸ªç°åœºäº¤ä»˜äººå‘˜å¼„æ‡‚æ‰€æœ‰åº”ç”¨çš„é…ç½®å‚æ•°ï¼Œæ˜¯ä¸æ˜¯ä¸€ä»¶è®©ä»–å¾ˆå¤´ç–¼çš„äº‹æƒ…ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;è½¯ä»¶äº¤ä»˜æ–¹æ¡ˆçš„å†å²ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;äº¤ä»˜ æºä»£ç ï¼šè¿™åº”è¯¥æ˜¯æœ€æ—©çš„æ—¶ä»£ï¼Œå®¢æˆ·ç°åœºçš„ç¯å¢ƒï¼ˆæ“ä½œç³»ç»Ÿã€æœºå‹ï¼‰éƒ½ä¸åŒï¼Œéœ€è¦å¸¦ç€ä»£ç åˆ°å®¢æˆ·ç°åœºç¼–è¯‘ï¼Œç„¶åè¿è¡Œè½¯ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;äº¤ä»˜ å¯è¿è¡Œæ–‡ä»¶ï¼šåƒ Java æå‡ºçš„ &amp;ldquo;Build once, run everywhere&amp;rdquo; æ¦‚å¿µï¼Œåœ¨è¿™ä¸ªæ—¶ä»£ï¼Œæˆ‘ä»¬å¯ä»¥é¢å‘ä¸€ä¸ªè¿è¡Œæ—¶è™šæ‹Ÿæœºäº¤ä»˜è½¯ä»¶ã€‚æˆ–è€…æˆ‘ä»¬éƒ½é¢å‘ Linux äº¤ä»˜ï¼Œæˆ‘ä»¬çš„ä½¿ç”¨ Go ç¼–è¯‘çš„äºŒè¿›åˆ¶ï¼Œèƒ½é¡ºåˆ©çš„éƒ¨ç½²åˆ°å¤§å¤šæ•°çš„ Linux OS ä¸Šã€‚ä½†æ˜¯è¿™ç§æ–¹æ¡ˆä¹Ÿå¼ºä¾èµ–å®¢æˆ·ç°åœºéœ€è¦è£…ä¸ŠæŒ‡å®šç‰ˆæœ¬çš„ Java è™šæ‹Ÿæœºï¼Œæˆ–è€… Linux ç‰¹å®šçš„ç‰ˆæœ¬ (åº”ç”¨ä¾èµ– Linux å†…æ ¸ç‰¹æ€§)ã€‚&lt;/li&gt;
&lt;li&gt;äº¤ä»˜ é•œåƒï¼šäº¤ä»˜é•œåƒï¼Œæœ€å¤§å¯èƒ½çš„å±è”½äº†åº•å±‚ OS, Java è™šæ‹Ÿæœºçš„å·®å¼‚ã€‚åœ¨é•œåƒé‡Œé¢ï¼Œæˆ‘ä»¬æŠŠè‡ªå·±éœ€è¦çš„ OS åŸºç¡€ å’Œ Java è™šæ‹Ÿæœºä¹Ÿè£…ä¸Šäº†ã€‚ä¸å†ä¾èµ–å®¢æˆ·ç°åœºçš„ OS å’Œ Java è™šæ‹Ÿæœºç‰ˆæœ¬äº†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é•œåƒæœ€å¤§å¯èƒ½çš„ç¨‹åº¦ä¸ŠæŠŠæˆ‘ä»¬éœ€è¦çš„è¿è¡Œæ—¶ç¯å¢ƒå’Œæˆ‘ä»¬çš„åº”ç”¨å¯æ‰§è¡Œæ–‡ä»¶æ‰“åœ¨ä¸€èµ·ï¼Œåœ¨å„ç§ç¯å¢ƒä¸‹é¢éƒ½èƒ½å®Œç¾åœ°è¿è¡Œã€‚é‚£ä¹ˆï¼Œåªæœ‰é•œåƒå°±èƒ½å¿«ä¹çš„äº¤ä»˜è½¯ä»¶äº†å—ï¼Ÿåœ¨æˆ‘çœ¼é‡Œï¼Œé•œåƒåšçš„äº‹æƒ…å®Œå…¨ä¸å¤Ÿã€‚åŸå› æ— éä¹Ÿæ˜¯è¿™ä¹ˆäº›ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ€ä¹ˆé…ç½®å¯åŠ¨å‚æ•°ï¼Œè¦äº¤ä»˜äººå‘˜è¾›è‹¦çš„è¯»æ‡‚å¯åŠ¨å‚æ•°é…ç½®è¯´æ˜è¯´å—ï¼Ÿ&lt;/li&gt;
&lt;li&gt;æ€ä¹ˆåšåˆ†å¸ƒå¼åº”ç”¨çš„ç»„ç½‘ã€æœåŠ¡å‘ç°&lt;/li&gt;
&lt;li&gt;æ€ä¹ˆåšå®¹ç¾&lt;/li&gt;
&lt;li&gt;æ€ä¹ˆåšéƒ¨ç½²çš„å…ƒæ•°æ®å½•å…¥ï¼šä»Šå¤©æˆ‘åœ¨å®¢æˆ·ç°åœºæŠŠ A åº”ç”¨éƒ¨ç½²åˆ°äº† èŠ‚ç‚¹ 1 ä¸Šé¢ï¼Œæˆ‘è¦æŠŠè¿™ä¸ªä¿¡æ¯è®°åœ¨å“ªå„¿ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä½ å¯èƒ½ä¼šå‘Šè¯‰æˆ‘ï¼Œä½ è¯´çš„è¿™äº›æˆ‘ä»¬çš„ PaaS ç³»ç»Ÿéƒ½èƒ½æå®šã€‚æ˜¯çš„ï¼Œä½ è¯´çš„æ²¡é”™ï¼ä½†æ˜¯å½“ PaaS èƒ½ç”¨ç»Ÿä¸€æ ‡å‡†ç®¡ç†åº”ç”¨ã€å±è”½åº”ç”¨çš„ç»†èŠ‚ï¼Œè§£å†³åº”ç”¨çš„ç»„ç½‘å’ŒæœåŠ¡å‘ç°ï¼Œç›‘å¬æ¯ä¸ªåº”ç”¨çš„å®ä¾‹å˜åŒ–ï¼ˆè‡ªåŠ¨åŒ–æ„ŸçŸ¥æ•…éšœå‘ç”Ÿï¼‰ç„¶åè‡ªåŠ¨æ¢å¤ï¼ˆå‰¯æœ¬ä¿æŒï¼‰ï¼Œé‚£ä¹ˆå®ƒå°±å·²ç»å·®ä¸å¤šæ˜¯ Kubernetes äº†ã€‚æŠŠä¸Šè¿°çš„æ‰€æœ‰åŠŸèƒ½é€»è¾‘éƒ½æ•´åˆåœ¨ PaaSï¼ŒåŠ¿å¿…å¯¼è‡´ PaaS çš„è‡ƒè‚¿ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥é¢å‘ Kubernetes è¿™ä¸ª OS å»åšä¸€ä¸ªè½»é‡çº§çš„ PaaSï¼Ÿå› ä¸ºå¾ˆå¤šåŠŸèƒ½åœ¨ Kubernetes å·²ç»æœ‰äº†ï¼Œè€Œä¸”è‚¯å®šæ¯”æˆ‘ä»¬è‡ªå·±ç ”å‘çš„ PaaS è¦å¥½ç”¨è®¸å¤šã€‚æˆ‘ä»¬çš„ PaaS æ˜¯ä¸æ˜¯å¯ä»¥å‘ Kubernetes æäº¤ Deploymentï¼Œè€Œä¸æ˜¯è‡ªå·±äº²è‡ªå»åšè¿›ç¨‹æ‹‰èµ·ã€å‰¯æœ¬å¥åº·æ£€æŸ¥ã€å‰¯æœ¬ä¿æŒç­‰åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é¢å‘ Kubernetes äº¤ä»˜è½¯ä»¶&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ­£å¦‚æˆ‘ä¸Šæ–‡æ‰€è¯´ï¼Œå¯èƒ½æœ‰ä¸€å¤©æ‰€æœ‰å®¢æˆ·ç°åœºçš„ OS éƒ½æ˜¯ Kubernetesï¼Œé‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥åƒä¸Šæ–‡å¯åŠ¨ nginx æœåŠ¡ä¸€æ ·ï¼Œç”¨è¿™ç§ YAMLâ€œå£°æ˜â€çš„æ–¹å¼å»äº¤ä»˜æˆ‘ä»¬çš„è½¯ä»¶ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å½“ç„¶å¯ä»¥ï¼ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬å»äº¤ä»˜ä¸€ä¸ªâ€œå…¨å®¶æ¡¶â€æœåŠ¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå‘ç°æˆ‘ä»¬çš„ YAML å†™äº†å‡ åƒè¡Œï¼Œç”šè‡³ä¸Šä¸‡è¡Œäº†ã€‚è¿™ä¸ªä¸Šä¸‡è¡Œçš„ YAML è°æ¥ç»´æŠ¤ï¼Ÿå°±ç®—æ˜¯åˆ†å¼€ç»™å„ä¸ªå­åº”ç”¨çš„ owner ç»´æŠ¤ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿå¯èƒ½ä¼šå‘ç”Ÿç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ã€‚æœ‰æ²¡æœ‰æ›´åŠ ç®€å•çš„æ–¹å¼ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å½“ç„¶æœ‰ã€‚æˆ‘ä»¬å†å›æ¥è°ˆâ€œèœå•â€å’Œåšèœã€‚æˆ‘æ˜¯ä¸€ä¸ªåƒè´§ï¼Œä½†æ˜¯æˆ‘å¾ˆæ‡’ã€‚å½“æˆ‘ç‚¹èœçš„æ—¶å€™ï¼Œéå¸¸å¸Œæœ›ç‚¹ä¸€ä¸ªâ€œå¥—é¤â€ï¼Œè€Œä¸å¸Œæœ›ä¸€ä¸ªä¸ªçš„å»ç‚¹æ¯ä¸ªèœï¼Œæ›´ä¸å¸Œæœ›å¼„æ‡‚èœæ˜¯æ€ä¹ˆåšå‡ºæ¥çš„ã€‚æˆ‘æƒ³è¦ç‚¹ä¸€ä¸ªâ€œæ»¡æ±‰å…¨å¸­â€(å¤æ‚çš„åº”ç”¨)ï¼Œå¯æˆ‘ä¸æƒ³æ¸…æ¥šçš„å¼„æ‡‚å¥—é¤é‡Œé¢å•ç‹¬æœ‰ä»€ä¹ˆèœã€æ¯ä¸ªèœçš„é…æ–¹æ˜¯ä»€ä¹ˆã€‚ä¸€ä¸ªâ€œæ»¡æ±‰å…¨å¸­â€(å¤æ‚çš„åº”ç”¨) é‡Œé¢ï¼Œå¯èƒ½æœ‰â€œå±±çâ€(æ•°æ®åº“) å’Œâ€œæµ·å‘³â€(Web æœåŠ¡)ã€‚æˆ‘åªæƒ³å‘Šè¯‰æˆ‘ä»¬çš„â€œå¤§å¨â€ï¼Œæˆ‘è¦â€œæ»¡æ±‰å…¨å¸­â€ ï¼Œç„¶åæˆ‘ä»¬çš„â€œå¤§å¨â€å°±å¿ƒé¢†ç¥ä¼šçš„çŸ¥é“â€œæ»¡æ±‰å…¨å¸­â€é‡Œé¢æœ‰ä»€ä¹ˆï¼Œç„¶åæŠŠâ€œæ»¡æ±‰å…¨å¸­â€ç»™åšå‡ºæ¥ã€‚é‚£ä¹ˆè¿™ä¸ªâ€œå¤§å¨â€è¦äº²è‡ªåšè¿™é‡Œçš„æ¯é“èœå—ï¼Ÿä¹Ÿä¸å¿…ï¼Œå› ä¸ºæˆ‘ä»¬çš„â€œå¤§å¨â€ä¹Ÿå¯èƒ½æ˜¯ä¸ªâ€œæ‡’äººâ€ï¼Œå½“éœ€è¦ä¸€æ¡Œâ€œæ»¡æ±‰å…¨å¸­â€çš„æ—¶å€™ï¼Œä»–åªä¼šå‘Šè¯‰è´Ÿè´£â€œå±±çâ€çš„â€œå¤§å¨â€ ï¼Œè¦ä¸€æ¡Œâ€œå±±çâ€ï¼ˆæ•°æ®åº“ï¼‰ï¼Œç„¶åå‘Šè¯‰è´Ÿè´£â€œæµ·å‘³â€çš„â€œå¤§å¨â€ï¼Œè¦ä¸€æ¡Œâ€œæµ·å‘³â€ï¼ˆWeb æœåŠ¡ï¼‰ã€‚å½“æˆ‘ä»¬çš„å¤§å¨å‘ç°â€œå±±çâ€œå’Œâ€œæµ·å‘³â€éƒ½å‡†å¤‡å¥½çš„æ—¶å€™ï¼Œä»–ä¼šå‘Šæˆ‘â€œæ»¡æ±‰å…¨å¸­â€å‡†å¤‡å¥½äº†ã€‚&lt;/p&gt;
&lt;p&gt;æ˜¯ä¸æ˜¯å‘ç°å’Œäº¤ä»˜è½¯ä»¶å¾ˆåƒï¼Ÿä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸äº¤ä»˜ä¸€ä¸ªâ€œå¤§å¨â€å‡ºå»ï¼Ÿåˆ°å®¢æˆ·ç°åœºè´Ÿè´£äº¤ä»˜çš„äººå‘˜ï¼Œåªè¦å‘Šè¯‰â€œå¤§å¨â€æˆ‘ä»¬éœ€è¦ä¸€ä¸ªâ€œæ»¡æ±‰å…¨å¸­â€è¿™ç§å¥—é¤çº§åˆ«çš„å£°æ˜å°±è¡Œäº†ã€‚å¹¶ä¸æ˜¯è¯´å¥—é¤æ²¡æœ‰å‚æ•°ï¼Œåªæ˜¯å¥—é¤çš„å‚æ•°èƒ½åšåˆ°å¯¹ç”¨æˆ·å±è”½ä¸å¿…è¦çš„ç»†èŠ‚ï¼šæ¯”å¦‚æˆ‘ä»¬çš„â€œæ»¡æ±‰å…¨å¸­â€å°±åªè¦ä¸€ä¸ªå‚æ•°ï¼Œåªè¦è®©ç”¨æˆ·å¡«ä»–çš„â€œæ»¡æ±‰å…¨å¸­â€éœ€è¦æ”¯æŒâ€œå¤šå°‘ QPSâ€ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é¢å‘-kubernetes-ç¼–ç¨‹ä½¿ç”¨-operator-äº¤ä»˜è½¯ä»¶&#34;&gt;é¢å‘ Kubernetes ç¼–ç¨‹ï¼šä½¿ç”¨ Operator äº¤ä»˜è½¯ä»¶&lt;/h2&gt;
&lt;p&gt;ä¸Šé¢æåˆ°çš„ä½¿ç”¨â€œäº¤ä»˜å¤§å¨â€çš„æ–¹å¼å»äº¤ä»˜è½¯ä»¶çœ‹èµ·æ¥å¾ˆç¾å¥½ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•å®ç°å‘¢ï¼Ÿä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦æ€ä¹ˆåŸ¹å…»å‡ºå±äºæˆ‘ä»¬è‡ªå·±çš„â€œå¨å¸ˆâ€ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å®æˆ‘ä»¬åœ¨â€œå°è¯•ç‰›åˆ€â€çš„ç« èŠ‚å·²ç»ä»‹ç»äº†ä¸€ä½â€œå¨å¸ˆâ€äº†ï¼šè´Ÿè´£â€œDeploymentâ€çš„å¨å¸ˆã€‚åªæ˜¯ï¼Œä»–çš„å·¥ä½œæ¯”è¾ƒé€šç”¨åŒ–ã€æ²¡æœ‰ä»€ä¹ˆä¸šåŠ¡å«ä¹‰ã€‚å®ƒåªæ˜¯è´Ÿè´£å®ˆæŠ¤ç”¨æˆ·åœ¨â€œèœå•â€é‡Œé¢æè¿°çš„â€œè¿›ç¨‹â€(Pod) æ•°é‡ï¼Œè‡³äºæ€ä¹ˆèµ·â€œè¿›ç¨‹â€éƒ½æ˜¯ç”¨æˆ·ä¼ å…¥çš„ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥æ ¹æ®è¿™ä¸ªâ€œå¨å¸ˆâ€çš„æ¨¡ä»¿å‡ºæœ‰ä¸šåŠ¡å«ä¹‰çš„â€œå¨å¸ˆâ€ï¼Ÿæ¯”å¦‚ï¼Œä¸šç•Œæœ‰ä¸€ä½æ¯”è¾ƒå‡ºåçš„ä¸€ä¸ªâ€œå¨å¸ˆâ€ï¼Œæ˜¯è´Ÿè´£ etcd é›†ç¾¤çš„ã€‚å¦‚æœæˆ‘éœ€è¦ä¸€ä¸ªå‰¯æœ¬æ•°æ˜¯ 3 çš„ etcd é›†ç¾¤ï¼Œåªè¦å‘ Kubernetes æäº¤å¦‚ä¸‹çš„ä¸€ä¸ªâ€œèœå•â€ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;etcd.database.coreos.com/v1beta2&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;EtcdCluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;example-etcd-cluster&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;â€œetcd å¨å¸ˆé•¿â€å°±ä¼šæ ¹æ®è¿™ä¸ªâ€œèœå•â€åšå‡ºä¸€ä¸ªå‰¯æœ¬æ•°æ˜¯ 3ï¼ˆSpec.Size=3ï¼‰çš„ etcd é›†ç¾¤ç»™ä½ ã€‚ç”¨æˆ·ä¸éœ€è¦çŸ¥é“ 3 å‰¯æœ¬çš„ etcd é›†ç¾¤é‡Œæ¯ä¸ªå‰¯æœ¬å‚æ•°æ˜¯ä»€ä¹ˆæ ·çš„ã€‚&lt;/p&gt;
&lt;p&gt;â€œetcd å¨å¸ˆé•¿â€çœŸå®çš„åå­—å« etcd-operatorã€‚é¡¾åæ€ä¹‰ï¼Œoperator å°±æ˜¯â€œå¨å¸ˆé•¿â€ï¼Œâ€œxxx-operatorâ€å°±æ˜¯â€œxxx åº”ç”¨ - å¨å¸ˆé•¿â€ã€‚åœ¨ä¸ä¹…çš„å°†æ¥ï¼Œæˆ‘è§‰å¾—æˆ‘ä»¬ä¹Ÿä¼šæœ‰â€œxx-db-operatorâ€ï¼Œâ€œxx-web-operatorâ€ï¼Œæˆ‘ä»¬ä¹Ÿç”¨è¿™ç§ç®€æ´æ˜äº†çš„å£°æ˜æ–¹å¼ï¼Œå¿«é€Ÿå¾—åˆ°ä¸€ä¸ª db å®ä¾‹ï¼Œæˆ–è€…ä¸€ä¸ªâ€œxx-webâ€åº”ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å›åˆ°æ€ä¹ˆåŸ¹å…»å¨å¸ˆé•¿çš„è¯é¢˜ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹åè¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;CRD (CustomResourceDefinitions)ï¼šå®šä¹‰â€œæ»¡æ±‰å…¨å¸­â€è¿™æ ·çš„å…¨å®¶æ¡¶ã€‚Deployment æ˜¯ Kubernetes å®˜æ–¹çš„èµ„æºå®šä¹‰ï¼ŒKubernetes åŒæ—¶å‘å¼€å‘è€…æä¾›äº†â€œè‡ªå®šä¹‰èµ„æºå®šä¹‰â€ã€‚å¼€å‘è€…å¯ä»¥å‘ Kubernetes é›†ç¾¤æäº¤æœ‰â€œæ»¡æ±‰å…¨å¸­â€çš„å®šä¹‰ï¼Œé‚£ä¹ˆå½“ç”¨æˆ·æäº¤ä¸€æ¡Œâ€œæ»¡æ±‰å…¨å¸­â€æ—¶ï¼ŒKubernetes å°±æ˜ç™½ç”¨æˆ·çš„è¯·æ±‚äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ Kubernetes çŸ¥é“ç”¨æˆ·æ‰€è¯´çš„â€œæ»¡æ±‰å…¨å¸­â€æ˜¯ä»€ä¹ˆäº†ã€‚&lt;/li&gt;
&lt;li&gt;CR (Custom Resources)ï¼šä¸€ä¸ª CRD å®ä¾‹ï¼Œå³ä¸€æ¡Œâ€œæ»¡æ±‰å…¨å¸­â€ï¼Œä¹Ÿå°±æ˜¯ç±»ä¼¼ä¸Šæ–‡ä¸€æ ·çš„ YAML å£°æ˜ã€‚&lt;/li&gt;
&lt;li&gt;Custom Controllerï¼šæˆ‘ä»¬çš„â€œå¨å¸ˆé•¿â€ã€‚å½“ Controller å‘ç°ç”¨æˆ·æäº¤äº† ä¸€æ¡Œâ€œæ»¡æ±‰å…¨å¸­â€ï¼Œé‚£ä¹ˆä»–å°±å¼€å§‹åšèœäº†ã€‚å½“ç„¶å®ƒå¹¶ä¸æ˜¯å®Œå…¨äº²è‡ªåšæ¯é“èœï¼Œæ­£å¦‚æˆ‘ä¸Šæ–‡æ‰€è¯´ã€‚æˆ‘ä»¬çš„â€œå¨å¸ˆé•¿â€å¯ä»¥ä¾èµ–å¦ä¸€ä½â€œå¨å¸ˆé•¿â€ï¼Œæ¯”å¦‚â€œdb å¨å¸ˆé•¿â€å¯ä»¥ä¾èµ–â€œDeployment å¨å¸ˆé•¿â€ï¼Œå½“ç”¨æˆ·éœ€è¦ä¸€ä¸ª db å®ä¾‹çš„æ—¶å€™ï¼Œâ€œdb å¨å¸ˆé•¿â€åªéœ€è¦è´Ÿè´£å†å‘ Kubernetes æäº¤ä¸€ä¸ª Deployment å£°æ˜å³å¯ã€‚æ³¨æ„ï¼šâ€œå¨å¸ˆé•¿â€ä¹‹é—´çš„äº¤äº’ä¹Ÿæ˜¯é â€œCRâ€æˆ–è€… Kubernetes å®˜æ–¹å®šä¹‰çš„èµ„æºï¼ˆå¦‚ Deploymentã€Podï¼‰ã€‚â€œå¨å¸ˆé•¿â€ä¸€èˆ¬ä¹Ÿæ˜¯é€šè¿‡ Deployment çš„æ–¹å¼éƒ¨ç½²åœ¨ Kubernetes é›†ç¾¤å†…ï¼ˆä¿è¯äº†â€œå¨å¸ˆé•¿â€è‡ªèº«çš„ç¨³å®šæ€§ï¼‰ï¼Œé™¤éåƒâ€œDeployment å¨å¸ˆé•¿â€è¿™ç§ Kubernetes æ ¸å¿ƒâ€œå¨å¸ˆé•¿â€çš„ç¨³å®šæ€§ ç”± Kubernetes æœåŠ¡æä¾›å•†ä¿è¯ã€‚&lt;/li&gt;
&lt;li&gt;Operator: Kubernetes é‡Œçš„ Operatorï¼Œå³ CRD + Custom Controllerã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;ä¸€ä¸ªç®€å•çš„å›¾å°†å®ƒä»¬ä¸²èµ·æ¥ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/the-data-center-os-kubernetes/006tKfTcly1g0d0nds0wmj31v60u0wl1_hu3364599545210094492.webp 400w,
               /blog/the-data-center-os-kubernetes/006tKfTcly1g0d0nds0wmj31v60u0wl1_hu5861516528167537876.webp 760w,
               /blog/the-data-center-os-kubernetes/006tKfTcly1g0d0nds0wmj31v60u0wl1_hu8358618154829556043.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/the-data-center-os-kubernetes/006tKfTcly1g0d0nds0wmj31v60u0wl1_hu3364599545210094492.webp&#34;
               width=&#34;760&#34;
               height=&#34;340&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾å±•ç¤ºäº†æˆ‘ä»¬çš„ My-App-Operator çš„â€œå¨å¸ˆé•¿â€çš„å…³ç³»å›¾ã€‚å½“æˆ‘ä»¬éœ€è¦ä¸€ä¸ª &amp;ldquo;my-app&amp;rdquo; åº”ç”¨å®ä¾‹æ—¶ï¼Œæˆ‘ä»¬åªè¦å‘Šè¯‰æˆ‘ä»¬çš„â€œå¨å¸ˆé•¿â€æ˜¯éœ€è¦å¤šå°‘å‰¯æœ¬æ•°çš„å®ä¾‹ã€‚æˆ‘ä»¬çš„â€œå¨å¸ˆé•¿â€è‡ªåŠ¨å°†éœ€æ±‚è½¬åŒ–æˆ Deploymentï¼Œå…¶å®ƒçš„åŠŸèƒ½å°±å®Œå…¨ä¾é äº†â€œDeployment å¨å¸ˆé•¿â€ã€‚&lt;/p&gt;
&lt;h5 id=&#34;å¦‚ä½•é¢å‘-kubernetes-å†™ä¸€ä¸ª-operator&#34;&gt;å¦‚ä½•é¢å‘ Kubernetes å†™ä¸€ä¸ª Operator&lt;/h5&gt;
&lt;p&gt;é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹â€œå¨å¸ˆé•¿â€ (Operator) éœ€è¦å…³æ³¨ä¸€äº›ä»€ä¹ˆäº‹æƒ…ï¼Œä»¥åŠå®ƒåšäº†ä»€ä¹ˆäº‹æƒ…ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¤šä¹…è¦å¼€å§‹åšèœï¼ˆObserveï¼‰ï¼šå³â€œå¨å¸ˆé•¿â€ (Operator/Controller) éœ€è¦çŸ¥é“å¤šä¹…ä»–è¦å¼€å§‹å·¥ä½œäº†ã€‚å½“ç”¨æˆ·æäº¤äº†â€œèœå•â€(CR)ï¼Œâ€œå¨å¸ˆé•¿â€è¦å¼€å§‹åšèœã€‚æˆ–è€…ï¼Œå› ä¸ºâ€œæ¡Œå­â€ä¸Šå°‘äº†ä¸€ä¸ªé¢„æœŸä¸­çš„â€œèœâ€(Pod å› ä¸ºæ•…éšœå°‘äº†ä¸€ä¸ª)ï¼Œâ€œå¨å¸ˆé•¿â€ä¹Ÿè¦å¼€å§‹åšèœäº†ã€‚&lt;/li&gt;
&lt;li&gt;åšä»€ä¹ˆèœï¼ˆAnalyzeï¼‰ï¼š â€œå¨å¸ˆé•¿â€é¦–å…ˆè¦çœ‹çœ‹æ¡Œå­ä¸Šçš„èœï¼Œå†å¯¹æ¯”ä¸€ä¸‹ç”¨æˆ·çš„â€œèœå•â€ï¼Œå¾—å‡ºè¿˜ç¼ºå°‘ä»€ä¹ˆèœï¼Œé‚£ä¹ˆå°±åšä»€ä¹ˆèœã€‚&lt;/li&gt;
&lt;li&gt;å¼€å§‹åšèœï¼ˆActionï¼‰ï¼šå¾—å‡ºåšä»€ä¹ˆèœä¹‹åï¼Œé‚£ä¹ˆåé¢çš„äº‹æƒ…å°±ç®€å•äº†ã€‚é€šçŸ¥å…¶ä»–â€œå¨å¸ˆé•¿â€åšèœï¼ˆæäº¤ä¸€ä¸ªå…¶ä»–çš„ CRï¼‰ï¼Œæˆ–è€…è‡ªå·±äº²æ‰‹åšä¸ªèœï¼ˆæäº¤ä¸€ä¸ª Podï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™ 3 ä»¶äº‹æƒ…ï¼Œå…¶å®å°±æ˜¯ Controller æ¨¡å¼çš„æ ¸å¿ƒä¸‰ä»¶äº‹ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/the-data-center-os-kubernetes/006tKfTcly1g0d0o7mda6j319k0u0di3_hu7638828047441747251.webp 400w,
               /blog/the-data-center-os-kubernetes/006tKfTcly1g0d0o7mda6j319k0u0di3_hu13336628463443999654.webp 760w,
               /blog/the-data-center-os-kubernetes/006tKfTcly1g0d0o7mda6j319k0u0di3_hu11226050698077196820.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/the-data-center-os-kubernetes/006tKfTcly1g0d0o7mda6j319k0u0di3_hu7638828047441747251.webp&#34;
               width=&#34;760&#34;
               height=&#34;501&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆç”¨ Kubernetes å†™ä¸€ä¸ª Operator éœ€è¦å¤šä¹…ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å¯èƒ½ä»â€œ0â€åˆ°å¯ä»¥æŠŠ Operator è¿è¡Œèµ·æ¥åªéœ€è¦ 10 åˆ†é’Ÿå§ã€‚å› ä¸º Kubernetes çš„ Kube-Apiserver æä¾›å¤©ç„¶çš„ watch æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥å»å…³æ³¨æˆ‘ä»¬åœ¨æ„çš„èµ„æº (æˆ‘ä»¬çš„ CRï¼Œæˆ‘ä»¬çš„ Pod ç­‰)ï¼Œè¿™æ ·æˆ‘ä»¬çš„â€œå¨å¸ˆâ€å°±èƒ½å¾ˆè‡ªç„¶çš„å¾—åˆ°é€šçŸ¥è¯¥å¹²æ´»äº†ã€‚ç„¶åâ€œå¨å¸ˆâ€å°±å¼€å§‹åšå‡ºåˆ†æï¼Œåˆ°æœ€åå†å‘ Kube-Apiserver æäº¤æˆ‘ä»¬æƒ³è¦çš„èµ„æºï¼ˆDeploymentï¼Œæˆ–è€…å…¶å®ƒçš„ CRï¼‰ã€‚æˆ‘ä»¬éƒ½é¢å‘ Kube-Apiserver åšç¼–ç¨‹ï¼Œæ‰€æœ‰çš„â€œå¨å¸ˆâ€éƒ½ å‘ Kube-Apiserver æäº¤ã€ä¿®æ”¹ã€Watch èµ„æºä½œä¸ºç»Ÿä¸€çš„äº¤äº’åè®®ï¼Œä¸€åˆ‡éƒ½ä¼šå˜å¾—ç®€å•è®¸å¤šã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œå†åŠ ä¸Š Operator çš„è„šæ‰‹æ¶å¸®æˆ‘ä»¬ç”ŸæˆåŸºç¡€ä»£ç ï¼ˆåˆå§‹åŒ– Kubernetes å®¢æˆ·ç«¯ï¼Œå»ºç«‹ Watch ç­‰ï¼‰ï¼Œæˆ‘ä»¬å¼€å‘è€…åªéœ€è¦å…³å¿ƒçš„æ€ä¹ˆ Analyze å’Œ Action å³å¯ã€‚Operator çš„è„šæ‰‹æ¶ç¤¾åŒºå¸¸è§çš„æœ‰ kube-builder å’Œ coreos æä¾›çš„ operator-framework ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ç”¨ä¼ªä»£ç æ¥å†™ä¸€ä¸‹ä¸Šæ–‡ç”»çš„ My-App-Operator æ ¸å¿ƒé€»è¾‘ï¼ˆå…¶å®ƒéƒ½è„šæ‰‹æ¶åšå¥½äº†ï¼Œç”šè‡³å¦‚ä½• buildï¼ŒOperator æœ¬èº«å®ƒè‡ªå·±å¦‚ä½•éƒ¨ç½²çš„â€œèœå•â€YAML éƒ½æ˜¯è„šæ‰‹æ¶ç”Ÿæˆå¥½äº†ï¼‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Reconcile å³æˆ‘ä»¬ Operator æ ¸å¿ƒä»£ç é€»è¾‘
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Reconcile ä½•æ—¶è§¦å‘ï¼Œä¹Ÿæ˜¯ Operator ç”Ÿæˆå¥½äº†
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Reconcile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;crName&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// è·å– CR (ç”¨æˆ·æäº¤çš„â€œèœå•â€)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getCR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;crName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// è®¡ç®—å‡ºè¿™ä¸ª CR æœŸæœ›çš„ Deployment (ç”¨æˆ·æäº¤çš„â€œèœå•â€åº”è¯¥åœ¨æ¡Œå­ä¸Šæœ‰ä»€ä¹ˆèœ)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;desireDeployment&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getDesireDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ç›®å‰é›†ç¾¤é‡Œé¢å®é™…çš„ Deployment (å®é™…ä¸Šæ¡Œå­ä¸Šæœ‰ä»€ä¹ˆèœ)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;deployment&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GetDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;crName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// å¦‚æœæœŸæœ›å’Œå®é™…çš„ä¸å¤ªä¸€æ ·ï¼ŒæŠŠå®é™…çš„æ›´æ–°ä¸€ä¸‹å°±è¡Œäº†ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;diff&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;desireDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;deployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;UpdateDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;desireDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;c1&#34;&gt;// å¦‚æœæœŸæœ›å’Œå®é™…éƒ½ä¸€æ ·ï¼Œä»€ä¹ˆäº‹æƒ…éƒ½ä¸åšäº†ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h5 id=&#34;é¢å‘-kubernetes-å˜æˆ-å’Œ-operator--çš„ä¼˜åŠ¿æ€»ç»“&#34;&gt;é¢å‘ Kubernetes å˜æˆ å’Œ Operator  çš„ä¼˜åŠ¿æ€»ç»“&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;ç»Ÿä¸€çš„ä¿¡æ¯è·å–æºå’Œç»Ÿä¸€çš„æ¥å£ï¼šKube-Apiserver å°±åƒæ˜¯ä¸€ä¸ªå¤§çš„ä¿¡æ¯æµè½¬ä¸­å¿ƒã€‚æ‰€æœ‰çš„ç»„ä»¶ï¼ˆâ€œå¨å¸ˆé•¿â€ï¼‰éƒ½é€šè¿‡è¿™ä¸ªä¸­å¿ƒä¸Šä¼ ä»–è´Ÿè´£çš„èµ„æºï¼ˆCRï¼ŒDeploymentï¼ŒPod éƒ½æ˜¯ Kubernetes çš„èµ„æºï¼‰çš„ä¿¡æ¯ï¼ŒåŒæ—¶ï¼Œä»–ä¹Ÿé€šè¿‡è¿™ä¸ªæ¥å£ï¼Œå»æ„ŸçŸ¥å…¶å®ƒèµ„æºçŠ¶æ€çš„å˜åŒ–ï¼Œå¦‚æœè¿™äº›å˜åŒ–æ˜¯ä»–æ„Ÿå…´è¶£çš„ï¼Œé‚£ä¹ˆä»–å°±å¼€å§‹å·¥ä½œï¼ˆâ€œå¨å¸ˆé•¿â€å¼€å§‹å·¥ä½œï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æ„å»ºåœ¨ Kubernetes æ ¸å¿ƒç»„ä»¶ä»¥åŠ ç¤¾åŒºé€šç”¨çš„ Operator ä¹‹ä¸Šï¼šç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šèƒ½è®©æˆ‘ä»¬çš„å·¥ä½œæ›´åŠ çš„å‡è´ŸåŒæ—¶è¾¾åˆ°æ›´åŠ ç†æƒ³çš„æ•ˆæœã€‚ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬çš„ Operator å¯èƒ½åœ¨ä¾èµ– Deployment ä¹‹åï¼Œä»–è´Ÿè´£çš„â€œèœâ€ï¼ˆPodï¼‰å°±è‡ªå¸¦å‰¯æœ¬ä¿æŒåŠŸèƒ½ã€‚åŒæ—¶ï¼Œå‡å¦‚æˆ‘ä»¬çš„åº”ç”¨ï¼ˆDBï¼ŒWebï¼‰è¦ä¾èµ–ç¤¾åŒºçš„ MySQL æ•°æ®åº“ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„åº”ç”¨ Operatorï¼ˆWeb + DBï¼‰å¯ä»¥é€šè¿‡ç¤¾åŒºçš„ MySQL-Operator æä¾›çš„ CR å¿«é€Ÿå»ºå‡º MySQL å®ä¾‹ï¼Œç„¶åå†ä½¿ç”¨ Deployment å»ºå‡º Webã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h5 id=&#34;ä¼˜ç§€çš„ç¤¾åŒº-operator&#34;&gt;ä¼˜ç§€çš„ç¤¾åŒº Operator&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;ä¼˜ç§€çš„ç¤¾åŒº Operator (awesome-operators): &lt;a href=&#34;https://github.com/operator-framework/awesome-operators&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/operator-framework/awesome-operators&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;faas&#34;&gt;FaaS&lt;/h2&gt;
&lt;p&gt;ç”¨ Operator äº¤ä»˜è½¯ä»¶ï¼Œç›®å‰çœ‹èµ·æ¥æ˜¯æœ€é…·çš„ä¸€ç§äº¤ä»˜è½¯ä»¶æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯åœ¨å½“ä»Šäº‘åŸç”ŸæŠ€æœ¯å¿«é€Ÿå‘å±•çš„æ—¶ä»£ï¼Œå¯èƒ½åœ¨ä¸ä¹…çš„å°†æ¥ï¼ŒOperator æ¨¡å¼å¯èƒ½ä¹Ÿä¼šè¢«æ·˜æ±°ã€‚å› ä¸º Operator ä¹Ÿéœ€è¦å¼€å‘è€…å…³æ³¨ä¸€äº›éƒ¨ç½²çš„ç»†èŠ‚ï¼Œè®©å¼€å‘è€…çœŸæ­£åªå…³æ³¨åœ¨è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ï¼Œâ€œä¸šåŠ¡ä»£ç â€å˜æˆâ€œæœåŠ¡â€å®Œå…¨å¯¹å¼€å‘è€…é€æ˜ï¼Œå¯èƒ½éœ€è¦æ¯” Kubernetes æ›´ä¸Šå±‚çš„æ¡†æ¶ - FaaS æ¡†æ¶ã€‚&lt;/p&gt;
&lt;p&gt;FaaS å…¨ç§°æ˜¯ &lt;a href=&#34;https://en.wikipedia.org/wiki/Function_as_a_service&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Function as a service&lt;/a&gt; ã€‚ç”¨æˆ·åªè¦å†™è‡ªå·±çš„ä¸šåŠ¡å‡½æ•°ï¼Œå‘ Kubernetes æäº¤ä¸šåŠ¡å‡½æ•°ï¼ŒFaaS æ¡†æ¶å°†ä¸šåŠ¡å‡½æ•°å˜æˆ Deploymentï¼Œå˜æˆ Podï¼Œå˜æˆ Serviceã€‚ä½†æ˜¯ FaaS ç›®å‰è¿˜åœ¨å‘å±•é˜¶æ®µï¼Œå¹¶ä¸åƒ Kubernetes å·²ç»å˜æˆäº‹å®æ ‡å‡†ï¼Œè¿™é‡Œä¸å†è¯¦ç»†è®¨è®ºã€‚&lt;/p&gt;
&lt;h2 id=&#34;è½åœ°&#34;&gt;è½åœ°&lt;/h2&gt;
&lt;p&gt;è¯´äº†é‚£ä¹ˆå¤šï¼Œå…¶å®æˆ‘çš„åˆè¡·æ˜¯å¸Œæœ›æ¯ä¸ªå¼€å‘è€…éƒ½ä» Linux VM è½¬å‘ Kubernetes &amp;ldquo;VM&amp;rdquo;ã€‚ä½†æ˜¯è½¬å˜å‘ç”Ÿåœ¨æ¯ä¸ªäººèº«ä¸Šï¼Œåº”è¯¥æ˜¯æœ‰å„ç§å›°éš¾ã€‚æˆ‘èƒ½æƒ³åˆ°çš„ä¸€äº›æœ€åŸºæœ¬çš„å›°éš¾å¤§æ¦‚åˆ—åœ¨ä¸‹é¢ï¼ŒåŒæ—¶æ¬¢è¿è·Ÿæˆ‘äº¤æµä½ çš„ä¸€äº›å›°æƒ‘ã€‚&lt;/p&gt;
&lt;h5 id=&#34;ä»£ç å˜æˆé•œåƒ&#34;&gt;ä»£ç å˜æˆé•œåƒ&lt;/h5&gt;
&lt;p&gt;å¤§å®¶éƒ½çŸ¥é“ï¼ŒKubernetes åªå…è®¸ä»¥ Pod çš„æ–¹å¼è¿è¡Œâ€œè¿›ç¨‹â€ã€‚åœ¨ FaaS æ²¡æˆç†Ÿä¹‹å‰ï¼Œå¦‚ä½•æŠŠæˆ‘ä»¬çš„ä»£ç å˜æˆä¸€ä¸ªé•œåƒæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤´ç–¼çš„äº‹æƒ…ã€‚å¯èƒ½åº”ç”¨çš„å¼€å‘åŒå­¦å¹¶ä¸æƒ³è‡ªå·±å»ç†è§£ dockerï¼Œæ€ä¹ˆå»æ‰“é•œåƒã€‚&lt;/p&gt;
&lt;p&gt;åˆ«æ‹…å¿ƒï¼Spring æ¡†æ¶æˆ–è€…å…¶æ‰©å±•çš„è„šæ‰‹æ¶åº”è¯¥å·²ç»å¯ä»¥åœ¨å·¥ç¨‹é‡Œè‡ªåŠ¨æ·»åŠ  Dockerfile æ–‡ä»¶ï¼Œä½¿ç”¨è„šæ‰‹æ¶ä¹‹åï¼Œç”¨æˆ·åªè¦æ‰§è¡Œ &lt;code&gt;make image&lt;/code&gt; è¿™æ ·çš„å‘½ä»¤ï¼Œå°±èƒ½æ„å»ºå‡ºé•œåƒäº†ã€‚&lt;/p&gt;
&lt;h5 id=&#34;åˆ«è¯´äº†æˆ‘è¿˜æ˜¯æƒ³è¦ä¸€ä¸ª-linux-vm&#34;&gt;åˆ«è¯´äº†ï¼Œæˆ‘è¿˜æ˜¯æƒ³è¦ä¸€ä¸ª Linux VM&lt;/h5&gt;
&lt;p&gt;å‘ Kubernetes æäº¤ä¸‹é¢è¿™æ ·çš„ä¸€ä¸ª YAML æ–‡ä»¶ï¼Œä½ å°±èƒ½å¾—åˆ°ä¸€ä¸ª ubuntu VMï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-vm-1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;vm&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ubuntu&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åŒæ—¶ï¼Œå‘Šè¯‰ä½ ä¸€ä¸ªæ›´é…·ç‚«çš„ç©æ³•ï¼šè‡ªå·±å®šåˆ¶ä¸€ä¸ªå±äºä½ è‡ªå·±çš„ Linux å‘è¡Œç‰ˆï¼åœ¨åŸæœ‰çš„ OS é•œåƒåŸºç¡€ä¸Šï¼ŒåŠ ä¸Šä½ çš„ Shell å·¥å…·è„šæœ¬ã€å†™ä¸€ä¸²å‘çˆ±äººè¡¨ç™½çš„è¯ã€æä¸ªå¼€æœº Logoï¼Œéƒ½å¾ˆç®€å•ï¼åšä¸€ä¸ªå±äºä½ è‡ªå·±çš„ Linux é•œåƒï¼Œé‚£ä¹ˆåœ¨ä¸–ç•Œçš„ä»»ä½•åœ°æ–¹ï¼Œä½ éƒ½èƒ½èµ·åŠ¨ä¸€ä¸ªç»è¿‡ä½ å®šåˆ¶çš„ Linux VMã€‚&lt;/p&gt;
&lt;h5 id=&#34;å“ªé‡Œå»è·å–ä¸€ä¸ª-kubernetes&#34;&gt;å“ªé‡Œå»è·å–ä¸€ä¸ª Kubernetes&lt;/h5&gt;
&lt;p&gt;é¦–å…ˆï¼Œè¯•è¯• mini-kubeï¼Œæˆ–è€…ç«‹åˆ»å‘é˜¿é‡Œäº‘ä¹°ä¸€ä¸ªï¼&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å…¨æ‰‹åŠ¨éƒ¨ç½² prometheus-operator ç›‘æ§ Kubernetes é›†ç¾¤é‡åˆ°çš„å‘</title>
      <link>https://cloudnativecn.com/blog/prometheus-operator-manual/</link>
      <pubDate>Tue, 08 Jan 2019 17:40:30 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/prometheus-operator-manual/</guid>
      <description>&lt;h2 id=&#34;å†™è¿™ç¯‡æ–‡ç« åŸå› &#34;&gt;å†™è¿™ç¯‡æ–‡ç« åŸå› &lt;/h2&gt;
&lt;p&gt;æ‰€æœ‰ç›‘æ§çš„agentåº•å±‚æœ€ç»ˆéƒ½æ˜¯æŸ¥è¯¢çš„/procå’Œ/sysé‡Œçš„ä¿¡æ¯æ¨é€(å¦‚æœé”™äº†è½»å–·)ï¼Œå› ä¸ºåœ¨Kubernetesä¸­æ”¶é›†å®¿ä¸»æœºä¿¡æ¯æ–¹é¢ä¹Ÿæƒ³ç”¨podè·‘ï¼Œä¼šé¢ä¸´åˆ°é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;å¸¸è§çš„zabbix_agenté»˜è®¤è¯»å–fsçš„/procå’Œ/sysï¼Œå®¹å™¨è·‘agentä¼šå¯¼è‡´è¯»å–çš„ä¸æ˜¯å®¿ä¸»æœºçš„/procå’Œ/sysã€‚&lt;/p&gt;
&lt;p&gt;è€Œ prometheus çš„&lt;code&gt;node-exporter&lt;/code&gt;æœ‰é€‰é¡¹&lt;code&gt;--path.procfs&lt;/code&gt;å’Œ&lt;code&gt;--path.sysfs&lt;/code&gt;æ¥æŒ‡å®šä»è¿™ä¿©é€‰é¡¹çš„å€¼çš„ proc å’Œ sys è¯»å–ï¼Œå®¹å™¨è·‘&lt;code&gt;node-exporter&lt;/code&gt;åªéœ€è¦æŒ‚è½½å®¿ä¸»æœºçš„/procå’Œ/sysåˆ°å®¹å™¨fsçš„æŸä¸ªè·¯å¾„æŒ‚è½½å±æ€§è®¾ç½®ä¸ºreadonlyåç”¨è¿™ä¸¤ä¸ªé€‰é¡¹æŒ‡å®šå³å¯ï¼Œzabbix4.0çœ‹äº†æ–‡æ¡£å’Œå®¹å™¨éƒ½æ‰¾ä¸åˆ°ç±»ä¼¼é€‰é¡¹åº”è¯¥ä¸æ”¯æŒã€‚&lt;/p&gt;
&lt;p&gt;è™½è¯´ä¸Š prometheus ä½†æ˜¯ Kubernetes ç›‘æ§è¿™æ–¹é¢ï¼Œç»å¸¸çœ‹åˆ°å¦‚ä¸‹é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚ä½•éƒ¨ç½²&lt;/li&gt;
&lt;li&gt;ç”¨ prometheus çš„è¯ pod ip ä¼šå˜å’‹æ•´ä¹‹ç±»çš„&lt;/li&gt;
&lt;li&gt;æˆ‘çš„targetæ€ä¹ˆæ˜¯0/0&lt;/li&gt;
&lt;li&gt;å®˜æ–¹ yaml æ€ä¹ˆç”¨&lt;/li&gt;
&lt;li&gt;operator å’Œä¼ ç»Ÿçš„ prometheus æœ‰å•¥å·®å¼‚&lt;/li&gt;
&lt;li&gt;operator ç›¸å¯¹æ‰‹åŠ¨éƒ¨ç½²çš„ prometheus æœ‰å•¥ä¼˜ç§€ä¹‹å¤„&lt;/li&gt;
&lt;li&gt;&amp;hellip;..&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸Šé¢é—®é¢˜é‡Œå¤§å¤šéƒ½æ˜¯å¯¹ prometheus-operator ä¸äº†è§£çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¤§å¤šä¸çœ‹å®˜æ–¹æ–‡æ¡£çš„ï¼Œè¿™é‡Œæˆ‘å‡ ä¸ªä¾‹å­åŠ ä»‹ç»è¯´è¯´æ€æ ·éƒ¨ç½²&lt;code&gt;prometheus-operator&lt;/code&gt;ï¼Œå’Œä¸€äº›å¸¸è§çš„å‘ã€‚
å¦å¤–ç½‘ä¸Šå¤§å¤šæ˜¯helméƒ¨ç½²çš„ä»¥åŠç®¡ç†ç»„ä»¶æ˜¯äºŒè¿›åˆ¶ä¸‹æœ‰å‡ ä¸ªtargetæ˜¯0/0å‘ç°ä¸äº†çš„è§£å†³åŠæ³•ã€‚&lt;/p&gt;
&lt;p&gt;éœ€è¦çœ‹æ‡‚æœ¬æ–‡è¦å…·å¤‡ä¸€ä¸‹çŸ¥è¯†ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;svc å®ç°åŸç†å’Œä¼šåº”ç”¨ä»¥åŠ svc å’Œ endpoint å…³ç³»&lt;/li&gt;
&lt;li&gt;äº†è§£ prometheus(ä¸æ˜¯ operator çš„) å·¥ä½œæœºåˆ¶&lt;/li&gt;
&lt;li&gt;çŸ¥é“ä»€ä¹ˆæ˜¯ metrics(ä¸è¿‡æœ‰äº† prometheus-operator ä¼¼ä¹ä¸æ˜¯å¿…é¡»)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é€Ÿè¡¥åŸºç¡€&#34;&gt;é€Ÿè¡¥åŸºç¡€&lt;/h2&gt;
&lt;h3 id=&#34;ä»€ä¹ˆæ˜¯-metrics&#34;&gt;ä»€ä¹ˆæ˜¯ metrics&lt;/h3&gt;
&lt;p&gt;å‰é¢çŸ¥è¯†ç‚¹ç¬¬ä¸€æ¡éƒ½è€ƒè™‘åˆ° Kubernetes é›†ç¾¤ç›‘æ§äº†æƒ³å¿…éƒ½ä¼šäº†ï¼Œç¬¬äºŒæ¡å› ä¸ºæœ‰ operator çš„å­˜åœ¨ä¸å¤ªå…³å¿ƒåº•å±‚å¯èƒ½ä¸å¤ªæ€¥éœ€å¯ä»¥åé¢å»ç¨å¾®å­¦å­¦ï¼Œç¬¬ä¸‰æ¡æ— è®º etcd è¿˜æ˜¯ k8s çš„ç®¡ç†ç»„ä»¶åŸºæœ¬éƒ½æœ‰ metrics ç«¯å£ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæ¥ä»‹ç»å•¥ä»€ä¹ˆæ˜¯ metricsï¼š&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚æˆ‘ä»¬è¦æŸ¥çœ‹ etcd çš„ metricsï¼Œå…ˆæŸ¥çœ‹ etcd çš„è¿è¡Œå‚æ•°æ‰¾åˆ°ç›¸å…³çš„å€¼ï¼Œè¿™é‡Œæˆ‘æ˜¯æ‰€æœ‰å‚æ•°å†™åœ¨ä¸€ä¸ª yml æ–‡ä»¶é‡Œï¼Œé yml è‡ªè¡ŒæŸ¥çœ‹ systemd æ–‡ä»¶æˆ–è€…è¿è¡Œå‚æ•°æ‰¾åˆ°ç›¸å…³å‚æ•°å’Œå€¼å³å¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;root@k8s-m1 ~&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# ps aux | grep -P &amp;#39;/etc[d] &amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;root      &lt;span class=&#34;m&#34;&gt;13531&lt;/span&gt;  2.8  0.8 &lt;span class=&#34;m&#34;&gt;10631072&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;140788&lt;/span&gt; ?     Ssl   &lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt; 472:58 /usr/local/bin/etcd --config-file&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/etc/etcd/etcd.config.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;root@k8s-m1 ~&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# cat /etc/etcd/etcd.config.yml&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;listen-client-urls: &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://172.16.0.2:2379&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;client-transport-security:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  ca-file: &lt;span class=&#34;s1&#34;&gt;&amp;#39;/etc/etcd/ssl/etcd-ca.pem&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  cert-file: &lt;span class=&#34;s1&#34;&gt;&amp;#39;/etc/etcd/ssl/etcd.pem&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  key-file: &lt;span class=&#34;s1&#34;&gt;&amp;#39;/etc/etcd/ssl/etcd-key.pem&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬éœ€è¦ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;listen-client-urls çš„ httpsurlï¼Œæˆ‘è¿™é‡Œæ˜¯&lt;code&gt;https://172.16.0.2:2379&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å…è®¸å®¢æˆ·ç«¯è¯ä¹¦ä¿¡æ¯&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç„¶åä½¿ç”¨ä¸‹é¢çš„ curlï¼Œå¸¦ä¸Šå„è‡ªè¯ä¹¦è·¯å¾„è®¿é—® https çš„ url æ‰§è¡Œ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl --cacert /etc/etcd/ssl/etcd-ca.pem --cert /etc/etcd/ssl/etcd.pem --key /etc/etcd/ssl/etcd-key.pem https://172.16.0.2:2379/metrics
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¹Ÿå¯ä»¥ etcd ç”¨é€‰é¡¹å’Œå€¼&lt;code&gt;--listen-metrics-urls http://interface_IP:port&lt;/code&gt;è®¾ç½®æˆé https çš„ metrics ç«¯å£å¯ä»¥ä¸ç”¨è¯ä¹¦å³å¯è®¿é—®ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ° etcd çš„ metrics è¾“å‡ºä¿¡æ¯å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;....
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;grpc_server_started_total&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;grpc_method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;RoleList&amp;#34;&lt;/span&gt;ï¼Œgrpc_service&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;etcdserverpb.Auth&amp;#34;&lt;/span&gt;ï¼Œgrpc_type&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;unary&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;grpc_server_started_total&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;grpc_method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;RoleRevokePermission&amp;#34;&lt;/span&gt;ï¼Œgrpc_service&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;etcdserverpb.Auth&amp;#34;&lt;/span&gt;ï¼Œgrpc_type&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;unary&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;grpc_server_started_total&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;grpc_method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Snapshot&amp;#34;&lt;/span&gt;ï¼Œgrpc_service&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;etcdserverpb.Maintenance&amp;#34;&lt;/span&gt;ï¼Œgrpc_type&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;server_stream&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;grpc_server_started_total&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;grpc_method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Status&amp;#34;&lt;/span&gt;ï¼Œgrpc_service&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;etcdserverpb.Maintenance&amp;#34;&lt;/span&gt;ï¼Œgrpc_type&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;unary&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;grpc_server_started_total&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;grpc_method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Txn&amp;#34;&lt;/span&gt;ï¼Œgrpc_service&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;etcdserverpb.KV&amp;#34;&lt;/span&gt;ï¼Œgrpc_type&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;unary&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;259160&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;grpc_server_started_total&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;grpc_method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;UserAdd&amp;#34;&lt;/span&gt;ï¼Œgrpc_service&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;etcdserverpb.Auth&amp;#34;&lt;/span&gt;ï¼Œgrpc_type&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;unary&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;grpc_server_started_total&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;grpc_method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;UserChangePassword&amp;#34;&lt;/span&gt;ï¼Œgrpc_service&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;etcdserverpb.Auth&amp;#34;&lt;/span&gt;ï¼Œgrpc_type&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;unary&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;grpc_server_started_total&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;grpc_method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;UserDelete&amp;#34;&lt;/span&gt;ï¼Œgrpc_service&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;etcdserverpb.Auth&amp;#34;&lt;/span&gt;ï¼Œgrpc_type&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;unary&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;grpc_server_started_total&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;grpc_method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;UserGet&amp;#34;&lt;/span&gt;ï¼Œgrpc_service&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;etcdserverpb.Auth&amp;#34;&lt;/span&gt;ï¼Œgrpc_type&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;unary&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;grpc_server_started_total&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;grpc_method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;UserGrantRole&amp;#34;&lt;/span&gt;ï¼Œgrpc_service&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;etcdserverpb.Auth&amp;#34;&lt;/span&gt;ï¼Œgrpc_type&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;unary&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;grpc_server_started_total&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;grpc_method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;UserList&amp;#34;&lt;/span&gt;ï¼Œgrpc_service&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;etcdserverpb.Auth&amp;#34;&lt;/span&gt;ï¼Œgrpc_type&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;unary&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;grpc_server_started_total&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;grpc_method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;UserRevokeRole&amp;#34;&lt;/span&gt;ï¼Œgrpc_service&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;etcdserverpb.Auth&amp;#34;&lt;/span&gt;ï¼Œgrpc_type&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;unary&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;grpc_server_started_total&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;grpc_method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Watch&amp;#34;&lt;/span&gt;ï¼Œgrpc_service&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;etcdserverpb.Watch&amp;#34;&lt;/span&gt;ï¼Œgrpc_type&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;bidi_stream&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;86&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# HELP process_cpu_seconds_total Total user and system CPU time spent in seconds.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# TYPE process_cpu_seconds_total counter&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;process_cpu_seconds_total 28145.45
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# HELP process_max_fds Maximum number of open file descriptors.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# TYPE process_max_fds gauge&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;process_max_fds &lt;span class=&#34;m&#34;&gt;65536&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# HELP process_open_fds Number of open file descriptors.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# TYPE process_open_fds gauge&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;process_open_fds &lt;span class=&#34;m&#34;&gt;121&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# HELP process_resident_memory_bytes Resident memory size in bytes.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# TYPE process_resident_memory_bytes gauge&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;process_resident_memory_bytes 1.46509824e+08
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# HELP process_start_time_seconds Start time of the process since unix epoch in seconds.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# TYPE process_start_time_seconds gauge&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;process_start_time_seconds 1.54557786888e+09
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# HELP process_virtual_memory_bytes Virtual memory size in bytes.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# TYPE process_virtual_memory_bytes gauge&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;process_virtual_memory_bytes 1.0886217728e+10
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åŒç† kube-apiserver ä¹Ÿæœ‰ metrics ä¿¡æ¯&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get --raw /metrics
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rest_client_request_latency_seconds_bucket&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;https://[::1]:6443/apis?timeout=32s&amp;#34;&lt;/span&gt;ï¼Œverb&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;ï¼Œle&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0.512&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;39423&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rest_client_request_latency_seconds_bucket&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;https://[::1]:6443/apis?timeout=32s&amp;#34;&lt;/span&gt;ï¼Œverb&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;ï¼Œle&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;+Inf&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;39423&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rest_client_request_latency_seconds_sum&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;https://[::1]:6443/apis?timeout=32s&amp;#34;&lt;/span&gt;ï¼Œverb&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; 24.781942557999795
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rest_client_request_latency_seconds_count&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;https://[::1]:6443/apis?timeout=32s&amp;#34;&lt;/span&gt;ï¼Œverb&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;39423&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# HELP rest_client_requests_total Number of HTTP requestsï¼Œ partitioned by status codeï¼Œ methodï¼Œ and host.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# TYPE rest_client_requests_total counter&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rest_client_requests_total&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;200&amp;#34;&lt;/span&gt;ï¼Œhost&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;[::1]:6443&amp;#34;&lt;/span&gt;ï¼Œmethod&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; 2.032031e+06
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rest_client_requests_total&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;200&amp;#34;&lt;/span&gt;ï¼Œhost&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;[::1]:6443&amp;#34;&lt;/span&gt;ï¼Œmethod&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;PUT&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; 1.106921e+06
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rest_client_requests_total&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;201&amp;#34;&lt;/span&gt;ï¼Œhost&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;[::1]:6443&amp;#34;&lt;/span&gt;ï¼Œmethod&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;POST&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;38&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rest_client_requests_total&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;401&amp;#34;&lt;/span&gt;ï¼Œhost&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;[::1]:6443&amp;#34;&lt;/span&gt;ï¼Œmethod&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;17378&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rest_client_requests_total&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;404&amp;#34;&lt;/span&gt;ï¼Œhost&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;[::1]:6443&amp;#34;&lt;/span&gt;ï¼Œmethod&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; 3.546509e+06
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rest_client_requests_total&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;409&amp;#34;&lt;/span&gt;ï¼Œhost&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;[::1]:6443&amp;#34;&lt;/span&gt;ï¼Œmethod&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;POST&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;29&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rest_client_requests_total&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;409&amp;#34;&lt;/span&gt;ï¼Œhost&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;[::1]:6443&amp;#34;&lt;/span&gt;ï¼Œmethod&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;PUT&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rest_client_requests_total&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;422&amp;#34;&lt;/span&gt;ï¼Œhost&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;[::1]:6443&amp;#34;&lt;/span&gt;ï¼Œmethod&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;POST&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rest_client_requests_total&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;503&amp;#34;&lt;/span&gt;ï¼Œhost&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;[::1]:6443&amp;#34;&lt;/span&gt;ï¼Œmethod&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# HELP ssh_tunnel_open_count Counter of ssh tunnel total open attempts&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# TYPE ssh_tunnel_open_count counter&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ssh_tunnel_open_count &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# HELP ssh_tunnel_open_fail_count Counter of ssh tunnel failed open attempts&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# TYPE ssh_tunnel_open_fail_count counter&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ssh_tunnel_open_fail_count &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ç§å°±æ˜¯ prometheus çš„å®šä¹‰çš„ metrics æ ¼å¼è§„èŒƒï¼Œç¼ºçœæ˜¯åœ¨ http(s) çš„ url çš„/metrics è¾“å‡ºã€‚
è€Œ metrics è¦ä¹ˆç¨‹åºå®šä¹‰è¾“å‡º (æ¨¡å—æˆ–è€…è‡ªå®šä¹‰å¼€å‘)ï¼Œè¦ä¹ˆç”¨å®˜æ–¹çš„å„ç§ exporter(node-exporterï¼Œmysqld-exporterï¼Œmemcached_exporter&amp;hellip;) é‡‡é›†è¦ç›‘æ§çš„ä¿¡æ¯å ç”¨ä¸€ä¸ª web ç«¯å£ç„¶åè¾“å‡ºæˆ metrics æ ¼å¼çš„ä¿¡æ¯ï¼Œprometheus server å»æ”¶é›†å„ä¸ª target çš„ metrics å­˜å‚¨èµ·æ¥ (tsdb)ã€‚
ç”¨æˆ·å¯ä»¥åœ¨ prometheus çš„ http é¡µé¢ä¸Šç”¨ promQL(prometheus çš„æŸ¥è¯¢è¯­è¨€) æˆ–è€… (grafana æ•°æ®æ¥æºå°±æ˜¯ç”¨)api å»æŸ¥è¯¢ä¸€äº›ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨ pushgateway å»ç»Ÿä¸€é‡‡é›†ç„¶å prometheus ä» pushgateway é‡‡é›† (æ‰€ä»¥ pushgateway ç±»ä¼¼äº zabbix çš„ proxy)ï¼Œprometheus çš„å·¥ä½œæ¶æ„å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/prometheus-operator-manual/006tNc79ly1fyzbj3vh0vj30ms0db406_hu10771267513853050388.webp 400w,
               /blog/prometheus-operator-manual/006tNc79ly1fyzbj3vh0vj30ms0db406_hu8304187294409437.webp 760w,
               /blog/prometheus-operator-manual/006tNc79ly1fyzbj3vh0vj30ms0db406_hu8984944616380658450.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/prometheus-operator-manual/006tNc79ly1fyzbj3vh0vj30ms0db406_hu10771267513853050388.webp&#34;
               width=&#34;760&#34;
               height=&#34;444&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;ä¸ºä»€ä¹ˆéœ€è¦-prometheus-operator&#34;&gt;ä¸ºä»€ä¹ˆéœ€è¦ prometheus-operator&lt;/h3&gt;
&lt;p&gt;å› ä¸ºæ˜¯ prometheus ä¸»åŠ¨å»æ‹‰å–çš„ï¼Œæ‰€ä»¥åœ¨ k8s é‡Œ pod å› ä¸ºè°ƒåº¦çš„åŸå› å¯¼è‡´ pod çš„ ip ä¼šå‘ç”Ÿå˜åŒ–ï¼Œäººå·¥ä¸å¯èƒ½å»ç»´æŒï¼Œè‡ªåŠ¨å‘ç°æœ‰åŸºäº DNS çš„ï¼Œä½†æ˜¯æ–°å¢è¿˜æ˜¯æœ‰ç‚¹éº»çƒ¦ã€‚&lt;/p&gt;
&lt;p&gt;Prometheus-operator çš„æœ¬èŒå°±æ˜¯ä¸€ç»„ç”¨æˆ·è‡ªå®šä¹‰çš„ CRD èµ„æºä»¥åŠ Controller çš„å®ç°ï¼ŒPrometheus Operator è¿™ä¸ª controller æœ‰ RBAC æƒé™ä¸‹å»è´Ÿè´£ç›‘å¬è¿™äº›è‡ªå®šä¹‰èµ„æºçš„å˜åŒ–ï¼Œå¹¶ä¸”æ ¹æ®è¿™äº›èµ„æºçš„å®šä¹‰è‡ªåŠ¨åŒ–çš„å®Œæˆå¦‚ Prometheus Server è‡ªèº«ä»¥åŠé…ç½®çš„è‡ªåŠ¨åŒ–ç®¡ç†å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Kubernetes ä¸­æˆ‘ä»¬ä½¿ç”¨ Deploymentã€DamenSetã€StatefulSet æ¥ç®¡ç†åº”ç”¨ Workloadï¼Œä½¿ç”¨ Serviceã€Ingress æ¥ç®¡ç†åº”ç”¨çš„è®¿é—®æ–¹å¼ï¼Œä½¿ç”¨ ConfigMap å’Œ Secret æ¥ç®¡ç†åº”ç”¨é…ç½®ã€‚æˆ‘ä»¬åœ¨é›†ç¾¤ä¸­å¯¹è¿™äº›èµ„æºçš„åˆ›å»ºï¼Œæ›´æ–°ï¼Œåˆ é™¤çš„åŠ¨ä½œéƒ½ä¼šè¢«è½¬æ¢ä¸ºäº‹ä»¶ (Event)ï¼ŒKubernetes çš„ Controller Manager è´Ÿè´£ç›‘å¬è¿™äº›äº‹ä»¶å¹¶è§¦å‘ç›¸åº”çš„ä»»åŠ¡æ¥æ»¡è¶³ç”¨æˆ·çš„æœŸæœ›ã€‚è¿™ç§æ–¹å¼æˆ‘ä»¬ç§°ä¸ºå£°æ˜å¼ï¼Œç”¨æˆ·åªéœ€è¦å…³å¿ƒåº”ç”¨ç¨‹åºçš„æœ€ç»ˆçŠ¶æ€ï¼Œå…¶å®ƒçš„éƒ½é€šè¿‡ Kubernetes æ¥å¸®åŠ©æˆ‘ä»¬å®Œæˆï¼Œé€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥å¤§å¤§ç®€åŒ–åº”ç”¨çš„é…ç½®ç®¡ç†å¤æ‚åº¦ã€‚&lt;/p&gt;
&lt;p&gt;è€Œé™¤äº†è¿™äº›åŸç”Ÿçš„ Resource èµ„æºä»¥å¤–ï¼ŒKubernetes è¿˜å…è®¸ç”¨æˆ·æ·»åŠ è‡ªå·±çš„è‡ªå®šä¹‰èµ„æº (Custom Resource)ã€‚å¹¶ä¸”é€šè¿‡å®ç°è‡ªå®šä¹‰ Controller æ¥å®ç°å¯¹ Kubernetes çš„æ‰©å±•ï¼Œä¸éœ€è¦ç”¨æˆ·å»äºŒå¼€ k8s ä¹Ÿèƒ½è¾¾åˆ°ç»™ k8s æ·»åŠ åŠŸèƒ½å’Œå¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸º svc çš„è´Ÿè½½å‡è¡¡ï¼Œæ‰€ä»¥åœ¨ K8S é‡Œç›‘æ§ metrics åŸºæœ¬æœ€å°å•ä½éƒ½æ˜¯ä¸€ä¸ª svc èƒŒåçš„ pod ä¸º targetï¼Œæ‰€ä»¥ prometheus-operator åˆ›å»ºäº†å¯¹åº”çš„ CRD: &lt;code&gt;kind: ServiceMonitor&lt;/code&gt; ï¼Œåˆ›å»ºçš„&lt;code&gt;ServiceMonitor&lt;/code&gt;é‡Œå£°æ˜éœ€è¦ç›‘æ§é€‰ä¸­çš„ svc çš„ label ä»¥åŠ metrics çš„ url è·¯å¾„çš„å’Œ namespaces å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;å·¥ä½œæ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/prometheus-operator-manual/006tNc79ly1fyzbjl4ql8j31dw0t2djs_hu15827614680613631685.webp 400w,
               /blog/prometheus-operator-manual/006tNc79ly1fyzbjl4ql8j31dw0t2djs_hu15299633817157262951.webp 760w,
               /blog/prometheus-operator-manual/006tNc79ly1fyzbjl4ql8j31dw0t2djs_hu16367989683665505129.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/prometheus-operator-manual/006tNc79ly1fyzbjl4ql8j31dw0t2djs_hu15827614680613631685.webp&#34;
               width=&#34;760&#34;
               height=&#34;442&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;demo-éƒ¨ç½²å­¦ä¹ &#34;&gt;Demo éƒ¨ç½²å­¦ä¹ &lt;/h2&gt;
&lt;h3 id=&#34;è·å–ç›¸å…³æ–‡ä»¶&#34;&gt;è·å–ç›¸å…³æ–‡ä»¶&lt;/h3&gt;
&lt;p&gt;å…ˆè·å–ç›¸å…³æ–‡ä»¶åé¢è·Ÿç€æ–‡ä»¶æ¥è®²ï¼Œç›´æ¥ç”¨ git å®¢æˆ·ç«¯æ‹‰å–å³å¯ï¼Œä¸è¿‡æ–‡ä»¶å¤§æ¦‚ 30 å¤š Mï¼Œæ²¡æ¢¯å­åŸºæœ¬æ‹‰ä¸ä¸‹æ¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/coreos/prometheus-operator.git
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‹‰å–ä¸ä¸‹æ¥å¯ä»¥åœ¨&lt;a href=&#34;https://www.katacoda.com/courses/kubernetes&#34;&gt;katacoda çš„ç½‘é¡µ&lt;/a&gt;ä¸Šéšä¾¿ä¸€ä¸ªè¯¾ç¨‹çš„æœºå™¨éƒ½æœ‰ docker å®¢æˆ·ç«¯ï¼Œå¯ä»¥ git clone ä¸‹æ¥åæŠŠæ–‡ä»¶æ„å»ºè¿›ä¸€ä¸ª alpine é•œåƒç„¶åæ¨åˆ° dockerhub ä¸Šï¼Œå†åœ¨è‡ªå·±çš„æœºå™¨ docker run è¿™ä¸ªé•œåƒçš„æ—¶å€™ docker cp åˆ°å®¿ä¸»æœºä¸Šã€‚&lt;/p&gt;
&lt;p&gt;Prometheus Operator å¼•å…¥çš„è‡ªå®šä¹‰èµ„æºåŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Prometheus&lt;/li&gt;
&lt;li&gt;ServiceMonitor&lt;/li&gt;
&lt;li&gt;Alertmanager&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”¨æˆ·åˆ›å»ºäº† prometheus-operator(ä¹Ÿå°±æ˜¯ä¸Šé¢ç›‘å¬ä¸‰ä¸ª CRD çš„å„ç§äº‹ä»¶çš„ controller) åï¼Œç”¨æˆ·å¯ä»¥åˆ©ç”¨&lt;code&gt;kind: Prometheus&lt;/code&gt;è¿™ç§å£°æ˜å¼åˆ›å»ºå¯¹åº”çš„èµ„æºã€‚
ä¸‹é¢æˆ‘ä»¬éƒ¨ç½²ç®€å•çš„ä¾‹å­å­¦ä¹  prometheus-operator&lt;/p&gt;
&lt;h3 id=&#34;åˆ›å»º-prometheus-operator-çš„-pod&#34;&gt;åˆ›å»º prometheus-operator çš„ pod&lt;/h3&gt;
&lt;p&gt;æ‹‰å–åˆ°æ–‡ä»¶åæˆ‘ä»¬å…ˆåˆ›å»º prometheus-operatorï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; prometheus-operator
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl apply -f bundle.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;clusterrolebinding.rbac.authorization.k8s.io/prometheus-operator created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;clusterrole.rbac.authorization.k8s.io/prometheus-operator created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deployment.apps/prometheus-operator created
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;serviceaccount/prometheus-operator created
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¡®è®¤ pod è¿è¡Œï¼Œä»¥åŠæˆ‘ä»¬å¯ä»¥å‘ç° operator çš„ pod åœ¨æœ‰ RBAC ä¸‹åˆ›å»ºäº†ä¸€ä¸ª APIServiceï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get pod
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                   READY     STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prometheus-operator-6db8dbb7dd-djj6s   1/1       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          1m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get APIService &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep monitor
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;v1.monitoring.coreos.com               2018-10-09T10:49:47Z
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŸ¥çœ‹è¿™ä¸ª APISerivce&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get --raw /apis/monitoring.coreos.com/v1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;kind&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;APIResourceList&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;apiVersion&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;v1&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;groupVersion&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;monitoring.coreos.com/v1&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;resources&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;alertmanagers&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;singularName&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;alertmanager&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;namespaced&amp;#34;&lt;/span&gt;: trueï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;kind&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;Alertmanager&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;verbs&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;delete&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;deletecollection&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;get&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;list&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;patch&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;create&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;update&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;watch&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;prometheuses&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;singularName&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;prometheus&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;namespaced&amp;#34;&lt;/span&gt;: trueï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;kind&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;Prometheus&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;verbs&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;delete&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;deletecollection&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;get&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;list&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;patch&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;create&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;update&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;watch&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;servicemonitors&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;singularName&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;servicemonitor&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;namespaced&amp;#34;&lt;/span&gt;: trueï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;kind&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;ServiceMonitor&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;verbs&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;delete&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;deletecollection&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;get&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;list&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;patch&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;create&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;update&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;watch&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;prometheusrules&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;singularName&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;prometheusrule&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;namespaced&amp;#34;&lt;/span&gt;: trueï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;kind&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;PrometheusRule&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;verbs&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;delete&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;deletecollection&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;get&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;list&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;patch&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;create&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;update&amp;#34;&lt;/span&gt;ï¼Œ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;watch&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸ªæ˜¯å› ä¸º bundle.yml é‡Œæœ‰å¦‚ä¸‹çš„&lt;code&gt;CLusterRole&lt;/code&gt;å’Œå¯¹åº”çš„&lt;code&gt;ClusterRoleBinding&lt;/code&gt;æ¥è®© prometheus-operator æœ‰æƒé™å¯¹&lt;code&gt;monitoring.coreos.com&lt;/code&gt;è¿™ä¸ª apiGroup é‡Œçš„è¿™äº› CRD è¿›è¡Œæ‰€æœ‰æ“ä½œ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterRole&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;prometheus-operator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;apiextensions.k8s.io&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;customresourcedefinitions&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s1&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;apiGroups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;monitoring.coreos.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;alertmanagers&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;prometheuses&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;prometheuses/finalizers&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;alertmanagers/finalizers&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;servicemonitors&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;prometheusrules&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;verbs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;s1&#34;&gt;&amp;#39;*&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åŒæ—¶æˆ‘ä»¬æŸ¥çœ‹åˆ° pod é‡Œçš„ log å‘ç° operator ä¹Ÿåœ¨é›†ç¾¤é‡Œåˆ›å»ºäº†å¯¹åº”çš„ CRD&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl logs prometheus-operator-6db8dbb7dd-dkhxc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;ts&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;2018-10-09T11:21:09.389340424Z &lt;span class=&#34;nv&#34;&gt;caller&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;main.go:165 &lt;span class=&#34;nv&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Starting Prometheus Operator version &amp;#39;0.26.0&amp;#39;.&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;info &lt;span class=&#34;nv&#34;&gt;ts&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;2018-10-09T11:21:09.491464524Z &lt;span class=&#34;nv&#34;&gt;caller&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;operator.go:377 &lt;span class=&#34;nv&#34;&gt;component&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;prometheusoperator &lt;span class=&#34;nv&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;connection established&amp;#34;&lt;/span&gt; cluster-version&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;v1.11.3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;info &lt;span class=&#34;nv&#34;&gt;ts&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;2018-10-09T11:21:09.492679498Z &lt;span class=&#34;nv&#34;&gt;caller&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;operator.go:209 &lt;span class=&#34;nv&#34;&gt;component&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;alertmanageroperator &lt;span class=&#34;nv&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;connection established&amp;#34;&lt;/span&gt; cluster-version&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;v1.11.3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;info &lt;span class=&#34;nv&#34;&gt;ts&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;2018-10-09T11:21:12.085147219Z &lt;span class=&#34;nv&#34;&gt;caller&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;operator.go:624 &lt;span class=&#34;nv&#34;&gt;component&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;alertmanageroperator &lt;span class=&#34;nv&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;CRD created&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;crd&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;Alertmanager
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;info &lt;span class=&#34;nv&#34;&gt;ts&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;2018-10-09T11:21:12.085265548Z &lt;span class=&#34;nv&#34;&gt;caller&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;operator.go:1420 &lt;span class=&#34;nv&#34;&gt;component&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;prometheusoperator &lt;span class=&#34;nv&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;CRD created&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;crd&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;Prometheus
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;info &lt;span class=&#34;nv&#34;&gt;ts&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;2018-10-09T11:21:12.099210714Z &lt;span class=&#34;nv&#34;&gt;caller&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;operator.go:1420 &lt;span class=&#34;nv&#34;&gt;component&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;prometheusoperator &lt;span class=&#34;nv&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;CRD created&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;crd&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;ServiceMonitor
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;info &lt;span class=&#34;nv&#34;&gt;ts&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;2018-10-09T11:21:12.118721976Z &lt;span class=&#34;nv&#34;&gt;caller&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;operator.go:1420 &lt;span class=&#34;nv&#34;&gt;component&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;prometheusoperator &lt;span class=&#34;nv&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;CRD created&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;crd&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;PrometheusRule
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;info &lt;span class=&#34;nv&#34;&gt;ts&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;2018-10-09T11:21:15.182780757Z &lt;span class=&#34;nv&#34;&gt;caller&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;operator.go:225 &lt;span class=&#34;nv&#34;&gt;component&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;alertmanageroperator &lt;span class=&#34;nv&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;CRD API endpoints ready&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;info &lt;span class=&#34;nv&#34;&gt;ts&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;2018-10-09T11:21:15.383456425Z &lt;span class=&#34;nv&#34;&gt;caller&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;operator.go:180 &lt;span class=&#34;nv&#34;&gt;component&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;alertmanageroperator &lt;span class=&#34;nv&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;successfully synced all caches&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get crd
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                    CREATED AT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;alertmanagers.monitoring.coreos.com     2018-10-09T11:21:11Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prometheuses.monitoring.coreos.com      2018-10-09T11:21:11Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prometheusrules.monitoring.coreos.com   2018-10-09T11:21:12Z
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;servicemonitors.monitoring.coreos.com   2018-10-09T11:21:12Z
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ç›¸å…³-crd-ä»‹ç»&#34;&gt;ç›¸å…³ CRD ä»‹ç»&lt;/h3&gt;
&lt;p&gt;è¿™å››ä¸ª CRD ä½œç”¨å¦‚ä¸‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;span style=&#34;font-size: 1.2em;color: #333;font-weight:bold&#34;&gt;Prometheus&lt;/span&gt;: ç”± Operator ä¾æ®ä¸€ä¸ªè‡ªå®šä¹‰èµ„æº&lt;code&gt;kind: Prometheus&lt;/code&gt;ç±»å‹ä¸­ï¼Œæ‰€æè¿°çš„å†…å®¹è€Œéƒ¨ç½²çš„ Prometheus Server é›†ç¾¤ï¼Œå¯ä»¥å°†è¿™ä¸ªè‡ªå®šä¹‰èµ„æºçœ‹ä½œæ˜¯ä¸€ç§ç‰¹åˆ«ç”¨æ¥ç®¡ç† Prometheus Server çš„ StatefulSets èµ„æºã€‚&lt;/li&gt;
&lt;li&gt;&lt;span style=&#34;font-size: 1.2em;color: #333;font-weight:bold&#34;&gt;ServiceMonitor&lt;/span&gt;: ä¸€ä¸ª Kubernetes è‡ªå®šä¹‰èµ„æº (å’Œ&lt;code&gt;kind: Prometheus&lt;/code&gt;ä¸€æ ·æ˜¯ CRD)ï¼Œè¯¥èµ„æºæè¿°äº† Prometheus Server çš„ Target åˆ—è¡¨ï¼ŒOperator ä¼šç›‘å¬è¿™ä¸ªèµ„æºçš„å˜åŒ–æ¥åŠ¨æ€çš„æ›´æ–° Prometheus Server çš„ Scrape targets å¹¶è®© prometheus server å» reload é…ç½® (prometheus æœ‰å¯¹åº” reload çš„ http æ¥å£&lt;code&gt;/-/reload&lt;/code&gt;)ã€‚è€Œè¯¥èµ„æºä¸»è¦é€šè¿‡ Selector æ¥ä¾æ® Labels é€‰å–å¯¹åº”çš„ Service çš„ endpointsï¼Œå¹¶è®© Prometheus Server é€šè¿‡ Service è¿›è¡Œæ‹‰å–ï¼ˆæ‹‰ï¼‰æŒ‡æ ‡èµ„æ–™ (ä¹Ÿå°±æ˜¯ metrics ä¿¡æ¯)ï¼Œmetrics ä¿¡æ¯è¦åœ¨ http çš„ url è¾“å‡ºç¬¦åˆ metrics æ ¼å¼çš„ä¿¡æ¯ï¼ŒServiceMonitor ä¹Ÿå¯ä»¥å®šä¹‰ç›®æ ‡çš„ metrics çš„ urlã€‚&lt;/li&gt;
&lt;li&gt;&lt;span style=&#34;font-size: 1.2em;color: #333;font-weight:bold&#34;&gt;Alertmanager&lt;/span&gt;ï¼šPrometheus Operator ä¸åªæ˜¯æä¾› Prometheus Server ç®¡ç†ä¸éƒ¨ç½²ï¼Œä¹ŸåŒ…å«äº† AlertManagerï¼Œå¹¶ä¸”ä¸€æ ·é€šè¿‡ä¸€ä¸ª &lt;code&gt;kind: Alertmanager&lt;/code&gt; è‡ªå®šä¹‰èµ„æºæ¥æè¿°ä¿¡æ¯ï¼Œå†ç”± Operator ä¾æ®æè¿°å†…å®¹éƒ¨ç½² Alertmanager é›†ç¾¤ã€‚&lt;/li&gt;
&lt;li&gt;&lt;span style=&#34;font-size: 1.2em;color: #333;font-weight:bold&#34;&gt;PrometheusRule&lt;/span&gt;:å¯¹äº Prometheus è€Œè¨€ï¼Œåœ¨åŸç”Ÿçš„ç®¡ç†æ–¹å¼ä¸Šï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨åˆ›å»º Prometheus çš„å‘Šè­¦æ–‡ä»¶ï¼Œå¹¶ä¸”é€šè¿‡åœ¨ Prometheus é…ç½®ä¸­å£°æ˜å¼çš„åŠ è½½ã€‚è€Œåœ¨ Prometheus Operator æ¨¡å¼ä¸­ï¼Œå‘Šè­¦è§„åˆ™ä¹Ÿç¼–ç¨‹ä¸€ä¸ªé€šè¿‡ Kubernetes API å£°æ˜å¼åˆ›å»ºçš„ä¸€ä¸ªèµ„æºã€‚å‘Šè­¦è§„åˆ™åˆ›å»ºæˆåŠŸåï¼Œé€šè¿‡åœ¨ Prometheus ä¸­ä½¿ç”¨æƒ³ servicemonitor é‚£æ ·ç”¨&lt;code&gt;ruleSelector&lt;/code&gt;é€šè¿‡ label åŒ¹é…é€‰æ‹©éœ€è¦å…³è”çš„ PrometheusRule å³å¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;éƒ¨ç½²-kind-prometheus&#34;&gt;éƒ¨ç½² kind: Prometheus&lt;/h3&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬æœ‰äº† prometheus è¿™ä¸ª CRDï¼Œæˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ª prometheus server åªéœ€è¦å¦‚ä¸‹å£°æ˜å³å¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cat&lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF | kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: v1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: ServiceAccount
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: prometheus
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;---
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: monitoring.coreos.com/v1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: Prometheus
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: prometheus
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  serviceMonitorSelector:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    matchLabels:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      team: frontend
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  serviceAccountName: prometheus
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  resources:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    requests:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      memory: 400Mi
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å› ä¸ºè´Ÿè½½å‡è¡¡ï¼Œä¸€ä¸ª svc ä¸‹çš„ä¸€ç»„ pod æ˜¯ç›‘æ§çš„æœ€å°å•ä½ï¼Œè¦ç›‘æ§ä¸€ä¸ª svc çš„ metrics å°±å£°æ˜åˆ›å»ºä¸€ä¸ª&lt;code&gt;servicemonitors&lt;/code&gt;å³å¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;éƒ¨ç½²ä¸€ç»„-pod-åŠå…¶-svc&#34;&gt;éƒ¨ç½²ä¸€ç»„ pod åŠå…¶ svc&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ªå¸¦ metrics è¾“å‡ºçš„ç®€å•ç¨‹åºçš„ deployï¼Œè¯¥é•œåƒé‡Œçš„ä¸»è¿›ç¨‹ä¼šåœ¨ 8080 ç«¯å£ä¸Šè¾“å‡º metrics ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cat&lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF | kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: extensions/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: Deployment
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: example-app
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  replicas: 3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  template:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      labels:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        app: example-app
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      containers:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      - name: example-app
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        image: zhangguanzhang/instrumented_app
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        ports:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;        - name: web
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;          containerPort: 8080
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆ›å»ºå¯¹åº”çš„ svcã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cat&lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF | kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: Service
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: v1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: example-app
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  labels:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    app: example-app
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  selector:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    app: example-app
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  ports:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  - name: web
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    port: 8080
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;éƒ¨ç½²-kind-servicemonitor&#34;&gt;éƒ¨ç½² kind: ServiceMonitor&lt;/h3&gt;
&lt;p&gt;ç°åœ¨åˆ›å»ºä¸€ä¸ª&lt;code&gt;ServiceMonitor&lt;/code&gt;æ¥å‘Šè¯‰ prometheus server éœ€è¦ç›‘æ§å¸¦æœ‰ label &lt;code&gt;app: example-app&lt;/code&gt;çš„ svc èƒŒåçš„ä¸€ç»„ pod çš„ metricsã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cat&lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF | kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: monitoring.coreos.com/v1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: ServiceMonitor
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: example-app
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  labels:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    team: frontend
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  selector:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    matchLabels:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;      app: example-app
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  endpoints:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  - port: web
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹&lt;code&gt;ServiceMonitor&lt;/code&gt;å’Œç›‘æ§å¯¹è±¡å¿…é¡»æ˜¯åœ¨ç›¸åŒ Namespace ä¸‹çš„ï¼Œå¦‚æœè¦å…³è”éåŒ ns ä¸‹éœ€è¦ä¸‹é¢è¿™æ ·è®¾ç½®å€¼ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespaceSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchNames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;target_ns_name&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœå¸Œæœ› ServiceMonitor å¯ä»¥å…³è”ä»»æ„å‘½åç©ºé—´ä¸‹çš„æ ‡ç­¾ï¼Œåˆ™é€šè¿‡ä»¥ä¸‹æ–¹å¼å®šä¹‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespaceSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;any&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœéœ€è¦ç›‘æ§çš„ Target å¯¹è±¡å¯ç”¨äº† BasicAuth è®¤è¯ï¼Œé‚£åœ¨å®šä¹‰ ServiceMonitor å¯¹è±¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ endpoints é…ç½®ä¸­å®šä¹‰ basicAuth å¦‚ä¸‹æ‰€ç¤º basicAuth ä¸­çš„&lt;code&gt;password&lt;/code&gt;å’Œ&lt;code&gt;username&lt;/code&gt;å€¼æ¥æºäºåŒ ns ä¸‹çš„ä¸€ä¸ªåä¸º&lt;code&gt;basic-auth&lt;/code&gt;çš„ Secretã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;l&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;endpoints&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;basicAuth&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;password&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;basic-auth&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;password&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;basic-auth&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;web&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Secret&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;basic-auth&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Opaque&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;dXNlcgo=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# base64 ç¼–ç åçš„ç”¨æˆ·å&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;password&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cGFzc3dkCg==&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# base64 ç¼–ç åçš„å¯†ç &lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢è¦æ³¨æ„çš„æ˜¯æˆ‘åˆ›å»º prometheus server çš„æ—¶å€™æœ‰å¦‚ä¸‹å€¼ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceMonitorSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;team&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;frontend&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯¥å€¼å­—é¢æ„æ€å¯ä»¥çŸ¥é“å°±æ˜¯æŒ‡å®š prometheus server å»é€‰æ‹©å“ªäº›&lt;code&gt;ServiceMonitor&lt;/code&gt;ï¼Œè¿™ä¸ªæ¦‚å¿µå’Œ svc å»é€‰æ‹© pod ä¸€æ ·ï¼Œå¯èƒ½ä¸€ä¸ªé›†ç¾¤è·‘å¾ˆå¤š prometheus server æ¥ç›‘æ§å„è‡ªé€‰ä¸­çš„&lt;code&gt;ServiceMonitor&lt;/code&gt;ï¼Œå¦‚æœæƒ³ä¸€ä¸ª prometheus server ç›‘æ§æ‰€æœ‰çš„åˆ™&lt;code&gt;spec.serviceMonitorSelector: {}&lt;/code&gt;ä¸ºç©ºå³å¯ï¼Œè€Œ namespaces çš„èŒƒå›´åŒæ ·çš„è®¾ç½®&lt;code&gt;spec.serviceMonitorSelector: {}&lt;/code&gt;ï¼Œåé¢å®˜æ–¹çš„ prometheus å®ä¾‹é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è®¾ç½®äº†è¿™ä¸¤ä¸ªå€¼ã€‚&lt;/p&gt;
&lt;p&gt;ç»™ prometheus server è®¾ç½®ç›¸å…³çš„ RBAC æƒé™ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cat&lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF | kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: rbac.authorization.k8s.io/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: ClusterRole
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: prometheus
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;rules:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;- apiGroups: [&amp;#34;&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  resources:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  - nodes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  - services
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  - endpoints
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  - pods
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  verbs: [&amp;#34;get&amp;#34;ï¼Œ &amp;#34;list&amp;#34;ï¼Œ &amp;#34;watch&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;- apiGroups: [&amp;#34;&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  resources:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  - configmaps
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  verbs: [&amp;#34;get&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;- nonResourceURLs: [&amp;#34;/metrics&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  verbs: [&amp;#34;get&amp;#34;]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;---
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: rbac.authorization.k8s.io/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: ClusterRoleBinding
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: prometheus
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;roleRef:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  apiGroup: rbac.authorization.k8s.io
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  kind: ClusterRole
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: prometheus
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;subjects:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;- kind: ServiceAccount
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: prometheus
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  namespace: default
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆ›å»º svc ä½¿ç”¨&lt;code&gt;NodePort&lt;/code&gt;æ–¹ä¾¿æˆ‘ä»¬è®¿é—® prometheus çš„ web é¡µé¢ï¼Œç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä½¿ç”¨&lt;code&gt;NodePort&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cat&lt;span class=&#34;s&#34;&gt;&amp;lt;&amp;lt;EOF | kubectl apply -f -
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;apiVersion: v1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;kind: Service
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  name: prometheus
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  type: NodePort
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  ports:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  - name: web
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    nodePort: 30900
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    port: 9090
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    protocol: TCP
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    targetPort: web
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;  selector:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;    prometheus: prometheus
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰“å¼€æµè§ˆå™¨è®¿é—®&lt;code&gt;ip:30900&lt;/code&gt;è¿›å…¥ target å‘ç°å·²ç»ç›‘å¬èµ·æ¥äº†ï¼Œå¯¹åº”çš„ config é‡Œä¹Ÿæœ‰é…ç½®ç”Ÿæˆå’Œå¯¼å…¥ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/prometheus-operator-manual/006tNc79ly1fyzbkz9djqj314c0fv41z_hu14118465228001617415.webp 400w,
               /blog/prometheus-operator-manual/006tNc79ly1fyzbkz9djqj314c0fv41z_hu3357936322535473275.webp 760w,
               /blog/prometheus-operator-manual/006tNc79ly1fyzbkz9djqj314c0fv41z_hu5925125683844561576.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/prometheus-operator-manual/006tNc79ly1fyzbkz9djqj314c0fv41z_hu14118465228001617415.webp&#34;
               width=&#34;760&#34;
               height=&#34;299&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/prometheus-operator-manual/006tNc79ly1fyzblkgpcnj30r80q8juf_hu6068091882427401260.webp 400w,
               /blog/prometheus-operator-manual/006tNc79ly1fyzblkgpcnj30r80q8juf_hu13072671077115992843.webp 760w,
               /blog/prometheus-operator-manual/006tNc79ly1fyzblkgpcnj30r80q8juf_hu12886599153523526030.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/prometheus-operator-manual/006tNc79ly1fyzblkgpcnj30r80q8juf_hu6068091882427401260.webp&#34;
               width=&#34;760&#34;
               height=&#34;732&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å…ˆæ¸…ç†æ‰ä¸Šé¢çš„ï¼Œç„¶åæˆ‘ä»¬ä½¿ç”¨å®˜æ–¹æä¾›çš„å…¨å¥— yaml æ­£å¼éƒ¨ç½²&lt;code&gt;prometheus-operator&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete svc prometheus example-app
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete ClusterRoleBinding prometheus 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete ClusterRole prometheus
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete ServiceMonitor example-app
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete deploy example-app
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete  sa prometheus
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete prometheus prometheus
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl delete -f bundle.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;éƒ¨ç½²å®˜æ–¹çš„-prometheus-operator&#34;&gt;éƒ¨ç½²å®˜æ–¹çš„ prometheus-operator&lt;/h2&gt;
&lt;h3 id=&#34;åˆ†ç±»æ–‡ä»¶&#34;&gt;åˆ†ç±»æ–‡ä»¶&lt;/h3&gt;
&lt;p&gt;å®˜æ–¹æŠŠæ‰€æœ‰æ–‡ä»¶éƒ½æ”¾åœ¨ä¸€èµ·ï¼Œè¿™é‡Œæˆ‘åˆ†ç±»ä¸‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; contrib/kube-prometheus/manifests/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mkdir -p operator node-exporter alertmanager grafana kube-state-metrics prometheus serviceMonitor adapter
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mv *-serviceMonitor* serviceMonitor/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mv 0prometheus-operator* operator/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mv grafana-* grafana/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mv kube-state-metrics-* kube-state-metrics/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mv alertmanager-* alertmanager/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mv node-exporter-* node-exporter/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mv prometheus-adapter* adapter/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mv prometheus-* prometheus/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ll
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;total &lt;span class=&#34;m&#34;&gt;40&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;drwxr-xr-x &lt;span class=&#34;m&#34;&gt;9&lt;/span&gt; root root &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt; Jan  &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; 14:19 ./
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;drwxr-xr-x &lt;span class=&#34;m&#34;&gt;9&lt;/span&gt; root root &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt; Jan  &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; 14:15 ../
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-rw-r--r-- &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root   &lt;span class=&#34;m&#34;&gt;60&lt;/span&gt; Jan  &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; 14:15 00namespace-namespace.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;drwxr-xr-x &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; root root &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt; Jan  &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; 14:19 adapter/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;drwxr-xr-x &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; root root &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt; Jan  &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; 14:19 alertmanager/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;drwxr-xr-x &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; root root &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt; Jan  &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; 14:17 grafana/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;drwxr-xr-x &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; root root &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt; Jan  &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; 14:17 kube-state-metrics/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;drwxr-xr-x &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; root root &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt; Jan  &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; 14:18 node-exporter/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;drwxr-xr-x &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; root root &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt; Jan  &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; 14:17 operator/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;drwxr-xr-x &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; root root &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt; Jan  &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; 14:19 prometheus/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;drwxr-xr-x &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; root root &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt; Jan  &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; 14:17 serviceMonitor/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;éƒ¨ç½²-operator&#34;&gt;éƒ¨ç½² operator&lt;/h3&gt;
&lt;p&gt;å…ˆåˆ›å»º ns å’Œ operatorï¼Œquay.io ä»“åº“æ‹‰å–æ…¢ï¼Œå¯ä»¥ä½¿ç”¨æˆ‘è„šæœ¬æ‹‰å–ï¼Œå…¶ä»–é•œåƒä¹Ÿå¯ä»¥è¿™æ ·å»æ‹‰ï¼Œä¸è¿‡åœ¨ apply ä¹‹å‰æ‰èƒ½æ‹‰ï¼Œä¸€æ—¦è¢« docker æ¥æ‰‹æ‹‰å–å°±åªèƒ½æ¼«é•¿ç­‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f .
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -s https://zhangguanzhang.github.io/bash/pull.sh &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; bash -s -- quay.io/coreos/prometheus-operator:v0.26.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f operator/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¡®è®¤çŠ¶æ€è¿è¡Œæ­£å¸¸å†å¾€åæ‰§è¡Œï¼Œè¿™é‡Œé•œåƒæ˜¯ quay.io ä»“åº“çš„å¯èƒ½ä¼šå¾ˆæ…¢è€å¿ƒç­‰å¾…æˆ–è€…è‡ªè¡Œä¿®æ”¹æˆèƒ½æ‹‰å–åˆ°çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n monitoring get pod
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                                   READY     STATUS    RESTARTS   AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;prometheus-operator-56954c76b5-qm9ww   1/1       Running   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;          24s
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;éƒ¨ç½²æ•´å¥—-crd&#34;&gt;éƒ¨ç½²æ•´å¥— CRD&lt;/h3&gt;
&lt;p&gt;åˆ›å»ºç›¸å…³çš„ CRDï¼Œè¿™é‡Œé•œåƒå¯èƒ½ä¹Ÿè¦å¾ˆä¹…ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f adapter/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f alertmanager/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f node-exporter/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f kube-state-metrics/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f grafana/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f prometheus/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl apply -f serviceMonitor/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥é€šè¿‡ get æŸ¥çœ‹æ•´ä½“çŠ¶æ€ï¼Œè¿™é‡Œé•œåƒåŸå› ä¼šç­‰å¾…å¾ˆä¹…ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå¾€åçœ‹å‡ ä¸ªå‘çš„åœ°æ–¹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n monitoring get all
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å¸¸è§å‘çš„è¯´æ˜å’Œè§£å†³æ–¹æ³•&#34;&gt;å¸¸è§å‘çš„è¯´æ˜å’Œè§£å†³æ–¹æ³•&lt;/h3&gt;
&lt;h4 id=&#34;å‘ä¸€&#34;&gt;å‘ä¸€&lt;/h4&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/prometheus-operator-manual/006tNc79ly1fyzbmiknc2j30vc07n0u2_hu4355248440113621886.webp 400w,
               /blog/prometheus-operator-manual/006tNc79ly1fyzbmiknc2j30vc07n0u2_hu15954350200348280263.webp 760w,
               /blog/prometheus-operator-manual/006tNc79ly1fyzbmiknc2j30vc07n0u2_hu6685703617968408718.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/prometheus-operator-manual/006tNc79ly1fyzbmiknc2j30vc07n0u2_hu4355248440113621886.webp&#34;
               width=&#34;760&#34;
               height=&#34;185&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;

è¿™é‡Œè¦æ³¨æ„æœ‰ä¸€ä¸ªå‘ï¼ŒäºŒè¿›åˆ¶éƒ¨ç½² k8s ç®¡ç†ç»„ä»¶å’Œæ–°ç‰ˆæœ¬ kubeadm éƒ¨ç½²çš„éƒ½ä¼šå‘ç°åœ¨ prometheus server çš„é¡µé¢ä¸Šå‘ç°&lt;code&gt;kube-controller&lt;/code&gt;å’Œ&lt;code&gt;kube-schedule&lt;/code&gt;çš„targetä¸º0/0ä¹Ÿå°±æ˜¯ä¸Šå›¾æ‰€ç¤ºã€‚è¿™æ˜¯å› ä¸ºserviceMonitoræ˜¯æ ¹æ®labelå»é€‰å–svcçš„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯¹åº”çš„&lt;code&gt;serviceMonitor&lt;/code&gt;æ˜¯é€‰å–çš„ ns èŒƒå›´æ˜¯&lt;code&gt;kube-system&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ grep -2 selector serviceMonitor/prometheus-serviceMonitorKube*
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;serviceMonitor/prometheus-serviceMonitorKubeControllerManager.yaml-    matchNames:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;serviceMonitor/prometheus-serviceMonitorKubeControllerManager.yaml-    - kube-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;serviceMonitor/prometheus-serviceMonitorKubeControllerManager.yaml:  selector:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;serviceMonitor/prometheus-serviceMonitorKubeControllerManager.yaml-    matchLabels:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;serviceMonitor/prometheus-serviceMonitorKubeControllerManager.yaml-      k8s-app: kube-controller-manager
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;serviceMonitor/prometheus-serviceMonitorKubelet.yaml-    matchNames:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;serviceMonitor/prometheus-serviceMonitorKubelet.yaml-    - kube-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;serviceMonitor/prometheus-serviceMonitorKubelet.yaml:  selector:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;serviceMonitor/prometheus-serviceMonitorKubelet.yaml-    matchLabels:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;serviceMonitor/prometheus-serviceMonitorKubelet.yaml-      k8s-app: kubelet
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;serviceMonitor/prometheus-serviceMonitorKubeScheduler.yaml-    matchNames:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;serviceMonitor/prometheus-serviceMonitorKubeScheduler.yaml-    - kube-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;serviceMonitor/prometheus-serviceMonitorKubeScheduler.yaml:  selector:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;serviceMonitor/prometheus-serviceMonitorKubeScheduler.yaml-    matchLabels:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;serviceMonitor/prometheus-serviceMonitorKubeScheduler.yaml-      k8s-app: kube-scheduler
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è€Œ kube-system é‡Œé»˜è®¤åªæœ‰è¿™ä¿© svcï¼Œä¸”æ²¡æœ‰ç¬¦åˆä¸Šé¢çš„ labelã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl -n kube-system get svc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                      TYPE        CLUSTER-IP   EXTERNAL-IP   PORT&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;S&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;         AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kube-dns                  ClusterIP   10.96.0.10   &amp;lt;none&amp;gt;        53/UDPï¼Œ53/TCP   139m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubelet                   ClusterIP   None         &amp;lt;none&amp;gt;        10250/TCP       103m
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½†æ˜¯å´æœ‰å¯¹åº”çš„ ep(æ²¡æœ‰å¸¦ä»»ä½• label) è¢«åˆ›å»ºï¼Œè¿™ç‚¹æƒ³ä¸é€šå®˜æ–¹ä»€ä¹ˆé¬¼æ“ä½œï¼Œå¦å¤–è¿™é‡Œæ²¡æœ‰ kubelet çš„ epï¼Œæˆ‘åšå®¢éƒ¨ç½²çš„äºŒè¿›åˆ¶çš„è¯ä¼šæœ‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ kubectl get ep -n kube-system
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NAME                      ENDPOINTS                                                AGE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kube-controller-manager   &amp;lt;none&amp;gt;                                                   139m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kube-dns                  10.244.1.2:53ï¼Œ10.244.8.10:53ï¼Œ10.244.1.2:53 + &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; more...   139m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kube-scheduler            &amp;lt;none&amp;gt;                                                   139m
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;è§£å†³åŠæ³•&#34;&gt;è§£å†³åŠæ³•&lt;/h4&gt;
&lt;p&gt;æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªç®¡ç†ç»„å»ºçš„ svcï¼Œåå­—æ— æ‰€è°“ï¼Œå…³é”®æ˜¯ svc çš„ label è¦èƒ½è¢« servicemonitor é€‰ä¸­ï¼Œsvc çš„é€‰æ‹©å™¨çš„ label æ˜¯å› ä¸º kubeadm çš„ staticPod çš„ label æ˜¯è¿™æ ·ï¼Œå¦‚æœæ˜¯äºŒè¿›åˆ¶éƒ¨ç½²çš„è¿™ä¿© svc çš„ selector éƒ¨åˆ†ä¸èƒ½è¦ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kube-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kube-controller-manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;k8s-app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kube-controller-manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;component&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kube-controller-manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterIP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusterIP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;None&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http-metrics&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10252&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10252&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kube-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kube-scheduler&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;k8s-app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kube-scheduler&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;component&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kube-scheduler&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ClusterIP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;clusterIP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;None&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http-metrics&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10251&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10251&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;äºŒè¿›åˆ¶çš„è¯éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å¡«å…¥ svc å¯¹åº”çš„ ep çš„å±æ€§ï¼Œæˆ‘é›†ç¾¤æ˜¯ HA çš„ï¼Œæ‰€æœ‰æœ‰ä¸‰ä¸ªï¼Œä»…ä¾›å‚è€ƒï¼Œåˆ«å‚»å‚»å¾—ç…§æŠ„ï¼Œå¦å¤–è¿™ä¸ª ep çš„åå­—å¾—å’Œä¸Šé¢çš„ svc çš„åå­—å’Œå±æ€§å¯¹åº”ä¸Šï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Endpoints&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;k8s-app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kube-controller-manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kube-controller-manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kube-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subsets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;addresses&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;172.16.0.2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;172.16.0.7&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;172.16.0.8&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http-metrics&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10252&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Endpoints&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;k8s-app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kube-scheduler&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kube-scheduler&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kube-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subsets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;addresses&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;172.16.0.2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;172.16.0.7&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;172.16.0.8&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http-metrics&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10251&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œä¸çŸ¥é“ä¸ºå•¥ kubeadm éƒ¨ç½²çš„æ²¡æœ‰ kubelet è¿™ä¸ª epï¼Œæˆ‘åšå®¢äºŒè¿›åˆ¶éƒ¨ç½²åæ˜¯ä¼šæœ‰ kubelet è¿™ä¸ª ep çš„ (å¥½åƒ metrics server åˆ›å»ºçš„)ï¼Œä¸‹é¢ä»…ä¾›å‚è€ƒï¼ŒIP æ ¹æ®å®é™…å†™ã€‚å¦å¤– kubeadm éƒ¨ç½²ä¸‹ kubelet çš„ readonly çš„ metrics ç«¯å£ (é»˜è®¤æ˜¯ 10255) ä¸ä¼šå¼€æ”¾å¯ä»¥åˆ æ‰ ep çš„é‚£éƒ¨åˆ† portï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Endpoints&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;k8s-app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubelet&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kubelet&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;kube-system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;subsets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;addresses&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;172.16.0.14&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;k8s-n2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;172.16.0.18&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;k8s-n3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;172.16.0.2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;k8s-m1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;172.16.0.20&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;k8s-n4&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;172.16.0.21&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetRef&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Node&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;k8s-n5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;http-metrics&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10255&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;cadvisor&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4194&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;https-metrics&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;10250&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è‡³äº prometheus server çš„æœåŠ¡è®¿é—®ï¼Œåˆ«å†ç”¨æ•ˆç‡ä¸è¡Œçš„&lt;code&gt;NodePort&lt;/code&gt;äº†ï¼Œä¸Š ingress controller å§ï¼Œæ€ä¹ˆéƒ¨ç½²å‚ç…§æˆ‘åšå®¢&lt;a href=&#34;https://zhangguanzhang.github.io/2018/10/06/IngressController/&#34;&gt;IngressController&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Ingress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;prometheus-ing&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;monitoring&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;prometheus.monitoring.k8s.local&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;prometheus-k8s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servicePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9090&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Ingress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grafana-ing&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;monitoring&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grafana.monitoring.k8s.local&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;grafana&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servicePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;---&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;extensions/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Ingress&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;alertmanager-ing&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;namespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;monitoring&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;rules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;alertmanager.monitoring.k8s.local&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;backend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;serviceName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;alertmanager-main&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;servicePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;9093&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;å‘äºŒ&#34;&gt;å‘äºŒ&lt;/h4&gt;
&lt;p&gt;è®¿é—® prometheus server çš„ web é¡µé¢æˆ‘ä»¬å‘ç°å³ä½¿åˆ›å»ºäº† svc å’Œæ³¨å…¥å¯¹åº” ep çš„ä¿¡æ¯åœ¨ target é¡µé¢å‘ç° prometheus server è¯·æ±‚è¢«æ‹’ç»ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/prometheus-operator-manual/006tNc79ly1fyzbmvpd9bj31g80jndlf_hu7082993142891469894.webp 400w,
               /blog/prometheus-operator-manual/006tNc79ly1fyzbmvpd9bj31g80jndlf_hu17625105777074670252.webp 760w,
               /blog/prometheus-operator-manual/006tNc79ly1fyzbmvpd9bj31g80jndlf_hu5961687330227535844.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/prometheus-operator-manual/006tNc79ly1fyzbmvpd9bj31g80jndlf_hu7082993142891469894.webp&#34;
               width=&#34;760&#34;
               height=&#34;286&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨å®¿ä¸»æœºä¸Šæˆ‘ä»¬å‘ç° 127.0.0.1 æ‰èƒ½è®¿é—®ï¼Œç½‘å¡ ip ä¸èƒ½è®¿é—® (è¿™é‡Œæ˜¯å¦ä¸€ä¸ªç¯å¢ƒæ‰¾çš„ï¼Œæ‰€ä»¥ ip æ˜¯ 192 ä¸æ˜¯å‰é¢çš„ 172)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ hostname -i
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;192.168.15.223
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl -I http://192.168.15.223:10251/metrics
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl: &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;7&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; Failed connect to 192.168.15.223:10251&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; Connection refused
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl -I http://127.0.0.1:10251/metrics
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Content-Length: &lt;span class=&#34;m&#34;&gt;30349&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Content-Type: text/plain&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0.0.4
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Date: Monï¼Œ &lt;span class=&#34;m&#34;&gt;07&lt;/span&gt; Jan &lt;span class=&#34;m&#34;&gt;2019&lt;/span&gt; 13:33:50 GMT
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;è§£å†³åŠæ³•-1&#34;&gt;è§£å†³åŠæ³•&lt;/h4&gt;
&lt;p&gt;ä¿®æ”¹ç®¡ç†ç»„ä»¶ bind çš„ ipã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½¿ç”¨ kubeadm å¯åŠ¨çš„é›†ç¾¤ï¼Œåˆå§‹åŒ–æ—¶çš„ config.yml é‡Œå¯ä»¥åŠ å…¥å¦‚ä¸‹å‚æ•°&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;controllerManagerExtraArgs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0.0.0.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;schedulerExtraArgs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0.0.0.0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å·²ç»å¯åŠ¨åçš„ä½¿ç”¨ä¸‹é¢å‘½ä»¤æ›´æ”¹å°±ä¼šæ»šåŠ¨æ›´æ–°&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sed -ri &lt;span class=&#34;s1&#34;&gt;&amp;#39;/--address/s#=.+#=0.0.0.0#&amp;#39;&lt;/span&gt; /etc/kubernetes/manifests/kube-*
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;äºŒè¿›åˆ¶çš„è¯æŸ¥çœ‹æ˜¯ä¸æ˜¯ bind çš„ 0.0.0.0 å¦‚æœä¸æ˜¯å°±ä¿®æ”¹æˆ 0.0.0.0ï¼Œå¤šå—ç½‘å¡å¦‚æœåªæƒ³ bind ä¸€ä¸ªç½‘å¡å°±å†™å¯¹åº”çš„ä¸»æœºä¸Šçš„ç½‘å¡ ipï¼Œå†™ 0.0.0.0 å°±ä¼šç›‘å¬æ‰€æœ‰ç½‘å¡çš„å¯¹åº”ç«¯å£ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è®¿é—®ç›¸å…³é¡µé¢&#34;&gt;è®¿é—®ç›¸å…³é¡µé¢&lt;/h3&gt;
&lt;p&gt;é€šè¿‡æµè§ˆå™¨æŸ¥çœ‹&lt;code&gt;prometheus.monitoring.k8s.local&lt;/code&gt;ä¸&lt;code&gt;grafana.monitoring.k8s.local&lt;/code&gt;æ˜¯å¦æ­£å¸¸ï¼Œè‹¥æ²’é—®é¢˜å°±å¯ä»¥çœ‹åˆ°ä¸‹å›¾ç»“æœï¼Œgrafana åˆå§‹ç”¨æˆ·åå’Œå¯†ç æ˜¯ adminã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/prometheus-operator-manual/006tNc79ly1fyzbnfx054j31l40u0qaw_hu8380561366759451124.webp 400w,
               /blog/prometheus-operator-manual/006tNc79ly1fyzbnfx054j31l40u0qaw_hu1452398025431796659.webp 760w,
               /blog/prometheus-operator-manual/006tNc79ly1fyzbnfx054j31l40u0qaw_hu16039651943181719093.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/prometheus-operator-manual/006tNc79ly1fyzbnfx054j31l40u0qaw_hu8380561366759451124.webp&#34;
               width=&#34;760&#34;
               height=&#34;399&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/prometheus-operator-manual/006tNc79ly1fyzbnrpze3j31hc0q2dke_hu6147963592088323209.webp 400w,
               /blog/prometheus-operator-manual/006tNc79ly1fyzbnrpze3j31hc0q2dke_hu14614537817524132732.webp 760w,
               /blog/prometheus-operator-manual/006tNc79ly1fyzbnrpze3j31hc0q2dke_hu8347411528937026650.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/prometheus-operator-manual/006tNc79ly1fyzbnrpze3j31hc0q2dke_hu6147963592088323209.webp&#34;
               width=&#34;760&#34;
               height=&#34;372&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;æœ€å&#34;&gt;æœ€å&lt;/h2&gt;
&lt;p&gt;å¯ä»¥å¤šçœ‹çœ‹å®˜æ–¹å†™çš„ yamlï¼Œé‡Œé¢æœ‰æ›´å¤šçš„å­—æ®µæ²¡ä»‹ç»å¯ä»¥çœ‹ yaml æ¥äº†è§£ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒæ–‡æ¡£&#34;&gt;å‚è€ƒæ–‡æ¡£&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/coreos/prometheus-operator/tree/master/Documentation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/coreos/prometheus-operator/tree/master/Documentation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/coreos/prometheus-operator/tree/master/contrib/kube-prometheus&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/coreos/prometheus-operator/tree/master/contrib/kube-prometheus&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://coreos.com/operators/prometheus/docs/latest/user-guides/getting-started.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://coreos.com/operators/prometheus/docs/latest/user-guides/getting-started.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes èµ„æºç®¡ç†æ¦‚è¿°</title>
      <link>https://cloudnativecn.com/blog/kubernetes-resource-management/</link>
      <pubDate>Thu, 20 Dec 2018 15:14:54 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/kubernetes-resource-management/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡è½¬è½½è‡ª&lt;a href=&#34;http://cizixs.com/2018/06/25/kubernetes-resource-management/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å´ä¼Ÿçš„åšå®¢&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;kubernetes-èµ„æºç®€ä»‹&#34;&gt;kubernetes èµ„æºç®€ä»‹&lt;/h2&gt;
&lt;h3 id=&#34;ä»€ä¹ˆæ˜¯èµ„æº&#34;&gt;ä»€ä¹ˆæ˜¯èµ„æºï¼Ÿ&lt;/h3&gt;
&lt;p&gt;åœ¨ kubernetes ä¸­ï¼Œæœ‰ä¸¤ä¸ªåŸºç¡€ä½†æ˜¯éå¸¸é‡è¦çš„æ¦‚å¿µï¼šnode å’Œ podã€‚node ç¿»è¯‘æˆèŠ‚ç‚¹ï¼Œæ˜¯å¯¹é›†ç¾¤èµ„æºçš„æŠ½è±¡ï¼›pod æ˜¯å¯¹å®¹å™¨çš„å°è£…ï¼Œæ˜¯åº”ç”¨è¿è¡Œçš„å®ä½“ã€‚node æä¾›èµ„æºï¼Œè€Œ pod ä½¿ç”¨èµ„æºï¼Œè¿™é‡Œçš„èµ„æºåˆ†ä¸ºè®¡ç®—ï¼ˆcpuã€memoryã€gpuï¼‰ã€å­˜å‚¨ï¼ˆdiskã€ssdï¼‰ã€ç½‘ç»œï¼ˆnetwork bandwidthã€ipã€portsï¼‰ã€‚è¿™äº›èµ„æºæä¾›äº†åº”ç”¨è¿è¡Œçš„åŸºç¡€ï¼Œæ­£ç¡®ç†è§£è¿™äº›èµ„æºä»¥åŠé›†ç¾¤è°ƒåº¦å¦‚ä½•ä½¿ç”¨è¿™äº›èµ„æºï¼Œå¯¹äºå¤§è§„æ¨¡çš„ kubernetes é›†ç¾¤æ¥è¯´è‡³å…³é‡è¦ï¼Œä¸ä»…èƒ½ä¿è¯åº”ç”¨çš„ç¨³å®šæ€§ï¼Œä¹Ÿå¯ä»¥æé«˜èµ„æºçš„åˆ©ç”¨ç‡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬ä¸»è¦ä»‹ç» CPU å’Œå†…å­˜è¿™ä¸¤ä¸ªé‡è¦çš„èµ„æºï¼Œå®ƒä»¬è™½ç„¶éƒ½å±äºè®¡ç®—èµ„æºï¼Œä½†ä¹Ÿæœ‰æ‰€å·®è·ã€‚CPU å¯åˆ†é…çš„æ˜¯ä½¿ç”¨æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯æ“ä½œç³»ç»Ÿç®¡ç†çš„æ—¶é—´ç‰‡ï¼Œæ¯ä¸ªè¿›ç¨‹åœ¨ä¸€å®šçš„æ—¶é—´ç‰‡é‡Œè¿è¡Œè‡ªå·±çš„ä»»åŠ¡ï¼ˆå¦å¤–ä¸€ç§æ–¹å¼æ˜¯ç»‘æ ¸ï¼Œä¹Ÿå°±æ˜¯æŠŠ CPU å®Œå…¨åˆ†é…ç»™æŸä¸ª pod ä½¿ç”¨ï¼Œä½†è¿™ç§æ–¹å¼ä¸å¤Ÿçµæ´»ä¼šé€ æˆä¸¥é‡çš„èµ„æºæµªè´¹ï¼Œkubernetes ä¸­å¹¶æ²¡æœ‰æä¾›ï¼‰ï¼›è€Œå¯¹äºå†…å­˜ï¼Œç³»ç»Ÿæä¾›çš„æ˜¯å†…å­˜å¤§å°ã€‚&lt;/p&gt;
&lt;p&gt;CPU çš„ä½¿ç”¨æ—¶é—´æ˜¯å¯å‹ç¼©çš„ï¼Œæ¢å¥è¯è¯´å®ƒæœ¬èº«æ— çŠ¶æ€ï¼Œç”³è¯·èµ„æºå¾ˆå¿«ï¼Œä¹Ÿèƒ½å¿«é€Ÿæ­£å¸¸å›æ”¶ï¼›è€Œå†…å­˜å¤§å°æ˜¯ä¸å¯å‹ç¼©çš„ï¼Œå› ä¸ºå®ƒæ˜¯æœ‰çŠ¶æ€çš„ï¼ˆå†…å­˜é‡Œé¢ä¿å­˜çš„æ•°æ®ï¼‰ï¼Œç”³è¯·èµ„æºå¾ˆæ…¢ï¼ˆéœ€è¦è®¡ç®—å’Œåˆ†é…å†…å­˜å—çš„ç©ºé—´ï¼‰ï¼Œå¹¶ä¸”å›æ”¶å¯èƒ½å¤±è´¥ï¼ˆè¢«å ç”¨çš„å†…å­˜ä¸€èˆ¬ä¸å¯å›æ”¶ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æŠŠèµ„æºåˆ†æˆ&lt;strong&gt;å¯å‹ç¼©&lt;/strong&gt;å’Œ&lt;strong&gt;ä¸å¯å‹ç¼©&lt;/strong&gt;ï¼Œæ˜¯å› ä¸ºåœ¨èµ„æºä¸è¶³çš„æ—¶å€™ï¼Œå®ƒä»¬çš„è¡¨ç°å¾ˆä¸ä¸€æ ·ã€‚å¯¹äºä¸å¯å‹ç¼©èµ„æºï¼Œå¦‚æœèµ„æºä¸è¶³ï¼Œä¹Ÿå°±æ— æ³•ç»§ç»­ç”³è¯·èµ„æºï¼ˆå†…å­˜ç”¨å®Œå°±æ˜¯ç”¨å®Œäº†ï¼‰ï¼Œå¹¶ä¸”ä¼šå¯¼è‡´ pod çš„è¿è¡Œäº§ç”Ÿæ— æ³•é¢„æµ‹çš„é”™è¯¯ï¼ˆåº”ç”¨ç”³è¯·å†…å­˜å¤±è´¥ä¼šå¯¼è‡´ä¸€ç³»åˆ—é—®é¢˜ï¼‰ï¼›è€Œå¯¹äºå¯å‹ç¼©èµ„æºï¼Œæ¯”å¦‚ CPU æ—¶é—´ç‰‡ï¼Œå³ä½¿ pod ä½¿ç”¨çš„ CPU èµ„æºå¾ˆå¤šï¼ŒCPU ä½¿ç”¨ä¹Ÿå¯ä»¥æŒ‰ç…§æƒé‡åˆ†é…ç»™æ‰€æœ‰ pod ä½¿ç”¨ï¼Œè™½ç„¶æ¯ä¸ªäººä½¿ç”¨çš„æ—¶é—´ç‰‡å‡å°‘ï¼Œä½†ä¸ä¼šå½±å“ç¨‹åºçš„é€»è¾‘ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ kubernetes é›†ç¾¤ç®¡ç†ä¸­ï¼Œæœ‰ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„åŠŸèƒ½ï¼šå°±æ˜¯ä¸º pod é€‰æ‹©ä¸€ä¸ªä¸»æœºè¿è¡Œã€‚è°ƒåº¦å¿…é¡»æ»¡è¶³ä¸€å®šçš„æ¡ä»¶ï¼Œå…¶ä¸­æœ€åŸºæœ¬çš„æ˜¯ä¸»æœºä¸Šè¦æœ‰è¶³å¤Ÿçš„èµ„æºç»™ pod ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/kubernetes-resource-management/006tNbRwly1fyda0hogqpj30d20fwq42_hu13978280648640939775.webp 400w,
               /blog/kubernetes-resource-management/006tNbRwly1fyda0hogqpj30d20fwq42_hu15751727116812502314.webp 760w,
               /blog/kubernetes-resource-management/006tNbRwly1fyda0hogqpj30d20fwq42_hu1858375298772853490.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-resource-management/006tNbRwly1fyda0hogqpj30d20fwq42_hu13978280648640939775.webp&#34;
               width=&#34;470&#34;
               height=&#34;572&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;èµ„æºé™¤äº†å’Œè°ƒåº¦ç›¸å…³ä¹‹å¤–ï¼Œè¿˜å’Œå¾ˆå¤šäº‹æƒ…ç´§å¯†ç›¸è¿ï¼Œè¿™æ­£æ˜¯è¿™ç¯‡æ–‡ç« è¦è§£é‡Šçš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;kubernetes-èµ„æºçš„è¡¨ç¤º&#34;&gt;kubernetes èµ„æºçš„è¡¨ç¤º&lt;/h3&gt;
&lt;p&gt;ç”¨æˆ·åœ¨ pod ä¸­å¯ä»¥é…ç½®è¦ä½¿ç”¨çš„èµ„æºæ€»é‡ï¼Œkubernetes æ ¹æ®é…ç½®çš„èµ„æºæ•°è¿›è¡Œè°ƒåº¦å’Œè¿è¡Œã€‚ç›®å‰ä¸»è¦å¯ä»¥é…ç½®çš„èµ„æºæ˜¯ CPU å’Œ memoryï¼Œå¯¹åº”çš„é…ç½®å­—æ®µæ˜¯ &lt;code&gt;spec.containers[].resource.limits/request.cpu/memory&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”¨æˆ·æ˜¯å¯¹æ¯ä¸ªå®¹å™¨é…ç½® request å€¼ï¼Œæ‰€æœ‰å®¹å™¨çš„èµ„æºè¯·æ±‚ä¹‹å’Œå°±æ˜¯ pod çš„èµ„æºè¯·æ±‚æ€»é‡ï¼Œè€Œæˆ‘ä»¬ä¸€èˆ¬ä¼šè¯´ pod çš„èµ„æºè¯·æ±‚å’Œ limitsã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;limits&lt;/code&gt; å’Œ &lt;code&gt;requests&lt;/code&gt; çš„åŒºåˆ«æˆ‘ä»¬ä¸‹é¢ä¼šæåˆ°ï¼Œè¿™é‡Œå…ˆè¯´è¯´æ¯”è¾ƒå®¹æ˜“ç†è§£çš„ cpu å’Œ memoryã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;CPU&lt;/code&gt; ä¸€èˆ¬ç”¨æ ¸æ•°æ¥æ ‡è¯†ï¼Œä¸€æ ¸ CPU ç›¸å¯¹äºç‰©ç†æœåŠ¡å™¨çš„ä¸€ä¸ªè¶…çº¿ç¨‹æ ¸ï¼Œä¹Ÿå°±æ˜¯æ“ä½œç³»ç»Ÿ &lt;code&gt;/proc/cpuinfo&lt;/code&gt; ä¸­åˆ—å‡ºæ¥çš„æ ¸æ•°ã€‚å› ä¸ºå¯¹èµ„æºè¿›è¡Œäº†æ± åŒ–å’Œè™šæ‹ŸåŒ–ï¼Œå› æ­¤ kubernetes å…è®¸é…ç½®éæ•´æ•°ä¸ªçš„æ ¸æ•°ï¼Œæ¯”å¦‚ &lt;code&gt;0.5&lt;/code&gt; æ˜¯åˆæ³•çš„ï¼Œå®ƒæ ‡è¯†åº”ç”¨å¯ä»¥ä½¿ç”¨åŠä¸ª CPU æ ¸çš„è®¡ç®—é‡ã€‚CPU çš„è¯·æ±‚æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯åˆšæåˆ°çš„ &lt;code&gt;0.5&lt;/code&gt;ï¼Œ&lt;code&gt;1&lt;/code&gt; è¿™ç§ç›´æ¥ç”¨æ•°å­—æ ‡è¯† CPU æ ¸å¿ƒæ•°ï¼›å¦å¤–ä¸€ç§è¡¨ç¤ºæ˜¯ &lt;code&gt;500m&lt;/code&gt;ï¼Œå®ƒç­‰ä»·äº &lt;code&gt;0.5&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯è¯´ &lt;code&gt;1 Core = 1000m&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å†…å­˜æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œæ˜¯é€šè¿‡å­—èŠ‚å¤§å°æŒ‡å®šçš„ã€‚å¦‚æœç›´æ¥ä¸€ä¸ªæ•°å­—ï¼Œåé¢æ²¡æœ‰ä»»ä½•å•ä½ï¼Œè¡¨ç¤ºè¿™ä¹ˆå¤šå­—èŠ‚çš„å†…å­˜ï¼›æ•°å­—åé¢è¿˜å¯ä»¥è·Ÿç€å•ä½ï¼Œæ”¯æŒçš„å•ä½æœ‰ &lt;code&gt;E&lt;/code&gt;ã€&lt;code&gt;P&lt;/code&gt;ã€&lt;code&gt;T&lt;/code&gt;ã€&lt;code&gt;G&lt;/code&gt;ã€&lt;code&gt;M&lt;/code&gt;ã€&lt;code&gt;K&lt;/code&gt;ï¼Œå‰è€…åˆ†åˆ«æ˜¯åè€…çš„ &lt;code&gt;1000&lt;/code&gt; å€å¤§å°çš„å…³ç³»ï¼Œæ­¤å¤–è¿˜æ”¯æŒ &lt;code&gt;Ei&lt;/code&gt;ã€&lt;code&gt;Pi&lt;/code&gt;ã€&lt;code&gt;Ti&lt;/code&gt;ã€&lt;code&gt;Gi&lt;/code&gt;ã€&lt;code&gt;Mi&lt;/code&gt;ã€&lt;code&gt;Ki&lt;/code&gt;ï¼Œå…¶å¯¹åº”çš„å€æ•°å…³ç³»æ˜¯ &lt;code&gt;2^10 = 1024&lt;/code&gt;ã€‚æ¯”å¦‚è¦ä½¿ç”¨ 100M å†…å­˜çš„è¯ï¼Œç›´æ¥å†™æˆ &lt;code&gt;100Mi&lt;/code&gt;å³å¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;èŠ‚ç‚¹å¯ç”¨èµ„æº&#34;&gt;èŠ‚ç‚¹å¯ç”¨èµ„æº&lt;/h3&gt;
&lt;p&gt;ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›èŠ‚ç‚¹ä¸Šæ‰€æœ‰çš„èµ„æºéƒ½å¯ä»¥åˆ†é…ç»™ pod ä½¿ç”¨ï¼Œä½†å®é™…ä¸ŠèŠ‚ç‚¹ä¸Šé™¤äº†è¿è¡Œ pods ä¹‹å¤–ï¼Œè¿˜ä¼šè¿è¡Œå…¶ä»–çš„å¾ˆå¤šè¿›ç¨‹ï¼šç³»ç»Ÿç›¸å…³çš„è¿›ç¨‹ï¼ˆæ¯”å¦‚ sshdã€udev ç­‰ï¼‰ï¼Œä»¥åŠ kubernetes é›†ç¾¤çš„ç»„ä»¶ï¼ˆkubeletã€docker ç­‰ï¼‰ã€‚æˆ‘ä»¬åœ¨åˆ†é…èµ„æºçš„æ—¶å€™ï¼Œéœ€è¦ç»™è¿™äº›è¿›ç¨‹é¢„ç•™ä¸€äº›èµ„æºï¼Œå‰©ä¸‹çš„æ‰èƒ½ç»™ pod ä½¿ç”¨ã€‚é¢„ç•™çš„èµ„æºå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‚æ•°æ§åˆ¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;--kube-reserved=[cpu=100m][,][memory=100Mi][,][ephemeral-storage=1Gi]&lt;/code&gt;ï¼šæ§åˆ¶é¢„ç•™ç»™ kubernetes é›†ç¾¤ç»„ä»¶çš„ CPUã€memory å’Œå­˜å‚¨èµ„æº&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--system-reserved=[cpu=100mi][,][memory=100Mi][,][ephemeral-storage=1Gi]&lt;/code&gt;ï¼šé¢„ç•™ç»™ç³»ç»Ÿçš„ CPUã€memory å’Œå­˜å‚¨èµ„æº&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ä¸¤å—é¢„ç•™ä¹‹åçš„èµ„æºæ‰æ˜¯ pod çœŸæ­£èƒ½ä½¿ç”¨çš„ï¼Œä¸è¿‡è€ƒè™‘åˆ° eviction æœºåˆ¶ï¼ˆä¸‹é¢çš„ç« èŠ‚ä¼šæåˆ°ï¼‰ï¼Œkubelet ä¼šä¿è¯èŠ‚ç‚¹ä¸Šçš„èµ„æºä½¿ç”¨ç‡ä¸ä¼šçœŸæ­£åˆ° 100%ï¼Œå› æ­¤ pod çš„å®é™…å¯ä½¿ç”¨èµ„æºä¼šç¨å¾®å†å°‘ä¸€ç‚¹ã€‚ä¸»æœºä¸Šçš„èµ„æºé€»è¾‘åˆ†é…å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-kubernetes-reserved-resource&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://i.loli.net/2018/06/25/5b3106f947190.png&#34; alt=&#34;kubernetes reserved resource&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      kubernetes reserved resource
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;**NOTEï¼š**éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œallocatable ä¸æ˜¯æŒ‡å½“å‰æœºå™¨ä¸Šå¯ä»¥åˆ†é…çš„èµ„æºï¼Œè€Œæ˜¯æŒ‡èƒ½åˆ†é…ç»™ pod ä½¿ç”¨çš„èµ„æºæ€»é‡ï¼Œä¸€æ—¦ kubelet å¯åŠ¨è¿™ä¸ªå€¼æ˜¯ä¸ä¼šå˜åŒ–çš„ã€‚&lt;/p&gt;
&lt;p&gt;allocatable çš„å€¼å¯ä»¥åœ¨ node å¯¹è±¡çš„ &lt;code&gt;status&lt;/code&gt; å­—æ®µä¸­è¯»å–ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ ·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;allocatable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cpu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ephemeral-storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;35730597829&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hugepages-2Mi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;3779348Ki&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;pods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;110&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;capacity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cpu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ephemeral-storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;38770180Ki&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hugepages-2Mi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;3881748Ki&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;pods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;110&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;kubernetes-èµ„æºå¯¹è±¡&#34;&gt;kubernetes èµ„æºå¯¹è±¡&lt;/h2&gt;
&lt;p&gt;åœ¨è¿™éƒ¨åˆ†ï¼Œæˆ‘ä»¬æ¥ä»‹ç» kubernetes ä¸­æä¾›çš„è®©æˆ‘ä»¬ç®¡ç† pod èµ„æºçš„åŸç”Ÿå¯¹è±¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¯·æ±‚requestså’Œä¸Šé™limits&#34;&gt;è¯·æ±‚ï¼ˆrequestsï¼‰å’Œä¸Šé™ï¼ˆlimitsï¼‰&lt;/h3&gt;
&lt;p&gt;å‰é¢è¯´è¿‡ç”¨æˆ·åœ¨åˆ›å»º pod çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®šæ¯ä¸ªå®¹å™¨çš„ Requests å’Œ Limits ä¸¤ä¸ªå­—æ®µï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå®ä¾‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;resources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;requests&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;64Mi&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cpu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;250m&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;limits&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;128Mi&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cpu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;500m&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;Requests&lt;/code&gt; æ˜¯å®¹å™¨è¯·æ±‚è¦ä½¿ç”¨çš„èµ„æºï¼Œkubernetes ä¼šä¿è¯ pod èƒ½ä½¿ç”¨åˆ°è¿™ä¹ˆå¤šçš„èµ„æºã€‚è¯·æ±‚çš„èµ„æºæ˜¯è°ƒåº¦çš„ä¾æ®ï¼Œåªæœ‰å½“èŠ‚ç‚¹ä¸Šçš„å¯ç”¨èµ„æºå¤§äº pod è¯·æ±‚çš„å„ç§èµ„æºæ—¶ï¼Œè°ƒåº¦å™¨æ‰ä¼šæŠŠ pod è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ä¸Šï¼ˆå¦‚æœ CPU èµ„æºè¶³å¤Ÿï¼Œå†…å­˜èµ„æºä¸è¶³ï¼Œè°ƒåº¦å™¨ä¹Ÿä¸ä¼šé€‰æ‹©è¯¥èŠ‚ç‚¹ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè°ƒåº¦å™¨åªå…³å¿ƒèŠ‚ç‚¹ä¸Šå¯åˆ†é…çš„èµ„æºï¼Œä»¥åŠèŠ‚ç‚¹ä¸Šæ‰€æœ‰ pods è¯·æ±‚çš„èµ„æºï¼Œè€Œ&lt;strong&gt;ä¸å…³å¿ƒ&lt;/strong&gt;èŠ‚ç‚¹èµ„æºçš„å®é™…ä½¿ç”¨æƒ…å†µï¼Œæ¢å¥è¯è¯´ï¼Œå¦‚æœèŠ‚ç‚¹ä¸Šçš„ pods ç”³è¯·çš„èµ„æºå·²ç»æŠŠèŠ‚ç‚¹ä¸Šçš„èµ„æºç”¨æ»¡ï¼Œå³ä½¿å®ƒä»¬çš„ä½¿ç”¨ç‡éå¸¸ä½ï¼Œæ¯”å¦‚è¯´ CPU å’Œå†…å­˜ä½¿ç”¨ç‡éƒ½ä½äº 10%ï¼Œè°ƒåº¦å™¨ä¹Ÿä¸ä¼šç»§ç»­è°ƒåº¦ pod ä¸Šå»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Limits&lt;/code&gt; æ˜¯ pod èƒ½ä½¿ç”¨çš„èµ„æºä¸Šé™ï¼Œæ˜¯å®é™…é…ç½®åˆ°å†…æ ¸ cgroups é‡Œé¢çš„é…ç½®æ•°æ®ã€‚å¯¹äºå†…å­˜æ¥è¯´ï¼Œä¼šç›´æ¥è½¬æ¢æˆ &lt;code&gt;docker run&lt;/code&gt; å‘½ä»¤è¡Œçš„ &lt;code&gt;--memory&lt;/code&gt; å¤§å°ï¼Œæœ€ç»ˆä¼šé…ç½®åˆ° cgroups å¯¹åº”ä»»åŠ¡çš„ &lt;code&gt;/sys/fs/cgroup/memory/â€¦â€¦/memory.limit_in_bytes&lt;/code&gt; æ–‡ä»¶ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;NOTE&lt;/strong&gt;ï¼šå¦‚æœ limit æ²¡æœ‰é…ç½®ï¼Œåˆ™è¡¨æ˜æ²¡æœ‰èµ„æºçš„ä¸Šé™ï¼Œåªè¦èŠ‚ç‚¹ä¸Šæœ‰å¯¹åº”çš„èµ„æºï¼Œpod å°±å¯ä»¥ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ requests å’Œ limits æ¦‚å¿µï¼Œæˆ‘ä»¬èƒ½åˆ†é…æ›´å¤šçš„ podï¼Œæå‡æ•´ä½“çš„èµ„æºä½¿ç”¨ç‡ã€‚ä½†æ˜¯è¿™ä¸ªä½“ç³»æœ‰ä¸ªéå¸¸é‡è¦çš„é—®é¢˜éœ€è¦è€ƒè™‘ï¼Œé‚£å°±æ˜¯&lt;strong&gt;æ€ä¹ˆå»å‡†ç¡®åœ°è¯„ä¼° pod çš„èµ„æº requests&lt;/strong&gt;ï¼Ÿå¦‚æœè¯„ä¼°åœ°è¿‡ä½ï¼Œä¼šå¯¼è‡´åº”ç”¨ä¸ç¨³å®šï¼›å¦‚æœè¿‡é«˜ï¼Œåˆ™ä¼šå¯¼è‡´ä½¿ç”¨ç‡é™ä½ã€‚è¿™ä¸ªé—®é¢˜éœ€è¦å¼€å‘è€…å’Œç³»ç»Ÿç®¡ç†å‘˜å…±åŒè®¨è®ºå’Œå®šä¹‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;limit-rangeé»˜è®¤èµ„æºé…ç½®&#34;&gt;limit rangeï¼ˆé»˜è®¤èµ„æºé…ç½®)&lt;/h3&gt;
&lt;p&gt;ä¸ºæ¯ä¸ª pod éƒ½æ‰‹åŠ¨é…ç½®è¿™äº›å‚æ•°æ˜¯æŒºéº»çƒ¦çš„äº‹æƒ…ï¼Œkubernetes æä¾›äº† &lt;code&gt;LimitRange&lt;/code&gt; èµ„æºï¼Œå¯ä»¥è®©æˆ‘ä»¬é…ç½®æŸä¸ª namespace é»˜è®¤çš„ request å’Œ limit å€¼ï¼Œæ¯”å¦‚ä¸‹é¢çš„å®ä¾‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;v1&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;LimitRange&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;you-shall-have-limits&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;limits&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Container&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;max&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cpu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;1Gi&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;min&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cpu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;100m&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;4Mi&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cpu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;500m&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;200Mi&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;defaultRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cpu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;200m&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;100Mi&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœå¯¹åº” namespace åˆ›å»ºçš„ pod æ²¡æœ‰å†™èµ„æºçš„ requests å’Œ limits å­—æ®µï¼Œé‚£ä¹ˆå®ƒä¼šè‡ªåŠ¨æ‹¥æœ‰ä¸‹é¢çš„é…ç½®ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†…å­˜è¯·æ±‚æ˜¯ 100Miï¼Œä¸Šé™æ˜¯ 200Mi&lt;/li&gt;
&lt;li&gt;CPU è¯·æ±‚æ˜¯ 200mï¼Œä¸Šé™æ˜¯ 500m&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“ç„¶ï¼Œå¦‚æœ pod è‡ªå·±é…ç½®äº†å¯¹åº”çš„å‚æ•°ï¼Œkubernetes ä¼šä½¿ç”¨ pod ä¸­çš„é…ç½®ã€‚ä½¿ç”¨ LimitRange èƒ½å¤Ÿè®© namespace ä¸­çš„ pod èµ„æºè§„èŒƒåŒ–ï¼Œä¾¿äºç»Ÿä¸€çš„èµ„æºç®¡ç†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;èµ„æºé…é¢resource-quota&#34;&gt;èµ„æºé…é¢ï¼ˆresource quotaï¼‰&lt;/h3&gt;
&lt;p&gt;å‰é¢è®²åˆ°çš„èµ„æºç®¡ç†å’Œè°ƒåº¦å¯ä»¥è®¤ä¸º kubernetes æŠŠè¿™ä¸ªé›†ç¾¤çš„èµ„æºæ•´åˆèµ·æ¥ï¼Œç»„æˆä¸€ä¸ªèµ„æºæ± ï¼Œæ¯ä¸ªåº”ç”¨ï¼ˆpodï¼‰ä¼šè‡ªåŠ¨ä»æ•´ä¸ªæ± ä¸­åˆ†é…èµ„æºæ¥ä½¿ç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹åªè¦é›†ç¾¤è¿˜æœ‰å¯ç”¨çš„èµ„æºï¼Œåº”ç”¨å°±èƒ½ä½¿ç”¨ï¼Œå¹¶æ²¡æœ‰é™åˆ¶ã€‚kubernetes æœ¬èº«è€ƒè™‘åˆ°äº†å¤šç”¨æˆ·å’Œå¤šç§Ÿæˆ·çš„åœºæ™¯ï¼Œæå‡ºäº† namespace çš„æ¦‚å¿µæ¥å¯¹é›†ç¾¤åšä¸€ä¸ªç®€å•çš„éš”ç¦»ã€‚&lt;/p&gt;
&lt;p&gt;åŸºäº namespaceï¼Œkubernetes è¿˜èƒ½å¤Ÿå¯¹èµ„æºè¿›è¡Œéš”ç¦»å’Œé™åˆ¶ï¼Œè¿™å°±æ˜¯ resource quota çš„æ¦‚å¿µï¼Œç¿»è¯‘æˆèµ„æºé…é¢ï¼Œå®ƒé™åˆ¶äº†æŸä¸ª namespace å¯ä»¥ä½¿ç”¨çš„èµ„æºæ€»é¢åº¦ã€‚è¿™é‡Œçš„èµ„æºåŒ…æ‹¬ cpuã€memory çš„æ€»é‡ï¼Œä¹ŸåŒ…æ‹¬ kubernetes è‡ªèº«å¯¹è±¡ï¼ˆæ¯”å¦‚ podã€services ç­‰ï¼‰çš„æ•°é‡ã€‚é€šè¿‡ resource quotaï¼Œkubernetes å¯ä»¥é˜²æ­¢æŸä¸ª namespace ä¸‹çš„ç”¨æˆ·ä¸åŠ é™åˆ¶åœ°ä½¿ç”¨è¶…è¿‡æœŸæœ›çš„èµ„æºï¼Œæ¯”å¦‚è¯´ä¸å¯¹èµ„æºè¿›è¡Œè¯„ä¼°å°±å¤§é‡ç”³è¯· 16 æ ¸ CPU 32G å†…å­˜çš„ podã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä¸€ä¸ªèµ„æºé…é¢çš„å®ä¾‹ï¼Œå®ƒé™åˆ¶äº† namespace åªèƒ½ä½¿ç”¨ 20 æ ¸ CPU å’Œ 1G å†…å­˜ï¼Œå¹¶ä¸”èƒ½åˆ›å»º 10 ä¸ª podã€20 ä¸ª rcã€5 ä¸ª serviceï¼Œå¯èƒ½é€‚ç”¨äºæŸä¸ªæµ‹è¯•åœºæ™¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;ResourceQuota&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;quota&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;hard&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cpu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;20&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;1Gi&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;pods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;10&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicationcontrollers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;20&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;resourcequotas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;1&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;services&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;5&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;resource quota èƒ½å¤Ÿé…ç½®çš„é€‰é¡¹è¿˜å¾ˆå¤šï¼Œæ¯”å¦‚ GPUã€å­˜å‚¨ã€configmapsã€persistentvolumeclaims ç­‰ç­‰ï¼Œæ›´å¤šä¿¡æ¯å¯ä»¥å‚è€ƒ&lt;a href=&#34;http://cizixs.com/2018/06/25/kubernetes-resource-management/****&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹çš„æ–‡æ¡£&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Resource quota è¦è§£å†³çš„é—®é¢˜å’Œä½¿ç”¨éƒ½ç›¸å¯¹ç‹¬ç«‹å’Œç®€å•ï¼Œä½†æ˜¯å®ƒä¹Ÿæœ‰ä¸€ä¸ªé™åˆ¶ï¼šé‚£å°±æ˜¯å®ƒä¸èƒ½æ ¹æ®é›†ç¾¤èµ„æºåŠ¨æ€ä¼¸ç¼©ã€‚ä¸€æ—¦é…ç½®ä¹‹åï¼Œresource quota å°±ä¸ä¼šæ”¹å˜ï¼Œå³ä½¿é›†ç¾¤å¢åŠ äº†èŠ‚ç‚¹ï¼Œæ•´ä½“èµ„æºå¢å¤šä¹Ÿæ²¡æœ‰ç”¨ã€‚kubernetes ç°åœ¨æ²¡æœ‰è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯ç”¨æˆ·å¯ä»¥é€šè¿‡ç¼–å†™ä¸€ä¸ª controller çš„æ–¹å¼æ¥è‡ªå·±å®ç°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åº”ç”¨ä¼˜å…ˆçº§&#34;&gt;åº”ç”¨ä¼˜å…ˆçº§&lt;/h2&gt;
&lt;h3 id=&#34;qosæœåŠ¡è´¨é‡&#34;&gt;QoSï¼ˆæœåŠ¡è´¨é‡ï¼‰&lt;/h3&gt;
&lt;p&gt;Requests å’Œ limits çš„é…ç½®é™¤äº†è¡¨æ˜èµ„æºæƒ…å†µå’Œé™åˆ¶èµ„æºä½¿ç”¨ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªéšè—çš„ä½œç”¨ï¼šå®ƒå†³å®šäº† pod çš„ QoS ç­‰çº§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šä¸€èŠ‚æˆ‘ä»¬æåˆ°äº†ä¸€ä¸ªç»†èŠ‚ï¼šå¦‚æœ pod æ²¡æœ‰é…ç½® limitsï¼Œé‚£ä¹ˆå®ƒå¯ä»¥ä½¿ç”¨èŠ‚ç‚¹ä¸Šä»»æ„å¤šçš„å¯ç”¨èµ„æºã€‚è¿™ç±» pod èƒ½çµæ´»ä½¿ç”¨èµ„æºï¼Œä½†è¿™ä¹Ÿå¯¼è‡´å®ƒä¸ç¨³å®šä¸”å±é™©ï¼Œå¯¹äºè¿™ç±» pod æˆ‘ä»¬ä¸€å®šè¦åœ¨å®ƒå ç”¨è¿‡å¤šèµ„æºå¯¼è‡´èŠ‚ç‚¹èµ„æºç´§å¼ æ—¶å¤„ç†æ‰ã€‚ä¼˜å…ˆå¤„ç†è¿™ç±» podï¼Œè€Œä¸æ˜¯èµ„æºä½¿ç”¨å¤„äºè‡ªå·±è¯·æ±‚èŒƒå›´å†…çš„ pod æ˜¯éå¸¸åˆç†çš„æƒ³æ³•ï¼Œè€Œè¿™å°±æ˜¯ pod QoS çš„å«ä¹‰ï¼šæ ¹æ® pod çš„èµ„æºè¯·æ±‚æŠŠ pod åˆ†æˆä¸åŒçš„é‡è¦æ€§ç­‰çº§ã€‚&lt;/p&gt;
&lt;p&gt;kubernetes æŠŠ pod åˆ†æˆäº†ä¸‰ä¸ª QoS ç­‰çº§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Guaranteed&lt;/strong&gt;ï¼šä¼˜å…ˆçº§æœ€é«˜ï¼Œå¯ä»¥è€ƒè™‘æ•°æ®åº“åº”ç”¨æˆ–è€…ä¸€äº›é‡è¦çš„ä¸šåŠ¡åº”ç”¨ã€‚é™¤é pods ä½¿ç”¨è¶…è¿‡äº†å®ƒä»¬çš„ limitsï¼Œæˆ–è€…èŠ‚ç‚¹çš„å†…å­˜å‹åŠ›å¾ˆå¤§è€Œä¸”æ²¡æœ‰ QoS æ›´ä½çš„ podï¼Œå¦åˆ™ä¸ä¼šè¢«æ€æ­»&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Burstable&lt;/strong&gt;ï¼šè¿™ç§ç±»å‹çš„ pod å¯ä»¥å¤šäºè‡ªå·±è¯·æ±‚çš„èµ„æºï¼ˆä¸Šé™æœ‰ limit æŒ‡å®šï¼Œå¦‚æœ limit æ²¡æœ‰é…ç½®ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä¸»æœºçš„ä»»æ„å¯ç”¨èµ„æºï¼‰ï¼Œä½†æ˜¯é‡è¦æ€§è®¤ä¸ºæ¯”è¾ƒä½ï¼Œå¯ä»¥æ˜¯ä¸€èˆ¬æ€§çš„åº”ç”¨æˆ–è€…æ‰¹å¤„ç†ä»»åŠ¡&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Best Effort&lt;/strong&gt;ï¼šä¼˜å…ˆçº§æœ€ä½ï¼Œé›†ç¾¤ä¸çŸ¥é“ pod çš„èµ„æºè¯·æ±‚æƒ…å†µï¼Œè°ƒåº¦ä¸è€ƒè™‘èµ„æºï¼Œå¯ä»¥è¿è¡Œåˆ°ä»»æ„èŠ‚ç‚¹ä¸Šï¼ˆä»èµ„æºè§’åº¦æ¥è¯´ï¼‰ï¼Œå¯ä»¥æ˜¯ä¸€äº›ä¸´æ—¶æ€§çš„ä¸é‡è¦åº”ç”¨ã€‚pod å¯ä»¥ä½¿ç”¨èŠ‚ç‚¹ä¸Šä»»ä½•å¯ç”¨èµ„æºï¼Œä½†åœ¨èµ„æºä¸è¶³æ—¶ä¹Ÿä¼šè¢«ä¼˜å…ˆæ€æ­»&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Pod çš„ requests å’Œ limits æ˜¯å¦‚ä½•å¯¹åº”åˆ°è¿™ä¸‰ä¸ª QoS ç­‰çº§ä¸Šçš„ï¼Œå¯ä»¥ç”¨ä¸‹é¢ä¸€å¼ è¡¨æ ¼æ¦‚æ‹¬ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-pod-qus-mapping&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://i.loli.net/2018/06/25/5b307f4bc7d42.png&#34; alt=&#34;pod QuS mapping&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      pod QuS mapping
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;çœ‹åˆ°è¿™é‡Œï¼Œä½ ä¹Ÿè®¸çœ‹å‡ºæ¥ä¸€ä¸ªé—®é¢˜äº†ï¼š&lt;strong&gt;å¦‚æœä¸é…ç½® requests å’Œ limitsï¼Œpod çš„ QoS ç«Ÿç„¶æ˜¯æœ€ä½çš„&lt;/strong&gt;ã€‚æ²¡é”™ï¼Œæ‰€ä»¥æ¨èå¤§å®¶ç†è§£ QoS çš„æ¦‚å¿µï¼Œå¹¶ä¸”æŒ‰ç…§éœ€æ±‚&lt;strong&gt;ä¸€å®šè¦ç»™ pod é…ç½® requests å’Œ limits å‚æ•°&lt;/strong&gt;ï¼Œä¸ä»…å¯ä»¥è®©è°ƒåº¦æ›´å‡†ç¡®ï¼Œä¹Ÿèƒ½è®©ç³»ç»Ÿæ›´åŠ ç¨³å®šã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;NOTE&lt;/strong&gt;ï¼šæŒ‰ç…§ç°åœ¨çš„æ–¹æ³•æ ¹æ® pod è¯·æ±‚çš„èµ„æºè¿›è¡Œé…ç½®ä¸å¤Ÿçµæ´»å’Œç›´è§‚ï¼Œæ›´ç†æƒ³çš„æƒ…å†µæ˜¯ç”¨æˆ·å¯ä»¥ç›´æ¥é…ç½® pod çš„ QoSï¼Œè€Œä¸ç”¨å…³å¿ƒå…·ä½“çš„èµ„æºç”³è¯·å’Œä¸Šé™å€¼ã€‚ä½† kubernetes ç›®å‰è¿˜æ²¡æœ‰è¿™æ–¹é¢çš„æ‰“ç®—ã€‚&lt;/p&gt;
&lt;p&gt;Pod çš„ QoS è¿˜å†³å®šäº†å®¹å™¨çš„ OOMï¼ˆout-of-memoryï¼‰å€¼ï¼Œå®ƒä»¬å¯¹åº”çš„å…³ç³»å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-pod-qos-oom-score&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://i.loli.net/2018/06/25/5b307a5b3557c.png&#34; alt=&#34;pod QoS oom score&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      pod QoS oom score
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼ŒQoS è¶Šé«˜çš„ pod oom å€¼è¶Šä½ï¼Œä¹Ÿå°±è¶Šä¸å®¹æ˜“è¢«ç³»ç»Ÿæ€æ­»ã€‚å¯¹äº Bustable podï¼Œå®ƒçš„å€¼æ˜¯æ ¹æ® request å’ŒèŠ‚ç‚¹å†…å­˜æ€»é‡å…±åŒå†³å®šçš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;oomScoreAdjust&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1000&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;memoryRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;memoryCapacity&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä¸­ &lt;code&gt;memoryRequest&lt;/code&gt; æ˜¯ pod ç”³è¯·çš„èµ„æºï¼Œ&lt;code&gt;memoryCapacity&lt;/code&gt; æ˜¯èŠ‚ç‚¹çš„å†…å­˜æ€»é‡ã€‚å¯ä»¥çœ‹åˆ°ï¼Œç”³è¯·çš„å†…å­˜è¶Šå¤šï¼Œoom å€¼è¶Šä½ï¼Œä¹Ÿå°±è¶Šä¸å®¹æ˜“è¢«æ€æ­»ã€‚&lt;/p&gt;
&lt;p&gt;QoS çš„ä½œç”¨ä¼šåœ¨åé¢ä»‹ç» eviction çš„æ—¶å€™è¯¦ç»†è®²è§£ã€‚&lt;/p&gt;
&lt;h3 id=&#34;pod-ä¼˜å…ˆçº§priority&#34;&gt;pod ä¼˜å…ˆçº§ï¼ˆpriorityï¼‰&lt;/h3&gt;
&lt;p&gt;é™¤äº† QoSï¼Œkubernetes è¿˜å…è®¸æˆ‘ä»¬è‡ªå®šä¹‰ pod çš„ä¼˜å…ˆçº§ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;scheduling.k8s.io/v1alpha1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;PriorityClass&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;high-priority&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1000000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;globalDefault&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;summary&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;This priority class should be used for XYZ service pods only.&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¼˜å…ˆçº§çš„ä½¿ç”¨ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦åœ¨ &lt;code&gt;pod.spec.PriorityClassName&lt;/code&gt; æŒ‡å®šè¦ä½¿ç”¨çš„ä¼˜å…ˆçº§åå­—ï¼Œå³å¯ä»¥è®¾ç½®å½“å‰ pod çš„ä¼˜å…ˆçº§ä¸ºå¯¹åº”çš„å€¼ã€‚&lt;/p&gt;
&lt;p&gt;Pod çš„ä¼˜å…ˆçº§åœ¨è°ƒåº¦çš„æ—¶å€™ä¼šä½¿ç”¨åˆ°ã€‚é¦–å…ˆï¼Œå¾…è°ƒåº¦çš„ pod éƒ½åœ¨åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå¯ç”¨äº† pod priority ä¹‹åï¼Œè°ƒåº¦å™¨ä¼šæ ¹æ®ä¼˜å…ˆçº§çš„å¤§å°ï¼ŒæŠŠä¼˜å…ˆçº§é«˜çš„ pod æ”¾åœ¨å‰é¢ï¼Œæå‰è°ƒåº¦ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œå¦‚æœåœ¨è°ƒåº¦çš„æ—¶å€™ï¼Œå‘ç°æŸä¸ª pod å› ä¸ºèµ„æºä¸è¶³æ— æ³•æ‰¾åˆ°åˆé€‚çš„èŠ‚ç‚¹ï¼Œè°ƒåº¦å™¨ä¼šå°è¯• preempt çš„é€»è¾‘ã€‚
ç®€å•æ¥è¯´ï¼Œè°ƒåº¦å™¨ä¼šè¯•å›¾æ‰¾åˆ°è¿™æ ·ä¸€ä¸ªèŠ‚ç‚¹ï¼šæ‰¾åˆ°å®ƒä¸Šé¢ä¼˜å…ˆçº§ä½äºå½“å‰è¦è°ƒåº¦ pod çš„æ‰€æœ‰ podï¼Œå¦‚æœæ€æ­»å®ƒä»¬ï¼Œèƒ½è…¾è¶³å¤Ÿçš„èµ„æºï¼Œè°ƒåº¦å™¨ä¼šæ‰§è¡Œåˆ é™¤æ“ä½œï¼ŒæŠŠ pod è°ƒåº¦åˆ°èŠ‚ç‚¹ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/configuration/pod-priority-preemption/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pod Priority and Preemption - Kubernetes&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;é©±é€eviction&#34;&gt;é©±é€ï¼ˆEvictionï¼‰&lt;/h2&gt;
&lt;p&gt;è‡³æ­¤ï¼Œæˆ‘ä»¬è®²è¿°çš„éƒ½æ˜¯ç†æƒ³æƒ…å†µä¸‹ kubernetes çš„å·¥ä½œçŠ¶å†µï¼Œæˆ‘ä»¬å‡è®¾èµ„æºå®Œå…¨å¤Ÿç”¨ï¼Œè€Œä¸”åº”ç”¨ä¹Ÿéƒ½æ˜¯åœ¨ä½¿ç”¨è§„å®šèŒƒå›´å†…çš„èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;ä½†ç°å®ä¸ä¼šå¦‚æ­¤ç®€å•ï¼Œåœ¨ç®¡ç†é›†ç¾¤çš„æ—¶å€™æˆ‘ä»¬å¸¸å¸¸ä¼šé‡åˆ°èµ„æºä¸è¶³çš„æƒ…å†µï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬è¦&lt;strong&gt;ä¿è¯æ•´ä¸ªé›†ç¾¤å¯ç”¨&lt;/strong&gt;ï¼Œå¹¶ä¸”å°½å¯èƒ½&lt;strong&gt;å‡å°‘åº”ç”¨çš„æŸå¤±&lt;/strong&gt;ã€‚ä¿è¯é›†ç¾¤å¯ç”¨æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œé¦–å…ˆè¦ä¿è¯ç³»ç»Ÿå±‚é¢çš„æ ¸å¿ƒè¿›ç¨‹æ­£å¸¸ï¼Œå…¶æ¬¡è¦ä¿è¯ kubernetes æœ¬èº«ç»„ä»¶è¿›ç¨‹ä¸å‡ºé—®é¢˜ï¼›ä½†æ˜¯å¦‚æœé‡åŒ–åº”ç”¨çš„æŸå¤±å‘¢ï¼Ÿé¦–å…ˆèƒ½æƒ³åˆ°çš„æ˜¯å¦‚æœè¦æ€æ­» podï¼Œè¦å°½é‡å‡å°‘æ€»æ•°ã€‚å¦å¤–ä¸€ä¸ªå°±å’Œ pod çš„ä¼˜å…ˆçº§ç›¸å…³äº†ï¼Œé‚£å°±æ˜¯å°½é‡æ€æ­»ä¸é‚£ä¹ˆé‡è¦çš„åº”ç”¨ï¼Œè®©é‡è¦çš„åº”ç”¨ä¸å—å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;Pod çš„é©±é€æ˜¯åœ¨ kubelet ä¸­å®ç°çš„ï¼Œå› ä¸º kubelet èƒ½åŠ¨æ€åœ°æ„ŸçŸ¥åˆ°èŠ‚ç‚¹ä¸Šèµ„æºä½¿ç”¨ç‡å®æ—¶çš„å˜åŒ–æƒ…å†µã€‚å…¶æ ¸å¿ƒçš„é€»è¾‘æ˜¯ï¼škubelet å®æ—¶ç›‘æ§èŠ‚ç‚¹ä¸Šå„ç§èµ„æºçš„ä½¿ç”¨æƒ…å†µï¼Œä¸€æ—¦å‘ç°æŸä¸ªä¸å¯å‹ç¼©èµ„æºå‡ºç°è¦è€—å°½çš„æƒ…å†µï¼Œå°±ä¼šä¸»åŠ¨ç»ˆæ­¢èŠ‚ç‚¹ä¸Šçš„ podï¼Œè®©èŠ‚ç‚¹èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚è¢«ç»ˆæ­¢çš„ pod æ‰€æœ‰å®¹å™¨ä¼šåœæ­¢ï¼ŒçŠ¶æ€ä¼šè¢«è®¾ç½®ä¸º failedã€‚&lt;/p&gt;
&lt;h3 id=&#34;é©±é€è§¦å‘æ¡ä»¶&#34;&gt;é©±é€è§¦å‘æ¡ä»¶&lt;/h3&gt;
&lt;p&gt;é‚£ä¹ˆå“ªäº›èµ„æºä¸è¶³ä¼šå¯¼è‡´ kubelet æ‰§è¡Œé©±é€ç¨‹åºå‘¢ï¼Ÿç›®å‰ä¸»è¦æœ‰ä¸‰ç§æƒ…å†µï¼šå®é™…å†…å­˜ä¸è¶³ã€èŠ‚ç‚¹æ–‡ä»¶ç³»ç»Ÿçš„å¯ç”¨ç©ºé—´ï¼ˆæ–‡ä»¶ç³»ç»Ÿå‰©ä½™å¤§å°å’Œ inode æ•°é‡ï¼‰ä¸è¶³ã€ä»¥åŠé•œåƒæ–‡ä»¶ç³»ç»Ÿçš„å¯ç”¨ç©ºé—´ï¼ˆåŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿå‰©ä½™å¤§å°å’Œ inode æ•°é‡ï¼‰ä¸è¶³ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢è¿™å›¾æ˜¯å…·ä½“çš„è§¦å‘æ¡ä»¶ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-eviction-conddition&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://i.loli.net/2018/06/24/5b2f1a966a703.png&#34; alt=&#34;eviction conddition&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      eviction conddition
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœ‰äº†æ•°æ®çš„æ¥æºï¼Œå¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯è§¦å‘çš„æ—¶æœºï¼Œä¹Ÿå°±æ˜¯åˆ°ä»€ä¹ˆç¨‹åº¦éœ€è¦è§¦å‘é©±é€ç¨‹åºï¼Ÿkubernetes è¿è¡Œç”¨æˆ·è‡ªå·±é…ç½®ï¼Œå¹¶ä¸”æ”¯æŒä¸¤ç§æ¨¡å¼ï¼šæŒ‰ç…§ç™¾åˆ†æ¯”å’ŒæŒ‰ç…§ç»å¯¹æ•°é‡ã€‚æ¯”å¦‚å¯¹äºä¸€ä¸ª 32G å†…å­˜çš„èŠ‚ç‚¹å½“å¯ç”¨å†…å­˜å°‘äº 10% æ—¶å¯åŠ¨é©±é€ç¨‹åºï¼Œå¯ä»¥é…ç½® &lt;code&gt;memory.available&amp;lt;10%&lt;/code&gt;æˆ–è€… &lt;code&gt;memory.available&amp;lt;3.2Gi&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;NOTE&lt;/strong&gt;ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œkubelet çš„é©±é€è§„åˆ™æ˜¯ &lt;code&gt;memory.available&amp;lt;100Mi&lt;/code&gt;ï¼Œå¯¹äºç”Ÿäº§ç¯å¢ƒè¿™ä¸ªé…ç½®æ˜¯ä¸å¯æ¥å—çš„ï¼Œæ‰€ä»¥ä¸€å®šè¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è½¯é©±é€soft-evictionå’Œç¡¬é©±é€hard-eviction&#34;&gt;è½¯é©±é€ï¼ˆsoft evictionï¼‰å’Œç¡¬é©±é€ï¼ˆhard evictionï¼‰&lt;/h3&gt;
&lt;p&gt;å› ä¸ºé©±é€ pod æ˜¯å…·æœ‰æ¯åæ€§çš„è¡Œä¸ºï¼Œå› æ­¤å¿…é¡»è¦è°¨æ…ã€‚æœ‰æ—¶å€™å†…å­˜ä½¿ç”¨ç‡å¢é«˜åªæ˜¯æš‚æ—¶æ€§çš„ï¼Œæœ‰å¯èƒ½ 20s å†…å°±èƒ½æ¢å¤ï¼Œè¿™æ—¶å€™å¯åŠ¨é©±é€ç¨‹åºæ„ä¹‰ä¸å¤§ï¼Œè€Œä¸”å¯èƒ½ä¼šå¯¼è‡´åº”ç”¨çš„ä¸ç¨³å®šï¼Œæˆ‘ä»¬è¦è€ƒè™‘åˆ°è¿™ç§æƒ…å†µåº”è¯¥å¦‚ä½•å¤„ç†ï¼›å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ï¼Œæ¯”å¦‚é«˜äº 95%ï¼ˆæˆ–è€… 90%ï¼Œå–å†³äºä¸»æœºå†…å­˜å¤§å°å’Œåº”ç”¨å¯¹ç¨³å®šæ€§çš„è¦æ±‚ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸åº”è¯¥å†å¤šåšè¯„ä¼°å’Œè€ƒè™‘ï¼Œè€Œæ˜¯èµ¶ç´§å¯åŠ¨é©±é€ç¨‹åºï¼Œå› ä¸ºè¿™ç§æƒ…å†µå†èŠ±è´¹æ—¶é—´å»åˆ¤æ–­å¯èƒ½ä¼šå¯¼è‡´å†…å­˜ç»§ç»­å¢é•¿ï¼Œç³»ç»Ÿå®Œå…¨å´©æºƒã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œkubernetes å¼•å…¥äº† soft eviction å’Œ hard eviction çš„æ¦‚å¿µã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è½¯é©±é€&lt;/strong&gt;å¯ä»¥åœ¨èµ„æºç´§ç¼ºæƒ…å†µå¹¶æ²¡æœ‰å“ªäº›ä¸¥é‡çš„æ—¶å€™è§¦å‘ï¼Œæ¯”å¦‚å†…å­˜ä½¿ç”¨ç‡ä¸º 85%ï¼Œè½¯é©±é€è¿˜éœ€è¦é…ç½®ä¸€ä¸ªæ—¶é—´æŒ‡å®šè½¯é©±é€æ¡ä»¶æŒç»­å¤šä¹…æ‰è§¦å‘ï¼Œä¹Ÿå°±æ˜¯è¯´ kubelet åœ¨å‘ç°èµ„æºä½¿ç”¨ç‡è¾¾åˆ°è®¾å®šçš„é˜ˆå€¼ä¹‹åï¼Œå¹¶ä¸ä¼šç«‹å³è§¦å‘é©±é€ç¨‹åºï¼Œè€Œæ˜¯ç»§ç»­è§‚å¯Ÿä¸€æ®µæ—¶é—´ï¼Œå¦‚æœèµ„æºä½¿ç”¨ç‡é«˜äºé˜ˆå€¼çš„æƒ…å†µæŒç»­ä¸€å®šæ—¶é—´ï¼Œæ‰å¼€å§‹é©±é€ã€‚å¹¶ä¸”é©±é€ pod çš„æ—¶å€™ï¼Œä¼šéµå¾ª grace periodï¼Œç­‰å¾… pod å¤„ç†å®Œæ¸…ç†é€»è¾‘ã€‚å’Œè½¯é©±é€ç›¸å…³çš„å¯åŠ¨å‚æ•°æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;--eviction-soft&lt;/code&gt;ï¼šè½¯é©±é€è§¦å‘æ¡ä»¶ï¼Œæ¯”å¦‚ &lt;code&gt;memory.available&amp;lt;1Gi&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--eviction-sfot-grace-period&lt;/code&gt;ï¼šè§¦å‘æ¡ä»¶æŒç»­å¤šä¹…æ‰å¼€å§‹é©±é€ï¼Œæ¯”å¦‚ &lt;code&gt;memory.available=2m30s&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--eviction-max-pod-grace-period&lt;/code&gt;ï¼škill pod æ—¶ç­‰å¾… grace period çš„æ—¶é—´è®© pod åšä¸€äº›æ¸…ç†å·¥ä½œï¼Œå¦‚æœåˆ°æ—¶é—´è¿˜æ²¡æœ‰ç»“æŸå°±åš kill&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‰é¢ä¸¤ä¸ªå‚æ•°å¿…é¡»åŒæ—¶é…ç½®ï¼Œè½¯é©±é€æ‰èƒ½æ­£å¸¸å·¥ä½œï¼›åä¸€ä¸ªå‚æ•°ä¼šå’Œ pod æœ¬èº«é…ç½®çš„ grace period æ¯”è¾ƒï¼Œé€‰æ‹©è¾ƒå°çš„ä¸€ä¸ªç”Ÿæ•ˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¡¬é©±é€&lt;/strong&gt;æ›´åŠ ç›´æ¥å¹²è„†ï¼Œkubelet å‘ç°èŠ‚ç‚¹è¾¾åˆ°é…ç½®çš„ç¡¬é©±é€é˜ˆå€¼åï¼Œç«‹å³å¼€å§‹é©±é€ç¨‹åºï¼Œå¹¶ä¸”ä¸ä¼šéµå¾ª grace periodï¼Œä¹Ÿå°±æ˜¯è¯´ç«‹å³å¼ºåˆ¶æ€æ­» podã€‚å¯¹åº”çš„é…ç½®å‚æ•°åªæœ‰ä¸€ä¸ª &lt;code&gt;--evictio-hard&lt;/code&gt;ï¼Œå¯ä»¥é€‰æ‹©ä¸Šé¢è¡¨æ ¼ä¸­çš„ä»»æ„æ¡ä»¶æ­é…ã€‚&lt;/p&gt;
&lt;p&gt;è®¾ç½®è¿™ä¸¤ç§é©±é€ç¨‹åºæ˜¯ä¸ºäº†å¹³è¡¡èŠ‚ç‚¹ç¨³å®šæ€§å’Œå¯¹ pod çš„å½±å“ï¼Œè½¯é©±é€ç…§é¡¾åˆ°äº† pod çš„ä¼˜é›…é€€å‡ºï¼Œå‡å°‘é©±é€å¯¹ pod çš„å½±å“ï¼›è€Œç¡¬é©±é€åˆ™ç…§é¡¾åˆ°èŠ‚ç‚¹çš„ç¨³å®šæ€§ï¼Œé˜²æ­¢èµ„æºçš„å¿«é€Ÿæ¶ˆè€—å¯¼è‡´èŠ‚ç‚¹ä¸å¯ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;è½¯é©±é€å’Œç¡¬é©±é€å¯ä»¥å•ç‹¬é…ç½®ï¼Œä¸è¿‡è¿˜æ˜¯æ¨èä¸¤è€…éƒ½è¿›è¡Œé…ç½®ï¼Œä¸€èµ·ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é©±é€å“ªäº›-pods&#34;&gt;é©±é€å“ªäº› podsï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ä¸Šé¢æˆ‘ä»¬å·²ç»æ•´ä½“ä»‹ç»äº† kubelet é©±é€ pod çš„é€»è¾‘å’Œè¿‡ç¨‹ï¼Œé‚£è¿™é‡Œå°±ç‰µæ¶‰åˆ°ä¸€ä¸ªå…·ä½“çš„é—®é¢˜ï¼š&lt;strong&gt;è¦é©±é€å“ªäº› pod&lt;/strong&gt;ï¼Ÿé©±é€çš„é‡è¦åŸåˆ™æ˜¯å°½é‡å‡å°‘å¯¹åº”ç”¨ç¨‹åºçš„å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ˜¯å­˜å‚¨èµ„æºä¸è¶³ï¼Œkubelet ä¼šæ ¹æ®æƒ…å†µæ¸…ç†çŠ¶æ€ä¸º Dead çš„ pod å’Œå®ƒçš„æ‰€æœ‰å®¹å™¨ï¼Œä»¥åŠæ¸…ç†æ‰€æœ‰æ²¡æœ‰ä½¿ç”¨çš„é•œåƒã€‚å¦‚æœä¸Šè¿°æ¸…ç†å¹¶æ²¡æœ‰è®©èŠ‚ç‚¹å›å½’æ­£å¸¸ï¼Œkubelet å°±å¼€å§‹æ¸…ç† podã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªèŠ‚ç‚¹ä¸Šä¼šè¿è¡Œå¤šä¸ª podï¼Œé©±é€æ‰€æœ‰çš„ pods æ˜¾ç„¶æ˜¯ä¸å¿…è¦çš„ï¼Œå› æ­¤è¦åšå‡ºä¸€ä¸ªæŠ‰æ‹©ï¼šåœ¨èŠ‚ç‚¹ä¸Šè¿è¡Œçš„æ‰€æœ‰ pod ä¸­é€‰æ‹©ä¸€éƒ¨åˆ†æ¥é©±é€ã€‚è™½ç„¶è¿™äº› pod ä¹çœ‹èµ·æ¥æ²¡æœ‰åŒºåˆ«ï¼Œä½†æ˜¯å®ƒä»¬çš„åœ°ä½æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ­£å¦‚ä¹”æ²»Â·å¥¥å¨å°”åœ¨ã€ŠåŠ¨ç‰©åº„å›­ã€‹çš„é‚£å¥è¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ‰€æœ‰åŠ¨ç‰©ç”Ÿè€Œå¹³ç­‰ï¼Œä½†æœ‰äº›åŠ¨ç‰©æ¯”å…¶ä»–åŠ¨ç‰©æ›´å¹³ç­‰ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Pod ä¹Ÿæ˜¯ä¸å¹³ç­‰çš„ï¼Œæœ‰äº› pod è¦æ¯”å…¶ä»– pod æ›´é‡è¦ã€‚åªç®¡æ¥è¯´ï¼Œç³»ç»Ÿç»„ä»¶çš„ pod è¦æ¯”æ™®é€šçš„ pod æ›´é‡è¦ï¼Œå¦å¤–è¿è¡Œæ•°æ®åº“çš„ pod è‡ªç„¶è¦æ¯”è¿è¡Œä¸€ä¸ªæ— çŠ¶æ€åº”ç”¨çš„ pod æ›´é‡è¦ã€‚kubernetes åˆæ˜¯æ€ä¹ˆå†³å®š pod çš„ä¼˜å…ˆçº§çš„å‘¢ï¼Ÿè¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆå°±è—åœ¨æˆ‘ä»¬ä¹‹å‰å·²ç»ä»‹ç»è¿‡çš„å†…å®¹é‡Œï¼špod requests å’Œ limitsã€ä¼˜å…ˆçº§ï¼ˆpriorityï¼‰ï¼Œä»¥åŠ pod å®é™…çš„èµ„æºä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ç®€å•æ¥è¯´ï¼Œkubelet ä¼šæ ¹æ®ä»¥ä¸‹å†…å®¹å¯¹ pod è¿›è¡Œæ’åºï¼špod æ˜¯å¦ä½¿ç”¨äº†è¶…è¿‡è¯·æ±‚çš„ç´§å¼ èµ„æºã€pod çš„ä¼˜å…ˆçº§ã€ç„¶åæ˜¯ä½¿ç”¨çš„ç´§ç¼ºèµ„æºå’Œè¯·æ±‚çš„ç´§å¼ èµ„æºä¹‹é—´çš„æ¯”ä¾‹ã€‚å…·ä½“æ¥è¯´ï¼Œkubelet ä¼šæŒ‰ç…§å¦‚ä¸‹çš„é¡ºåºé©±é€ podï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨çš„ç´§å¼ èµ„æºè¶…è¿‡è¯·æ±‚æ•°é‡çš„ &lt;code&gt;BestEffort&lt;/code&gt; å’Œ &lt;code&gt;Burstable&lt;/code&gt; podï¼Œè¿™äº› pod å†…éƒ¨åˆä¼šæŒ‰ç…§ä¼˜å…ˆçº§å’Œä½¿ç”¨æ¯”ä¾‹è¿›è¡Œæ’åº&lt;/li&gt;
&lt;li&gt;ç´§å¼ èµ„æºä½¿ç”¨é‡ä½äº requests çš„ &lt;code&gt;Burstable&lt;/code&gt; å’Œ &lt;code&gt;Guaranteed&lt;/code&gt; çš„ pod åé¢æ‰ä¼šé©±é€ï¼Œåªæœ‰å½“ç³»ç»Ÿç»„ä»¶ï¼ˆkubeletã€dockerã€journald ç­‰ï¼‰å†…å­˜ä¸å¤Ÿï¼Œå¹¶ä¸”æ²¡æœ‰ä¸Šé¢ QoS æ¯”è¾ƒä½çš„ pod æ—¶æ‰ä¼šåšã€‚æ‰§è¡Œçš„æ—¶å€™è¿˜ä¼šæ ¹æ® priority æ’åºï¼Œä¼˜å…ˆé€‰æ‹©ä¼˜å…ˆçº§ä½çš„ pod&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;é˜²æ­¢æ³¢åŠ¨&#34;&gt;é˜²æ­¢æ³¢åŠ¨&lt;/h3&gt;
&lt;p&gt;è¿™é‡Œçš„æ³¢åŠ¨æœ‰ä¸¤ç§æƒ…å†µï¼Œæˆ‘ä»¬å…ˆè¯´è¯´ç¬¬ä¸€ç§ã€‚é©±é€æ¡ä»¶å‡ºå‘åï¼Œå¦‚æœ kubelet é©±é€ä¸€éƒ¨åˆ† podï¼Œè®©èµ„æºä½¿ç”¨ç‡ä½äºé˜ˆå€¼å°±åœæ­¢ï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½è¿‡ä¸€æ®µæ—¶é—´èµ„æºä½¿ç”¨ç‡åˆä¼šè¾¾åˆ°é˜ˆå€¼ï¼Œä»è€Œå†æ¬¡å‡ºå‘é©±é€ï¼Œå¦‚æ­¤å¾ªç¯å¾€å¤â€¦â€¦ä¸ºäº†å¤„ç†è¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;code&gt;--eviction-minimum-reclaim&lt;/code&gt;è§£å†³ï¼Œè¿™ä¸ªå‚æ•°é…ç½®æ¯æ¬¡é©±é€è‡³å°‘æ¸…ç†å‡ºæ¥å¤šå°‘èµ„æºæ‰ä¼šåœæ­¢ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ä¸€ä¸ªæ³¢åŠ¨æƒ…å†µæ˜¯è¿™æ ·çš„ï¼šPod è¢«é©±é€ä¹‹åå¹¶ä¸ä¼šä»æ­¤æ¶ˆå¤±ä¸è§ï¼Œå¸¸è§çš„æƒ…å†µæ˜¯ kubernetes ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæ–°çš„ pod æ¥å–ä»£ï¼Œå¹¶ç»è¿‡è°ƒåº¦é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ç»§ç»­è¿è¡Œã€‚å¦‚æœä¸åšé¢å¤–å¤„ç†ï¼Œæœ‰ç†ç”±ç›¸ä¿¡ pod é€‰æ‹©åŸæ¥èŠ‚ç‚¹çš„å¯èƒ½æ€§æ¯”è¾ƒå¤§ï¼ˆå› ä¸ºè°ƒåº¦é€»è¾‘æ²¡å˜ï¼Œè€Œå®ƒä¸Šæ¬¡è°ƒåº¦é€‰æ‹©çš„å°±æ˜¯è¯¥èŠ‚ç‚¹ï¼‰ï¼Œä¹‹æ‰€ä»¥è¯´å¯èƒ½è€Œä¸æ˜¯ç»å¯¹ä¼šå†æ¬¡é€‰æ‹©è¯¥èŠ‚ç‚¹ï¼Œæ˜¯å› ä¸ºé›†ç¾¤ pod çš„è¿è¡Œå’Œåˆ†å¸ƒå’Œä¸Šæ¬¡è°ƒåº¦æ—¶ææœ‰å¯èƒ½å‘ç”Ÿäº†å˜åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;æ— è®ºå¦‚ä½•ï¼Œå¦‚æœè¢«é©±é€çš„ pod å†æ¬¡è°ƒåº¦åˆ°åŸæ¥çš„èŠ‚ç‚¹ï¼Œå¾ˆå¯èƒ½ä¼šå†æ¬¡è§¦å‘é©±é€ç¨‹åºï¼Œç„¶å pod å†æ¬¡è¢«è°ƒåº¦åˆ°å½“å‰èŠ‚ç‚¹ï¼Œå¾ªç¯å¾€å¤â€¦â€¦ è¿™ç§äº‹æƒ…å½“ç„¶æ˜¯æˆ‘ä»¬ä¸æ„¿æ„çœ‹åˆ°çš„ï¼Œè™½ç„¶çœ‹ä¼¼å¤æ‚ï¼Œä½†è¿™ä¸ªé—®é¢˜è§£å†³èµ·æ¥éå¸¸ç®€å•ï¼šé©±é€å‘ç”Ÿåï¼Œkubelet æ›´æ–°èŠ‚ç‚¹çŠ¶æ€ï¼Œè°ƒåº¦å™¨æ„ŸçŸ¥åˆ°è¿™ä¸€æƒ…å†µï¼Œæš‚æ—¶ä¸å¾€è¯¥èŠ‚ç‚¹è°ƒåº¦ pod å³å¯ã€‚&lt;code&gt;--eviction-pressure-transition-period&lt;/code&gt; å‚æ•°å¯ä»¥æŒ‡å®š kubelet å¤šä¹…æ‰ä¸ŠæŠ¥èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œå› ä¸ºé»˜è®¤çš„ä¸ŠæŠ¥çŠ¶æ€å‘¨æœŸæ¯”è¾ƒçŸ­ï¼Œé¢‘ç¹æ›´æ”¹èŠ‚ç‚¹çŠ¶æ€ä¼šå¯¼è‡´é©±é€æ³¢åŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;åšä¸€ä¸ªæ€»ç»“ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨äº†ä¸Šé¢å¤šç§å‚æ•°çš„é©±é€é…ç½®å®ä¾‹ï¼ˆä½ åº”è¯¥èƒ½çœ‹æ‡‚å®ƒä»¬æ˜¯ä»€ä¹ˆæ„æ€äº†ï¼‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â€“eviction-soft&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;memory.available&amp;lt;80%,nodefs.available&amp;lt;2Gi &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;â€“eviction-soft-grace-period&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;memory.available&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;1m30s,nodefs.available&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;1m30s &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;â€“eviction-max-pod-grace-period&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;120&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;â€“eviction-hard&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;memory.available&amp;lt;500Mi,nodefs.available&amp;lt;1Gi &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;â€“eviction-pressure-transition-period&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;30s &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--eviction-minimum-reclaim&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;memory.available=0Mi,nodefs.available=500Mi,imagefs.available=2Gi&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¢ç‰‡æ•´ç†å’Œé‡è°ƒåº¦&#34;&gt;ç¢ç‰‡æ•´ç†å’Œé‡è°ƒåº¦&lt;/h2&gt;
&lt;p&gt;Kubernetes çš„è°ƒåº¦å™¨åœ¨ä¸º pod é€‰æ‹©è¿è¡ŒèŠ‚ç‚¹çš„æ—¶å€™ï¼Œåªä¼šè€ƒè™‘åˆ°è°ƒåº¦é‚£ä¸ªæ—¶é—´ç‚¹é›†ç¾¤çš„çŠ¶æ€ï¼Œç»è¿‡ä¸€ç³»åˆ—çš„ç®—æ³•é€‰æ‹©ä¸€ä¸ª&lt;strong&gt;å½“æ—¶æœ€åˆé€‚&lt;/strong&gt;çš„èŠ‚ç‚¹ã€‚ä½†æ˜¯é›†ç¾¤çš„çŠ¶æ€æ˜¯ä¸æ–­å˜åŒ–çš„ï¼Œç”¨æˆ·åˆ›å»ºçš„ pod ä¹Ÿæ˜¯åŠ¨æ€çš„ï¼Œéšç€æ—¶é—´å˜åŒ–ï¼ŒåŸæ¥è°ƒåº¦åˆ°æŸä¸ªèŠ‚ç‚¹ä¸Šçš„ pod ç°åœ¨çœ‹æ¥å¯èƒ½æœ‰æ›´å¥½çš„èŠ‚ç‚¹å¯ä»¥é€‰æ‹©ã€‚æ¯”å¦‚è€ƒè™‘åˆ°ä¸‹é¢è¿™äº›æƒ…å†µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è°ƒåº¦ pod çš„æ¡ä»¶å·²ç»ä¸å†æ»¡è¶³ï¼Œæ¯”å¦‚èŠ‚ç‚¹çš„ taints å’Œ labels å‘ç”Ÿäº†å˜åŒ–&lt;/li&gt;
&lt;li&gt;æ–°èŠ‚ç‚¹åŠ å…¥äº†é›†ç¾¤ã€‚å¦‚æœé»˜è®¤é…ç½®äº†æŠŠ pod æ‰“æ•£ï¼Œé‚£ä¹ˆåº”è¯¥æœ‰ä¸€äº› pod æœ€å¥½è¿è¡Œåœ¨æ–°èŠ‚ç‚¹ä¸Š&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹çš„ä½¿ç”¨ç‡ä¸å‡åŒ€ã€‚è°ƒåº¦åï¼Œæœ‰äº›èŠ‚ç‚¹çš„åˆ†é…ç‡å’Œä½¿ç”¨ç‡æ¯”è¾ƒé«˜ï¼Œå¦å¤–ä¸€äº›æ¯”è¾ƒä½&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹ä¸Šæœ‰èµ„æºç¢ç‰‡ã€‚æœ‰äº›èŠ‚ç‚¹è°ƒåº¦ä¹‹åè¿˜å‰©ä½™éƒ¨åˆ†èµ„æºï¼Œä½†æ˜¯åˆä½äºä»»ä½• pod çš„è¯·æ±‚èµ„æºï¼›æˆ–è€… memory èµ„æºå·²ç»ç”¨å®Œï¼Œä½†æ˜¯ CPU è¿˜æœ‰æŒºå¤šæ²¡æœ‰ä½¿ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æƒ³è¦è§£å†³ä¸Šè¿°çš„è¿™äº›é—®é¢˜ï¼Œéƒ½éœ€è¦æŠŠ pod é‡æ–°è¿›è¡Œè°ƒåº¦ï¼ˆæŠŠ pod ä»å½“å‰èŠ‚ç‚¹ç§»åŠ¨åˆ°å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ã€‚ä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€æ—¦ pod è¢«è°ƒåº¦åˆ°èŠ‚ç‚¹ä¸Šï¼Œé™¤éç»™æ€æ­»å¦åˆ™ä¸ä¼šç§»åŠ¨åˆ°å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºæ­¤ kubernetes ç¤¾åŒºå­µåŒ–äº†ä¸€ä¸ªç§°ä¸º &lt;a href=&#34;https://github.com/kubernetes-incubator/descheduler&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;descheduler&lt;/code&gt;&lt;/a&gt; çš„é¡¹ç›®ï¼Œä¸“é—¨ç”¨æ¥åšé‡è°ƒåº¦ã€‚é‡è°ƒåº¦çš„é€»è¾‘å¾ˆç®€å•ï¼šæ‰¾åˆ°ä¸Šé¢å‡ ç§æƒ…å†µä¸­å·²ç»ä¸æ˜¯æœ€ä¼˜çš„ podï¼ŒæŠŠå®ƒä»¬é©±é€æ‰ï¼ˆevictionï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰ï¼Œdescheduler ä¸ä¼šå†³å®šé©±é€çš„ pod åº”è¯¥è°ƒåº¦åˆ°å“ªå°æœºå™¨ï¼Œè€Œæ˜¯&lt;strong&gt;å‡å®šé»˜è®¤çš„è°ƒåº¦å™¨ä¼šåšå‡ºæ­£ç¡®çš„è°ƒåº¦æŠ‰æ‹©&lt;/strong&gt;ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¹‹æ‰€ä»¥ pod ç›®å‰ä¸åˆé€‚ï¼Œä¸æ˜¯å› ä¸ºè°ƒåº¦å™¨çš„ç®—æ³•æœ‰é—®é¢˜ï¼Œè€Œæ˜¯å› ä¸ºé›†ç¾¤çš„æƒ…å†µå‘ç”Ÿäº†å˜åŒ–ã€‚å¦‚æœè®©è°ƒåº¦å™¨é‡æ–°é€‰æ‹©ï¼Œè°ƒåº¦å™¨ç°åœ¨ä¼šæŠŠ pod æ”¾åˆ°åˆé€‚çš„èŠ‚ç‚¹ä¸Šã€‚è¿™ç§åšæ³•è®© descheduler é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œè€Œä¸”é¿å…äº†è°ƒåº¦é€»è¾‘å‡ºç°åœ¨ä¸¤ä¸ªç»„ä»¶ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;Descheduler æ‰§è¡Œçš„é€»è¾‘æ˜¯å¯ä»¥é…ç½®çš„ï¼Œç›®å‰æœ‰å‡ ç§åœºæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;RemoveDuplicates&lt;/code&gt;ï¼šRSã€deployment ä¸­çš„ pod ä¸èƒ½åŒæ—¶å‡ºç°åœ¨ä¸€å°æœºå™¨ä¸Š&lt;/li&gt;
&lt;li&gt;&lt;code&gt;LowNodeUtilization&lt;/code&gt;ï¼šæ‰¾åˆ°èµ„æºä½¿ç”¨ç‡æ¯”è¾ƒä½çš„ nodeï¼Œç„¶åé©±é€å…¶ä»–èµ„æºä½¿ç”¨ç‡æ¯”è¾ƒé«˜èŠ‚ç‚¹ä¸Šçš„ podï¼ŒæœŸæœ›è°ƒåº¦å™¨èƒ½å¤Ÿé‡æ–°è°ƒåº¦è®©èµ„æºæ›´å‡è¡¡&lt;/li&gt;
&lt;li&gt;&lt;code&gt;RemovePodsViolatingInterPodAntiAffinity&lt;/code&gt;ï¼šæ‰¾åˆ°å·²ç»è¿å Pod Anti Affinity è§„åˆ™çš„ pods è¿›è¡Œé©±é€ï¼Œå¯èƒ½æ˜¯å› ä¸ºåäº²å’Œæ˜¯åé¢åŠ ä¸Šå»çš„&lt;/li&gt;
&lt;li&gt;&lt;code&gt;RemovePodsViolatingNodeAffinity&lt;/code&gt;ï¼šæ‰¾åˆ°è¿å Node Affinity è§„åˆ™çš„ pods è¿›è¡Œé©±é€ï¼Œå¯èƒ½æ˜¯å› ä¸º node åé¢ä¿®æ”¹äº† label&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“ç„¶ï¼Œä¸ºäº†ä¿è¯åº”ç”¨çš„ç¨³å®šæ€§ï¼Œdescheduler å¹¶ä¸ä¼šéšæ„åœ°é©±é€ podï¼Œè¿˜æ˜¯ä¼šå°Šé‡ pod è¿è¡Œçš„è§„åˆ™ï¼ŒåŒ…æ‹¬ pod çš„ä¼˜å…ˆçº§ï¼ˆä¸ä¼šé©±é€ Critical podï¼Œå¹¶ä¸”æŒ‰ç…§ä¼˜å…ˆçº§é¡ºåºè¿›è¡Œé©±é€ï¼‰å’Œ PDBï¼ˆå¦‚æœè¿åäº† PDBï¼Œåˆ™ä¸ä¼šè¿›è¡Œé©±é€ï¼‰ï¼Œå¹¶ä¸”ä¸ä¼šé©±é€æ²¡æœ‰ deploymentã€rsã€jobs çš„ pod ä¸ä¼šé©±é€ï¼Œdaemonset pod ä¸ä¼šé©±é€ï¼Œæœ‰ local storage çš„ pod ä¹Ÿä¸ä¼šé©±é€ã€‚&lt;/p&gt;
&lt;p&gt;Descheduler ä¸æ˜¯ä¸€ä¸ªå¸¸é©»çš„ä»»åŠ¡ï¼Œæ¯æ¬¡æ‰§è¡Œå®Œä¹‹åä¼šé€€å‡ºï¼Œå› æ­¤æ¨èä½¿ç”¨ CronJob æ¥è¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;æ€»çš„æ¥è¯´ï¼Œdescheduler æ˜¯å¯¹åŸç”Ÿè°ƒåº¦å™¨çš„è¡¥å……ï¼Œç”¨æ¥è§£å†³åŸç”Ÿè°ƒåº¦å™¨çš„è°ƒåº¦å†³ç­–éšç€æ—¶é—´ä¼šå˜å¾—å¤±æ•ˆï¼Œæˆ–è€…ä¸å¤Ÿä¼˜åŒ–çš„ç¼ºé™·ã€‚&lt;/p&gt;
&lt;h2 id=&#34;èµ„æºåŠ¨æ€è°ƒæ•´&#34;&gt;èµ„æºåŠ¨æ€è°ƒæ•´&lt;/h2&gt;
&lt;p&gt;åŠ¨æ€è°ƒæ•´çš„æ€è·¯ï¼šåº”ç”¨çš„å®é™…æµé‡ä¼šä¸æ–­å˜åŒ–ï¼Œå› æ­¤ä½¿ç”¨ç‡ä¹Ÿæ˜¯ä¸æ–­å˜åŒ–çš„ï¼Œä¸ºäº†åº”å¯¹åº”ç”¨æµé‡çš„å˜åŒ–ï¼Œæˆ‘ä»¬åº”ç”¨èƒ½å¤Ÿè‡ªåŠ¨è°ƒæ•´åº”ç”¨çš„èµ„æºã€‚æ¯”å¦‚åœ¨çº¿å•†å“åº”ç”¨åœ¨ä¿ƒé”€çš„æ—¶å€™è®¿é—®é‡ä¼šå¢åŠ ï¼Œæˆ‘ä»¬åº”è¯¥è‡ªåŠ¨å¢åŠ  pod è¿ç®—èƒ½åŠ›æ¥åº”å¯¹ï¼›å½“ä¿ƒé”€ç»“æŸåï¼Œæœ‰éœ€è¦è‡ªåŠ¨é™ä½ pod çš„è¿ç®—èƒ½åŠ›é˜²æ­¢æµªè´¹ã€‚&lt;/p&gt;
&lt;p&gt;è¿ç®—èƒ½åŠ›çš„å¢å‡æœ‰ä¸¤ç§æ–¹å¼ï¼šæ”¹å˜å•ä¸ª pod çš„èµ„æºï¼Œå·²ç»å¢å‡ pod çš„æ•°é‡ã€‚è¿™ä¸¤ç§æ–¹å¼å¯¹åº”äº† kubernetes çš„ HPA å’Œ VPAã€‚&lt;/p&gt;
&lt;h3 id=&#34;horizontal-pod-autoscalingæ¨ªå‘-pod-è‡ªåŠ¨æ‰©å±•&#34;&gt;Horizontal Pod AutoScalingï¼ˆæ¨ªå‘ Pod è‡ªåŠ¨æ‰©å±•ï¼‰&lt;/h3&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-kubernetes-hpa&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;https://478h5m1yrfsa3bbe262u7muv-wpengine.netdna-ssl.com/wp-content/uploads/2018/02/autoscaler_kubernetes.jpg&#34; alt=&#34;kubernetes HPA&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      kubernetes HPA
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ¨ªå‘ pod è‡ªåŠ¨æ‰©å±•çš„æ€è·¯æ˜¯è¿™æ ·çš„ï¼škubernetes ä¼šè¿è¡Œä¸€ä¸ª controllerï¼Œå‘¨æœŸæ€§åœ°ç›‘å¬ pod çš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œå½“é«˜äºè®¾å®šçš„é˜ˆå€¼æ—¶ï¼Œä¼šè‡ªåŠ¨å¢åŠ  pod çš„æ•°é‡ï¼›å½“ä½äºæŸä¸ªé˜ˆå€¼æ—¶ï¼Œä¼šè‡ªåŠ¨å‡å°‘ pod çš„æ•°é‡ã€‚è‡ªç„¶ï¼Œè¿™é‡Œçš„é˜ˆå€¼ä»¥åŠ pod çš„ä¸Šé™å’Œä¸‹é™çš„æ•°é‡éƒ½æ˜¯éœ€è¦ç”¨æˆ·é…ç½®çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šé¢è¿™å¥è¯éšè—äº†ä¸€ä¸ªé‡è¦çš„ä¿¡æ¯ï¼šHPA åªèƒ½å’Œ RCã€deploymentã€RS è¿™äº›å¯ä»¥åŠ¨æ€ä¿®æ”¹ replicas çš„å¯¹è±¡ä¸€èµ·ä½¿ç”¨ï¼Œè€Œæ— æ³•ç”¨äºå•ä¸ª podã€daemonsetï¼ˆå› ä¸ºå®ƒæ§åˆ¶çš„ pod æ•°é‡ä¸èƒ½éšä¾¿ä¿®æ”¹ï¼‰ç­‰å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰å®˜æ–¹çš„ç›‘æ§æ•°æ®æ¥æºæ˜¯ metrics server é¡¹ç›®ï¼Œå¯ä»¥é…ç½®çš„èµ„æºåªæœ‰ CPUï¼Œä½†æ˜¯ç”¨æˆ·å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„ç›‘æ§æ•°æ®ï¼ˆæ¯”å¦‚ prometheusï¼‰ï¼Œå…¶ä»–èµ„æºï¼ˆæ¯”å¦‚ memoryï¼‰çš„ HPA æ”¯æŒä¹Ÿå·²ç»åœ¨è·¯ä¸Šäº†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;vertical-pod-autoscaling&#34;&gt;Vertical Pod AutoScaling&lt;/h3&gt;
&lt;p&gt;å’Œ HPA çš„æ€è·¯ç›¸ä¼¼ï¼Œåªä¸è¿‡ VPA è°ƒæ•´çš„æ˜¯å•ä¸ª pod çš„ request å€¼ï¼ˆåŒ…æ‹¬ CPU å’Œ memoryï¼‰ã€‚VPA åŒ…æ‹¬ä¸‰ä¸ªç»„ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Recommanderï¼šæ¶ˆè´¹ metrics server æˆ–è€…å…¶ä»–ç›‘æ§ç»„ä»¶çš„æ•°æ®ï¼Œç„¶åè®¡ç®— pod çš„èµ„æºæ¨èå€¼&lt;/li&gt;
&lt;li&gt;Updaterï¼šæ‰¾åˆ°è¢« vpa æ¥ç®¡çš„ pod ä¸­å’Œè®¡ç®—å‡ºæ¥çš„æ¨èå€¼å·®è·è¿‡å¤§çš„ï¼Œå¯¹å…¶åš update æ“ä½œï¼ˆç›®å‰æ˜¯ evictï¼Œæ–°å»ºçš„ pod åœ¨ä¸‹é¢ admission controller ä¸­ä¼šä½¿ç”¨æ¨èçš„èµ„æºå€¼ä½œä¸º requestï¼‰&lt;/li&gt;
&lt;li&gt;Admission Controllerï¼šæ–°å»ºçš„ pod ä¼šç»è¿‡è¯¥ Admission Controllerï¼Œå¦‚æœ pod æ˜¯è¢« vpa æ¥ç®¡çš„ï¼Œä¼šä½¿ç”¨ recommander è®¡ç®—å‡ºæ¥çš„æ¨èå€¼&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸‰ä¸ªç»„ä»¶çš„åŠŸèƒ½æ˜¯äº’ç›¸è¡¥å……çš„ï¼Œå…±åŒå®ç°äº†åŠ¨æ€ä¿®æ”¹ pod è¯·æ±‚èµ„æºçš„åŠŸèƒ½ã€‚ç›¸å¯¹äº HPAï¼Œç›®å‰ VPA è¿˜å¤„äº alphaï¼Œå¹¶ä¸”è¿˜æ²¡æœ‰åˆå¹¶åˆ°å®˜æ–¹çš„ kubernetes release ä¸­ï¼Œåç»­çš„æ¥å£å’ŒåŠŸèƒ½å¾ˆå¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚&lt;/p&gt;
&lt;h3 id=&#34;cluster-auto-scaler&#34;&gt;Cluster Auto Scaler&lt;/h3&gt;
&lt;p&gt;éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œåº”ç”¨ä¼šé€æ¸å¢å¤šï¼Œæ¯ä¸ªåº”ç”¨ä½¿ç”¨çš„èµ„æºä¹Ÿä¼šå¢åŠ ï¼Œæ€»ä¼šå‡ºç°é›†ç¾¤èµ„æºä¸è¶³çš„æƒ…å†µã€‚ä¸ºäº†åŠ¨æ€åœ°åº”å¯¹è¿™ä¸€çŠ¶å†µï¼Œæˆ‘ä»¬è¿˜éœ€è¦ CLuster Auto Scalerï¼Œèƒ½å¤Ÿæ ¹æ®æ•´ä¸ªé›†ç¾¤çš„èµ„æºä½¿ç”¨æƒ…å†µæ¥å¢å‡èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºå…¬æœ‰äº‘æ¥è¯´ï¼ŒCluster Auto Scaler å°±æ˜¯ç›‘æ§è¿™ä¸ªé›†ç¾¤å› ä¸ºèµ„æºä¸è¶³è€Œ pending çš„ podï¼Œæ ¹æ®ç”¨æˆ·é…ç½®çš„é˜ˆå€¼è°ƒç”¨å…¬æœ‰äº‘çš„æ¥å£æ¥ç”³è¯·åˆ›å»ºæœºå™¨æˆ–è€…é”€æ¯æœºå™¨ã€‚å¯¹äºç§æœ‰äº‘ï¼Œåˆ™éœ€è¦å¯¹æ¥å†…éƒ¨çš„ç®¡ç†å¹³å°ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰ HPA å’Œ VPA ä¸å…¼å®¹ï¼Œåªèƒ½é€‰æ‹©ä¸€ä¸ªä½¿ç”¨ï¼Œå¦åˆ™ä¸¤è€…ä¼šç›¸äº’å¹²æ‰°ã€‚è€Œä¸” VPA çš„è°ƒæ•´éœ€è¦é‡å¯ podï¼Œè¿™æ˜¯å› ä¸º pod èµ„æºçš„ä¿®æ”¹æ˜¯æ¯”è¾ƒå¤§çš„å˜åŒ–ï¼Œéœ€è¦é‡æ–°èµ°ä¸€ä¸‹ apiserverã€è°ƒåº¦çš„æµç¨‹ï¼Œä¿è¯æ•´ä¸ªç³»ç»Ÿæ²¡æœ‰é—®é¢˜ã€‚ç›®å‰ç¤¾åŒºä¹Ÿæœ‰è®¡åˆ’åœ¨åšåŸåœ°å‡çº§ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸é€šè¿‡æ€æ­» pod å†è°ƒåº¦æ–° pod çš„æ–¹å¼ï¼Œè€Œæ˜¯ç›´æ¥ä¿®æ”¹åŸæœ‰ pod æ¥æ›´æ–°ã€‚&lt;/p&gt;
&lt;p&gt;ç†è®ºä¸Š HPA å’Œ VPA æ˜¯å¯ä»¥å…±åŒå·¥ä½œçš„ï¼ŒHPA è´Ÿè´£ç“¶é¢ˆèµ„æºï¼ŒVPA è´Ÿè´£å…¶ä»–èµ„æºã€‚æ¯”å¦‚å¯¹äº CPU å¯†é›†å‹çš„åº”ç”¨ï¼Œä½¿ç”¨ HPA ç›‘å¬ CPU ä½¿ç”¨ç‡æ¥è°ƒæ•´ pods ä¸ªæ•°ï¼Œç„¶åç”¨ VPA ç›‘å¬å…¶ä»–èµ„æºï¼ˆmemoryã€IOï¼‰æ¥åŠ¨æ€æ‰©å±•è¿™äº›èµ„æºçš„ request å¤§å°å³å¯ã€‚å½“ç„¶è¿™åªæ˜¯ç†æƒ³æƒ…å†µï¼Œ&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;ä»å‰é¢ä»‹ç»çš„å„ç§ kubernetes è°ƒåº¦å’Œèµ„æºç®¡ç†æ–¹æ¡ˆå¯ä»¥çœ‹å‡ºæ¥ï¼Œæé«˜åº”ç”¨çš„èµ„æºä½¿ç”¨ç‡ã€ä¿è¯åº”ç”¨çš„æ­£å¸¸è¿è¡Œã€ç»´æŠ¤è°ƒåº¦å’Œé›†ç¾¤çš„å…¬å¹³æ€§æ˜¯ä»¶éå¸¸å¤æ‚çš„äº‹æƒ…ï¼Œkubernetes å¹¶æ²¡æœ‰&lt;em&gt;å®Œç¾&lt;/em&gt;çš„æ–¹æ³•ï¼Œè€Œæ˜¯å¯¹å„ç§å¯èƒ½çš„é—®é¢˜ä¸æ–­æå‡ºä¸€äº›é’ˆå¯¹æ€§çš„æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;é›†ç¾¤çš„èµ„æºä½¿ç”¨å¹¶ä¸æ˜¯é™æ€çš„ï¼Œè€Œæ˜¯éšç€æ—¶é—´ä¸æ–­å˜åŒ–çš„ï¼Œç›®å‰ kubernetes çš„è°ƒåº¦å†³ç­–éƒ½æ˜¯åŸºäºè°ƒåº¦æ—¶é›†ç¾¤çš„ä¸€ä¸ªé™æ€èµ„æºåˆ‡ç‰‡è¿›è¡Œçš„ï¼ŒåŠ¨æ€åœ°èµ„æºè°ƒæ•´æ˜¯é€šè¿‡ kubelet çš„é©±é€ç¨‹åºè¿›è¡Œçš„ï¼ŒHPA å’Œ VPA ç­‰æ–¹æ¡ˆä¹Ÿä¸æ–­æå‡ºï¼Œç›¸ä¿¡åé¢ä¼šä¸æ–­å®Œå–„è¿™æ–¹é¢çš„åŠŸèƒ½ï¼Œè®© kubernetes æ›´åŠ æ™ºèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;èµ„æºç®¡ç†å’Œè°ƒåº¦ã€åº”ç”¨ä¼˜å…ˆçº§ã€ç›‘æ§ã€é•œåƒä¸­å¿ƒç­‰å¾ˆå¤šä¸œè¥¿ç›¸å…³ï¼Œæ˜¯ä¸ªéå¸¸å¤æ‚çš„é¢†åŸŸã€‚åœ¨å…·ä½“çš„å®æ–½å’Œæ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œå¸¸å¸¸è¦è€ƒè™‘åˆ°ä¼ä¸šå†…éƒ¨çš„å…·ä½“æƒ…å†µå’Œéœ€æ±‚ï¼Œåšå‡ºé’ˆå¯¹æ€§çš„è°ƒæ•´ï¼Œå¹¶ä¸”éœ€è¦å¼€å‘è€…ã€ç³»ç»Ÿç®¡ç†å‘˜ã€SREã€ç›‘æ§å›¢é˜Ÿç­‰ä¸åŒå°ç»„ä¸€èµ·åˆä½œã€‚ä½†æ˜¯è¿™ç§ä»˜å‡ºä»æ•´ä½“æ¥çœ‹æ˜¯å€¼å¾—çš„ï¼Œæå‡èµ„æºçš„åˆ©ç”¨ç‡èƒ½æœ‰æ•ˆåœ°èŠ‚çº¦ä¼ä¸šçš„æˆæœ¬ï¼Œä¹Ÿèƒ½è®©åº”ç”¨æ›´å¥½åœ°å‘æŒ¥å‡ºä½œç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒæ–‡æ¡£&#34;&gt;å‚è€ƒæ–‡æ¡£&lt;/h2&gt;
&lt;p&gt;kubernetes å®˜æ–¹æ–‡æ¡£ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Managing Compute Resources for Containers&lt;/a&gt;ï¼šå¦‚ä½•ä¸º pod é…ç½® cpu å’Œ memory èµ„æº&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Configure Quality of Service for Pods - Kubernetes&lt;/a&gt;ï¼špod QoS çš„å®šä¹‰å’Œé…ç½®è§„åˆ™&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/administer-cluster/out-of-resource/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Configure Out Of Resource Handling - Kubernetes&lt;/a&gt;ï¼šé…ç½®èµ„æºä¸è¶³æ—¶ kubernetes çš„ å¤„ç†æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ eviction&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/policy/resource-quotas/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes å®˜æ–¹æ–‡æ¡£ï¼šResource Quota&lt;/a&gt;ï¼šä¸º namespace é…ç½® quota&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/community/blob/master/contributors/design-proposals/node/resource-qos.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;community/resource-qos.md at master Â· kubernetes/community Â· GitHub&lt;/a&gt;ï¼šQoS è®¾è®¡æ–‡æ¡£&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/administer-cluster/reserve-compute-resources/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Reserve Compute Resources for System Daemons&lt;/a&gt;ï¼šå¦‚ä½•åœ¨èŠ‚ç‚¹ä¸Šé¢„ç•™èµ„æº&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes-incubator/descheduler&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GitHub - kubernetes-incubator/descheduler: Descheduler for Kubernetes&lt;/a&gt;ï¼šdescheduler é‡è°ƒåº¦å®˜æ–¹ repo&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Horizontal Pod Autoscaler - Kubernetes&lt;/a&gt;ï¼škubernetes HPA ä»‹ç»æ–‡æ¡£&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/community/blob/master/contributors/design-proposals/autoscaling/vertical-pod-autoscaler.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;community/vertical-pod-autoscaler.md at master Â· kubernetes/community Â· GitHub&lt;/a&gt;: kubernetes VPA è®¾è®¡æ–‡æ¡£&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¶ä»–æ–‡æ¡£ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://speakerdeck.com/thockin/everything-you-ever-wanted-to-know-about-resource-scheduling-dot-dot-dot-almost&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Everything You Ever Wanted To Know About Resource Schedulingâ€¦ Almost - Speaker Deck&lt;/a&gt;: Tim Hockin åœ¨ kubecon ä¸Šä»‹ç»çš„ kubernetes èµ„æºç®¡ç†ç†å¿µï¼Œå¼ºçƒˆæ¨è&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://mp.weixin.qq.com/s/hyPNOcR3Nhy9bAiDhXUP7A&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;èŠèŠ Kubernetes è®¡ç®—èµ„æºæ¨¡å‹ï¼ˆä¸Šï¼‰â€”â€”èµ„æºæŠ½è±¡ã€è®¡é‡ä¸è°ƒåº¦&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.atatech.org/articles/99071&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ã€Sigma æ•æ·ç‰ˆç³»åˆ—æ–‡ç« ã€‘kubernetes åº”ç”¨é©±é€åˆ†æ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.atatech.org/articles/99071&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes åº”ç”¨é©±é€åˆ†æ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.noqcks.io/notes/2018/02/03/understanding-kubernetes-resources/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Understanding Kubernetes Resources | Benji Visser&lt;/a&gt;ï¼šä»‹ç»äº† kubernetes çš„èµ„æºæ¨¡å‹&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cloud.tencent.com/developer/article/1004976&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes èµ„æºåˆ†é…ä¹‹ Request å’Œ Limit è§£æ - äº‘ + ç¤¾åŒº - è…¾è®¯äº‘&lt;/a&gt;ï¼šç”¨å›¾è¡¨çš„æ–¹å¼è§£é‡Šäº† requests å’Œ limits çš„å«ä¹‰ï¼Œä»¥åŠåœ¨æé«˜èµ„æºä½¿ç”¨ç‡æ–¹é¢çš„ä½œç”¨&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://my.oschina.net/HardySimpson/blog/1359276&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes ä¸­å®¹å™¨èµ„æºæ§åˆ¶çš„é‚£äº›äº‹å„¿&lt;/a&gt;ï¼šè¿™ç¯‡æ–‡ç« ä»‹ç»äº† kubernetes pod ä¸­ cpu å’Œ memory çš„ request å’Œ limits æ˜¯å¦‚ä½•æœ€ç»ˆå˜æˆ cgroups é…ç½®çš„&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://medium.com/@Rancher_Labs/the-three-pillars-of-kubernetes-container-orchestration-247f42115a4a&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The Three Pillars of Kubernetes Container Orchestration&lt;/a&gt;ï¼škubernetes è°ƒåº¦ã€èµ„æºç®¡ç†å’ŒæœåŠ¡ä»‹ç»&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.slideshare.net/AmazonWebServices/dem19-advanced-auto-scaling-and-deployment-tools-for-kubernetes-and-ecs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;DEM19 Advanced Auto Scaling and Deployment Tools for Kubernetes and Eâ€¦&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://my.oschina.net/jxcdwangtao/blog/837875&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes Resource QoS æœºåˆ¶è§£è¯»&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.jianshu.com/p/a5a7b3fb6806&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ·±å…¥è§£æ kubernetes èµ„æºç®¡ç†ï¼Œå®¹å™¨äº‘ç‰›äººæœ‰è¯è¯´ - ç®€ä¹¦&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>å¦‚ä½•ä»é›¶å¼€å§‹ç¼–å†™ä¸€ä¸ª Kubernetes CRD</title>
      <link>https://cloudnativecn.com/blog/kubernetes-crd-quick-start/</link>
      <pubDate>Wed, 12 Dec 2018 11:39:01 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/kubernetes-crd-quick-start/</guid>
      <description>&lt;p&gt;æœ¬æ–‡é¦–å…ˆå‘ä½ ç®€å•ä»‹ç»äº† Kubernetesï¼Œç„¶åæ•™ä½ ä»é›¶å¼€å§‹æ„å»ºä¸€ä¸ª Kubernetes CRDã€‚å¦‚æœä½ å·²ç»å¯¹ Kubernetes ååˆ†äº†è§£çš„è¯å¯ä»¥è·³è¿‡æœ¬æ–‡å‰åŠéƒ¨åˆ†çš„ Kubernetes ä»‹ç»ï¼Œç›´æ¥ä» Controller éƒ¨åˆ†å¼€å§‹é˜…è¯»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¿«é€Ÿå…¥é—¨-kubernetes&#34;&gt;å¿«é€Ÿå…¥é—¨ Kubernetes&lt;/h2&gt;
&lt;p&gt;Kubernetes æ˜¯ä¸€ä¸ªå®¹å™¨ç®¡ç†ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸºäºå®¹å™¨çš„åº”ç”¨éƒ¨ç½²ã€ç»´æŠ¤å’Œæ»šåŠ¨å‡çº§&lt;/li&gt;
&lt;li&gt;è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡å‘ç°&lt;/li&gt;
&lt;li&gt;è·¨æœºå™¨å’Œè·¨åœ°åŒºçš„é›†ç¾¤è°ƒåº¦&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨ä¼¸ç¼©&lt;/li&gt;
&lt;li&gt;æ— çŠ¶æ€æœåŠ¡å’Œæœ‰çŠ¶æ€æœåŠ¡&lt;/li&gt;
&lt;li&gt;å¹¿æ³›çš„ Volume æ”¯æŒ&lt;/li&gt;
&lt;li&gt;æ’ä»¶æœºåˆ¶ä¿è¯æ‰©å±•æ€§&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡é˜…è¯»&lt;a href=&#34;https://kubernetes.feisky.xyz/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes æŒ‡å—&lt;/a&gt;å’Œ&lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes HandBook&lt;/a&gt;ä»¥åŠ&lt;a href=&#34;https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt; æˆ–è€… é˜…è¯»&lt;a href=&#34;https://book.douban.com/subject/27112874/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt; Kubernetes æƒå¨æŒ‡å—&lt;/a&gt;å¯ä»¥è·å¾—æ›´å¥½çš„å­¦ä¹ ä½“éªŒã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å¼€å§‹å®‰è£… Kubernetes ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ï¼š&lt;/p&gt;
&lt;h3 id=&#34;1docker-ä¸-kubernetes&#34;&gt;1ã€Docker ä¸ Kubernetes&lt;/h3&gt;
&lt;p&gt;Docker æ˜¯ä¸€ä¸ªå®¹å™¨è¿è¡Œæ—¶çš„å®ç°ï¼ŒKubernetes ä¾èµ–äºæŸç§å®¹å™¨è¿è¡Œæ—¶çš„å®ç°ã€‚&lt;/p&gt;
&lt;h3 id=&#34;2pod&#34;&gt;2ã€Pod&lt;/h3&gt;
&lt;p&gt;Kubernetes ä¸­æœ€åŸºæœ¬çš„è°ƒåº¦å•ä½æ˜¯ Podï¼ŒPod ä»å±äº Nodeï¼ˆç‰©ç†æœºæˆ–è™šæ‹Ÿæœºï¼‰ï¼ŒPod ä¸­å¯ä»¥è¿è¡Œå¤šä¸ª Docker å®¹å™¨ï¼Œä¼šå…±äº« PIDã€IPCã€Network å’Œ UTS namespaceã€‚Pod åœ¨åˆ›å»ºæ—¶ä¼šè¢«åˆ†é…ä¸€ä¸ª IP åœ°å€ï¼ŒPod é—´çš„å®¹å™¨å¯ä»¥äº’ç›¸é€šä¿¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;3yaml&#34;&gt;3ã€Yaml&lt;/h3&gt;
&lt;p&gt;Kubernetes ä¸­æœ‰ç€å¾ˆå¤šæ¦‚å¿µï¼Œå®ƒä»¬éƒ½ç®—åšæ˜¯ä¸€ç§å¯¹è±¡ï¼Œå¦‚ Podã€Deploymentã€Service ç­‰ï¼Œéƒ½å¯ä»¥é€šè¿‡ä¸€ä¸ª yaml æ–‡ä»¶æ¥è¿›è¡Œæè¿°ï¼Œå¹¶å¯ä»¥å¯¹è¿™äº›å¯¹è±¡è¿›è¡Œ CRUD æ“ä½œï¼ˆå¯¹åº” REST ä¸­çš„å„ç§ HTTP æ–¹æ³•ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢ä¸€ä¸ª Pod çš„ yaml æ–‡ä»¶ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-nginx-app&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-nginx-app&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx:1.7.9&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;kindï¼šå¯¹è±¡çš„ç±»åˆ«&lt;/p&gt;
&lt;p&gt;metadataï¼šå…ƒæ•°æ®ï¼Œå¦‚ Pod çš„åç§°ï¼Œä»¥åŠæ ‡ç­¾ Labelã€ç”¨äºè¯†åˆ«ä¸€ç³»åˆ—å…³è”çš„ Podï¼Œå¯ä»¥ä½¿ç”¨ Label Selector æ¥é€‰æ‹©ä¸€ç»„ç›¸åŒ label çš„å¯¹è±¡ã€‘&lt;/p&gt;
&lt;p&gt;specï¼šå¸Œæœ› Pod èƒ½è¾¾åˆ°çš„çŠ¶æ€ï¼Œåœ¨æ­¤ä½“ç°äº† Kubernetes çš„å£°æ˜å¼çš„æ€æƒ³ï¼Œæˆ‘ä»¬åªéœ€è¦å®šä¹‰å‡ºæœŸæœ›è¾¾åˆ°çš„çŠ¶æ€ï¼Œè€Œä¸éœ€è¦å…³å¿ƒå¦‚ä½•è¾¾åˆ°è¿™ä¸ªçŠ¶æ€ï¼Œè¿™éƒ¨åˆ†å·¥ä½œç”± Kubernetes æ¥å®Œæˆã€‚è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº† Pod ä¸­è¿è¡Œçš„å®¹å™¨åˆ—è¡¨ï¼ŒåŒ…æ‹¬ä¸€ä¸ª nginx å®¹å™¨ï¼Œè¯¥å®¹å™¨å¯¹å¤–æš´éœ²äº† 80 ç«¯å£ã€‚&lt;/p&gt;
&lt;h3 id=&#34;4node&#34;&gt;4ã€Node&lt;/h3&gt;
&lt;p&gt;Node æ˜¯ Pod çœŸæ­£è¿è¡Œçš„ä¸»æœºï¼Œå¯ä»¥æ˜¯ç‰©ç†æœºï¼Œä¹Ÿå¯ä»¥æ˜¯è™šæ‹Ÿæœºã€‚ä¸ºäº†ç®¡ç† Podï¼Œæ¯ä¸ª Node èŠ‚ç‚¹ä¸Šè‡³å°‘è¦è¿è¡Œ container runtimeã€&lt;code&gt;kubelet&lt;/code&gt; å’Œ &lt;code&gt;kube-proxy&lt;/code&gt; æœåŠ¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;5deployment&#34;&gt;5ã€Deployment&lt;/h3&gt;
&lt;p&gt;Deployment ç”¨äºç®¡ç†ä¸€ä¸ªæ— çŠ¶æ€åº”ç”¨ï¼Œå¯¹åº”ä¸€ä¸ª Pod çš„é›†ç¾¤ï¼Œæ¯ä¸ª Pod çš„åœ°ä½æ˜¯å¯¹ç­‰çš„ï¼Œå¯¹ Deployment æ¥è¯´åªæ˜¯ç”¨äºç»´æŠ¤ä¸€å®šæ•°é‡çš„ Podï¼Œè¿™äº› Pod æœ‰ç€ç›¸åŒçš„ Pod æ¨¡æ¿ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-nginx-app&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-nginx-app&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-nginx-app&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx:1.7.9&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥å¯¹ Deployment è¿›è¡Œéƒ¨ç½²ã€å‡çº§ã€æ‰©ç¼©å®¹ç­‰æ“ä½œã€‚&lt;/p&gt;
&lt;h3 id=&#34;6service&#34;&gt;6ã€Service&lt;/h3&gt;
&lt;p&gt;Service ç”¨äºå°†ä¸€ç»„ Pod æš´éœ²ä¸ºä¸€ä¸ªæœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ kubernetes ä¸­ï¼ŒPod çš„ IP åœ°å€ä¼šéšç€ Pod çš„é‡å¯è€Œå˜åŒ–ï¼Œå¹¶ä¸å»ºè®®ç›´æ¥æ‹¿ Pod çš„ IP æ¥äº¤äº’ã€‚é‚£å¦‚ä½•æ¥è®¿é—®è¿™äº› Pod æä¾›çš„æœåŠ¡å‘¢ï¼Ÿä½¿ç”¨ Serviceã€‚Service ä¸ºä¸€ç»„ Podï¼ˆé€šè¿‡ labels æ¥é€‰æ‹©ï¼‰æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£ï¼Œå¹¶ä¸ºå®ƒä»¬æä¾›è´Ÿè½½å‡è¡¡å’Œè‡ªåŠ¨æœåŠ¡å‘ç°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-nginx-app&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-nginx-app&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NodePort     &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#è¿™é‡Œä»£è¡¨æ˜¯ NodePort ç±»å‹çš„&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# è¿™é‡Œçš„ç«¯å£å’Œ clusterIP(10.97.114.36) å¯¹åº”ï¼Œå³ 10.97.114.36:80ï¼Œä¾›å†…éƒ¨è®¿é—®ã€‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# ç«¯å£ä¸€å®šè¦å’Œ container æš´éœ²å‡ºæ¥çš„ç«¯å£å¯¹åº”&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;nodePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;32143&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# æ¯ä¸ª Node ä¼šå¼€å¯ï¼Œæ­¤ç«¯å£ä¾›å¤–éƒ¨è°ƒç”¨ã€‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-nginx-app&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;7kubernetes-ç»„ä»¶&#34;&gt;7ã€Kubernetes ç»„ä»¶&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;etcd ä¿å­˜äº†æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€ï¼›&lt;/li&gt;
&lt;li&gt;apiserver æä¾›äº†èµ„æºæ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œå¹¶æä¾›è®¤è¯ã€æˆæƒã€è®¿é—®æ§åˆ¶ã€API æ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶ï¼›&lt;/li&gt;
&lt;li&gt;controller manager è´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚æ•…éšœæ£€æµ‹ã€è‡ªåŠ¨æ‰©å±•ã€æ»šåŠ¨æ›´æ–°ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;scheduler è´Ÿè´£èµ„æºçš„è°ƒåº¦ï¼ŒæŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥å°† Pod è°ƒåº¦åˆ°ç›¸åº”çš„æœºå™¨ä¸Šï¼›&lt;/li&gt;
&lt;li&gt;kubelet è´Ÿè´£ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒæ—¶ä¹Ÿè´Ÿè´£ Volumeï¼ˆCVIï¼‰å’Œç½‘ç»œï¼ˆCNIï¼‰çš„ç®¡ç†ï¼›&lt;/li&gt;
&lt;li&gt;Container runtime è´Ÿè´£é•œåƒç®¡ç†ä»¥åŠ Pod å’Œå®¹å™¨çš„çœŸæ­£è¿è¡Œï¼ˆCRIï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;kube-proxy è´Ÿè´£ä¸º Service æä¾› cluster å†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å®‰è£…-kubernetesminikube&#34;&gt;å®‰è£… Kubernetesã€Minikubeã€‘&lt;/h2&gt;
&lt;p&gt;minikube ä¸ºå¼€å‘æˆ–è€…æµ‹è¯•åœ¨æœ¬åœ°å¯åŠ¨ä¸€ä¸ªèŠ‚ç‚¹çš„ kubernetes é›†ç¾¤ï¼Œminikube æ‰“åŒ…äº†å’Œé…ç½®ä¸€ä¸ª linux è™šæ‹Ÿæœºã€docker ä¸ kubernetes ç»„ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes é›†ç¾¤æ˜¯ç”± Master å’Œ Node ç»„æˆçš„ï¼ŒMaster ç”¨äºè¿›è¡Œé›†ç¾¤ç®¡ç†ï¼ŒNode ç”¨äºè¿è¡Œ Pod ç­‰ workloadã€‚è€Œ minikube æ˜¯ä¸€ä¸ª Kubernetes é›†ç¾¤çš„æœ€å°é›†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;1å®‰è£…-virtualbox&#34;&gt;1ã€å®‰è£… virtualbox&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://www.virtualbox.org/wiki/Downloads&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.virtualbox.org/wiki/Downloads&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;2å®‰è£…-minikube&#34;&gt;2ã€å®‰è£… minikube&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;curl -Lo minikube https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64 &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; chmod +x minikube &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo mv minikube /usr/local/bin/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;3å¯ç”¨-dashboardweb-consoleå¯é€‰&#34;&gt;3ã€å¯ç”¨ dashboardï¼ˆweb consoleï¼‰ã€å¯é€‰ã€‘&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;minikube addons &lt;span class=&#34;nb&#34;&gt;enable&lt;/span&gt; dashboard
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¼€å¯ dashboard&lt;/p&gt;
&lt;h3 id=&#34;4å¯åŠ¨-minikube&#34;&gt;4ã€å¯åŠ¨ minikube&lt;/h3&gt;
&lt;p&gt;minikube start&lt;/p&gt;
&lt;p&gt;start ä¹‹åå¯ä»¥é€šè¿‡ minikube status æ¥æŸ¥çœ‹çŠ¶æ€ï¼Œå¦‚æœ minikube å’Œ cluster éƒ½æ˜¯ Runningï¼Œåˆ™è¯´æ˜å¯åŠ¨æˆåŠŸã€‚&lt;/p&gt;
&lt;h3 id=&#34;5æŸ¥çœ‹å¯åŠ¨çŠ¶æ€&#34;&gt;5ã€æŸ¥çœ‹å¯åŠ¨çŠ¶æ€&lt;/h3&gt;
&lt;p&gt;kubectl get pods&lt;/p&gt;
&lt;h2 id=&#34;kubectl-ä½“éªŒä»¥ä¸€ä¸ª-deployment-ä¸ºä¾‹&#34;&gt;kubectl ä½“éªŒã€ä»¥ä¸€ä¸ª Deployment ä¸ºä¾‹ã€‘&lt;/h2&gt;
&lt;p&gt;kubectl æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºå‘ API Server å‘é€æŒ‡ä»¤ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä»¥éƒ¨ç½²ã€å‡çº§ã€æ‰©ç¼©å®¹ä¸€ä¸ª Deploymentã€å‘å¸ƒä¸€ä¸ª Service ä¸ºä¾‹ä½“éªŒä¸€ä¸‹ Kubernetesã€‚&lt;/p&gt;
&lt;p&gt;å‘½ä»¤çš„é€šå¸¸æ ¼å¼ä¸ºï¼š&lt;/p&gt;
&lt;p&gt;kubectl $operation $object_type(å•æ•° or å¤æ•°) $object_name other params&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;operation å¦‚ get,replace,create,expose,delete ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;object_type æ˜¯æ“ä½œçš„å¯¹è±¡ç±»å‹ï¼Œå¦‚ pods,deployments,services&lt;/li&gt;
&lt;li&gt;object_name æ˜¯å¯¹è±¡çš„ name&lt;/li&gt;
&lt;li&gt;åé¢å¯ä»¥åŠ ä¸€äº›å…¶ä»–å‚æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;kubectl å‘½ä»¤è¡¨ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://docs.kubernetes.org.cn/490.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://docs.kubernetes.org.cn/490.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Deployment çš„æ–‡æ¡£ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/workloads/controllers/deployment/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.io/docs/concepts/workloads/controllers/deployment/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://kubernetes.feisky.xyz/he-xin-yuan-li/index-2/deployment&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.feisky.xyz/he-xin-yuan-li/index-2/deployment&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;1åˆ›å»ºä¸€ä¸ª-deployment&#34;&gt;1ã€åˆ›å»ºä¸€ä¸ª Deployment&lt;/h3&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨ kubectl run æ¥è¿è¡Œï¼Œä¹Ÿå¯ä»¥åŸºäºç°æœ‰çš„ yaml æ–‡ä»¶æ¥ createã€‚&lt;/p&gt;
&lt;p&gt;kubectl run &amp;ndash;image=nginx:1.7.9 nginx-app &amp;ndash;port=80&lt;/p&gt;
&lt;p&gt;æˆ–è€…&lt;/p&gt;
&lt;p&gt;kubectl create -f my-nginx-deployment.yaml&lt;/p&gt;
&lt;p&gt;my-nginx-deployment æ˜¯ä¸‹é¢è¿™ä¸ª yaml æ–‡ä»¶çš„åç§°&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apps/v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Deployment&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-nginx-app&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;matchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-nginx-app&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-nginx-app&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;containers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;nginx:1.7.9&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;containerPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åå¯ä»¥é€šè¿‡ kubectl get pods æ¥æŸ¥çœ‹åˆ›å»ºå¥½äº†çš„ 3 ä¸ª Podã€‚&lt;/p&gt;
&lt;p&gt;Pod çš„åç§°æ˜¯ä»¥æ‰€å± Deployment åç§°ä¸ºå‰ç¼€ï¼Œåé¢åŠ ä¸Šå”¯ä¸€æ ‡è¯†ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;img&#34; srcset=&#34;
               /blog/kubernetes-crd-quick-start/1544518231685-e9c0845a-8dad-408e-9c6f-57800a66df01_hu7518521283414311456.webp 400w,
               /blog/kubernetes-crd-quick-start/1544518231685-e9c0845a-8dad-408e-9c6f-57800a66df01_hu8500518656172085740.webp 760w,
               /blog/kubernetes-crd-quick-start/1544518231685-e9c0845a-8dad-408e-9c6f-57800a66df01_hu6820899060507835678.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-crd-quick-start/1544518231685-e9c0845a-8dad-408e-9c6f-57800a66df01_hu7518521283414311456.webp&#34;
               width=&#34;760&#34;
               height=&#34;146&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å†é€šè¿‡ kubectl get deployments æ¥æŸ¥çœ‹åˆ›å»ºå¥½äº†çš„ deploymentã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;img&#34; srcset=&#34;
               /blog/kubernetes-crd-quick-start/1544518292310-4471b767-bc93-4af7-b81c-2382903a7127_hu3944578987922920675.webp 400w,
               /blog/kubernetes-crd-quick-start/1544518292310-4471b767-bc93-4af7-b81c-2382903a7127_hu17498380017186600604.webp 760w,
               /blog/kubernetes-crd-quick-start/1544518292310-4471b767-bc93-4af7-b81c-2382903a7127_hu14432932740409489049.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-crd-quick-start/1544518292310-4471b767-bc93-4af7-b81c-2382903a7127_hu3944578987922920675.webp&#34;
               width=&#34;760&#34;
               height=&#34;93&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæœ‰ 4 åˆ—ï¼Œåˆ†åˆ«æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;DESIREDï¼šPod å‰¯æœ¬æ•°é‡çš„æœŸæœ›å€¼ï¼Œå³ Deployment é‡Œé¢å®šä¹‰çš„ replicas&lt;/li&gt;
&lt;li&gt;CURRENTï¼šå½“å‰ Replicas çš„å€¼&lt;/li&gt;
&lt;li&gt;UP-TO-DATEï¼šæœ€æ–°ç‰ˆæœ¬çš„ Pod çš„å‰¯æœ¬æ¢³ç†ï¼Œç”¨äºæŒ‡ç¤ºåœ¨æ»šåŠ¨å‡çº§çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰å¤šå°‘ä¸ª Pod å‰¯æœ¬å·²ç»æˆåŠŸå‡çº§&lt;/li&gt;
&lt;li&gt;AVAILABLEï¼šé›†ç¾¤ä¸­å½“å‰å­˜æ´»çš„ Pod æ•°é‡&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;2åˆ é™¤æ‰ä»»æ„ä¸€ä¸ª-pod&#34;&gt;2ã€åˆ é™¤æ‰ä»»æ„ä¸€ä¸ª Pod&lt;/h3&gt;
&lt;p&gt;Deployment è‡ªèº«æ‹¥æœ‰å‰¯æœ¬ä¿æŒæœºåˆ¶ï¼Œä¼šå§‹ç»ˆå°†å…¶æ‰€ç®¡ç†çš„ Pod æ•°é‡ä¿æŒä¸º spec ä¸­å®šä¹‰çš„ replicas æ•°é‡ã€‚&lt;/p&gt;
&lt;p&gt;kubectl delete pods $pod_name&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;img&#34; srcset=&#34;
               /blog/kubernetes-crd-quick-start/1544519374539-04b1078a-0639-49e1-bc25-7a21fb154221_hu12589924432007194764.webp 400w,
               /blog/kubernetes-crd-quick-start/1544519374539-04b1078a-0639-49e1-bc25-7a21fb154221_hu14403102806707517489.webp 760w,
               /blog/kubernetes-crd-quick-start/1544519374539-04b1078a-0639-49e1-bc25-7a21fb154221_hu3166519218058920756.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-crd-quick-start/1544519374539-04b1078a-0639-49e1-bc25-7a21fb154221_hu12589924432007194764.webp&#34;
               width=&#34;760&#34;
               height=&#34;452&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºè¢«åˆ æ‰çš„ Pod çš„å…³é—­ä¸ä»£æ›¿å®ƒçš„ Pod çš„å¯åŠ¨è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;3ç¼©æ‰©å®¹&#34;&gt;3ã€ç¼©æ‰©å®¹&lt;/h3&gt;
&lt;p&gt;ç¼©æ‰©å®¹æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼Œä¸€ç§æ˜¯ä¿®æ”¹ yaml æ–‡ä»¶ï¼Œå°† replicas ä¿®æ”¹ä¸ºæ–°çš„å€¼ï¼Œç„¶å kubectl replace -f my-nginx-deployment.yamlï¼›&lt;/p&gt;
&lt;p&gt;å¦ä¸€ç§æ˜¯ä½¿ç”¨ scale å‘½ä»¤ï¼škubectl scale deployment $deployment_name &amp;ndash;replicas=5&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;img&#34; srcset=&#34;
               /blog/kubernetes-crd-quick-start/1544519680442-8e70970a-0a83-4bdf-b936-61004a0866b2_hu740224066060167294.webp 400w,
               /blog/kubernetes-crd-quick-start/1544519680442-8e70970a-0a83-4bdf-b936-61004a0866b2_hu10868306383621681417.webp 760w,
               /blog/kubernetes-crd-quick-start/1544519680442-8e70970a-0a83-4bdf-b936-61004a0866b2_hu8479320799199349378.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-crd-quick-start/1544519680442-8e70970a-0a83-4bdf-b936-61004a0866b2_hu740224066060167294.webp&#34;
               width=&#34;760&#34;
               height=&#34;368&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;4æ›´æ–°&#34;&gt;4ã€æ›´æ–°&lt;/h3&gt;
&lt;p&gt;æ›´æ–°ä¹Ÿæ˜¯æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼ŒKubernetes çš„å‡çº§å¯ä»¥å®ç°æ— ç¼å‡çº§ï¼Œå³ä¸éœ€è¦è¿›è¡Œåœæœºã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ç§æ˜¯ rolling-update æ–¹å¼ï¼Œé‡å»º Podï¼Œedit/replace/set image ç­‰å‡å¯ä»¥å®ç°ã€‚æ¯”å¦‚è¯´æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ yaml æ–‡ä»¶ï¼Œç„¶å kubectl replace -f my-nginx-deployment.yamlï¼Œä¹Ÿå¯ä»¥ kubectl set image $resource_type/$resource_name $container_name=nginx:1.9.1&lt;/p&gt;
&lt;p&gt;å¦ä¸€ç§æ˜¯ patch æ–¹å¼ï¼Œpatch ä¸ä¼šå»é‡å»º Podï¼ŒPod çš„ IP å¯ä»¥ä¿æŒã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;img&#34; srcset=&#34;
               /blog/kubernetes-crd-quick-start/1544520068001-1586cdc2-4327-466b-b25c-fa9ccbd03cb2_hu4598562250158931083.webp 400w,
               /blog/kubernetes-crd-quick-start/1544520068001-1586cdc2-4327-466b-b25c-fa9ccbd03cb2_hu10144641073767064852.webp 760w,
               /blog/kubernetes-crd-quick-start/1544520068001-1586cdc2-4327-466b-b25c-fa9ccbd03cb2_hu17795299101728676567.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-crd-quick-start/1544520068001-1586cdc2-4327-466b-b25c-fa9ccbd03cb2_hu4598562250158931083.webp&#34;
               width=&#34;760&#34;
               height=&#34;730&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;kubectl get pods -o yaml å¯ä»¥ä»¥ yaml çš„æ ¼å¼æ¥æŸ¥çœ‹ Pod&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;img&#34; srcset=&#34;
               /blog/kubernetes-crd-quick-start/1544520388837-726a9f6c-6f5d-4c74-906d-dbd2ad68c622_hu13739170185677978796.webp 400w,
               /blog/kubernetes-crd-quick-start/1544520388837-726a9f6c-6f5d-4c74-906d-dbd2ad68c622_hu370206047903850902.webp 760w,
               /blog/kubernetes-crd-quick-start/1544520388837-726a9f6c-6f5d-4c74-906d-dbd2ad68c622_hu11955780704740834057.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-crd-quick-start/1544520388837-726a9f6c-6f5d-4c74-906d-dbd2ad68c622_hu13739170185677978796.webp&#34;
               width=&#34;760&#34;
               height=&#34;614&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;è¿™é‡Œå¯ä»¥çœ‹å‡ºå®¹å™¨çš„ç‰ˆæœ¬å·²ç»è¢«æ›´æ–°åˆ°äº† 1.9.1ã€‚&lt;/p&gt;
&lt;h3 id=&#34;5æš´éœ²æœåŠ¡&#34;&gt;5ã€æš´éœ²æœåŠ¡&lt;/h3&gt;
&lt;p&gt;æš´éœ²æœåŠ¡ä¹Ÿæœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼Œä¸€ç§æ˜¯é€šè¿‡ kubectl create -f my-nginx-service.yaml å¯ä»¥åˆ›å»ºä¸€ä¸ªæœåŠ¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Service&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-nginx-app&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-nginx-app&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;NodePort     &lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;#è¿™é‡Œä»£è¡¨æ˜¯ NodePort ç±»å‹çš„&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;ports&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;- &lt;span class=&#34;nt&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# è¿™é‡Œçš„ç«¯å£å’Œ clusterIP(10.97.114.36) å¯¹åº”ï¼Œå³ 10.97.114.36:80ï¼Œä¾›å†…éƒ¨è®¿é—®ã€‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;targetPort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# ç«¯å£ä¸€å®šè¦å’Œ container æš´éœ²å‡ºæ¥çš„ç«¯å£å¯¹åº”&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;TCP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;nodePort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;32143&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# æ¯ä¸ª Node ä¼šå¼€å¯ï¼Œæ­¤ç«¯å£ä¾›å¤–éƒ¨è°ƒç”¨ã€‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;selector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;app&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-nginx-app&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ports ä¸­æœ‰ä¸‰ä¸ªç«¯å£ï¼Œç¬¬ä¸€ä¸ª port æ˜¯ Pod ä¾›å†…éƒ¨è®¿é—®æš´éœ²çš„ç«¯å£ï¼Œç¬¬äºŒä¸ª targetPort æ˜¯ Pod çš„ Container ä¸­é…ç½®çš„ containerPortï¼Œç¬¬ä¸‰ä¸ª nodePort æ˜¯ä¾›å¤–éƒ¨è°ƒç”¨çš„ç«¯å£ã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€ç§æ˜¯é€šè¿‡ kubectl expose å‘½ä»¤å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;minikube ip è¿”å›çš„å°±æ˜¯ minikube æ‰€ç®¡ç†çš„ Kubernetes é›†ç¾¤æ‰€åœ¨çš„è™šæ‹Ÿæœº ipã€‚&lt;/p&gt;
&lt;p&gt;minikube service my-nginx-app &amp;ndash;url ä¹Ÿå¯ä»¥è¿”å›æŒ‡å®š service çš„è®¿é—® URLã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;img&#34; srcset=&#34;
               /blog/kubernetes-crd-quick-start/1544521261245-863cc212-ad6d-4b46-ab6d-ea9f4baa9b93_hu5227024570371940042.webp 400w,
               /blog/kubernetes-crd-quick-start/1544521261245-863cc212-ad6d-4b46-ab6d-ea9f4baa9b93_hu12713851003483338703.webp 760w,
               /blog/kubernetes-crd-quick-start/1544521261245-863cc212-ad6d-4b46-ab6d-ea9f4baa9b93_hu16609316166294915708.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-crd-quick-start/1544521261245-863cc212-ad6d-4b46-ab6d-ea9f4baa9b93_hu5227024570371940042.webp&#34;
               width=&#34;684&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;crdcustomresourcedefinition&#34;&gt;CRDã€CustomResourceDefinitionã€‘&lt;/h2&gt;
&lt;p&gt;CRD æ˜¯ Kubernetes ä¸ºæé«˜å¯æ‰©å±•æ€§ï¼Œè®©å¼€å‘è€…å»è‡ªå®šä¹‰èµ„æºï¼ˆå¦‚ Deploymentï¼ŒStatefulSet ç­‰ï¼‰çš„ä¸€ç§æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;Operator=CRD+Controllerã€‚&lt;/p&gt;
&lt;p&gt;CRD ä»…ä»…æ˜¯èµ„æºçš„å®šä¹‰ï¼Œè€Œ Controller å¯ä»¥å»ç›‘å¬ CRD çš„ CRUD äº‹ä»¶æ¥æ·»åŠ è‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘ã€‚&lt;/p&gt;
&lt;p&gt;å…³äº CRD æœ‰ä¸€äº›é“¾æ¥å…ˆè´´å‡ºæ¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®˜æ–¹æ–‡æ¡£ï¼š&lt;a href=&#34;https://kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definitions/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definitions/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;CRD Yaml çš„ Schemaï¼š&lt;a href=&#34;https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.13/#customresourcedefinition-v1beta1-apiextensions-k8s-io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.13/#customresourcedefinition-v1beta1-apiextensions-k8s-io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.feisky.xyz/cha-jian-kuo-zhan/api/customresourcedefinition&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.feisky.xyz/cha-jian-kuo-zhan/api/customresourcedefinition&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://sq.163yun.com/blog/article/174980128954048512&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://sq.163yun.com/blog/article/174980128954048512&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.kubebuilder.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://book.kubebuilder.io/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœè¯´åªæ˜¯å¯¹ CRD å®ä¾‹è¿›è¡Œ CRUD çš„è¯ï¼Œä¸éœ€è¦ Controller ä¹Ÿæ˜¯å¯ä»¥å®ç°çš„ï¼Œåªæ˜¯åªæœ‰æ•°æ®ï¼Œæ²¡æœ‰é’ˆå¯¹æ•°æ®çš„æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ª CRD çš„ yaml æ–‡ä»¶ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;apiextensions.k8s.io/v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;CustomResourceDefinition&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# name must match the spec fields below, and be in the form: &amp;lt;plural&amp;gt;.&amp;lt;group&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;crontabs.stable.example.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# group name to use for REST API: /apis/&amp;lt;group&amp;gt;/&amp;lt;version&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;stable.example.com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# list of versions supported by this CustomResourceDefinition&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;v1beta1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# either Namespaced or Cluster&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;scope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;Namespaced&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;names&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# plural name to be used in the URL: /apis/&amp;lt;group&amp;gt;/&amp;lt;version&amp;gt;/&amp;lt;plural&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;plural&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;crontabs&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# singular name to be used as an alias on the CLI and for display&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;singular&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;crontab&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# kind is normally the CamelCased singular type. Your resource manifests use this.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;CronTab&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;c&#34;&gt;# shortNames allow shorter string to match your resource on the CLI&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;shortNames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;ct&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡ kubectl create -f crd.yaml å¯ä»¥åˆ›å»ºä¸€ä¸ª CRDã€‚&lt;/p&gt;
&lt;p&gt;kubectl get CustomResourceDeinitions å¯ä»¥è·å–åˆ›å»ºçš„æ‰€æœ‰ CRDã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;544523122252-4e86b6d5-679d-4aa9-8846-007b52869184.png&#34; alt=&#34;img&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç„¶åå¯ä»¥é€šè¿‡ kubectl create -f my-crontab.yaml å¯ä»¥åˆ›å»ºä¸€ä¸ª CRD çš„å®ä¾‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;stable.example.com/v1beta1&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;CronTab&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-new-cron-object&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;spec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;cronSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;* * * * */5&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;image&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;my-awesome-cron-image&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;img&#34; srcset=&#34;
               /blog/kubernetes-crd-quick-start/1544523365960-63cb2113-af95-462b-a0ec-8be2cc4e8b80_hu16178691295856055592.webp 400w,
               /blog/kubernetes-crd-quick-start/1544523365960-63cb2113-af95-462b-a0ec-8be2cc4e8b80_hu5990984958911155795.webp 760w,
               /blog/kubernetes-crd-quick-start/1544523365960-63cb2113-af95-462b-a0ec-8be2cc4e8b80_hu17273939338842748803.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-crd-quick-start/1544523365960-63cb2113-af95-462b-a0ec-8be2cc4e8b80_hu16178691295856055592.webp&#34;
               width=&#34;760&#34;
               height=&#34;158&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;controllerfabric8&#34;&gt;Controllerã€Fabric8ã€‘&lt;/h2&gt;
&lt;p&gt;å¦‚ä½•å»å®ç°ä¸€ä¸ª Controller å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨ Go æ¥å®ç°ï¼Œå¹¶ä¸”ä¸è®ºæ˜¯å‚è€ƒèµ„æ–™è¿˜æ˜¯å¼€æºæ”¯æŒéƒ½éå¸¸å¥½ï¼Œæ¨èæœ‰ Go è¯­è¨€åŸºç¡€çš„ä¼˜å…ˆè€ƒè™‘ç”¨&lt;a href=&#34;https://github.com/kubernetes/client-go&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;client-go&lt;/a&gt;æ¥ä½œä¸º Kubernetes çš„å®¢æˆ·ç«¯ï¼Œç”¨&lt;a href=&#34;https://github.com/kubernetes-sigs/kubebuilder&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;KubeBuilder&lt;/a&gt;æ¥ç”Ÿæˆéª¨æ¶ä»£ç ã€‚ä¸€ä¸ªå®˜æ–¹çš„ Controller ç¤ºä¾‹é¡¹ç›®æ˜¯&lt;a href=&#34;https://github.com/kubernetes/sample-controller&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sample-controller&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äº Java æ¥è¯´ï¼Œç›®å‰ Kubernetes çš„ JavaClient æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ Jaseryï¼Œå¦ä¸€ä¸ªæ˜¯&lt;a href=&#34;https://github.com/fabric8io/kubernetes-client&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fabric8&lt;/a&gt;ã€‚åè€…è¦æ›´å¥½ç”¨ä¸€äº›ï¼Œå› ä¸ºå¯¹ Podã€Deployment éƒ½æœ‰ DSL å®šä¹‰ï¼Œè€Œä¸”æ„å»ºå¯¹è±¡æ˜¯ä»¥ Builder æ¨¡å¼åšçš„ï¼Œå†™èµ·æ¥æ¯”è¾ƒèˆ’æœã€‚&lt;/p&gt;
&lt;p&gt;Fabric8 çš„èµ„æ–™ç›®å‰åªæœ‰&lt;a href=&#34;https://github.com/fabric8io/kubernetes-client&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/fabric8io/kubernetes-client&lt;/a&gt;ï¼Œæ³¨æ„çœ‹ç›®å½•ä¸‹çš„ examplesã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›å®¢æˆ·ç«¯æœ¬è´¨ä¸Šéƒ½æ˜¯é€šè¿‡ REST æ¥å£æ¥ä¸ Kubernetes API Server é€šä¿¡çš„ã€‚&lt;/p&gt;
&lt;p&gt;Controller çš„é€»è¾‘å…¶å®æ˜¯å¾ˆç®€å•çš„ï¼šç›‘å¬ CRD å®ä¾‹ï¼ˆä»¥åŠå…³è”çš„èµ„æºï¼‰çš„ CRUD äº‹ä»¶ï¼Œç„¶åæ‰§è¡Œç›¸åº”çš„ä¸šåŠ¡é€»è¾‘&lt;/p&gt;
&lt;h2 id=&#34;mydeployment&#34;&gt;MyDeployment&lt;/h2&gt;
&lt;p&gt;åŸºäº Fabric8 æ¥å¼€å‘ä¸€ä¸ªè¾ƒä¸ºå®Œæ•´çš„ Controller çš„ç¤ºä¾‹ç›®å‰æˆ‘åœ¨ç½‘ç»œä¸Šæ˜¯æ‰¾ä¸åˆ°çš„ï¼Œä¸‹é¢ MyController çš„å®ç°ä¹Ÿæ˜¯ä¸€æ­¥æ­¥æ‘¸ç´¢å‡ºæ¥çš„ï¼Œéš¾å…ä¼šæœ‰å„ç§é—®é¢˜=.=ï¼Œæ¬¢è¿å¤§ä½¬ä»¬æ‰è™«ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç”¨ä¾‹&#34;&gt;ç”¨ä¾‹&lt;/h3&gt;
&lt;p&gt;ä»£ç åœ¨&lt;a href=&#34;https://github.com/songxinjianqwe/deployment-controller&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://github.com/songxinjianqwe/deployment-controller&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;MyDeployment æ˜¯ç”¨æ¥æ¨¡æ‹Ÿ Kubernetes æä¾›çš„ Deployment çš„ç®€åŒ–ç‰ˆå®ç°ï¼Œç›®å‰å¯ä»¥åšåˆ°ä»¥ä¸‹åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯åŠ¨åè‡ªåŠ¨åˆ›å»ºå‡ºä¸€ä¸ª MyDeployment çš„ CRD
&lt;ul&gt;
&lt;li&gt;ã€è§¦å‘ã€‘å¯åŠ¨åº”ç”¨&lt;/li&gt;
&lt;li&gt;ã€æœŸæœ›ã€‘å¯ä»¥çœ‹åˆ°åˆ›å»ºå‡ºæ¥çš„ CRD&lt;/li&gt;
&lt;li&gt;ã€æµ‹è¯•ã€‘kubectl get CustomResourceDefinition -o yaml&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åˆ›å»ºä¸€ä¸ª MyDeployment: Nginx å®ä¾‹
&lt;ul&gt;
&lt;li&gt;ã€è§¦å‘ã€‘kubectl create -f my-deployment-instance.yaml&lt;/li&gt;
&lt;li&gt;ã€æœŸæœ›ã€‘å¯ä»¥çœ‹åˆ°çº§è”åˆ›å»ºå‡ºæ¥çš„ 3 ä¸ª pod&lt;/li&gt;
&lt;li&gt;ã€æµ‹è¯•ã€‘kubectl get pods&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ‰‹å·¥åˆ æ‰ä¸€ä¸ª pod
&lt;ul&gt;
&lt;li&gt;ã€è§¦å‘ã€‘kubectl delete pods $pod_name&lt;/li&gt;
&lt;li&gt;ã€æœŸæœ›ã€‘pod è¢«é‡å»º&lt;/li&gt;
&lt;li&gt;ã€æµ‹è¯•ã€‘kubectl get pods -w&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æš´éœ²ä¸€ä¸ªæœåŠ¡
&lt;ul&gt;
&lt;li&gt;ã€è§¦å‘ã€‘kubectl create -f my-deployment-service.yaml&lt;/li&gt;
&lt;li&gt;ã€æœŸæœ›ã€‘å¯ä»¥é€šè¿‡ curl æ¥è®¿é—® nginx æœåŠ¡&lt;/li&gt;
&lt;li&gt;ã€æµ‹è¯•ã€‘minikube service my-nginx-app &amp;ndash;url ç„¶å curl&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ›´æ–°é•œåƒ
&lt;ul&gt;
&lt;li&gt;ã€è§¦å‘ã€‘kubectl replace -f my-deployment-instance-update-image-1.9.1.yaml&lt;/li&gt;
&lt;li&gt;ã€æœŸæœ›ã€‘pod çš„ nginx ç‰ˆæœ¬è¢«æ›´æ–°ä¸º 1.9.1&lt;/li&gt;
&lt;li&gt;ã€æµ‹è¯•ã€‘kubectl get pods -o yaml&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ‰©å®¹
&lt;ul&gt;
&lt;li&gt;ã€è§¦å‘ã€‘kubectl replace -f my-deployment-instance-update-scaleup-1.9.1.yaml&lt;/li&gt;
&lt;li&gt;ã€æœŸæœ›ã€‘pod è¢«æ‰©å®¹åˆ° 5 ä¸ª&lt;/li&gt;
&lt;li&gt;ã€æµ‹è¯•ã€‘kubectl get pods&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç¼©å®¹
&lt;ul&gt;
&lt;li&gt;ã€è§¦å‘ã€‘kubectl replace -f my-deployment-instance-update-scaledown-1.9.1.yaml&lt;/li&gt;
&lt;li&gt;ã€æœŸæœ›ã€‘pod è¢«ç¼©å®¹åˆ° 2 ä¸ª&lt;/li&gt;
&lt;li&gt;ã€æµ‹è¯•ã€‘kubectl get pods&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ‰©å®¹å¹¶æ›´æ–°é•œåƒ
&lt;ul&gt;
&lt;li&gt;ã€è§¦å‘ã€‘kubectl replace -f my-deployment-instance-update-image-and-scaleup-1.14.yaml&lt;/li&gt;
&lt;li&gt;ã€æœŸæœ›ã€‘pod è¢«æ‰©å®¹ 5 ä¸ªï¼Œä¸” nginx ç‰ˆæœ¬è¢«æ›´æ–°ä¸º 1.14&lt;/li&gt;
&lt;li&gt;ã€æµ‹è¯•ã€‘kubectl get pods ç„¶å kubectl get pods -o yaml&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åˆ é™¤ä¸€ä¸ª MyDeployment
&lt;ul&gt;
&lt;li&gt;ã€è§¦å‘ã€‘kubectl delete mydeployments my-nginx-app&lt;/li&gt;
&lt;li&gt;ã€æœŸæœ›ã€‘MyDeployment è¢«åˆ æ‰ï¼Œå¹¶ä¸”å…³è”çš„ pod ä¹Ÿè¢«çº§è”åˆ æ‰&lt;/li&gt;
&lt;li&gt;ã€æµ‹è¯•ã€‘kubectl get mydeployments ç„¶å kubectl get pods&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ­¤å¤–è¿˜æœ‰ä¸€äº›åŠŸèƒ½å°šæœªå¼€å‘ï¼Œå…¶ä¸­çŠ¶æ€æ˜¯éå¸¸é‡è¦çš„ï¼Œå¾ˆå¯æƒœæ—¶é—´ä¸å¤Ÿæ²¡æœ‰å¼€å‘å®Œæˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æŸ¥çœ‹çŠ¶æ€ (TODO)&lt;/li&gt;
&lt;li&gt;å›æ»š (TODO)&lt;/li&gt;
&lt;li&gt;çŠ¶æ€æ›´æ–°ã€currentï¼Œupdate-to-dateï¼Œavailableã€‘(TODO)&lt;/li&gt;
&lt;li&gt;describe EVENTS(TODO)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;è¿è¡Œ&#34;&gt;è¿è¡Œ&lt;/h3&gt;
&lt;p&gt;1ã€æ­å»ºå¥½ä¸Šé¢çš„ minikube ç¯å¢ƒå&lt;/p&gt;
&lt;p&gt;2ã€æ‹‰ä¸‹ deployment-controller çš„ä»£ç ï¼Œæ˜¯ä¸€ä¸ª SpringBoot å·¥ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;3ã€å¯åŠ¨ kube-proxy&lt;/p&gt;
&lt;p&gt;kubectl proxy &amp;ndash;port=12000&lt;/p&gt;
&lt;p&gt;è¿™ä¸€æ­¥æ˜¯ä¸ºäº†ç»•å¼€ Kubernetes API Server çš„æƒé™è®¤è¯ã€‚å¼€å¯ proxy ä¹‹åå°±å¯ä»¥é€šè¿‡ localhost:12000 æ¥è¿æ¥ Kubernetes äº†ã€‚&lt;/p&gt;
&lt;p&gt;4ã€è¿è¡Œ DeploymentControllerApplication çš„ main æ–¹æ³•å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;5ã€æ­¤æ—¶å¯ä»¥æ ¹æ®ä¸Šè¿°ç”¨ä¾‹æ¥è¿›è¡Œæµ‹è¯•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;mydeployment-å®ç°&#34;&gt;MyDeployment å®ç°&lt;/h2&gt;
&lt;h3 id=&#34;é¡¹ç›®å·¥ç¨‹ç»“æ„&#34;&gt;é¡¹ç›®å·¥ç¨‹ç»“æ„&lt;/h3&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-img&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;img&#34; srcset=&#34;
               /blog/kubernetes-crd-quick-start/1544529272311-c8aa028d-52ac-4cd9-800e-c6dcb5e5331e_hu17202175835987873415.webp 400w,
               /blog/kubernetes-crd-quick-start/1544529272311-c8aa028d-52ac-4cd9-800e-c6dcb5e5331e_hu7748199304910704415.webp 760w,
               /blog/kubernetes-crd-quick-start/1544529272311-c8aa028d-52ac-4cd9-800e-c6dcb5e5331e_hu14868672103518356811.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/kubernetes-crd-quick-start/1544529272311-c8aa028d-52ac-4cd9-800e-c6dcb5e5331e_hu17202175835987873415.webp&#34;
               width=&#34;522&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      img
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h3 id=&#34;crd-å®šä¹‰&#34;&gt;CRD å®šä¹‰&lt;/h3&gt;
&lt;p&gt;æŒ‰ç…§ Fabric8 çš„é€»è¾‘ï¼Œå®šä¹‰ä¸€ä¸ª CRD éœ€è¦è‡³å°‘å®šä¹‰ä»¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CustomResourceDefinitionï¼Œéœ€è¦ç»§æ‰¿ CustomResourceï¼ŒCRD èµ„æºå®šä¹‰&lt;/li&gt;
&lt;li&gt;CustomResourceDefinitionListï¼Œéœ€è¦ç»§æ‰¿ CustomResourceListï¼ŒCRD èµ„æºåˆ—è¡¨&lt;/li&gt;
&lt;li&gt;CustomResourceDefinitionSpecï¼Œéœ€è¦å®ç° KubernetesResource æ¥å£ï¼ŒCRD èµ„æºçš„ Spec&lt;/li&gt;
&lt;li&gt;DoneableCustomResourceDefinitionï¼Œéœ€è¦ç»§æ‰¿ CustomResourceDoneableï¼ŒCRD èµ„æºçš„ä¿®æ”¹ Builder&lt;/li&gt;
&lt;li&gt;ã€å¯é€‰ã€‘CustomResourceDefinitionStatusï¼ˆéœ€è¦è¯´æ˜ä¸€ç‚¹çš„æ˜¯ï¼ŒCRD æ”¯æŒä½¿ç”¨ SubResourceï¼ŒåŒ…æ‹¬ scale å’Œ statusï¼Œåœ¨ 1.11+ä¹‹åå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œåœ¨ 1.10 ä¸­éœ€è¦ä¿®æ”¹ API Server çš„å¯åŠ¨å‚æ•°æ¥å¯ç”¨ï¼›minikube çš„æœ€æ–°ç‰ˆæœ¬æ˜¯å¯ä»¥æ”¯æŒåˆ° Kubernetes çš„ 1.10 çš„ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨ CRD å®šä¹‰ä¸­é€šå¸¸æ˜¯éœ€è¦æŒæœ‰ä¸€ä¸ª Spec çš„ã€æ³¨æ„ï¼Œä¸Šé¢æåˆ°çš„æ‰€æœ‰ç±»å®šä¹‰æŒæœ‰çš„æˆå‘˜å˜é‡æœ€å¥½éƒ½åŠ ä¸€ä¸ª@JsonProperty æ³¨è§£ï¼Œä¸åŠ çš„è¯åœ¨ get èµ„æºæ—¶å¯¹ JSON ååºåˆ—åŒ–æ—¶ç”¨åˆ°çš„åå­—å°±æ˜¯å±æ€§åäº†ã€‘&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯åŸºäº Fabric8 çš„ API æ„å»ºå‡ºäº†ä¸€ä¸ª CRDï¼Œä¹‹åå¯ä»¥è°ƒç”¨ API å°†å…¶åˆ›å»ºåˆ° Kubernetesï¼Œæ•ˆæœå’Œ kubectl create -f æ˜¯ä¸€æ ·çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä½† Controller éœ€è¦åšåˆ°çš„æ˜¯å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª CRD å‡ºæ¥ï¼Œæ‰€ä»¥ç”¨ kubectl åˆ›å»ºä¸å¤Ÿè‡ªåŠ¨åŒ–ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CRD_GROUP&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;cloud.alipay.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CRD_SINGULAR_NAME&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;mydeployment&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CRD_PLURAL_NAME&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;mydeployments&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CRD_NAME&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CRD_PLURAL_NAME&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CRD_GROUP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CRD_KIND&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;MyDeployment&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CRD_SCOPE&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Namespaced&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CRD_SHORT_NAME&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;md&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CRD_VERSION&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;v1beta1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CRD_API_VERSION&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;apiextensions.k8s.io/&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CRD_VERSION&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CustomResourceDefinition&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MY_DEPLOYMENT_CRD&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;CustomResourceDefinitionBuilder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withApiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CRD_API_VERSION&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withNewMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CRD_NAME&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;endMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withNewSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CRD_GROUP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CRD_VERSION&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withScope&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CRD_SCOPE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withNewNames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withKind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CRD_KIND&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withShortNames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CRD_SHORT_NAME&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withSingular&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CRD_SINGULAR_NAME&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withPlural&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CRD_PLURAL_NAME&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;endNames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;endSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withNewStatus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withNewAcceptedNames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;addToShortNames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;availableReplicas&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;replicas&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;updatedReplicas&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;endAcceptedNames&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;endStatus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;build&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;controller&#34;&gt;Controller&lt;/h3&gt;
&lt;p&gt;å…¥å£å¤„éœ€è¦å»ä¸ºæˆ‘ä»¬çš„ CRD æ³¨å†Œä¸€ä¸ªååºåˆ—åŒ–å™¨ã€‚&lt;/p&gt;
&lt;p&gt;å…¥å£å¤„&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;KubernetesDeserializer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;registerCustomKind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MyDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CRD_GROUP&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MyDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CRD_VERSION&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MyDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CRD_KIND&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MyDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt; * å…¥å£
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt; */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// åˆ›å»º CRD
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;CustomResourceDefinition&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;myDeploymentCrd&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;createCrdIfNotExists&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ç›‘å¬ Pod çš„äº‹ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;watchPod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ç›‘å¬ MyDeployment çš„äº‹ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;watchMyDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;myDeploymentCrd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;watchPod æ˜¯ç›‘å¬ MyDeployment æ‰€ç®¡ç†çš„ Pod çš„ CRUD äº‹ä»¶ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;watchPod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;delegate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;pods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;watch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Watcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;err&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Override&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;eventReceived&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Action&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;c1&#34;&gt;// å¦‚æœæ˜¯è¢« MyDeployment ç®¡ç†çš„ Pod
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getOwnerReferences&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;stream&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;anyMatch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ownerReference&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ownerReference&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getKind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;equals&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MyDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CRD_KIND&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nx&#34;&gt;unifiedPodWatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;eventReceived&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;err&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Override&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;onClose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;KubernetesClientException&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;watching pod {} caught an exception {}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;});&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;UnifiedPodWatcher æ˜¯å¤„ç†äº†æ‰€æœ‰ Pod çš„äº‹ä»¶ï¼Œç„¶ååœ¨æ”¶åˆ°äº‹ä»¶æ—¶å»é€šçŸ¥ Pod äº‹ä»¶çš„è®¢é˜…è€…ï¼Œè¿™é‡Œç”¨åˆ°äº†ä¸€ä¸ªè§‚å¯Ÿè€…æ¨¡å¼ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Component&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;UnifiedPodWatcher&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;err&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Autowired&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;List&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PodAddedWatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;podAddedWatchers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;err&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Autowired&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;List&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PodModifiedWatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;podModifiedWatchers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;err&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Autowired&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;List&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PodDeletedWatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;podDeletedWatchers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;cm&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     * å°† Pod äº‹ä»¶ç»Ÿä¸€æ”¶åˆ°æ­¤å¤„
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     * @param action
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     * @param pod
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;eventReceived&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Watcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Action&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Thread {}: PodWatcher: {} =&amp;gt;  {}, {}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Thread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;currentThread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ADDED&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nx&#34;&gt;podAddedWatchers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;forEach&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;watcher&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;watcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;onPodAdded&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MODIFIED&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nx&#34;&gt;podModifiedWatchers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;forEach&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;watcher&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;watcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;onPodModified&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;DELETED&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nx&#34;&gt;podDeletedWatchers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;forEach&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;watcher&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;watcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;onPodDeleted&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Fabric8 çš„ watcher æ˜¯åœ¨ä»£ç å±‚é¢ä¸ä¼šé™åˆ¶åœ¨å¤šä¸ªåœ°æ–¹å»ç›‘å¬åŒä¸€ä¸ªå¯¹è±¡çš„ï¼Œä½†ç»ç²—ç•¥æµ‹è¯•ï¼Œå¤šå¤„ç›‘å¬åªæœ‰åœ¨ç¬¬ä¸€ä¸ªåœ°æ–¹ä¼šæ”¶åˆ°å›è°ƒï¼›ä»å¯ç»´æŠ¤æ€§è§’åº¦æ¥è¯´ï¼Œæ•£è½åœ¨å„ä¸ªåœ°æ–¹çš„ watcher ä»£ç ä¹Ÿæ˜¯ä¸å¤Ÿä¼˜é›…çš„ã€‚æ‰€ä»¥å°† watcher ç»Ÿä¸€æ”¶å£åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œç„¶ååœ¨è¿™ä¸ªåœ°æ–¹ä¸‹å‘äº‹ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶å MyDeployment çš„ç›‘å¬ä¹Ÿæ˜¯æ¯”è¾ƒç±»ä¼¼çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;watchMyDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CustomResourceDefinition&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;myDeploymentCrd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;MixedOperation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MyDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MyDeploymentList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;DoneableMyDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Resource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MyDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;DoneableMyDeployment&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;myDeploymentClient&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;delegate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;customResources&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;myDeploymentCrd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MyDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MyDeploymentList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;DoneableMyDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;myDeploymentClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;watch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Watcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MyDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;err&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Override&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;eventReceived&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Action&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MyDeployment&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;myDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;myDeployment: {} =&amp;gt; {}&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;myDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;myDeploymentHandlers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;containsKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MyDeploymentActionHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RESOURCE_NAME&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nx&#34;&gt;myDeploymentHandlers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MyDeploymentActionHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RESOURCE_NAME&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;myDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;err&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Override&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;onClose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;KubernetesClientException&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;watching myDeployment {} caught an exception {}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;});&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;åˆ›å»º-mydeployment-çš„å®ç°é€»è¾‘&#34;&gt;åˆ›å»º MyDeployment çš„å®ç°é€»è¾‘&lt;/h3&gt;
&lt;p&gt;åˆ›å»º MyDeployment æ—¶ä¼šåˆ›å»ºå‡º replicas ä¸ª Pod å‡ºæ¥ã€‚æ­¤å¤„é€»è¾‘åœ¨ MyDeploymentAddedHandler å®ç°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Component&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MyDeploymentActionHandler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;RESOURCE_NAME&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;CrdAction&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ADDED&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Slf4j&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MyDeploymentAddedHandler&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MyDeploymentActionHandler&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;err&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Autowired&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;KubeClientDelegate&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;delegate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;err&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Override&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MyDeployment&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;myDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;{} added&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;myDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// TODO å½“ç¬¬ä¸€æ¬¡å¯åŠ¨é¡¹ç›®æ—¶ï¼Œç°å­˜çš„ MyDeployment ä¼šå›è°ƒä¸€æ¬¡ Added äº‹ä»¶ï¼Œè¿™é‡Œä¼šå¯¼è‡´é‡å¤åˆ›å»º podã€å¯é€šè¿‡ status è§£å†³ã€‘,ç›®å‰è§£æ³•æ˜¯å»æŸ¥ä¸€ä¸‹ç°å­˜çš„ pod[ä¸å¯é ]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// æœ‰å¯èƒ½ pod çš„çŠ¶æ€è¿˜æ²¡æ¥å¾—åŠç½®ä¸º not ready
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;existedReadyPodNumber&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;delegate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;pods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;inNamespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;myDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getNamespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withLabelSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;myDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getLabelSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getItems&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;stream&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;UnifiedPodWatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;isPodReady&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;collect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Collectors&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;toList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;Integer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;replicas&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;myDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getReplicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;replicas&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;existedReadyPodNumber&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;myDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;createPod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Thread {}:creating pod[{}]: {} , {}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Thread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;currentThread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;delegate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;pods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;create&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œéœ€è¦è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆåˆ›å»º pod çš„æ•°é‡éœ€è¦å‡å» existedReadyPodNumberã€‚ç»è§‚å¯Ÿå‘ç°ï¼Œå¦‚æœç°å­˜æœ‰ CRD å®ä¾‹ï¼Œç„¶åå¯åŠ¨ Controllerï¼Œä¼šç«‹å³æ”¶åˆ° CRD çš„ added äº‹ä»¶ï¼Œå³ä½¿ Pod éƒ½æ˜¯å¥åº·çš„ï¼Œè¿™ä¼šå¯¼è‡´åˆ›å»ºå‡ºåŒå€çš„ Podã€‚æ‰€ä»¥è¿™é‡Œéœ€è¦åˆ¤æ–­ä¸€ä¸‹ç°å­˜çš„ Pod æ•°é‡ï¼Œå¦‚æœå¤Ÿäº†ï¼Œå°±ä¸å»åˆ›å»ºäº†ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯è¿™åˆä¼šå¼•å…¥ä¸€ä¸ªé—®é¢˜ï¼Œå‡å¦‚æˆ‘å°† MyDeployment åˆ æ‰äº†ï¼Œæ­¤æ—¶ä¼šçº§è”åˆ é™¤å…³è”çš„ Podï¼Œåœ¨æ²¡æ¥å¾—åŠåˆ æ‰ä¹‹å‰ï¼Œåˆå»åˆ›å»ºä¸€ä¸ªæ–°çš„ MyDeploymentï¼Œè¿™æ—¶å€™ä¼šå‘ç°ç°å­˜çš„ Pod æ•°é‡å¹¶éä¸º 0ï¼Œæ‰€ä»¥æ–°å»ºçš„ Pod æ•°é‡å°±ä¸èƒ½è¾¾åˆ° replicasã€‚è§£å†³åŠæ³•æ˜¯å»åˆ¤æ–­ä¸€ä¸‹ Pod çš„çŠ¶æ€ï¼Œå¦‚æœæ˜¯ NotReadyï¼Œé‚£ä¹ˆå°±ä¸ç®—æ˜¯æ­£å¸¸çš„ Podã€‚&lt;/p&gt;
&lt;p&gt;ä½†è¿™ç§è§£å†³æ€è·¯è¿˜æ˜¯æœ‰é—®é¢˜ï¼Œåœ¨åˆ æ‰ MyDeployment ä¹‹åä¸ä¼šç«‹å³å°† Pod çŠ¶æ€ç½®ä¸º NotReadyï¼Œéœ€è¦ä¸€å®šæ—¶é—´ï¼Œåœ¨è¿™æ®µæ—¶é—´å†…å¦‚æœåˆ›å»º MyDeploymentï¼Œé‚£ä¹ˆè¿˜æ˜¯æœ‰å¯èƒ½ä¼šå‡ºç°å°‘åˆ›å»º Pod çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰è¿˜æ²¡æœ‰ä»€ä¹ˆæ—  BUG çš„æ€è·¯ã€‚&lt;/p&gt;
&lt;p&gt;åˆ›å»ºä¸€ä¸ª Pod çš„å®ç°ï¼Œå°†è¿™æ®µä»£ç æ”¾åˆ°äº† MyDeployment ä¸­ï¼Œä»¥è¡¨ç¤ºä»å±å…³ç³»ï¼ˆä»£ç ä¹Ÿå¥½å†™ä¸€äº›ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœ Pod æ˜¯ä»å±äºæŸä¸ª MyDeploymentï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å°† OwnerReference ä¼ å…¥ï¼›&lt;/p&gt;
&lt;p&gt;Pod çš„ name å¿…é¡»ä»¥ MyDeployment çš„ name ä¸ºå‰ç¼€ï¼Œåé¢åŠ ä¸Šå”¯ä¸€ IDï¼›&lt;/p&gt;
&lt;p&gt;Pod çš„ spec å¿…é¡»ä¸ MyDeployment çš„ spec ä¸­çš„ pod template ä¸€è‡´ï¼›&lt;/p&gt;
&lt;p&gt;Pod çš„ labels ä¸­åŒ…å« MyDeployment çš„ labelï¼Œå¹¶ä¸”è¦åŠ ä¸Šä¸€ä¸ª pod-template å“ˆå¸Œå€¼ï¼Œä»¥åœ¨æ›´æ–°èµ„æºæ—¶åˆ¤æ–­ pod template æ˜¯å¦æ”¹å˜ï¼Œå¦‚æœæ²¡æœ‰å˜åŒ–ï¼Œåˆ™ä¸è§¦å‘ modified äº‹ä»¶ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; A Deploymentâ€™s rollout is triggered if and only if the Deploymentâ€™s pod template (that is, &lt;code&gt;.spec.template&lt;/code&gt;) is changed, for example if the labels or container images of the template are updated. Other updates, such as scaling the Deployment, do not trigger a rollout.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;createPod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;hashCode&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getPodTemplateSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;hashCode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;PodBuilder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withNewMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getLabelSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getMatchLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;addToLabels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;pod-template-hash&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;valueOf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hashCode&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;?&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;hashCode&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hashCode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;concat&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;concat&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;UUID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;randomUUID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;toString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withNamespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getNamespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withOwnerReferences&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;OwnerReferenceBuilder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withApiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getApiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withController&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Boolean&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TRUE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withBlockOwnerDeletion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Boolean&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TRUE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withKind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getKind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withUid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getUid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;build&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withUid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;UUID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;randomUUID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;toString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;endMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getPodTemplateSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;build&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æ›´æ–°-mydeployment-çš„å®ç°é€»è¾‘&#34;&gt;æ›´æ–° MyDeployment çš„å®ç°é€»è¾‘&lt;/h3&gt;
&lt;p&gt;æ›´æ–°æ—¶ä¸»è¦è€ƒè™‘äº†ä¸¤ç§æƒ…å†µï¼šç¼©æ‰©å®¹å’Œæ›´æ–°é•œåƒã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡åˆ¤æ–­ç›®å‰ Pod æ•°é‡å’Œ MyDeployment ä¸­ spec çš„ replicas ä¸­æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ç¼©æ‰©å®¹ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡åˆ¤æ–­æ˜¯å¦å­˜åœ¨ Pod ä¸ MyDeployment çš„ container åˆ—è¡¨æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°é•œåƒã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä»…éœ€è¦æ›´æ–°é•œåƒï¼Œåˆ™è¿›è¡Œ rolling-updateï¼›&lt;/p&gt;
&lt;p&gt;å¦‚æœä»…éœ€è¦ç¼©æ‰©å®¹ï¼Œåˆ™è¿›è¡Œ scaleï¼›&lt;/p&gt;
&lt;p&gt;å¦‚æœéƒ½éœ€è¦ï¼Œåˆ™å…ˆå¯¹å‰©ä½™ Pod è¿›è¡Œ rolling-updateï¼Œå†å¯¹ç¼©æ‰©å®¹çš„ Pod è¿›è¡Œç¼©æ‰©å®¹ã€‚&lt;/p&gt;
&lt;p&gt;rolling-update æ˜¯æ»šåŠ¨å‡çº§ï¼Œä¸€ç§ç®€å•çš„å®ç°æ˜¯å…ˆæ‰©å®¹ä¸€ä¸ª Podï¼ˆæ–°çš„é•œåƒï¼‰ï¼Œå†ç¼©å®¹ä¸€ä¸ª Podï¼ˆè€çš„é•œåƒï¼‰ï¼Œå¦‚æ­¤åå¤ï¼Œç›´åˆ°å…¨éƒ¨éƒ½æ˜¯æ–°çš„é•œåƒä¸ºæ­¢ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MyDeployment&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;myDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;{} modified&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;myDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;PodList&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pods&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;delegate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;pods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;inNamespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;myDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getNamespace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;withLabelSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;myDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getLabelSelector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()).&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;podSize&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getItems&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;replicas&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;myDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getSpec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getReplicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;needScale&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;podSize&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;needUpdate&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getItems&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;stream&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;anyMatch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;myDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;isPodTemplateChanged&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;});&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;needScale: {}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;needScale&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;needUpdate: {}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;needUpdate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// ä»…æ›´æ–° podTemplate
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;needScale&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nf&#34;&gt;syncRollingUpdate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;myDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getItems&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;needUpdate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;c1&#34;&gt;// ä»…æ‰©ç¼©å®¹
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;diff&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;replicas&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;podSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;diff&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nf&#34;&gt;scaleUp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;myDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;diff&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;c1&#34;&gt;// æŠŠåˆ—è¡¨å‰é¢çš„ç¼©å®¹ï¼Œåé¢çš„ä¸åŠ¨
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                &lt;span class=&#34;nf&#34;&gt;scaleDown&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getItems&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;subList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;diff&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;c1&#34;&gt;// åŒæ—¶ scale&amp;amp;update
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;c1&#34;&gt;// å¯¹å‰©ä½™éƒ¨åˆ†åš rolling-updateï¼Œç„¶åå¯¹ diff è¿›è¡Œç¼©æ‰©å®¹
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;nf&#34;&gt;syncRollingUpdate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;myDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getItems&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;subList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Math&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;min&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;podSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;diff&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;replicas&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;podSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;diff&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nf&#34;&gt;scaleUp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;myDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;diff&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nf&#34;&gt;scaleDown&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getItems&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;subList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;replicas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;podSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œæ‰€æœ‰ CRUD çš„ APi å‡ä¸º REST è°ƒç”¨ï¼Œæ˜¯ Kubernetes API Server å°†å¯¹è±¡çš„æœŸæœ›çŠ¶æ€å†™å…¥åˆ° ETCD ä¸­ï¼Œç„¶åç”± kubelet ç›‘å¬äº‹ä»¶ï¼Œå»æ‰§è¡Œå˜æ›´ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸€ç‚¹åœ¨ rolling-update è¿‡ç¨‹ä¸­è¦æ ¼å¤–æ³¨æ„ï¼Œâ€å…ˆæ‰©å®¹ï¼Œåç¼©å®¹â€œä¸­åç¼©å®¹çš„å‰ææ˜¯æ‰©å®¹æˆåŠŸï¼Œå³æ–°çš„ Pod åˆ›å»ºæˆåŠŸï¼Œä¸”çŠ¶æ€å˜ä¸º Readyã€‚æ‰€ä»¥ä»…ä»…è°ƒç”¨ä¸€ä¸‹ create æ¥å£æ˜¯ä¸å¤Ÿçš„ï¼Œéœ€è¦ç­‰å¾…ç›´è‡³ Readyï¼›åˆ é™¤åŒç†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;syncRollingUpdate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MyDeployment&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;myDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;List&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;pods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;forEach&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldPod&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newPod&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;myDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;createPod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Thread {}: pod {} is creating&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Thread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;currentThread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newPod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;delegate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;createPodAndWait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;newPod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;myDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Thread {}: pod {} is deleting&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Thread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;currentThread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;oldPod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;delegate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;deletePodAndWait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldPod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;});&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;createPodAndWait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MyDeployment&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;myDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;pods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;create&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;CountDownLatch&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;latch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;CountDownLatch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;modifiedPodLatchMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;put&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getUid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;latch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;try&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;latch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;await&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TIME_OUT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TimeUnit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SECONDS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;catch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InterruptedException&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;{}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;createPodAndWait wait finished successfully!&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œæ˜¯ await é˜»å¡ç­‰å¾…ï¼Œå½“å‰ç±»ä¹Ÿå®ç°äº† PodModifiedWatcher æ¥å£ï¼ŒcountDown æ˜¯åœ¨ Pod çŠ¶æ€å˜æ›´æ—¶è§¦å‘ã€‚&lt;/p&gt;
&lt;p&gt;å½“ Pod è¢«åˆ›å»ºåï¼Œå¾€å¾€ä¼šè§¦å‘ä¸¤ä¸ªäº‹ä»¶ï¼Œç¬¬ä¸€ä¸ªæ˜¯ Addedï¼ŒçŠ¶æ€æ˜¯ NotReadyï¼Œç¬¬äºŒä¸ªæ˜¯ Modifiedï¼ŒçŠ¶æ€æ˜¯ Readyã€‚è¿™é‡Œæˆ‘ä»¬æ£€æµ‹åˆ°æ–°å¢çš„ Pod æ­£å¸¸è¿è¡Œåï¼Œå»å”¤é†’æ‰§è¡Œ rolling-update çš„çº¿ç¨‹ï¼Œä»¥å®ç° createPodAndwait çš„æ•ˆæœã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Override&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;onPodModified&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;UnifiedPodWatcher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;isPodReady&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;CountDownLatch&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;latch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;modifiedPodLatchMap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;remove&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getUid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;latch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nx&#34;&gt;latch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;countDown&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¼©æ‰©å®¹çš„é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œä¸éœ€è¦åšç­‰å¾…ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt; * @param myDeployment
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt; * @param count        æ‰©å®¹çš„ pod æ•°é‡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt; */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;scaleUp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MyDeployment&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;myDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;myDeployment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;createPod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;scale up pod[{}]: {} , {}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;delegate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;pods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;create&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt; * @param pods å¾…åˆ æ‰çš„ pod åˆ—è¡¨
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt; */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;scaleDown&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;List&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;Pod&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;scale down pod[{}]: {} , {}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getMetadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;delegate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;pods&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;delete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;åˆ é™¤-mydeployment-çš„å®ç°é€»è¾‘&#34;&gt;åˆ é™¤ MyDeployment çš„å®ç°é€»è¾‘&lt;/h3&gt;
&lt;p&gt;å…¶å®å°±æ˜¯æ²¡æœ‰é€»è¾‘=.=&lt;/p&gt;
&lt;p&gt;Kubernetes çš„é€»è¾‘æ˜¯åˆ æ‰äº†ä¸€ä¸ªèµ„æºæ—¶ï¼Œå¦‚æœå…¶ä»–èµ„æºçš„ Metadata ä¸­çš„ ownerReference ä¸­å¼•ç”¨è¯¥èµ„æºï¼Œé‚£ä¹ˆè¿™äº›èµ„æºä¼šè¢«çº§è”åˆ é™¤ï¼Œè¿™ä¸ªè¡Œä¸ºæ˜¯å¯ä»¥é…ç½®çš„ï¼Œå¹¶ä¸”é»˜è®¤ä¸º trueã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦åœ¨æ­¤å¤„åšä»»ä½•äº‹æƒ…ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetes çš„æ— æœåŠ¡å™¨æ¡†æ¶çš„è¯„ä¼°</title>
      <link>https://cloudnativecn.com/blog/evaluation-of-serverless-frameworks-for-kbe/</link>
      <pubDate>Thu, 08 Nov 2018 13:20:46 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/evaluation-of-serverless-frameworks-for-kbe/</guid>
      <description>&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwtshzvvdnj20m808ct8v_hu5420353441727717783.webp 400w,
               /blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwtshzvvdnj20m808ct8v_hu14631969021372761468.webp 760w,
               /blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwtshzvvdnj20m808ct8v_hu7342748165447370470.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwtshzvvdnj20m808ct8v_hu5420353441727717783.webp&#34;
               width=&#34;760&#34;
               height=&#34;285&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://rancher.com/blog/2018/2018-04-23-evaluation-of-serverless-frameworks-for-kbe/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Rancher 1.6 å’Œ Rancher 2.0 åº•å±‚å®¹å™¨ç¼–æ’å¼•æ“çš„æœ¯è¯­å’Œæ¦‚å¿µç•¥å¾®æœ‰æ‰€ä¸åŒã€‚æƒ³è¦äº†è§£è¿™äº›å·®å¼‚å°±éœ€è¦å…ˆäº†è§£ Cattle å’Œ Kubernetes ä¹‹é—´çš„æ ¹æœ¬åŒºåˆ«ã€‚å¯¹äºä½¿ç”¨è¿‡ Cattle æˆ–è€… Kubernetes çš„æ–°æ‰‹æ¥è¯´ï¼Œè¿™ç¯‡æ–‡ç« æ¯”è¾ƒé€‚åˆæ‚¨ã€‚åŒæ—¶ä½ ä¹Ÿå¯ä»¥ä»è¿™é‡Œè·å–åˆ°å®¹å™¨ç¼–æ’å¼•æ“ Cattle åˆ° Kubernetes çš„å¯¹åº”å…³ç³»è¯æ±‡è¡¨ cheatsheetã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://rancher.com/tags/serverless&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ— æœåŠ¡å™¨&lt;/a&gt; &lt;a href=&#34;https://rancher.com/tags/kubernetes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;kubernetes&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;åœ¨ Pokemon Go çš„æ—©æœŸï¼Œæˆ‘ä»¬éƒ½æƒŠè®¶äº Niantic å¦‚ä½•åœ¨å…¨çƒèŒƒå›´å†…æ‰©å±•å…¶ç”¨æˆ·ç¾¤ï¼Œç°åœ¨çœ‹æ¥ä»–ä»¬åº”è¯¥æ˜¯ä»¥æ— ç¼åœ°å‘å…¶å®¹å™¨é›†ç¾¤æ·»åŠ é¢å¤–çš„èŠ‚ç‚¹ä»¥å®¹çº³æ›´å¤šçš„ç©å®¶å’Œç¯å¢ƒï¼Œæ‰€æœ‰è¿™ä¸€åˆ‡éƒ½å¯ä»¥é€šè¿‡ä½¿ç”¨ Kubernetes ä½œä¸ºå®¹å™¨ç¼–æ’å·¥å…·æ¥å®ç°ã€‚Kubernetes åœ¨æ‰©å±•å’Œç®¡ç†å®¹å™¨åŸºç¡€æ¶æ„ä¸­ï¼Œèƒ½å¤Ÿä»å¼€å‘è€…è§’åº¦æŠ½è±¡å‡ºéƒ¨åˆ†è¿‡ç¨‹å’Œä½çº§ä¾èµ–å…³ç³»ã€‚è¿™ä½¿å®ƒæˆä¸ºä¸€ä¸ªéå¸¸æœ‰æ•ˆçš„å¹³å°ï¼Œç”¨äºå¼€å‘å’Œç»´æŠ¤è·¨å¤šä¸ªå®¹å™¨çš„åº”ç”¨ç¨‹åºæœåŠ¡ã€‚æœ¬æ–‡å°†æ¢è®¨å¦‚ä½•åˆ©ç”¨ K8S çš„è®¾è®¡å‚æ•°å’ŒæœåŠ¡ç¼–æ’åŠŸèƒ½ï¼Œå¹¶å°†å®ƒä»¬ä¸æ— æœåŠ¡å™¨æ¡†æ¶å’Œå‡½æ•°å³æœåŠ¡ï¼ˆFaaSï¼‰ç»“åˆèµ·æ¥ã€‚ç‰¹åˆ«æ˜¯ï¼Œæˆ‘ä»¬å°†æ·±å…¥ç ”ç©¶å…¶ç‰¹æ€§å’ŒåŠŸèƒ½ï¼Œåˆ†æåœ¨ K8s æ¶æ„ä¸Šæ„å»ºçš„ä¸‰ä¸ªæ— æœåŠ¡å™¨æ¡†æ¶çš„è¿è¡Œæ€§èƒ½å’Œæ•ˆç‡ï¼šï¼ˆiï¼‰Fission; ï¼ˆiiï¼‰OpenFaaS; ï¼ˆiiiï¼‰Kubelessã€‚&lt;/p&gt;
&lt;h2 id=&#34;a-ä¸ºä»€ä¹ˆ-kubernetes-æ˜¯æ— æœåŠ¡å™¨çš„ä¼˜ç§€ç¼–æ’ç³»ç»Ÿ&#34;&gt;A. ä¸ºä»€ä¹ˆ Kubernetes æ˜¯æ— æœåŠ¡å™¨çš„ä¼˜ç§€ç¼–æ’ç³»ç»Ÿï¼Ÿ&lt;/h2&gt;
&lt;p&gt;æ— æœåŠ¡å™¨ä½“ç³»ç»“æ„æŒ‡çš„æ˜¯ä»å¼€å‘äººå‘˜ä¸­æŠ½è±¡å‡ºæœåŠ¡å™¨ç®¡ç†ä»»åŠ¡çš„åº”ç”¨ç¨‹åºä½“ç³»ç»“æ„ï¼Œå¹¶é€šè¿‡åŠ¨æ€åˆ†é…å’Œç®¡ç†è®¡ç®—èµ„æºæ¥æé«˜å¼€å‘é€Ÿåº¦å’Œæ•ˆç‡ã€‚å‡½æ•°å³æœåŠ¡ï¼ˆFaaSï¼‰æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶è¢«æ„å»ºçš„æ— æœåŠ¡æ¶æ„ï¼Œå¯ä»¥åœ¨å…¶ä¸Šæ„å»ºæ— æœåŠ¡å™¨ä½“ç³»ç»“æ„ã€‚FaaS æ¡†æ¶ä½œä¸ºçŸ­æš‚çš„å®¹å™¨è¿è¡Œï¼Œå®ƒä»¬å·²ç»å®‰è£…äº†å…¬å…±è¯­è¨€è¿è¡Œæ—¶ï¼Œå¹¶å…è®¸åœ¨è¿™äº›è¿è¡Œæ—¶å†…æ‰§è¡Œä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;FaaS æ¡†æ¶åº”è¯¥èƒ½å¤Ÿåœ¨å„ç§åŸºç¡€æ¶æ„ä¸Šè¿è¡Œï¼Œä»¥å®ç°çœŸæ­£æœ‰ç”¨ï¼ŒåŒ…æ‹¬å…¬å…±äº‘ï¼Œæ··åˆäº‘å’Œå†…éƒ¨éƒ¨ç½²ç¯å¢ƒã€‚åœ¨çœŸå®ç”Ÿäº§ç¯å¢ƒä¸­åŸºäº FaaS è¿è¡Œæ—¶æ„å»ºçš„æ— æœåŠ¡å™¨æ¡†æ¶åº”è¯¥èƒ½å¤Ÿä¾é ç»è¿‡éªŒè¯å’Œæµ‹è¯•çš„ç¼–æ’å’Œç®¡ç†åŠŸèƒ½æ¥å¤§è§„æ¨¡éƒ¨ç½²å®¹å™¨å’Œåˆ†å¸ƒå¼å·¥ä½œè´Ÿè½½ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºç¼–æ’å’Œç®¡ç†ï¼Œæ— æœåŠ¡å™¨ FaaS æ¡†æ¶ä¾èµ– Kubernetesï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è·¨ä¸»æœºç¾¤é›†ç¼–æ’å®¹å™¨ã€‚&lt;/li&gt;
&lt;li&gt;æœ€å¤§åŒ–ç¨‹åº¦çš„åˆ©ç”¨ä¼ä¸šåº”ç”¨ç¨‹åºæ‰€éœ€çš„ç¡¬ä»¶èµ„æºã€‚&lt;/li&gt;
&lt;li&gt;ç®¡ç†å’Œè‡ªåŠ¨åŒ–åº”ç”¨ç¨‹åºéƒ¨ç½²å¹¶æä¾›å£°æ˜å¼æ›´æ–°ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡æŒ‚è½½å­˜å‚¨è¿è¡Œæœ‰çŠ¶æ€åº”ç”¨ç¨‹åºã€‚&lt;/li&gt;
&lt;li&gt;ç§’çº§æ‰©å®¹å®¹å™¨åŒ–åº”ç”¨ç¨‹åºå¹¶æä¾›æ”¯æŒå®ƒä»¬çš„èµ„æºã€‚&lt;/li&gt;
&lt;li&gt;å£°æ˜å¼åœ°ç®¡ç†æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;æä¾›ä¸€ä¸ªå¤§ç›˜ï¼Œæ¥æ£€æŸ¥åº”ç”¨çš„å¥åº·æƒ…å†µï¼Œå¹¶é€šè¿‡è‡ªåŠ¨é‡å¯ï¼Œè‡ªåŠ¨å¤åˆ¶å’Œè‡ªåŠ¨ç¼©æ”¾æ¥è¿›è¡Œåº”ç”¨ç¨‹åºçš„è‡ªæˆ‘ä¿®å¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwtsgn1842j20ao07idgj_hu7904463815441315927.webp 400w,
               /blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwtsgn1842j20ao07idgj_hu14470886180623711848.webp 760w,
               /blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwtsgn1842j20ao07idgj_hu2687682897170354090.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwtsgn1842j20ao07idgj_hu7904463815441315927.webp&#34;
               width=&#34;384&#34;
               height=&#34;270&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h4 id=&#34;æ— æœåŠ¡å™¨ç³»ç»Ÿå¯ä»¥åŒ…æ‹¬é€šè¿‡å®¢æˆ·ç«¯è¯·æ±‚è§¦å‘çš„åŠŸèƒ½æˆ–ä½œä¸ºä¸šåŠ¡æœåŠ¡çš„ä¸€éƒ¨åˆ†æ‰§è¡Œçš„åŠŸèƒ½è¿™ä¸¤ä¸ªè¿‡ç¨‹éƒ½å¯ä»¥ä½¿ç”¨å®¹å™¨é›†ç¾¤ç®¡ç†å™¨å¦‚-kubernetesè¿›è¡Œç¼–æ’èµ„æ–™æ¥æºdzonecom&#34;&gt;æ— æœåŠ¡å™¨ç³»ç»Ÿå¯ä»¥åŒ…æ‹¬é€šè¿‡å®¢æˆ·ç«¯è¯·æ±‚è§¦å‘çš„åŠŸèƒ½æˆ–ä½œä¸ºä¸šåŠ¡æœåŠ¡çš„ä¸€éƒ¨åˆ†æ‰§è¡Œçš„åŠŸèƒ½ã€‚è¿™ä¸¤ä¸ªè¿‡ç¨‹éƒ½å¯ä»¥ä½¿ç”¨å®¹å™¨é›†ç¾¤ç®¡ç†å™¨ï¼ˆå¦‚ Kubernetesï¼‰è¿›è¡Œç¼–æ’ã€‚èµ„æ–™æ¥æºï¼šdzone.com&lt;/h4&gt;
&lt;p&gt;æˆ‘ä»¬å°†åœ¨æœ¬æ–‡ä¸­ä»‹ç»ä¸‰ä¸ªæ— æœåŠ¡å™¨æ¡†æ¶å„è‡ªçš„ä¼˜ç‚¹å’Œç¼ºç‚¹ã€‚è¿™äº› FaaS æ¡†æ¶ä¹‹é—´çš„å…±åŒç‚¹æ˜¯ï¼Œå®ƒä»¬èƒ½å¤Ÿï¼ˆ1ï¼‰å°†å‡½æ•°è½¬åŒ–ä¸ºæœåŠ¡; ï¼ˆ2ï¼‰åˆ©ç”¨ Kubernetes å¹³å°ç®¡ç†è¿™äº›æœåŠ¡çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™äº›æ¡†æ¶èƒŒåçš„è®¾è®¡ï¼Œä¼šç”±äºå…¶ç”¨äºå®ç°çš„å…·ä½“æ–¹å¼çš„ä¸åŒè€Œæœ‰å·®å¼‚ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­æ¢è®¨ã€‚æˆ‘ä»¬å°†åœ¨ä»¥ä¸‹éƒ¨åˆ†ä¸­é‡ç‚¹ä»‹ç»è¿™äº›æ¡†æ¶ä¹‹é—´çš„ä¸€äº›å·®å¼‚ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ¡†æ¶æ˜¯åœ¨æºç çº§åˆ«æˆ– Docker é•œåƒçº§åˆ«è¿˜æ˜¯åœ¨ä¸­é—´è¿è¡Œï¼Œä¾‹å¦‚ buildpacksï¼Ÿ&lt;/li&gt;
&lt;li&gt;ç”±äºä½¿ç”¨å…¬å…±è¯­è¨€è¿è¡Œåº“å¯åŠ¨å®¹å™¨ï¼Œå†·å¯åŠ¨æ€§èƒ½çš„å»¶è¿Ÿæˆ–æ‰§è¡Œå‡½æ•°æœŸé—´çš„å»¶è¿Ÿåˆ†åˆ«æ˜¯å¤šå°‘ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å®ƒä»¬å¦‚ä½•ä¸ºæœåŠ¡åˆ†é…å†…å­˜æˆ–èµ„æºï¼Ÿ&lt;/li&gt;
&lt;li&gt;å®ƒä»¬å¦‚ä½•è®¿é—®å’Œéƒ¨ç½² Kubernetes çš„ç¼–æ’å’Œå®¹å™¨ç®¡ç†åŠŸèƒ½ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;b-openfaas-å’Œéƒ¨ç½²-spring-boot-æ¨¡æ¿&#34;&gt;B. OpenFaaS å’Œéƒ¨ç½² Spring Boot æ¨¡æ¿&lt;/h2&gt;
&lt;p&gt;OpenFaaS æ˜¯ä¸€ä¸ªæ— æœåŠ¡å™¨å¹³å°ï¼Œå…è®¸ä½¿ç”¨ Docker æˆ– Kubernetes ç®¡ç†å‡½æ•°ï¼Œå› ä¸ºå®ƒæ˜¯åŸºäº OCI æ ¼å¼çš„å®¹å™¨ã€‚OpenFaaS å¯ä»¥æ”¯æŒä¼ä¸šçº§æ‰©å±•çš„åŠŸèƒ½ï¼Œå¦‚ Docker Universal Control Plane ä¼ä¸šçº§é›†ç¾¤ç®¡ç†è§£å†³æ–¹æ¡ˆä¸ Docker Enterprise æˆ– Tectonic for Kubernetesã€‚OpenFaaS ç»§æ‰¿äº†ç°æœ‰çš„å®¹å™¨å®‰å…¨åŠŸèƒ½ï¼Œä¾‹å¦‚ r/o æ–‡ä»¶ç³»ç»Ÿï¼Œæƒé™ä¸‹é™å’Œå†…å®¹ä¿¡ä»»ã€‚å®ƒèƒ½å¤Ÿä½¿ç”¨ Docker æˆ– K8s è°ƒåº¦ç¨‹åº/å®¹å™¨ç¼–æ’çš„ç®¡ç†åŠŸèƒ½ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨å…¶ç›¸å…³çš„ä¸°å¯Œçš„å•†ä¸šå’Œç¤¾åŒºä¾›åº”å•†ç”Ÿæ€ç³»ç»Ÿã€‚åŒæ ·ï¼Œç”±äºå…¶å¤šè¯­è¨€ç‰¹æ€§ï¼Œä»»ä½•å¯æ‰§è¡Œæ–‡ä»¶éƒ½å¯ä»¥æ‰“åŒ…åˆ° OpenFaas ä¸­çš„å‡½æ•°ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;SpringBoot å’Œ Vertx æ˜¯å¼€å‘å¾®æœåŠ¡çš„éå¸¸æµè¡Œçš„æ¡†æ¶ï¼Œå®ƒä»¬çš„æ˜“ç”¨æ€§å·²ç»é€šè¿‡ OpenFaaS æ¨¡æ¿æ‰©å±•åˆ° OpenFaaSã€‚è¿™äº›æ¨¡æ¿å…è®¸åœ¨ OpenFaaS å¹³å°ä¸Šæ— ç¼åœ°å¼€å‘å’Œéƒ¨ç½²æ— æœåŠ¡å™¨å‡½æ•°ã€‚æ¨¡æ¿åœ¨&lt;a href=&#34;https://github.com/tmobile/faas-java-templates&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¿™é‡Œ&lt;/a&gt;çš„ github å­˜å‚¨åº“ä¸­å¯ç”¨ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•åœ¨ OpenFaaS å¹³å°ä¸Šéƒ¨ç½² SpringBoot æ¨¡æ¿ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åœ¨æœ¬åœ°å®‰è£…-openfaas&#34;&gt;åœ¨æœ¬åœ°å®‰è£… OpenFaaS&lt;/h3&gt;
&lt;h4 id=&#34;åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šä¸‹è½½å’Œå®‰è£…æ¨¡æ¿&#34;&gt;åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šä¸‹è½½å’Œå®‰è£…æ¨¡æ¿&lt;/h4&gt;
&lt;p&gt;æˆ‘ä»¬éœ€è¦å®‰è£…å’Œé…ç½® FaaS CLI ä»¥ä¸æœ¬åœ°æˆ–è¿œç¨‹ K8S æˆ– Docker é…åˆä½¿ç”¨ã€‚åœ¨æœ¬ç»ƒä¹ ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æœ¬åœ° Docker å®¢æˆ·ç«¯ï¼Œå¹¶åœ¨åç»­å·¥ä½œä¸­å°†å…¶æ‰©å±•åˆ°åŸºäºäº‘çš„ GKE é›†ç¾¤ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºæœ€æ–°ç‰ˆæœ¬çš„ CLI ç±»å‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;$ curl -sL https://cli.openfaas.com | sudo sh&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;[æˆ–é€šè¿‡ MacOS ä¸Šçš„ brew install faas-cliã€‚]&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤éªŒè¯æœ¬åœ°å®‰è£…çš„æ¨¡æ¿ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;faas-cli new --list&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬åˆ›å»ºæ— æœåŠ¡å™¨å‡½æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šå®‰è£…è¿™äº›æ¨¡æ¿ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; faas-cli template pull https://github.com/tmobile/faas-java-templates.git
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;æŸ¥çœ‹å¸®åŠ©èœå•&#34;&gt;æŸ¥çœ‹å¸®åŠ©èœå•&lt;/h4&gt;
&lt;p&gt;å¯ä»¥ä¸ºæ‰€æœ‰å‘½ä»¤è°ƒç”¨-help æ ‡å¿—ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;$ faas-cli --help&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ä»å‘½ä»¤è¡Œç®¡ç†æ‚¨çš„ OpenFaaS åŠŸèƒ½&lt;/p&gt;
&lt;p&gt;ç”¨æ³•ï¼š &lt;code&gt;faas-cli&lt;/code&gt; [flags] &lt;code&gt;faas-cli&lt;/code&gt; [command]&lt;/p&gt;
&lt;p&gt;å¯ç”¨å‘½ä»¤ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;build&lt;/code&gt; æ„å»º OpenFaaS åŠŸèƒ½å®¹å™¨&lt;/p&gt;
&lt;p&gt;&lt;code&gt;deploy&lt;/code&gt; éƒ¨ç½² OpenFaaS åŠŸèƒ½&lt;/p&gt;
&lt;p&gt;&lt;code&gt;help&lt;/code&gt; æœ‰å…³ä»»ä½•å‘½ä»¤çš„å¸®åŠ©&lt;/p&gt;
&lt;p&gt;&lt;code&gt;push&lt;/code&gt; å°† OpenFaaS åŠŸèƒ½æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼ˆDocker Hubï¼‰&lt;/p&gt;
&lt;p&gt;&lt;code&gt;remove&lt;/code&gt; åˆ é™¤å·²éƒ¨ç½²çš„ OpenFaaS åŠŸèƒ½&lt;/p&gt;
&lt;p&gt;&lt;code&gt;version&lt;/code&gt; æ˜¾ç¤ºå®¢æˆ·ç«¯ç‰ˆæœ¬ä¿¡æ¯&lt;/p&gt;
&lt;p&gt;å‚æ•°ï¼š &lt;code&gt;-h&lt;/code&gt;ï¼Œ&lt;code&gt;--help&lt;/code&gt; å¸®åŠ© FAAS-CLI &lt;code&gt;-f&lt;/code&gt;ï¼Œ&lt;code&gt;--yaml string&lt;/code&gt; æè¿°å‡½æ•°çš„ yaml æ–‡ä»¶çš„è·¯å¾„&lt;/p&gt;
&lt;p&gt;æœ‰å…³å‘½ä»¤çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·ä½¿ç”¨ &lt;code&gt;faas-cli&lt;/code&gt; [command] &lt;code&gt;--help&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&#34;ç”¨å·²å®‰è£…çš„æ¨¡æ¿åˆ›å»ºå‡½æ•°&#34;&gt;ç”¨å·²å®‰è£…çš„æ¨¡æ¿åˆ›å»ºå‡½æ•°&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨æ¥è‡ªVertx/SpringBootæ¨¡æ¿çš„githubå­˜å‚¨åº“ä¸­æˆ‘ä»¬æ„Ÿå…´è¶£çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼ˆç”¨æˆ‘ä»¬çš„å‡½æ•°æ›¿æ¢å¤§æ‹¬å·å†…çš„æ–‡æœ¬ï¼Œæˆ‘ä»¬ä½¿ç”¨springbootä½†ä½ å¯ä»¥ç”¨vertxæ¨¡æ¿ä»£æ›¿å®ƒï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;faas-cli new {function of function} --lang springboot&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ mvnwï¼Œå‘½ä»¤æ˜¯&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;faas-cli new mvnw --lang vertx | springboot 
Folder: mvnw created.
Function created in folder: mvnw 
Stack file written: mvnw.yml
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;mvnw.yml çš„å†…å®¹ç°åœ¨å¯ä»¥ä¸ CLI ä¸€èµ·ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„ï¼šå¦‚æœæ‚¨çš„ç¾¤é›†æ˜¯è¿œç¨‹çš„æˆ–æœªåœ¨ 8080 ç«¯å£ä¸Šè¿è¡Œ - è¯·åœ¨ç»§ç»­ä¹‹å‰åœ¨ YAML æ–‡ä»¶ä¸­å¯¹å…¶è¿›è¡Œç¼–è¾‘ã€‚ä¸ºæˆ‘ä»¬çš„å‡½æ•°ç”Ÿæˆäº† handler.java æ–‡ä»¶ã€‚æ‚¨å¯ä»¥ç¼–è¾‘ pom.xml æ–‡ä»¶ï¼Œå¹¶åœ¨â€œbuildâ€æ­¥éª¤ä¸­å®‰è£…æ‰€æœ‰ä¾èµ–é¡¹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;æ„å»ºå‡½æ•°&#34;&gt;æ„å»ºå‡½æ•°&lt;/h4&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬å·²ç»åˆ›å»ºäº†å‡½æ•°é€»è¾‘ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ faas cli build å‘½ä»¤æ„å»ºå‡½æ•°ã€‚æˆ‘ä»¬å°†ä½¿ç”¨æœ¬åœ° Docker å®¢æˆ·ç«¯å°†è¯¥å‡½æ•°æ„å»ºåˆ° docker é•œåƒä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ faas-cli build -f mvnw.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Building: mvnw.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Clearing temporary build folder: ./build/mvnw/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Preparing ./mvnw/ ./build/mvnw/function
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Building: mvnw with node template. Please wait..
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;docker build -t mvnw .
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Sending build context to Docker daemon  8.704kB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Step 1/19 : FROM node:6.11.2-alpine
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; ---&amp;gt; 16566b7ed19e
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Step 19/19 : CMD fwatchdog
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; ---&amp;gt; Running in 53d04c1631aa
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; ---&amp;gt; f5e1266b0d32
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Removing intermediate container 53d04c1631aa
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Successfully built f5e1266b0d32
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Successfully tagged mvnw:latest
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Image: mvnw built.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;æ¨é€æ‚¨çš„å‡½æ•°å¯é€‰å› ä¸ºæˆ‘ä»¬æ­£åœ¨è¿›è¡Œæœ¬åœ°å®‰è£…&#34;&gt;æ¨é€æ‚¨çš„å‡½æ•°ï¼ˆå¯é€‰ï¼Œå› ä¸ºæˆ‘ä»¬æ­£åœ¨è¿›è¡Œæœ¬åœ°å®‰è£…ï¼‰&lt;/h4&gt;
&lt;p&gt;ä¸ºäº†éƒ¨ç½²æˆ‘ä»¬çš„å‡½æ•°ï¼Œæˆ‘ä»¬å°†ç¼–è¾‘ mvnw.yml æ–‡ä»¶å¹¶å°†â€œimageâ€è¡Œè®¾ç½®ä¸º Docker Hub ä¸Šé€‚ç”¨çš„ç”¨æˆ·åï¼Œä¾‹å¦‚ï¼šhishamhasan/mvnwã€‚ç„¶åæˆ‘ä»¬å°†å†æ¬¡æ„å»ºè¯¥å‡½æ•°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ faas-cli push -f mvnw.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Pushing: mvnw to remote repository.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;The push refers to a repository &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;docker.io/hishamhasan/mvnw&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®Œæˆæ­¤æ“ä½œåï¼Œé•œåƒå°†è¢«æ¨é€åˆ° Docker Hub æˆ–è¿œç¨‹ Docker registryï¼Œæˆ‘ä»¬å¯ä»¥éƒ¨ç½²å¹¶è¿è¡Œè¯¥å‡½æ•°ã€‚&lt;/p&gt;
&lt;h4 id=&#34;éƒ¨ç½²å‡½æ•°&#34;&gt;éƒ¨ç½²å‡½æ•°&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ faas-cli deploy -f mvnw.yml
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Deploying: mvnw.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;No existing service to remove
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Deployed.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;URL: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;http://localhost:8080/function/mvnw&lt;span class=&#34;o&#34;&gt;](&lt;/span&gt;http://localhost:8080/function/mvnw&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;è°ƒç”¨å‡½æ•°&#34;&gt;è°ƒç”¨å‡½æ•°&lt;/h4&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
$ faas-cli invoke -f mvnw.yml callme
Reading from STDIN - hit (Control + D) to stop.
This is my message

{&amp;#34;status&amp;#34;:&amp;#34;done&amp;#34;}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æˆ‘ä»¬è¿˜å¯ä»¥å°†å‘½ä»¤ä¼ é€’ç»™å‡½æ•°ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ date | faas-cli invoke -f mvnw.yml mvnw
{&amp;#34;status&amp;#34;:&amp;#34;done&amp;#34;}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;åœ¨-google-cloud-platform-ä¸Šå®‰è£…-openfaas&#34;&gt;åœ¨ Google Cloud Platform ä¸Šå®‰è£… OpenFaaS&lt;/h3&gt;
&lt;p&gt;åœ¨ä½¿ç”¨ OpenFaaS æ—¶ï¼Œæˆ‘ä»¬ä¸é™äºä»»ä½•æœ¬åœ°æˆ–äº‘åŸºç¡€æ¶æ„ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»åœ¨æœ¬åœ° Docker é›†ç¾¤ä¸­éƒ¨ç½²äº†æ¨¡æ¿ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ GCP ä¸­çš„ GKE ä¸Šè®¾ç½®å®ƒæ¥åˆ©ç”¨ OpenFaaS çš„å¤šåŠŸèƒ½æ€§ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ›å»ºä¸€ä¸ªåä¸ºçš„ GCP é¡¹ç›®&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cloud.google.com/sdk/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åœ¨æ­¤å¤„&lt;/a&gt; ä¸‹è½½å¹¶å®‰è£… Google Cloud SDKã€‚å®‰è£… SDK åï¼Œè¿è¡Œ gcloud initï¼Œç„¶åå°†é»˜è®¤é¡¹ç›®è®¾ç½®ä¸º openfaasã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ gcloud å®‰è£… kubectlï¼š &lt;code&gt;gcloud components install kubectl&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å¯¼èˆªåˆ° API Manager&amp;gt;å‡­æ®&amp;gt;åˆ›å»ºå‡­æ®&amp;gt;æœåŠ¡å¸æˆ·å¯†é’¥ã€‚&lt;/li&gt;
&lt;li&gt;é€‰æ‹© JSON ä½œä¸ºå¯†é’¥ç±»å‹ã€‚å°†æ–‡ä»¶é‡å‘½åä¸º json å¹¶å°†å…¶æ”¾åœ¨é¡¹ç›®ä¸­&lt;/li&gt;
&lt;li&gt;æ·»åŠ åˆšåˆšåœ¨ ComputeEngine&amp;gt; Metadata&amp;gt; SSH Keys ä¸‹åˆ›å»ºçš„ SSH å¯†é’¥ï¼Œå¹¶ä½¿ç”¨æ‚¨çš„å…¬å…± SSH å¯†é’¥ä½œä¸ºå€¼åˆ›å»ºåä¸º sshKeys çš„å…ƒæ•°æ®æ¡ç›®ã€‚&lt;/li&gt;
&lt;li&gt;åˆ›å»ºä¸€ä¸ªä¸‰èŠ‚ç‚¹ Kubernetes é›†ç¾¤ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä½äºä¸åŒçš„åŒºåŸŸä¸­ã€‚åœ¨&lt;a href=&#34;https://kubernetes.io/docs/concepts/cluster-administration/federation/#selecting-the-right-number-of-clusters&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ­¤å¤„&lt;/a&gt; é˜…è¯» æœ‰å…³ç¾¤é›†è”åˆçš„ä¿¡æ¯ï¼Œä»¥äº†è§£å¦‚ä½•é€‰æ‹©æ¯ä¸ªç¾¤é›†ä¸­çš„ç¾¤é›†æ•°å’ŒèŠ‚ç‚¹æ•°ï¼Œè¿™äº›ç¾¤é›†å¯èƒ½ä¼šæ ¹æ®è´Ÿè½½æˆ–å¢é•¿é¢‘ç¹æ›´æ”¹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;k8s_version&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;gcloud container get-server-config --format&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;json &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; jq -r &lt;span class=&#34;s1&#34;&gt;&amp;#39;.validNodeVersions[0]&amp;#39;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gcloud container clusters create demo &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   --cluster-version&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;k8s_version&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   --zone&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;us-west1-a &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   --additional-zones&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;us-west1-b,us-west1-c &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   --num-nodes&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   --machine-type&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;n1-standard-2 &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;   --scopes&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;default,storage-rw
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°†é»˜è®¤èŠ‚ç‚¹æ± çš„å¤§å°å¢åŠ åˆ°æ‰€éœ€çš„èŠ‚ç‚¹æ•°ï¼ˆåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†æŒ‰æ¯”ä¾‹å¢åŠ  3 åˆ° 9 ä¸ªèŠ‚ç‚¹ï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;gcloud container clusters resize --size=3&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨æ­¤ &lt;a href=&#34;https://cloud.google.com/sdk/gcloud/reference/container/clusters/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é¡µé¢ä¸­&lt;/a&gt; æ‰€è¿°çš„åˆé€‚çš„ SDK å‘½ä»¤æ¥æ‰§è¡Œé›†ç¾¤ç®¡ç†åŠŸèƒ½ï¼Œä¾‹å¦‚åˆ é™¤é›†ç¾¤ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;gcloud container clusters delete demo -z=us-west1-a&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;å®Œæ•´çš„ç®¡ç†è®¾ç½®&#34;&gt;å®Œæ•´çš„ç®¡ç†è®¾ç½®&lt;/h3&gt;
&lt;p&gt;è®¾ç½® kubectl çš„å‡­æ®ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;gcloud container clusters get-credentials demo -z=us-west1-a&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;åˆ›å»ºé›†ç¾¤ç®¡ç†å‘˜ç”¨æˆ·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create clusterrolebinding &lt;span class=&#34;s2&#34;&gt;&amp;#34;cluster-admin-&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;whoami&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--clusterrole&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;cluster-admin &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--user&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;gcloud config get-value core/account&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆäºˆ kubernetes-dashboard ç®¡ç†å‘˜æƒé™ï¼ˆç¡®ä¿åœ¨éç”Ÿäº§ç¯å¢ƒä¸­å®Œæˆï¼‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl create clusterrolebinding &lt;span class=&#34;s2&#34;&gt;&amp;#34;cluster-admin-&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;whoami&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--clusterrole&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;cluster-admin &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--user&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;gcloud config get-value core/account&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨ kubectl åå‘ä»£ç†åœ¨æµè§ˆå™¨ï¼ˆæˆ–åœ¨ &lt;a href=&#34;http://localhost:9099/ui&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http//localhost:9099/ui&lt;/a&gt; ï¼‰ä¸Šè°ƒç”¨ &lt;code&gt;kubectl proxy --port=8080&lt;/code&gt; å’Œå¯¼èˆªåˆ° &lt;a href=&#34;http://localhost:8080/ui&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http//localhost:8080/ui&lt;/a&gt; æ¥è®¿é—® port-8080 ä¸Šçš„ kubernetes-dashboardï¼š&lt;a href=&#34;http://localhost:9099/ui&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://localhost:9099/ui&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;kubectl proxy --port=9099 &amp;amp;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Kubernetes é›†ç¾¤ç”±ä¸»èŠ‚ç‚¹å’ŒèŠ‚ç‚¹èµ„æºç»„æˆ - ä¸»èŠ‚ç‚¹åè°ƒé›†ç¾¤ï¼ŒèŠ‚ç‚¹è¿è¡Œåº”ç”¨ç¨‹åºï¼Œå¹¶é€šè¿‡ Kubernetes API è¿›è¡Œé€šä¿¡ã€‚æˆ‘ä»¬ä½¿ç”¨ OpenFaaS CLI æ„å»ºäº†å®¹å™¨åŒ–åº”ç”¨ç¨‹åºå¹¶ç¼–å†™äº†.yml æ–‡ä»¶æ¥æ„å»ºå’Œéƒ¨ç½²è¯¥å‡½æ•°ã€‚é€šè¿‡åœ¨ Kubernetes é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¹‹é—´éƒ¨ç½²è¯¥å‡½æ•°ï¼Œæˆ‘ä»¬å…è®¸ GKE åˆ†å‘å’Œè°ƒåº¦æˆ‘ä»¬çš„èŠ‚ç‚¹èµ„æºã€‚æˆ‘ä»¬çš„èŠ‚ç‚¹å·²ç»é…ç½®äº†å¤„ç†å®¹å™¨æ“ä½œçš„å·¥å…·ï¼Œå¯ä»¥é€šè¿‡ kubectl CLIã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwtsgn3annj20d80apmy6_hu11415281114652771162.webp 400w,
               /blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwtsgn3annj20d80apmy6_hu4969309593255260382.webp 760w,
               /blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwtsgn3annj20d80apmy6_hu4256356590883393405.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwtsgn3annj20d80apmy6_hu11415281114652771162.webp&#34;
               width=&#34;476&#34;
               height=&#34;385&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h4 id=&#34;èµ„æ–™æ¥æºdzonecom&#34;&gt;èµ„æ–™æ¥æºï¼šdzone.com&lt;/h4&gt;
&lt;h3 id=&#34;ä½¿ç”¨åŸºæœ¬èº«ä»½éªŒè¯éƒ¨ç½²-openfaas&#34;&gt;ä½¿ç”¨åŸºæœ¬èº«ä»½éªŒè¯éƒ¨ç½² OpenFaaSã€‚&lt;/h3&gt;
&lt;p&gt;å…‹éš† openfaas-gke å­˜å‚¨åº“ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/tmobile/faas-java-templates.git
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; openfaas-gke
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆ›å»º openfaas å’Œ openfaas-fn åç§°ç©ºé—´ä»¥åœ¨å¤šç§Ÿæˆ·è®¾ç½®ä¸­éƒ¨ç½² OpenFaaS æœåŠ¡ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;kubectl apply -f ./namespaces.yaml&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è¦åœ¨ openfaas å‘½åç©ºé—´ä¸­éƒ¨ç½² OpenFaaS æœåŠ¡ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;kubectl apply -f ./openfaas&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è¿™å°†ä¸º OpenFaaS ç½‘å…³ï¼ŒFaaS-netesdï¼ˆK8S æ§åˆ¶å™¨ï¼‰ï¼ŒPrometheusï¼Œè­¦æŠ¥ç®¡ç†å™¨ï¼ŒNats å’Œé˜Ÿåˆ—å·¥ä½œè€…æä¾› K8s podsï¼Œéƒ¨ç½²å’ŒæœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬éœ€è¦åœ¨é€šè¿‡è®¾ç½®èº«ä»½éªŒè¯åœ¨ Internet ä¸Šå…¬å¼€ OpenFaaS ä¹‹å‰ä¿æŠ¤æˆ‘ä»¬çš„ç½‘å…³ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ç»„å‡­æ®åˆ›å»ºä¸€ä¸ªé€šç”¨çš„ basic-auth ç§˜å¯†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kubectl -n openfaas create secret generic basic-auth &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--from-literal&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;admin &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;--from-literal&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;password&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;admin
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åæˆ‘ä»¬å¯ä»¥ä¸ºæˆ‘ä»¬çš„ OpenFaaS ç½‘å…³éƒ¨ç½² Caddyï¼Œå®ƒæ—¢å¯ä»¥ä½œä¸ºåå‘ä»£ç†ï¼Œåˆå¯ä»¥ä½œä¸ºå¼ºå¤§çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œå¹¶æ”¯æŒ WebSocket è¿æ¥ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;kubectl apply -f ./caddy&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ K8s æœåŠ¡å¯¹è±¡å…¬å¼€çš„å¤–éƒ¨ IP è®¿é—® OpenFaaS ç½‘å…³ UIï¼Œå¹¶ä½¿ç”¨æˆ‘ä»¬çš„å‡­æ®è®¿é—® http://&amp;lt;EXTERNAL-IP&amp;gt;ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿è¡Œ kubectl get svc æ¥è·å–å¤–éƒ¨ IPã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;get_gateway_ip&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; kubectl -n openfaas describe service caddy-lb &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep Ingress &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; awk&lt;span class=&#34;s1&#34;&gt;&amp;#39;{ print $NF }&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;until&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;get_gateway_ip&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; sleep1&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; -n &lt;span class=&#34;s2&#34;&gt;&amp;#34;.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;.&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;gateway_ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;get_gateway_ip&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;OpenFaaS Gateway IP: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;gateway_ip&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„ï¼šå¦‚æœå¤–éƒ¨ IP åœ°å€æ˜¾ç¤ºä¸º&lt;pending&gt;ï¼Œè¯·ç­‰å¾…ä¸€åˆ†é’Ÿå†æ¬¡è¾“å…¥ç›¸åŒçš„å‘½ä»¤ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦‚æœæ‚¨å°šæœªæ‰§è¡Œä¸Šä¸€ä¸ªç»ƒä¹ ï¼Œè¯·é€šè¿‡è°ƒç”¨å®‰è£… OpenFaaS CLIã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;curl-sL cli.openfaas.com | sh&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åä½¿ç”¨ CLIï¼Œå‡­æ®å’Œ K8s æœåŠ¡å…¬å¼€çš„å¤–éƒ¨ IP ç™»å½•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;faas-cli login -u admin -p admin --gateway http://&amp;lt;EXTERNAL-IP&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„ï¼šï¼ˆaï¼‰æ‚¨å¯ä»¥é€šè¿‡åˆ›å»º Ingress èµ„æºï¼Œä½¿ç”¨ Google Cloud L7 HTTPS è´Ÿè½½å‡è¡¡å™¨å…¬å¼€ OpenFaaS ç½‘å…³ã€‚æ‚¨å¯ä»¥åœ¨ &lt;a href=&#34;https://cloud.google.com/kubernetes-engine/docs/tutorials/http-balancer&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ­¤å¤„&lt;/a&gt; æ‰¾åˆ°æœ‰å…³åˆ›å»ºè´Ÿè½½å‡è¡¡å™¨çš„è¯¦ç»†æŒ‡å—ã€‚ï¼ˆbï¼‰æ‚¨å¯ä»¥ä½¿ç”¨å¯†ç åˆ›å»ºæ–‡æœ¬æ–‡ä»¶ï¼Œå¹¶å°†è¯¥æ–‡ä»¶ä¸-password-stdin æ ‡å¿—ä¸€èµ·ä½¿ç”¨ï¼Œä»¥é¿å…åœ¨ bash å†å²è®°å½•ä¸­è¾“å…¥å¯†ç ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;æ‚¨å¯ä»¥ä½¿ç”¨å…ˆå‰åœ¨ä¸Šä¸€ä¸ªç»ƒä¹ ä¸­å‘å¸ƒçš„é•œåƒå¹¶éƒ¨ç½²æ— æœåŠ¡å™¨åŠŸèƒ½&#34;&gt;æ‚¨å¯ä»¥ä½¿ç”¨å…ˆå‰åœ¨ä¸Šä¸€ä¸ªç»ƒä¹ ä¸­å‘å¸ƒçš„é•œåƒå¹¶éƒ¨ç½²æ— æœåŠ¡å™¨åŠŸèƒ½ã€‚&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;$ faas-cli deploy -f mvnw.yml&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;deploy å‘½ä»¤åœ¨å½“å‰ç›®å½•ä¸­æŸ¥æ‰¾ mvnw.yml æ–‡ä»¶ï¼Œå¹¶éƒ¨ç½² openfaas-fn å‘½åç©ºé—´ä¸­çš„æ‰€æœ‰å‡½æ•°ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„ï¼šï¼ˆaï¼‰æ‚¨å¯ä»¥ä½¿ç”¨ com.openfaas.scale.min æ ‡ç­¾è®¾ç½®æœ€å°è¿è¡Œ pod æ•°ï¼Œå¹¶ä¸º autoscaler com.openfaas.scale.max è®¾ç½®æœ€å°å‰¯æœ¬æ•°ã€‚OpenFaaS çš„é»˜è®¤è®¾ç½®æ˜¯æ¯ä¸ªåŠŸèƒ½è¿è¡Œä¸€ä¸ª podï¼Œå¹¶ä¸”åœ¨è´Ÿè½½ä¸‹æœ€å¤šå¯æ‰©å±•åˆ° 20 ä¸ª pod&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;è°ƒç”¨æ— æœåŠ¡å™¨åŠŸèƒ½&#34;&gt;è°ƒç”¨æ— æœåŠ¡å™¨åŠŸèƒ½ã€‚&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;faas-cli invoke mvnw--gateway=http://&amp;lt;GATEWAY-IP&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;æ‚¨å¯ä»¥éšæ—¶æ³¨é”€&#34;&gt;æ‚¨å¯ä»¥éšæ—¶æ³¨é”€ï¼š&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;faas-cli logout -gateway http://&amp;lt;EXTERNAL-IP&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;c-fission-å’Œéƒ¨ç½²ç®€å•çš„-http-è¯·æ±‚&#34;&gt;C. Fission å’Œéƒ¨ç½²ç®€å•çš„ HTTP è¯·æ±‚&lt;/h2&gt;
&lt;p&gt;Fission æ˜¯ä¸€ä¸ªæ— æœåŠ¡å™¨æ¡†æ¶ï¼Œå®ƒè¿›ä¸€æ­¥æŠ½è±¡å‡ºå®¹å™¨é•œåƒï¼Œå¹¶å…è®¸ä»…é€šè¿‡å‡½æ•°åœ¨ K8s ä¸Šåˆ›å»º HTTP æœåŠ¡ã€‚Fission ä¸­çš„å®¹å™¨é•œåƒåŒ…å«è¯­è¨€è¿è¡Œæ—¶ï¼Œä¸€ç»„å¸¸ç”¨çš„ä¾èµ–é¡¹å’Œä¸€ä¸ªç”¨äºå‡½æ•°çš„åŠ¨æ€åŠ è½½å™¨ã€‚å¯ä»¥å®šåˆ¶è¿™äº›å›¾åƒï¼Œä¾‹å¦‚æ‰“åŒ…äºŒè¿›åˆ¶ä¾èµ–é¡¹ã€‚Fission èƒ½å¤Ÿé€šè¿‡ç»´æŠ¤ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨æ± æ¥ä¼˜åŒ–å†·å¯åŠ¨å¼€é”€ã€‚å½“æ–°è¯·æ±‚æ¥è‡ªå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºæˆ–ä¸šåŠ¡æœåŠ¡æ—¶ï¼Œå®ƒä¼šå°†è¯¥å‡½æ•°å¤åˆ¶åˆ°å®¹å™¨ä¸­ï¼ŒåŠ¨æ€åŠ è½½å®ƒï¼Œå¹¶å°†è¯·æ±‚è·¯ç”±åˆ°è¯¥å®ä¾‹ã€‚å› æ­¤ï¼Œå¯¹äº NodeJS å’Œ Python å‡½æ•°ï¼Œå®ƒèƒ½å¤Ÿæœ€å°åŒ– 100 æ¯«ç§’çš„å†·å¯åŠ¨å¼€é”€ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡åœ¨æºç çº§åˆ«è¿›è¡Œæ“ä½œï¼ŒFission ä½¿ç”¨æˆ·ä¸å¿…å¤„ç†å®¹å™¨çš„é•œåƒæ„å»ºï¼Œå°†é•œåƒæ¨é€åˆ°æ³¨å†Œè¡¨ï¼Œç®¡ç†æ³¨å†Œè¡¨å‡­æ®ï¼Œé•œåƒç‰ˆæœ¬æ§åˆ¶å’Œå…¶ä»–ç®¡ç†ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwtsgn7oehj20hs0dcglu_hu10311777757427491641.webp 400w,
               /blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwtsgn7oehj20hs0dcglu_hu10973092970722510306.webp 760w,
               /blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwtsgn7oehj20hs0dcglu_hu352298457978439969.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwtsgn7oehj20hs0dcglu_hu10311777757427491641.webp&#34;
               width=&#34;640&#34;
               height=&#34;480&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h4 id=&#34;httpskubernetesioblog201701fission-serverless-functions-as-service-for-kubernetes&#34;&gt;&lt;a href=&#34;https://kubernetes.io/blog/2017/01/fission&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://kubernetes.io/blog/2017/01/fission&lt;/a&gt;-serverless-functions-as-service-for-kubernetes&lt;/h4&gt;
&lt;p&gt;å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒFission è¢«è®¾è®¡ä¸ºä¸€ç»„å¾®æœåŠ¡ï¼Œä¸»è¦ç»„ä»¶å¦‚ä¸‹æ‰€è¿°ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è·Ÿè¸ªåŠŸèƒ½ï¼ŒHTTP è·¯ç”±ï¼Œäº‹ä»¶è§¦å‘å™¨å’Œç¯å¢ƒé•œåƒçš„æ§åˆ¶å™¨;&lt;/li&gt;
&lt;li&gt;ç®¡ç†ç©ºé—²ç¯å¢ƒå®¹å™¨æ± çš„æ± ç®¡ç†å™¨ï¼Œå°†å‡½æ•°åŠ è½½åˆ°è¿™äº›å®¹å™¨ä¸­ï¼Œå¹¶å®šæœŸæ€æ­»å‡½æ•°å®ä¾‹ä»¥ç®¡ç†å®¹å™¨å¼€é”€;&lt;/li&gt;
&lt;li&gt;ä¸€ç§è·¯ç”±å™¨ï¼Œå®ƒæ¥æ”¶ HTTP è¯·æ±‚å¹¶å°†å®ƒä»¬è·¯ç”±åˆ° poolmgr æˆ–å·²åœ¨è¿è¡Œçš„å®ä¾‹ä¸­çš„æ–°é²œå‡½æ•°å®ä¾‹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åœ¨ä¸Šä¸€ä¸ªç»ƒä¹ ä¸­ GCP ä¸Šåˆ›å»ºçš„ K8s ç¾¤é›†åœ¨ Fission ä¸Šéƒ¨ç½² HTTP è¯·æ±‚ã€‚è®©æˆ‘ä»¬èµ°è¿‡è¿™ä¸ªè¿‡ç¨‹å§ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å®‰è£… Helm CLIï¼ŒHelm æ˜¯ä¸€ä¸ª Kubernetes åŒ…ç®¡ç†å™¨ã€‚è®©æˆ‘ä»¬åˆå§‹åŒ– Helmï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ helm init
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ GKE å‘½åç©ºé—´ä¸­å®‰è£… Fission&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ helm install --namespace fission https://github.com/fission/fission/releases/download/0.7.0/fission-all-0.7.0.tgz
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®‰è£… Fission CLI&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;OSX&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl -Lo fission https://github.com/fission/fission/releases/download/0.7.0/fission-cli-osx&lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; chmod +x fission &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo mv fission /usr/local/bin/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;Windows&lt;/strong&gt; åœ¨ &lt;a href=&#34;https://github.com/fission/fission/releases&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ­¤å¤„&lt;/a&gt; ä¸‹è½½ Windows å¯æ‰§è¡Œæ–‡ä»¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ›å»º HTTP æœåŠ¡æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡æ¥æ‰“å° Hello Worldã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cat &amp;gt; hello.py
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;def main&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;context&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    print &lt;span class=&#34;s2&#34;&gt;&amp;#34;Hello, world!&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ Fission ä¸Šéƒ¨ç½² HTTP æœåŠ¡&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ fission &lt;span class=&#34;k&#34;&gt;function&lt;/span&gt; create --name hello --env python --code hello.py --route /hello
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl http://&amp;lt;fission router&amp;gt;/hello
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Hello, world!
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;d-kubeless-å’Œéƒ¨ç½²-spring-boot-æ¨¡æ¿&#34;&gt;D. Kubeless å’Œéƒ¨ç½² Spring Boot æ¨¡æ¿&lt;/h2&gt;
&lt;p&gt;Kubeless æ˜¯ä¸€ä¸ª Kubernetes åŸç”Ÿæ— æœåŠ¡å™¨æ¡†æ¶ï¼Œå¯ä»¥å°†åŠŸèƒ½éƒ¨ç½²åœ¨ K8s é›†ç¾¤ä¸Šï¼ŒåŒæ—¶å…è®¸ç”¨æˆ·åˆ©ç”¨ Kubernetes èµ„æºæä¾›è‡ªåŠ¨æ‰©å±•ï¼ŒAPI è·¯ç”±ï¼Œç›‘æ§å’Œæ•…éšœæ’é™¤ã€‚Kubeless ä½¿ç”¨ Kubernetes è‡ªå®šä¹‰èµ„æºå®šä¹‰æ¥åˆ›å»ºè‡ªå®šä¹‰ kubernetes èµ„æºçš„åŠŸèƒ½ã€‚è‡ªå®šä¹‰èµ„æºæ˜¯ &lt;a href=&#34;https://kubernetes.io/docs/reference/api-overview/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes API&lt;/a&gt; ä¸­çš„ç«¯ç‚¹ï¼Œç”¨äºå­˜å‚¨&lt;a href=&#34;https://kubernetes.io/docs/concepts/overview/working-with-objects/kubernetes-objects/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;API å¯¹è±¡&lt;/a&gt;çš„é›†åˆæŸç§ç±»å‹çš„ K8s pod å¯¹è±¡ï¼Œå®ƒä»£è¡¨äº†ç‰¹å®š K8s å®‰è£…çš„è‡ªå®šä¹‰ã€‚è‡ªå®šä¹‰èµ„æºéå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥é€šè¿‡åŠ¨æ€æ³¨å†Œè¿›è¡Œé…ç½®ç„¶ååœ¨æ­£åœ¨è¿è¡Œçš„é›†ç¾¤ä¸­åˆ é™¤ï¼Œé›†ç¾¤ç®¡ç†å‘˜å¯ä»¥ç‹¬ç«‹äºé›†ç¾¤æœ¬èº«æ›´æ–°è‡ªå®šä¹‰èµ„æºã€‚Kubeless åˆ©ç”¨è¿™äº›åŠŸèƒ½å¹¶è¿è¡Œé›†ç¾¤å†…æ§åˆ¶å™¨ï¼Œå¯ä»¥è·Ÿè¸ªè¿™äº›è‡ªå®šä¹‰èµ„æºå¹¶æŒ‰éœ€å¯åŠ¨è¿è¡Œæ—¶ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åœ¨ä¸Šä¸€ä¸ªç»ƒä¹ ä¸­ GCP ä¸Šåˆ›å»ºçš„ K8s ç¾¤é›†åœ¨ Fission ä¸Šéƒ¨ç½² HTTP è¯·æ±‚ã€‚è®©æˆ‘ä»¬èµ°è¿‡è¿™ä¸ªè¿‡ç¨‹å§ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;è®¿é—® Kubernetes ä»ªè¡¨æ¿&lt;/p&gt;
&lt;p&gt;åœ¨ K8s é›†ç¾¤æ­£åœ¨è¿è¡Œçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ kubectl åœ¨ 8080 ç«¯å£ä¸Šä½¿ç”¨ä»ªè¡¨æ¿ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;kubectl proxy --port=8080&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwtsjw13nsj218g0jrq81_hu8146819199494895755.webp 400w,
               /blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwtsjw13nsj218g0jrq81_hu6554973127486725531.webp 760w,
               /blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwtsjw13nsj218g0jrq81_hu762937371751097118.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwtsjw13nsj218g0jrq81_hu8146819199494895755.webp&#34;
               width=&#34;760&#34;
               height=&#34;337&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¯ä»¥é€šè¿‡æµè§ˆå™¨å¯¼èˆªåˆ°&lt;a href=&#34;http://localhost8080/ui&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://localhost8080/i&lt;/a&gt;æ¥è®¿é—®ä»ªè¡¨æ¿&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®‰è£… Kubeless CLI&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;OSX&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ curl -L https://github.com/kubeless/kubeless/releases/download/0.0.20/kubeless_darwin-amd64.zip &amp;gt; kubeless.zip
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ unzip kubeless.zip
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ sudo cp bundles/kubeless_darwin-amd64/kubeless /usr/local/bin/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;Windows&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ &lt;a href=&#34;https://github.com/kubeless/kubeless/releases&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ­¤å¤„&lt;/a&gt; ä¸‹è½½ Windows å¯æ‰§è¡Œæ–‡ä»¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ K8s ç¾¤é›†ä¸­éƒ¨ç½² Kubeless&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwx4ug1ieuj20jr0c3dgl_hu9945609035800016656.webp 400w,
               /blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwx4ug1ieuj20jr0c3dgl_hu8312316010963278602.webp 760w,
               /blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwx4ug1ieuj20jr0c3dgl_hu5755865410993365687.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwx4ug1ieuj20jr0c3dgl_hu9945609035800016656.webp&#34;
               width=&#34;711&#34;
               height=&#34;435&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°†ä½¿ç”¨æ­¤&lt;a href=&#34;https://github.com/kubeless/kubeless/releases&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é“¾æ¥ä¸­&lt;/a&gt; çš„æ¸…å•åœ¨ K8s ç¾¤é›†ä¸­éƒ¨ç½² Kublessã€‚æ ¹æ®æ¸…å•åˆ›å»ºä¸€ä¸ª kubeless å‘½åç©ºé—´ï¼Œä¸€ä¸ªå‡½æ•° ThirdPartyResourceï¼Œä¸€ä¸ª kubeless æ§åˆ¶å™¨ï¼Œå¹¶åœ¨è¿›ç¨‹ä¸­è®¾ç½®ä¸€ä¸ª kafkaï¼Œzookeeper StatefulSetã€‚Kubless çš„ä¸€ä¸ªä¸»è¦ä¼˜ç‚¹æ˜¯å®ƒå…·æœ‰é«˜åº¦çš„ Kubernetes åŸç”Ÿç‰¹æ€§ï¼Œå®ƒå¯ä»¥è®¾ç½®é rbac å’Œ rbac ç‰¹å®šç¯å¢ƒã€‚ä¸‹é¢çš„å±å¹•æˆªå›¾æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨ kubectl å‘½ä»¤åœ¨é rbac ç¯å¢ƒä¸­éƒ¨ç½² kubelessã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwx4ug4tx0j20hr05bwew_hu77309699975000167.webp 400w,
               /blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwx4ug4tx0j20hr05bwew_hu3891028060046040854.webp 760w,
               /blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwx4ug4tx0j20hr05bwew_hu13782409559035292937.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwx4ug4tx0j20hr05bwew_hu77309699975000167.webp&#34;
               width=&#34;639&#34;
               height=&#34;191&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ›å»ºå‡½æ•°&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæœåŠ¡å‡½æ•°ï¼Œå¹¶ä»è¯·æ±‚ä¸­æ¥å—æ–¹æ³•ï¼ŒURLï¼Œæ ‡é¢˜å’Œè¯·æ±‚ä½“ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;const &lt;span class=&#34;nv&#34;&gt;http&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; require&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;http&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    http.createServer&lt;span class=&#34;o&#34;&gt;((&lt;/span&gt;request, response&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      const &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; headers, method, url &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; request&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nb&#34;&gt;let&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;body&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      request.on&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;error&amp;#39;&lt;/span&gt;, &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;err&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        console.error&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;err&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;})&lt;/span&gt;.on&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;data&amp;#39;&lt;/span&gt;, &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;chunk&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        body.push&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;chunk&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;})&lt;/span&gt;.on&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;end&amp;#39;&lt;/span&gt;, &lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nv&#34;&gt;body&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; Buffer.concat&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;body&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.toString&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        // æ­¤æ—¶ï¼Œæˆ‘ä»¬æœ‰æ ‡é¢˜ï¼Œæ–¹æ³•ï¼Œç½‘å€å’Œè¯·æ±‚ä½“ï¼Œç°åœ¨å¯ä»¥åšä»»ä½•æˆ‘ä»¬éœ€è¦çš„äº‹æƒ…æ¥å›åº”è¿™ä¸ªè¦æ±‚ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;o&#34;&gt;})&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;})&lt;/span&gt;.listen&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;8080&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; // æ¿€æ´»æ­¤æœåŠ¡å™¨ï¼Œç›‘å¬ &lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt; ç«¯å£ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ Kubeless ç¯å¢ƒä¸­è¿è¡Œå‡½æ•°&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥é€šè¿‡æä¾›ä»¥ä¸‹ä¿¡æ¯å‘ Kubeless æ³¨å†Œè¯¥å‡½æ•°ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”¨äºé€šè¿‡ Web è®¿é—®è¯¥å‡½æ•°çš„åç§°&lt;/li&gt;
&lt;li&gt;ç”¨äºè®¿é—®è¯¥å‡½æ•°çš„åè®®&lt;/li&gt;
&lt;li&gt;è¦æ‰§è¡Œä»¥è¿è¡Œä»£ç çš„è¯­è¨€è¿è¡Œæ—¶&lt;/li&gt;
&lt;li&gt;åŒ…å«å‡½æ•°ä»£ç çš„æ–‡ä»¶çš„åç§°&lt;/li&gt;
&lt;li&gt;æ–‡ä»¶å†…éƒ¨å‡½æ•°çš„åç§°&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é€šè¿‡æ·»åŠ ä¸Šé¢çš„å˜é‡ 1-5ï¼Œæˆ‘ä»¬è°ƒç”¨ä»¥ä¸‹å‘½ä»¤åœ¨ Kubeless ä¸­æ³¨å†Œå’Œéƒ¨ç½²å‡½æ•°ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt; kubeless function deploy serverequest--trigger-http --runtime nodejs6 --handler serverequest.createServer --from-file /tmp/serverequest.js&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;eæ— æœåŠ¡å™¨å¹³å°çš„è¯„ä¼°&#34;&gt;E.æ— æœåŠ¡å™¨å¹³å°çš„è¯„ä¼°&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬è¯„ä¼°çš„æ¯ä¸ªæ— æœåŠ¡å™¨å¹³å°éƒ½æœ‰å…¶ç‹¬ç‰¹çš„ä»·å€¼ä¸»å¼ ã€‚ä½¿ç”¨ OpenFaasï¼Œä»»ä½•è¿›ç¨‹æˆ–å®¹å™¨éƒ½å¯ä»¥æ‰“åŒ…ä¸º Linux æˆ– Windows çš„æ— æœåŠ¡å™¨åŠŸèƒ½ã€‚å¯¹äºä¼ä¸šè€Œè¨€ï¼ŒOpenFaaS ä½¿ç”¨çš„ä½“ç³»ç»“æ„æä¾›äº†æ— ç¼æ’å…¥è®¡åˆ’ç¾¤é›†å’Œç°æœ‰å¾®æœåŠ¡çš„ CI/CD å·¥ä½œæµçš„èƒ½åŠ›ï¼Œå› ä¸º OpenFaaS æ˜¯å›´ç»• Docker æ„å»ºçš„ï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½æ‰“åŒ…åˆ° Docker é•œåƒä¸­ã€‚OpenFaaS è¿˜ä¸ºä¼ä¸šæä¾›äº†ä¸€ç§é€šè¿‡å¤–éƒ¨ APIï¼Œç½‘å…³ç®¡ç†å’Œæ‰§è¡Œå‡½æ•°çš„æ— ç¼æ–¹å¼ï¼Œå¹¶ç®¡ç†å‡½æ•°çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬é€šè¿‡æä¾›å•†è¿›è¡Œéƒ¨ç½²ï¼Œæ‰©å±•å’Œ secret ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;Fission å…·æœ‰äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œä½¿å…¶æˆä¸ºçŸ­æœŸæ— çŠ¶æ€åº”ç”¨ç¨‹åºçš„ç†æƒ³é€‰æ‹©ï¼ŒåŒ…æ‹¬ REST API æˆ– webhook å®ç°ä»¥åŠ DevOps è‡ªåŠ¨åŒ–ã€‚ä½¿ç”¨ Fission çš„ä¸€ä¸ªå¾ˆå¥½çš„ç”¨ä¾‹å¯èƒ½æ˜¯å¼€å‘èŠå¤©æœºå™¨äººçš„åç«¯ï¼Œå› ä¸º Fission å¯ä»¥å®ç°è‰¯å¥½çš„å†·å¯åŠ¨æ€§èƒ½ï¼Œå¹¶åœ¨éœ€è¦æ—¶é€šè¿‡ä¿æŒè¿è¡Œæ—¶çš„å®¹å™¨æ± æ¥æä¾›å¿«é€Ÿå“åº”æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼ŒKubeless æ¶æ„åˆ©ç”¨åŸç”Ÿ Kubernetes æ¦‚å¿µæ¥éƒ¨ç½²å’Œç®¡ç†åŠŸèƒ½ï¼Œä¾‹å¦‚è‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼Œç”¨äºå®šä¹‰åŠŸèƒ½å’Œè‡ªå®šä¹‰æ§åˆ¶å™¨æ¥ç®¡ç†å‡½æ•°ï¼Œå°†å…¶éƒ¨ç½²ä¸º Kubernetes éƒ¨ç½²å¹¶é€šè¿‡ Kubernetes æœåŠ¡å…¬å¼€å®ƒã€‚ä¸ Kubernetes åŸç”ŸåŠŸèƒ½çš„ç´§å¯†ç»“åˆå°†å¸å¼•ç°æœ‰çš„ Kubernetes ç”¨æˆ·ï¼Œé™ä½æ‰€éœ€çš„å­¦ä¹ æ›²çº¿å¹¶æ— ç¼æ’å…¥ç°æœ‰çš„ Kubernetes æ¶æ„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…³äºä½œè€…&#34;&gt;å…³äºä½œè€…&lt;/h2&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-hisham&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Hisham&#34; srcset=&#34;
               /blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwtsgn5g0oj206y06y74m_hu4279035181160486482.webp 400w,
               /blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwtsgn5g0oj206y06y74m_hu15762099948745350220.webp 760w,
               /blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwtsgn5g0oj206y06y74m_hu8493447471109812705.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/evaluation-of-serverless-frameworks-for-kbe/61411417ly1fwtsgn5g0oj206y06y74m_hu4279035181160486482.webp&#34;
               width=&#34;250&#34;
               height=&#34;250&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Hisham
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Hisham æ˜¯ä¸€ä½å’¨è¯¢ä¼ä¸šè§£å†³æ–¹æ¡ˆæ¶æ„å¸ˆï¼Œåœ¨åˆ©ç”¨å®¹å™¨æŠ€æœ¯è§£å†³åŸºç¡€æ¶æ„é—®é¢˜å’Œæ›´å¿«åœ°éƒ¨ç½²åº”ç”¨ç¨‹åºä»¥åŠæ›´é«˜çº§åˆ«çš„å®‰å…¨æ€§ï¼Œæ€§èƒ½å’Œå¯é æ€§æ–¹é¢æ‹¥æœ‰ä¸°å¯Œçš„ç»éªŒ æœ€è¿‘ï¼ŒHisham ä¸€ç›´åœ¨ä¸ºå„ç§ä¸­é—´ä»¶åº”ç”¨ç¨‹åºåˆ©ç”¨å®¹å™¨å’Œäº‘åŸç”Ÿæ¶æ„ï¼Œä»¥åœ¨æ•´ä¸ªä¼ä¸šä¸­éƒ¨ç½²å¤æ‚çš„å…³é”®ä»»åŠ¡æœåŠ¡ã€‚åœ¨è¿›å…¥å’¨è¯¢é¢†åŸŸä¹‹å‰ï¼ŒHisham æ›¾åœ¨ Aon Hewittï¼ŒLexmark å’Œ ADP ä»äº‹è½¯ä»¶å®æ–½å’ŒæŠ€æœ¯æ”¯æŒå·¥ä½œã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å¦‚ä½•å°†äº‘åŸç”Ÿå·¥ä½œè´Ÿè½½æ˜ å°„åˆ° Kubernetes ä¸­çš„æ§åˆ¶å™¨</title>
      <link>https://cloudnativecn.com/blog/how-to-map-cloud-native-workloads-to-kubernetes-controllers/</link>
      <pubDate>Wed, 31 Oct 2018 20:01:03 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/how-to-map-cloud-native-workloads-to-kubernetes-controllers/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://thenewstack.io/how-to-map-cloud-native-workloads-to-kubernetes-controllers/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes &lt;a href=&#34;https://thenewstack.io/how-kubernetes-is-transforming-into-a-universal-scheduler/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ä¸ä»…ä»…æ˜¯ä¸€ä¸ªå®¹å™¨ç®¡ç†å·¥å…·&lt;/a&gt;ã€‚å®ƒæ˜¯ä¸€ä¸ªå¹³å°ï¼Œæ—¨åœ¨å¤„ç†åŒ…è£…åœ¨ä»»æ„æ•°é‡çš„å®¹å™¨å’Œç»„åˆä¸­çš„å„ç§å·¥ä½œè´Ÿè½½ã€‚Kubernetes å†…ç½®äº†å¤šä¸ªæ§åˆ¶å™¨ï¼Œå¯æ˜ å°„åˆ°äº‘åŸç”Ÿæ¶æ„çš„å„ä¸ªå±‚ã€‚&lt;/p&gt;
&lt;p&gt;DevOps å·¥ç¨‹å¸ˆå¯ä»¥å°† Kubernetes æ§åˆ¶å™¨è§†ä¸ºæŒ‡ç¤ºå›¢é˜Ÿè¿è¡Œçš„å„ç§å·¥ä½œè´Ÿè½½çš„åŸºç¡€æ¶æ„éœ€æ±‚çš„æ‰‹æ®µã€‚ä»–ä»¬å¯ä»¥é€šè¿‡å£°æ˜æ–¹æ³•å®šä¹‰æ‰€éœ€çš„é…ç½®çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œå®¹å™¨/pod ä½œä¸º ReplicationController çš„ä¸€éƒ¨åˆ†éƒ¨ç½²ä¿è¯å§‹ç»ˆå¯ç”¨ã€‚æ‰“åŒ…ä¸º DaemonSet çš„å®¹å™¨â€‹ä¿è¯åœ¨é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œã€‚å£°æ˜å¼çš„æ–¹æ³•ä½¿ DevOps å›¢é˜Ÿèƒ½å¤Ÿåˆ©ç”¨ä»£ç æ§åˆ¶åŸºç¡€æ¶æ„ã€‚ä¸‹é¢è®¨è®ºçš„ä¸€äº›éƒ¨ç½²æ¨¡å¼éµå¾ªä¸å¯å˜åŸºç¡€ç»“æ„çš„åŸåˆ™ï¼Œå…¶ä¸­æ¯ä¸ªæ–°çš„éƒ¨ç½²éƒ½ä¼šå¯¼è‡´åŸå­éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/how-to-map-cloud-native-workloads-to-kubernetes-controllers/61411417ly1fwrcxotk3xj20r30i2n30_hu16916355499805042005.webp 400w,
               /blog/how-to-map-cloud-native-workloads-to-kubernetes-controllers/61411417ly1fwrcxotk3xj20r30i2n30_hu15666225736583243246.webp 760w,
               /blog/how-to-map-cloud-native-workloads-to-kubernetes-controllers/61411417ly1fwrcxotk3xj20r30i2n30_hu7029547924394026163.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/how-to-map-cloud-native-workloads-to-kubernetes-controllers/61411417ly1fwrcxotk3xj20r30i2n30_hu16916355499805042005.webp&#34;
               width=&#34;760&#34;
               height=&#34;507&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;DevOps å·¥ç¨‹å¸ˆå¯ä»¥é€šè¿‡å£°æ˜æ–¹æ³•å®šä¹‰æ‰€éœ€çš„é…ç½®çŠ¶æ€â€”â€”æ¯ä¸ªå·¥ä½œè´Ÿè½½æ˜ å°„åˆ°æ§åˆ¶å™¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;äº†è§£äº‘åŸç”Ÿç”¨ä¾‹&#34;&gt;äº†è§£äº‘åŸç”Ÿç”¨ä¾‹&lt;/h2&gt;
&lt;p&gt;Kubernetes çš„æ§åˆ¶å¹³é¢ä¸æ–­è·Ÿè¸ªéƒ¨ç½²ï¼Œä»¥ç¡®ä¿å®ƒä»¬ç¬¦åˆ DevOps å®šä¹‰çš„æ‰€éœ€é…ç½®çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes çš„åŸºæœ¬éƒ¨ç½²å•ä½æ˜¯ä¸€ä¸ª podã€‚å®ƒæ˜¯ Kubernetes çš„åŸºæœ¬æ„å»ºå—ï¼Œæ˜¯ Kubernetes å¯¹è±¡æ¨¡å‹ä¸­æœ€å°å’Œæœ€ç®€å•çš„å•å…ƒã€‚pod è¡¨ç¤ºé›†ç¾¤ä¸Šæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ã€‚æ— è®ºæœåŠ¡æ˜¯æœ‰çŠ¶æ€çš„è¿˜æ˜¯æ— çŠ¶æ€çš„ï¼Œå®ƒæ€»æ˜¯æ‰“åŒ…å¹¶éƒ¨ç½²ä¸º podã€‚&lt;/p&gt;
&lt;p&gt;æ§åˆ¶å™¨å¯ä»¥åœ¨é›†ç¾¤ä¸­åˆ›å»ºå’Œç®¡ç†å¤šä¸ª podï¼Œå¤„ç†åœ¨é›†ç¾¤èŒƒå›´å†…æä¾›è‡ªæˆ‘ä¿®å¤åŠŸèƒ½çš„å‰¯æœ¬ã€‚ä¾‹å¦‚ï¼Œå¦‚æœèŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œæ§åˆ¶å™¨å¯èƒ½ä¼šé€šè¿‡åœ¨ä¸åŒèŠ‚ç‚¹ä¸Šå®‰æ’ç›¸åŒçš„ pod ç”¨æ¥è‡ªåŠ¨æ›¿æ¢è¯¥æ•…éšœ podã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes é…æœ‰å¤šä¸ªæ§åˆ¶å™¨ï¼Œå¯ä»¥å¤„ç†æ‰€éœ€çš„ pod çŠ¶æ€ã€‚å¦‚ ReplicationControllerã€Deploymentã€DaemonSet å’Œ StatefulSet æ§åˆ¶å™¨ã€‚Kubernetes æ§åˆ¶å™¨ä½¿ç”¨æä¾›çš„ pod æ¨¡æ¿ï¼Œæ¥åˆ›å»ºå…¶è´Ÿè´£ pod çš„æ‰€éœ€çŠ¶æ€ã€‚ä¸å…¶ä»– Kubernetes å¯¹è±¡ä¸€æ ·ï¼ŒPod åœ¨ YAML æ–‡ä»¶ä¸­å®šä¹‰å¹¶æäº¤ç»™æ§åˆ¶å¹³é¢ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Kubernetes ä¸­è¿è¡Œäº‘åŸç”Ÿåº”ç”¨ç¨‹åºæ—¶ï¼Œè¿ç»´äººå‘˜éœ€è¦äº†è§£æ§åˆ¶å™¨è§£å†³çš„ç”¨ä¾‹ï¼Œä»¥å……åˆ†åˆ©ç”¨å¹³å°çš„ç‰¹æ€§ã€‚è¿™æœ‰åŠ©äºä»–ä»¬å®šä¹‰å’Œç»´æŠ¤åº”ç”¨ç¨‹åºçš„æ‰€éœ€é…ç½®çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šä¸€èŠ‚ä¸­ä»‹ç»çš„æ¯ç§æ¨¡å¼éƒ½æ˜ å°„åˆ°ç‰¹å®šçš„ Kubernetes æ§åˆ¶å™¨ï¼Œè¿™äº›æ§åˆ¶å™¨å…è®¸å¯¹ Kubernetes çš„å·¥ä½œè´Ÿè½½è¿›è¡Œæ›´ç²¾ç¡®ï¼Œç»†ç²’åº¦çš„æ§åˆ¶ï¼Œä½†æ˜¯é‡‡ç”¨è‡ªåŠ¨åŒ–æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes çš„å£°æ˜å¼é…ç½®é¼“åŠ±ä¸å¯å˜çš„åŸºç¡€æ¶æ„ã€‚æ§åˆ¶å¹³é¢è·Ÿè¸ªå’Œç®¡ç†éƒ¨ç½²ï¼Œä»¥ç¡®ä¿åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸä¸­ç»´æŠ¤æ‰€éœ€çš„é…ç½®çŠ¶æ€ã€‚ä¸åŸºäºè™šæ‹Ÿæœºçš„ä¼ ç»Ÿéƒ¨ç½²ç›¸æ¯”ï¼ŒDevOps å·¥ç¨‹å¸ˆå°†èŠ±è´¹æ›´å°‘çš„æ—¶é—´æ¥ç»´æŠ¤å·¥ä½œè´Ÿè½½ã€‚åˆ©ç”¨ Kubernetes åŸè¯­å’Œéƒ¨ç½²æ¨¡å¼çš„æœ‰æ•ˆ CI/CD ç­–ç•¥ä½¿è¿è¥å•†æ— éœ€æ‰§è¡Œç¹ççš„ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¯æ‰©å±•å±‚æ— çŠ¶æ€å·¥ä½œè´Ÿè½½&#34;&gt;å¯æ‰©å±•å±‚ï¼šæ— çŠ¶æ€å·¥ä½œè´Ÿè½½&lt;/h3&gt;
&lt;p&gt;æ— çŠ¶æ€å·¥ä½œè´Ÿè½½åœ¨ Kubernetes ä¸­æ‰“åŒ…å¹¶éƒ¨ç½²ä¸º ReplicaSetã€‚ReplicationController æ„æˆ ReplicaSet çš„åŸºç¡€ï¼Œå¯ç¡®ä¿åœ¨ä»»ä½•ç»™å®šæ—¶é—´å§‹ç»ˆè¿è¡ŒæŒ‡å®šæ•°é‡çš„ pod å‰¯æœ¬ã€‚æ¢å¥è¯è¯´ï¼ŒReplicationController ç¡®ä¿ä¸€ä¸ª pod æˆ–ä¸€ç»„åŒç±» pod æ€»æ˜¯å¯ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæœ‰å¤ªå¤š podï¼ŒReplicationController å¯èƒ½ä¼šç»ˆæ­¢é¢å¤–çš„ podã€‚å¦‚æœå¤ªå°‘ï¼ŒReplicationController å°†ç»§ç»­å¯åŠ¨å…¶ä»– podã€‚ä¸æ‰‹åŠ¨åˆ›å»ºçš„ pod ä¸åŒï¼ŒReplicationController ç»´æŠ¤çš„ pod åœ¨å¤±è´¥ï¼Œåˆ é™¤æˆ–ç»ˆæ­¢æ—¶ä¼šè‡ªåŠ¨æ›¿æ¢ã€‚åœ¨è¯¸å¦‚å†…æ ¸å‡çº§ä¹‹ç±»çš„ç ´åæ€§ç»´æŠ¤ä¹‹åï¼Œåœ¨èŠ‚ç‚¹ä¸Šé‡æ–°åˆ›å»º podã€‚å› æ­¤ï¼Œå³ä½¿åº”ç”¨ç¨‹åºåªéœ€è¦ä¸€ä¸ª podï¼Œä¹Ÿå»ºè®®ä½¿ç”¨ ReplicationControllerã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªç®€å•çš„ç”¨ä¾‹æ˜¯åˆ›å»ºä¸€ä¸ª ReplicationController å¯¹è±¡ï¼Œä»¥æ— é™æœŸåœ°å¯é åœ°è¿è¡Œ pod çš„ä¸€ä¸ªå®ä¾‹ã€‚æ›´å¤æ‚çš„ç”¨ä¾‹æ˜¯è¿è¡Œæ¨ªå‘æ‰©å±•æœåŠ¡çš„å‡ ä¸ªç›¸åŒå‰¯æœ¬ï¼Œä¾‹å¦‚ Web æœåŠ¡å™¨ã€‚åœ¨ Kubernetes ä¸­éƒ¨ç½²æ—¶ï¼ŒDevOps å›¢é˜Ÿå’Œè¿è¥å•†å°†æ— çŠ¶æ€å·¥ä½œè´Ÿè½½æ‰“åŒ…ä¸º ReplicationControllersã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æœ€è¿‘çš„ Kubernetes ç‰ˆæœ¬ä¸­ï¼ŒReplicaSets å–ä»£äº† ReplicationControllersã€‚å®ƒä»¬éƒ½é’ˆå¯¹ç›¸åŒçš„åœºæ™¯ï¼Œä½† ReplicaSet ä½¿ç”¨åŸºäº &lt;a href=&#34;https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#set-based-requirement&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;é›†åˆçš„æ ‡ç­¾é€‰æ‹©å™¨&lt;/a&gt; ï¼Œè¿™ä½¿å¾—å¯ä»¥ä½¿ç”¨åŸºäºæ³¨é‡Šçš„å¤æ‚æŸ¥è¯¢ã€‚æ­¤å¤–ï¼ŒKubernetes ä¸­çš„éƒ¨ç½²ä¾èµ–äº ReplicaSetã€‚&lt;/p&gt;
&lt;p&gt;Deployment æ˜¯ ReplicaSet çš„æŠ½è±¡ã€‚åœ¨ Deployment å¯¹è±¡ä¸­å£°æ˜æ‰€éœ€çŠ¶æ€æ—¶ï¼ŒDeployment æ§åˆ¶å™¨ä¼šä»¥å—æ§é€Ÿç‡å°†å®é™…çŠ¶æ€æ›´æ”¹ä¸ºæ‰€éœ€çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;å¼ºçƒˆå»ºè®®éƒ¨ç½²ç®¡ç†äº‘åŸç”Ÿåº”ç”¨ç¨‹åºçš„æ— çŠ¶æ€æœåŠ¡ã€‚è™½ç„¶æœåŠ¡å¯ä»¥éƒ¨ç½²ä¸º pod å’Œ ReplicaSetï¼Œä½†éƒ¨ç½²å¯ä»¥æ›´è½»æ¾åœ°å‡çº§å’Œä¿®è¡¥åº”ç”¨ç¨‹åºã€‚DevOps å›¢é˜Ÿå¯ä»¥ä½¿ç”¨éƒ¨ç½²æ¥å‡çº§ podï¼Œè€Œæ— æ³•ä½¿ç”¨ ReplicaSet å®Œæˆã€‚è¿™æ ·å°±å¯ä»¥åœ¨æœ€çŸ­çš„åœæœºæ—¶é—´å†…æ¨å‡ºæ–°ç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºã€‚éƒ¨ç½²ä¸ºåº”ç”¨ç¨‹åºç®¡ç†å¸¦æ¥äº†ç±»ä¼¼äºæœåŠ¡ï¼ˆPaaSï¼‰çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æŒä¹…å±‚æœ‰çŠ¶æ€çš„å·¥ä½œé‡&#34;&gt;æŒä¹…å±‚ï¼šæœ‰çŠ¶æ€çš„å·¥ä½œé‡&lt;/h3&gt;
&lt;p&gt;çŠ¶æ€å·¥ä½œè´Ÿè½½å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šéœ€è¦æŒä¹…å­˜å‚¨çš„æœåŠ¡ï¼ˆå•å®ä¾‹ï¼‰å’Œéœ€è¦ä»¥é«˜å¯é æ€§å’Œå¯ç”¨æ¨¡å¼è¿è¡Œçš„æœåŠ¡ï¼ˆå¤åˆ¶çš„å¤šå®ä¾‹ï¼‰ã€‚éœ€è¦è®¿é—®æŒä¹…å­˜å‚¨åç«¯çš„ pod ä¸ä¸ºå…³ç³»æ•°æ®åº“è¿è¡Œé›†ç¾¤çš„ä¸€ç»„ pod éå¸¸ä¸åŒã€‚è™½ç„¶å‰è€…éœ€è¦é•¿æœŸæŒä¹…çš„æŒä¹…æ€§ï¼Œä½†åè€…éœ€è¦é«˜å¯ç”¨æ€§çš„å·¥ä½œé‡ã€‚Kubernetes è§£å†³äº†è¿™ä¸¤ç§æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥é€šè¿‡å°†åº•å±‚å­˜å‚¨æš´éœ²ç»™æœåŠ¡çš„å·æ¥æ”¯æŒå•ä¸ª podã€‚å¯ä»¥å°†å·æ˜ å°„åˆ°è°ƒåº¦ pod çš„ä»»æ„èŠ‚ç‚¹ã€‚å¦‚æœåœ¨é›†ç¾¤çš„ä¸åŒèŠ‚ç‚¹ä¸Šè°ƒåº¦å¤šä¸ª pod å¹¶éœ€è¦å…±äº«åç«¯ï¼Œåˆ™åœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºä¹‹å‰æ‰‹åŠ¨é…ç½®åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ˆNFSï¼‰æˆ– Glusterï¼‰ã€‚äº‘åŸç”Ÿæ€ç³»ç»Ÿä¸­æä¾›çš„ç°ä»£å­˜å‚¨é©±åŠ¨ç¨‹åºæä¾›å®¹å™¨æœ¬æœºå­˜å‚¨ï¼Œå…¶ä¸­æ–‡ä»¶ç³»ç»Ÿæœ¬èº«é€šè¿‡å®¹å™¨å…¬å¼€ã€‚å½“ pod åªéœ€è¦æŒä¹…æ€§å’ŒæŒä¹…æ€§æ—¶ï¼Œè¯·ä½¿ç”¨æ­¤é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºé¢„è®¡å…·æœ‰é«˜å¯ç”¨æ€§çš„åœºæ™¯ï¼ŒKubernetes æä¾› StatefulSets - ä¸€ç»„ä¸“é—¨çš„ podï¼Œå¯ç¡®ä¿ pod çš„æ’åºå’Œå”¯ä¸€æ€§ã€‚è¿™åœ¨è¿è¡Œä¸»è¦/è¾…åŠ©ï¼ˆä»¥å‰ç§°ä¸ºä¸»/ä»ï¼‰æ•°æ®åº“é›†ç¾¤é…ç½®æ—¶å°¤å…¶æœ‰ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸éƒ¨ç½²ç±»ä¼¼ï¼ŒStatefulSet ç®¡ç†åŸºäºç›¸åŒå®¹å™¨è§„èŒƒçš„ podã€‚ä¸ Deployment ä¸åŒï¼ŒStatefulSet ä¸ºå…¶æ¯ä¸ª pod ä¿ç•™å”¯ä¸€æ ‡è¯†ã€‚è¿™äº› pod æ˜¯æ ¹æ®ç›¸åŒçš„è§„èŒƒåˆ›å»ºçš„ï¼Œä½†ä¸å¯äº’æ¢ï¼šæ¯ä¸ª pod éƒ½æœ‰ä¸€ä¸ªæŒä¹…æ ‡è¯†ç¬¦ï¼Œå®ƒå¯ä»¥åœ¨ä»»ä½•é‡æ–°å®‰æ’æ—¶ä¿ç•™ã€‚&lt;/p&gt;
&lt;p&gt;StatefulSet å¯¹éœ€è¦ä»¥ä¸‹ä¸€é¡¹æˆ–å¤šé¡¹çš„å·¥ä½œè´Ÿè½½éå¸¸æœ‰ç”¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¨³å®šï¼Œç‹¬ç‰¹çš„ç½‘ç»œæ ‡è¯†ç¬¦ã€‚&lt;/li&gt;
&lt;li&gt;ç¨³å®šï¼ŒæŒä¹…çš„å­˜å‚¨ã€‚&lt;/li&gt;
&lt;li&gt;æœ‰åºï¼Œä¼˜é›…çš„éƒ¨ç½²å’Œæ‰©å±•ã€‚&lt;/li&gt;
&lt;li&gt;æœ‰åºï¼Œä¼˜é›…çš„åˆ é™¤å’Œç»ˆæ­¢ã€‚&lt;/li&gt;
&lt;li&gt;æœ‰åºçš„è‡ªåŠ¨æ»šåŠ¨æ›´æ–°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Kubernetes å¯¹ StatefulSets çš„å¤„ç†æ–¹å¼ä¸å…¶ä»–æ§åˆ¶å™¨ä¸åŒã€‚å½“æ­£åœ¨ä½¿ç”¨ N ä¸ªå‰¯æœ¬è°ƒåº¦ StatefulSet çš„ pod æ—¶ï¼Œå°†æŒ‰é¡ºåºåˆ›å»ºå®ƒä»¬ï¼Œé¡ºåºä» 0 åˆ° N-1ã€‚å½“åˆ é™¤ StatefulSet çš„ pod æ—¶ï¼Œå®ƒä»¬ä»¥ç›¸åçš„é¡ºåºç»ˆæ­¢ï¼Œä» N-1 åˆ° 0ã€‚åœ¨å°†ä¸€ä¸ªæ‰©å±•æ“ä½œåº”ç”¨äº pod ä¹‹å‰ï¼Œå®ƒçš„æ‰€æœ‰å‰é©±å¿…é¡»æ­£åœ¨è¿è¡Œå¹¶å‡†å¤‡å°±ç»ªã€‚Kubernetes ç¡®ä¿åœ¨ç»ˆæ­¢ pod ä¹‹å‰ï¼Œå…¶æ‰€æœ‰åç»§è€…éƒ½å®Œå…¨å…³é—­ã€‚&lt;/p&gt;
&lt;p&gt;å½“æœåŠ¡éœ€è¦è¿è¡Œ Cassandraã€MongoDBã€MySQLã€PostgreSQL é›†ç¾¤æˆ–ä»»ä½•å…·æœ‰é«˜å¯ç”¨æ€§è¦æ±‚çš„æ•°æ®åº“å·¥ä½œè´Ÿè½½æ—¶ï¼Œå»ºè®®ä½¿ç”¨ StatefulSetã€‚&lt;/p&gt;
&lt;p&gt;å¹¶éæ¯ä¸ªæŒä¹…æ€§å·¥ä½œè´Ÿè½½éƒ½å¿…é¡»æ˜¯ StatefulSetã€‚æŸäº›å®¹å™¨ä¾èµ–äºæŒä¹…å­˜å‚¨åç«¯æ¥å­˜å‚¨æ•°æ®ã€‚ä¸ºäº†å‘è¿™äº›ç±»å‹çš„åº”ç”¨ç¨‹åºæ·»åŠ æŒä¹…æ€§ï¼Œpod å¯èƒ½ä¾èµ–äºç”±åŸºäºä¸»æœºçš„å­˜å‚¨æˆ–å®¹å™¨æœ¬æœºå­˜å‚¨åç«¯æ”¯æŒçš„å·ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¯å¹¶è¡ŒåŒ–å±‚æ‰¹å¤„ç†&#34;&gt;å¯å¹¶è¡ŒåŒ–å±‚ï¼šæ‰¹å¤„ç†&lt;/h3&gt;
&lt;p&gt;Kubernetes å…·æœ‰ç”¨äºæ‰¹å¤„ç†çš„å†…ç½®åŸè¯­ï¼Œè¿™å¯¹äºæ‰§è¡Œè¿è¡Œåˆ°å®Œæˆä½œä¸šæˆ–é¢„å®šä½œä¸šå¾ˆæœ‰ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;è¿è¡Œåˆ°å®Œæˆä½œä¸šé€šå¸¸ç”¨äºè¿è¡Œéœ€è¦æ‰§è¡Œæ“ä½œå’Œé€€å‡ºçš„è¿›ç¨‹ã€‚åœ¨å¤„ç†æ•°æ®ä¹‹å‰è¿è¡Œçš„å¤§æ•°æ®å·¥ä½œè´Ÿè½½å°±æ˜¯è¿™ç§å·¥ä½œçš„ä¸€ä¸ªä¾‹å­ã€‚å¦ä¸€ä¸ªç¤ºä¾‹æ˜¯ä¸€ä¸ªå¤„ç†é˜Ÿåˆ—ä¸­æ¯æ¡æ¶ˆæ¯çš„ä½œä¸šï¼Œç›´åˆ°é˜Ÿåˆ—å˜ç©ºã€‚&lt;/p&gt;
&lt;p&gt;ä½œä¸šæ˜¯ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ª pod å¹¶ç¡®ä¿æŒ‡å®šæ•°é‡çš„ pod æˆåŠŸç»ˆæ­¢ã€‚å½“ pod æˆåŠŸå®Œæˆåï¼ŒJob ä¼šè·Ÿè¸ªæˆåŠŸçš„å®Œæˆæƒ…å†µã€‚è¾¾åˆ°æŒ‡å®šæ•°é‡çš„æˆåŠŸå®Œæˆåï¼Œä½œä¸šæœ¬èº«å°±å®Œæˆäº†ã€‚åˆ é™¤ä½œä¸šå°†æ¸…ç†å®ƒåˆ›å»ºçš„ podã€‚&lt;/p&gt;
&lt;p&gt;Job è¿˜å¯ä»¥ç”¨äºå¹¶è¡Œè¿è¡Œå¤šä¸ª podï¼Œè¿™ä½¿å…¶æˆä¸ºæœºå™¨å­¦ä¹ åŸ¹è®­å·¥ä½œçš„ç†æƒ³é€‰æ‹©ã€‚Job è¿˜æ”¯æŒå¹¶è¡Œå¤„ç†ä¸€ç»„ç‹¬ç«‹ä½†ç›¸å…³çš„å·¥ä½œé¡¹ã€‚&lt;/p&gt;
&lt;p&gt;å½“ Kubernetes åœ¨å…·æœ‰ GPU çš„ç¡¬ä»¶ä¸Šè¿è¡Œæ—¶ï¼Œæœºå™¨å­¦ä¹ åŸ¹è®­å¯ä»¥åˆ©ç”¨ Jobã€‚è¯¸å¦‚ Kubeflow ä¹‹ç±»çš„æ–°å…´é¡¹ç›® - ä¸€ä¸ªè‡´åŠ›äºåœ¨ Kubernetes ä¸Šéƒ¨ç½²æœºå™¨å­¦ä¹ çš„ç®€å•ï¼Œå¯ç§»æ¤å’Œå¯æ‰©å±•çš„é¡¹ç›® - å°†æŠŠåŸå§‹èµ„æ–™ä½œä¸º job åŒ…è£…åˆ°æœºå™¨å­¦ä¹ åŸ¹è®­ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº†è¿è¡Œå¹¶è¡ŒåŒ–ä½œä¸šå¤–ï¼Œå¯èƒ½è¿˜éœ€è¦è¿è¡Œé¢„å®šä½œä¸šã€‚Kubernetes å…¬å¼€äº† CronJobsï¼Œå®ƒå¯ä»¥åœ¨æŒ‡å®šçš„æ—¶é—´ç‚¹è¿è¡Œä¸€æ¬¡ï¼Œä¹Ÿå¯ä»¥åœ¨æŒ‡å®šçš„æ—¶é—´ç‚¹å®šæœŸè¿è¡Œã€‚Kubernetes ä¸­çš„ CronJob å¯¹è±¡ç±»ä¼¼äº Unix ä¸­ crontabï¼ˆcron è¡¨ï¼‰æ–‡ä»¶çš„ä¸€è¡Œã€‚å®ƒä»¥ç»™å®šçš„æ—¶é—´è¡¨å®šæœŸè¿è¡Œï¼Œä»¥ cron æ ¼å¼ç¼–å†™ã€‚&lt;/p&gt;
&lt;p&gt;Cron ä½œä¸šå¯¹äºå®‰æ’å®šæœŸä½œä¸šï¼ˆå¦‚æ•°æ®åº“å¤‡ä»½æˆ–å‘é€ç”µå­é‚®ä»¶ï¼‰ç‰¹åˆ«æœ‰ç”¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;äº‹ä»¶é©±åŠ¨å±‚æ— æœåŠ¡å™¨serverless&#34;&gt;äº‹ä»¶é©±åŠ¨å±‚ï¼šæ— æœåŠ¡å™¨ï¼ˆServerlessï¼‰&lt;/h3&gt;
&lt;p&gt;æ— æœåŠ¡å™¨è®¡ç®—ï¼ˆServerlessï¼‰æ˜¯æŒ‡æ„å»ºå’Œè¿è¡Œä¸éœ€è¦æœåŠ¡å™¨ç®¡ç†çš„åº”ç”¨ç¨‹åºçš„æ¦‚å¿µã€‚å®ƒæè¿°äº†ä¸€ç§æ›´ç»†ç²’åº¦çš„éƒ¨ç½²æ¨¡å‹ï¼Œå…¶ä¸­æ†ç»‘ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªåŠŸèƒ½çš„åº”ç”¨ç¨‹åºä¸Šä¼ åˆ°å¹³å°ï¼Œç„¶åæ‰§è¡Œï¼Œç¼©å®¹å’Œè®¡è´¹ä»¥å“åº”å½“å‰æ‰€éœ€çš„ç¡®åˆ‡éœ€æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;å‡½æ•°å³æœåŠ¡ï¼ˆFaaSï¼‰åœ¨æ— æœåŠ¡å™¨è®¡ç®—çš„ç¯å¢ƒä¸­è¿è¡Œï¼Œä»¥æä¾›äº‹ä»¶é©±åŠ¨çš„è®¡ç®—ã€‚å¼€å‘äººå‘˜ä½¿ç”¨ç”±äº‹ä»¶æˆ– HTTP è¯·æ±‚è§¦å‘çš„åŠŸèƒ½æ¥è¿è¡Œå’Œç®¡ç†åº”ç”¨ç¨‹åºä»£ç ã€‚å¼€å‘äººå‘˜å°†å°å‹ä»£ç å•å…ƒéƒ¨ç½²åˆ° FaaSï¼Œè¿™äº›ä»£ç æ ¹æ®å®é™…éœ€è¦ä½œä¸ºç‹¬ç«‹ç»„ä»¶æ‰§è¡Œï¼Œæ— éœ€ç®¡ç†æœåŠ¡å™¨æˆ–ä»»ä½•å…¶ä»–åº•å±‚åŸºç¡€æ¶æ„å³å¯è¿›è¡Œæ‰©å±•ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶ Kubernetes æ²¡æœ‰é›†æˆçš„äº‹ä»¶é©±åŠ¨åŸè¯­æ¥å“åº”å…¶ä»–æœåŠ¡å¼•å‘çš„è­¦æŠ¥å’Œäº‹ä»¶ï¼Œä½†ä»æœ‰åŠªåŠ›å¼•å…¥äº‹ä»¶é©±åŠ¨çš„åŠŸèƒ½ã€‚è¯¥&lt;a href=&#34;http://bit.ly/2GBO5Dd&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;äº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼š&lt;/a&gt; ï¼ŒKubernetes çš„æ‰˜ç®¡è€…ï¼Œä¸€ç›´ä¸“æ³¨äºè¿™äº›è‡´åŠ›äºæ— æœåŠ¡å™¨çš„å·¥ä½œç»„ã€‚&lt;a href=&#34;https://openwhisk.apache.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Apache OpenWhisk&lt;/a&gt; ã€&lt;a href=&#34;https://github.com/fission/fission&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fission&lt;/a&gt; ã€&lt;a href=&#34;https://github.com/kubeless/kubeless&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubeless&lt;/a&gt; ã€&lt;a href=&#34;https://github.com/openfaas/faas&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OpenFaaS&lt;/a&gt; å’Œ &lt;a href=&#34;https://github.com/fnproject/fn&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Oracle çš„ Fn&lt;/a&gt; ç­‰å¼€æºé¡¹ç›®å¯ä»¥åœ¨ Kubernetes é›†ç¾¤ä¸­ä½œä¸ºäº‹ä»¶é©±åŠ¨çš„æ— æœåŠ¡å™¨å±‚è¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ— æœåŠ¡å™¨ç¯å¢ƒä¸­éƒ¨ç½²çš„ä»£ç ä¸æ‰“åŒ…ä¸º pod çš„ä»£ç æ ¹æœ¬ä¸åŒã€‚å®ƒç”±è‡ªæ²»å‡½æ•°ç»„æˆï¼Œå¯ä»¥è¿æ¥åˆ°å¯èƒ½è§¦å‘ä»£ç çš„ä¸€ä¸ªæˆ–å¤šä¸ªäº‹ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;å½“äº‹ä»¶é©±åŠ¨è®¡ç®—â€”â€”æ— æœåŠ¡å™¨è®¡ç®—æˆä¸º Kubernetes ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†æ—¶ï¼Œå¼€å‘äººå‘˜å°†èƒ½å¤Ÿéƒ¨ç½²å“åº” Kubernetes æ§åˆ¶å¹³é¢ç”Ÿæˆçš„å†…éƒ¨äº‹ä»¶ä»¥åŠåº”ç”¨ç¨‹åºæœåŠ¡å¼•å‘çš„è‡ªå®šä¹‰äº‹ä»¶çš„å‡½æ•°ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é—ç•™å±‚headless-service&#34;&gt;é—ç•™å±‚ï¼šHeadless Service&lt;/h3&gt;
&lt;p&gt;å³ä½¿æ‚¨çš„ç»„ç»‡ç»å¸¸ä½¿ç”¨å¾®æœåŠ¡æ¶æ„æ„å»ºå’Œéƒ¨ç½²åº”ç”¨ç¨‹åºåˆ°äº‘ä¸Šçš„å®¹å™¨ä¸­ï¼Œä¹Ÿå¯èƒ½æœ‰ä¸€äº›åº”ç”¨ç¨‹åºç»§ç»­å­˜åœ¨äº Kubernetes ä¹‹å¤–ã€‚äº‘åŸç”Ÿåº”ç”¨ç¨‹åºå’ŒæœåŠ¡å¿…é¡»ä¸é‚£äº›ä¼ ç»Ÿçš„å•ä¸€åº”ç”¨ç¨‹åºè¿›è¡Œäº¤äº’ã€‚&lt;/p&gt;
&lt;p&gt;é—ç•™å±‚çš„å­˜åœ¨æ˜¯ä¸ºäº†å®ç°äº’æ“ä½œæ€§ï¼Œä»¥æš´éœ²ä¸€ç»„æŒ‡å‘å•ä½“åº”ç”¨ç¨‹åºçš„ Headless Serviceã€‚Headless Service å…è®¸å¼€å‘äººå‘˜é€šè‡ªç”±åœ°ä»¥è‡ªå·±çš„æ–¹å¼è¿›è¡ŒæœåŠ¡å‘ç°æ¥å‡å°‘ä¸ Kubernetes ç³»ç»Ÿçš„è€¦åˆã€‚Kubernetes ä¸­çš„ Headless Services ä¸ ClusterIPã€NodePort å’Œ LoadBalancer ç±»å‹çš„æœåŠ¡ä¸åŒã€‚å®ƒä»¬æ²¡æœ‰åˆ†é…ç»™å®ƒä»¬çš„ Internet åè®®ï¼ˆIPï¼‰åœ°å€ï¼Œä½†å…·æœ‰æŒ‡å‘å¤–éƒ¨ç«¯ç‚¹ï¼ˆå¦‚ API Serverã€Web æœåŠ¡å™¨å’Œæ•°æ®åº“ï¼‰çš„åŸŸåç³»ç»Ÿï¼ˆDNSï¼‰æ¡ç›®ã€‚é—ç•™å±‚æ˜¯ä¸€ä¸ªé€»è¾‘äº’æ“ä½œæ€§å±‚ï¼Œå®ƒå°† DNS è®°å½•ç»´æŠ¤åˆ°ä¼—æ‰€å‘¨çŸ¥çš„å¤–éƒ¨ç«¯ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;å¾®æœåŠ¡åº”ç”¨ç¨‹åºçš„æ¯ä¸€å±‚éƒ½å¯ä»¥æ˜ å°„åˆ° Kubernetes çš„ä¸€ä¸ªæ§åˆ¶å™¨ã€‚æ ¹æ®å¸Œæœ›éƒ¨ç½²çš„æ¨¡å¼ï¼ŒDevOps å›¢é˜Ÿå¯ä»¥è¿›è¡Œç›¸åº”çš„é€‰æ‹©ã€‚åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå°†äº‘åŸç”Ÿåº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° Kubernetes çš„ä¸€äº›æœ€ä½³å®è·µã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…³äºä½œè€…&#34;&gt;å…³äºä½œè€…&lt;/h2&gt;
&lt;p&gt;Janakiram MSV æ˜¯ Janakiramï¼†Associates çš„é¦–å¸­åˆ†æå¸ˆï¼Œä¹Ÿæ˜¯å›½é™…ä¿¡æ¯æŠ€æœ¯å­¦é™¢çš„å…¼èŒæ•™å‘˜ã€‚ä»–è¿˜æ˜¯ Google è®¤è¯äº‘å¼€å‘äººå‘˜ï¼Œäºšé©¬é€Šè®¤è¯è§£å†³æ–¹æ¡ˆæ¶æ„å¸ˆï¼Œäºšé©¬é€Šè®¤è¯å¼€å‘äººå‘˜ï¼Œäºšé©¬é€Šè®¤è¯ SysOps ç®¡ç†å‘˜å’Œ Microsoft è®¤è¯ Azure ä¸“ä¸šäººå‘˜ã€‚Janakiram æ˜¯äº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šçš„å¤§ä½¿ï¼Œä¹Ÿæ˜¯æœ€æ—©çš„è®¤è¯ Kubernetes ç®¡ç†å‘˜å’Œè®¤è¯ Kubernetes åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜ä¹‹ä¸€ã€‚ä»–ä¹‹å‰çš„ç»å†åŒ…æ‹¬ Microsoftã€AWSã€Gigaom Research å’Œ Alcatel-Lucentã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>8 æ¬¾å¼€æºçš„ Kubernetes Ingress Controller/API Gateway æ¨è</title>
      <link>https://cloudnativecn.com/blog/nginx-ingress-vs-kong-vs-traefik-vs-haproxy-vs-voyager-vs-contour-vs-ambassador/</link>
      <pubDate>Thu, 20 Sep 2018 18:00:47 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/nginx-ingress-vs-kong-vs-traefik-vs-haproxy-vs-voyager-vs-contour-vs-ambassador/</guid>
      <description>&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://kubedex.com/nginx-ingress-vs-kong-vs-traefik-vs-haproxy-vs-voyager-vs-contour-vs-ambassador/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ®æˆ‘æ‰€çŸ¥ï¼Œè¿™æ˜¯ kubernetes å¯ç”¨ç½‘å…³çš„æœ€å®Œæ•´çš„åˆ—è¡¨ã€‚ä»æŠ€æœ¯ä¸Šæ¥è®²ï¼ŒAmbassador ä¸æ˜¯ ingressï¼Œä½†æ˜¯å®ƒè¡¨ç°åœ°å·²ç»éå¸¸å¥½äº†ã€‚ä½ å¯èƒ½å·²ç»çœ‹åˆ°äº†æˆ‘åˆ¶ä½œçš„å¤§è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æœ‰ä¸ªè¿æ¥å¯ä»¥æ‰“å¼€å¹¶æ¸…æ™°çš„çœ‹åˆ°ä¸€ä¸ª excel è¡¨æ ¼ï¼ŒåŒ…å«äº†å›¾è¡¨çš„è¯¦ç»†å†…å®¹ï¼Œå¦‚æœå‘ç°ä¸æ­£ç¡®çš„åœ°æ–¹ï¼Œè¯·åœ¨æ–‡ç« æœ«å°¾ç•™è¨€ï¼Œæˆ‘å°†åŠæ—¶ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/nginx-ingress-vs-kong-vs-traefik-vs-haproxy-vs-voyager-vs-contour-vs-ambassador/006tNbRwgy1fvg5y29nebj31430l2wio_hu13924013188062403971.webp 400w,
               /blog/nginx-ingress-vs-kong-vs-traefik-vs-haproxy-vs-voyager-vs-contour-vs-ambassador/006tNbRwgy1fvg5y29nebj31430l2wio_hu4124294618538672300.webp 760w,
               /blog/nginx-ingress-vs-kong-vs-traefik-vs-haproxy-vs-voyager-vs-contour-vs-ambassador/006tNbRwgy1fvg5y29nebj31430l2wio_hu16282608131955280748.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/nginx-ingress-vs-kong-vs-traefik-vs-haproxy-vs-voyager-vs-contour-vs-ambassador/006tNbRwgy1fvg5y29nebj31430l2wio_hu13924013188062403971.webp&#34;
               width=&#34;760&#34;
               height=&#34;399&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.google.com/spreadsheets/d/16bxRgpO1H_Bn-5xVZ1WrR_I-0A-GOI6egmhvqqLMOmg/edit?usp=sharing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æŸ¥çœ‹å…¨è¡¨è¯·ç‚¹å‡»è¿™é‡Œ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åŸºäºè¿™äº›ç‰¹ç‚¹å’Œæˆ‘è‡ªå·±çš„ç»éªŒã€ä»åˆ«äººçš„æè¿°å’Œå…¶ä»–ç›¸å…³æ–‡ç« ä¸­å¾—çŸ¥ï¼Œæˆ‘å°è¯•ç€ç»™æ¯ä¸€ä¸ªç½‘å…³æä¾›äº†ä¸€äº›é€‰æ‹©çš„å‚è€ƒæ¡ä»¶ã€‚ä¸‹é¢æè¿°å…ˆåé¡ºåºæ²¡æœ‰ç‰¹åˆ«å«ä¹‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;1-ingress-nginx&#34;&gt;1. ingress-nginx&lt;/h2&gt;
&lt;p&gt;è¿™å¯èƒ½æ˜¯æœ€å¸¸ç”¨çš„ ingressã€‚å®‰å…¨ã€ç®€å•å¯é ã€‚æ”¯æŒ httpã€https å’Œ ssl terminationã€‚ä½ å¯èƒ½è¿˜æƒ³é€šè¿‡å®ƒæ”¯ TCPã€UDPï¼Œä½†æ˜¯ä» GitHub ä¸Šæçš„ issue æ¥çœ‹ï¼Œç›®å‰ä½ æœ€å¥½åˆ«è¿™æ ·åšã€‚æ‚¨å¯ä»¥è·å¾—ä¸€äº›è‰¯å¥½è´Ÿè½½å‡è¡¡é€‰é¡¹ä»¥åŠå¼ºå¤§çš„è·¯ç”±ï¼Œwebsocket æ”¯æŒï¼ŒåŸºç¡€èº«ä»½è®¤è¯å’Œè¿½è¸ªã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æ²¡æœ‰åŠ¨æ€æœåŠ¡å‘ç°æœ‰ç‚¹é—æ†¾ã€‚æœ‰ä¸ªé…ç½®ç”Ÿæˆå™¨å¯ä»¥è‡ªåŠ¨ç”Ÿæˆä½†è¿˜æ˜¯ä¸å¤ªå®Œç¾ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šæˆ‘ä»¬åœ¨è¿™é‡Œè°ˆè®ºçš„å†…å®¹æœ‰å®˜æ–¹çš„ Kubernetes ingressã€‚è¿˜æœ‰æ¥è‡ª Nginx å…¬å¸çš„ Ingress æœ‰äº›è®¾ç½®ä¸ä¸€æ ·ã€‚&lt;/p&gt;
&lt;h2 id=&#34;2-kong&#34;&gt;2. Kong&lt;/h2&gt;
&lt;p&gt;ç»å¤§å¤šæ•°çš„äººè®¤ä¸º Kong åªæ˜¯ API ç½‘å…³ã€‚å®ƒæœ‰æ‰©å±•æ’ä»¶ç³»ç»Ÿä½¿å®ƒçš„åŠŸèƒ½è¿œè¿œè¶…å‡ºäº†æ­£å¸¸ ingress è¯¥æœ‰çš„åŠŸèƒ½ã€‚æˆ‘ä¸ä¼šä½¿ç”¨å®ƒå»åšé€šç”¨çš„è´Ÿè½½å‡è¡¡ä½†æ˜¯å¦‚æœä½ æƒ³ç”¨å®ƒåš API ç®¡ç†ä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚&lt;/p&gt;
&lt;h2 id=&#34;3-traefik&#34;&gt;3. Traefik&lt;/h2&gt;
&lt;p&gt;Traefik çš„åŠŸèƒ½å¤šçš„è®©æˆ‘æƒŠè®¶ã€‚å®ƒçš„å¼¹æ€§ä¼¸ç¼©åŠŸèƒ½å¾ˆæ£’ï¼Œè€Œä¸”æˆ‘ä»¬ä»å¾ˆå¤šåšå®¢ä¸Šå¯ä»¥äº†è§£åˆ°å®ƒè¿è¡Œç¨³å®šã€‚å¦‚æœæ‚¨å½“å‰æ­£åœ¨ä½¿ç”¨ ingress-nginxï¼Œé‚£ä¹ˆä¸ºäº†è®©å®ƒæ”¯æŒåŠ¨æ€é…ç½®å°†æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„å‡çº§ã€‚äº‹å®ä¸Šï¼Œæ²¡æœ‰ç†ç”±è®©æˆ‘ä¸å»ç”¨ traefikã€‚è€Œä¸”å®ƒåº”è¯¥ä¼šæ¯”ç°åœ¨æ›´åŠ å‡ºåã€‚&lt;/p&gt;
&lt;p&gt;å”¯ä¸€çš„ç¼ºç‚¹æ˜¯å®ƒåªæ”¯æŒ httpã€https å’Œ grpcã€‚å¦‚æœä½ ééœ€è¦ TCP è´Ÿè½½å‡è¡¡ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦é€‰æ‹©å…¶ä»–æ–¹æ¡ˆäº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;4-haproxy&#34;&gt;4. HAProxy&lt;/h2&gt;
&lt;p&gt;å®ƒæ˜¯è´Ÿè½½å‡è¡¡ç®—æ³•ä¹‹ç‹ã€‚å®ƒä¼¼ä¹ä¹Ÿéå¸¸é€‚åˆè´Ÿè½½å‡è¡¡ TCP è¿æ¥ã€‚è¿™æ˜¯å®˜æ–¹çš„ HAProxy ingressï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨çš„ç»éªŒå‘Šè¯‰æˆ‘ä»¬å®ƒå…·æœ‰æå…¶ç¨³å®šçš„è®°å½•ã€‚å¦‚æœéœ€è¦ï¼Œæ‚¨è¿˜å¯ä»¥è·å¾—ä»˜è´¹æ”¯æŒè®¢é˜…ã€‚&lt;/p&gt;
&lt;h2 id=&#34;5-voyager&#34;&gt;5. Voyager&lt;/h2&gt;
&lt;p&gt;Voyager æ˜¯ä¸€ä¸ªåŸºäº HAProxy çš„ Ingressã€‚å®Œç¾å°è£…äº† HAProxy å¹¶æä¾›äº†å¾ˆå¥½çš„æ–‡æ¡£è¯´æ˜ã€‚æˆ‘æ²¡æœ‰çœ‹åˆ°è´Ÿè½½å‡è¡¡ç®—æ³•çš„é…ç½®ä½ç½®ï¼Œæ‰€ä»¥å‡è®¾å®ƒåªæ˜¯é»˜è®¤ä¸ºè½®è¯¢ã€‚å¦‚æœé‚£æ˜¯é”™çš„ï¼Œè¯·åœ¨è¯„è®ºä¸­å‘Šè¯‰æˆ‘ï¼Œæˆ‘ä¼šæ›´æ–°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;6-contour&#34;&gt;6. Contour&lt;/h2&gt;
&lt;p&gt;åŸºäº Envoyï¼Œå®ƒæœ‰ä¸€äº›æ›´ç°ä»£çš„åŠŸèƒ½ï¼Œå¦‚æ”¯æŒé‡‘ä¸é›€éƒ¨ç½²ã€‚å®ƒè¿˜å…·æœ‰ä¸€å¥—è‰¯å¥½çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œå¹¶æ”¯æŒå¤šç§åè®®ã€‚ä¸åˆ—å‡ºçš„å…¶ä»– Ingress ä¸åŒï¼Œæˆ‘ä» Github é‚£é‡Œäº†è§£åˆ°å®ƒä»å¤„äºå¿«é€Ÿå‘å±•é˜¶æ®µï¼Œæœ‰æœ›æ·»åŠ æ›´å¤šåŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;7-ambassador&#34;&gt;7. Ambassador&lt;/h2&gt;
&lt;p&gt;å¦‚ä¸Šæ‰€è¿°ï¼Œå¦‚æœä½ éµå¾ªä¸¥æ ¼çš„ kubernetes å®šä¹‰ï¼Œé‚£ä¹ˆè¿™ä¸ªæŠ€æœ¯ä¸Šå®ƒå¹¶ä¸ç®—æ˜¯ä¸€ä¸ª Ingressã€‚ä½¿ç”¨ Ambassador æ‚¨åªéœ€ç®€å•æ³¨é‡Šæ‚¨çš„æœåŠ¡ï¼Œå®ƒå°±åƒä¸€ä¸ª ingress è·¯ç”±æµé‡ã€‚Ambassador æœ‰ä¸€äº›éå¸¸é…·çš„åŠŸèƒ½ï¼Œå…¶ä»–ä»»ä½•ä¸€ä¸ª Ingress éƒ½æ²¡æœ‰åƒå½±å­æµé‡é‚£æ ·å…è®¸æ‚¨é€šè¿‡é•œåƒè¯·æ±‚æ•°æ®åœ¨å®æ—¶ç”Ÿäº§ç¯å¢ƒä¸­æµ‹è¯•æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;Ambassador ä¸ Opentracing å’Œ Istio å¾ˆå¥½åœ°é›†æˆã€‚&lt;/p&gt;
&lt;h2 id=&#34;8-istio-ingress&#34;&gt;8. Istio Ingress&lt;/h2&gt;
&lt;p&gt;å¦‚æœæ‚¨å·²ç»åœ¨è¿è¡Œ Istioï¼Œé‚£ä¹ˆè¿™å¯èƒ½æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é»˜è®¤é€‰æ‹©ã€‚å®ƒå…·æœ‰ Ambassador æ‹¥æœ‰çš„ä¸€äº›æ›´ç°ä»£çš„åŠŸèƒ½ã€‚å®ƒä¹Ÿæœ‰æ•…éšœæ³¨å…¥ï¼Œçœ‹èµ·æ¥å¯èƒ½å¾ˆæœ‰è¶£ã€‚ç„¶è€Œï¼ŒIstio ç›®å‰åœ¨è¿™ä¸ªé¢†åŸŸåšäº†å¾ˆå¤šå·¥ä½œï¼Œå¹¶ä¸”å·²ç»ä» Ingress è½¬å‘ Gatewayã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾æ¯ 5 ç§’é’Ÿæ²¡æœ‰å‘ç”Ÿå˜åŒ–çš„ Ingressï¼Œæ‚¨å¯èƒ½ä»ç„¶éœ€è¦è€ƒè™‘ Ambassadorã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;è¿™é‡Œæ²¡æœ‰æ˜æ˜¾çš„èµ¢å®¶ï¼Œå› ä¸ºä½ éœ€è¦æ ¹æ®ä½ çš„éœ€æ±‚é€‰æ‹©åˆé€‚çš„ Ingressã€‚ç›®å‰æ²¡æœ‰æŸä¸€ä¸ª Ingress å¯ä»¥åšåˆ°è¿™ä¸€åˆ‡ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å»ºè®®æ‚¨ä½¿ç”¨ Ambassadorã€‚å¦‚æœæ‚¨åªæ˜¯è¿è¡Œæ ‡å‡†çš„åŸºäº http çš„å¾®æœåŠ¡å¹¶ä¸”å–œæ¬¢äº†è§£æŠ€æœ¯å‰æ²¿ï¼Œé‚£ä¹ˆä½ åº”è¯¥æ¯«ä¸çŠ¹è±«çš„é€‰æ‹© Istioï¼ŒAmbassador å’Œ Jaegerã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>åœ¨ Play with Kubernetes å¹³å°ä¸Šä»¥æµ‹è¯•é©±åŠ¨çš„æ–¹å¼éƒ¨ç½² Istio</title>
      <link>https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/</link>
      <pubDate>Fri, 07 Sep 2018 12:33:30 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/</guid>
      <description>&lt;p&gt;















&lt;figure  id=&#34;figure-kubernetes-and-istio&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;Kubernetes and Istio&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fux7dq9d14j20jg08cju2_hu4370536343136242127.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fux7dq9d14j20jg08cju2_hu17023388844579128443.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fux7dq9d14j20jg08cju2_hu17530994294968509195.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fux7dq9d14j20jg08cju2_hu4370536343136242127.webp&#34;
               width=&#34;700&#34;
               height=&#34;300&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      Kubernetes and Istio
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä¸ºç¿»è¯‘æ–‡ç« ï¼Œ&lt;a href=&#34;https://www.knowledgehut.com/blog/cloud-computing/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ç‚¹å‡»æŸ¥çœ‹åŸæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä½œä¸ºä¸€åå…¨æ ˆå¼€å‘ï¼Œå‡å¦‚æœ€è¿‘èŠ±äº†ä¸å°‘æ—¶é—´å¼€å‘åº”ç”¨ï¼Œè‚¯å®šå·²ç»ç†è§£äº†å¾®æœåŠ¡æ¶æ„ä¸‹è¦é¢ä¸´çš„ä¸€ç³»åˆ—å…¨æ–°æŒ‘æˆ˜ã€‚å°½ç®¡åº”ç”¨å·²ç»ä»åºå¤§çš„å•ä½“åº”ç”¨è½¬å˜æˆäº†å¼€å‘æ›´å¿«ã€å¼¹æ€§æ›´å¥½ã€æ›´å°ä¹Ÿæ›´èšç„¦çš„å¾®æœåŠ¡ï¼Œä½†ç°å®æ˜¯ï¼Œå¼€å‘è€…éœ€è¦å¼€å§‹æ“å¿ƒå°†è¿™äº›æœåŠ¡é›†æˆåˆ°åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„é—®é¢˜äº†ï¼ŒåŒ…æ‹¬æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€æ³¨å†Œã€å®¹é”™ã€ç›‘æ§ã€è·¯ç”±ã€å…¼å®¹å’Œå®‰å…¨ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬æ›´è¯¦ç»†çš„æ‹†è§£å¾®æœåŠ¡æ¶æ„ä¸‹å¼€å‘å’Œè¿ç»´é¢ä¸´çš„æŒ‘æˆ˜å§ã€‚å…ˆæ¥çœ‹çœ‹ç¬¬ä¸€ä»£ç®€å•çš„ Service Mesh åœºæ™¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒæœåŠ¡ A è¦å’Œ æœåŠ¡ B é€šä¿¡ï¼Œæ²¡æœ‰é‡‡ç”¨ç›´æ¥é€šä¿¡çš„æ–¹å¼ï¼Œè¯·æ±‚æ˜¯é€šè¿‡ NGINX è·¯ç”±çš„ã€‚NGINX ä» Consulï¼ˆæœåŠ¡å‘ç°å·¥å…·ï¼‰æŸ¥æ‰¾è·¯ç”±ï¼Œå¹¶åœ¨æ”¶åˆ° HTTP 502 å“åº”æ—¶ï¼Œè‡ªåŠ¨é‡è¯•ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-10---ä¸€ä»£-service-mesh&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 1.0 - ä¸€ä»£ Service Mesh&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fux7wkxxawj20jg08cmz4_hu970529824763205915.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fux7wkxxawj20jg08cmz4_hu13891487023500798128.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fux7wkxxawj20jg08cmz4_hu17993223106374152581.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fux7wkxxawj20jg08cmz4_hu970529824763205915.webp&#34;
               width=&#34;700&#34;
               height=&#34;300&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 1.0 - ä¸€ä»£ Service Mesh
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-11---æœåŠ¡å¢å¤šæ—¶çº§è”å¤±è´¥æ¼”ç¤º&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 1.1 - æœåŠ¡å¢å¤šæ—¶ï¼Œçº§è”å¤±è´¥æ¼”ç¤º&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fux7ybax2rj20jg09pgpc_hu16270552091780960618.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fux7ybax2rj20jg09pgpc_hu16704225733448321331.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fux7ybax2rj20jg09pgpc_hu13189867550130571645.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fux7ybax2rj20jg09pgpc_hu16270552091780960618.webp&#34;
               width=&#34;700&#34;
               height=&#34;349&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 1.1 - æœåŠ¡å¢å¤šæ—¶ï¼Œçº§è”å¤±è´¥æ¼”ç¤º
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ä½†éšç€å¾®æœåŠ¡æ¶æ„çš„åˆ°æ¥ï¼ŒæœåŠ¡æ•°é‡çš„å¢é•¿ä¸€å‘ä¸å¯æ”¶æ‹¾ï¼Œä¸‹é¢åˆ—å‡ºçš„æ˜¯å¼€å‘å’Œè¿ç»´å›¢é˜Ÿé‡åˆ°çš„é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚ä½•è®©æ—¥ç›Šå¢é•¿çš„å¾®æœåŠ¡ä»¬äº’è”ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¦‚ä½•ä¸ºå¾®æœåŠ¡æä¾›è´Ÿè½½å‡è¡¡ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ä¸ºå¾®æœåŠ¡æä¾›åŸºäºè§’è‰²çš„è·¯ç”±ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚ä½•æ§åˆ¶å¾®æœåŠ¡çš„å‡ºå£æµé‡ï¼Œå¦‚ä½•å®ç°ç°åº¦å‘å¸ƒï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¦‚ä½•æ§åˆ¶ä¸æ–­å¢é•¿çš„å¾®æœåŠ¡çš„å¤æ‚åº¦ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¦‚ä½•ç”¨å¯Œè·¯ç”±è§„åˆ™å®ç°ç»†ç²’åº¦çš„æµé‡æ§åˆ¶ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å®ç°æµé‡åŠ å¯†ã€æœåŠ¡åˆ°æœåŠ¡çš„é‰´æƒå’Œå¼ºèº«ä»½å£°æ˜çš„æŒ‘æˆ˜&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç®€è€Œè¨€ä¹‹ï¼Œè™½ç„¶ä½ å¯ä»¥åœ¨åº”ç”¨å’Œç½‘ç»œä¸­é—´ä»¶ä¸­å¼€å¯æœåŠ¡å‘ç°å’Œé‡è¯•æœºåˆ¶ï¼Œä½†å®é™…ä¸Šï¼Œæƒ³è®©æœåŠ¡å‘ç°æ­£å¸¸å·¥ä½œæ˜¯éå¸¸å›°éš¾çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åˆè¯• Istio Service Mesh&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Service Mesh æ˜¯ 2018 å¹´åº¦æœ€ç«çƒ­çš„æµè¡Œè¯ä¹‹ä¸€ï¼Œå®ƒæ˜¯å¾®æœåŠ¡çš„å¯é…ç½®åŸºç¡€æ¶æ„å±‚ï¼Œè´Ÿè´£å¾®æœåŠ¡åº”ç”¨é—´çš„äº¤äº’ï¼Œservice mesh è®©å¾®æœåŠ¡å®ä¾‹é—´çš„äº¤äº’æ›´çµæ´»ã€å¯é å’Œå¿«é€Ÿã€‚Mesh å±‚æä¾›äº†æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€åŠ å¯†ã€é‰´æƒå’ŒéªŒè¯ï¼Œæ”¯æŒç†”æ–­æœºåˆ¶ç­‰å…¶ä»–èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;Istio æ˜¯å®Œå…¨å¼€æºçš„ï¼Œå¯é€æ˜çš„éƒ¨ç½²åœ¨å·²æœ‰çš„åˆ†å¸ƒå¼åº”ç”¨ä¸Šã€‚Istio 1.0 ç‰ˆæœ¬åœ¨ä¸Šä¸ªæœˆå‘å¸ƒï¼Œå·²ç»ç”Ÿäº§ç¯å¢ƒå¯ç”¨ã€‚Istio å®Œå…¨ç”± Go è¯­è¨€ç¼–å†™ï¼Œæä¾›æˆç†Ÿçš„ API æ¥å£å¯ä»¥æ¥å…¥åˆ°ä»»ä½•æ—¥å¿—å¹³å°ã€é¥æµ‹å’Œç­–ç•¥ç³»ç»Ÿä¸­ã€‚Istio åœ¨ GitHub ä¸Šå‘å¸ƒï¼Œå¯¹ç³»ç»Ÿçš„æ€§èƒ½å½±å“å¾ˆå°ï¼Œä¸°å¯Œçš„ç‰¹æ€§è®©ä½ å¯ä»¥é¡ºåˆ©ã€é«˜æ•ˆçš„è¿è¡Œåˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„ï¼Œå¹¶æä¾›ç»Ÿä¸€çš„ä¿æŠ¤ã€è¿æ¥å’Œç›‘æ§æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  id=&#34;figure-å›¾-12-istio-åŠŸèƒ½&#34;&gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;å›¾ 1.2 Istio åŠŸèƒ½&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxw8v04rgj20jg09pmyw_hu482398556653429641.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxw8v04rgj20jg09pmyw_hu11978462826310576969.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxw8v04rgj20jg09pmyw_hu3034003465558839638.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxw8v04rgj20jg09pmyw_hu482398556653429641.webp&#34;
               width=&#34;700&#34;
               height=&#34;349&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;figcaption&gt;
      å›¾ 1.2 Istio åŠŸèƒ½
    &lt;/figcaption&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;Istio å¯¹ç³»ç»Ÿçš„å½±å“å¾ˆå°ï¼Œå®ƒåœ¨ GitHub ä¸Šå‘å¸ƒï¼Œä¸Šä¸ªæœˆï¼ŒIstio 1.0 ç‰ˆæœ¬å·²ç»å‘å¸ƒï¼Œå¹¶ä¸”ç”Ÿäº§ç¯å¢ƒå¯ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;Istio èƒ½å¸¦æ¥ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Istio æä¾›æœåŠ¡çš„è¿æ¥ã€ä¿æŠ¤ã€æ§åˆ¶å’Œè§‚æµ‹èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;å‡å°‘æœåŠ¡éƒ¨ç½²çš„å¤æ‚åº¦ï¼Œå‡è½»éƒ¨ç½²å›¢é˜Ÿçš„å‹åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨æ— éœ€ä¿®æ”¹åº”ç”¨ä»£ç çš„å‰æä¸‹ï¼Œä¸ºå¼€å‘å’Œå¼€å‘è¿ç»´æä¾›äº†ç»†ç²’åº¦çš„æµé‡å¯è§†åŒ–å’Œæ§åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;ä¸º CIO æä¾›äº†å¸®åŠ©å…¨ä¼ä¸šå®‰å…¨å®æ–½å’Œåˆè§„å‹éœ€æ±‚çš„å¿…è¦å·¥å…·ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ service mesh å±‚æä¾›äº†ç»Ÿä¸€çš„è¡Œä¸ºç›‘æµ‹å’Œè¿è¥æ§åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;Istio è®©ä¸ºæœåŠ¡ç½‘ç»œæä¾› HTTPã€gRPCã€Web Socket å’Œ TCP æµé‡çš„è‡ªåŠ¨è´Ÿè½½å‡è¡¡å˜çš„è½»æ¾ã€‚&lt;/li&gt;
&lt;li&gt;æä¾›äº†ç»†ç²’åº¦çš„æµé‡è¡Œä¸ºæ§åˆ¶ï¼ŒåŒ…æ‹¬ï¼šå¯Œè·¯ç”±è§„åˆ™ã€é‡è¯•ã€æ•…éšœè½¬ç§»å’Œå¤±è´¥æ³¨å…¥ã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒæ’ä»¶åŒ–çš„ç­–ç•¥æ§åˆ¶å±‚å’Œé…ç½® APIï¼Œæ”¯æŒè®¿é—®æ§åˆ¶ã€æµé‡é™åˆ¶å’Œé…é¢ã€‚&lt;/li&gt;
&lt;li&gt;Istio ä¸ºé›†ç¾¤å†…çš„å…¨éƒ¨æµé‡æä¾›è‡ªåŠ¨çš„åº¦é‡ã€æ—¥å¿—ã€è¿½è¸ªï¼ŒåŒ…æ‹¬è¿›ç¾¤çš„å…¥å£å’Œå‡ºå£ã€‚&lt;/li&gt;
&lt;li&gt;ä»¥å¼ºèº«ä»½éªŒè¯å’Œé‰´æƒçš„æ–¹å¼ï¼Œæä¾›äº†é›†ç¾¤å†…å®‰å…¨çš„æœåŠ¡é—´é€šä¿¡ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚ä½•æƒ³æ·±å…¥ Istio æ¶æ„ï¼Œæˆ‘å¼ºçƒˆæ¨è Istio å®˜æ–¹ç½‘ç«™ï¼ˆhttps://istio.io/zhï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwajuotmj20jg0dy0uz_hu9360513552200614954.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwajuotmj20jg0dy0uz_hu4322783743145382295.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwajuotmj20jg0dy0uz_hu1678661707241051786.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwajuotmj20jg0dy0uz_hu9360513552200614954.webp&#34;
               width=&#34;700&#34;
               height=&#34;502&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¼€å§‹æ¼”ç¤ºï¼ï¼ï¼&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å±•ç¤ºå¦‚ä½•åœ¨ Play with Kubernetesï¼ˆPWKï¼‰ä¸­å…è´¹éƒ¨ç½² Istioï¼Œè¿™æ˜¯ä¸ªç”± Docker æä¾›çš„å®éªŒç½‘ç«™ï¼Œæ˜¯è®©ç”¨æˆ·åœ¨å‡ ç§’é’Ÿå†…è·‘èµ·æ¥ Kubernetes é›†ç¾¤çš„è¯•éªŒç¯å¢ƒã€‚PWK æä¾›äº†åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨å…è´¹ CentOS Linux è™šæ‹Ÿæœºçš„ä½“éªŒï¼Œå®é™…ä¸Šæ˜¯ Docker-in-Dockerï¼ˆDinDï¼‰æŠ€æœ¯æ¨¡æ‹Ÿäº†å¤šè™šæ‹Ÿæœº/PC çš„æ•ˆæœã€‚&lt;/p&gt;
&lt;p&gt;æ‰“å¼€ &lt;a href=&#34;https://labs.play-with-k8s.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://labs.play-with-k8s.com/&lt;/a&gt;ï¼Œè®¿é—® Kubernetes Playgroundã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwcxpg13j20jg0dy76k_hu11631318866826482778.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwcxpg13j20jg0dy76k_hu8778221038118133352.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwcxpg13j20jg0dy76k_hu3245596223150224507.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwcxpg13j20jg0dy76k_hu11631318866826482778.webp&#34;
               width=&#34;700&#34;
               height=&#34;502&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç‚¹å‡» &amp;ldquo;Login&amp;rdquo; æŒ‰é’®ï¼Œä»¥ Docker Hub æˆ– GitHub ID ç™»é™†ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwdv6kv0j20nq0byaa1_hu1951106727796875398.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwdv6kv0j20nq0byaa1_hu5956549100114712056.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwdv6kv0j20nq0byaa1_hu8068612477565434497.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwdv6kv0j20nq0byaa1_hu1951106727796875398.webp&#34;
               width=&#34;760&#34;
               height=&#34;383&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å®Œæˆæœ¬æ•™ç¨‹ï¼Œä½ å°†è·å¾—è‡ªå·±çš„å®éªŒç¯å¢ƒã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ·»åŠ ç¬¬ä¸€ä¸ª Kubernetes èŠ‚ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç‚¹å‡»å·¦ä¾§çš„ &amp;ldquo;Add New Instance&amp;rdquo; æ¥æ„å»ºä½ çš„ç¬¬ä¸€ä¸ª Kubernetes é›†ç¾¤èŠ‚ç‚¹ï¼Œè‡ªåŠ¨å‘½åä¸º &amp;ldquo;node1&amp;rdquo;ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½é¢„è£…æ¥ Docker ç¤¾åŒºç‰ˆï¼ˆCEï¼‰å’Œ Kubeadmã€‚è¿™ä¸ªèŠ‚ç‚¹å°†æˆä¸ºé›†ç¾¤çš„ä¸»èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwf2adjdj211o0nq75d_hu12592616578920069772.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwf2adjdj211o0nq75d_hu17381530534555946074.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwf2adjdj211o0nq75d_hu10268165735207804000.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwf2adjdj211o0nq75d_hu12592616578920069772.webp&#34;
               width=&#34;760&#34;
               height=&#34;479&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¯åŠ¨ä¸»èŠ‚ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç”¨å¦‚ä¸‹è„šæœ¬åˆå§‹åŒ–ä¸»èŠ‚ç‚¹ï¼ˆnode1ï¼‰æ¥å¯åŠ¨ Kubernetes é›†ç¾¤ï¼Œå¤åˆ¶è¯¥è„šæœ¬å†…å®¹åˆ°æ–‡ä»¶ bootstrap.shï¼Œå¹¶æ‰§è¡Œå‘½ä»¤æ·»åŠ å¯æ‰§è¡Œæƒé™ï¼š&lt;code&gt;chmod +x bootstrap.sh&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwgb83gkj20jg04p75i_hu29632800487365081.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwgb83gkj20jg04p75i_hu933456331076280403.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwgb83gkj20jg04p75i_hu15150990985997781934.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwgb83gkj20jg04p75i_hu29632800487365081.webp&#34;
               width=&#34;700&#34;
               height=&#34;169&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œè„šæœ¬æ—¶ï¼Œä½œä¸ºåˆå§‹åŒ–çš„ä¸€éƒ¨åˆ†ï¼Œkubeadm ä¼šå†™å…¥å‡ ä¸ªå¿…è¦çš„é…ç½®æ–‡ä»¶ã€è®¾ç½® RBAC å¹¶éƒ¨ç½² Kubernetes æ§åˆ¶å¹³é¢ç»„ä»¶ï¼ˆä¾‹å¦‚ kube-apiserverã€kube-dnsã€kube-proxyã€etcd ç­‰ï¼‰ã€‚æ§åˆ¶å¹³é¢ç»„ä»¶ä»¥ docker å®¹å™¨å½¢å¼éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1mbluj20y004ujrf_hu2452061752059178143.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1mbluj20y004ujrf_hu3034254383515088162.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1mbluj20y004ujrf_hu2187194219659311548.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1mbluj20y004ujrf_hu2452061752059178143.webp&#34;
               width=&#34;760&#34;
               height=&#34;108&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¤åˆ¶ä¸Šé¢çš„ kubeadm join token å‘½ä»¤ï¼Œç•™ä½œä¸‹æ­¥ä½¿ç”¨ï¼Œæ­¤å‘½ä»¤ç”¨æ¥åœ¨é›†ç¾¤ä¸­åŠ å…¥å…¶ä»–èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ·»åŠ ä»èŠ‚ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç‚¹å‡» &amp;ldquo;Add New Node&amp;rdquo; æ·»åŠ æ–°çš„ä»èŠ‚ç‚¹&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ncf3j20sj0a3aam_hu14605461601477294296.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ncf3j20sj0a3aam_hu469204126027465024.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ncf3j20sj0a3aam_hu12923813045057376798.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ncf3j20sj0a3aam_hu14605461601477294296.webp&#34;
               width=&#34;760&#34;
               height=&#34;268&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;éªŒè¯é›†ç¾¤çŠ¶æ€&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1moxsj20h304rmxc_hu9059109193276354159.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1moxsj20h304rmxc_hu16837739613891575888.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1moxsj20h304rmxc_hu5894993997813910583.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1moxsj20h304rmxc_hu9059109193276354159.webp&#34;
               width=&#34;615&#34;
               height=&#34;171&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;éªŒè¯è¿è¡Œçš„ Pods&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1scslj20to0bfmyo_hu8132247983164370.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1scslj20to0bfmyo_hu18313961138361316882.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1scslj20to0bfmyo_hu12074555862128613271.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1scslj20to0bfmyo_hu8132247983164370.webp&#34;
               width=&#34;760&#34;
               height=&#34;293&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®‰è£… Istio 1.0.0&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Istio éƒ¨ç½²åœ¨å•ç‹¬çš„ Kubernetes å‘½åç©ºé—´é‡Œï¼šistio-systemï¼Œæˆ‘ä»¬è¿‡åå†æ¥éªŒè¯ã€‚ç°åœ¨ï¼Œå¤åˆ¶å¦‚ä¸‹å†…å®¹åˆ°æ–‡ä»¶ï¼Œå‘½åä¸º install_istio.shï¼Œå¹¶ä¿å­˜ã€‚æ·»åŠ å¯æ‰§è¡Œæƒé™ï¼Œè¿è¡Œä»¥å®‰è£… Istio å’Œç›¸å…³å·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1oor0j20jg05mgn0_hu15157935572541453958.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1oor0j20jg05mgn0_hu7364118503445053034.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1oor0j20jg05mgn0_hu14959026786331824142.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1oor0j20jg05mgn0_hu15157935572541453958.webp&#34;
               width=&#34;700&#34;
               height=&#34;202&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å±å¹•ä¸Šåº”æ˜¾ç¤ºå¦‚ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ue42j20k70fb75x_hu1673907941900394533.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ue42j20k70fb75x_hu14658414788190753792.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ue42j20k70fb75x_hu12332278134480497911.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ue42j20k70fb75x_hu1673907941900394533.webp&#34;
               width=&#34;727&#34;
               height=&#34;551&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¦‚ä¸Šæ‰€ç¤ºï¼Œé»˜è®¤ä¼šå®‰è£… Prometheusã€ServiceGraphã€Jaegerã€Grafana å’Œ Zipkinã€‚&lt;/p&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼šè¿è¡Œè¯¥è„šæœ¬æ—¶ï¼Œå¯èƒ½ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;unable to recognize &lt;span class=&#34;s2&#34;&gt;&amp;#34;install/kubernetes/istio-demo.yaml&amp;#34;&lt;/span&gt;: no matches &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; admissionregistration.k8s.io/, &lt;span class=&#34;nv&#34;&gt;Kind&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;MutatingWebhookConfiguration
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ˜¯æ­£å¸¸çš„ï¼Œå‘½ä»¤ä¸€æ‰§è¡Œå®Œï¼Œå¯åœ¨é¡µé¢çš„ä¸­å¤®çœ‹åˆ°ä¸€é•¿ä¸²å±•ç¤ºçš„ç«¯å£ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1uh9aj20u40jkmz5_hu6044638422761630395.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1uh9aj20u40jkmz5_hu1053124136051173935.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1uh9aj20u40jkmz5_hu14378781819013963544.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1uh9aj20u40jkmz5_hu6044638422761630395.webp&#34;
               width=&#34;760&#34;
               height=&#34;493&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1wesej20u40jkmz5_hu6044638422761630395.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1wesej20u40jkmz5_hu1053124136051173935.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1wesej20u40jkmz5_hu14378781819013963544.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1wesej20u40jkmz5_hu6044638422761630395.webp&#34;
               width=&#34;760&#34;
               height=&#34;493&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;éªŒè¯æœåŠ¡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1wxc3j20x10f175z_hu15851032673267660495.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1wxc3j20x10f175z_hu6364389353206345833.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1wxc3j20x10f175z_hu13027309059445567247.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1wxc3j20x10f175z_hu15851032673267660495.webp&#34;
               width=&#34;760&#34;
               height=&#34;346&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æš´éœ²æœåŠ¡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¦æš´éœ² Prometheusã€Grafana å’Œ æœåŠ¡å›¾æ ‡æœåŠ¡ï¼Œéœ€è¦å…ˆåˆ é™¤å·²æœ‰çš„æœåŠ¡ï¼Œç”¨ NodePort æ›¿æ¢ ClusterIPï¼Œç”¨å®ä¾‹é¡µé¡¶ç«¯å±•ç¤ºçš„ç«¯å£è®¿é—®æœåŠ¡ï¼ˆå¦‚ä¸‹æ‰€ç¤ºï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1oduej210g07ywfj_hu15752733562388691850.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1oduej210g07ywfj_hu1519633162251253722.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1oduej210g07ywfj_hu17397493727110190691.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1oduej210g07ywfj_hu15752733562388691850.webp&#34;
               width=&#34;760&#34;
               height=&#34;166&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1x12ej20z80eogn8_hu10330040565487008716.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1x12ej20z80eogn8_hu15507920012043735.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1x12ej20z80eogn8_hu16734112271554187076.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1x12ej20z80eogn8_hu10330040565487008716.webp&#34;
               width=&#34;760&#34;
               height=&#34;316&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç‚¹å‡» &amp;ldquo;30004&amp;rdquo; è®¿é—® Grafana é¡µï¼Œç‚¹å‡» &amp;ldquo;30003&amp;rdquo; è®¿é—® Prometheus é¡µã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ysfbj21350ofjsy_hu1820122877768671341.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ysfbj21350ofjsy_hu12233683799990176938.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ysfbj21350ofjsy_hu1536765938244662428.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ysfbj21350ofjsy_hu1820122877768671341.webp&#34;
               width=&#34;760&#34;
               height=&#34;474&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1oe4rj213z0ivq3r_hu7488431879013137120.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1oe4rj213z0ivq3r_hu16884649613517828681.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1oe4rj213z0ivq3r_hu6969718259146095855.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1oe4rj213z0ivq3r_hu7488431879013137120.webp&#34;
               width=&#34;760&#34;
               height=&#34;359&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¯ä»¥å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé€‰æ‹©å¿…è¦é…ç½®æŸ¥çœ‹ Prometheus åº¦é‡ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1olhxj20rp0fl3yr_hu2810617335398114006.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1olhxj20rp0fl3yr_hu455078359371563318.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1olhxj20rp0fl3yr_hu13058038336600433352.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1olhxj20rp0fl3yr_hu2810617335398114006.webp&#34;
               width=&#34;760&#34;
               height=&#34;428&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;åœ¨ Grafana é¡µï¼Œæ·»åŠ  Prometheus æ•°æ®æºï¼Œå¹¶ç¡®è®¤ Dashboard å·²ç»è¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1pomvj20hs0ixdgh_hu6912608455050489667.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1pomvj20hs0ixdgh_hu9263852965036771421.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1pomvj20hs0ixdgh_hu14392619508453548228.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1pomvj20hs0ixdgh_hu6912608455050489667.webp&#34;
               width=&#34;640&#34;
               height=&#34;681&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;æ­å–œï¼ä½ å·²ç»å°† Istio éƒ¨ç½²åœ¨ Kubernetes é›†ç¾¤ä¸Šäº†ï¼ŒK8S playgroud ä¸Šå·²ç»å®‰è£…çš„æœåŠ¡åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Istio Controllersï¼Œä»¥åŠç›¸å…³ RBAC è§„åˆ™&lt;/li&gt;
&lt;li&gt;Istio å®šåˆ¶èµ„æºå®šä¹‰&lt;/li&gt;
&lt;li&gt;Prometheus å’Œ Grafana ç›‘æ§ç³»ç»Ÿ&lt;/li&gt;
&lt;li&gt;Jeager åˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿ&lt;/li&gt;
&lt;li&gt;Istio Sidecar æ³¨å…¥ç¨‹åºï¼ˆä¸‹ä¸€èŠ‚æˆ‘ä»¬å†æ¥ä»”ç»†çœ‹çœ‹ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;å®‰è£… Istioctl&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Istioctl æ˜¯ Istio çš„å‘½ä»¤è¡Œé…ç½®å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥åˆ›å»ºã€æŸ¥è¯¢ã€ä¿®æ”¹å’Œåˆ é™¤ Istio ç³»ç»Ÿçš„é…ç½®èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1qvitj213v06it97_hu11647118107365059178.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1qvitj213v06it97_hu8587259898807755646.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1qvitj213v06it97_hu12365532799003844113.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1qvitj213v06it97_hu11647118107365059178.webp&#34;
               width=&#34;760&#34;
               height=&#34;124&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;éƒ¨ç½² BookInfo åº”ç”¨ç¤ºä¾‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Istio å·²ç»å®‰è£…å¹¶éªŒè¯è¿‡äº†ï¼Œå¯ä»¥åœ¨ä¸Šé¢éƒ¨ç½²ç¤ºä¾‹åº”ç”¨ BookInfo äº†ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„ä¹¦åº—æ¨¡æ‹Ÿåº”ç”¨ï¼Œç”±å››ä¸ªæœåŠ¡ç»„æˆï¼šç½‘ç«™é¦–é¡µã€ä¹¦ç±ä¿¡æ¯ã€è¯„è®ºï¼ˆå‡ ä¸ªç‰¹å®šçš„ç‰ˆæœ¬æœ‰è¯„è®ºæœåŠ¡ï¼‰å’Œè¯„åˆ†ï¼Œå…¨éƒ¨ç”± Istio ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;éƒ¨ç½² BookInfo æœåŠ¡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj247c0j20jg07gdhv_hu17770076326102508456.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj247c0j20jg07gdhv_hu6953479099985506176.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj247c0j20jg07gdhv_hu2216616957566668349.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj247c0j20jg07gdhv_hu17770076326102508456.webp&#34;
               width=&#34;700&#34;
               height=&#34;268&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰å…¥å£ç½‘å…³&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1rru2j20jg03xdgu_hu6516452658401490023.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1rru2j20jg03xdgu_hu3362313696785495429.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1rru2j20jg03xdgu_hu8973894638865446537.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1rru2j20jg03xdgu_hu6516452658401490023.webp&#34;
               width=&#34;700&#34;
               height=&#34;141&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;éªŒè¯ BookInfo åº”ç”¨&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj280kwj20jg0d8aew_hu153010366225123300.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj280kwj20jg0d8aew_hu11261831714756474450.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj280kwj20jg0d8aew_hu1499697710693414435.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj280kwj20jg0d8aew_hu153010366225123300.webp&#34;
               width=&#34;700&#34;
               height=&#34;476&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj27k0kj20jg0k57b9_hu10791571697824528997.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj27k0kj20jg0k57b9_hu10090658018950103648.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj27k0kj20jg0k57b9_hu1892907195190704482.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj27k0kj20jg0k57b9_hu10791571697824528997.webp&#34;
               width=&#34;700&#34;
               height=&#34;725&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é€šè¿‡ URL è®¿é—®&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj28b2bj20jg07rwhd_hu16463729477233235062.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj28b2bj20jg07rwhd_hu12151137843028995027.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj28b2bj20jg07rwhd_hu4656946790286104557.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj28b2bj20jg07rwhd_hu16463729477233235062.webp&#34;
               width=&#34;700&#34;
               height=&#34;279&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;ç°åœ¨åº”è¯¥å¯ä»¥çœ‹åˆ° BookInfo ç¤ºä¾‹äº†ï¼š&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ycp2j20jg07rjtf_hu14678380178100432777.webp 400w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ycp2j20jg07rjtf_hu13472729897463238190.webp 760w,
               /blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ycp2j20jg07rjtf_hu4284191723410327084.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/test-drive-your-first-istio-deployment-using-play-with-kubernetes-platform-cloud-computing/6286a305ly1fuxwj1ycp2j20jg07rjtf_hu14678380178100432777.webp&#34;
               width=&#34;700&#34;
               height=&#34;279&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;å¸Œæœ›æœ¬éƒ¨ç¨‹èƒ½å¸®ä½ é¡ºåˆ©çš„åœ¨ Kubernetes ä¸Šéƒ¨ç½² Istioã€‚ä¸‹ä¸€ç¯‡åšå®¢ï¼Œæˆ‘å°†æ·±å…¥ Istio çš„å†…éƒ¨æ¶æ„ã€æµé‡æ§åˆ¶ã€æƒé™å’Œé¥æµ‹ç­‰ç»†èŠ‚ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å Kubernetes æ—¶ä»£çš„å¾®æœåŠ¡</title>
      <link>https://cloudnativecn.com/blog/microservices-post-kubernetes/</link>
      <pubDate>Fri, 07 Sep 2018 12:27:58 +0800</pubDate>
      <guid>https://cloudnativecn.com/blog/microservices-post-kubernetes/</guid>
      <description>&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/microservices-post-kubernetes/006tNbRwgy1fuxayjq7oej30n30ammzp_hu5791026608026171903.webp 400w,
               /blog/microservices-post-kubernetes/006tNbRwgy1fuxayjq7oej30n30ammzp_hu8795405942118102047.webp 760w,
               /blog/microservices-post-kubernetes/006tNbRwgy1fuxayjq7oej30n30ammzp_hu3893499584200333732.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/microservices-post-kubernetes/006tNbRwgy1fuxayjq7oej30n30ammzp_hu5791026608026171903.webp&#34;
               width=&#34;760&#34;
               height=&#34;349&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;å…³é”®è¦ç‚¹&#34;&gt;å…³é”®è¦ç‚¹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å¾®æœåŠ¡æ¶æ„ä»ç„¶æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿæœ€æµè¡Œçš„æ¶æ„é£æ ¼ã€‚ä½† Kubernetes å’Œäº‘åŸç”Ÿè¿åŠ¨å·²ç»åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šé‡æ–°å®šä¹‰äº†åº”ç”¨ç¨‹åºçš„è®¾è®¡å’Œå¼€å‘ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨äº‘åŸç”Ÿå¹³å°ä¸Šï¼ŒæœåŠ¡çš„å¯è§‚å¯Ÿæ€§æ˜¯ä¸å¤Ÿçš„ã€‚æ›´åŸºæœ¬çš„å…ˆå†³æ¡ä»¶æ˜¯é€šè¿‡å®æ–½å¥åº·æ£€æŸ¥ï¼Œå¯¹ä¿¡å·åšå‡ºååº”ï¼Œå£°æ˜èµ„æºæ¶ˆè€—ç­‰ï¼Œä½¿å¾®æœåŠ¡è‡ªåŠ¨åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨å Kubernetes æ—¶ä»£ï¼ŒæœåŠ¡ç½‘æ ¼æŠ€æœ¯å°†å®Œå…¨å–ä»£ä½¿ç”¨åº“æ¥å®ç°æ“ä½œç½‘ç»œé—®é¢˜ï¼ˆä¾‹å¦‚ Hystrix æ–­è·¯å™¨ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¾®æœåŠ¡ç°åœ¨å¿…é¡»é€šè¿‡ä»å¤šä¸ªç»´åº¦å®ç°å¹‚ç­‰æ€§æ¥è®¾è®¡ç”¨äºâ€œæ¢å¤â€ã€‚&lt;/li&gt;
&lt;li&gt;ç°ä»£å¼€å‘äººå‘˜å¿…é¡»ç²¾é€šç¼–ç¨‹è¯­è¨€ä»¥å®ç°ä¸šåŠ¡åŠŸèƒ½ï¼Œå¹¶ä¸”åŒæ ·ç²¾é€šäº‘åŸç”ŸæŠ€æœ¯ä»¥æ»¡è¶³éåŠŸèƒ½æ€§åŸºç¡€æ¶æ„çº§åˆ«è¦æ±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¾®æœåŠ¡ç‚’ä½œå¼€å§‹äºä¸€å †å…³äºç»„ç»‡ç»“æ„ã€å›¢é˜Ÿè§„æ¨¡ã€æœåŠ¡è§„æ¨¡ã€é‡å†™å’ŒæŠ›å‡ºæœåŠ¡è€Œä¸æ˜¯ä¿®å¤ã€é¿å…å•å…ƒæµ‹è¯•ç­‰çš„æç«¯æƒ³æ³•ã€‚æ ¹æ®æˆ‘çš„ç»éªŒï¼Œå¤§å¤šæ•°è¿™äº›æƒ³æ³•è¢«è¯æ˜æ˜¯é”™è¯¯çš„ï¼Œä¸å®ç”¨çš„æˆ–è€…è‡³å°‘ä¸é€šç”¨ã€‚å¦‚ä»Šï¼Œå¤§å¤šæ•°å‰©ä½™çš„åŸåˆ™å’Œå®è·µéƒ½æ˜¯å¦‚æ­¤é€šç”¨å’Œæ¾æ•£åœ°å®šä¹‰ï¼Œä»¥è‡³äºå®ƒä»¬å¯èƒ½åœ¨æœªæ¥è®¸å¤šå¹´å†…éƒ½ä¼šæˆç«‹ï¼Œè€Œåœ¨å®è·µä¸­å´æ²¡æœ‰å¤šå¤§æ„ä¹‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åœ¨ Kubernetes è¯ç”Ÿçš„å‰å‡ å¹´å¾®æœåŠ¡è¿˜æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿæœ€æµè¡Œçš„æ¶æ„é£æ ¼ã€‚ä½† Kubernetes å’Œäº‘åŸç”Ÿè¿åŠ¨å·²ç»æ”¹å˜äº†åº”ç”¨ç¨‹åºè®¾è®¡å’Œå¼€å‘çš„æ–¹æ–¹é¢é¢ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘è¦è´¨ç–‘å¾®æœåŠ¡çš„ä¸€äº›ç†å¿µï¼ŒæŒ‡æ˜å®ƒä»¬åœ¨å Kubernetes æ—¶ä»£ä¸ä¼šå†åƒä»¥å‰é‚£æ ·å¼ºå¤§ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;ä¸ä»…å¯è§‚å¯Ÿè€Œä¸”è¿˜æœ‰è‡ªåŠ¨åŒ–æœåŠ¡&#34;&gt;ä¸ä»…å¯è§‚å¯Ÿï¼Œè€Œä¸”è¿˜æœ‰è‡ªåŠ¨åŒ–æœåŠ¡&lt;/h2&gt;
&lt;p&gt;å¯è§‚å¯Ÿæ€§ä»ä¸€å¼€å§‹å°±æ˜¯å¾®æœåŠ¡çš„åŸºæœ¬åŸåˆ™ã€‚è™½ç„¶å¯¹äºä¸€èˆ¬çš„åˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´å®ƒæ˜¯æ­£ç¡®çš„ï¼Œä½†ä»Šå¤©ï¼ˆç‰¹åˆ«æ˜¯åœ¨ Kubernetes ä¸Šï¼‰ï¼Œå®ƒçš„å¾ˆå¤§ä¸€éƒ¨åˆ†æ˜¯å¹³å°çº§åˆ«çš„å¼€ç®±å³ç”¨ï¼ˆä¾‹å¦‚è¿›ç¨‹è¿è¡ŒçŠ¶å†µæ£€æŸ¥ã€CPU å’Œå†…å­˜æ¶ˆè€—ï¼‰ã€‚æœ€ä½è¦æ±‚æ˜¯åº”ç”¨ç¨‹åºä»¥ JSON æ ¼å¼ç™»å½•æ§åˆ¶å°ã€‚ä»é‚£æ—¶èµ·ï¼Œå¹³å°å¯ä»¥è·Ÿè¸ªèµ„æºæ¶ˆè€—ã€è¯·æ±‚è·Ÿè¸ªã€æ”¶é›†æ‰€æœ‰ç±»å‹çš„æŒ‡æ ‡ã€é”™è¯¯ç‡ç­‰ï¼Œè€Œæ— éœ€å¤ªå¤šçš„æœåŠ¡çº§åˆ«å¼€å‘å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;åœ¨äº‘åŸç”Ÿå¹³å°ä¸Šï¼Œå¯è§‚å¯Ÿæ€§æ˜¯ä¸å¤Ÿçš„ã€‚æ›´åŸºæœ¬çš„å…ˆå†³æ¡ä»¶æ˜¯é€šè¿‡å®æ–½å¥åº·æ£€æŸ¥ï¼Œå¯¹ä¿¡å·åšå‡ºååº”ï¼Œå£°æ˜èµ„æºæ¶ˆè€—ç­‰ä½¿å¾®æœåŠ¡&lt;a href=&#34;https://www.redhat.com/en/resources/cloud-native-container-design-whitepaper&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è‡ªåŠ¨åŒ–&lt;/a&gt; ã€‚å¯ä»¥å°†å‡ ä¹ä»»ä½•åº”ç”¨ç¨‹åºæ”¾å…¥å®¹å™¨ä¸­è¿è¡Œã€‚ä½†æ˜¯è¦åˆ›å»ºä¸€ä¸ªå®¹å™¨åŒ–çš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥é€šè¿‡äº‘åŸç”Ÿå¹³å°è‡ªåŠ¨åŒ–å’Œåè°ƒç¼–æ’ï¼Œéœ€è¦éµå¾ªä¸€å®šçš„è§„åˆ™ã€‚éµå¾ªè¿™äº› &lt;a href=&#34;https://leanpub.com/k8spatterns/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åŸåˆ™å’Œæ¨¡å¼&lt;/a&gt; ï¼Œå°†ç¡®ä¿ç”Ÿæˆçš„å®¹å™¨åœ¨å¤§å¤šæ•°å®¹å™¨ç¼–æ’å¼•æ“ä¸­è¡¨ç°å¾—åƒä¸€ä¸ªä¼˜ç§€çš„äº‘åŸç”Ÿå…¬æ°‘ï¼Œå…è®¸ä»¥è‡ªåŠ¨æ–¹å¼å¯¹å®ƒä»¬è¿›è¡Œè°ƒåº¦ã€æ‰©å±•å’Œç›‘æ§ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¸Œæœ›å¹³å°ä¸å¿…è§‚å¯ŸæœåŠ¡ä¸­å‘ç”Ÿçš„æƒ…å†µï¼Œè€Œæ˜¯å¸Œæœ›å¹³å°æ£€æµ‹å¼‚å¸¸æƒ…å†µå¹¶æŒ‰ç…§å£°æ˜è¿›è¡Œåè°ƒã€‚æ— è®ºæ˜¯é€šè¿‡åœæ­¢å°†æµé‡å¯¼å‘æœåŠ¡å®ä¾‹ã€é‡å¯ã€å‘ä¸Šå’Œå‘ä¸‹æ‰©å±•ï¼Œè¿˜æ˜¯å°†æœåŠ¡è¿ç§»åˆ°å¦ä¸€ä¸ªå¥åº·ä¸»æœºï¼Œé‡è¯•å¤±è´¥çš„è¯·æ±‚æˆ–å…¶ä»–ï¼Œè¿™éƒ½æ— å…³ç´§è¦ã€‚å¦‚æœæœåŠ¡æ˜¯è‡ªåŠ¨åŒ–çš„ï¼Œåˆ™æ‰€æœ‰çº æ­£æªæ–½éƒ½ä¼šè‡ªåŠ¨å‘ç”Ÿï¼Œæˆ‘ä»¬åªéœ€è¦æè¿°æ‰€éœ€çš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯è§‚å¯Ÿå’Œååº”ã€‚æœåŠ¡åº”è¯¥æ˜¯å¯è§‚å¯Ÿçš„ï¼Œä½†ä¹Ÿå¯ä»¥åœ¨æ²¡æœ‰äººä¸ºå¹²é¢„çš„æƒ…å†µä¸‹é€šè¿‡å¹³å°è‡ªåŠ¨è¿›è¡Œæ•´æ”¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ™ºèƒ½å¹³å°å’Œæ™ºèƒ½æœåŠ¡ä½†æœ‰æ­£ç¡®çš„è´£ä»»&#34;&gt;æ™ºèƒ½å¹³å°å’Œæ™ºèƒ½æœåŠ¡ï¼Œä½†æœ‰æ­£ç¡®çš„è´£ä»»&lt;/h2&gt;
&lt;p&gt;åœ¨ä» SOA è½¬å‘å¾®æœåŠ¡ä¸–ç•Œçš„è¿‡ç¨‹ä¸­ï¼Œ &lt;a href=&#34;https://martinfowler.com/articles/microservices.html#SmartEndpointsAndDumbPipes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;â€œæ™ºèƒ½ç«¯ç‚¹å’Œå“‘ç®¡â€&lt;/a&gt;çš„æ¦‚å¿µæ˜¯æœåŠ¡äº¤äº’çš„å¦ä¸€ä¸ªæ ¹æœ¬è½¬å˜ã€‚åœ¨å¾®æœåŠ¡é¢†åŸŸï¼ŒæœåŠ¡ä¸ä¾èµ–äºé›†ä¸­å¼æ™ºèƒ½è·¯ç”±å±‚çš„å­˜åœ¨ï¼Œè€Œæ˜¯ä¾èµ–äºæ‹¥æœ‰æŸäº›å¹³å°çº§åŠŸèƒ½çš„æ™ºèƒ½ç«¯ç‚¹ã€‚è¿™æ˜¯é€šè¿‡åœ¨æ¯ä¸ªå¾®æœåŠ¡ä¸­åµŒå…¥ä¼ ç»Ÿ ESB çš„ä¸€äº›åŠŸèƒ½å¹¶è½¬æ¢åˆ°æ²¡æœ‰ä¸šåŠ¡é€»è¾‘å…ƒç´ çš„è½»é‡çº§åè®®æ¥å®ç°çš„ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶è¿™ä»ç„¶æ˜¯åœ¨ä¸å¯é çš„ç½‘ç»œå±‚ï¼ˆä½¿ç”¨ &lt;a href=&#34;https://github.com/Netflix/Hystrix&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Hystrix&lt;/a&gt; ç­‰åº“ï¼‰å®ç°æœåŠ¡äº¤äº’çš„æµè¡Œæ–¹å¼ï¼Œä½†ç°åœ¨ï¼Œåœ¨å Kubernetes æ—¶ä»£ï¼Œå®ƒå·²ç»å®Œå…¨è¢«&lt;a href=&#34;https://www.cncf.io/blog/2017/04/26/service-mesh-critical-component-cloud-native-stack/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æœåŠ¡ç½‘æ ¼&lt;/a&gt;æŠ€æœ¯æ‰€å–ä»£ã€‚æœ‰è¶£çš„æ˜¯ï¼ŒæœåŠ¡ç½‘æ ¼ç”šè‡³æ¯”ä¼ ç»Ÿçš„ ESB æ›´æ™ºèƒ½ã€‚ç½‘æ ¼å¯ä»¥æ‰§è¡ŒåŠ¨æ€è·¯ç”±ã€æœåŠ¡å‘ç°ã€åŸºäºå»¶è¿Ÿçš„è´Ÿè½½å¹³è¡¡ã€å“åº”ç±»å‹ã€æŒ‡æ ‡å’Œåˆ†å¸ƒå¼è·Ÿè¸ªã€é‡è¯•ã€è¶…æ—¶ï¼Œä½ èƒ½æƒ³åˆ°çš„è¿™é‡Œéƒ½æœ‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ ESB çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œä¸æœåŠ¡ç½‘æ ¼ä¸åŒçš„æ˜¯ï¼Œåªæœ‰ä¸€ä¸ªé›†ä¸­è·¯ç”±å±‚ï¼Œæ¯ä¸ªå¾®æœåŠ¡é€šå¸¸éƒ½æœ‰è‡ªå·±çš„è·¯ç”±å™¨â€”â€” ä¸€ä¸ªå¸¦æœ‰é™„åŠ ä¸­å¤®ç®¡ç†å±‚çš„ä»£ç†é€»è¾‘çš„ sidecar å®¹å™¨ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œç®¡é“ï¼ˆå¹³å°å’ŒæœåŠ¡ç½‘æ ¼ï¼‰æ²¡æœ‰ä»»ä½•ä¸šåŠ¡é€»è¾‘ï¼›å®ƒä»¬å®Œå…¨ä¸“æ³¨äºåŸºç¡€æ¶æ„æ–¹é¢ï¼Œä½¿æœåŠ¡ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œè¿™ä»£è¡¨äº† ESB å’Œå¾®æœåŠ¡å­¦ä¹ çš„æ¼”å˜ï¼Œä»¥é€‚åº”äº‘ç¯å¢ƒçš„åŠ¨æ€å’Œä¸å¯é ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/microservices-post-kubernetes/006tSBxtly1fuwq6pf4fyj30gn057gnd_hu5877501922837767764.webp 400w,
               /blog/microservices-post-kubernetes/006tSBxtly1fuwq6pf4fyj30gn057gnd_hu5985644287695181778.webp 760w,
               /blog/microservices-post-kubernetes/006tSBxtly1fuwq6pf4fyj30gn057gnd_hu6102514359901872976.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/microservices-post-kubernetes/006tSBxtly1fuwq6pf4fyj30gn057gnd_hu5877501922837767764.webp&#34;
               width=&#34;599&#34;
               height=&#34;187&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;SOA vs MSA ä¸ CNA&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹æœåŠ¡çš„å…¶ä»–æ–¹é¢ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°äº‘åŸç”Ÿä¸ä»…å½±å“ç«¯ç‚¹å’ŒæœåŠ¡äº¤äº’ã€‚Kubernetes å¹³å°ï¼ˆåŒ…å«æ‰€æœ‰å…¶ä»–æŠ€æœ¯ï¼‰è¿˜è´Ÿè´£èµ„æºç®¡ç†ã€è°ƒåº¦ã€éƒ¨ç½²ã€é…ç½®ç®¡ç†ã€æ‰©å±•ã€æœåŠ¡äº¤äº’ç­‰ã€‚è€Œä¸æ˜¯å†æ¬¡å°†å…¶ç§°ä¸ºâ€œæ™ºèƒ½ä»£ç†å’Œå“‘ç®¡â€ï¼Œæˆ‘è®¤ä¸ºå®ƒæ›´å¥½åœ°æè¿°ä½œä¸ºä¸€ä¸ªå…·æœ‰æ­£ç¡®èŒè´£çš„æ™ºèƒ½å¹³å°å’Œæ™ºèƒ½æœåŠ¡ã€‚è¿™ä¸ä»…ä»…æ˜¯å…³äºç«¯ç‚¹ï¼›å®ƒæ˜¯ä¸€ä¸ªå®Œæ•´çš„å¹³å°ï¼Œå¯ä»¥è‡ªåŠ¨åŒ–ä¸šåŠ¡åŠŸèƒ½æœåŠ¡çš„æ‰€æœ‰åŸºç¡€æ¶æ„æ–¹é¢ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸è¦é¢å‘å¤±è´¥è€Œè®¾è®¡è¦é¢å‘æ¢å¤è®¾è®¡&#34;&gt;ä¸è¦é¢å‘å¤±è´¥è€Œè®¾è®¡ï¼Œè¦é¢å‘æ¢å¤è®¾è®¡&lt;/h2&gt;
&lt;p&gt;åœ¨åŸºç¡€æ¶æ„å’Œç½‘ç»œæœ¬èº«ä¸å¯é çš„äº‘åŸç”Ÿç¯å¢ƒä¸­è¿è¡Œçš„å¾®æœåŠ¡å¿…é¡»é’ˆå¯¹æ•…éšœè¿›è¡Œè®¾è®¡ã€‚è¿™æ¯«æ— ç–‘é—®ã€‚ä½†æ˜¯å¹³å°æ£€æµ‹åˆ°å¹¶å¤„ç†äº†è¶Šæ¥è¶Šå¤šçš„æ•…éšœï¼Œå¹¶ä¸”ä»å¾®æœåŠ¡ä¸­æ•è·æ•…éšœçš„é‡è¾ƒå°‘ã€‚ç›¸åï¼Œè€ƒè™‘é€šè¿‡ä»å¤šä¸ªç»´åº¦å®ç°å¹‚ç­‰æ€§æ¥è®¾è®¡æ‚¨çš„æ¢å¤æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;å®¹å™¨æŠ€æœ¯ã€å®¹å™¨ç¼–æ’å™¨å’ŒæœåŠ¡ç½‘ç»œå¯ä»¥æ£€æµ‹å¹¶ä»è®¸å¤šæ•…éšœä¸­æ¢å¤ï¼šæ— é™å¾ªç¯â€”â€”CPU åˆ†é…ã€å†…å­˜æ³„æ¼å’Œ OOMâ€”â€”è¿è¡ŒçŠ¶å†µæ£€æŸ¥ã€ç£ç›˜å ç”¨â€”â€”é…é¢ã€fork ç‚¸å¼¹â€”â€”è¿›ç¨‹é™åˆ¶ã€æ‰¹é‡å¤„ç†å’Œè¿›ç¨‹éš”ç¦»â€”â€”å†…å­˜é™åˆ¶ã€å»¶è¿Ÿå’ŒåŸºäºå“åº”çš„æœåŠ¡å‘ç°ã€é‡è¯•ã€è¶…æ—¶ã€è‡ªåŠ¨æ‰©å±•ç­‰ç­‰ã€‚æ›´ä¸ç”¨è¯´ï¼Œè¿‡æ¸¡åˆ°æ— æœåŠ¡å™¨æ¨¡å‹ï¼ŒæœåŠ¡åªéœ€è¦åœ¨å‡ æ¯«ç§’å†…å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œè€Œåƒåœ¾æ”¶é›†ã€çº¿ç¨‹æ± ã€èµ„æºæ³„æ¼ä¹Ÿè¶Šæ¥è¶Šä¸éœ€è¦å…³å¿ƒã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡å¹³å°å¤„ç†æ‰€æœ‰è¿™äº›ä»¥åŠæ›´å¤šå†…å®¹ï¼Œå°†æ‚¨çš„æœåŠ¡è§†ä¸ºä¸€ä¸ªå¯†å°çš„é»‘ç›’å­ï¼Œå®ƒå°†å¤šæ¬¡å¯åŠ¨å’Œåœæ­¢ï¼Œä½¿æœåŠ¡èƒ½å¤Ÿé‡æ–°å¯åŠ¨ã€‚æ‚¨çš„æœåŠ¡å°†æŒ‰æ¯”ä¾‹æ”¾å¤§å’Œç¼©å°å€æ•°ï¼Œé€šè¿‡ä½¿å…¶æ— çŠ¶æ€ï¼Œä½¿å…¶å¯ä»¥å®‰å…¨åœ°è¿›è¡Œæ‰©å±•ã€‚å‡è®¾è®¸å¤šä¼ å…¥è¯·æ±‚æœ€ç»ˆä¼šè¶…æ—¶ï¼Œä½¿ç«¯ç‚¹å…·æœ‰å¹‚ç­‰æ€§ã€‚å‡è®¾è®¸å¤šä¼ å‡ºè¯·æ±‚å°†æš‚æ—¶å¤±è´¥ï¼Œå¹³å°å°†ä¸ºæ‚¨é‡è¯•å®ƒä»¬ï¼Œç¡®ä¿æ‚¨ä½¿ç”¨å¹‚ç­‰æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†é€‚åˆäº‘åŸç”Ÿç¯å¢ƒä¸­çš„è‡ªåŠ¨åŒ–ï¼ŒæœåŠ¡å¿…é¡»æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¹‚ç­‰é‡å¯ï¼ˆæœåŠ¡å¯ä»¥è¢«æ€æ­»å¹¶å¤šæ¬¡å¯åŠ¨ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¹‚ç­‰æ‰©å±•/ç¼©å°ï¼ˆæœåŠ¡å¯ä»¥è‡ªåŠ¨æ‰©å±•åˆ°å¤šä¸ªå®ä¾‹ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¹‚ç­‰æœåŠ¡ç”Ÿäº§è€…ï¼ˆå…¶ä»–æœåŠ¡å¯èƒ½ä¼šé‡è¯•è°ƒç”¨ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¹‚ç­‰æœåŠ¡ä½¿ç”¨è€…ï¼ˆæœåŠ¡æˆ–ç½‘çŠ¶ç½‘å¯ä»¥é‡è¯•ä¼ å‡ºè°ƒç”¨ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœæ‚¨æ‰§è¡Œä¸Šè¿°æ“ä½œä¸€æ¬¡æˆ–å¤šæ¬¡æ—¶æœåŠ¡çš„è¡Œä¸ºå§‹ç»ˆç›¸åŒï¼Œé‚£ä¹ˆå¹³å°å°†èƒ½å¤Ÿåœ¨æ²¡æœ‰äººä¸ºå¹²é¢„çš„æƒ…å†µä¸‹ä»æ•…éšœä¸­æ¢å¤æ‚¨çš„æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œè¯·è®°ä½ï¼Œå¹³å°æä¾›çš„æ‰€æœ‰æ¢å¤åªæ˜¯æœ¬åœ°ä¼˜åŒ–ã€‚&lt;a href=&#34;http://blog.christianposta.com/microservices/application-safety-and-correctness-cannot-be-offloaded-to-istio-or-any-service-mesh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;æ­£å¦‚ Christian Posta æ‰€è¯´çš„é‚£æ ·&lt;/a&gt; ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„åº”ç”¨ç¨‹åºå®‰å…¨æ€§å’Œæ­£ç¡®æ€§ä»ç„¶æ˜¯åº”ç”¨ç¨‹åºçš„è´£ä»»ã€‚æ•´ä¸ªä¸šåŠ¡æµç¨‹èŒƒå›´çš„æ€ç»´æ¨¡å¼ï¼ˆå¯èƒ½è·¨è¶Šå¤šä¸ªæœåŠ¡ï¼‰å¯¹äºè®¾è®¡æ•´ä½“ç¨³å®šçš„ç³»ç»Ÿæ˜¯å¿…è¦çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ··åˆå¼€å‘èŒè´£&#34;&gt;æ··åˆå¼€å‘èŒè´£&lt;/h2&gt;
&lt;p&gt;è¶Šæ¥è¶Šå¤šçš„å¾®æœåŠ¡åŸåˆ™è¢« Kubernetes åŠå…¶è¡¥å……é¡¹ç›®å®æ–½å’Œæä¾›ã€‚å› æ­¤ï¼Œå¼€å‘äººå‘˜å¿…é¡»ç²¾é€šç¼–ç¨‹è¯­è¨€ä»¥å®ç°ä¸šåŠ¡åŠŸèƒ½ï¼Œå¹¶ä¸”åŒæ ·ç²¾é€šäº‘åŸç”ŸæŠ€æœ¯ä»¥æ»¡è¶³éåŠŸèƒ½æ€§åŸºç¡€æ¶æ„çº§åˆ«è¦æ±‚ï¼ŒåŒæ—¶å®Œå…¨å®ç°åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;ä¸šåŠ¡éœ€æ±‚å’ŒåŸºç¡€æ¶æ„ï¼ˆæ“ä½œæˆ–è·¨åŠŸèƒ½éœ€æ±‚æˆ–ç³»ç»Ÿè´¨é‡å±æ€§ï¼‰ä¹‹é—´çš„ç•Œé™æ€»æ˜¯æ¨¡ç³Šä¸æ¸…ï¼Œå¹¶ä¸”ä¸å¯èƒ½é‡‡å–ä¸€ä¸ªæ–¹é¢å¹¶æœŸæœ›å…¶ä»–äººåšå¦ä¸€ä¸ªæ–¹é¢ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåœ¨æœåŠ¡ç½‘æ ¼å±‚ä¸­å®ç°é‡è¯•é€»è¾‘ï¼Œåˆ™å¿…é¡»ä½¿æœåŠ¡ä¸­çš„ä¸šåŠ¡é€»è¾‘æˆ–æ•°æ®åº“å±‚ä½¿ç”¨çš„æœåŠ¡å…·æœ‰å¹‚ç­‰æ€§ã€‚å¦‚æœåœ¨æœåŠ¡ç½‘æ ¼çº§åˆ«ä½¿ç”¨è¶…æ—¶ï¼Œåˆ™å¿…é¡»åŒæ­¥æœåŠ¡ä¸­çš„æœåŠ¡ä½¿ç”¨è€…è¶…æ—¶ã€‚å¦‚æœå¿…é¡»å®ç°æœåŠ¡çš„é‡å¤æ‰§è¡Œï¼Œåˆ™å¿…é¡»é…ç½® Kubernetes ä½œä¸šæ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;å±•æœ›æœªæ¥ï¼Œä¸€äº›æœåŠ¡åŠŸèƒ½å°†ä½œä¸ºä¸šåŠ¡é€»è¾‘åœ¨æœåŠ¡ä¸­å®ç°ï¼Œè€Œå…¶ä»–æœåŠ¡åŠŸèƒ½åˆ™ä½œä¸ºå¹³å°åŠŸèƒ½æä¾›ã€‚è™½ç„¶ä½¿ç”¨æ­£ç¡®çš„å·¥å…·æ¥å®Œæˆæ­£ç¡®çš„ä»»åŠ¡æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è´£ä»»åˆ†ç¦»ï¼Œä½†æŠ€æœ¯çš„æ¿€å¢æå¤§åœ°å¢åŠ äº†æ•´ä½“çš„å¤æ‚æ€§ã€‚åœ¨ä¸šåŠ¡é€»è¾‘æ–¹é¢å®ç°ç®€å•çš„æœåŠ¡éœ€è¦å¾ˆå¥½åœ°ç†è§£åˆ†å¸ƒå¼æŠ€æœ¯å †æ ˆï¼Œå› ä¸ºè´£ä»»åˆ†æ•£åœ¨æ¯ä¸€å±‚ã€‚&lt;/p&gt;
&lt;p&gt;æ® &lt;a href=&#34;https://kubernetes.io/blog/2016/03/1000-nodes-and-beyond-updates-to-kubernetes-performance-and-scalability-in-12/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;è¯å®&lt;/a&gt; Kubernetes æ˜¯å¯ä»¥æ‰©å±•åˆ°æ•°åƒä¸ªèŠ‚ç‚¹ã€æ•°ä¸‡ä¸ª pod å’Œæ•°ç™¾ä¸‡çš„ TPSã€‚æ‚¨çš„åº”ç”¨ç¨‹åºå¤§å°ã€å¤æ‚æ€§ï¼Œæˆ–è€…è¯´æ˜¯å¼•å…¥â€œäº‘åŸç”Ÿâ€å¤æ‚æ€§çš„å…³é”®æ€§å› ç´ ï¼Œæˆ‘è¿˜ä¸æ¸…æ¥šã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h2&gt;
&lt;p&gt;æœ‰è¶£çš„æ˜¯ï¼Œå¾®æœåŠ¡è¿åŠ¨å¦‚ä½•ä¸ºé‡‡ç”¨ Docker å’Œ Kubernetes ç­‰å®¹å™¨æŠ€æœ¯æä¾›äº†å¦‚æ­¤å¤§çš„åŠ¨åŠ›ã€‚è™½ç„¶æœ€åˆæ˜¯æ¨åŠ¨è¿™äº›æŠ€æœ¯å‘å±•çš„å¾®æœåŠ¡å®è·µï¼Œä½†ç°åœ¨ Kubernetes å®šä¹‰äº†å¾®æœåŠ¡æ¶æ„çš„åŸåˆ™å’Œå®è·µã€‚&lt;/p&gt;
&lt;p&gt;æœ€è¿‘çš„ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬è·ç¦»æ¥å—å‡½æ•°æ¨¡å‹ä½œä¸ºæœ‰æ•ˆçš„å¾®æœåŠ¡åŸè¯­å¹¶ä¸è¿œï¼Œè€Œä¸æ˜¯å°†å…¶è§†ä¸ºçº³ç±³æœåŠ¡çš„åæ¨¡å¼ã€‚æˆ‘ä»¬å¹¶æ²¡æœ‰å……åˆ†çš„ç†ç”±è´¨ç–‘äº‘åŸç”ŸæŠ€æœ¯å¯¹äºä¸­å°å‹æ¡ˆä¾‹çš„å®ç”¨æ€§å’Œé€‚ç”¨æ€§ï¼Œè€Œæ˜¯å› ä¸ºå…´å¥‹è€Œæœ‰äº›ä¸ç»æ„åœ°è·³äº†èµ·æ¥ã€‚&lt;/p&gt;
&lt;p&gt;Kubernetes æ‹¥æœ‰ ESB å’Œå¾®æœåŠ¡çš„è®¸å¤šçŸ¥è¯†ï¼Œå› æ­¤ï¼Œå®ƒæ˜¯æœ€ç»ˆçš„åˆ†å¸ƒå¼ç³»ç»Ÿå¹³å°ã€‚å®ƒæ˜¯æ¶æ„é£æ ¼çš„æŠ€æœ¯ï¼Œè€Œä¸æ˜¯ç›¸åçš„æ–¹å¼ã€‚æ— è®ºå¥½åï¼Œæ—¶é—´ä¼šè¯æ˜ä¸€åˆ‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…³äºä½œè€…&#34;&gt;å…³äºä½œè€…&lt;/h2&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /blog/microservices-post-kubernetes/006tSBxtly1fuwq6p5tm2j302d02sq2y_hu4410010973301404721.webp 400w,
               /blog/microservices-post-kubernetes/006tSBxtly1fuwq6p5tm2j302d02sq2y_hu11949524258693162320.webp 760w,
               /blog/microservices-post-kubernetes/006tSBxtly1fuwq6p5tm2j302d02sq2y_hu1439337074559241194.webp 1200w&#34;
               src=&#34;https://cloudnativecn.com/blog/microservices-post-kubernetes/006tSBxtly1fuwq6p5tm2j302d02sq2y_hu4410010973301404721.webp&#34;
               width=&#34;85&#34;
               height=&#34;100&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Bilgin Ibryam&lt;/strong&gt;  ï¼ˆ@bibryamï¼‰æ˜¯ Red Hat çš„é¦–å¸­æ¶æ„å¸ˆï¼Œæäº¤è€…å’Œ ASF æˆå‘˜ã€‚ä»–æ˜¯ä¸€åå¼€æºä¼ æ’­è€…ï¼Œåšå®¢ä½œè€…ï¼Œã€ŠCamel Design Patternsã€‹å’Œã€ŠKubernetes Patternsã€‹ä¹¦ç±çš„ä½œè€…ã€‚åœ¨ä»–çš„æ—¥å¸¸å·¥ä½œä¸­ï¼ŒBilgin å–œæ¬¢æŒ‡å¯¼ç¼–ç å’Œé¢†å¯¼å¼€å‘äººå‘˜æˆåŠŸæ„å»ºäº‘åŸç”Ÿè§£å†³æ–¹æ¡ˆã€‚ä»–ç›®å‰çš„å·¥ä½œé‡ç‚¹æ˜¯åº”ç”¨ç¨‹åºé›†æˆã€åˆ†å¸ƒå¼ç³»ç»Ÿã€æ¶ˆæ¯ä¼ é€’ã€å¾®æœåŠ¡ã€devops å’Œä¸€èˆ¬çš„äº‘åŸç”ŸæŒ‘æˆ˜ã€‚ä½ å¯ä»¥åœ¨  &lt;a href=&#34;https://twitter.com/bibryam&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Twitter&lt;/a&gt;ã€&lt;a href=&#34;https://uk.linkedin.com/in/bibryam&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Linkedin&lt;/a&gt;  æˆ–ä»–çš„  &lt;a href=&#34;http://www.ofbizian.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;åšå®¢&lt;/a&gt; ä¸Šæ‰¾åˆ°ä»–ã€‚&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
